import{d as j,u as W,p as q,a as G,n as H,r as _,q as J,o as O,M as U,N as I,O as K,f as o,g as r,y as i,D as f,i as Q,F as m,G as v,t as d,h as k,j as L,z as P,H as X,I as Y,J as Z}from"./index-Rya0IZQn.js";import w from"./SvgServe-day6jaRS.js";const S=h=>(X("data-v-43dd54da"),h=h(),Y(),h),ee={id:"col-wrap"},te=S(()=>i("div",{class:"col-header"},null,-1)),se=S(()=>i("div",{class:"col-body"},null,-1)),ae=[te,se],le=["title","onClick"],ie={class:"col-body"},ne=["title","onClick"],oe=["title","onClick"],ce=["data-type","data-ext","title","onClick","onDblclick"],re=["data-type","data-ext","title","onClick","onDblclick"],ue={key:0,class:"empty"},de={key:0,class:"col-split"},fe={key:0,class:"column file-preview"},me=["title"],pe={id:"file-preview"},_e={class:"soft"},ve=S(()=>i("br",null,null,-1)),he=S(()=>i("div",{class:"column filler-right"},[i("div",{class:"col-header"}),i("div",{class:"col-body"})],-1)),ye=j({__name:"FileBrowser",setup(h){const B=W().loadApi("fileSystem"),g=q(),z=G(),D=H(),x=_(!1),a=_(null),u=_(null),C=_(null),$=_(null);J(async()=>{x.value=!0,a.value=a.value?a.value:[],b(),window.addEventListener("popstate",b)}),O(()=>{x.value=!1,window.removeEventListener("popstate",b)});async function b(){console.log("parseRoute"),await y();const n=z.path.replace(/(^\/headless)?\/~(\/)?/,"").split("/").filter(s=>!!s);for(const[s,e]of n.entries()){const c=n.slice(0,s+1).join("/");await y(c,e,s+1)}const l=z.hash.replace(/^#/,"");if(a.value&&l&&l.length>0){const s=a.value[a.value.length-1],c=s.files.concat(s.files_hidden).filter(p=>p.filename===l)[0];E(c,a.value.length)}}async function E(t,n,l=!1){if(!l){const s=new RegExp("/?"+t.filename+"$"),e=t.path.replace(s,""),c=D.headless?"/headless":"";g.push(c+"/~/"+e+"#"+t.filename)}F(n-1),t.sel=!0,t.disp_size=U(t._meta.size),t.disp_time_created=I(t._meta.time_created),t.disp_time_edited=I(t._meta.time_edited),a.value&&a.value.splice(n),u.value=t,l&&A()}function N(){u.value=null}function R(t){g.push("/~/"+t.path)}async function y(t="",n="",l=0,s=!1){if(!x.value)return;s&&g.push("/~/"+t),l>0&&M(l-1,"dir",n);const e=await V(t);e&&(N(),a.value&&(a.value.splice(l),a.value[l]=e)),s&&A()}async function A(){await K(),C.value&&(C.value.scrollLeft=9999999999999)}function M(t,n,l){if(F(t),a.value){const s=a.value[t],c=(n=="dir"?s.dirs.concat(s.dirs_hidden):s.files.concat(s.files_hidden)).filter(p=>p.filename===l)[0];c&&(c.sel=!0)}}async function T(t){a.value&&a.value.splice(t+1),F(t),N()}function F(t){a.value&&(a.value[t].dirs.forEach(n=>n.sel=!1),a.value[t].dirs_hidden.forEach(n=>n.sel=!1),a.value[t].files.forEach(n=>n.sel=!1),a.value[t].files_hidden.forEach(n=>n.sel=!1))}async function V(t=""){if(!B)return;const{status:n,data:l,statusText:s}=await B.getWorkspaceFiles(t);if(n!==200){console.error(s);return}else return l}return(t,n)=>(o(),r("div",{id:"col-scroll-x",ref_key:"colScroll",ref:C},[i("div",ee,[i("div",{class:f(["column filler-left",{headless:Q(D).headless}])},ae,2),(o(!0),r(m,null,v(a.value,(l,s)=>(o(),r(m,{key:s},[i("div",{class:"column",ref_for:!0,ref_key:"columns",ref:$},[i("div",{class:f(["col-header",{root:s==0}]),title:l._meta.name,onClick:e=>T(s)},d(l._meta.name),11,le),i("div",ie,[(o(!0),r(m,null,v(l.dirs_hidden,(e,c)=>(o(),r("div",{key:c,class:f(["dir hidden",{sel:e.sel}]),title:e.filename,onClick:()=>y(e.path,e.filename,s+1,!0)},[i("div",null,d(e.filename),1),(o(),k(w,{filename:"icn-caret-right",key:e.filename}))],10,ne))),128)),(o(!0),r(m,null,v(l.dirs,(e,c)=>(o(),r("div",{key:c,class:f(["dir",{sel:e.sel}]),title:e.filename,onClick:()=>y(e.path,e.filename,s+1,!0)},[i("div",null,d(e.filename),1),(o(),k(w,{filename:"icn-caret-right",key:e.filename}))],10,oe))),128)),(o(!0),r(m,null,v(l.files_hidden,(e,c)=>(o(),r("div",{key:c,class:f(["file hidden",{sel:e.sel}]),"data-type":e._meta.type,"data-ext":e._meta.ext,title:e.filename,onClick:()=>E(e,s+1,!0),onDblclick:p=>R(e)},[(o(),k(w,{filename:"icn-"+e._meta.type,key:e._meta.type},null,8,["filename"])),i("div",null,d(e.filename),1)],42,ce))),128)),(o(!0),r(m,null,v(l.files,(e,c)=>(o(),r("div",{key:c,class:f(["file",{sel:e.sel}]),"data-type":e._meta.type,"data-ext":e._meta.ext,title:e.filename,onClick:()=>E(e,s+1,!0),onDblclick:p=>R(e)},[(o(),k(w,{filename:"icn-"+e._meta.type,key:e._meta.type},null,8,["filename"])),i("div",null,d(e.filename),1)],42,re))),128)),l._meta.empty?(o(),r("div",ue,"Empty directory")):L("",!0)])],512),a.value&&s<a.value.length-1||u.value?(o(),r("div",de)):L("",!0)],64))),128)),u.value?(o(),r("div",fe,[i("div",{class:"col-header",title:u.value._meta.name},d(u.value._meta.name),9,me),i("div",pe,[i("b",null,d(u.value._meta.name),1),i("small",null,[i("i",null,d(u.value.disp_size),1),i("div",_e,[P(" Created: "+d(u.value.disp_time_created),1),ve,P(" Last edit: "+d(u.value.disp_time_edited),1)])])])])):L("",!0),he])],512))}}),ge=Z(ye,[["__scopeId","data-v-43dd54da"]]);export{ge as default};
