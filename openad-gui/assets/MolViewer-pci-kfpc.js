import{l as commonjsGlobal$1,m as defineStore,d as defineComponent,n as useMainStore,b as useFileStore,u as useApiStore,r as ref,p as useRouter,a as useRoute,c as computed,q as onMounted,v as onBeforeMount,w as watch,x as resolveComponent,f as openBlock,g as createElementBlock,y as createBaseVNode,z as createTextVNode,A as withModifiers,t as toDisplayString,j as createCommentVNode,B as createVNode,C as withCtx,i as unref,D as normalizeClass,h as createBlock,F as Fragment,E as normalizeStyle,G as renderList,H as pushScopeId,I as popScopeId,J as _export_sfc}from"./index-Rya0IZQn.js";import{B as BreadCrumbs}from"./BreadCrumbs-d_Toiakp.js";var lodash={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */lodash.exports;(function(o,t){(function(){var e,n="4.17.21",r=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",u=500,f="__lodash_placeholder__",p=1,g=2,y=4,E=1,h=2,v=1,C=2,x=4,w=8,_=16,S=32,M=64,T=128,R=256,P=512,I=30,B="...",W=800,D=16,O=1,z=2,G=3,k=1/0,$=9007199254740991,Z=17976931348623157e292,K=NaN,j=4294967295,Q=j-1,le=j>>>1,he=[["ary",T],["bind",v],["bindKey",C],["curry",w],["curryRight",_],["flip",P],["partial",S],["partialRight",M],["rearg",R]],ve="[object Arguments]",re="[object Array]",Ie="[object AsyncFunction]",ge="[object Boolean]",Se="[object Date]",Le="[object DOMException]",be="[object Error]",ye="[object Function]",ce="[object GeneratorFunction]",ue="[object Map]",Ce="[object Number]",Ve="[object Null]",ie="[object Object]",ae="[object Promise]",Ae="[object Proxy]",De="[object RegExp]",Be="[object Set]",ze="[object String]",We="[object Symbol]",$e="[object Undefined]",qe="[object WeakMap]",et="[object WeakSet]",F="[object ArrayBuffer]",H="[object DataView]",X="[object Float32Array]",oe="[object Float64Array]",te="[object Int8Array]",Me="[object Int16Array]",Te="[object Int32Array]",q="[object Uint8Array]",Ee="[object Uint8ClampedArray]",Pe="[object Uint16Array]",tt="[object Uint32Array]",Oe=/\b__p \+= '';/g,Je=/\b(__p \+=) '' \+/g,ee=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Fe=/&(?:amp|lt|gt|quot|#39);/g,it=/[&<>"']/g,U=RegExp(Fe.source),ke=RegExp(it.source),de=/<%-([\s\S]+?)%>/g,se=/<%([\s\S]+?)%>/g,fe=/<%=([\s\S]+?)%>/g,je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ht=/^\w*$/,pt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(dt.source),_e=/^\s+/,Xe=/\s/,Ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ye=/\{\n\/\* \[wrapped with (.+)\] \*/,ot=/,? & /,gt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Et=/[()=,{}\[\]\/\s]/,yt=/\\(\\)?/g,mt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,St=/\w*$/,vt=/^[-+]0x[0-9a-f]+$/i,Rt=/^0b[01]+$/i,xt=/^\[object .+?Constructor\]$/,dr=/^0o[0-7]+$/i,$t=/^(?:0|[1-9]\d*)$/,pr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,qt=/($^)/,Lr=/['\n\r\u2028\u2029\\]/g,yr="\\ud800-\\udfff",or="\\u0300-\\u036f",xr="\\ufe20-\\ufe2f",mr="\\u20d0-\\u20ff",za=or+xr+mr,Va="\\u2700-\\u27bf",Ua="a-z\\xdf-\\xf6\\xf8-\\xff",Gs="\\xac\\xb1\\xd7\\xf7",Xt="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",yn="\\u2000-\\u206f",nn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ga="A-Z\\xc0-\\xd6\\xd8-\\xde",Rn="\\ufe0e\\ufe0f",Bi=Gs+Xt+yn+nn,ci="['’]",na="["+yr+"]",ki="["+Bi+"]",$n="["+za+"]",xn="\\d+",ui="["+Va+"]",Tr="["+Ua+"]",Ln="[^"+yr+Bi+xn+Va+Ua+Ga+"]",un="\\ud83c[\\udffb-\\udfff]",Xn="(?:"+$n+"|"+un+")",Wa="[^"+yr+"]",fn="(?:\\ud83c[\\udde6-\\uddff]){2}",Fi="[\\ud800-\\udbff][\\udc00-\\udfff]",Nr="["+Ga+"]",Ha="\\u200d",Ws="(?:"+Tr+"|"+Ln+")",bn="(?:"+Nr+"|"+Ln+")",Pr="(?:"+ci+"(?:d|ll|m|re|s|t|ve))?",Ir="(?:"+ci+"(?:D|LL|M|RE|S|T|VE))?",Jt=Xn+"?",jn="["+Rn+"]?",ia="(?:"+Ha+"(?:"+[Wa,fn,Fi].join("|")+")"+jn+Jt+")*",$a="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Zn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",aa=jn+Jt+ia,sa="(?:"+[ui,fn,Fi].join("|")+")"+aa,Yn="(?:"+[Wa+$n+"?",$n,fn,Fi,na].join("|")+")",Hs=RegExp(ci,"g"),$s=RegExp($n,"g"),Ur=RegExp(un+"(?="+un+")|"+Yn+aa,"g"),fi=RegExp([Nr+"?"+Tr+"+"+Pr+"(?="+[ki,Nr,"$"].join("|")+")",bn+"+"+Ir+"(?="+[ki,Nr+Ws,"$"].join("|")+")",Nr+"?"+Ws+"+"+Pr,Nr+"+"+Ir,Zn,$a,xn,sa].join("|"),"g"),Xs=RegExp("["+Ha+yr+za+Rn+"]"),js=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hi=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Xa=-1,ur={};ur[X]=ur[oe]=ur[te]=ur[Me]=ur[Te]=ur[q]=ur[Ee]=ur[Pe]=ur[tt]=!0,ur[ve]=ur[re]=ur[F]=ur[ge]=ur[H]=ur[Se]=ur[be]=ur[ye]=ur[ue]=ur[Ce]=ur[ie]=ur[De]=ur[Be]=ur[ze]=ur[qe]=!1;var fr={};fr[ve]=fr[re]=fr[F]=fr[H]=fr[ge]=fr[Se]=fr[X]=fr[oe]=fr[te]=fr[Me]=fr[Te]=fr[ue]=fr[Ce]=fr[ie]=fr[De]=fr[Be]=fr[ze]=fr[We]=fr[q]=fr[Ee]=fr[Pe]=fr[tt]=!0,fr[be]=fr[ye]=fr[qe]=!1;var ja={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Zs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ys={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ks={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Qs=parseFloat,qs=parseInt,Za=typeof commonjsGlobal$1=="object"&&commonjsGlobal$1&&commonjsGlobal$1.Object===Object&&commonjsGlobal$1,Js=typeof self=="object"&&self&&self.Object===Object&&self,wr=Za||Js||Function("return this")(),oa=t&&!t.nodeType&&t,Pn=oa&&!0&&o&&!o.nodeType&&o,Ya=Pn&&Pn.exports===oa,la=Ya&&Za.process,Gr=function(){try{var Ke=Pn&&Pn.require&&Pn.require("util").types;return Ke||la&&la.binding&&la.binding("util")}catch{}}(),Kn=Gr&&Gr.isArrayBuffer,Ka=Gr&&Gr.isDate,Qa=Gr&&Gr.isMap,qa=Gr&&Gr.isRegExp,di=Gr&&Gr.isSet,ca=Gr&&Gr.isTypedArray;function Mr(Ke,st,at){switch(at.length){case 0:return Ke.call(st);case 1:return Ke.call(st,at[0]);case 2:return Ke.call(st,at[0],at[1]);case 3:return Ke.call(st,at[0],at[1],at[2])}return Ke.apply(st,at)}function eo(Ke,st,at,wt){for(var Bt=-1,er=Ke==null?0:Ke.length;++Bt<er;){var _r=Ke[Bt];st(wt,_r,at(_r),Ke)}return wt}function Wr(Ke,st){for(var at=-1,wt=Ke==null?0:Ke.length;++at<wt&&st(Ke[at],at,Ke)!==!1;);return Ke}function to(Ke,st){for(var at=Ke==null?0:Ke.length;at--&&st(Ke[at],at,Ke)!==!1;);return Ke}function Ja(Ke,st){for(var at=-1,wt=Ke==null?0:Ke.length;++at<wt;)if(!st(Ke[at],at,Ke))return!1;return!0}function Hr(Ke,st){for(var at=-1,wt=Ke==null?0:Ke.length,Bt=0,er=[];++at<wt;){var _r=Ke[at];st(_r,at,Ke)&&(er[Bt++]=_r)}return er}function zi(Ke,st){var at=Ke==null?0:Ke.length;return!!at&&an(Ke,st,0)>-1}function Vi(Ke,st,at){for(var wt=-1,Bt=Ke==null?0:Ke.length;++wt<Bt;)if(at(st,Ke[wt]))return!0;return!1}function hr(Ke,st){for(var at=-1,wt=Ke==null?0:Ke.length,Bt=Array(wt);++at<wt;)Bt[at]=st(Ke[at],at,Ke);return Bt}function Sn(Ke,st){for(var at=-1,wt=st.length,Bt=Ke.length;++at<wt;)Ke[Bt+at]=st[at];return Ke}function ua(Ke,st,at,wt){var Bt=-1,er=Ke==null?0:Ke.length;for(wt&&er&&(at=Ke[++Bt]);++Bt<er;)at=st(at,Ke[Bt],Bt,Ke);return at}function ro(Ke,st,at,wt){var Bt=Ke==null?0:Ke.length;for(wt&&Bt&&(at=Ke[--Bt]);Bt--;)at=st(at,Ke[Bt],Bt,Ke);return at}function fa(Ke,st){for(var at=-1,wt=Ke==null?0:Ke.length;++at<wt;)if(st(Ke[at],at,Ke))return!0;return!1}var Ui=da("length");function no(Ke){return Ke.split("")}function ao(Ke){return Ke.match(gt)||[]}function es(Ke,st,at){var wt;return at(Ke,function(Bt,er,_r){if(st(Bt,er,_r))return wt=er,!1}),wt}function Gi(Ke,st,at,wt){for(var Bt=Ke.length,er=at+(wt?1:-1);wt?er--:++er<Bt;)if(st(Ke[er],er,Ke))return er;return-1}function an(Ke,st,at){return st===st?Hi(Ke,st,at):Gi(Ke,ts,at)}function ha(Ke,st,at,wt){for(var Bt=at-1,er=Ke.length;++Bt<er;)if(wt(Ke[Bt],st))return Bt;return-1}function ts(Ke){return Ke!==Ke}function rs(Ke,st){var at=Ke==null?0:Ke.length;return at?ma(Ke,st)/at:K}function da(Ke){return function(st){return st==null?e:st[Ke]}}function pa(Ke){return function(st){return Ke==null?e:Ke[st]}}function ns(Ke,st,at,wt,Bt){return Bt(Ke,function(er,_r,ar){at=wt?(wt=!1,er):st(at,er,_r,ar)}),at}function so(Ke,st){var at=Ke.length;for(Ke.sort(st);at--;)Ke[at]=Ke[at].value;return Ke}function ma(Ke,st){for(var at,wt=-1,Bt=Ke.length;++wt<Bt;){var er=st(Ke[wt]);er!==e&&(at=at===e?er:at+er)}return at}function va(Ke,st){for(var at=-1,wt=Array(Ke);++at<Ke;)wt[at]=st(at);return wt}function Wi(Ke,st){return hr(st,function(at){return[at,Ke[at]]})}function is(Ke){return Ke&&Ke.slice(0,kr(Ke)+1).replace(_e,"")}function Br(Ke){return function(st){return Ke(st)}}function Cn(Ke,st){return hr(st,function(at){return Ke[at]})}function Qn(Ke,st){return Ke.has(st)}function _a(Ke,st){for(var at=-1,wt=Ke.length;++at<wt&&an(st,Ke[at],0)>-1;);return at}function ga(Ke,st){for(var at=Ke.length;at--&&an(st,Ke[at],0)>-1;);return at}function ya(Ke,st){for(var at=Ke.length,wt=0;at--;)Ke[at]===st&&++wt;return wt}var as=pa(ja),oo=pa(Zs);function lo(Ke){return"\\"+Ks[Ke]}function co(Ke,st){return Ke==null?e:Ke[st]}function qn(Ke){return Xs.test(Ke)}function Sl(Ke){return js.test(Ke)}function pi(Ke){for(var st,at=[];!(st=Ke.next()).done;)at.push(st.value);return at}function xa(Ke){var st=-1,at=Array(Ke.size);return Ke.forEach(function(wt,Bt){at[++st]=[Bt,wt]}),at}function ba(Ke,st){return function(at){return Ke(st(at))}}function hn(Ke,st){for(var at=-1,wt=Ke.length,Bt=0,er=[];++at<wt;){var _r=Ke[at];(_r===st||_r===f)&&(Ke[at]=f,er[Bt++]=at)}return er}function mi(Ke){var st=-1,at=Array(Ke.size);return Ke.forEach(function(wt){at[++st]=wt}),at}function uo(Ke){var st=-1,at=Array(Ke.size);return Ke.forEach(function(wt){at[++st]=[wt,wt]}),at}function Hi(Ke,st,at){for(var wt=at-1,Bt=Ke.length;++wt<Bt;)if(Ke[wt]===st)return wt;return-1}function In(Ke,st,at){for(var wt=at+1;wt--;)if(Ke[wt]===st)return wt;return wt}function Jn(Ke){return qn(Ke)?os(Ke):Ui(Ke)}function Qr(Ke){return qn(Ke)?fo(Ke):no(Ke)}function kr(Ke){for(var st=Ke.length;st--&&Xe.test(Ke.charAt(st)););return st}var ss=pa(Ys);function os(Ke){for(var st=Ur.lastIndex=0;Ur.test(Ke);)++st;return st}function fo(Ke){return Ke.match(Ur)||[]}function ls(Ke){return Ke.match(fi)||[]}var $i=function Ke(st){st=st==null?wr:On.defaults(wr.Object(),st,On.pick(wr,hi));var at=st.Array,wt=st.Date,Bt=st.Error,er=st.Function,_r=st.Math,ar=st.Object,ei=st.RegExp,dn=st.String,Or=st.TypeError,vi=at.prototype,Sa=er.prototype,Dn=ar.prototype,_i=st["__core-js_shared__"],gi=Sa.toString,ir=Dn.hasOwnProperty,Xi=0,yi=function(){var b=/[^.]+$/.exec(_i&&_i.keys&&_i.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),xi=Dn.toString,cs=gi.call(ar),us=wr._,fs=ei("^"+gi.call(ir).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bi=Ya?st.Buffer:e,sn=st.Symbol,Si=st.Uint8Array,Ca=bi?bi.allocUnsafe:e,lr=ba(ar.getPrototypeOf,ar),Ea=ar.create,wa=Dn.propertyIsEnumerable,ji=vi.splice,hs=sn?sn.isConcatSpreadable:e,Zi=sn?sn.iterator:e,Nn=sn?sn.toStringTag:e,Ci=function(){try{var b=Oi(ar,"defineProperty");return b({},"",{}),b}catch{}}(),ho=st.clearTimeout!==wr.clearTimeout&&st.clearTimeout,Bn=wt&&wt.now!==wr.Date.now&&wt.now,ds=st.setTimeout!==wr.setTimeout&&st.setTimeout,Ei=_r.ceil,wi=_r.floor,Yi=ar.getOwnPropertySymbols,po=bi?bi.isBuffer:e,Ma=st.isFinite,Aa=vi.join,Ta=ba(ar.keys,ar),br=_r.max,Ar=_r.min,mo=wt.now,vo=st.parseInt,ps=_r.random,_o=vi.reverse,Ra=Oi(st,"DataView"),Mi=Oi(st,"Map"),La=Oi(st,"Promise"),ti=Oi(st,"Set"),Ai=Oi(st,"WeakMap"),Ti=Oi(ar,"create"),Ki=Ai&&new Ai,ri={},go=Di(Ra),yo=Di(Mi),pn=Di(La),xo=Di(ti),bo=Di(Ai),Ri=sn?sn.prototype:e,Li=Ri?Ri.valueOf:e,ms=Ri?Ri.toString:e;function pe(b){if(gr(b)&&!Ft(b)&&!(b instanceof Gt)){if(b instanceof $r)return b;if(ir.call(b,"__wrapped__"))return mc(b)}return new $r(b)}var En=function(){function b(){}return function(A){if(!vr(A))return{};if(Ea)return Ea(A);b.prototype=A;var N=new b;return b.prototype=e,N}}();function ni(){}function $r(b,A){this.__wrapped__=b,this.__actions__=[],this.__chain__=!!A,this.__index__=0,this.__values__=e}pe.templateSettings={escape:de,evaluate:se,interpolate:fe,variable:"",imports:{_:pe}},pe.prototype=ni.prototype,pe.prototype.constructor=pe,$r.prototype=En(ni.prototype),$r.prototype.constructor=$r;function Gt(b){this.__wrapped__=b,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=j,this.__views__=[]}function So(){var b=new Gt(this.__wrapped__);return b.__actions__=jr(this.__actions__),b.__dir__=this.__dir__,b.__filtered__=this.__filtered__,b.__iteratees__=jr(this.__iteratees__),b.__takeCount__=this.__takeCount__,b.__views__=jr(this.__views__),b}function Pi(){if(this.__filtered__){var b=new Gt(this);b.__dir__=-1,b.__filtered__=!0}else b=this.clone(),b.__dir__*=-1;return b}function Pa(){var b=this.__wrapped__.value(),A=this.__dir__,N=Ft(b),Y=A<0,ne=N?b.length:0,xe=Iu(0,ne,this.__views__),Ne=xe.start,Ge=xe.end,Qe=Ge-Ne,lt=Y?Ge:Ne-1,ct=this.__iteratees__,ut=ct.length,Ct=0,Lt=Ar(Qe,this.__takeCount__);if(!N||!Y&&ne==Qe&&Lt==Qe)return Fl(b,this.__actions__);var Dt=[];e:for(;Qe--&&Ct<Lt;){lt+=A;for(var Ut=-1,Nt=b[lt];++Ut<ut;){var Zt=ct[Ut],Qt=Zt.iteratee,tn=Zt.type,Vr=Qt(Nt);if(tn==z)Nt=Vr;else if(!Vr){if(tn==O)continue e;break e}}Dt[Ct++]=Nt}return Dt}Gt.prototype=En(ni.prototype),Gt.prototype.constructor=Gt;function kn(b){var A=-1,N=b==null?0:b.length;for(this.clear();++A<N;){var Y=b[A];this.set(Y[0],Y[1])}}function Co(){this.__data__=Ti?Ti(null):{},this.size=0}function Eo(b){var A=this.has(b)&&delete this.__data__[b];return this.size-=A?1:0,A}function wo(b){var A=this.__data__;if(Ti){var N=A[b];return N===c?e:N}return ir.call(A,b)?A[b]:e}function Mo(b){var A=this.__data__;return Ti?A[b]!==e:ir.call(A,b)}function Ao(b,A){var N=this.__data__;return this.size+=this.has(b)?0:1,N[b]=Ti&&A===e?c:A,this}kn.prototype.clear=Co,kn.prototype.delete=Eo,kn.prototype.get=wo,kn.prototype.has=Mo,kn.prototype.set=Ao;function mn(b){var A=-1,N=b==null?0:b.length;for(this.clear();++A<N;){var Y=b[A];this.set(Y[0],Y[1])}}function To(){this.__data__=[],this.size=0}function Ro(b){var A=this.__data__,N=Mt(A,b);if(N<0)return!1;var Y=A.length-1;return N==Y?A.pop():ji.call(A,N,1),--this.size,!0}function Lo(b){var A=this.__data__,N=Mt(A,b);return N<0?e:A[N][1]}function Po(b){return Mt(this.__data__,b)>-1}function Io(b,A){var N=this.__data__,Y=Mt(N,b);return Y<0?(++this.size,N.push([b,A])):N[Y][1]=A,this}mn.prototype.clear=To,mn.prototype.delete=Ro,mn.prototype.get=Lo,mn.prototype.has=Po,mn.prototype.set=Io;function vn(b){var A=-1,N=b==null?0:b.length;for(this.clear();++A<N;){var Y=b[A];this.set(Y[0],Y[1])}}function Oo(){this.size=0,this.__data__={hash:new kn,map:new(Mi||mn),string:new kn}}function Do(b){var A=Is(this,b).delete(b);return this.size-=A?1:0,A}function vs(b){return Is(this,b).get(b)}function _s(b){return Is(this,b).has(b)}function gs(b,A){var N=Is(this,b),Y=N.size;return N.set(b,A),this.size+=N.size==Y?0:1,this}vn.prototype.clear=Oo,vn.prototype.delete=Do,vn.prototype.get=vs,vn.prototype.has=_s,vn.prototype.set=gs;function wn(b){var A=-1,N=b==null?0:b.length;for(this.__data__=new vn;++A<N;)this.add(b[A])}function ys(b){return this.__data__.set(b,c),this}function xs(b){return this.__data__.has(b)}wn.prototype.add=wn.prototype.push=ys,wn.prototype.has=xs;function Xr(b){var A=this.__data__=new mn(b);this.size=A.size}function bs(){this.__data__=new mn,this.size=0}function Ss(b){var A=this.__data__,N=A.delete(b);return this.size=A.size,N}function No(b){return this.__data__.get(b)}function L(b){return this.__data__.has(b)}function J(b,A){var N=this.__data__;if(N instanceof mn){var Y=N.__data__;if(!Mi||Y.length<r-1)return Y.push([b,A]),this.size=++N.size,this;N=this.__data__=new vn(Y)}return N.set(b,A),this.size=N.size,this}Xr.prototype.clear=bs,Xr.prototype.delete=Ss,Xr.prototype.get=No,Xr.prototype.has=L,Xr.prototype.set=J;function V(b,A){var N=Ft(b),Y=!N&&Ni(b),ne=!N&&!Y&&li(b),xe=!N&&!Y&&!ne&&ea(b),Ne=N||Y||ne||xe,Ge=Ne?va(b.length,dn):[],Qe=Ge.length;for(var lt in b)(A||ir.call(b,lt))&&!(Ne&&(lt=="length"||ne&&(lt=="offset"||lt=="parent")||xe&&(lt=="buffer"||lt=="byteLength"||lt=="byteOffset")||Un(lt,Qe)))&&Ge.push(lt);return Ge}function me(b){var A=b.length;return A?b[Go(0,A-1)]:e}function Re(b,A){return Os(jr(b),Pt(A,0,b.length))}function we(b){return Os(jr(b))}function rt(b,A,N){(N!==e&&!_n(b[A],N)||N===e&&!(A in b))&&bt(b,A,N)}function Ze(b,A,N){var Y=b[A];(!(ir.call(b,A)&&_n(Y,N))||N===e&&!(A in b))&&bt(b,A,N)}function Mt(b,A){for(var N=b.length;N--;)if(_n(b[N][0],A))return N;return-1}function He(b,A,N,Y){return _t(b,function(ne,xe,Ne){A(Y,ne,N(ne),Ne)}),Y}function nt(b,A){return b&&An(A,Rr(A),b)}function tr(b,A){return b&&An(A,Yr(A),b)}function bt(b,A,N){A=="__proto__"&&Ci?Ci(b,A,{configurable:!0,enumerable:!0,value:N,writable:!0}):b[A]=N}function ft(b,A){for(var N=-1,Y=A.length,ne=at(Y),xe=b==null;++N<Y;)ne[N]=xe?e:dl(b,A[N]);return ne}function Pt(b,A,N){return b===b&&(N!==e&&(b=b<=N?b:N),A!==e&&(b=b>=A?b:A)),b}function Yt(b,A,N,Y,ne,xe){var Ne,Ge=A&p,Qe=A&g,lt=A&y;if(N&&(Ne=ne?N(b,Y,ne,xe):N(b)),Ne!==e)return Ne;if(!vr(b))return b;var ct=Ft(b);if(ct){if(Ne=Du(b),!Ge)return jr(b,Ne)}else{var ut=Dr(b),Ct=ut==ye||ut==ce;if(li(b))return Ul(b,Ge);if(ut==ie||ut==ve||Ct&&!ne){if(Ne=Qe||Ct?{}:sc(b),!Ge)return Qe?Cu(b,tr(Ne,b)):Su(b,nt(Ne,b))}else{if(!fr[ut])return ne?b:{};Ne=Nu(b,ut,Ge)}}xe||(xe=new Xr);var Lt=xe.get(b);if(Lt)return Lt;xe.set(b,Ne),Nc(b)?b.forEach(function(Nt){Ne.add(Yt(Nt,A,N,Nt,b,xe))}):Oc(b)&&b.forEach(function(Nt,Zt){Ne.set(Zt,Yt(Nt,A,N,Zt,b,xe))});var Dt=lt?Qe?Jo:qo:Qe?Yr:Rr,Ut=ct?e:Dt(b);return Wr(Ut||b,function(Nt,Zt){Ut&&(Zt=Nt,Nt=b[Zt]),Ze(Ne,Zt,Yt(Nt,A,N,Zt,b,xe))}),Ne}function Kt(b){var A=Rr(b);return function(N){return kt(N,b,A)}}function kt(b,A,N){var Y=N.length;if(b==null)return!Y;for(b=ar(b);Y--;){var ne=N[Y],xe=A[ne],Ne=b[ne];if(Ne===e&&!(ne in b)||!xe(Ne))return!1}return!0}function nr(b,A,N){if(typeof b!="function")throw new Or(s);return ka(function(){b.apply(e,N)},A)}function zt(b,A,N,Y){var ne=-1,xe=zi,Ne=!0,Ge=b.length,Qe=[],lt=A.length;if(!Ge)return Qe;N&&(A=hr(A,Br(N))),Y?(xe=Vi,Ne=!1):A.length>=r&&(xe=Qn,Ne=!1,A=new wn(A));e:for(;++ne<Ge;){var ct=b[ne],ut=N==null?ct:N(ct);if(ct=Y||ct!==0?ct:0,Ne&&ut===ut){for(var Ct=lt;Ct--;)if(A[Ct]===ut)continue e;Qe.push(ct)}else xe(A,ut,Y)||Qe.push(ct)}return Qe}var _t=Xl(qr),rr=Xl(ii,!0);function Er(b,A){var N=!0;return _t(b,function(Y,ne,xe){return N=!!A(Y,ne,xe),N}),N}function It(b,A,N){for(var Y=-1,ne=b.length;++Y<ne;){var xe=b[Y],Ne=A(xe);if(Ne!=null&&(Ge===e?Ne===Ne&&!en(Ne):N(Ne,Ge)))var Ge=Ne,Qe=xe}return Qe}function cr(b,A,N,Y){var ne=b.length;for(N=Vt(N),N<0&&(N=-N>ne?0:ne+N),Y=Y===e||Y>ne?ne:Vt(Y),Y<0&&(Y+=ne),Y=N>Y?0:kc(Y);N<Y;)b[N++]=A;return b}function jt(b,A){var N=[];return _t(b,function(Y,ne,xe){A(Y,ne,xe)&&N.push(Y)}),N}function Tt(b,A,N,Y,ne){var xe=-1,Ne=b.length;for(N||(N=ku),ne||(ne=[]);++xe<Ne;){var Ge=b[xe];A>0&&N(Ge)?A>1?Tt(Ge,A-1,N,Y,ne):Sn(ne,Ge):Y||(ne[ne.length]=Ge)}return ne}var Wt=jl(),Mn=jl(!0);function qr(b,A){return b&&Wt(b,A,Rr)}function ii(b,A){return b&&Mn(b,A,Rr)}function Fn(b,A){return Hr(A,function(N){return Gn(b[N])})}function Ii(b,A){A=si(A,b);for(var N=0,Y=A.length;b!=null&&N<Y;)b=b[Tn(A[N++])];return N&&N==Y?b:e}function Cl(b,A,N){var Y=A(b);return Ft(b)?Y:Sn(Y,N(b))}function Fr(b){return b==null?b===e?$e:Ve:Nn&&Nn in ar(b)?Pu(b):Hu(b)}function Bo(b,A){return b>A}function Kc(b,A){return b!=null&&ir.call(b,A)}function Qc(b,A){return b!=null&&A in ar(b)}function qc(b,A,N){return b>=Ar(A,N)&&b<br(A,N)}function ko(b,A,N){for(var Y=N?Vi:zi,ne=b[0].length,xe=b.length,Ne=xe,Ge=at(xe),Qe=1/0,lt=[];Ne--;){var ct=b[Ne];Ne&&A&&(ct=hr(ct,Br(A))),Qe=Ar(ct.length,Qe),Ge[Ne]=!N&&(A||ne>=120&&ct.length>=120)?new wn(Ne&&ct):e}ct=b[0];var ut=-1,Ct=Ge[0];e:for(;++ut<ne&&lt.length<Qe;){var Lt=ct[ut],Dt=A?A(Lt):Lt;if(Lt=N||Lt!==0?Lt:0,!(Ct?Qn(Ct,Dt):Y(lt,Dt,N))){for(Ne=xe;--Ne;){var Ut=Ge[Ne];if(!(Ut?Qn(Ut,Dt):Y(b[Ne],Dt,N)))continue e}Ct&&Ct.push(Dt),lt.push(Lt)}}return lt}function Jc(b,A,N,Y){return qr(b,function(ne,xe,Ne){A(Y,N(ne),xe,Ne)}),Y}function Ia(b,A,N){A=si(A,b),b=uc(b,A);var Y=b==null?b:b[Tn(ln(A))];return Y==null?e:Mr(Y,b,N)}function El(b){return gr(b)&&Fr(b)==ve}function eu(b){return gr(b)&&Fr(b)==F}function tu(b){return gr(b)&&Fr(b)==Se}function Oa(b,A,N,Y,ne){return b===A?!0:b==null||A==null||!gr(b)&&!gr(A)?b!==b&&A!==A:ru(b,A,N,Y,Oa,ne)}function ru(b,A,N,Y,ne,xe){var Ne=Ft(b),Ge=Ft(A),Qe=Ne?re:Dr(b),lt=Ge?re:Dr(A);Qe=Qe==ve?ie:Qe,lt=lt==ve?ie:lt;var ct=Qe==ie,ut=lt==ie,Ct=Qe==lt;if(Ct&&li(b)){if(!li(A))return!1;Ne=!0,ct=!1}if(Ct&&!ct)return xe||(xe=new Xr),Ne||ea(b)?nc(b,A,N,Y,ne,xe):Ru(b,A,Qe,N,Y,ne,xe);if(!(N&E)){var Lt=ct&&ir.call(b,"__wrapped__"),Dt=ut&&ir.call(A,"__wrapped__");if(Lt||Dt){var Ut=Lt?b.value():b,Nt=Dt?A.value():A;return xe||(xe=new Xr),ne(Ut,Nt,N,Y,xe)}}return Ct?(xe||(xe=new Xr),Lu(b,A,N,Y,ne,xe)):!1}function nu(b){return gr(b)&&Dr(b)==ue}function Fo(b,A,N,Y){var ne=N.length,xe=ne,Ne=!Y;if(b==null)return!xe;for(b=ar(b);ne--;){var Ge=N[ne];if(Ne&&Ge[2]?Ge[1]!==b[Ge[0]]:!(Ge[0]in b))return!1}for(;++ne<xe;){Ge=N[ne];var Qe=Ge[0],lt=b[Qe],ct=Ge[1];if(Ne&&Ge[2]){if(lt===e&&!(Qe in b))return!1}else{var ut=new Xr;if(Y)var Ct=Y(lt,ct,Qe,b,A,ut);if(!(Ct===e?Oa(ct,lt,E|h,Y,ut):Ct))return!1}}return!0}function wl(b){if(!vr(b)||zu(b))return!1;var A=Gn(b)?fs:xt;return A.test(Di(b))}function iu(b){return gr(b)&&Fr(b)==De}function au(b){return gr(b)&&Dr(b)==Be}function su(b){return gr(b)&&zs(b.length)&&!!ur[Fr(b)]}function Ml(b){return typeof b=="function"?b:b==null?Kr:typeof b=="object"?Ft(b)?Rl(b[0],b[1]):Tl(b):Zc(b)}function zo(b){if(!Ba(b))return Ta(b);var A=[];for(var N in ar(b))ir.call(b,N)&&N!="constructor"&&A.push(N);return A}function ou(b){if(!vr(b))return Wu(b);var A=Ba(b),N=[];for(var Y in b)Y=="constructor"&&(A||!ir.call(b,Y))||N.push(Y);return N}function Vo(b,A){return b<A}function Al(b,A){var N=-1,Y=Zr(b)?at(b.length):[];return _t(b,function(ne,xe,Ne){Y[++N]=A(ne,xe,Ne)}),Y}function Tl(b){var A=tl(b);return A.length==1&&A[0][2]?lc(A[0][0],A[0][1]):function(N){return N===b||Fo(N,b,A)}}function Rl(b,A){return nl(b)&&oc(A)?lc(Tn(b),A):function(N){var Y=dl(N,b);return Y===e&&Y===A?pl(N,b):Oa(A,Y,E|h)}}function Cs(b,A,N,Y,ne){b!==A&&Wt(A,function(xe,Ne){if(ne||(ne=new Xr),vr(xe))lu(b,A,Ne,N,Cs,Y,ne);else{var Ge=Y?Y(al(b,Ne),xe,Ne+"",b,A,ne):e;Ge===e&&(Ge=xe),rt(b,Ne,Ge)}},Yr)}function lu(b,A,N,Y,ne,xe,Ne){var Ge=al(b,N),Qe=al(A,N),lt=Ne.get(Qe);if(lt){rt(b,N,lt);return}var ct=xe?xe(Ge,Qe,N+"",b,A,Ne):e,ut=ct===e;if(ut){var Ct=Ft(Qe),Lt=!Ct&&li(Qe),Dt=!Ct&&!Lt&&ea(Qe);ct=Qe,Ct||Lt||Dt?Ft(Ge)?ct=Ge:Sr(Ge)?ct=jr(Ge):Lt?(ut=!1,ct=Ul(Qe,!0)):Dt?(ut=!1,ct=Gl(Qe,!0)):ct=[]:Fa(Qe)||Ni(Qe)?(ct=Ge,Ni(Ge)?ct=Fc(Ge):(!vr(Ge)||Gn(Ge))&&(ct=sc(Qe))):ut=!1}ut&&(Ne.set(Qe,ct),ne(ct,Qe,Y,xe,Ne),Ne.delete(Qe)),rt(b,N,ct)}function Ll(b,A){var N=b.length;if(N)return A+=A<0?N:0,Un(A,N)?b[A]:e}function Pl(b,A,N){A.length?A=hr(A,function(xe){return Ft(xe)?function(Ne){return Ii(Ne,xe.length===1?xe[0]:xe)}:xe}):A=[Kr];var Y=-1;A=hr(A,Br(Ot()));var ne=Al(b,function(xe,Ne,Ge){var Qe=hr(A,function(lt){return lt(xe)});return{criteria:Qe,index:++Y,value:xe}});return so(ne,function(xe,Ne){return bu(xe,Ne,N)})}function cu(b,A){return Il(b,A,function(N,Y){return pl(b,Y)})}function Il(b,A,N){for(var Y=-1,ne=A.length,xe={};++Y<ne;){var Ne=A[Y],Ge=Ii(b,Ne);N(Ge,Ne)&&Da(xe,si(Ne,b),Ge)}return xe}function uu(b){return function(A){return Ii(A,b)}}function Uo(b,A,N,Y){var ne=Y?ha:an,xe=-1,Ne=A.length,Ge=b;for(b===A&&(A=jr(A)),N&&(Ge=hr(b,Br(N)));++xe<Ne;)for(var Qe=0,lt=A[xe],ct=N?N(lt):lt;(Qe=ne(Ge,ct,Qe,Y))>-1;)Ge!==b&&ji.call(Ge,Qe,1),ji.call(b,Qe,1);return b}function Ol(b,A){for(var N=b?A.length:0,Y=N-1;N--;){var ne=A[N];if(N==Y||ne!==xe){var xe=ne;Un(ne)?ji.call(b,ne,1):$o(b,ne)}}return b}function Go(b,A){return b+wi(ps()*(A-b+1))}function fu(b,A,N,Y){for(var ne=-1,xe=br(Ei((A-b)/(N||1)),0),Ne=at(xe);xe--;)Ne[Y?xe:++ne]=b,b+=N;return Ne}function Wo(b,A){var N="";if(!b||A<1||A>$)return N;do A%2&&(N+=b),A=wi(A/2),A&&(b+=b);while(A);return N}function Ht(b,A){return sl(cc(b,A,Kr),b+"")}function hu(b){return me(ta(b))}function du(b,A){var N=ta(b);return Os(N,Pt(A,0,N.length))}function Da(b,A,N,Y){if(!vr(b))return b;A=si(A,b);for(var ne=-1,xe=A.length,Ne=xe-1,Ge=b;Ge!=null&&++ne<xe;){var Qe=Tn(A[ne]),lt=N;if(Qe==="__proto__"||Qe==="constructor"||Qe==="prototype")return b;if(ne!=Ne){var ct=Ge[Qe];lt=Y?Y(ct,Qe,Ge):e,lt===e&&(lt=vr(ct)?ct:Un(A[ne+1])?[]:{})}Ze(Ge,Qe,lt),Ge=Ge[Qe]}return b}var Dl=Ki?function(b,A){return Ki.set(b,A),b}:Kr,pu=Ci?function(b,A){return Ci(b,"toString",{configurable:!0,enumerable:!1,value:vl(A),writable:!0})}:Kr;function mu(b){return Os(ta(b))}function on(b,A,N){var Y=-1,ne=b.length;A<0&&(A=-A>ne?0:ne+A),N=N>ne?ne:N,N<0&&(N+=ne),ne=A>N?0:N-A>>>0,A>>>=0;for(var xe=at(ne);++Y<ne;)xe[Y]=b[Y+A];return xe}function vu(b,A){var N;return _t(b,function(Y,ne,xe){return N=A(Y,ne,xe),!N}),!!N}function Es(b,A,N){var Y=0,ne=b==null?Y:b.length;if(typeof A=="number"&&A===A&&ne<=le){for(;Y<ne;){var xe=Y+ne>>>1,Ne=b[xe];Ne!==null&&!en(Ne)&&(N?Ne<=A:Ne<A)?Y=xe+1:ne=xe}return ne}return Ho(b,A,Kr,N)}function Ho(b,A,N,Y){var ne=0,xe=b==null?0:b.length;if(xe===0)return 0;A=N(A);for(var Ne=A!==A,Ge=A===null,Qe=en(A),lt=A===e;ne<xe;){var ct=wi((ne+xe)/2),ut=N(b[ct]),Ct=ut!==e,Lt=ut===null,Dt=ut===ut,Ut=en(ut);if(Ne)var Nt=Y||Dt;else lt?Nt=Dt&&(Y||Ct):Ge?Nt=Dt&&Ct&&(Y||!Lt):Qe?Nt=Dt&&Ct&&!Lt&&(Y||!Ut):Lt||Ut?Nt=!1:Nt=Y?ut<=A:ut<A;Nt?ne=ct+1:xe=ct}return Ar(xe,Q)}function Nl(b,A){for(var N=-1,Y=b.length,ne=0,xe=[];++N<Y;){var Ne=b[N],Ge=A?A(Ne):Ne;if(!N||!_n(Ge,Qe)){var Qe=Ge;xe[ne++]=Ne===0?0:Ne}}return xe}function Bl(b){return typeof b=="number"?b:en(b)?K:+b}function Jr(b){if(typeof b=="string")return b;if(Ft(b))return hr(b,Jr)+"";if(en(b))return ms?ms.call(b):"";var A=b+"";return A=="0"&&1/b==-k?"-0":A}function ai(b,A,N){var Y=-1,ne=zi,xe=b.length,Ne=!0,Ge=[],Qe=Ge;if(N)Ne=!1,ne=Vi;else if(xe>=r){var lt=A?null:Au(b);if(lt)return mi(lt);Ne=!1,ne=Qn,Qe=new wn}else Qe=A?[]:Ge;e:for(;++Y<xe;){var ct=b[Y],ut=A?A(ct):ct;if(ct=N||ct!==0?ct:0,Ne&&ut===ut){for(var Ct=Qe.length;Ct--;)if(Qe[Ct]===ut)continue e;A&&Qe.push(ut),Ge.push(ct)}else ne(Qe,ut,N)||(Qe!==Ge&&Qe.push(ut),Ge.push(ct))}return Ge}function $o(b,A){return A=si(A,b),b=uc(b,A),b==null||delete b[Tn(ln(A))]}function kl(b,A,N,Y){return Da(b,A,N(Ii(b,A)),Y)}function ws(b,A,N,Y){for(var ne=b.length,xe=Y?ne:-1;(Y?xe--:++xe<ne)&&A(b[xe],xe,b););return N?on(b,Y?0:xe,Y?xe+1:ne):on(b,Y?xe+1:0,Y?ne:xe)}function Fl(b,A){var N=b;return N instanceof Gt&&(N=N.value()),ua(A,function(Y,ne){return ne.func.apply(ne.thisArg,Sn([Y],ne.args))},N)}function Xo(b,A,N){var Y=b.length;if(Y<2)return Y?ai(b[0]):[];for(var ne=-1,xe=at(Y);++ne<Y;)for(var Ne=b[ne],Ge=-1;++Ge<Y;)Ge!=ne&&(xe[ne]=zt(xe[ne]||Ne,b[Ge],A,N));return ai(Tt(xe,1),A,N)}function zl(b,A,N){for(var Y=-1,ne=b.length,xe=A.length,Ne={};++Y<ne;){var Ge=Y<xe?A[Y]:e;N(Ne,b[Y],Ge)}return Ne}function jo(b){return Sr(b)?b:[]}function Zo(b){return typeof b=="function"?b:Kr}function si(b,A){return Ft(b)?b:nl(b,A)?[b]:pc(sr(b))}var _u=Ht;function oi(b,A,N){var Y=b.length;return N=N===e?Y:N,!A&&N>=Y?b:on(b,A,N)}var Vl=ho||function(b){return wr.clearTimeout(b)};function Ul(b,A){if(A)return b.slice();var N=b.length,Y=Ca?Ca(N):new b.constructor(N);return b.copy(Y),Y}function Yo(b){var A=new b.constructor(b.byteLength);return new Si(A).set(new Si(b)),A}function gu(b,A){var N=A?Yo(b.buffer):b.buffer;return new b.constructor(N,b.byteOffset,b.byteLength)}function yu(b){var A=new b.constructor(b.source,St.exec(b));return A.lastIndex=b.lastIndex,A}function xu(b){return Li?ar(Li.call(b)):{}}function Gl(b,A){var N=A?Yo(b.buffer):b.buffer;return new b.constructor(N,b.byteOffset,b.length)}function Wl(b,A){if(b!==A){var N=b!==e,Y=b===null,ne=b===b,xe=en(b),Ne=A!==e,Ge=A===null,Qe=A===A,lt=en(A);if(!Ge&&!lt&&!xe&&b>A||xe&&Ne&&Qe&&!Ge&&!lt||Y&&Ne&&Qe||!N&&Qe||!ne)return 1;if(!Y&&!xe&&!lt&&b<A||lt&&N&&ne&&!Y&&!xe||Ge&&N&&ne||!Ne&&ne||!Qe)return-1}return 0}function bu(b,A,N){for(var Y=-1,ne=b.criteria,xe=A.criteria,Ne=ne.length,Ge=N.length;++Y<Ne;){var Qe=Wl(ne[Y],xe[Y]);if(Qe){if(Y>=Ge)return Qe;var lt=N[Y];return Qe*(lt=="desc"?-1:1)}}return b.index-A.index}function Hl(b,A,N,Y){for(var ne=-1,xe=b.length,Ne=N.length,Ge=-1,Qe=A.length,lt=br(xe-Ne,0),ct=at(Qe+lt),ut=!Y;++Ge<Qe;)ct[Ge]=A[Ge];for(;++ne<Ne;)(ut||ne<xe)&&(ct[N[ne]]=b[ne]);for(;lt--;)ct[Ge++]=b[ne++];return ct}function $l(b,A,N,Y){for(var ne=-1,xe=b.length,Ne=-1,Ge=N.length,Qe=-1,lt=A.length,ct=br(xe-Ge,0),ut=at(ct+lt),Ct=!Y;++ne<ct;)ut[ne]=b[ne];for(var Lt=ne;++Qe<lt;)ut[Lt+Qe]=A[Qe];for(;++Ne<Ge;)(Ct||ne<xe)&&(ut[Lt+N[Ne]]=b[ne++]);return ut}function jr(b,A){var N=-1,Y=b.length;for(A||(A=at(Y));++N<Y;)A[N]=b[N];return A}function An(b,A,N,Y){var ne=!N;N||(N={});for(var xe=-1,Ne=A.length;++xe<Ne;){var Ge=A[xe],Qe=Y?Y(N[Ge],b[Ge],Ge,N,b):e;Qe===e&&(Qe=b[Ge]),ne?bt(N,Ge,Qe):Ze(N,Ge,Qe)}return N}function Su(b,A){return An(b,rl(b),A)}function Cu(b,A){return An(b,ic(b),A)}function Ms(b,A){return function(N,Y){var ne=Ft(N)?eo:He,xe=A?A():{};return ne(N,b,Ot(Y,2),xe)}}function Qi(b){return Ht(function(A,N){var Y=-1,ne=N.length,xe=ne>1?N[ne-1]:e,Ne=ne>2?N[2]:e;for(xe=b.length>3&&typeof xe=="function"?(ne--,xe):e,Ne&&zr(N[0],N[1],Ne)&&(xe=ne<3?e:xe,ne=1),A=ar(A);++Y<ne;){var Ge=N[Y];Ge&&b(A,Ge,Y,xe)}return A})}function Xl(b,A){return function(N,Y){if(N==null)return N;if(!Zr(N))return b(N,Y);for(var ne=N.length,xe=A?ne:-1,Ne=ar(N);(A?xe--:++xe<ne)&&Y(Ne[xe],xe,Ne)!==!1;);return N}}function jl(b){return function(A,N,Y){for(var ne=-1,xe=ar(A),Ne=Y(A),Ge=Ne.length;Ge--;){var Qe=Ne[b?Ge:++ne];if(N(xe[Qe],Qe,xe)===!1)break}return A}}function Eu(b,A,N){var Y=A&v,ne=Na(b);function xe(){var Ne=this&&this!==wr&&this instanceof xe?ne:b;return Ne.apply(Y?N:this,arguments)}return xe}function Zl(b){return function(A){A=sr(A);var N=qn(A)?Qr(A):e,Y=N?N[0]:A.charAt(0),ne=N?oi(N,1).join(""):A.slice(1);return Y[b]()+ne}}function qi(b){return function(A){return ua(Xc($c(A).replace(Hs,"")),b,"")}}function Na(b){return function(){var A=arguments;switch(A.length){case 0:return new b;case 1:return new b(A[0]);case 2:return new b(A[0],A[1]);case 3:return new b(A[0],A[1],A[2]);case 4:return new b(A[0],A[1],A[2],A[3]);case 5:return new b(A[0],A[1],A[2],A[3],A[4]);case 6:return new b(A[0],A[1],A[2],A[3],A[4],A[5]);case 7:return new b(A[0],A[1],A[2],A[3],A[4],A[5],A[6])}var N=En(b.prototype),Y=b.apply(N,A);return vr(Y)?Y:N}}function wu(b,A,N){var Y=Na(b);function ne(){for(var xe=arguments.length,Ne=at(xe),Ge=xe,Qe=Ji(ne);Ge--;)Ne[Ge]=arguments[Ge];var lt=xe<3&&Ne[0]!==Qe&&Ne[xe-1]!==Qe?[]:hn(Ne,Qe);if(xe-=lt.length,xe<N)return Jl(b,A,As,ne.placeholder,e,Ne,lt,e,e,N-xe);var ct=this&&this!==wr&&this instanceof ne?Y:b;return Mr(ct,this,Ne)}return ne}function Yl(b){return function(A,N,Y){var ne=ar(A);if(!Zr(A)){var xe=Ot(N,3);A=Rr(A),N=function(Ge){return xe(ne[Ge],Ge,ne)}}var Ne=b(A,N,Y);return Ne>-1?ne[xe?A[Ne]:Ne]:e}}function Kl(b){return Vn(function(A){var N=A.length,Y=N,ne=$r.prototype.thru;for(b&&A.reverse();Y--;){var xe=A[Y];if(typeof xe!="function")throw new Or(s);if(ne&&!Ne&&Ps(xe)=="wrapper")var Ne=new $r([],!0)}for(Y=Ne?Y:N;++Y<N;){xe=A[Y];var Ge=Ps(xe),Qe=Ge=="wrapper"?el(xe):e;Qe&&il(Qe[0])&&Qe[1]==(T|w|S|R)&&!Qe[4].length&&Qe[9]==1?Ne=Ne[Ps(Qe[0])].apply(Ne,Qe[3]):Ne=xe.length==1&&il(xe)?Ne[Ge]():Ne.thru(xe)}return function(){var lt=arguments,ct=lt[0];if(Ne&&lt.length==1&&Ft(ct))return Ne.plant(ct).value();for(var ut=0,Ct=N?A[ut].apply(this,lt):ct;++ut<N;)Ct=A[ut].call(this,Ct);return Ct}})}function As(b,A,N,Y,ne,xe,Ne,Ge,Qe,lt){var ct=A&T,ut=A&v,Ct=A&C,Lt=A&(w|_),Dt=A&P,Ut=Ct?e:Na(b);function Nt(){for(var Zt=arguments.length,Qt=at(Zt),tn=Zt;tn--;)Qt[tn]=arguments[tn];if(Lt)var Vr=Ji(Nt),rn=ya(Qt,Vr);if(Y&&(Qt=Hl(Qt,Y,ne,Lt)),xe&&(Qt=$l(Qt,xe,Ne,Lt)),Zt-=rn,Lt&&Zt<lt){var Cr=hn(Qt,Vr);return Jl(b,A,As,Nt.placeholder,N,Qt,Cr,Ge,Qe,lt-Zt)}var gn=ut?N:this,Hn=Ct?gn[b]:b;return Zt=Qt.length,Ge?Qt=$u(Qt,Ge):Dt&&Zt>1&&Qt.reverse(),ct&&Qe<Zt&&(Qt.length=Qe),this&&this!==wr&&this instanceof Nt&&(Hn=Ut||Na(Hn)),Hn.apply(gn,Qt)}return Nt}function Ql(b,A){return function(N,Y){return Jc(N,b,A(Y),{})}}function Ts(b,A){return function(N,Y){var ne;if(N===e&&Y===e)return A;if(N!==e&&(ne=N),Y!==e){if(ne===e)return Y;typeof N=="string"||typeof Y=="string"?(N=Jr(N),Y=Jr(Y)):(N=Bl(N),Y=Bl(Y)),ne=b(N,Y)}return ne}}function Ko(b){return Vn(function(A){return A=hr(A,Br(Ot())),Ht(function(N){var Y=this;return b(A,function(ne){return Mr(ne,Y,N)})})})}function Rs(b,A){A=A===e?" ":Jr(A);var N=A.length;if(N<2)return N?Wo(A,b):A;var Y=Wo(A,Ei(b/Jn(A)));return qn(A)?oi(Qr(Y),0,b).join(""):Y.slice(0,b)}function Mu(b,A,N,Y){var ne=A&v,xe=Na(b);function Ne(){for(var Ge=-1,Qe=arguments.length,lt=-1,ct=Y.length,ut=at(ct+Qe),Ct=this&&this!==wr&&this instanceof Ne?xe:b;++lt<ct;)ut[lt]=Y[lt];for(;Qe--;)ut[lt++]=arguments[++Ge];return Mr(Ct,ne?N:this,ut)}return Ne}function ql(b){return function(A,N,Y){return Y&&typeof Y!="number"&&zr(A,N,Y)&&(N=Y=e),A=Wn(A),N===e?(N=A,A=0):N=Wn(N),Y=Y===e?A<N?1:-1:Wn(Y),fu(A,N,Y,b)}}function Ls(b){return function(A,N){return typeof A=="string"&&typeof N=="string"||(A=cn(A),N=cn(N)),b(A,N)}}function Jl(b,A,N,Y,ne,xe,Ne,Ge,Qe,lt){var ct=A&w,ut=ct?Ne:e,Ct=ct?e:Ne,Lt=ct?xe:e,Dt=ct?e:xe;A|=ct?S:M,A&=~(ct?M:S),A&x||(A&=~(v|C));var Ut=[b,A,ne,Lt,ut,Dt,Ct,Ge,Qe,lt],Nt=N.apply(e,Ut);return il(b)&&fc(Nt,Ut),Nt.placeholder=Y,hc(Nt,b,A)}function Qo(b){var A=_r[b];return function(N,Y){if(N=cn(N),Y=Y==null?0:Ar(Vt(Y),292),Y&&Ma(N)){var ne=(sr(N)+"e").split("e"),xe=A(ne[0]+"e"+(+ne[1]+Y));return ne=(sr(xe)+"e").split("e"),+(ne[0]+"e"+(+ne[1]-Y))}return A(N)}}var Au=ti&&1/mi(new ti([,-0]))[1]==k?function(b){return new ti(b)}:yl;function ec(b){return function(A){var N=Dr(A);return N==ue?xa(A):N==Be?uo(A):Wi(A,b(A))}}function zn(b,A,N,Y,ne,xe,Ne,Ge){var Qe=A&C;if(!Qe&&typeof b!="function")throw new Or(s);var lt=Y?Y.length:0;if(lt||(A&=~(S|M),Y=ne=e),Ne=Ne===e?Ne:br(Vt(Ne),0),Ge=Ge===e?Ge:Vt(Ge),lt-=ne?ne.length:0,A&M){var ct=Y,ut=ne;Y=ne=e}var Ct=Qe?e:el(b),Lt=[b,A,N,Y,ne,ct,ut,xe,Ne,Ge];if(Ct&&Gu(Lt,Ct),b=Lt[0],A=Lt[1],N=Lt[2],Y=Lt[3],ne=Lt[4],Ge=Lt[9]=Lt[9]===e?Qe?0:b.length:br(Lt[9]-lt,0),!Ge&&A&(w|_)&&(A&=~(w|_)),!A||A==v)var Dt=Eu(b,A,N);else A==w||A==_?Dt=wu(b,A,Ge):(A==S||A==(v|S))&&!ne.length?Dt=Mu(b,A,N,Y):Dt=As.apply(e,Lt);var Ut=Ct?Dl:fc;return hc(Ut(Dt,Lt),b,A)}function tc(b,A,N,Y){return b===e||_n(b,Dn[N])&&!ir.call(Y,N)?A:b}function rc(b,A,N,Y,ne,xe){return vr(b)&&vr(A)&&(xe.set(A,b),Cs(b,A,e,rc,xe),xe.delete(A)),b}function Tu(b){return Fa(b)?e:b}function nc(b,A,N,Y,ne,xe){var Ne=N&E,Ge=b.length,Qe=A.length;if(Ge!=Qe&&!(Ne&&Qe>Ge))return!1;var lt=xe.get(b),ct=xe.get(A);if(lt&&ct)return lt==A&&ct==b;var ut=-1,Ct=!0,Lt=N&h?new wn:e;for(xe.set(b,A),xe.set(A,b);++ut<Ge;){var Dt=b[ut],Ut=A[ut];if(Y)var Nt=Ne?Y(Ut,Dt,ut,A,b,xe):Y(Dt,Ut,ut,b,A,xe);if(Nt!==e){if(Nt)continue;Ct=!1;break}if(Lt){if(!fa(A,function(Zt,Qt){if(!Qn(Lt,Qt)&&(Dt===Zt||ne(Dt,Zt,N,Y,xe)))return Lt.push(Qt)})){Ct=!1;break}}else if(!(Dt===Ut||ne(Dt,Ut,N,Y,xe))){Ct=!1;break}}return xe.delete(b),xe.delete(A),Ct}function Ru(b,A,N,Y,ne,xe,Ne){switch(N){case H:if(b.byteLength!=A.byteLength||b.byteOffset!=A.byteOffset)return!1;b=b.buffer,A=A.buffer;case F:return!(b.byteLength!=A.byteLength||!xe(new Si(b),new Si(A)));case ge:case Se:case Ce:return _n(+b,+A);case be:return b.name==A.name&&b.message==A.message;case De:case ze:return b==A+"";case ue:var Ge=xa;case Be:var Qe=Y&E;if(Ge||(Ge=mi),b.size!=A.size&&!Qe)return!1;var lt=Ne.get(b);if(lt)return lt==A;Y|=h,Ne.set(b,A);var ct=nc(Ge(b),Ge(A),Y,ne,xe,Ne);return Ne.delete(b),ct;case We:if(Li)return Li.call(b)==Li.call(A)}return!1}function Lu(b,A,N,Y,ne,xe){var Ne=N&E,Ge=qo(b),Qe=Ge.length,lt=qo(A),ct=lt.length;if(Qe!=ct&&!Ne)return!1;for(var ut=Qe;ut--;){var Ct=Ge[ut];if(!(Ne?Ct in A:ir.call(A,Ct)))return!1}var Lt=xe.get(b),Dt=xe.get(A);if(Lt&&Dt)return Lt==A&&Dt==b;var Ut=!0;xe.set(b,A),xe.set(A,b);for(var Nt=Ne;++ut<Qe;){Ct=Ge[ut];var Zt=b[Ct],Qt=A[Ct];if(Y)var tn=Ne?Y(Qt,Zt,Ct,A,b,xe):Y(Zt,Qt,Ct,b,A,xe);if(!(tn===e?Zt===Qt||ne(Zt,Qt,N,Y,xe):tn)){Ut=!1;break}Nt||(Nt=Ct=="constructor")}if(Ut&&!Nt){var Vr=b.constructor,rn=A.constructor;Vr!=rn&&"constructor"in b&&"constructor"in A&&!(typeof Vr=="function"&&Vr instanceof Vr&&typeof rn=="function"&&rn instanceof rn)&&(Ut=!1)}return xe.delete(b),xe.delete(A),Ut}function Vn(b){return sl(cc(b,e,gc),b+"")}function qo(b){return Cl(b,Rr,rl)}function Jo(b){return Cl(b,Yr,ic)}var el=Ki?function(b){return Ki.get(b)}:yl;function Ps(b){for(var A=b.name+"",N=ri[A],Y=ir.call(ri,A)?N.length:0;Y--;){var ne=N[Y],xe=ne.func;if(xe==null||xe==b)return ne.name}return A}function Ji(b){var A=ir.call(pe,"placeholder")?pe:b;return A.placeholder}function Ot(){var b=pe.iteratee||_l;return b=b===_l?Ml:b,arguments.length?b(arguments[0],arguments[1]):b}function Is(b,A){var N=b.__data__;return Fu(A)?N[typeof A=="string"?"string":"hash"]:N.map}function tl(b){for(var A=Rr(b),N=A.length;N--;){var Y=A[N],ne=b[Y];A[N]=[Y,ne,oc(ne)]}return A}function Oi(b,A){var N=co(b,A);return wl(N)?N:e}function Pu(b){var A=ir.call(b,Nn),N=b[Nn];try{b[Nn]=e;var Y=!0}catch{}var ne=xi.call(b);return Y&&(A?b[Nn]=N:delete b[Nn]),ne}var rl=Yi?function(b){return b==null?[]:(b=ar(b),Hr(Yi(b),function(A){return wa.call(b,A)}))}:xl,ic=Yi?function(b){for(var A=[];b;)Sn(A,rl(b)),b=lr(b);return A}:xl,Dr=Fr;(Ra&&Dr(new Ra(new ArrayBuffer(1)))!=H||Mi&&Dr(new Mi)!=ue||La&&Dr(La.resolve())!=ae||ti&&Dr(new ti)!=Be||Ai&&Dr(new Ai)!=qe)&&(Dr=function(b){var A=Fr(b),N=A==ie?b.constructor:e,Y=N?Di(N):"";if(Y)switch(Y){case go:return H;case yo:return ue;case pn:return ae;case xo:return Be;case bo:return qe}return A});function Iu(b,A,N){for(var Y=-1,ne=N.length;++Y<ne;){var xe=N[Y],Ne=xe.size;switch(xe.type){case"drop":b+=Ne;break;case"dropRight":A-=Ne;break;case"take":A=Ar(A,b+Ne);break;case"takeRight":b=br(b,A-Ne);break}}return{start:b,end:A}}function Ou(b){var A=b.match(Ye);return A?A[1].split(ot):[]}function ac(b,A,N){A=si(A,b);for(var Y=-1,ne=A.length,xe=!1;++Y<ne;){var Ne=Tn(A[Y]);if(!(xe=b!=null&&N(b,Ne)))break;b=b[Ne]}return xe||++Y!=ne?xe:(ne=b==null?0:b.length,!!ne&&zs(ne)&&Un(Ne,ne)&&(Ft(b)||Ni(b)))}function Du(b){var A=b.length,N=new b.constructor(A);return A&&typeof b[0]=="string"&&ir.call(b,"index")&&(N.index=b.index,N.input=b.input),N}function sc(b){return typeof b.constructor=="function"&&!Ba(b)?En(lr(b)):{}}function Nu(b,A,N){var Y=b.constructor;switch(A){case F:return Yo(b);case ge:case Se:return new Y(+b);case H:return gu(b,N);case X:case oe:case te:case Me:case Te:case q:case Ee:case Pe:case tt:return Gl(b,N);case ue:return new Y;case Ce:case ze:return new Y(b);case De:return yu(b);case Be:return new Y;case We:return xu(b)}}function Bu(b,A){var N=A.length;if(!N)return b;var Y=N-1;return A[Y]=(N>1?"& ":"")+A[Y],A=A.join(N>2?", ":" "),b.replace(Ue,`{
/* [wrapped with `+A+`] */
`)}function ku(b){return Ft(b)||Ni(b)||!!(hs&&b&&b[hs])}function Un(b,A){var N=typeof b;return A=A??$,!!A&&(N=="number"||N!="symbol"&&$t.test(b))&&b>-1&&b%1==0&&b<A}function zr(b,A,N){if(!vr(N))return!1;var Y=typeof A;return(Y=="number"?Zr(N)&&Un(A,N.length):Y=="string"&&A in N)?_n(N[A],b):!1}function nl(b,A){if(Ft(b))return!1;var N=typeof b;return N=="number"||N=="symbol"||N=="boolean"||b==null||en(b)?!0:ht.test(b)||!je.test(b)||A!=null&&b in ar(A)}function Fu(b){var A=typeof b;return A=="string"||A=="number"||A=="symbol"||A=="boolean"?b!=="__proto__":b===null}function il(b){var A=Ps(b),N=pe[A];if(typeof N!="function"||!(A in Gt.prototype))return!1;if(b===N)return!0;var Y=el(N);return!!Y&&b===Y[0]}function zu(b){return!!yi&&yi in b}var Vu=_i?Gn:bl;function Ba(b){var A=b&&b.constructor,N=typeof A=="function"&&A.prototype||Dn;return b===N}function oc(b){return b===b&&!vr(b)}function lc(b,A){return function(N){return N==null?!1:N[b]===A&&(A!==e||b in ar(N))}}function Uu(b){var A=ks(b,function(Y){return N.size===u&&N.clear(),Y}),N=A.cache;return A}function Gu(b,A){var N=b[1],Y=A[1],ne=N|Y,xe=ne<(v|C|T),Ne=Y==T&&N==w||Y==T&&N==R&&b[7].length<=A[8]||Y==(T|R)&&A[7].length<=A[8]&&N==w;if(!(xe||Ne))return b;Y&v&&(b[2]=A[2],ne|=N&v?0:x);var Ge=A[3];if(Ge){var Qe=b[3];b[3]=Qe?Hl(Qe,Ge,A[4]):Ge,b[4]=Qe?hn(b[3],f):A[4]}return Ge=A[5],Ge&&(Qe=b[5],b[5]=Qe?$l(Qe,Ge,A[6]):Ge,b[6]=Qe?hn(b[5],f):A[6]),Ge=A[7],Ge&&(b[7]=Ge),Y&T&&(b[8]=b[8]==null?A[8]:Ar(b[8],A[8])),b[9]==null&&(b[9]=A[9]),b[0]=A[0],b[1]=ne,b}function Wu(b){var A=[];if(b!=null)for(var N in ar(b))A.push(N);return A}function Hu(b){return xi.call(b)}function cc(b,A,N){return A=br(A===e?b.length-1:A,0),function(){for(var Y=arguments,ne=-1,xe=br(Y.length-A,0),Ne=at(xe);++ne<xe;)Ne[ne]=Y[A+ne];ne=-1;for(var Ge=at(A+1);++ne<A;)Ge[ne]=Y[ne];return Ge[A]=N(Ne),Mr(b,this,Ge)}}function uc(b,A){return A.length<2?b:Ii(b,on(A,0,-1))}function $u(b,A){for(var N=b.length,Y=Ar(A.length,N),ne=jr(b);Y--;){var xe=A[Y];b[Y]=Un(xe,N)?ne[xe]:e}return b}function al(b,A){if(!(A==="constructor"&&typeof b[A]=="function")&&A!="__proto__")return b[A]}var fc=dc(Dl),ka=ds||function(b,A){return wr.setTimeout(b,A)},sl=dc(pu);function hc(b,A,N){var Y=A+"";return sl(b,Bu(Y,Xu(Ou(Y),N)))}function dc(b){var A=0,N=0;return function(){var Y=mo(),ne=D-(Y-N);if(N=Y,ne>0){if(++A>=W)return arguments[0]}else A=0;return b.apply(e,arguments)}}function Os(b,A){var N=-1,Y=b.length,ne=Y-1;for(A=A===e?Y:A;++N<A;){var xe=Go(N,ne),Ne=b[xe];b[xe]=b[N],b[N]=Ne}return b.length=A,b}var pc=Uu(function(b){var A=[];return b.charCodeAt(0)===46&&A.push(""),b.replace(pt,function(N,Y,ne,xe){A.push(ne?xe.replace(yt,"$1"):Y||N)}),A});function Tn(b){if(typeof b=="string"||en(b))return b;var A=b+"";return A=="0"&&1/b==-k?"-0":A}function Di(b){if(b!=null){try{return gi.call(b)}catch{}try{return b+""}catch{}}return""}function Xu(b,A){return Wr(he,function(N){var Y="_."+N[0];A&N[1]&&!zi(b,Y)&&b.push(Y)}),b.sort()}function mc(b){if(b instanceof Gt)return b.clone();var A=new $r(b.__wrapped__,b.__chain__);return A.__actions__=jr(b.__actions__),A.__index__=b.__index__,A.__values__=b.__values__,A}function ju(b,A,N){(N?zr(b,A,N):A===e)?A=1:A=br(Vt(A),0);var Y=b==null?0:b.length;if(!Y||A<1)return[];for(var ne=0,xe=0,Ne=at(Ei(Y/A));ne<Y;)Ne[xe++]=on(b,ne,ne+=A);return Ne}function Zu(b){for(var A=-1,N=b==null?0:b.length,Y=0,ne=[];++A<N;){var xe=b[A];xe&&(ne[Y++]=xe)}return ne}function Yu(){var b=arguments.length;if(!b)return[];for(var A=at(b-1),N=arguments[0],Y=b;Y--;)A[Y-1]=arguments[Y];return Sn(Ft(N)?jr(N):[N],Tt(A,1))}var Ku=Ht(function(b,A){return Sr(b)?zt(b,Tt(A,1,Sr,!0)):[]}),Qu=Ht(function(b,A){var N=ln(A);return Sr(N)&&(N=e),Sr(b)?zt(b,Tt(A,1,Sr,!0),Ot(N,2)):[]}),qu=Ht(function(b,A){var N=ln(A);return Sr(N)&&(N=e),Sr(b)?zt(b,Tt(A,1,Sr,!0),e,N):[]});function Ju(b,A,N){var Y=b==null?0:b.length;return Y?(A=N||A===e?1:Vt(A),on(b,A<0?0:A,Y)):[]}function ef(b,A,N){var Y=b==null?0:b.length;return Y?(A=N||A===e?1:Vt(A),A=Y-A,on(b,0,A<0?0:A)):[]}function tf(b,A){return b&&b.length?ws(b,Ot(A,3),!0,!0):[]}function rf(b,A){return b&&b.length?ws(b,Ot(A,3),!0):[]}function nf(b,A,N,Y){var ne=b==null?0:b.length;return ne?(N&&typeof N!="number"&&zr(b,A,N)&&(N=0,Y=ne),cr(b,A,N,Y)):[]}function vc(b,A,N){var Y=b==null?0:b.length;if(!Y)return-1;var ne=N==null?0:Vt(N);return ne<0&&(ne=br(Y+ne,0)),Gi(b,Ot(A,3),ne)}function _c(b,A,N){var Y=b==null?0:b.length;if(!Y)return-1;var ne=Y-1;return N!==e&&(ne=Vt(N),ne=N<0?br(Y+ne,0):Ar(ne,Y-1)),Gi(b,Ot(A,3),ne,!0)}function gc(b){var A=b==null?0:b.length;return A?Tt(b,1):[]}function af(b){var A=b==null?0:b.length;return A?Tt(b,k):[]}function sf(b,A){var N=b==null?0:b.length;return N?(A=A===e?1:Vt(A),Tt(b,A)):[]}function of(b){for(var A=-1,N=b==null?0:b.length,Y={};++A<N;){var ne=b[A];Y[ne[0]]=ne[1]}return Y}function yc(b){return b&&b.length?b[0]:e}function lf(b,A,N){var Y=b==null?0:b.length;if(!Y)return-1;var ne=N==null?0:Vt(N);return ne<0&&(ne=br(Y+ne,0)),an(b,A,ne)}function cf(b){var A=b==null?0:b.length;return A?on(b,0,-1):[]}var uf=Ht(function(b){var A=hr(b,jo);return A.length&&A[0]===b[0]?ko(A):[]}),ff=Ht(function(b){var A=ln(b),N=hr(b,jo);return A===ln(N)?A=e:N.pop(),N.length&&N[0]===b[0]?ko(N,Ot(A,2)):[]}),hf=Ht(function(b){var A=ln(b),N=hr(b,jo);return A=typeof A=="function"?A:e,A&&N.pop(),N.length&&N[0]===b[0]?ko(N,e,A):[]});function df(b,A){return b==null?"":Aa.call(b,A)}function ln(b){var A=b==null?0:b.length;return A?b[A-1]:e}function pf(b,A,N){var Y=b==null?0:b.length;if(!Y)return-1;var ne=Y;return N!==e&&(ne=Vt(N),ne=ne<0?br(Y+ne,0):Ar(ne,Y-1)),A===A?In(b,A,ne):Gi(b,ts,ne,!0)}function mf(b,A){return b&&b.length?Ll(b,Vt(A)):e}var vf=Ht(xc);function xc(b,A){return b&&b.length&&A&&A.length?Uo(b,A):b}function _f(b,A,N){return b&&b.length&&A&&A.length?Uo(b,A,Ot(N,2)):b}function gf(b,A,N){return b&&b.length&&A&&A.length?Uo(b,A,e,N):b}var yf=Vn(function(b,A){var N=b==null?0:b.length,Y=ft(b,A);return Ol(b,hr(A,function(ne){return Un(ne,N)?+ne:ne}).sort(Wl)),Y});function xf(b,A){var N=[];if(!(b&&b.length))return N;var Y=-1,ne=[],xe=b.length;for(A=Ot(A,3);++Y<xe;){var Ne=b[Y];A(Ne,Y,b)&&(N.push(Ne),ne.push(Y))}return Ol(b,ne),N}function ol(b){return b==null?b:_o.call(b)}function bf(b,A,N){var Y=b==null?0:b.length;return Y?(N&&typeof N!="number"&&zr(b,A,N)?(A=0,N=Y):(A=A==null?0:Vt(A),N=N===e?Y:Vt(N)),on(b,A,N)):[]}function Sf(b,A){return Es(b,A)}function Cf(b,A,N){return Ho(b,A,Ot(N,2))}function Ef(b,A){var N=b==null?0:b.length;if(N){var Y=Es(b,A);if(Y<N&&_n(b[Y],A))return Y}return-1}function wf(b,A){return Es(b,A,!0)}function Mf(b,A,N){return Ho(b,A,Ot(N,2),!0)}function Af(b,A){var N=b==null?0:b.length;if(N){var Y=Es(b,A,!0)-1;if(_n(b[Y],A))return Y}return-1}function Tf(b){return b&&b.length?Nl(b):[]}function Rf(b,A){return b&&b.length?Nl(b,Ot(A,2)):[]}function Lf(b){var A=b==null?0:b.length;return A?on(b,1,A):[]}function Pf(b,A,N){return b&&b.length?(A=N||A===e?1:Vt(A),on(b,0,A<0?0:A)):[]}function If(b,A,N){var Y=b==null?0:b.length;return Y?(A=N||A===e?1:Vt(A),A=Y-A,on(b,A<0?0:A,Y)):[]}function Of(b,A){return b&&b.length?ws(b,Ot(A,3),!1,!0):[]}function Df(b,A){return b&&b.length?ws(b,Ot(A,3)):[]}var Nf=Ht(function(b){return ai(Tt(b,1,Sr,!0))}),Bf=Ht(function(b){var A=ln(b);return Sr(A)&&(A=e),ai(Tt(b,1,Sr,!0),Ot(A,2))}),kf=Ht(function(b){var A=ln(b);return A=typeof A=="function"?A:e,ai(Tt(b,1,Sr,!0),e,A)});function Ff(b){return b&&b.length?ai(b):[]}function zf(b,A){return b&&b.length?ai(b,Ot(A,2)):[]}function Vf(b,A){return A=typeof A=="function"?A:e,b&&b.length?ai(b,e,A):[]}function ll(b){if(!(b&&b.length))return[];var A=0;return b=Hr(b,function(N){if(Sr(N))return A=br(N.length,A),!0}),va(A,function(N){return hr(b,da(N))})}function bc(b,A){if(!(b&&b.length))return[];var N=ll(b);return A==null?N:hr(N,function(Y){return Mr(A,e,Y)})}var Uf=Ht(function(b,A){return Sr(b)?zt(b,A):[]}),Gf=Ht(function(b){return Xo(Hr(b,Sr))}),Wf=Ht(function(b){var A=ln(b);return Sr(A)&&(A=e),Xo(Hr(b,Sr),Ot(A,2))}),Hf=Ht(function(b){var A=ln(b);return A=typeof A=="function"?A:e,Xo(Hr(b,Sr),e,A)}),$f=Ht(ll);function Xf(b,A){return zl(b||[],A||[],Ze)}function jf(b,A){return zl(b||[],A||[],Da)}var Zf=Ht(function(b){var A=b.length,N=A>1?b[A-1]:e;return N=typeof N=="function"?(b.pop(),N):e,bc(b,N)});function Sc(b){var A=pe(b);return A.__chain__=!0,A}function Yf(b,A){return A(b),b}function Ds(b,A){return A(b)}var Kf=Vn(function(b){var A=b.length,N=A?b[0]:0,Y=this.__wrapped__,ne=function(xe){return ft(xe,b)};return A>1||this.__actions__.length||!(Y instanceof Gt)||!Un(N)?this.thru(ne):(Y=Y.slice(N,+N+(A?1:0)),Y.__actions__.push({func:Ds,args:[ne],thisArg:e}),new $r(Y,this.__chain__).thru(function(xe){return A&&!xe.length&&xe.push(e),xe}))});function Qf(){return Sc(this)}function qf(){return new $r(this.value(),this.__chain__)}function Jf(){this.__values__===e&&(this.__values__=Bc(this.value()));var b=this.__index__>=this.__values__.length,A=b?e:this.__values__[this.__index__++];return{done:b,value:A}}function eh(){return this}function th(b){for(var A,N=this;N instanceof ni;){var Y=mc(N);Y.__index__=0,Y.__values__=e,A?ne.__wrapped__=Y:A=Y;var ne=Y;N=N.__wrapped__}return ne.__wrapped__=b,A}function rh(){var b=this.__wrapped__;if(b instanceof Gt){var A=b;return this.__actions__.length&&(A=new Gt(this)),A=A.reverse(),A.__actions__.push({func:Ds,args:[ol],thisArg:e}),new $r(A,this.__chain__)}return this.thru(ol)}function nh(){return Fl(this.__wrapped__,this.__actions__)}var ih=Ms(function(b,A,N){ir.call(b,N)?++b[N]:bt(b,N,1)});function ah(b,A,N){var Y=Ft(b)?Ja:Er;return N&&zr(b,A,N)&&(A=e),Y(b,Ot(A,3))}function sh(b,A){var N=Ft(b)?Hr:jt;return N(b,Ot(A,3))}var oh=Yl(vc),lh=Yl(_c);function ch(b,A){return Tt(Ns(b,A),1)}function uh(b,A){return Tt(Ns(b,A),k)}function fh(b,A,N){return N=N===e?1:Vt(N),Tt(Ns(b,A),N)}function Cc(b,A){var N=Ft(b)?Wr:_t;return N(b,Ot(A,3))}function Ec(b,A){var N=Ft(b)?to:rr;return N(b,Ot(A,3))}var hh=Ms(function(b,A,N){ir.call(b,N)?b[N].push(A):bt(b,N,[A])});function dh(b,A,N,Y){b=Zr(b)?b:ta(b),N=N&&!Y?Vt(N):0;var ne=b.length;return N<0&&(N=br(ne+N,0)),Vs(b)?N<=ne&&b.indexOf(A,N)>-1:!!ne&&an(b,A,N)>-1}var ph=Ht(function(b,A,N){var Y=-1,ne=typeof A=="function",xe=Zr(b)?at(b.length):[];return _t(b,function(Ne){xe[++Y]=ne?Mr(A,Ne,N):Ia(Ne,A,N)}),xe}),mh=Ms(function(b,A,N){bt(b,N,A)});function Ns(b,A){var N=Ft(b)?hr:Al;return N(b,Ot(A,3))}function vh(b,A,N,Y){return b==null?[]:(Ft(A)||(A=A==null?[]:[A]),N=Y?e:N,Ft(N)||(N=N==null?[]:[N]),Pl(b,A,N))}var _h=Ms(function(b,A,N){b[N?0:1].push(A)},function(){return[[],[]]});function gh(b,A,N){var Y=Ft(b)?ua:ns,ne=arguments.length<3;return Y(b,Ot(A,4),N,ne,_t)}function yh(b,A,N){var Y=Ft(b)?ro:ns,ne=arguments.length<3;return Y(b,Ot(A,4),N,ne,rr)}function xh(b,A){var N=Ft(b)?Hr:jt;return N(b,Fs(Ot(A,3)))}function bh(b){var A=Ft(b)?me:hu;return A(b)}function Sh(b,A,N){(N?zr(b,A,N):A===e)?A=1:A=Vt(A);var Y=Ft(b)?Re:du;return Y(b,A)}function Ch(b){var A=Ft(b)?we:mu;return A(b)}function Eh(b){if(b==null)return 0;if(Zr(b))return Vs(b)?Jn(b):b.length;var A=Dr(b);return A==ue||A==Be?b.size:zo(b).length}function wh(b,A,N){var Y=Ft(b)?fa:vu;return N&&zr(b,A,N)&&(A=e),Y(b,Ot(A,3))}var Mh=Ht(function(b,A){if(b==null)return[];var N=A.length;return N>1&&zr(b,A[0],A[1])?A=[]:N>2&&zr(A[0],A[1],A[2])&&(A=[A[0]]),Pl(b,Tt(A,1),[])}),Bs=Bn||function(){return wr.Date.now()};function Ah(b,A){if(typeof A!="function")throw new Or(s);return b=Vt(b),function(){if(--b<1)return A.apply(this,arguments)}}function wc(b,A,N){return A=N?e:A,A=b&&A==null?b.length:A,zn(b,T,e,e,e,e,A)}function Mc(b,A){var N;if(typeof A!="function")throw new Or(s);return b=Vt(b),function(){return--b>0&&(N=A.apply(this,arguments)),b<=1&&(A=e),N}}var cl=Ht(function(b,A,N){var Y=v;if(N.length){var ne=hn(N,Ji(cl));Y|=S}return zn(b,Y,A,N,ne)}),Ac=Ht(function(b,A,N){var Y=v|C;if(N.length){var ne=hn(N,Ji(Ac));Y|=S}return zn(A,Y,b,N,ne)});function Tc(b,A,N){A=N?e:A;var Y=zn(b,w,e,e,e,e,e,A);return Y.placeholder=Tc.placeholder,Y}function Rc(b,A,N){A=N?e:A;var Y=zn(b,_,e,e,e,e,e,A);return Y.placeholder=Rc.placeholder,Y}function Lc(b,A,N){var Y,ne,xe,Ne,Ge,Qe,lt=0,ct=!1,ut=!1,Ct=!0;if(typeof b!="function")throw new Or(s);A=cn(A)||0,vr(N)&&(ct=!!N.leading,ut="maxWait"in N,xe=ut?br(cn(N.maxWait)||0,A):xe,Ct="trailing"in N?!!N.trailing:Ct);function Lt(Cr){var gn=Y,Hn=ne;return Y=ne=e,lt=Cr,Ne=b.apply(Hn,gn),Ne}function Dt(Cr){return lt=Cr,Ge=ka(Zt,A),ct?Lt(Cr):Ne}function Ut(Cr){var gn=Cr-Qe,Hn=Cr-lt,Yc=A-gn;return ut?Ar(Yc,xe-Hn):Yc}function Nt(Cr){var gn=Cr-Qe,Hn=Cr-lt;return Qe===e||gn>=A||gn<0||ut&&Hn>=xe}function Zt(){var Cr=Bs();if(Nt(Cr))return Qt(Cr);Ge=ka(Zt,Ut(Cr))}function Qt(Cr){return Ge=e,Ct&&Y?Lt(Cr):(Y=ne=e,Ne)}function tn(){Ge!==e&&Vl(Ge),lt=0,Y=Qe=ne=Ge=e}function Vr(){return Ge===e?Ne:Qt(Bs())}function rn(){var Cr=Bs(),gn=Nt(Cr);if(Y=arguments,ne=this,Qe=Cr,gn){if(Ge===e)return Dt(Qe);if(ut)return Vl(Ge),Ge=ka(Zt,A),Lt(Qe)}return Ge===e&&(Ge=ka(Zt,A)),Ne}return rn.cancel=tn,rn.flush=Vr,rn}var Th=Ht(function(b,A){return nr(b,1,A)}),Rh=Ht(function(b,A,N){return nr(b,cn(A)||0,N)});function Lh(b){return zn(b,P)}function ks(b,A){if(typeof b!="function"||A!=null&&typeof A!="function")throw new Or(s);var N=function(){var Y=arguments,ne=A?A.apply(this,Y):Y[0],xe=N.cache;if(xe.has(ne))return xe.get(ne);var Ne=b.apply(this,Y);return N.cache=xe.set(ne,Ne)||xe,Ne};return N.cache=new(ks.Cache||vn),N}ks.Cache=vn;function Fs(b){if(typeof b!="function")throw new Or(s);return function(){var A=arguments;switch(A.length){case 0:return!b.call(this);case 1:return!b.call(this,A[0]);case 2:return!b.call(this,A[0],A[1]);case 3:return!b.call(this,A[0],A[1],A[2])}return!b.apply(this,A)}}function Ph(b){return Mc(2,b)}var Ih=_u(function(b,A){A=A.length==1&&Ft(A[0])?hr(A[0],Br(Ot())):hr(Tt(A,1),Br(Ot()));var N=A.length;return Ht(function(Y){for(var ne=-1,xe=Ar(Y.length,N);++ne<xe;)Y[ne]=A[ne].call(this,Y[ne]);return Mr(b,this,Y)})}),ul=Ht(function(b,A){var N=hn(A,Ji(ul));return zn(b,S,e,A,N)}),Pc=Ht(function(b,A){var N=hn(A,Ji(Pc));return zn(b,M,e,A,N)}),Oh=Vn(function(b,A){return zn(b,R,e,e,e,A)});function Dh(b,A){if(typeof b!="function")throw new Or(s);return A=A===e?A:Vt(A),Ht(b,A)}function Nh(b,A){if(typeof b!="function")throw new Or(s);return A=A==null?0:br(Vt(A),0),Ht(function(N){var Y=N[A],ne=oi(N,0,A);return Y&&Sn(ne,Y),Mr(b,this,ne)})}function Bh(b,A,N){var Y=!0,ne=!0;if(typeof b!="function")throw new Or(s);return vr(N)&&(Y="leading"in N?!!N.leading:Y,ne="trailing"in N?!!N.trailing:ne),Lc(b,A,{leading:Y,maxWait:A,trailing:ne})}function kh(b){return wc(b,1)}function Fh(b,A){return ul(Zo(A),b)}function zh(){if(!arguments.length)return[];var b=arguments[0];return Ft(b)?b:[b]}function Vh(b){return Yt(b,y)}function Uh(b,A){return A=typeof A=="function"?A:e,Yt(b,y,A)}function Gh(b){return Yt(b,p|y)}function Wh(b,A){return A=typeof A=="function"?A:e,Yt(b,p|y,A)}function Hh(b,A){return A==null||kt(b,A,Rr(A))}function _n(b,A){return b===A||b!==b&&A!==A}var $h=Ls(Bo),Xh=Ls(function(b,A){return b>=A}),Ni=El(function(){return arguments}())?El:function(b){return gr(b)&&ir.call(b,"callee")&&!wa.call(b,"callee")},Ft=at.isArray,jh=Kn?Br(Kn):eu;function Zr(b){return b!=null&&zs(b.length)&&!Gn(b)}function Sr(b){return gr(b)&&Zr(b)}function Zh(b){return b===!0||b===!1||gr(b)&&Fr(b)==ge}var li=po||bl,Yh=Ka?Br(Ka):tu;function Kh(b){return gr(b)&&b.nodeType===1&&!Fa(b)}function Qh(b){if(b==null)return!0;if(Zr(b)&&(Ft(b)||typeof b=="string"||typeof b.splice=="function"||li(b)||ea(b)||Ni(b)))return!b.length;var A=Dr(b);if(A==ue||A==Be)return!b.size;if(Ba(b))return!zo(b).length;for(var N in b)if(ir.call(b,N))return!1;return!0}function qh(b,A){return Oa(b,A)}function Jh(b,A,N){N=typeof N=="function"?N:e;var Y=N?N(b,A):e;return Y===e?Oa(b,A,e,N):!!Y}function fl(b){if(!gr(b))return!1;var A=Fr(b);return A==be||A==Le||typeof b.message=="string"&&typeof b.name=="string"&&!Fa(b)}function ed(b){return typeof b=="number"&&Ma(b)}function Gn(b){if(!vr(b))return!1;var A=Fr(b);return A==ye||A==ce||A==Ie||A==Ae}function Ic(b){return typeof b=="number"&&b==Vt(b)}function zs(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=$}function vr(b){var A=typeof b;return b!=null&&(A=="object"||A=="function")}function gr(b){return b!=null&&typeof b=="object"}var Oc=Qa?Br(Qa):nu;function td(b,A){return b===A||Fo(b,A,tl(A))}function rd(b,A,N){return N=typeof N=="function"?N:e,Fo(b,A,tl(A),N)}function nd(b){return Dc(b)&&b!=+b}function id(b){if(Vu(b))throw new Bt(a);return wl(b)}function ad(b){return b===null}function sd(b){return b==null}function Dc(b){return typeof b=="number"||gr(b)&&Fr(b)==Ce}function Fa(b){if(!gr(b)||Fr(b)!=ie)return!1;var A=lr(b);if(A===null)return!0;var N=ir.call(A,"constructor")&&A.constructor;return typeof N=="function"&&N instanceof N&&gi.call(N)==cs}var hl=qa?Br(qa):iu;function od(b){return Ic(b)&&b>=-$&&b<=$}var Nc=di?Br(di):au;function Vs(b){return typeof b=="string"||!Ft(b)&&gr(b)&&Fr(b)==ze}function en(b){return typeof b=="symbol"||gr(b)&&Fr(b)==We}var ea=ca?Br(ca):su;function ld(b){return b===e}function cd(b){return gr(b)&&Dr(b)==qe}function ud(b){return gr(b)&&Fr(b)==et}var fd=Ls(Vo),hd=Ls(function(b,A){return b<=A});function Bc(b){if(!b)return[];if(Zr(b))return Vs(b)?Qr(b):jr(b);if(Zi&&b[Zi])return pi(b[Zi]());var A=Dr(b),N=A==ue?xa:A==Be?mi:ta;return N(b)}function Wn(b){if(!b)return b===0?b:0;if(b=cn(b),b===k||b===-k){var A=b<0?-1:1;return A*Z}return b===b?b:0}function Vt(b){var A=Wn(b),N=A%1;return A===A?N?A-N:A:0}function kc(b){return b?Pt(Vt(b),0,j):0}function cn(b){if(typeof b=="number")return b;if(en(b))return K;if(vr(b)){var A=typeof b.valueOf=="function"?b.valueOf():b;b=vr(A)?A+"":A}if(typeof b!="string")return b===0?b:+b;b=is(b);var N=Rt.test(b);return N||dr.test(b)?qs(b.slice(2),N?2:8):vt.test(b)?K:+b}function Fc(b){return An(b,Yr(b))}function dd(b){return b?Pt(Vt(b),-$,$):b===0?b:0}function sr(b){return b==null?"":Jr(b)}var pd=Qi(function(b,A){if(Ba(A)||Zr(A)){An(A,Rr(A),b);return}for(var N in A)ir.call(A,N)&&Ze(b,N,A[N])}),zc=Qi(function(b,A){An(A,Yr(A),b)}),Us=Qi(function(b,A,N,Y){An(A,Yr(A),b,Y)}),md=Qi(function(b,A,N,Y){An(A,Rr(A),b,Y)}),vd=Vn(ft);function _d(b,A){var N=En(b);return A==null?N:nt(N,A)}var gd=Ht(function(b,A){b=ar(b);var N=-1,Y=A.length,ne=Y>2?A[2]:e;for(ne&&zr(A[0],A[1],ne)&&(Y=1);++N<Y;)for(var xe=A[N],Ne=Yr(xe),Ge=-1,Qe=Ne.length;++Ge<Qe;){var lt=Ne[Ge],ct=b[lt];(ct===e||_n(ct,Dn[lt])&&!ir.call(b,lt))&&(b[lt]=xe[lt])}return b}),yd=Ht(function(b){return b.push(e,rc),Mr(Vc,e,b)});function xd(b,A){return es(b,Ot(A,3),qr)}function bd(b,A){return es(b,Ot(A,3),ii)}function Sd(b,A){return b==null?b:Wt(b,Ot(A,3),Yr)}function Cd(b,A){return b==null?b:Mn(b,Ot(A,3),Yr)}function Ed(b,A){return b&&qr(b,Ot(A,3))}function wd(b,A){return b&&ii(b,Ot(A,3))}function Md(b){return b==null?[]:Fn(b,Rr(b))}function Ad(b){return b==null?[]:Fn(b,Yr(b))}function dl(b,A,N){var Y=b==null?e:Ii(b,A);return Y===e?N:Y}function Td(b,A){return b!=null&&ac(b,A,Kc)}function pl(b,A){return b!=null&&ac(b,A,Qc)}var Rd=Ql(function(b,A,N){A!=null&&typeof A.toString!="function"&&(A=xi.call(A)),b[A]=N},vl(Kr)),Ld=Ql(function(b,A,N){A!=null&&typeof A.toString!="function"&&(A=xi.call(A)),ir.call(b,A)?b[A].push(N):b[A]=[N]},Ot),Pd=Ht(Ia);function Rr(b){return Zr(b)?V(b):zo(b)}function Yr(b){return Zr(b)?V(b,!0):ou(b)}function Id(b,A){var N={};return A=Ot(A,3),qr(b,function(Y,ne,xe){bt(N,A(Y,ne,xe),Y)}),N}function Od(b,A){var N={};return A=Ot(A,3),qr(b,function(Y,ne,xe){bt(N,ne,A(Y,ne,xe))}),N}var Dd=Qi(function(b,A,N){Cs(b,A,N)}),Vc=Qi(function(b,A,N,Y){Cs(b,A,N,Y)}),Nd=Vn(function(b,A){var N={};if(b==null)return N;var Y=!1;A=hr(A,function(xe){return xe=si(xe,b),Y||(Y=xe.length>1),xe}),An(b,Jo(b),N),Y&&(N=Yt(N,p|g|y,Tu));for(var ne=A.length;ne--;)$o(N,A[ne]);return N});function Bd(b,A){return Uc(b,Fs(Ot(A)))}var kd=Vn(function(b,A){return b==null?{}:cu(b,A)});function Uc(b,A){if(b==null)return{};var N=hr(Jo(b),function(Y){return[Y]});return A=Ot(A),Il(b,N,function(Y,ne){return A(Y,ne[0])})}function Fd(b,A,N){A=si(A,b);var Y=-1,ne=A.length;for(ne||(ne=1,b=e);++Y<ne;){var xe=b==null?e:b[Tn(A[Y])];xe===e&&(Y=ne,xe=N),b=Gn(xe)?xe.call(b):xe}return b}function zd(b,A,N){return b==null?b:Da(b,A,N)}function Vd(b,A,N,Y){return Y=typeof Y=="function"?Y:e,b==null?b:Da(b,A,N,Y)}var Gc=ec(Rr),Wc=ec(Yr);function Ud(b,A,N){var Y=Ft(b),ne=Y||li(b)||ea(b);if(A=Ot(A,4),N==null){var xe=b&&b.constructor;ne?N=Y?new xe:[]:vr(b)?N=Gn(xe)?En(lr(b)):{}:N={}}return(ne?Wr:qr)(b,function(Ne,Ge,Qe){return A(N,Ne,Ge,Qe)}),N}function Gd(b,A){return b==null?!0:$o(b,A)}function Wd(b,A,N){return b==null?b:kl(b,A,Zo(N))}function Hd(b,A,N,Y){return Y=typeof Y=="function"?Y:e,b==null?b:kl(b,A,Zo(N),Y)}function ta(b){return b==null?[]:Cn(b,Rr(b))}function $d(b){return b==null?[]:Cn(b,Yr(b))}function Xd(b,A,N){return N===e&&(N=A,A=e),N!==e&&(N=cn(N),N=N===N?N:0),A!==e&&(A=cn(A),A=A===A?A:0),Pt(cn(b),A,N)}function jd(b,A,N){return A=Wn(A),N===e?(N=A,A=0):N=Wn(N),b=cn(b),qc(b,A,N)}function Zd(b,A,N){if(N&&typeof N!="boolean"&&zr(b,A,N)&&(A=N=e),N===e&&(typeof A=="boolean"?(N=A,A=e):typeof b=="boolean"&&(N=b,b=e)),b===e&&A===e?(b=0,A=1):(b=Wn(b),A===e?(A=b,b=0):A=Wn(A)),b>A){var Y=b;b=A,A=Y}if(N||b%1||A%1){var ne=ps();return Ar(b+ne*(A-b+Qs("1e-"+((ne+"").length-1))),A)}return Go(b,A)}var Yd=qi(function(b,A,N){return A=A.toLowerCase(),b+(N?Hc(A):A)});function Hc(b){return ml(sr(b).toLowerCase())}function $c(b){return b=sr(b),b&&b.replace(pr,as).replace($s,"")}function Kd(b,A,N){b=sr(b),A=Jr(A);var Y=b.length;N=N===e?Y:Pt(Vt(N),0,Y);var ne=N;return N-=A.length,N>=0&&b.slice(N,ne)==A}function Qd(b){return b=sr(b),b&&ke.test(b)?b.replace(it,oo):b}function qd(b){return b=sr(b),b&&At.test(b)?b.replace(dt,"\\$&"):b}var Jd=qi(function(b,A,N){return b+(N?"-":"")+A.toLowerCase()}),ep=qi(function(b,A,N){return b+(N?" ":"")+A.toLowerCase()}),tp=Zl("toLowerCase");function rp(b,A,N){b=sr(b),A=Vt(A);var Y=A?Jn(b):0;if(!A||Y>=A)return b;var ne=(A-Y)/2;return Rs(wi(ne),N)+b+Rs(Ei(ne),N)}function np(b,A,N){b=sr(b),A=Vt(A);var Y=A?Jn(b):0;return A&&Y<A?b+Rs(A-Y,N):b}function ip(b,A,N){b=sr(b),A=Vt(A);var Y=A?Jn(b):0;return A&&Y<A?Rs(A-Y,N)+b:b}function ap(b,A,N){return N||A==null?A=0:A&&(A=+A),vo(sr(b).replace(_e,""),A||0)}function sp(b,A,N){return(N?zr(b,A,N):A===e)?A=1:A=Vt(A),Wo(sr(b),A)}function op(){var b=arguments,A=sr(b[0]);return b.length<3?A:A.replace(b[1],b[2])}var lp=qi(function(b,A,N){return b+(N?"_":"")+A.toLowerCase()});function cp(b,A,N){return N&&typeof N!="number"&&zr(b,A,N)&&(A=N=e),N=N===e?j:N>>>0,N?(b=sr(b),b&&(typeof A=="string"||A!=null&&!hl(A))&&(A=Jr(A),!A&&qn(b))?oi(Qr(b),0,N):b.split(A,N)):[]}var up=qi(function(b,A,N){return b+(N?" ":"")+ml(A)});function fp(b,A,N){return b=sr(b),N=N==null?0:Pt(Vt(N),0,b.length),A=Jr(A),b.slice(N,N+A.length)==A}function hp(b,A,N){var Y=pe.templateSettings;N&&zr(b,A,N)&&(A=e),b=sr(b),A=Us({},A,Y,tc);var ne=Us({},A.imports,Y.imports,tc),xe=Rr(ne),Ne=Cn(ne,xe),Ge,Qe,lt=0,ct=A.interpolate||qt,ut="__p += '",Ct=ei((A.escape||qt).source+"|"+ct.source+"|"+(ct===fe?mt:qt).source+"|"+(A.evaluate||qt).source+"|$","g"),Lt="//# sourceURL="+(ir.call(A,"sourceURL")?(A.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Xa+"]")+`
`;b.replace(Ct,function(Nt,Zt,Qt,tn,Vr,rn){return Qt||(Qt=tn),ut+=b.slice(lt,rn).replace(Lr,lo),Zt&&(Ge=!0,ut+=`' +
__e(`+Zt+`) +
'`),Vr&&(Qe=!0,ut+=`';
`+Vr+`;
__p += '`),Qt&&(ut+=`' +
((__t = (`+Qt+`)) == null ? '' : __t) +
'`),lt=rn+Nt.length,Nt}),ut+=`';
`;var Dt=ir.call(A,"variable")&&A.variable;if(!Dt)ut=`with (obj) {
`+ut+`
}
`;else if(Et.test(Dt))throw new Bt(l);ut=(Qe?ut.replace(Oe,""):ut).replace(Je,"$1").replace(ee,"$1;"),ut="function("+(Dt||"obj")+`) {
`+(Dt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ge?", __e = _.escape":"")+(Qe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ut+`return __p
}`;var Ut=jc(function(){return er(xe,Lt+"return "+ut).apply(e,Ne)});if(Ut.source=ut,fl(Ut))throw Ut;return Ut}function dp(b){return sr(b).toLowerCase()}function pp(b){return sr(b).toUpperCase()}function mp(b,A,N){if(b=sr(b),b&&(N||A===e))return is(b);if(!b||!(A=Jr(A)))return b;var Y=Qr(b),ne=Qr(A),xe=_a(Y,ne),Ne=ga(Y,ne)+1;return oi(Y,xe,Ne).join("")}function vp(b,A,N){if(b=sr(b),b&&(N||A===e))return b.slice(0,kr(b)+1);if(!b||!(A=Jr(A)))return b;var Y=Qr(b),ne=ga(Y,Qr(A))+1;return oi(Y,0,ne).join("")}function _p(b,A,N){if(b=sr(b),b&&(N||A===e))return b.replace(_e,"");if(!b||!(A=Jr(A)))return b;var Y=Qr(b),ne=_a(Y,Qr(A));return oi(Y,ne).join("")}function gp(b,A){var N=I,Y=B;if(vr(A)){var ne="separator"in A?A.separator:ne;N="length"in A?Vt(A.length):N,Y="omission"in A?Jr(A.omission):Y}b=sr(b);var xe=b.length;if(qn(b)){var Ne=Qr(b);xe=Ne.length}if(N>=xe)return b;var Ge=N-Jn(Y);if(Ge<1)return Y;var Qe=Ne?oi(Ne,0,Ge).join(""):b.slice(0,Ge);if(ne===e)return Qe+Y;if(Ne&&(Ge+=Qe.length-Ge),hl(ne)){if(b.slice(Ge).search(ne)){var lt,ct=Qe;for(ne.global||(ne=ei(ne.source,sr(St.exec(ne))+"g")),ne.lastIndex=0;lt=ne.exec(ct);)var ut=lt.index;Qe=Qe.slice(0,ut===e?Ge:ut)}}else if(b.indexOf(Jr(ne),Ge)!=Ge){var Ct=Qe.lastIndexOf(ne);Ct>-1&&(Qe=Qe.slice(0,Ct))}return Qe+Y}function yp(b){return b=sr(b),b&&U.test(b)?b.replace(Fe,ss):b}var xp=qi(function(b,A,N){return b+(N?" ":"")+A.toUpperCase()}),ml=Zl("toUpperCase");function Xc(b,A,N){return b=sr(b),A=N?e:A,A===e?Sl(b)?ls(b):ao(b):b.match(A)||[]}var jc=Ht(function(b,A){try{return Mr(b,e,A)}catch(N){return fl(N)?N:new Bt(N)}}),bp=Vn(function(b,A){return Wr(A,function(N){N=Tn(N),bt(b,N,cl(b[N],b))}),b});function Sp(b){var A=b==null?0:b.length,N=Ot();return b=A?hr(b,function(Y){if(typeof Y[1]!="function")throw new Or(s);return[N(Y[0]),Y[1]]}):[],Ht(function(Y){for(var ne=-1;++ne<A;){var xe=b[ne];if(Mr(xe[0],this,Y))return Mr(xe[1],this,Y)}})}function Cp(b){return Kt(Yt(b,p))}function vl(b){return function(){return b}}function Ep(b,A){return b==null||b!==b?A:b}var wp=Kl(),Mp=Kl(!0);function Kr(b){return b}function _l(b){return Ml(typeof b=="function"?b:Yt(b,p))}function Ap(b){return Tl(Yt(b,p))}function Tp(b,A){return Rl(b,Yt(A,p))}var Rp=Ht(function(b,A){return function(N){return Ia(N,b,A)}}),Lp=Ht(function(b,A){return function(N){return Ia(b,N,A)}});function gl(b,A,N){var Y=Rr(A),ne=Fn(A,Y);N==null&&!(vr(A)&&(ne.length||!Y.length))&&(N=A,A=b,b=this,ne=Fn(A,Rr(A)));var xe=!(vr(N)&&"chain"in N)||!!N.chain,Ne=Gn(b);return Wr(ne,function(Ge){var Qe=A[Ge];b[Ge]=Qe,Ne&&(b.prototype[Ge]=function(){var lt=this.__chain__;if(xe||lt){var ct=b(this.__wrapped__),ut=ct.__actions__=jr(this.__actions__);return ut.push({func:Qe,args:arguments,thisArg:b}),ct.__chain__=lt,ct}return Qe.apply(b,Sn([this.value()],arguments))})}),b}function Pp(){return wr._===this&&(wr._=us),this}function yl(){}function Ip(b){return b=Vt(b),Ht(function(A){return Ll(A,b)})}var Op=Ko(hr),Dp=Ko(Ja),Np=Ko(fa);function Zc(b){return nl(b)?da(Tn(b)):uu(b)}function Bp(b){return function(A){return b==null?e:Ii(b,A)}}var kp=ql(),Fp=ql(!0);function xl(){return[]}function bl(){return!1}function zp(){return{}}function Vp(){return""}function Up(){return!0}function Gp(b,A){if(b=Vt(b),b<1||b>$)return[];var N=j,Y=Ar(b,j);A=Ot(A),b-=j;for(var ne=va(Y,A);++N<b;)A(N);return ne}function Wp(b){return Ft(b)?hr(b,Tn):en(b)?[b]:jr(pc(sr(b)))}function Hp(b){var A=++Xi;return sr(b)+A}var $p=Ts(function(b,A){return b+A},0),Xp=Qo("ceil"),jp=Ts(function(b,A){return b/A},1),Zp=Qo("floor");function Yp(b){return b&&b.length?It(b,Kr,Bo):e}function Kp(b,A){return b&&b.length?It(b,Ot(A,2),Bo):e}function Qp(b){return rs(b,Kr)}function qp(b,A){return rs(b,Ot(A,2))}function Jp(b){return b&&b.length?It(b,Kr,Vo):e}function em(b,A){return b&&b.length?It(b,Ot(A,2),Vo):e}var tm=Ts(function(b,A){return b*A},1),rm=Qo("round"),nm=Ts(function(b,A){return b-A},0);function im(b){return b&&b.length?ma(b,Kr):0}function am(b,A){return b&&b.length?ma(b,Ot(A,2)):0}return pe.after=Ah,pe.ary=wc,pe.assign=pd,pe.assignIn=zc,pe.assignInWith=Us,pe.assignWith=md,pe.at=vd,pe.before=Mc,pe.bind=cl,pe.bindAll=bp,pe.bindKey=Ac,pe.castArray=zh,pe.chain=Sc,pe.chunk=ju,pe.compact=Zu,pe.concat=Yu,pe.cond=Sp,pe.conforms=Cp,pe.constant=vl,pe.countBy=ih,pe.create=_d,pe.curry=Tc,pe.curryRight=Rc,pe.debounce=Lc,pe.defaults=gd,pe.defaultsDeep=yd,pe.defer=Th,pe.delay=Rh,pe.difference=Ku,pe.differenceBy=Qu,pe.differenceWith=qu,pe.drop=Ju,pe.dropRight=ef,pe.dropRightWhile=tf,pe.dropWhile=rf,pe.fill=nf,pe.filter=sh,pe.flatMap=ch,pe.flatMapDeep=uh,pe.flatMapDepth=fh,pe.flatten=gc,pe.flattenDeep=af,pe.flattenDepth=sf,pe.flip=Lh,pe.flow=wp,pe.flowRight=Mp,pe.fromPairs=of,pe.functions=Md,pe.functionsIn=Ad,pe.groupBy=hh,pe.initial=cf,pe.intersection=uf,pe.intersectionBy=ff,pe.intersectionWith=hf,pe.invert=Rd,pe.invertBy=Ld,pe.invokeMap=ph,pe.iteratee=_l,pe.keyBy=mh,pe.keys=Rr,pe.keysIn=Yr,pe.map=Ns,pe.mapKeys=Id,pe.mapValues=Od,pe.matches=Ap,pe.matchesProperty=Tp,pe.memoize=ks,pe.merge=Dd,pe.mergeWith=Vc,pe.method=Rp,pe.methodOf=Lp,pe.mixin=gl,pe.negate=Fs,pe.nthArg=Ip,pe.omit=Nd,pe.omitBy=Bd,pe.once=Ph,pe.orderBy=vh,pe.over=Op,pe.overArgs=Ih,pe.overEvery=Dp,pe.overSome=Np,pe.partial=ul,pe.partialRight=Pc,pe.partition=_h,pe.pick=kd,pe.pickBy=Uc,pe.property=Zc,pe.propertyOf=Bp,pe.pull=vf,pe.pullAll=xc,pe.pullAllBy=_f,pe.pullAllWith=gf,pe.pullAt=yf,pe.range=kp,pe.rangeRight=Fp,pe.rearg=Oh,pe.reject=xh,pe.remove=xf,pe.rest=Dh,pe.reverse=ol,pe.sampleSize=Sh,pe.set=zd,pe.setWith=Vd,pe.shuffle=Ch,pe.slice=bf,pe.sortBy=Mh,pe.sortedUniq=Tf,pe.sortedUniqBy=Rf,pe.split=cp,pe.spread=Nh,pe.tail=Lf,pe.take=Pf,pe.takeRight=If,pe.takeRightWhile=Of,pe.takeWhile=Df,pe.tap=Yf,pe.throttle=Bh,pe.thru=Ds,pe.toArray=Bc,pe.toPairs=Gc,pe.toPairsIn=Wc,pe.toPath=Wp,pe.toPlainObject=Fc,pe.transform=Ud,pe.unary=kh,pe.union=Nf,pe.unionBy=Bf,pe.unionWith=kf,pe.uniq=Ff,pe.uniqBy=zf,pe.uniqWith=Vf,pe.unset=Gd,pe.unzip=ll,pe.unzipWith=bc,pe.update=Wd,pe.updateWith=Hd,pe.values=ta,pe.valuesIn=$d,pe.without=Uf,pe.words=Xc,pe.wrap=Fh,pe.xor=Gf,pe.xorBy=Wf,pe.xorWith=Hf,pe.zip=$f,pe.zipObject=Xf,pe.zipObjectDeep=jf,pe.zipWith=Zf,pe.entries=Gc,pe.entriesIn=Wc,pe.extend=zc,pe.extendWith=Us,gl(pe,pe),pe.add=$p,pe.attempt=jc,pe.camelCase=Yd,pe.capitalize=Hc,pe.ceil=Xp,pe.clamp=Xd,pe.clone=Vh,pe.cloneDeep=Gh,pe.cloneDeepWith=Wh,pe.cloneWith=Uh,pe.conformsTo=Hh,pe.deburr=$c,pe.defaultTo=Ep,pe.divide=jp,pe.endsWith=Kd,pe.eq=_n,pe.escape=Qd,pe.escapeRegExp=qd,pe.every=ah,pe.find=oh,pe.findIndex=vc,pe.findKey=xd,pe.findLast=lh,pe.findLastIndex=_c,pe.findLastKey=bd,pe.floor=Zp,pe.forEach=Cc,pe.forEachRight=Ec,pe.forIn=Sd,pe.forInRight=Cd,pe.forOwn=Ed,pe.forOwnRight=wd,pe.get=dl,pe.gt=$h,pe.gte=Xh,pe.has=Td,pe.hasIn=pl,pe.head=yc,pe.identity=Kr,pe.includes=dh,pe.indexOf=lf,pe.inRange=jd,pe.invoke=Pd,pe.isArguments=Ni,pe.isArray=Ft,pe.isArrayBuffer=jh,pe.isArrayLike=Zr,pe.isArrayLikeObject=Sr,pe.isBoolean=Zh,pe.isBuffer=li,pe.isDate=Yh,pe.isElement=Kh,pe.isEmpty=Qh,pe.isEqual=qh,pe.isEqualWith=Jh,pe.isError=fl,pe.isFinite=ed,pe.isFunction=Gn,pe.isInteger=Ic,pe.isLength=zs,pe.isMap=Oc,pe.isMatch=td,pe.isMatchWith=rd,pe.isNaN=nd,pe.isNative=id,pe.isNil=sd,pe.isNull=ad,pe.isNumber=Dc,pe.isObject=vr,pe.isObjectLike=gr,pe.isPlainObject=Fa,pe.isRegExp=hl,pe.isSafeInteger=od,pe.isSet=Nc,pe.isString=Vs,pe.isSymbol=en,pe.isTypedArray=ea,pe.isUndefined=ld,pe.isWeakMap=cd,pe.isWeakSet=ud,pe.join=df,pe.kebabCase=Jd,pe.last=ln,pe.lastIndexOf=pf,pe.lowerCase=ep,pe.lowerFirst=tp,pe.lt=fd,pe.lte=hd,pe.max=Yp,pe.maxBy=Kp,pe.mean=Qp,pe.meanBy=qp,pe.min=Jp,pe.minBy=em,pe.stubArray=xl,pe.stubFalse=bl,pe.stubObject=zp,pe.stubString=Vp,pe.stubTrue=Up,pe.multiply=tm,pe.nth=mf,pe.noConflict=Pp,pe.noop=yl,pe.now=Bs,pe.pad=rp,pe.padEnd=np,pe.padStart=ip,pe.parseInt=ap,pe.random=Zd,pe.reduce=gh,pe.reduceRight=yh,pe.repeat=sp,pe.replace=op,pe.result=Fd,pe.round=rm,pe.runInContext=Ke,pe.sample=bh,pe.size=Eh,pe.snakeCase=lp,pe.some=wh,pe.sortedIndex=Sf,pe.sortedIndexBy=Cf,pe.sortedIndexOf=Ef,pe.sortedLastIndex=wf,pe.sortedLastIndexBy=Mf,pe.sortedLastIndexOf=Af,pe.startCase=up,pe.startsWith=fp,pe.subtract=nm,pe.sum=im,pe.sumBy=am,pe.template=hp,pe.times=Gp,pe.toFinite=Wn,pe.toInteger=Vt,pe.toLength=kc,pe.toLower=dp,pe.toNumber=cn,pe.toSafeInteger=dd,pe.toString=sr,pe.toUpper=pp,pe.trim=mp,pe.trimEnd=vp,pe.trimStart=_p,pe.truncate=gp,pe.unescape=yp,pe.uniqueId=Hp,pe.upperCase=xp,pe.upperFirst=ml,pe.each=Cc,pe.eachRight=Ec,pe.first=yc,gl(pe,function(){var b={};return qr(pe,function(A,N){ir.call(pe.prototype,N)||(b[N]=A)}),b}(),{chain:!1}),pe.VERSION=n,Wr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(b){pe[b].placeholder=pe}),Wr(["drop","take"],function(b,A){Gt.prototype[b]=function(N){N=N===e?1:br(Vt(N),0);var Y=this.__filtered__&&!A?new Gt(this):this.clone();return Y.__filtered__?Y.__takeCount__=Ar(N,Y.__takeCount__):Y.__views__.push({size:Ar(N,j),type:b+(Y.__dir__<0?"Right":"")}),Y},Gt.prototype[b+"Right"]=function(N){return this.reverse()[b](N).reverse()}}),Wr(["filter","map","takeWhile"],function(b,A){var N=A+1,Y=N==O||N==G;Gt.prototype[b]=function(ne){var xe=this.clone();return xe.__iteratees__.push({iteratee:Ot(ne,3),type:N}),xe.__filtered__=xe.__filtered__||Y,xe}}),Wr(["head","last"],function(b,A){var N="take"+(A?"Right":"");Gt.prototype[b]=function(){return this[N](1).value()[0]}}),Wr(["initial","tail"],function(b,A){var N="drop"+(A?"":"Right");Gt.prototype[b]=function(){return this.__filtered__?new Gt(this):this[N](1)}}),Gt.prototype.compact=function(){return this.filter(Kr)},Gt.prototype.find=function(b){return this.filter(b).head()},Gt.prototype.findLast=function(b){return this.reverse().find(b)},Gt.prototype.invokeMap=Ht(function(b,A){return typeof b=="function"?new Gt(this):this.map(function(N){return Ia(N,b,A)})}),Gt.prototype.reject=function(b){return this.filter(Fs(Ot(b)))},Gt.prototype.slice=function(b,A){b=Vt(b);var N=this;return N.__filtered__&&(b>0||A<0)?new Gt(N):(b<0?N=N.takeRight(-b):b&&(N=N.drop(b)),A!==e&&(A=Vt(A),N=A<0?N.dropRight(-A):N.take(A-b)),N)},Gt.prototype.takeRightWhile=function(b){return this.reverse().takeWhile(b).reverse()},Gt.prototype.toArray=function(){return this.take(j)},qr(Gt.prototype,function(b,A){var N=/^(?:filter|find|map|reject)|While$/.test(A),Y=/^(?:head|last)$/.test(A),ne=pe[Y?"take"+(A=="last"?"Right":""):A],xe=Y||/^find/.test(A);ne&&(pe.prototype[A]=function(){var Ne=this.__wrapped__,Ge=Y?[1]:arguments,Qe=Ne instanceof Gt,lt=Ge[0],ct=Qe||Ft(Ne),ut=function(Zt){var Qt=ne.apply(pe,Sn([Zt],Ge));return Y&&Ct?Qt[0]:Qt};ct&&N&&typeof lt=="function"&&lt.length!=1&&(Qe=ct=!1);var Ct=this.__chain__,Lt=!!this.__actions__.length,Dt=xe&&!Ct,Ut=Qe&&!Lt;if(!xe&&ct){Ne=Ut?Ne:new Gt(this);var Nt=b.apply(Ne,Ge);return Nt.__actions__.push({func:Ds,args:[ut],thisArg:e}),new $r(Nt,Ct)}return Dt&&Ut?b.apply(this,Ge):(Nt=this.thru(ut),Dt?Y?Nt.value()[0]:Nt.value():Nt)})}),Wr(["pop","push","shift","sort","splice","unshift"],function(b){var A=vi[b],N=/^(?:push|sort|unshift)$/.test(b)?"tap":"thru",Y=/^(?:pop|shift)$/.test(b);pe.prototype[b]=function(){var ne=arguments;if(Y&&!this.__chain__){var xe=this.value();return A.apply(Ft(xe)?xe:[],ne)}return this[N](function(Ne){return A.apply(Ft(Ne)?Ne:[],ne)})}}),qr(Gt.prototype,function(b,A){var N=pe[A];if(N){var Y=N.name+"";ir.call(ri,Y)||(ri[Y]=[]),ri[Y].push({name:A,func:N})}}),ri[As(e,C).name]=[{name:"wrapper",func:e}],Gt.prototype.clone=So,Gt.prototype.reverse=Pi,Gt.prototype.value=Pa,pe.prototype.at=Kf,pe.prototype.chain=Qf,pe.prototype.commit=qf,pe.prototype.next=Jf,pe.prototype.plant=th,pe.prototype.reverse=rh,pe.prototype.toJSON=pe.prototype.valueOf=pe.prototype.value=nh,pe.prototype.first=pe.prototype.head,Zi&&(pe.prototype[Zi]=eh),pe},On=$i();Pn?((Pn.exports=On)._=On,oa._=On):wr._=On}).call(commonjsGlobal$1)})(lodash,lodash.exports);var lodashExports=lodash.exports;/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="131",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,KeepStencilOp=7680,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,GLSL3="300 es";let EventDispatcher$1=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const a=r.indexOf(e);a!==-1&&r.splice(a,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const r=n.slice(0);for(let a=0,s=r.length;a<s;a++)r[a].call(this,t);t.target=null}}};const _lut=[];for(let o=0;o<256;o++)_lut[o]=(o<16?"0":"")+o.toString(16);let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const o=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(_lut[o&255]+_lut[o>>8&255]+_lut[o>>16&255]+_lut[o>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[e&63|128]+_lut[e>>8&255]+"-"+_lut[e>>16&255]+_lut[e>>24&255]+_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toUpperCase()}function clamp$1(o,t,e){return Math.max(t,Math.min(e,o))}function euclideanModulo(o,t){return(o%t+t)%t}function mapLinear(o,t,e,n,r){return n+(o-t)*(r-n)/(e-t)}function inverseLerp(o,t,e){return o!==t?(e-o)/(t-o):0}function lerp(o,t,e){return(1-e)*o+e*t}function damp(o,t,e,n){return lerp(o,t,1-Math.exp(-e*n))}function pingpong(o,t=1){return t-Math.abs(euclideanModulo(o,t*2)-t)}function smoothstep(o,t,e){return o<=t?0:o>=e?1:(o=(o-t)/(e-t),o*o*(3-2*o))}function smootherstep(o,t,e){return o<=t?0:o>=e?1:(o=(o-t)/(e-t),o*o*o*(o*(o*6-15)+10))}function randInt(o,t){return o+Math.floor(Math.random()*(t-o+1))}function randFloat(o,t){return o+Math.random()*(t-o)}function randFloatSpread(o){return o*(.5-Math.random())}function seededRandom(o){return o!==void 0&&(_seed=o%2147483647),_seed=_seed*16807%2147483647,(_seed-1)/2147483646}function degToRad(o){return o*DEG2RAD}function radToDeg(o){return o*RAD2DEG}function isPowerOfTwo(o){return(o&o-1)===0&&o!==0}function ceilPowerOfTwo(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function floorPowerOfTwo(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function setQuaternionFromProperEuler(o,t,e,n,r){const a=Math.cos,s=Math.sin,l=a(e/2),c=s(e/2),u=a((t+n)/2),f=s((t+n)/2),p=a((t-n)/2),g=s((t-n)/2),y=a((n-t)/2),E=s((n-t)/2);switch(r){case"XYX":o.set(l*f,c*p,c*g,l*u);break;case"YZY":o.set(c*g,l*f,c*p,l*u);break;case"ZXZ":o.set(c*p,c*g,l*f,l*u);break;case"XZX":o.set(l*f,c*E,c*y,l*u);break;case"YXY":o.set(c*y,l*f,c*E,l*u);break;case"ZYZ":o.set(c*E,c*y,l*f,l*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}var MathUtils=Object.freeze({__proto__:null,DEG2RAD,RAD2DEG,generateUUID,clamp:clamp$1,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler});class Vector2{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),a=this.x-t.x,s=this.y-t.y;return this.x=a*n-s*r+t.x,this.y=a*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,a,s,l,c,u){const f=this.elements;return f[0]=t,f[1]=r,f[2]=l,f[3]=e,f[4]=a,f[5]=c,f[6]=n,f[7]=s,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,a=this.elements,s=n[0],l=n[3],c=n[6],u=n[1],f=n[4],p=n[7],g=n[2],y=n[5],E=n[8],h=r[0],v=r[3],C=r[6],x=r[1],w=r[4],_=r[7],S=r[2],M=r[5],T=r[8];return a[0]=s*h+l*x+c*S,a[3]=s*v+l*w+c*M,a[6]=s*C+l*_+c*T,a[1]=u*h+f*x+p*S,a[4]=u*v+f*w+p*M,a[7]=u*C+f*_+p*T,a[2]=g*h+y*x+E*S,a[5]=g*v+y*w+E*M,a[8]=g*C+y*_+E*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8];return e*s*f-e*l*u-n*a*f+n*l*c+r*a*u-r*s*c}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8],p=f*s-l*u,g=l*c-f*a,y=u*a-s*c,E=e*p+n*g+r*y;if(E===0)return this.set(0,0,0,0,0,0,0,0,0);const h=1/E;return t[0]=p*h,t[1]=(r*u-f*n)*h,t[2]=(l*n-r*s)*h,t[3]=g*h,t[4]=(f*e-r*c)*h,t[5]=(r*a-l*e)*h,t[6]=y*h,t[7]=(n*c-u*e)*h,t[8]=(s*e-n*a)*h,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,a,s,l){const c=Math.cos(a),u=Math.sin(a);return this.set(n*c,n*u,-n*(c*s+u*l)+s+t,-r*u,r*c,-r*(-u*s+c*l)+l+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,a=r[0],s=r[3],l=r[6],c=r[1],u=r[4],f=r[7];return r[0]=e*a+n*c,r[3]=e*s+n*u,r[6]=e*l+n*f,r[1]=-n*a+e*c,r[4]=-n*s+e*u,r[7]=-n*l+e*f,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}Matrix3.prototype.isMatrix3=!0;let _canvas;class ImageUtils{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{_canvas===void 0&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=t.width,_canvas.height=t.height;const n=_canvas.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=_canvas}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let textureId=0;class Texture extends EventDispatcher$1{constructor(t=Texture.DEFAULT_IMAGE,e=Texture.DEFAULT_MAPPING,n=ClampToEdgeWrapping,r=ClampToEdgeWrapping,a=LinearFilter,s=LinearMipmapLinearFilter,l=RGBAFormat,c=UnsignedByteType,u=1,f=LinearEncoding){super(),Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=a,this.minFilter=s,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=f,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const r=this.image;if(r.uuid===void 0&&(r.uuid=generateUUID()),!e&&t.images[r.uuid]===void 0){let a;if(Array.isArray(r)){a=[];for(let s=0,l=r.length;s<l;s++)r[s].isDataTexture?a.push(serializeImage(r[s].image)):a.push(serializeImage(r[s]))}else a=serializeImage(r);t.images[r.uuid]={uuid:r.uuid,url:a}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==UVMapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&this.version++}}Texture.DEFAULT_IMAGE=void 0;Texture.DEFAULT_MAPPING=UVMapping;Texture.prototype.isTexture=!0;function serializeImage(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?ImageUtils.getDataURL(o):o.data?{data:Array.prototype.slice.call(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Vector4{constructor(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,a=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*a,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*a,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*a,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*a,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,a;const c=t.elements,u=c[0],f=c[4],p=c[8],g=c[1],y=c[5],E=c[9],h=c[2],v=c[6],C=c[10];if(Math.abs(f-g)<.01&&Math.abs(p-h)<.01&&Math.abs(E-v)<.01){if(Math.abs(f+g)<.1&&Math.abs(p+h)<.1&&Math.abs(E+v)<.1&&Math.abs(u+y+C-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const w=(u+1)/2,_=(y+1)/2,S=(C+1)/2,M=(f+g)/4,T=(p+h)/4,R=(E+v)/4;return w>_&&w>S?w<.01?(n=0,r=.707106781,a=.707106781):(n=Math.sqrt(w),r=M/n,a=T/n):_>S?_<.01?(n=.707106781,r=0,a=.707106781):(r=Math.sqrt(_),n=M/r,a=R/r):S<.01?(n=.707106781,r=.707106781,a=0):(a=Math.sqrt(S),n=T/a,r=R/a),this.set(n,r,a,e),this}let x=Math.sqrt((v-E)*(v-E)+(p-h)*(p-h)+(g-f)*(g-f));return Math.abs(x)<.001&&(x=1),this.x=(v-E)/x,this.y=(p-h)/x,this.z=(g-f)/x,this.w=Math.acos((u+y+C-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher$1{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,e),this.texture=new Texture(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:LinearFilter,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){(this.width!==t||this.height!==e||this.depth!==n)&&(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(t,e,n){super(t,e);const r=this.texture;this.texture=[];for(let a=0;a<n;a++)this.texture[a]=r.clone()}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}WebGLMultipleRenderTargets.prototype.isWebGLMultipleRenderTargets=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(t,e,n){super(t,e,n),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;class Quaternion{constructor(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,a,s,l){let c=n[r+0],u=n[r+1],f=n[r+2],p=n[r+3];const g=a[s+0],y=a[s+1],E=a[s+2],h=a[s+3];if(l===0){t[e+0]=c,t[e+1]=u,t[e+2]=f,t[e+3]=p;return}if(l===1){t[e+0]=g,t[e+1]=y,t[e+2]=E,t[e+3]=h;return}if(p!==h||c!==g||u!==y||f!==E){let v=1-l;const C=c*g+u*y+f*E+p*h,x=C>=0?1:-1,w=1-C*C;if(w>Number.EPSILON){const S=Math.sqrt(w),M=Math.atan2(S,C*x);v=Math.sin(v*M)/S,l=Math.sin(l*M)/S}const _=l*x;if(c=c*v+g*_,u=u*v+y*_,f=f*v+E*_,p=p*v+h*_,v===1-l){const S=1/Math.sqrt(c*c+u*u+f*f+p*p);c*=S,u*=S,f*=S,p*=S}}t[e]=c,t[e+1]=u,t[e+2]=f,t[e+3]=p}static multiplyQuaternionsFlat(t,e,n,r,a,s){const l=n[r],c=n[r+1],u=n[r+2],f=n[r+3],p=a[s],g=a[s+1],y=a[s+2],E=a[s+3];return t[e]=l*E+f*p+c*y-u*g,t[e+1]=c*E+f*g+u*p-l*y,t[e+2]=u*E+f*y+l*g-c*p,t[e+3]=f*E-l*p-c*g-u*y,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,a=t._z,s=t._order,l=Math.cos,c=Math.sin,u=l(n/2),f=l(r/2),p=l(a/2),g=c(n/2),y=c(r/2),E=c(a/2);switch(s){case"XYZ":this._x=g*f*p+u*y*E,this._y=u*y*p-g*f*E,this._z=u*f*E+g*y*p,this._w=u*f*p-g*y*E;break;case"YXZ":this._x=g*f*p+u*y*E,this._y=u*y*p-g*f*E,this._z=u*f*E-g*y*p,this._w=u*f*p+g*y*E;break;case"ZXY":this._x=g*f*p-u*y*E,this._y=u*y*p+g*f*E,this._z=u*f*E+g*y*p,this._w=u*f*p-g*y*E;break;case"ZYX":this._x=g*f*p-u*y*E,this._y=u*y*p+g*f*E,this._z=u*f*E-g*y*p,this._w=u*f*p+g*y*E;break;case"YZX":this._x=g*f*p+u*y*E,this._y=u*y*p+g*f*E,this._z=u*f*E-g*y*p,this._w=u*f*p-g*y*E;break;case"XZY":this._x=g*f*p-u*y*E,this._y=u*y*p-g*f*E,this._z=u*f*E+g*y*p,this._w=u*f*p+g*y*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],a=e[8],s=e[1],l=e[5],c=e[9],u=e[2],f=e[6],p=e[10],g=n+l+p;if(g>0){const y=.5/Math.sqrt(g+1);this._w=.25/y,this._x=(f-c)*y,this._y=(a-u)*y,this._z=(s-r)*y}else if(n>l&&n>p){const y=2*Math.sqrt(1+n-l-p);this._w=(f-c)/y,this._x=.25*y,this._y=(r+s)/y,this._z=(a+u)/y}else if(l>p){const y=2*Math.sqrt(1+l-n-p);this._w=(a-u)/y,this._x=(r+s)/y,this._y=.25*y,this._z=(c+f)/y}else{const y=2*Math.sqrt(1+p-n-l);this._w=(s-r)/y,this._x=(a+u)/y,this._y=(c+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(clamp$1(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,a=t._z,s=t._w,l=e._x,c=e._y,u=e._z,f=e._w;return this._x=n*f+s*l+r*u-a*c,this._y=r*f+s*c+a*l-n*u,this._z=a*f+s*u+n*c-r*l,this._w=s*f-n*l-r*c-a*u,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,r=this._y,a=this._z,s=this._w;let l=s*t._w+n*t._x+r*t._y+a*t._z;if(l<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,l=-l):this.copy(t),l>=1)return this._w=s,this._x=n,this._y=r,this._z=a,this;const c=1-l*l;if(c<=Number.EPSILON){const y=1-e;return this._w=y*s+e*this._w,this._x=y*n+e*this._x,this._y=y*r+e*this._y,this._z=y*a+e*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(c),f=Math.atan2(u,l),p=Math.sin((1-e)*f)/u,g=Math.sin(e*f)/u;return this._w=s*p+this._w*g,this._x=n*p+this._x*g,this._y=r*p+this._y*g,this._z=a*p+this._z*g,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion$4.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[3]*n+a[6]*r,this.y=a[1]*e+a[4]*n+a[7]*r,this.z=a[2]*e+a[5]*n+a[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,a=t.elements,s=1/(a[3]*e+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*e+a[4]*n+a[8]*r+a[12])*s,this.y=(a[1]*e+a[5]*n+a[9]*r+a[13])*s,this.z=(a[2]*e+a[6]*n+a[10]*r+a[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,a=t.x,s=t.y,l=t.z,c=t.w,u=c*e+s*r-l*n,f=c*n+l*e-a*r,p=c*r+a*n-s*e,g=-a*e-s*n-l*r;return this.x=u*c+g*-a+f*-l-p*-s,this.y=f*c+g*-s+p*-a-u*-l,this.z=p*c+g*-l+u*-s-f*-a,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*r,this.y=a[1]*e+a[5]*n+a[9]*r,this.z=a[2]*e+a[6]*n+a[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,a=t.z,s=e.x,l=e.y,c=e.z;return this.x=r*c-a*l,this.y=a*s-n*c,this.z=n*l-r*s,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return _vector$c.copy(this).projectOnVector(t),this.sub(_vector$c)}reflect(t){return this.sub(_vector$c.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(clamp$1(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Vector3.prototype.isVector3=!0;const _vector$c=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(t=new Vector3(1/0,1/0,1/0),e=new Vector3(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,a=-1/0,s=-1/0,l=-1/0;for(let c=0,u=t.length;c<u;c+=3){const f=t[c],p=t[c+1],g=t[c+2];f<e&&(e=f),p<n&&(n=p),g<r&&(r=g),f>a&&(a=f),p>s&&(s=p),g>l&&(l=g)}return this.min.set(e,n,r),this.max.set(a,s,l),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,a=-1/0,s=-1/0,l=-1/0;for(let c=0,u=t.count;c<u;c++){const f=t.getX(c),p=t.getY(c),g=t.getZ(c);f<e&&(e=f),p<n&&(n=p),g<r&&(r=g),f>a&&(a=f),p>s&&(s=p),g>l&&(l=g)}return this.min.set(e,n,r),this.max.set(a,s,l),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=_vector$b.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),_box$3.copy(e.boundingBox),_box$3.applyMatrix4(t.matrixWorld),this.union(_box$3));const n=t.children;for(let r=0,a=n.length;r<a;r++)this.expandByObject(n[r]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_vector$b),_vector$b.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(t.a,_center),_v1$7.subVectors(t.b,_center),_v2$3.subVectors(t.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$3,_v1$7),_f2.subVectors(_v0$2,_v2$3);let e=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(e,_v0$2,_v1$7,_v2$3,_extents)||(e=[1,0,0,0,1,0,0,0,1],!satForAxes(e,_v0$2,_v1$7,_v2$3,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),e=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(e,_v0$2,_v1$7,_v2$3,_extents))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _vector$b.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(_vector$b).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Box3.prototype.isBox3=!0;const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$3=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(o,t,e,n,r){for(let a=0,s=o.length-3;a<=s;a+=3){_testAxis.fromArray(o,a);const l=r.x*Math.abs(_testAxis.x)+r.y*Math.abs(_testAxis.y)+r.z*Math.abs(_testAxis.z),c=t.dot(_testAxis),u=e.dot(_testAxis),f=n.dot(_testAxis);if(Math.max(-Math.max(c,u,f),Math.min(c,u,f))>l)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_toFarthestPoint=new Vector3,_toPoint=new Vector3;class Sphere{constructor(t=new Vector3,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):_box$2.setFromPoints(t).getCenter(n);let r=0;for(let a=0,s=t.length;a<s;a++)r=Math.max(r,n.distanceToSquared(t[a]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){_toPoint.subVectors(t,this.center);const e=_toPoint.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),r=(n-this.radius)*.5;this.center.add(_toPoint.multiplyScalar(r/n)),this.radius+=r}return this}union(t){return _toFarthestPoint.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(_v1$6.copy(t.center).add(_toFarthestPoint)),this.expandByPoint(_v1$6.copy(t.center).sub(_toFarthestPoint)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(t=new Vector3,e=new Vector3(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$a)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=_vector$a.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_vector$a.copy(this.direction).multiplyScalar(e).add(this.origin),_vector$a.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){_segCenter.copy(t).add(e).multiplyScalar(.5),_segDir.copy(e).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const a=t.distanceTo(e)*.5,s=-this.direction.dot(_segDir),l=_diff.dot(this.direction),c=-_diff.dot(_segDir),u=_diff.lengthSq(),f=Math.abs(1-s*s);let p,g,y,E;if(f>0)if(p=s*c-l,g=s*l-c,E=a*f,p>=0)if(g>=-E)if(g<=E){const h=1/f;p*=h,g*=h,y=p*(p+s*g+2*l)+g*(s*p+g+2*c)+u}else g=a,p=Math.max(0,-(s*g+l)),y=-p*p+g*(g+2*c)+u;else g=-a,p=Math.max(0,-(s*g+l)),y=-p*p+g*(g+2*c)+u;else g<=-E?(p=Math.max(0,-(-s*a+l)),g=p>0?-a:Math.min(Math.max(-a,-c),a),y=-p*p+g*(g+2*c)+u):g<=E?(p=0,g=Math.min(Math.max(-a,-c),a),y=g*(g+2*c)+u):(p=Math.max(0,-(s*a+l)),g=p>0?a:Math.min(Math.max(-a,-c),a),y=-p*p+g*(g+2*c)+u);else g=s>0?-a:a,p=Math.max(0,-(s*g+l)),y=-p*p+g*(g+2*c)+u;return n&&n.copy(this.direction).multiplyScalar(p).add(this.origin),r&&r.copy(_segDir).multiplyScalar(g).add(_segCenter),y}intersectSphere(t,e){_vector$a.subVectors(t.center,this.origin);const n=_vector$a.dot(this.direction),r=_vector$a.dot(_vector$a)-n*n,a=t.radius*t.radius;if(r>a)return null;const s=Math.sqrt(a-r),l=n-s,c=n+s;return l<0&&c<0?null:l<0?this.at(c,e):this.at(l,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,a,s,l,c;const u=1/this.direction.x,f=1/this.direction.y,p=1/this.direction.z,g=this.origin;return u>=0?(n=(t.min.x-g.x)*u,r=(t.max.x-g.x)*u):(n=(t.max.x-g.x)*u,r=(t.min.x-g.x)*u),f>=0?(a=(t.min.y-g.y)*f,s=(t.max.y-g.y)*f):(a=(t.max.y-g.y)*f,s=(t.min.y-g.y)*f),n>s||a>r||((a>n||n!==n)&&(n=a),(s<r||r!==r)&&(r=s),p>=0?(l=(t.min.z-g.z)*p,c=(t.max.z-g.z)*p):(l=(t.max.z-g.z)*p,c=(t.min.z-g.z)*p),n>c||l>r)||((l>n||n!==n)&&(n=l),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,e)}intersectsBox(t){return this.intersectBox(t,_vector$a)!==null}intersectTriangle(t,e,n,r,a){_edge1.subVectors(e,t),_edge2.subVectors(n,t),_normal$1.crossVectors(_edge1,_edge2);let s=this.direction.dot(_normal$1),l;if(s>0){if(r)return null;l=1}else if(s<0)l=-1,s=-s;else return null;_diff.subVectors(this.origin,t);const c=l*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(c<0)return null;const u=l*this.direction.dot(_edge1.cross(_diff));if(u<0||c+u>s)return null;const f=-l*_diff.dot(_normal$1);return f<0?null:this.at(f/s,a)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,a,s,l,c,u,f,p,g,y,E,h,v){const C=this.elements;return C[0]=t,C[4]=e,C[8]=n,C[12]=r,C[1]=a,C[5]=s,C[9]=l,C[13]=c,C[2]=u,C[6]=f,C[10]=p,C[14]=g,C[3]=y,C[7]=E,C[11]=h,C[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/_v1$5.setFromMatrixColumn(t,0).length(),a=1/_v1$5.setFromMatrixColumn(t,1).length(),s=1/_v1$5.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*a,e[5]=n[5]*a,e[6]=n[6]*a,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,a=t.z,s=Math.cos(n),l=Math.sin(n),c=Math.cos(r),u=Math.sin(r),f=Math.cos(a),p=Math.sin(a);if(t.order==="XYZ"){const g=s*f,y=s*p,E=l*f,h=l*p;e[0]=c*f,e[4]=-c*p,e[8]=u,e[1]=y+E*u,e[5]=g-h*u,e[9]=-l*c,e[2]=h-g*u,e[6]=E+y*u,e[10]=s*c}else if(t.order==="YXZ"){const g=c*f,y=c*p,E=u*f,h=u*p;e[0]=g+h*l,e[4]=E*l-y,e[8]=s*u,e[1]=s*p,e[5]=s*f,e[9]=-l,e[2]=y*l-E,e[6]=h+g*l,e[10]=s*c}else if(t.order==="ZXY"){const g=c*f,y=c*p,E=u*f,h=u*p;e[0]=g-h*l,e[4]=-s*p,e[8]=E+y*l,e[1]=y+E*l,e[5]=s*f,e[9]=h-g*l,e[2]=-s*u,e[6]=l,e[10]=s*c}else if(t.order==="ZYX"){const g=s*f,y=s*p,E=l*f,h=l*p;e[0]=c*f,e[4]=E*u-y,e[8]=g*u+h,e[1]=c*p,e[5]=h*u+g,e[9]=y*u-E,e[2]=-u,e[6]=l*c,e[10]=s*c}else if(t.order==="YZX"){const g=s*c,y=s*u,E=l*c,h=l*u;e[0]=c*f,e[4]=h-g*p,e[8]=E*p+y,e[1]=p,e[5]=s*f,e[9]=-l*f,e[2]=-u*f,e[6]=y*p+E,e[10]=g-h*p}else if(t.order==="XZY"){const g=s*c,y=s*u,E=l*c,h=l*u;e[0]=c*f,e[4]=-p,e[8]=u*f,e[1]=g*p+h,e[5]=s*f,e[9]=y*p-E,e[2]=E*p-y,e[6]=l*f,e[10]=h*p+g}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,e,n){const r=this.elements;return _z.subVectors(t,e),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(n,_z),_x.lengthSq()===0&&(Math.abs(n.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(n,_z)),_x.normalize(),_y.crossVectors(_z,_x),r[0]=_x.x,r[4]=_y.x,r[8]=_z.x,r[1]=_x.y,r[5]=_y.y,r[9]=_z.y,r[2]=_x.z,r[6]=_y.z,r[10]=_z.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,a=this.elements,s=n[0],l=n[4],c=n[8],u=n[12],f=n[1],p=n[5],g=n[9],y=n[13],E=n[2],h=n[6],v=n[10],C=n[14],x=n[3],w=n[7],_=n[11],S=n[15],M=r[0],T=r[4],R=r[8],P=r[12],I=r[1],B=r[5],W=r[9],D=r[13],O=r[2],z=r[6],G=r[10],k=r[14],$=r[3],Z=r[7],K=r[11],j=r[15];return a[0]=s*M+l*I+c*O+u*$,a[4]=s*T+l*B+c*z+u*Z,a[8]=s*R+l*W+c*G+u*K,a[12]=s*P+l*D+c*k+u*j,a[1]=f*M+p*I+g*O+y*$,a[5]=f*T+p*B+g*z+y*Z,a[9]=f*R+p*W+g*G+y*K,a[13]=f*P+p*D+g*k+y*j,a[2]=E*M+h*I+v*O+C*$,a[6]=E*T+h*B+v*z+C*Z,a[10]=E*R+h*W+v*G+C*K,a[14]=E*P+h*D+v*k+C*j,a[3]=x*M+w*I+_*O+S*$,a[7]=x*T+w*B+_*z+S*Z,a[11]=x*R+w*W+_*G+S*K,a[15]=x*P+w*D+_*k+S*j,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],a=t[12],s=t[1],l=t[5],c=t[9],u=t[13],f=t[2],p=t[6],g=t[10],y=t[14],E=t[3],h=t[7],v=t[11],C=t[15];return E*(+a*c*p-r*u*p-a*l*g+n*u*g+r*l*y-n*c*y)+h*(+e*c*y-e*u*g+a*s*g-r*s*y+r*u*f-a*c*f)+v*(+e*u*p-e*l*y-a*s*p+n*s*y+a*l*f-n*u*f)+C*(-r*l*f-e*c*p+e*l*g+r*s*p-n*s*g+n*c*f)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8],p=t[9],g=t[10],y=t[11],E=t[12],h=t[13],v=t[14],C=t[15],x=p*v*u-h*g*u+h*c*y-l*v*y-p*c*C+l*g*C,w=E*g*u-f*v*u-E*c*y+s*v*y+f*c*C-s*g*C,_=f*h*u-E*p*u+E*l*y-s*h*y-f*l*C+s*p*C,S=E*p*c-f*h*c-E*l*g+s*h*g+f*l*v-s*p*v,M=e*x+n*w+r*_+a*S;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/M;return t[0]=x*T,t[1]=(h*g*a-p*v*a-h*r*y+n*v*y+p*r*C-n*g*C)*T,t[2]=(l*v*a-h*c*a+h*r*u-n*v*u-l*r*C+n*c*C)*T,t[3]=(p*c*a-l*g*a-p*r*u+n*g*u+l*r*y-n*c*y)*T,t[4]=w*T,t[5]=(f*v*a-E*g*a+E*r*y-e*v*y-f*r*C+e*g*C)*T,t[6]=(E*c*a-s*v*a-E*r*u+e*v*u+s*r*C-e*c*C)*T,t[7]=(s*g*a-f*c*a+f*r*u-e*g*u-s*r*y+e*c*y)*T,t[8]=_*T,t[9]=(E*p*a-f*h*a-E*n*y+e*h*y+f*n*C-e*p*C)*T,t[10]=(s*h*a-E*l*a+E*n*u-e*h*u-s*n*C+e*l*C)*T,t[11]=(f*l*a-s*p*a-f*n*u+e*p*u+s*n*y-e*l*y)*T,t[12]=S*T,t[13]=(f*h*r-E*p*r+E*n*g-e*h*g-f*n*v+e*p*v)*T,t[14]=(E*l*r-s*h*r-E*n*c+e*h*c+s*n*v-e*l*v)*T,t[15]=(s*p*r-f*l*r+f*n*c-e*p*c-s*n*g+e*l*g)*T,this}scale(t){const e=this.elements,n=t.x,r=t.y,a=t.z;return e[0]*=n,e[4]*=r,e[8]*=a,e[1]*=n,e[5]*=r,e[9]*=a,e[2]*=n,e[6]*=r,e[10]*=a,e[3]*=n,e[7]*=r,e[11]*=a,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),a=1-n,s=t.x,l=t.y,c=t.z,u=a*s,f=a*l;return this.set(u*s+n,u*l-r*c,u*c+r*l,0,u*l+r*c,f*l+n,f*c-r*s,0,u*c-r*l,f*c+r*s,a*c*c+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,a,s){return this.set(1,n,a,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,a=e._x,s=e._y,l=e._z,c=e._w,u=a+a,f=s+s,p=l+l,g=a*u,y=a*f,E=a*p,h=s*f,v=s*p,C=l*p,x=c*u,w=c*f,_=c*p,S=n.x,M=n.y,T=n.z;return r[0]=(1-(h+C))*S,r[1]=(y+_)*S,r[2]=(E-w)*S,r[3]=0,r[4]=(y-_)*M,r[5]=(1-(g+C))*M,r[6]=(v+x)*M,r[7]=0,r[8]=(E+w)*T,r[9]=(v-x)*T,r[10]=(1-(g+h))*T,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let a=_v1$5.set(r[0],r[1],r[2]).length();const s=_v1$5.set(r[4],r[5],r[6]).length(),l=_v1$5.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),t.x=r[12],t.y=r[13],t.z=r[14],_m1$2.copy(this);const u=1/a,f=1/s,p=1/l;return _m1$2.elements[0]*=u,_m1$2.elements[1]*=u,_m1$2.elements[2]*=u,_m1$2.elements[4]*=f,_m1$2.elements[5]*=f,_m1$2.elements[6]*=f,_m1$2.elements[8]*=p,_m1$2.elements[9]*=p,_m1$2.elements[10]*=p,e.setFromRotationMatrix(_m1$2),n.x=a,n.y=s,n.z=l,this}makePerspective(t,e,n,r,a,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const l=this.elements,c=2*a/(e-t),u=2*a/(n-r),f=(e+t)/(e-t),p=(n+r)/(n-r),g=-(s+a)/(s-a),y=-2*s*a/(s-a);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=g,l[14]=y,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,n,r,a,s){const l=this.elements,c=1/(e-t),u=1/(n-r),f=1/(s-a),p=(e+t)*c,g=(n+r)*u,y=(s+a)*f;return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-g,l[2]=0,l[6]=0,l[10]=-2*f,l[14]=-y,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}Matrix4.prototype.isMatrix4=!0;const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$1=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(t=0,e=0,n=0,r=Euler.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,a=r[0],s=r[4],l=r[8],c=r[1],u=r[5],f=r[9],p=r[2],g=r[6],y=r[10];switch(e){case"XYZ":this._y=Math.asin(clamp$1(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(g,u),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$1(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,y),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-p,a),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$1(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(c,a));break;case"ZYX":this._y=Math.asin(-clamp$1(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(g,y),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(clamp$1(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(l,y));break;case"XZY":this._z=Math.asin(-clamp$1(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(g,u),this._y=Math.atan2(l,a)):(this._x=Math.atan2(-f,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return _matrix$1.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix$1,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0;Euler.DefaultOrder="XYZ";Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher$1{constructor(){super(),Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const t=new Vector3,e=new Euler,n=new Quaternion,r=new Vector3(1,1,1);function a(){n.setFromEuler(e,!1)}function s(){e.setFromQuaternion(n,void 0,!1)}e._onChange(a),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.premultiply(_q1),this}rotateX(t){return this.rotateOnAxis(_xAxis,t)}rotateY(t){return this.rotateOnAxis(_yAxis,t)}rotateZ(t){return this.rotateOnAxis(_zAxis,t)}translateOnAxis(t,e){return _v1$4.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_xAxis,t)}translateY(t){return this.translateOnAxis(_yAxis,t)}translateZ(t){return this.translateOnAxis(_zAxis,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?_target.copy(t):_target.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),r&&(_m1$1.extractRotation(r.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(_removedEvent)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(t.parent.matrixWorld)),t.applyMatrix4(_m1$1),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const s=this.children[n].getObjectByProperty(t,e);if(s!==void 0)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,t,_scale$2),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const r=this.children;for(let a=0,s=r.length;a<s;a++)r[a].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function a(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(t.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let u=0,f=c.length;u<f;u++){const p=c[u];a(t.shapes,p)}else a(t.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(a(t.materials,this.material[c]));r.material=l}else r.material=a(t.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(a(t.animations,c))}}if(e){const l=s(t.geometries),c=s(t.materials),u=s(t.textures),f=s(t.images),p=s(t.shapes),g=s(t.skeletons),y=s(t.animations);l.length>0&&(n.geometries=l),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),f.length>0&&(n.images=f),p.length>0&&(n.shapes=p),g.length>0&&(n.skeletons=g),y.length>0&&(n.animations=y)}return n.object=r,n;function s(l){const c=[];for(const u in l){const f=l[u];delete f.metadata,c.push(f)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const r=t.children[n];this.add(r.clone())}return this}}Object3D.DefaultUp=new Vector3(0,1,0);Object3D.DefaultMatrixAutoUpdate=!0;Object3D.prototype.isObject3D=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let Triangle$1=class ra{constructor(t=new Vector3,e=new Vector3,n=new Vector3){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),_v0$1.subVectors(t,e),r.cross(_v0$1);const a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}static getBarycoord(t,e,n,r,a){_v0$1.subVectors(r,e),_v1$3.subVectors(n,e),_v2$2.subVectors(t,e);const s=_v0$1.dot(_v0$1),l=_v0$1.dot(_v1$3),c=_v0$1.dot(_v2$2),u=_v1$3.dot(_v1$3),f=_v1$3.dot(_v2$2),p=s*u-l*l;if(p===0)return a.set(-2,-1,-1);const g=1/p,y=(u*c-l*f)*g,E=(s*f-l*c)*g;return a.set(1-y-E,E,y)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(t,e,n,r,a,s,l,c){return this.getBarycoord(t,e,n,r,_v3$1),c.set(0,0),c.addScaledVector(a,_v3$1.x),c.addScaledVector(s,_v3$1.y),c.addScaledVector(l,_v3$1.z),c}static isFrontFacing(t,e,n,r){return _v0$1.subVectors(n,e),_v1$3.subVectors(t,e),_v0$1.cross(_v1$3).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ra.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ra.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,a){return ra.getUV(t,this.a,this.b,this.c,e,n,r,a)}containsPoint(t){return ra.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ra.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,a=this.c;let s,l;_vab.subVectors(r,n),_vac.subVectors(a,n),_vap.subVectors(t,n);const c=_vab.dot(_vap),u=_vac.dot(_vap);if(c<=0&&u<=0)return e.copy(n);_vbp.subVectors(t,r);const f=_vab.dot(_vbp),p=_vac.dot(_vbp);if(f>=0&&p<=f)return e.copy(r);const g=c*p-f*u;if(g<=0&&c>=0&&f<=0)return s=c/(c-f),e.copy(n).addScaledVector(_vab,s);_vcp.subVectors(t,a);const y=_vab.dot(_vcp),E=_vac.dot(_vcp);if(E>=0&&y<=E)return e.copy(a);const h=y*u-c*E;if(h<=0&&u>=0&&E<=0)return l=u/(u-E),e.copy(n).addScaledVector(_vac,l);const v=f*E-y*p;if(v<=0&&p-f>=0&&y-E>=0)return _vbc.subVectors(a,r),l=(p-f)/(p-f+(y-E)),e.copy(r).addScaledVector(_vbc,l);const C=1/(v+h+g);return s=h*C,l=g*C,e.copy(n).addScaledVector(_vab,s).addScaledVector(_vac,l)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},materialId=0;class Material extends EventDispatcher$1{constructor(){super(),Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===FlatShading;continue}const r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(n.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(n.blending=this.blending),this.side!==FrontSide&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(a){const s=[];for(const l in a){const c=a[l];delete c.metadata,s.push(c)}return s}if(e){const a=r(t.textures),s=r(t.images);a.length>0&&(n.textures=a),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const r=e.length;n=new Array(r);for(let a=0;a!==r;++a)n[a]=e[a].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}Material.prototype.isMaterial=!0;const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(o,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?o+(t-o)*6*e:e<1/2?t:e<2/3?o+(t-o)*6*(2/3-e):o}function SRGBToLinear(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function LinearToSRGB(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}class Color{constructor(t,e,n){return e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=euclideanModulo(t,1),e=clamp$1(e,0,1),n=clamp$1(n,0,1),e===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,a=2*n-r;this.r=hue2rgb(a,r,t+1/3),this.g=hue2rgb(a,r,t),this.b=hue2rgb(a,r,t-1/3)}return this}setStyle(t){function e(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let r;const a=n[1],s=n[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const l=parseFloat(r[1])/360,c=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return e(r[4]),this.setHSL(l,c,u)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=n[1],a=r.length;if(a===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(a===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=_colorKeywords[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,r=this.b,a=Math.max(e,n,r),s=Math.min(e,n,r);let l,c;const u=(s+a)/2;if(s===a)l=0,c=0;else{const f=a-s;switch(c=u<=.5?f/(a+s):f/(2-a-s),a){case e:l=(n-r)/f+(n<r?6:0);break;case n:l=(r-e)/f+2;break;case r:l=(e-n)/f+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(t,e,n){return this.getHSL(_hslA),_hslA.h+=t,_hslA.s+=e,_hslA.l+=n,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(_hslA),t.getHSL(_hslB);const n=lerp(_hslA.h,_hslB.h,e),r=lerp(_hslA.s,_hslB.s,e),a=lerp(_hslA.l,_hslB.l,e);return this.setHSL(n,r,a),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=_colorKeywords;Color.prototype.isColor=!0;Color.prototype.r=1;Color.prototype.g=1;Color.prototype.b=1;class MeshBasicMaterial extends Material{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const _vector$9=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n===!0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let r=0,a=t.length;r<a;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Color),e[n++]=s.r,e[n++]=s.g,e[n++]=s.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let r=0,a=t.length;r<a;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Vector2),e[n++]=s.x,e[n++]=s.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let r=0,a=t.length;r<a;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new Vector3),e[n++]=s.x,e[n++]=s.y,e[n++]=s.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let r=0,a=t.length;r<a;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new Vector4),e[n++]=s.x,e[n++]=s.y,e[n++]=s.z,e[n++]=s.w}return this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)_vector2$1.fromBufferAttribute(this,e),_vector2$1.applyMatrix3(t),this.setXY(e,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.applyMatrix3(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.applyMatrix4(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.applyNormalMatrix(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.transformDirection(t),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,a){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=a,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==StaticDrawUsage&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}BufferAttribute.prototype.isBufferAttribute=!0;class Uint16BufferAttribute extends BufferAttribute{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Uint32BufferAttribute extends BufferAttribute{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Float16BufferAttribute extends BufferAttribute{constructor(t,e,n){super(new Uint16Array(t),e,n)}}Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;class Float32BufferAttribute extends BufferAttribute{constructor(t,e,n){super(new Float32Array(t),e,n)}}function arrayMax(o){if(o.length===0)return-1/0;let t=o[0];for(let e=1,n=o.length;e<n;++e)o[e]>t&&(t=o[e]);return t}let _id=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher$1{constructor(){super(),Object.defineProperty(this,"id",{value:_id++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const a=new Matrix3().getNormalMatrix(t);n.applyNormalMatrix(a),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return _m1.makeRotationFromQuaternion(t),this.applyMatrix4(_m1),this}rotateX(t){return _m1.makeRotationX(t),this.applyMatrix4(_m1),this}rotateY(t){return _m1.makeRotationY(t),this.applyMatrix4(_m1),this}rotateZ(t){return _m1.makeRotationZ(t),this.applyMatrix4(_m1),this}translate(t,e,n){return _m1.makeTranslation(t,e,n),this.applyMatrix4(_m1),this}scale(t,e,n){return _m1.makeScale(t,e,n),this.applyMatrix4(_m1),this}lookAt(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(t){const e=[];for(let n=0,r=t.length;n<r;n++){const a=t[n];e.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Float32BufferAttribute(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){const a=e[n];_box$1.setFromBufferAttribute(a),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(t){const n=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(t),e)for(let a=0,s=e.length;a<s;a++){const l=e[a];_boxMorphTargets.setFromBufferAttribute(l),this.morphTargetsRelative?(_vector$8.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$8),_vector$8.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$8)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(n);let r=0;for(let a=0,s=t.count;a<s;a++)_vector$8.fromBufferAttribute(t,a),r=Math.max(r,n.distanceToSquared(_vector$8));if(e)for(let a=0,s=e.length;a<s;a++){const l=e[a],c=this.morphTargetsRelative;for(let u=0,f=l.count;u<f;u++)_vector$8.fromBufferAttribute(l,u),c&&(_offset.fromBufferAttribute(t,u),_vector$8.add(_offset)),r=Math.max(r,n.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.array,r=e.position.array,a=e.normal.array,s=e.uv.array,l=r.length/3;e.tangent===void 0&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*l),4));const c=e.tangent.array,u=[],f=[];for(let I=0;I<l;I++)u[I]=new Vector3,f[I]=new Vector3;const p=new Vector3,g=new Vector3,y=new Vector3,E=new Vector2,h=new Vector2,v=new Vector2,C=new Vector3,x=new Vector3;function w(I,B,W){p.fromArray(r,I*3),g.fromArray(r,B*3),y.fromArray(r,W*3),E.fromArray(s,I*2),h.fromArray(s,B*2),v.fromArray(s,W*2),g.sub(p),y.sub(p),h.sub(E),v.sub(E);const D=1/(h.x*v.y-v.x*h.y);isFinite(D)&&(C.copy(g).multiplyScalar(v.y).addScaledVector(y,-h.y).multiplyScalar(D),x.copy(y).multiplyScalar(h.x).addScaledVector(g,-v.x).multiplyScalar(D),u[I].add(C),u[B].add(C),u[W].add(C),f[I].add(x),f[B].add(x),f[W].add(x))}let _=this.groups;_.length===0&&(_=[{start:0,count:n.length}]);for(let I=0,B=_.length;I<B;++I){const W=_[I],D=W.start,O=W.count;for(let z=D,G=D+O;z<G;z+=3)w(n[z+0],n[z+1],n[z+2])}const S=new Vector3,M=new Vector3,T=new Vector3,R=new Vector3;function P(I){T.fromArray(a,I*3),R.copy(T);const B=u[I];S.copy(B),S.sub(T.multiplyScalar(T.dot(B))).normalize(),M.crossVectors(R,B);const D=M.dot(f[I])<0?-1:1;c[I*4]=S.x,c[I*4+1]=S.y,c[I*4+2]=S.z,c[I*4+3]=D}for(let I=0,B=_.length;I<B;++I){const W=_[I],D=W.start,O=W.count;for(let z=D,G=D+O;z<G;z+=3)P(n[z+0]),P(n[z+1]),P(n[z+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new BufferAttribute(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let g=0,y=n.count;g<y;g++)n.setXYZ(g,0,0,0);const r=new Vector3,a=new Vector3,s=new Vector3,l=new Vector3,c=new Vector3,u=new Vector3,f=new Vector3,p=new Vector3;if(t)for(let g=0,y=t.count;g<y;g+=3){const E=t.getX(g+0),h=t.getX(g+1),v=t.getX(g+2);r.fromBufferAttribute(e,E),a.fromBufferAttribute(e,h),s.fromBufferAttribute(e,v),f.subVectors(s,a),p.subVectors(r,a),f.cross(p),l.fromBufferAttribute(n,E),c.fromBufferAttribute(n,h),u.fromBufferAttribute(n,v),l.add(f),c.add(f),u.add(f),n.setXYZ(E,l.x,l.y,l.z),n.setXYZ(h,c.x,c.y,c.z),n.setXYZ(v,u.x,u.y,u.z)}else for(let g=0,y=e.count;g<y;g+=3)r.fromBufferAttribute(e,g+0),a.fromBufferAttribute(e,g+1),s.fromBufferAttribute(e,g+2),f.subVectors(s,a),p.subVectors(r,a),f.cross(p),n.setXYZ(g+0,f.x,f.y,f.z),n.setXYZ(g+1,f.x,f.y,f.z),n.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(t.attributes[r]===void 0)continue;const s=n[r].array,l=t.attributes[r],c=l.array,u=l.itemSize*e,f=Math.min(c.length,s.length-u);for(let p=0,g=u;p<f;p++,g++)s[g]=c[p]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)_vector$8.fromBufferAttribute(t,e),_vector$8.normalize(),t.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function t(l,c){const u=l.array,f=l.itemSize,p=l.normalized,g=new u.constructor(c.length*f);let y=0,E=0;for(let h=0,v=c.length;h<v;h++){l.isInterleavedBufferAttribute?y=c[h]*l.data.stride+l.offset:y=c[h]*f;for(let C=0;C<f;C++)g[E++]=u[y++]}return new BufferAttribute(g,f,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new BufferGeometry,n=this.index.array,r=this.attributes;for(const l in r){const c=r[l],u=t(c,n);e.setAttribute(l,u)}const a=this.morphAttributes;for(const l in a){const c=[],u=a[l];for(let f=0,p=u.length;f<p;f++){const g=u[f],y=t(g,n);c.push(y)}e.morphAttributes[l]=c}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let l=0,c=s.length;l<c;l++){const u=s[l];e.addGroup(u.start,u.count,u.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(t[u]=c[u]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const c in n){const u=n[c];t.data.attributes[c]=u.toJSON(t.data)}const r={};let a=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],f=[];for(let p=0,g=u.length;p<g;p++){const y=u[p];f.push(y.toJSON(t.data))}f.length>0&&(r[c]=f,a=!0)}a&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const l=this.boundingSphere;return l!==null&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t}clone(){return new BufferGeometry().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone(e));const r=t.attributes;for(const u in r){const f=r[u];this.setAttribute(u,f.clone(e))}const a=t.morphAttributes;for(const u in a){const f=[],p=a[u];for(let g=0,y=p.length;g<y;g++)f.push(p[g].clone(e));this.morphAttributes[u]=f}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let u=0,f=s.length;u<f;u++){const p=s[u];this.addGroup(p.start,p.count,p.materialIndex)}const l=t.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}BufferGeometry.prototype.isBufferGeometry=!0;const _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(t=new BufferGeometry,e=new MeshBasicMaterial){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const r=e[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=r.length;a<s;a++){const l=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=a}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,r=this.material,a=this.matrixWorld;if(r===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$3.copy(n.boundingSphere),_sphere$3.applyMatrix4(a),t.ray.intersectsSphere(_sphere$3)===!1)||(_inverseMatrix$2.copy(a).invert(),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2),n.boundingBox!==null&&_ray$2.intersectsBox(n.boundingBox)===!1))return;let s;if(n.isBufferGeometry){const l=n.index,c=n.attributes.position,u=n.morphAttributes.position,f=n.morphTargetsRelative,p=n.attributes.uv,g=n.attributes.uv2,y=n.groups,E=n.drawRange;if(l!==null)if(Array.isArray(r))for(let h=0,v=y.length;h<v;h++){const C=y[h],x=r[C.materialIndex],w=Math.max(C.start,E.start),_=Math.min(C.start+C.count,E.start+E.count);for(let S=w,M=_;S<M;S+=3){const T=l.getX(S),R=l.getX(S+1),P=l.getX(S+2);s=checkBufferGeometryIntersection(this,x,t,_ray$2,c,u,f,p,g,T,R,P),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=C.materialIndex,e.push(s))}}else{const h=Math.max(0,E.start),v=Math.min(l.count,E.start+E.count);for(let C=h,x=v;C<x;C+=3){const w=l.getX(C),_=l.getX(C+1),S=l.getX(C+2);s=checkBufferGeometryIntersection(this,r,t,_ray$2,c,u,f,p,g,w,_,S),s&&(s.faceIndex=Math.floor(C/3),e.push(s))}}else if(c!==void 0)if(Array.isArray(r))for(let h=0,v=y.length;h<v;h++){const C=y[h],x=r[C.materialIndex],w=Math.max(C.start,E.start),_=Math.min(C.start+C.count,E.start+E.count);for(let S=w,M=_;S<M;S+=3){const T=S,R=S+1,P=S+2;s=checkBufferGeometryIntersection(this,x,t,_ray$2,c,u,f,p,g,T,R,P),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=C.materialIndex,e.push(s))}}else{const h=Math.max(0,E.start),v=Math.min(c.count,E.start+E.count);for(let C=h,x=v;C<x;C+=3){const w=C,_=C+1,S=C+2;s=checkBufferGeometryIntersection(this,r,t,_ray$2,c,u,f,p,g,w,_,S),s&&(s.faceIndex=Math.floor(C/3),e.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}Mesh.prototype.isMesh=!0;function checkIntersection(o,t,e,n,r,a,s,l){let c;if(t.side===BackSide?c=n.intersectTriangle(s,a,r,!0,l):c=n.intersectTriangle(r,a,s,t.side!==DoubleSide,l),c===null)return null;_intersectionPointWorld.copy(l),_intersectionPointWorld.applyMatrix4(o.matrixWorld);const u=e.ray.origin.distanceTo(_intersectionPointWorld);return u<e.near||u>e.far?null:{distance:u,point:_intersectionPointWorld.clone(),object:o}}function checkBufferGeometryIntersection(o,t,e,n,r,a,s,l,c,u,f,p){_vA$1.fromBufferAttribute(r,u),_vB$1.fromBufferAttribute(r,f),_vC$1.fromBufferAttribute(r,p);const g=o.morphTargetInfluences;if(a&&g){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(let E=0,h=a.length;E<h;E++){const v=g[E],C=a[E];v!==0&&(_tempA.fromBufferAttribute(C,u),_tempB.fromBufferAttribute(C,f),_tempC.fromBufferAttribute(C,p),s?(_morphA.addScaledVector(_tempA,v),_morphB.addScaledVector(_tempB,v),_morphC.addScaledVector(_tempC,v)):(_morphA.addScaledVector(_tempA.sub(_vA$1),v),_morphB.addScaledVector(_tempB.sub(_vB$1),v),_morphC.addScaledVector(_tempC.sub(_vC$1),v)))}_vA$1.add(_morphA),_vB$1.add(_morphB),_vC$1.add(_morphC)}o.isSkinnedMesh&&(o.boneTransform(u,_vA$1),o.boneTransform(f,_vB$1),o.boneTransform(p,_vC$1));const y=checkIntersection(o,t,e,n,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(y){l&&(_uvA$1.fromBufferAttribute(l,u),_uvB$1.fromBufferAttribute(l,f),_uvC$1.fromBufferAttribute(l,p),y.uv=Triangle$1.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),c&&(_uvA$1.fromBufferAttribute(c,u),_uvB$1.fromBufferAttribute(c,f),_uvC$1.fromBufferAttribute(c,p),y.uv2=Triangle$1.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2));const E={a:u,b:f,c:p,normal:new Vector3,materialIndex:0};Triangle$1.getNormal(_vA$1,_vB$1,_vC$1,E.normal),y.face=E}return y}class BoxGeometry extends BufferGeometry{constructor(t=1,e=1,n=1,r=1,a=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:a,depthSegments:s};const l=this;r=Math.floor(r),a=Math.floor(a),s=Math.floor(s);const c=[],u=[],f=[],p=[];let g=0,y=0;E("z","y","x",-1,-1,n,e,t,s,a,0),E("z","y","x",1,-1,n,e,-t,s,a,1),E("x","z","y",1,1,t,n,e,r,s,2),E("x","z","y",1,-1,t,n,-e,r,s,3),E("x","y","z",1,-1,t,e,n,r,a,4),E("x","y","z",-1,-1,t,e,-n,r,a,5),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(p,2));function E(h,v,C,x,w,_,S,M,T,R,P){const I=_/T,B=S/R,W=_/2,D=S/2,O=M/2,z=T+1,G=R+1;let k=0,$=0;const Z=new Vector3;for(let K=0;K<G;K++){const j=K*B-D;for(let Q=0;Q<z;Q++){const le=Q*I-W;Z[h]=le*x,Z[v]=j*w,Z[C]=O,u.push(Z.x,Z.y,Z.z),Z[h]=0,Z[v]=0,Z[C]=M>0?1:-1,f.push(Z.x,Z.y,Z.z),p.push(Q/T),p.push(1-K/R),k+=1}}for(let K=0;K<R;K++)for(let j=0;j<T;j++){const Q=g+j+z*K,le=g+j+z*(K+1),he=g+(j+1)+z*(K+1),ve=g+(j+1)+z*K;c.push(Q,le,ve),c.push(le,he,ve),$+=6}l.addGroup(y,$,P),y+=$,g+=k}}static fromJSON(t){return new BoxGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cloneUniforms(o){const t={};for(const e in o){t[e]={};for(const n in o[e]){const r=o[e][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[e][n]=r.clone():Array.isArray(r)?t[e][n]=r.slice():t[e][n]=r}}return t}function mergeUniforms(o){const t={};for(let e=0;e<o.length;e++){const n=cloneUniforms(o[e]);for(const r in n)t[r]=n[r]}return t}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){const s=this.uniforms[r].value;s&&s.isTexture?e.uniforms[r]={type:"t",value:s.toJSON(t).uuid}:s&&s.isColor?e.uniforms[r]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[r]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[r]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[r]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[r]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[r]={type:"m4",value:s.toArray()}:e.uniforms[r]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}ShaderMaterial.prototype.isShaderMaterial=!0;class Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Camera.prototype.isCamera=!0;class PerspectiveCamera extends Camera{constructor(t=50,e=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,r,a,s){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,n=2*e,r=this.aspect*n,a=-.5*r;const s=this.view;if(this.view!==null&&this.view.enabled){const c=s.fullWidth,u=s.fullHeight;a+=s.offsetX*r/c,e-=s.offsetY*n/u,r*=s.width/c,n*=s.height/u}const l=this.filmOffset;l!==0&&(a+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}PerspectiveCamera.prototype.isPerspectiveCamera=!0;const fov=90,aspect=1;class CubeCamera extends Object3D{constructor(t,e,n){if(super(),this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const r=new PerspectiveCamera(fov,aspect,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Vector3(1,0,0)),this.add(r);const a=new PerspectiveCamera(fov,aspect,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(-1,0,0)),this.add(a);const s=new PerspectiveCamera(fov,aspect,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Vector3(0,1,0)),this.add(s);const l=new PerspectiveCamera(fov,aspect,t,e);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new Vector3(0,-1,0)),this.add(l);const c=new PerspectiveCamera(fov,aspect,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Vector3(0,0,1)),this.add(c);const u=new PerspectiveCamera(fov,aspect,t,e);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Vector3(0,0,-1)),this.add(u)}update(t,e){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[r,a,s,l,c,u]=this.children,f=t.xr.enabled,p=t.getRenderTarget();t.xr.enabled=!1;const g=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,a),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,l),t.setRenderTarget(n,4),t.render(e,c),n.texture.generateMipmaps=g,t.setRenderTarget(n,5),t.render(e,u),t.setRenderTarget(p),t.xr.enabled=f}}class CubeTexture extends Texture{constructor(t,e,n,r,a,s,l,c,u,f){t=t!==void 0?t:[],e=e!==void 0?e:CubeReflectionMapping,l=l!==void 0?l:RGBFormat,super(t,e,n,r,a,s,l,c,u,f),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new CubeTexture(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:LinearFilter,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=RGBAFormat,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new BoxGeometry(5,5,5),a=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:BackSide,blending:NoBlending});a.uniforms.tEquirect.value=e;const s=new Mesh(r,a),l=e.minFilter;return e.minFilter===LinearMipmapLinearFilter&&(e.minFilter=LinearFilter),new CubeCamera(1,10,this).update(t,s),e.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const a=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,n,r);t.setRenderTarget(a)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(t=new Vector3(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=_vector1.subVectors(n,e).cross(_vector2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(_vector1),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const a=-(t.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:e.copy(n).multiplyScalar(a).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||_normalMatrix.getNormalMatrix(t),r=this.coplanarPoint(_vector1).applyMatrix4(t),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}Plane.prototype.isPlane=!0;const _sphere$2=new Sphere,_vector$7=new Vector3;class Frustum{constructor(t=new Plane,e=new Plane,n=new Plane,r=new Plane,a=new Plane,s=new Plane){this.planes=[t,e,n,r,a,s]}set(t,e,n,r,a,s){const l=this.planes;return l[0].copy(t),l[1].copy(e),l[2].copy(n),l[3].copy(r),l[4].copy(a),l[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],a=n[1],s=n[2],l=n[3],c=n[4],u=n[5],f=n[6],p=n[7],g=n[8],y=n[9],E=n[10],h=n[11],v=n[12],C=n[13],x=n[14],w=n[15];return e[0].setComponents(l-r,p-c,h-g,w-v).normalize(),e[1].setComponents(l+r,p+c,h+g,w+v).normalize(),e[2].setComponents(l+a,p+u,h+y,w+C).normalize(),e[3].setComponents(l-a,p-u,h-y,w-C).normalize(),e[4].setComponents(l-s,p-f,h-E,w-x).normalize(),e[5].setComponents(l+s,p+f,h+E,w+x).normalize(),this}intersectsObject(t){const e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$2.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSprite(t){return _sphere$2.center.set(0,0,0),_sphere$2.radius=.7071067811865476,_sphere$2.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let a=0;a<6;a++)if(e[a].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(_vector$7.x=r.normal.x>0?t.max.x:t.min.x,_vector$7.y=r.normal.y>0?t.max.y:t.min.y,_vector$7.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let o=null,t=!1,e=null,n=null;function r(a,s){e(a,s),n=o.requestAnimationFrame(r)}return{start:function(){t!==!0&&e!==null&&(n=o.requestAnimationFrame(r),t=!0)},stop:function(){o.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(a){e=a},setContext:function(a){o=a}}}function WebGLAttributes(o,t){const e=t.isWebGL2,n=new WeakMap;function r(u,f){const p=u.array,g=u.usage,y=o.createBuffer();o.bindBuffer(f,y),o.bufferData(f,p,g),u.onUploadCallback();let E=5126;return p instanceof Float32Array?E=5126:p instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):p instanceof Uint16Array?u.isFloat16BufferAttribute?e?E=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):E=5123:p instanceof Int16Array?E=5122:p instanceof Uint32Array?E=5125:p instanceof Int32Array?E=5124:p instanceof Int8Array?E=5120:(p instanceof Uint8Array||p instanceof Uint8ClampedArray)&&(E=5121),{buffer:y,type:E,bytesPerElement:p.BYTES_PER_ELEMENT,version:u.version}}function a(u,f,p){const g=f.array,y=f.updateRange;o.bindBuffer(p,u),y.count===-1?o.bufferSubData(p,0,g):(e?o.bufferSubData(p,y.offset*g.BYTES_PER_ELEMENT,g,y.offset,y.count):o.bufferSubData(p,y.offset*g.BYTES_PER_ELEMENT,g.subarray(y.offset,y.offset+y.count)),y.count=-1)}function s(u){return u.isInterleavedBufferAttribute&&(u=u.data),n.get(u)}function l(u){u.isInterleavedBufferAttribute&&(u=u.data);const f=n.get(u);f&&(o.deleteBuffer(f.buffer),n.delete(u))}function c(u,f){if(u.isGLBufferAttribute){const g=n.get(u);(!g||g.version<u.version)&&n.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const p=n.get(u);p===void 0?n.set(u,r(u,f)):p.version<u.version&&(a(p.buffer,u,f),p.version=u.version)}return{get:s,remove:l,update:c}}class PlaneGeometry extends BufferGeometry{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const a=t/2,s=e/2,l=Math.floor(n),c=Math.floor(r),u=l+1,f=c+1,p=t/l,g=e/c,y=[],E=[],h=[],v=[];for(let C=0;C<f;C++){const x=C*g-s;for(let w=0;w<u;w++){const _=w*p-a;E.push(_,-x,0),h.push(0,0,1),v.push(w/l),v.push(1-C/c)}}for(let C=0;C<c;C++)for(let x=0;x<l;x++){const w=x+u*C,_=x+u*(C+1),S=x+1+u*(C+1),M=x+1+u*C;y.push(w,_,M),y.push(_,S,M)}this.setIndex(y),this.setAttribute("position",new Float32BufferAttribute(E,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(v,2))}static fromJSON(t){return new PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments)}}var alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in vec3 f90, const in float dotVH ) {
	float fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );
	return ( f90 - f0 ) * fresnel + f0;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in vec3 f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, vec3( 1.0 ), dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	#ifdef SPECULAR
		vec3 specularIntensityFactor = vec3( specularIntensity );
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularColorF90 = mix( specularIntensityFactor, vec3( 1.0 ), metalnessFactor );
	#else
		vec3 specularIntensityFactor = vec3( 1.0 );
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularColorF90 = vec3( 1.0 );
	#endif
	material.specularColor = mix( min( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
	material.specularColorF90 = vec3( 1.0 );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
	vec3 specularColorF90;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), vec3( 1.0 ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularColorF90, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 transmission = transmissionFactor * getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,uv_pars_fragment=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
		#ifdef USE_TANGENT
			vTangent = normalize( transformedTangent );
			vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
		#endif
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,normal_frag=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const ShaderChunk={alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,encodings_fragment,encodings_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_vertex,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,uv2_pars_fragment,uv2_pars_vertex,uv2_vertex,worldpos_vertex,background_frag,background_vert,cube_frag,cube_vert,depth_frag,depth_vert,distanceRGBA_frag,distanceRGBA_vert,equirect_frag,equirect_vert,linedashed_frag,linedashed_vert,meshbasic_frag,meshbasic_vert,meshlambert_frag,meshlambert_vert,meshmatcap_frag,meshmatcap_vert,meshtoon_frag,meshtoon_vert,meshphong_frag,meshphong_vert,meshphysical_frag,meshphysical_vert,normal_frag,normal_vert,points_frag,points_vert,shadow_frag,shadow_vert,sprite_frag,sprite_vert},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Color(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Color(1,1,1)},specularTintMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};function WebGLBackground(o,t,e,n,r){const a=new Color(0);let s=0,l,c,u=null,f=0,p=null;function g(E,h){let v=!1,C=h.isScene===!0?h.background:null;C&&C.isTexture&&(C=t.get(C));const x=o.xr,w=x.getSession&&x.getSession();w&&w.environmentBlendMode==="additive"&&(C=null),C===null?y(a,s):C&&C.isColor&&(y(C,1),v=!0),(o.autoClear||v)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),C&&(C.isCubeTexture||C.mapping===CubeUVReflectionMapping)?(c===void 0&&(c=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(_,S,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=C,c.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,(u!==C||f!==C.version||p!==o.toneMapping)&&(c.material.needsUpdate=!0,u=C,f=C.version,p=o.toneMapping),E.unshift(c,c.geometry,c.material,0,0,null)):C&&C.isTexture&&(l===void 0&&(l=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=C,C.matrixAutoUpdate===!0&&C.updateMatrix(),l.material.uniforms.uvTransform.value.copy(C.matrix),(u!==C||f!==C.version||p!==o.toneMapping)&&(l.material.needsUpdate=!0,u=C,f=C.version,p=o.toneMapping),E.unshift(l,l.geometry,l.material,0,0,null))}function y(E,h){e.buffers.color.setClear(E.r,E.g,E.b,h,r)}return{getClearColor:function(){return a},setClearColor:function(E,h=1){a.set(E),s=h,y(a,s)},getClearAlpha:function(){return s},setClearAlpha:function(E){s=E,y(a,s)},render:g}}function WebGLBindingStates(o,t,e,n){const r=o.getParameter(34921),a=n.isWebGL2?null:t.get("OES_vertex_array_object"),s=n.isWebGL2||a!==null,l={},c=h(null);let u=c;function f(D,O,z,G,k){let $=!1;if(s){const Z=E(G,z,O);u!==Z&&(u=Z,g(u.object)),$=v(G,k),$&&C(G,k)}else{const Z=O.wireframe===!0;(u.geometry!==G.id||u.program!==z.id||u.wireframe!==Z)&&(u.geometry=G.id,u.program=z.id,u.wireframe=Z,$=!0)}D.isInstancedMesh===!0&&($=!0),k!==null&&e.update(k,34963),$&&(T(D,O,z,G),k!==null&&o.bindBuffer(34963,e.get(k).buffer))}function p(){return n.isWebGL2?o.createVertexArray():a.createVertexArrayOES()}function g(D){return n.isWebGL2?o.bindVertexArray(D):a.bindVertexArrayOES(D)}function y(D){return n.isWebGL2?o.deleteVertexArray(D):a.deleteVertexArrayOES(D)}function E(D,O,z){const G=z.wireframe===!0;let k=l[D.id];k===void 0&&(k={},l[D.id]=k);let $=k[O.id];$===void 0&&($={},k[O.id]=$);let Z=$[G];return Z===void 0&&(Z=h(p()),$[G]=Z),Z}function h(D){const O=[],z=[],G=[];for(let k=0;k<r;k++)O[k]=0,z[k]=0,G[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:z,attributeDivisors:G,object:D,attributes:{},index:null}}function v(D,O){const z=u.attributes,G=D.attributes;let k=0;for(const $ in G){const Z=z[$],K=G[$];if(Z===void 0||Z.attribute!==K||Z.data!==K.data)return!0;k++}return u.attributesNum!==k||u.index!==O}function C(D,O){const z={},G=D.attributes;let k=0;for(const $ in G){const Z=G[$],K={};K.attribute=Z,Z.data&&(K.data=Z.data),z[$]=K,k++}u.attributes=z,u.attributesNum=k,u.index=O}function x(){const D=u.newAttributes;for(let O=0,z=D.length;O<z;O++)D[O]=0}function w(D){_(D,0)}function _(D,O){const z=u.newAttributes,G=u.enabledAttributes,k=u.attributeDivisors;z[D]=1,G[D]===0&&(o.enableVertexAttribArray(D),G[D]=1),k[D]!==O&&((n.isWebGL2?o:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,O),k[D]=O)}function S(){const D=u.newAttributes,O=u.enabledAttributes;for(let z=0,G=O.length;z<G;z++)O[z]!==D[z]&&(o.disableVertexAttribArray(z),O[z]=0)}function M(D,O,z,G,k,$){n.isWebGL2===!0&&(z===5124||z===5125)?o.vertexAttribIPointer(D,O,z,k,$):o.vertexAttribPointer(D,O,z,G,k,$)}function T(D,O,z,G){if(n.isWebGL2===!1&&(D.isInstancedMesh||G.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();const k=G.attributes,$=z.getAttributes(),Z=O.defaultAttributeValues;for(const K in $){const j=$[K];if(j>=0){const Q=k[K];if(Q!==void 0){const le=Q.normalized,he=Q.itemSize,ve=e.get(Q);if(ve===void 0)continue;const re=ve.buffer,Ie=ve.type,ge=ve.bytesPerElement;if(Q.isInterleavedBufferAttribute){const Se=Q.data,Le=Se.stride,be=Q.offset;Se&&Se.isInstancedInterleavedBuffer?(_(j,Se.meshPerAttribute),G._maxInstanceCount===void 0&&(G._maxInstanceCount=Se.meshPerAttribute*Se.count)):w(j),o.bindBuffer(34962,re),M(j,he,Ie,le,Le*ge,be*ge)}else Q.isInstancedBufferAttribute?(_(j,Q.meshPerAttribute),G._maxInstanceCount===void 0&&(G._maxInstanceCount=Q.meshPerAttribute*Q.count)):w(j),o.bindBuffer(34962,re),M(j,he,Ie,le,0,0)}else if(K==="instanceMatrix"){const le=e.get(D.instanceMatrix);if(le===void 0)continue;const he=le.buffer,ve=le.type;_(j+0,1),_(j+1,1),_(j+2,1),_(j+3,1),o.bindBuffer(34962,he),o.vertexAttribPointer(j+0,4,ve,!1,64,0),o.vertexAttribPointer(j+1,4,ve,!1,64,16),o.vertexAttribPointer(j+2,4,ve,!1,64,32),o.vertexAttribPointer(j+3,4,ve,!1,64,48)}else if(K==="instanceColor"){const le=e.get(D.instanceColor);if(le===void 0)continue;const he=le.buffer,ve=le.type;_(j,1),o.bindBuffer(34962,he),o.vertexAttribPointer(j,3,ve,!1,12,0)}else if(Z!==void 0){const le=Z[K];if(le!==void 0)switch(le.length){case 2:o.vertexAttrib2fv(j,le);break;case 3:o.vertexAttrib3fv(j,le);break;case 4:o.vertexAttrib4fv(j,le);break;default:o.vertexAttrib1fv(j,le)}}}}S()}function R(){B();for(const D in l){const O=l[D];for(const z in O){const G=O[z];for(const k in G)y(G[k].object),delete G[k];delete O[z]}delete l[D]}}function P(D){if(l[D.id]===void 0)return;const O=l[D.id];for(const z in O){const G=O[z];for(const k in G)y(G[k].object),delete G[k];delete O[z]}delete l[D.id]}function I(D){for(const O in l){const z=l[O];if(z[D.id]===void 0)continue;const G=z[D.id];for(const k in G)y(G[k].object),delete G[k];delete z[D.id]}}function B(){W(),u!==c&&(u=c,g(u.object))}function W(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:f,reset:B,resetDefaultState:W,dispose:R,releaseStatesOfGeometry:P,releaseStatesOfProgram:I,initAttributes:x,enableAttribute:w,disableUnusedAttributes:S}}function WebGLBufferRenderer(o,t,e,n){const r=n.isWebGL2;let a;function s(u){a=u}function l(u,f){o.drawArrays(a,u,f),e.update(f,a,1)}function c(u,f,p){if(p===0)return;let g,y;if(r)g=o,y="drawArraysInstanced";else if(g=t.get("ANGLE_instanced_arrays"),y="drawArraysInstancedANGLE",g===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[y](a,u,f,p),e.update(f,a,p)}this.setMode=s,this.render=l,this.renderInstances=c}function WebGLCapabilities(o,t,e){let n;function r(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const T=t.get("EXT_texture_filter_anisotropic");n=o.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function a(T){if(T==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";T="mediump"}return T==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&o instanceof WebGL2ComputeRenderingContext;let l=e.precision!==void 0?e.precision:"highp";const c=a(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);const u=s||t.has("WEBGL_draw_buffers"),f=e.logarithmicDepthBuffer===!0,p=o.getParameter(34930),g=o.getParameter(35660),y=o.getParameter(3379),E=o.getParameter(34076),h=o.getParameter(34921),v=o.getParameter(36347),C=o.getParameter(36348),x=o.getParameter(36349),w=g>0,_=s||t.has("OES_texture_float"),S=w&&_,M=s?o.getParameter(36183):0;return{isWebGL2:s,drawBuffers:u,getMaxAnisotropy:r,getMaxPrecision:a,precision:l,logarithmicDepthBuffer:f,maxTextures:p,maxVertexTextures:g,maxTextureSize:y,maxCubemapSize:E,maxAttributes:h,maxVertexUniforms:v,maxVaryings:C,maxFragmentUniforms:x,vertexTextures:w,floatFragmentTextures:_,floatVertexTextures:S,maxSamples:M}}function WebGLClipping(o){const t=this;let e=null,n=0,r=!1,a=!1;const s=new Plane,l=new Matrix3,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(p,g,y){const E=p.length!==0||g||n!==0||r;return r=g,e=f(p,y,0),n=p.length,E},this.beginShadows=function(){a=!0,f(null)},this.endShadows=function(){a=!1,u()},this.setState=function(p,g,y){const E=p.clippingPlanes,h=p.clipIntersection,v=p.clipShadows,C=o.get(p);if(!r||E===null||E.length===0||a&&!v)a?f(null):u();else{const x=a?0:n,w=x*4;let _=C.clippingState||null;c.value=_,_=f(E,g,w,y);for(let S=0;S!==w;++S)_[S]=e[S];C.clippingState=_,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=x}};function u(){c.value!==e&&(c.value=e,c.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function f(p,g,y,E){const h=p!==null?p.length:0;let v=null;if(h!==0){if(v=c.value,E!==!0||v===null){const C=y+h*4,x=g.matrixWorldInverse;l.getNormalMatrix(x),(v===null||v.length<C)&&(v=new Float32Array(C));for(let w=0,_=y;w!==h;++w,_+=4)s.copy(p[w]).applyMatrix4(x,l),s.normal.toArray(v,_),v[_+3]=s.constant}c.value=v,c.needsUpdate=!0}return t.numPlanes=h,t.numIntersection=0,v}}function WebGLCubeMaps(o){let t=new WeakMap;function e(s,l){return l===EquirectangularReflectionMapping?s.mapping=CubeReflectionMapping:l===EquirectangularRefractionMapping&&(s.mapping=CubeRefractionMapping),s}function n(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const l=s.mapping;if(l===EquirectangularReflectionMapping||l===EquirectangularRefractionMapping)if(t.has(s)){const c=t.get(s).texture;return e(c,s.mapping)}else{const c=s.image;if(c&&c.height>0){const u=o.getRenderTarget(),f=new WebGLCubeRenderTarget(c.height/2);return f.fromEquirectangularTexture(o,s),t.set(s,f),o.setRenderTarget(u),s.addEventListener("dispose",r),e(f.texture,s.mapping)}else return null}}return s}function r(s){const l=s.target;l.removeEventListener("dispose",r);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap}return{get:n,dispose:a}}class OrthographicCamera extends Camera{constructor(t=-1,e=1,n=1,r=-1,a=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=a,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,a,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let a=n-t,s=n+t,l=r+e,c=r-e;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=u*this.view.offsetX,s=a+u*this.view.width,l-=f*this.view.offsetY,c=l-f*this.view.height}this.projectionMatrix.makeOrthographic(a,s,l,c,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}OrthographicCamera.prototype.isOrthographicCamera=!0;class RawShaderMaterial extends ShaderMaterial{constructor(t){super(t),this.type="RawShaderMaterial"}}RawShaderMaterial.prototype.isRawShaderMaterial=!0;const LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6},backgroundMaterial=new MeshBasicMaterial({side:BackSide,depthWrite:!1,depthTest:!1}),backgroundBox=new Mesh(new BoxGeometry,backgroundMaterial),_flatCamera=new OrthographicCamera,{_lodPlanes,_sizeLods,_sigmas}=_createPlanes(),_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];function convertLinearToRGBE(o){const t=Math.max(o.r,o.g,o.b),e=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);return o.multiplyScalar(Math.pow(2,-e)),(e+128)/255}class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=_getBlurShader(MAX_SAMPLES),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){_oldTarget=this._renderer.getRenderTarget();const a=this._allocateTargets();return this._sceneToCubeUV(t,n,r,a),e>0&&this._blur(a,0,0,e),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let t=0;t<_lodPlanes.length;t++)_lodPlanes[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(_oldTarget),t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t){_oldTarget=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(t)?t.encoding:RGBEEncoding,depthBuffer:!1},n=_createRenderTarget(e);return n.depthBuffer=!t,this._pingPongRenderTarget=_createRenderTarget(e),n}_compileMaterial(t){const e=new Mesh(_lodPlanes[0],t);this._renderer.compile(e,_flatCamera)}_sceneToCubeUV(t,e,n,r){const l=new PerspectiveCamera(90,1,e,n),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],f=this._renderer,p=f.autoClear,g=f.outputEncoding,y=f.toneMapping;f.getClearColor(_clearColor),f.toneMapping=NoToneMapping,f.outputEncoding=LinearEncoding,f.autoClear=!1;let E=!1;const h=t.background;if(h){if(h.isColor){backgroundMaterial.color.copy(h).convertSRGBToLinear(),t.background=null;const v=convertLinearToRGBE(backgroundMaterial.color);backgroundMaterial.opacity=v,E=!0}}else{backgroundMaterial.color.copy(_clearColor).convertSRGBToLinear();const v=convertLinearToRGBE(backgroundMaterial.color);backgroundMaterial.opacity=v,E=!0}for(let v=0;v<6;v++){const C=v%3;C==0?(l.up.set(0,c[v],0),l.lookAt(u[v],0,0)):C==1?(l.up.set(0,0,c[v]),l.lookAt(0,u[v],0)):(l.up.set(0,c[v],0),l.lookAt(0,0,u[v])),_setViewport(r,C*SIZE_MAX,v>2?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),f.setRenderTarget(r),E&&f.render(backgroundBox,l),f.render(t,l)}f.toneMapping=y,f.outputEncoding=g,f.autoClear=p}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=_getCubemapShader()):this._equirectShader==null&&(this._equirectShader=_getEquirectShader());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,a=new Mesh(_lodPlanes[0],r),s=r.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=ENCODINGS[t.encoding],s.outputEncoding.value=ENCODINGS[e.texture.encoding],_setViewport(e,0,0,3*SIZE_MAX,2*SIZE_MAX),n.setRenderTarget(e),n.render(a,_flatCamera)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let r=1;r<TOTAL_LODS;r++){const a=Math.sqrt(_sigmas[r]*_sigmas[r]-_sigmas[r-1]*_sigmas[r-1]),s=_axisDirections[(r-1)%_axisDirections.length];this._blur(t,r-1,r,a,s)}e.autoClear=n}_blur(t,e,n,r,a){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",a),this._halfBlur(s,t,n,n,r,"longitudinal",a)}_halfBlur(t,e,n,r,a,s,l){const c=this._renderer,u=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,p=new Mesh(_lodPlanes[r],u),g=u.uniforms,y=_sizeLods[n]-1,E=isFinite(a)?Math.PI/(2*y):2*Math.PI/(2*MAX_SAMPLES-1),h=a/E,v=isFinite(a)?1+Math.floor(f*h):MAX_SAMPLES;v>MAX_SAMPLES&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${MAX_SAMPLES}`);const C=[];let x=0;for(let M=0;M<MAX_SAMPLES;++M){const T=M/h,R=Math.exp(-T*T/2);C.push(R),M==0?x+=R:M<v&&(x+=2*R)}for(let M=0;M<C.length;M++)C[M]=C[M]/x;g.envMap.value=t.texture,g.samples.value=v,g.weights.value=C,g.latitudinal.value=s==="latitudinal",l&&(g.poleAxis.value=l),g.dTheta.value=E,g.mipInt.value=LOD_MAX-n,g.inputEncoding.value=ENCODINGS[t.texture.encoding],g.outputEncoding.value=ENCODINGS[t.texture.encoding];const w=_sizeLods[r],_=3*Math.max(0,SIZE_MAX-2*w),S=(r===0?0:2*SIZE_MAX)+2*w*(r>LOD_MAX-LOD_MIN?r-LOD_MAX+LOD_MIN:0);_setViewport(e,_,S,3*w,2*w),c.setRenderTarget(e),c.render(p,_flatCamera)}}function _isLDR(o){return o===void 0||o.type!==UnsignedByteType?!1:o.encoding===LinearEncoding||o.encoding===sRGBEncoding||o.encoding===GammaEncoding}function _createPlanes(){const o=[],t=[],e=[];let n=LOD_MAX;for(let r=0;r<TOTAL_LODS;r++){const a=Math.pow(2,n);t.push(a);let s=1/a;r>LOD_MAX-LOD_MIN?s=EXTRA_LOD_SIGMA[r-LOD_MAX+LOD_MIN-1]:r==0&&(s=0),e.push(s);const l=1/(a-1),c=-l/2,u=1+l/2,f=[c,c,u,c,u,u,c,c,u,u,c,u],p=6,g=6,y=3,E=2,h=1,v=new Float32Array(y*g*p),C=new Float32Array(E*g*p),x=new Float32Array(h*g*p);for(let _=0;_<p;_++){const S=_%3*2/3-1,M=_>2?0:-1,T=[S,M,0,S+2/3,M,0,S+2/3,M+1,0,S,M,0,S+2/3,M+1,0,S,M+1,0];v.set(T,y*g*_),C.set(f,E*g*_);const R=[_,_,_,_,_,_];x.set(R,h*g*_)}const w=new BufferGeometry;w.setAttribute("position",new BufferAttribute(v,y)),w.setAttribute("uv",new BufferAttribute(C,E)),w.setAttribute("faceIndex",new BufferAttribute(x,h)),o.push(w),n>LOD_MIN&&n--}return{_lodPlanes:o,_sizeLods:t,_sigmas:e}}function _createRenderTarget(o){const t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,o);return t.texture.mapping=CubeUVReflectionMapping,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _setViewport(o,t,e,n,r){o.viewport.set(t,e,n,r),o.scissor.set(t,e,n,r)}function _getBlurShader(o){const t=new Float32Array(o),e=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:o},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${_getEncodings()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectShader(){const o=new Vector2(1,1);return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:o},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${_getEncodings()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${_getEncodings()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function _getEncodings(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function WebGLCubeUVMaps(o){let t=new WeakMap,e=null;function n(l){if(l&&l.isTexture&&l.isRenderTargetTexture===!1){const c=l.mapping,u=c===EquirectangularReflectionMapping||c===EquirectangularRefractionMapping,f=c===CubeReflectionMapping||c===CubeRefractionMapping;if(u||f){if(t.has(l))return t.get(l).texture;{const p=l.image;if(u&&p&&p.height>0||f&&p&&r(p)){const g=o.getRenderTarget();e===null&&(e=new PMREMGenerator(o));const y=u?e.fromEquirectangular(l):e.fromCubemap(l);return t.set(l,y),o.setRenderTarget(g),l.addEventListener("dispose",a),y.texture}else return null}}}return l}function r(l){let c=0;const u=6;for(let f=0;f<u;f++)l[f]!==void 0&&c++;return c===u}function a(l){const c=l.target;c.removeEventListener("dispose",a);const u=t.get(c);u!==void 0&&(u.delete(c),u.dispose())}function s(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:s}}function WebGLExtensions(o){const t={};function e(n){if(t[n]!==void 0)return t[n];let r;switch(n){case"WEBGL_depth_texture":r=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=o.getExtension(n)}return t[n]=r,r}return{has:function(n){return e(n)!==null},init:function(n){n.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float")},get:function(n){const r=e(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function WebGLGeometries(o,t,e,n){const r={},a=new WeakMap;function s(p){const g=p.target;g.index!==null&&t.remove(g.index);for(const E in g.attributes)t.remove(g.attributes[E]);g.removeEventListener("dispose",s),delete r[g.id];const y=a.get(g);y&&(t.remove(y),a.delete(g)),n.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,e.memory.geometries--}function l(p,g){return r[g.id]===!0||(g.addEventListener("dispose",s),r[g.id]=!0,e.memory.geometries++),g}function c(p){const g=p.attributes;for(const E in g)t.update(g[E],34962);const y=p.morphAttributes;for(const E in y){const h=y[E];for(let v=0,C=h.length;v<C;v++)t.update(h[v],34962)}}function u(p){const g=[],y=p.index,E=p.attributes.position;let h=0;if(y!==null){const x=y.array;h=y.version;for(let w=0,_=x.length;w<_;w+=3){const S=x[w+0],M=x[w+1],T=x[w+2];g.push(S,M,M,T,T,S)}}else{const x=E.array;h=E.version;for(let w=0,_=x.length/3-1;w<_;w+=3){const S=w+0,M=w+1,T=w+2;g.push(S,M,M,T,T,S)}}const v=new(arrayMax(g)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(g,1);v.version=h;const C=a.get(p);C&&t.remove(C),a.set(p,v)}function f(p){const g=a.get(p);if(g){const y=p.index;y!==null&&g.version<y.version&&u(p)}else u(p);return a.get(p)}return{get:l,update:c,getWireframeAttribute:f}}function WebGLIndexedBufferRenderer(o,t,e,n){const r=n.isWebGL2;let a;function s(g){a=g}let l,c;function u(g){l=g.type,c=g.bytesPerElement}function f(g,y){o.drawElements(a,y,l,g*c),e.update(y,a,1)}function p(g,y,E){if(E===0)return;let h,v;if(r)h=o,v="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",h===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[v](a,y,l,g*c,E),e.update(y,a,E)}this.setMode=s,this.setIndex=u,this.render=f,this.renderInstances=p}function WebGLInfo(o){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(a,s,l){switch(e.calls++,s){case 4:e.triangles+=l*(a/3);break;case 1:e.lines+=l*(a/2);break;case 3:e.lines+=l*(a-1);break;case 2:e.lines+=l*a;break;case 0:e.points+=l*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function r(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:r,update:n}}function numericalSort(o,t){return o[0]-t[0]}function absNumericalSort(o,t){return Math.abs(t[1])-Math.abs(o[1])}function WebGLMorphtargets(o){const t={},e=new Float32Array(8),n=[];for(let a=0;a<8;a++)n[a]=[a,0];function r(a,s,l,c){const u=a.morphTargetInfluences,f=u===void 0?0:u.length;let p=t[s.id];if(p===void 0||p.length!==f){p=[];for(let v=0;v<f;v++)p[v]=[v,0];t[s.id]=p}for(let v=0;v<f;v++){const C=p[v];C[0]=v,C[1]=u[v]}p.sort(absNumericalSort);for(let v=0;v<8;v++)v<f&&p[v][1]?(n[v][0]=p[v][0],n[v][1]=p[v][1]):(n[v][0]=Number.MAX_SAFE_INTEGER,n[v][1]=0);n.sort(numericalSort);const g=s.morphAttributes.position,y=s.morphAttributes.normal;let E=0;for(let v=0;v<8;v++){const C=n[v],x=C[0],w=C[1];x!==Number.MAX_SAFE_INTEGER&&w?(g&&s.getAttribute("morphTarget"+v)!==g[x]&&s.setAttribute("morphTarget"+v,g[x]),y&&s.getAttribute("morphNormal"+v)!==y[x]&&s.setAttribute("morphNormal"+v,y[x]),e[v]=w,E+=w):(g&&s.hasAttribute("morphTarget"+v)===!0&&s.deleteAttribute("morphTarget"+v),y&&s.hasAttribute("morphNormal"+v)===!0&&s.deleteAttribute("morphNormal"+v),e[v]=0)}const h=s.morphTargetsRelative?1:1-E;c.getUniforms().setValue(o,"morphTargetBaseInfluence",h),c.getUniforms().setValue(o,"morphTargetInfluences",e)}return{update:r}}function WebGLObjects(o,t,e,n){let r=new WeakMap;function a(c){const u=n.render.frame,f=c.geometry,p=t.get(c,f);return r.get(p)!==u&&(t.update(p),r.set(p,u)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),e.update(c.instanceMatrix,34962),c.instanceColor!==null&&e.update(c.instanceColor,34962)),p}function s(){r=new WeakMap}function l(c){const u=c.target;u.removeEventListener("dispose",l),e.remove(u.instanceMatrix),u.instanceColor!==null&&e.remove(u.instanceColor)}return{update:a,dispose:s}}class DataTexture2DArray extends Texture{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(t=null,e=1,n=1,r=1){super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(o,t,e){const n=o[0];if(n<=0||n>0)return o;const r=t*e;let a=arrayCacheF32[r];if(a===void 0&&(a=new Float32Array(r),arrayCacheF32[r]=a),t!==0){n.toArray(a,0);for(let s=1,l=0;s!==t;++s)l+=e,o[s].toArray(a,l)}return a}function arraysEqual(o,t){if(o.length!==t.length)return!1;for(let e=0,n=o.length;e<n;e++)if(o[e]!==t[e])return!1;return!0}function copyArray(o,t){for(let e=0,n=t.length;e<n;e++)o[e]=t[e]}function allocTexUnits(o,t){let e=arrayCacheI32[t];e===void 0&&(e=new Int32Array(t),arrayCacheI32[t]=e);for(let n=0;n!==t;++n)e[n]=o.allocateTextureUnit();return e}function setValueV1f(o,t){const e=this.cache;e[0]!==t&&(o.uniform1f(this.addr,t),e[0]=t)}function setValueV2f(o,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(o.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(arraysEqual(e,t))return;o.uniform2fv(this.addr,t),copyArray(e,t)}}function setValueV3f(o,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(o.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(o.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(arraysEqual(e,t))return;o.uniform3fv(this.addr,t),copyArray(e,t)}}function setValueV4f(o,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(o.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(arraysEqual(e,t))return;o.uniform4fv(this.addr,t),copyArray(e,t)}}function setValueM2(o,t){const e=this.cache,n=t.elements;if(n===void 0){if(arraysEqual(e,t))return;o.uniformMatrix2fv(this.addr,!1,t),copyArray(e,t)}else{if(arraysEqual(e,n))return;mat2array.set(n),o.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(e,n)}}function setValueM3(o,t){const e=this.cache,n=t.elements;if(n===void 0){if(arraysEqual(e,t))return;o.uniformMatrix3fv(this.addr,!1,t),copyArray(e,t)}else{if(arraysEqual(e,n))return;mat3array.set(n),o.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(e,n)}}function setValueM4(o,t){const e=this.cache,n=t.elements;if(n===void 0){if(arraysEqual(e,t))return;o.uniformMatrix4fv(this.addr,!1,t),copyArray(e,t)}else{if(arraysEqual(e,n))return;mat4array.set(n),o.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(e,n)}}function setValueV1i(o,t){const e=this.cache;e[0]!==t&&(o.uniform1i(this.addr,t),e[0]=t)}function setValueV2i(o,t){const e=this.cache;arraysEqual(e,t)||(o.uniform2iv(this.addr,t),copyArray(e,t))}function setValueV3i(o,t){const e=this.cache;arraysEqual(e,t)||(o.uniform3iv(this.addr,t),copyArray(e,t))}function setValueV4i(o,t){const e=this.cache;arraysEqual(e,t)||(o.uniform4iv(this.addr,t),copyArray(e,t))}function setValueV1ui(o,t){const e=this.cache;e[0]!==t&&(o.uniform1ui(this.addr,t),e[0]=t)}function setValueV2ui(o,t){const e=this.cache;arraysEqual(e,t)||(o.uniform2uiv(this.addr,t),copyArray(e,t))}function setValueV3ui(o,t){const e=this.cache;arraysEqual(e,t)||(o.uniform3uiv(this.addr,t),copyArray(e,t))}function setValueV4ui(o,t){const e=this.cache;arraysEqual(e,t)||(o.uniform4uiv(this.addr,t),copyArray(e,t))}function setValueT1(o,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),e.safeSetTexture2D(t||emptyTexture,r)}function setValueT3D1(o,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),e.setTexture3D(t||emptyTexture3d,r)}function setValueT6(o,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),e.safeSetTextureCube(t||emptyCubeTexture,r)}function setValueT2DArray1(o,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),e.setTexture2DArray(t||emptyTexture2dArray,r)}function getSingularSetter(o){switch(o){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(o,t){o.uniform1fv(this.addr,t)}function setValueV2fArray(o,t){const e=flatten(t,this.size,2);o.uniform2fv(this.addr,e)}function setValueV3fArray(o,t){const e=flatten(t,this.size,3);o.uniform3fv(this.addr,e)}function setValueV4fArray(o,t){const e=flatten(t,this.size,4);o.uniform4fv(this.addr,e)}function setValueM2Array(o,t){const e=flatten(t,this.size,4);o.uniformMatrix2fv(this.addr,!1,e)}function setValueM3Array(o,t){const e=flatten(t,this.size,9);o.uniformMatrix3fv(this.addr,!1,e)}function setValueM4Array(o,t){const e=flatten(t,this.size,16);o.uniformMatrix4fv(this.addr,!1,e)}function setValueV1iArray(o,t){o.uniform1iv(this.addr,t)}function setValueV2iArray(o,t){o.uniform2iv(this.addr,t)}function setValueV3iArray(o,t){o.uniform3iv(this.addr,t)}function setValueV4iArray(o,t){o.uniform4iv(this.addr,t)}function setValueV1uiArray(o,t){o.uniform1uiv(this.addr,t)}function setValueV2uiArray(o,t){o.uniform2uiv(this.addr,t)}function setValueV3uiArray(o,t){o.uniform3uiv(this.addr,t)}function setValueV4uiArray(o,t){o.uniform4uiv(this.addr,t)}function setValueT1Array(o,t,e){const n=t.length,r=allocTexUnits(e,n);o.uniform1iv(this.addr,r);for(let a=0;a!==n;++a)e.safeSetTexture2D(t[a]||emptyTexture,r[a])}function setValueT6Array(o,t,e){const n=t.length,r=allocTexUnits(e,n);o.uniform1iv(this.addr,r);for(let a=0;a!==n;++a)e.safeSetTextureCube(t[a]||emptyCubeTexture,r[a])}function getPureArraySetter(o){switch(o){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(o,t,e){this.id=o,this.addr=e,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(o,t,e){this.id=o,this.addr=e,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}PureArrayUniform.prototype.updateCache=function(o){const t=this.cache;o instanceof Float32Array&&t.length!==o.length&&(this.cache=new Float32Array(o.length)),copyArray(t,o)};function StructuredUniform(o){this.id=o,this.seq=[],this.map={}}StructuredUniform.prototype.setValue=function(o,t,e){const n=this.seq;for(let r=0,a=n.length;r!==a;++r){const s=n[r];s.setValue(o,t[s.id],e)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(o,t){o.seq.push(t),o.map[t.id]=t}function parseUniform(o,t,e){const n=o.name,r=n.length;for(RePathPart.lastIndex=0;;){const a=RePathPart.exec(n),s=RePathPart.lastIndex;let l=a[1];const c=a[2]==="]",u=a[3];if(c&&(l=l|0),u===void 0||u==="["&&s+2===r){addUniform(e,u===void 0?new SingleUniform(l,o,t):new PureArrayUniform(l,o,t));break}else{let p=e.map[l];p===void 0&&(p=new StructuredUniform(l),addUniform(e,p)),e=p}}}function WebGLUniforms(o,t){this.seq=[],this.map={};const e=o.getProgramParameter(t,35718);for(let n=0;n<e;++n){const r=o.getActiveUniform(t,n),a=o.getUniformLocation(t,r.name);parseUniform(r,a,this)}}WebGLUniforms.prototype.setValue=function(o,t,e,n){const r=this.map[t];r!==void 0&&r.setValue(o,e,n)};WebGLUniforms.prototype.setOptional=function(o,t,e){const n=t[e];n!==void 0&&this.setValue(o,e,n)};WebGLUniforms.upload=function(o,t,e,n){for(let r=0,a=t.length;r!==a;++r){const s=t[r],l=e[s.id];l.needsUpdate!==!1&&s.setValue(o,l.value,n)}};WebGLUniforms.seqWithValue=function(o,t){const e=[];for(let n=0,r=o.length;n!==r;++n){const a=o[n];a.id in t&&e.push(a)}return e};function WebGLShader(o,t,e){const n=o.createShader(t);return o.shaderSource(n,e),o.compileShader(n),n}let programIdCount=0;function addLineNumbers(o){const t=o.split(`
`);for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join(`
`)}function getEncodingComponents(o){switch(o){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",o),["Linear","( value )"]}}function getShaderErrors(o,t,e){const n=o.getShaderParameter(t,35713),r=o.getShaderInfoLog(t).trim();if(n&&r==="")return"";const a=o.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+e+`
`+r+addLineNumbers(a)}function getTexelDecodingFunction(o,t){const e=getEncodingComponents(t);return"vec4 "+o+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function getTexelEncodingFunction(o,t){const e=getEncodingComponents(t);return"vec4 "+o+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function getToneMappingFunction(o,t){let e;switch(t){case LinearToneMapping:e="Linear";break;case ReinhardToneMapping:e="Reinhard";break;case CineonToneMapping:e="OptimizedCineon";break;case ACESFilmicToneMapping:e="ACESFilmic";break;case CustomToneMapping:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+o+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function generateExtensions(o){return[o.extensionDerivatives||o.envMapCubeUV||o.bumpMap||o.tangentSpaceNormalMap||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission>0)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(o){const t=[];for(const e in o){const n=o[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`
`)}function fetchAttributeLocations(o,t){const e={},n=o.getProgramParameter(t,35721);for(let r=0;r<n;r++){const s=o.getActiveAttrib(t,r).name;e[s]=o.getAttribLocation(t,s)}return e}function filterEmptyLine(o){return o!==""}function replaceLightNums(o,t){return o.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(o,t){return o.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(o){return o.replace(includePattern,includeReplacer)}function includeReplacer(o,t){const e=ShaderChunk[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(e)}const deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(o){return o.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(o,t,e,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(o,t,e,n)}function loopReplacer(o,t,e,n){let r="";for(let a=parseInt(t);a<parseInt(e);a++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function generatePrecision(o){let t="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?t+=`
#define HIGH_PRECISION`:o.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function generateShadowMapTypeDefine(o){let t="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":o.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(o){let t="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV";break}return t}function generateEnvMapModeDefine(o){let t="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:t="ENVMAP_MODE_REFRACTION";break}return t}function generateEnvMapBlendingDefine(o){let t="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD";break}return t}function WebGLProgram(o,t,e,n){const r=o.getContext(),a=e.defines;let s=e.vertexShader,l=e.fragmentShader;const c=generateShadowMapTypeDefine(e),u=generateEnvMapTypeDefine(e),f=generateEnvMapModeDefine(e),p=generateEnvMapBlendingDefine(e),g=o.gammaFactor>0?o.gammaFactor:1,y=e.isWebGL2?"":generateExtensions(e),E=generateDefines(a),h=r.createProgram();let v,C,x=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(v=[E].filter(filterEmptyLine).join(`
`),v.length>0&&(v+=`
`),C=[y,E].filter(filterEmptyLine).join(`
`),C.length>0&&(C+=`
`)):(v=[generatePrecision(e),"#define SHADER_NAME "+e.shaderName,E,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+e.maxBones,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+f:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularTintMap?"#define USE_SPECULARTINTMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),C=[y,generatePrecision(e),"#define SHADER_NAME "+e.shaderName,E,e.alphaTest?"#define ALPHATEST "+e.alphaTest+(e.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+u:"",e.envMap?"#define "+f:"",e.envMap?"#define "+p:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularTintMap?"#define USE_SPECULARTINTMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.sheen?"#define USE_SHEEN":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",e.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",e.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",ShaderChunk.encodings_pars_fragment,e.map?getTexelDecodingFunction("mapTexelToLinear",e.mapEncoding):"",e.matcap?getTexelDecodingFunction("matcapTexelToLinear",e.matcapEncoding):"",e.envMap?getTexelDecodingFunction("envMapTexelToLinear",e.envMapEncoding):"",e.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.specularTintMap?getTexelDecodingFunction("specularTintMapTexelToLinear",e.specularTintMapEncoding):"",e.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",e.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",e.outputEncoding),e.depthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),s=resolveIncludes(s),s=replaceLightNums(s,e),s=replaceClippingPlaneNums(s,e),l=resolveIncludes(l),l=replaceLightNums(l,e),l=replaceClippingPlaneNums(l,e),s=unrollLoops(s),l=unrollLoops(l),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,v=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,C=["#define varying in",e.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",e.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+C);const w=x+v+s,_=x+C+l,S=WebGLShader(r,35633,w),M=WebGLShader(r,35632,_);if(r.attachShader(h,S),r.attachShader(h,M),e.index0AttributeName!==void 0?r.bindAttribLocation(h,0,e.index0AttributeName):e.morphTargets===!0&&r.bindAttribLocation(h,0,"position"),r.linkProgram(h),o.debug.checkShaderErrors){const P=r.getProgramInfoLog(h).trim(),I=r.getShaderInfoLog(S).trim(),B=r.getShaderInfoLog(M).trim();let W=!0,D=!0;if(r.getProgramParameter(h,35714)===!1){W=!1;const O=getShaderErrors(r,S,"vertex"),z=getShaderErrors(r,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(h,35715),"gl.getProgramInfoLog",P,O,z)}else P!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",P):(I===""||B==="")&&(D=!1);D&&(this.diagnostics={runnable:W,programLog:P,vertexShader:{log:I,prefix:v},fragmentShader:{log:B,prefix:C}})}r.deleteShader(S),r.deleteShader(M);let T;this.getUniforms=function(){return T===void 0&&(T=new WebGLUniforms(r,h)),T};let R;return this.getAttributes=function(){return R===void 0&&(R=fetchAttributeLocations(r,h)),R},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(h),this.program=void 0},this.name=e.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=h,this.vertexShader=S,this.fragmentShader=M,this}function WebGLPrograms(o,t,e,n,r,a,s){const l=[],c=r.isWebGL2,u=r.logarithmicDepthBuffer,f=r.floatVertexTextures,p=r.maxVertexUniforms,g=r.vertexTextures;let y=r.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function v(T){const P=T.skeleton.bones;if(f)return 1024;{const B=Math.floor((p-20)/4),W=Math.min(B,P.length);return W<P.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+P.length+" bones. This GPU supports "+W+"."),0):W}}function C(T){let R;return T&&T.isTexture?R=T.encoding:T&&T.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),R=T.texture.encoding):R=LinearEncoding,R}function x(T,R,P,I,B){const W=I.fog,D=T.isMeshStandardMaterial?I.environment:null,O=(T.isMeshStandardMaterial?e:t).get(T.envMap||D),z=E[T.type],G=B.isSkinnedMesh?v(B):0;T.precision!==null&&(y=r.getMaxPrecision(T.precision),y!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",y,"instead."));let k,$;if(z){const j=ShaderLib[z];k=j.vertexShader,$=j.fragmentShader}else k=T.vertexShader,$=T.fragmentShader;const Z=o.getRenderTarget();return{isWebGL2:c,shaderID:z,shaderName:T.type,vertexShader:k,fragmentShader:$,defines:T.defines,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:y,instancing:B.isInstancedMesh===!0,instancingColor:B.isInstancedMesh===!0&&B.instanceColor!==null,supportsVertexTextures:g,outputEncoding:Z!==null?C(Z.texture):o.outputEncoding,map:!!T.map,mapEncoding:C(T.map),matcap:!!T.matcap,matcapEncoding:C(T.matcap),envMap:!!O,envMapMode:O&&O.mapping,envMapEncoding:C(O),envMapCubeUV:!!O&&(O.mapping===CubeUVReflectionMapping||O.mapping===CubeUVRefractionMapping),lightMap:!!T.lightMap,lightMapEncoding:C(T.lightMap),aoMap:!!T.aoMap,emissiveMap:!!T.emissiveMap,emissiveMapEncoding:C(T.emissiveMap),bumpMap:!!T.bumpMap,normalMap:!!T.normalMap,objectSpaceNormalMap:T.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:T.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!T.clearcoatMap,clearcoatRoughnessMap:!!T.clearcoatRoughnessMap,clearcoatNormalMap:!!T.clearcoatNormalMap,displacementMap:!!T.displacementMap,roughnessMap:!!T.roughnessMap,metalnessMap:!!T.metalnessMap,specularMap:!!T.specularMap,specularIntensityMap:!!T.specularIntensityMap,specularTintMap:!!T.specularTintMap,specularTintMapEncoding:C(T.specularTintMap),alphaMap:!!T.alphaMap,gradientMap:!!T.gradientMap,sheen:!!T.sheen,transmission:!!T.transmission,transmissionMap:!!T.transmissionMap,thicknessMap:!!T.thicknessMap,combine:T.combine,vertexTangents:!!T.normalMap&&!!B.geometry&&!!B.geometry.attributes.tangent,vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!B.geometry&&!!B.geometry.attributes.color&&B.geometry.attributes.color.itemSize===4,vertexUvs:!!T.map||!!T.bumpMap||!!T.normalMap||!!T.specularMap||!!T.alphaMap||!!T.emissiveMap||!!T.roughnessMap||!!T.metalnessMap||!!T.clearcoatMap||!!T.clearcoatRoughnessMap||!!T.clearcoatNormalMap||!!T.displacementMap||!!T.transmissionMap||!!T.thicknessMap||!!T.specularIntensityMap||!!T.specularTintMap,uvsVertexOnly:!(T.map||T.bumpMap||T.normalMap||T.specularMap||T.alphaMap||T.emissiveMap||T.roughnessMap||T.metalnessMap||T.clearcoatNormalMap||T.transmission||T.transmissionMap||T.thicknessMap||T.specularIntensityMap||T.specularTintMap)&&!!T.displacementMap,fog:!!W,useFog:T.fog,fogExp2:W&&W.isFogExp2,flatShading:!!T.flatShading,sizeAttenuation:T.sizeAttenuation,logarithmicDepthBuffer:u,skinning:B.isSkinnedMesh===!0&&G>0,maxBones:G,useVertexTexture:f,morphTargets:!!B.geometry&&!!B.geometry.morphAttributes.position,morphNormals:!!B.geometry&&!!B.geometry.morphAttributes.normal,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:T.dithering,shadowMapEnabled:o.shadowMap.enabled&&P.length>0,shadowMapType:o.shadowMap.type,toneMapping:T.toneMapped?o.toneMapping:NoToneMapping,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:T.premultipliedAlpha,alphaTest:T.alphaTest,doubleSided:T.side===DoubleSide,flipSided:T.side===BackSide,depthPacking:T.depthPacking!==void 0?T.depthPacking:!1,index0AttributeName:T.index0AttributeName,extensionDerivatives:T.extensions&&T.extensions.derivatives,extensionFragDepth:T.extensions&&T.extensions.fragDepth,extensionDrawBuffers:T.extensions&&T.extensions.drawBuffers,extensionShaderTextureLOD:T.extensions&&T.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:T.customProgramCacheKey()}}function w(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.fragmentShader),R.push(T.vertexShader)),T.defines!==void 0)for(const P in T.defines)R.push(P),R.push(T.defines[P]);if(T.isRawShaderMaterial===!1){for(let P=0;P<h.length;P++)R.push(T[h[P]]);R.push(o.outputEncoding),R.push(o.gammaFactor)}return R.push(T.customProgramCacheKey),R.join()}function _(T){const R=E[T.type];let P;if(R){const I=ShaderLib[R];P=UniformsUtils.clone(I.uniforms)}else P=T.uniforms;return P}function S(T,R){let P;for(let I=0,B=l.length;I<B;I++){const W=l[I];if(W.cacheKey===R){P=W,++P.usedTimes;break}}return P===void 0&&(P=new WebGLProgram(o,R,T,a),l.push(P)),P}function M(T){if(--T.usedTimes===0){const R=l.indexOf(T);l[R]=l[l.length-1],l.pop(),T.destroy()}}return{getParameters:x,getProgramCacheKey:w,getUniforms:_,acquireProgram:S,releaseProgram:M,programs:l}}function WebGLProperties(){let o=new WeakMap;function t(a){let s=o.get(a);return s===void 0&&(s={},o.set(a,s)),s}function e(a){o.delete(a)}function n(a,s,l){o.get(a)[s]=l}function r(){o=new WeakMap}return{get:t,remove:e,update:n,dispose:r}}function painterSortStable(o,t){return o.groupOrder!==t.groupOrder?o.groupOrder-t.groupOrder:o.renderOrder!==t.renderOrder?o.renderOrder-t.renderOrder:o.program!==t.program?o.program.id-t.program.id:o.material.id!==t.material.id?o.material.id-t.material.id:o.z!==t.z?o.z-t.z:o.id-t.id}function reversePainterSortStable(o,t){return o.groupOrder!==t.groupOrder?o.groupOrder-t.groupOrder:o.renderOrder!==t.renderOrder?o.renderOrder-t.renderOrder:o.z!==t.z?t.z-o.z:o.id-t.id}function WebGLRenderList(o){const t=[];let e=0;const n=[],r=[],a=[],s={id:-1};function l(){e=0,n.length=0,r.length=0,a.length=0}function c(y,E,h,v,C,x){let w=t[e];const _=o.get(h);return w===void 0?(w={id:y.id,object:y,geometry:E,material:h,program:_.program||s,groupOrder:v,renderOrder:y.renderOrder,z:C,group:x},t[e]=w):(w.id=y.id,w.object=y,w.geometry=E,w.material=h,w.program=_.program||s,w.groupOrder=v,w.renderOrder=y.renderOrder,w.z=C,w.group=x),e++,w}function u(y,E,h,v,C,x){const w=c(y,E,h,v,C,x);h.transmission>0?r.push(w):h.transparent===!0?a.push(w):n.push(w)}function f(y,E,h,v,C,x){const w=c(y,E,h,v,C,x);h.transmission>0?r.unshift(w):h.transparent===!0?a.unshift(w):n.unshift(w)}function p(y,E){n.length>1&&n.sort(y||painterSortStable),r.length>1&&r.sort(E||reversePainterSortStable),a.length>1&&a.sort(E||reversePainterSortStable)}function g(){for(let y=e,E=t.length;y<E;y++){const h=t[y];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.program=null,h.group=null}}return{opaque:n,transmissive:r,transparent:a,init:l,push:u,unshift:f,finish:g,sort:p}}function WebGLRenderLists(o){let t=new WeakMap;function e(r,a){let s;return t.has(r)===!1?(s=new WebGLRenderList(o),t.set(r,[s])):a>=t.get(r).length?(s=new WebGLRenderList(o),t.get(r).push(s)):s=t.get(r)[a],s}function n(){t=new WeakMap}return{get:e,dispose:n}}function UniformsCache(){const o={};return{get:function(t){if(o[t.id]!==void 0)return o[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new Vector3,color:new Color};break;case"SpotLight":e={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":e={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":e={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return o[t.id]=e,e}}}function ShadowUniformsCache(){const o={};return{get:function(t){if(o[t.id]!==void 0)return o[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[t.id]=e,e}}}let nextVersion=0;function shadowCastingLightsFirst(o,t){return(t.castShadow?1:0)-(o.castShadow?1:0)}function WebGLLights(o,t){const e=new UniformsCache,n=ShadowUniformsCache(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let f=0;f<9;f++)r.probe.push(new Vector3);const a=new Vector3,s=new Matrix4,l=new Matrix4;function c(f){let p=0,g=0,y=0;for(let T=0;T<9;T++)r.probe[T].set(0,0,0);let E=0,h=0,v=0,C=0,x=0,w=0,_=0,S=0;f.sort(shadowCastingLightsFirst);for(let T=0,R=f.length;T<R;T++){const P=f[T],I=P.color,B=P.intensity,W=P.distance,D=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)p+=I.r*B,g+=I.g*B,y+=I.b*B;else if(P.isLightProbe)for(let O=0;O<9;O++)r.probe[O].addScaledVector(P.sh.coefficients[O],B);else if(P.isDirectionalLight){const O=e.get(P);if(O.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const z=P.shadow,G=n.get(P);G.shadowBias=z.bias,G.shadowNormalBias=z.normalBias,G.shadowRadius=z.radius,G.shadowMapSize=z.mapSize,r.directionalShadow[E]=G,r.directionalShadowMap[E]=D,r.directionalShadowMatrix[E]=P.shadow.matrix,w++}r.directional[E]=O,E++}else if(P.isSpotLight){const O=e.get(P);if(O.position.setFromMatrixPosition(P.matrixWorld),O.color.copy(I).multiplyScalar(B),O.distance=W,O.coneCos=Math.cos(P.angle),O.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),O.decay=P.decay,P.castShadow){const z=P.shadow,G=n.get(P);G.shadowBias=z.bias,G.shadowNormalBias=z.normalBias,G.shadowRadius=z.radius,G.shadowMapSize=z.mapSize,r.spotShadow[v]=G,r.spotShadowMap[v]=D,r.spotShadowMatrix[v]=P.shadow.matrix,S++}r.spot[v]=O,v++}else if(P.isRectAreaLight){const O=e.get(P);O.color.copy(I).multiplyScalar(B),O.halfWidth.set(P.width*.5,0,0),O.halfHeight.set(0,P.height*.5,0),r.rectArea[C]=O,C++}else if(P.isPointLight){const O=e.get(P);if(O.color.copy(P.color).multiplyScalar(P.intensity),O.distance=P.distance,O.decay=P.decay,P.castShadow){const z=P.shadow,G=n.get(P);G.shadowBias=z.bias,G.shadowNormalBias=z.normalBias,G.shadowRadius=z.radius,G.shadowMapSize=z.mapSize,G.shadowCameraNear=z.camera.near,G.shadowCameraFar=z.camera.far,r.pointShadow[h]=G,r.pointShadowMap[h]=D,r.pointShadowMatrix[h]=P.shadow.matrix,_++}r.point[h]=O,h++}else if(P.isHemisphereLight){const O=e.get(P);O.skyColor.copy(P.color).multiplyScalar(B),O.groundColor.copy(P.groundColor).multiplyScalar(B),r.hemi[x]=O,x++}}C>0&&(t.isWebGL2||o.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,r.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=UniformsLib.LTC_HALF_1,r.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=p,r.ambient[1]=g,r.ambient[2]=y;const M=r.hash;(M.directionalLength!==E||M.pointLength!==h||M.spotLength!==v||M.rectAreaLength!==C||M.hemiLength!==x||M.numDirectionalShadows!==w||M.numPointShadows!==_||M.numSpotShadows!==S)&&(r.directional.length=E,r.spot.length=v,r.rectArea.length=C,r.point.length=h,r.hemi.length=x,r.directionalShadow.length=w,r.directionalShadowMap.length=w,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=S,r.spotShadowMap.length=S,r.directionalShadowMatrix.length=w,r.pointShadowMatrix.length=_,r.spotShadowMatrix.length=S,M.directionalLength=E,M.pointLength=h,M.spotLength=v,M.rectAreaLength=C,M.hemiLength=x,M.numDirectionalShadows=w,M.numPointShadows=_,M.numSpotShadows=S,r.version=nextVersion++)}function u(f,p){let g=0,y=0,E=0,h=0,v=0;const C=p.matrixWorldInverse;for(let x=0,w=f.length;x<w;x++){const _=f[x];if(_.isDirectionalLight){const S=r.directional[g];S.direction.setFromMatrixPosition(_.matrixWorld),a.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(a),S.direction.transformDirection(C),g++}else if(_.isSpotLight){const S=r.spot[E];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(C),S.direction.setFromMatrixPosition(_.matrixWorld),a.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(a),S.direction.transformDirection(C),E++}else if(_.isRectAreaLight){const S=r.rectArea[h];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(C),l.identity(),s.copy(_.matrixWorld),s.premultiply(C),l.extractRotation(s),S.halfWidth.set(_.width*.5,0,0),S.halfHeight.set(0,_.height*.5,0),S.halfWidth.applyMatrix4(l),S.halfHeight.applyMatrix4(l),h++}else if(_.isPointLight){const S=r.point[y];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(C),y++}else if(_.isHemisphereLight){const S=r.hemi[v];S.direction.setFromMatrixPosition(_.matrixWorld),S.direction.transformDirection(C),S.direction.normalize(),v++}}}return{setup:c,setupView:u,state:r}}function WebGLRenderState(o,t){const e=new WebGLLights(o,t),n=[],r=[];function a(){n.length=0,r.length=0}function s(p){n.push(p)}function l(p){r.push(p)}function c(){e.setup(n)}function u(p){e.setupView(n,p)}return{init:a,state:{lightsArray:n,shadowsArray:r,lights:e},setupLights:c,setupLightsView:u,pushLight:s,pushShadow:l}}function WebGLRenderStates(o,t){let e=new WeakMap;function n(a,s=0){let l;return e.has(a)===!1?(l=new WebGLRenderState(o,t),e.set(a,[l])):s>=e.get(a).length?(l=new WebGLRenderState(o,t),e.get(a).push(l)):l=e.get(a)[s],l}function r(){e=new WeakMap}return{get:n,dispose:r}}class MeshDepthMaterial extends Material{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends Material{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;var vsm_frag=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,vsm_vert=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function WebGLShadowMap(o,t,e){let n=new Frustum;const r=new Vector2,a=new Vector2,s=new Vector4,l=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),c=new MeshDistanceMaterial,u={},f=e.maxTextureSize,p={0:BackSide,1:FrontSide,2:DoubleSide},g=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),y=g.clone();y.defines.HORIZONTAL_PASS=1;const E=new BufferGeometry;E.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const h=new Mesh(E,g),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(_,S,M){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||_.length===0)return;const T=o.getRenderTarget(),R=o.getActiveCubeFace(),P=o.getActiveMipmapLevel(),I=o.state;I.setBlending(NoBlending),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);for(let B=0,W=_.length;B<W;B++){const D=_[B],O=D.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",D,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;r.copy(O.mapSize);const z=O.getFrameExtents();if(r.multiply(z),a.copy(O.mapSize),(r.x>f||r.y>f)&&(r.x>f&&(a.x=Math.floor(f/z.x),r.x=a.x*z.x,O.mapSize.x=a.x),r.y>f&&(a.y=Math.floor(f/z.y),r.y=a.y*z.y,O.mapSize.y=a.y)),O.map===null&&!O.isPointLightShadow&&this.type===VSMShadowMap){const k={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};O.map=new WebGLRenderTarget(r.x,r.y,k),O.map.texture.name=D.name+".shadowMap",O.mapPass=new WebGLRenderTarget(r.x,r.y,k),O.camera.updateProjectionMatrix()}if(O.map===null){const k={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};O.map=new WebGLRenderTarget(r.x,r.y,k),O.map.texture.name=D.name+".shadowMap",O.camera.updateProjectionMatrix()}o.setRenderTarget(O.map),o.clear();const G=O.getViewportCount();for(let k=0;k<G;k++){const $=O.getViewport(k);s.set(a.x*$.x,a.y*$.y,a.x*$.z,a.y*$.w),I.viewport(s),O.updateMatrices(D,k),n=O.getFrustum(),w(S,M,O.camera,D,this.type)}!O.isPointLightShadow&&this.type===VSMShadowMap&&C(O,M),O.needsUpdate=!1}v.needsUpdate=!1,o.setRenderTarget(T,R,P)};function C(_,S){const M=t.update(h);g.uniforms.shadow_pass.value=_.map.texture,g.uniforms.resolution.value=_.mapSize,g.uniforms.radius.value=_.radius,o.setRenderTarget(_.mapPass),o.clear(),o.renderBufferDirect(S,null,M,g,h,null),y.uniforms.shadow_pass.value=_.mapPass.texture,y.uniforms.resolution.value=_.mapSize,y.uniforms.radius.value=_.radius,o.setRenderTarget(_.map),o.clear(),o.renderBufferDirect(S,null,M,y,h,null)}function x(_,S,M,T,R,P,I){let B=null;const W=T.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(W!==void 0?B=W:B=T.isPointLight===!0?c:l,o.localClippingEnabled&&M.clipShadows===!0&&M.clippingPlanes.length!==0){const D=B.uuid,O=M.uuid;let z=u[D];z===void 0&&(z={},u[D]=z);let G=z[O];G===void 0&&(G=B.clone(),z[O]=G),B=G}return B.visible=M.visible,B.wireframe=M.wireframe,I===VSMShadowMap?B.side=M.shadowSide!==null?M.shadowSide:M.side:B.side=M.shadowSide!==null?M.shadowSide:p[M.side],B.clipShadows=M.clipShadows,B.clippingPlanes=M.clippingPlanes,B.clipIntersection=M.clipIntersection,B.wireframeLinewidth=M.wireframeLinewidth,B.linewidth=M.linewidth,T.isPointLight===!0&&B.isMeshDistanceMaterial===!0&&(B.referencePosition.setFromMatrixPosition(T.matrixWorld),B.nearDistance=R,B.farDistance=P),B}function w(_,S,M,T,R){if(_.visible===!1)return;if(_.layers.test(S.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&R===VSMShadowMap)&&(!_.frustumCulled||n.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,_.matrixWorld);const B=t.update(_),W=_.material;if(Array.isArray(W)){const D=B.groups;for(let O=0,z=D.length;O<z;O++){const G=D[O],k=W[G.materialIndex];if(k&&k.visible){const $=x(_,B,k,T,M.near,M.far,R);o.renderBufferDirect(M,null,B,$,_,G)}}}else if(W.visible){const D=x(_,B,W,T,M.near,M.far,R);o.renderBufferDirect(M,null,B,D,_,null)}}const I=_.children;for(let B=0,W=I.length;B<W;B++)w(I[B],S,M,T,R)}}function WebGLState(o,t,e){const n=e.isWebGL2;function r(){let F=!1;const H=new Vector4;let X=null;const oe=new Vector4(0,0,0,0);return{setMask:function(te){X!==te&&!F&&(o.colorMask(te,te,te,te),X=te)},setLocked:function(te){F=te},setClear:function(te,Me,Te,q,Ee){Ee===!0&&(te*=q,Me*=q,Te*=q),H.set(te,Me,Te,q),oe.equals(H)===!1&&(o.clearColor(te,Me,Te,q),oe.copy(H))},reset:function(){F=!1,X=null,oe.set(-1,0,0,0)}}}function a(){let F=!1,H=null,X=null,oe=null;return{setTest:function(te){te?he(2929):ve(2929)},setMask:function(te){H!==te&&!F&&(o.depthMask(te),H=te)},setFunc:function(te){if(X!==te){if(te)switch(te){case NeverDepth:o.depthFunc(512);break;case AlwaysDepth:o.depthFunc(519);break;case LessDepth:o.depthFunc(513);break;case LessEqualDepth:o.depthFunc(515);break;case EqualDepth:o.depthFunc(514);break;case GreaterEqualDepth:o.depthFunc(518);break;case GreaterDepth:o.depthFunc(516);break;case NotEqualDepth:o.depthFunc(517);break;default:o.depthFunc(515)}else o.depthFunc(515);X=te}},setLocked:function(te){F=te},setClear:function(te){oe!==te&&(o.clearDepth(te),oe=te)},reset:function(){F=!1,H=null,X=null,oe=null}}}function s(){let F=!1,H=null,X=null,oe=null,te=null,Me=null,Te=null,q=null,Ee=null;return{setTest:function(Pe){F||(Pe?he(2960):ve(2960))},setMask:function(Pe){H!==Pe&&!F&&(o.stencilMask(Pe),H=Pe)},setFunc:function(Pe,tt,Oe){(X!==Pe||oe!==tt||te!==Oe)&&(o.stencilFunc(Pe,tt,Oe),X=Pe,oe=tt,te=Oe)},setOp:function(Pe,tt,Oe){(Me!==Pe||Te!==tt||q!==Oe)&&(o.stencilOp(Pe,tt,Oe),Me=Pe,Te=tt,q=Oe)},setLocked:function(Pe){F=Pe},setClear:function(Pe){Ee!==Pe&&(o.clearStencil(Pe),Ee=Pe)},reset:function(){F=!1,H=null,X=null,oe=null,te=null,Me=null,Te=null,q=null,Ee=null}}}const l=new r,c=new a,u=new s;let f={},p=null,g={},y=null,E=!1,h=null,v=null,C=null,x=null,w=null,_=null,S=null,M=!1,T=null,R=null,P=null,I=null,B=null;const W=o.getParameter(35661);let D=!1,O=0;const z=o.getParameter(7938);z.indexOf("WebGL")!==-1?(O=parseFloat(/^WebGL (\d)/.exec(z)[1]),D=O>=1):z.indexOf("OpenGL ES")!==-1&&(O=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),D=O>=2);let G=null,k={};const $=o.getParameter(3088),Z=o.getParameter(2978),K=new Vector4().fromArray($),j=new Vector4().fromArray(Z);function Q(F,H,X){const oe=new Uint8Array(4),te=o.createTexture();o.bindTexture(F,te),o.texParameteri(F,10241,9728),o.texParameteri(F,10240,9728);for(let Me=0;Me<X;Me++)o.texImage2D(H+Me,0,6408,1,1,0,6408,5121,oe);return te}const le={};le[3553]=Q(3553,3553,1),le[34067]=Q(34067,34069,6),l.setClear(0,0,0,1),c.setClear(1),u.setClear(0),he(2929),c.setFunc(LessEqualDepth),ce(!1),ue(CullFaceBack),he(2884),be(NoBlending);function he(F){f[F]!==!0&&(o.enable(F),f[F]=!0)}function ve(F){f[F]!==!1&&(o.disable(F),f[F]=!1)}function re(F){F!==p&&(o.bindFramebuffer(36160,F),p=F)}function Ie(F,H){return H===null&&p!==null&&(H=p),g[F]!==H?(o.bindFramebuffer(F,H),g[F]=H,n&&(F===36009&&(g[36160]=H),F===36160&&(g[36009]=H)),!0):!1}function ge(F){return y!==F?(o.useProgram(F),y=F,!0):!1}const Se={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(n)Se[MinEquation]=32775,Se[MaxEquation]=32776;else{const F=t.get("EXT_blend_minmax");F!==null&&(Se[MinEquation]=F.MIN_EXT,Se[MaxEquation]=F.MAX_EXT)}const Le={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function be(F,H,X,oe,te,Me,Te,q){if(F===NoBlending){E===!0&&(ve(3042),E=!1);return}if(E===!1&&(he(3042),E=!0),F!==CustomBlending){if(F!==h||q!==M){if((v!==AddEquation||w!==AddEquation)&&(o.blendEquation(32774),v=AddEquation,w=AddEquation),q)switch(F){case NormalBlending:o.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:o.blendFunc(1,1);break;case SubtractiveBlending:o.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:o.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}else switch(F){case NormalBlending:o.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:o.blendFunc(770,1);break;case SubtractiveBlending:o.blendFunc(0,769);break;case MultiplyBlending:o.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}C=null,x=null,_=null,S=null,h=F,M=q}return}te=te||H,Me=Me||X,Te=Te||oe,(H!==v||te!==w)&&(o.blendEquationSeparate(Se[H],Se[te]),v=H,w=te),(X!==C||oe!==x||Me!==_||Te!==S)&&(o.blendFuncSeparate(Le[X],Le[oe],Le[Me],Le[Te]),C=X,x=oe,_=Me,S=Te),h=F,M=null}function ye(F,H){F.side===DoubleSide?ve(2884):he(2884);let X=F.side===BackSide;H&&(X=!X),ce(X),F.blending===NormalBlending&&F.transparent===!1?be(NoBlending):be(F.blending,F.blendEquation,F.blendSrc,F.blendDst,F.blendEquationAlpha,F.blendSrcAlpha,F.blendDstAlpha,F.premultipliedAlpha),c.setFunc(F.depthFunc),c.setTest(F.depthTest),c.setMask(F.depthWrite),l.setMask(F.colorWrite);const oe=F.stencilWrite;u.setTest(oe),oe&&(u.setMask(F.stencilWriteMask),u.setFunc(F.stencilFunc,F.stencilRef,F.stencilFuncMask),u.setOp(F.stencilFail,F.stencilZFail,F.stencilZPass)),Ve(F.polygonOffset,F.polygonOffsetFactor,F.polygonOffsetUnits),F.alphaToCoverage===!0?he(32926):ve(32926)}function ce(F){T!==F&&(F?o.frontFace(2304):o.frontFace(2305),T=F)}function ue(F){F!==CullFaceNone?(he(2884),F!==R&&(F===CullFaceBack?o.cullFace(1029):F===CullFaceFront?o.cullFace(1028):o.cullFace(1032))):ve(2884),R=F}function Ce(F){F!==P&&(D&&o.lineWidth(F),P=F)}function Ve(F,H,X){F?(he(32823),(I!==H||B!==X)&&(o.polygonOffset(H,X),I=H,B=X)):ve(32823)}function ie(F){F?he(3089):ve(3089)}function ae(F){F===void 0&&(F=33984+W-1),G!==F&&(o.activeTexture(F),G=F)}function Ae(F,H){G===null&&ae();let X=k[G];X===void 0&&(X={type:void 0,texture:void 0},k[G]=X),(X.type!==F||X.texture!==H)&&(o.bindTexture(F,H||le[F]),X.type=F,X.texture=H)}function De(){const F=k[G];F!==void 0&&F.type!==void 0&&(o.bindTexture(F.type,null),F.type=void 0,F.texture=void 0)}function Be(){try{o.compressedTexImage2D.apply(o,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ze(){try{o.texImage2D.apply(o,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function We(){try{o.texImage3D.apply(o,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function $e(F){K.equals(F)===!1&&(o.scissor(F.x,F.y,F.z,F.w),K.copy(F))}function qe(F){j.equals(F)===!1&&(o.viewport(F.x,F.y,F.z,F.w),j.copy(F))}function et(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.disable(32926),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.bindFramebuffer(36160,null),n===!0&&(o.bindFramebuffer(36009,null),o.bindFramebuffer(36008,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),f={},G=null,k={},p=null,g={},y=null,E=!1,h=null,v=null,C=null,x=null,w=null,_=null,S=null,M=!1,T=null,R=null,P=null,I=null,B=null,K.set(0,0,o.canvas.width,o.canvas.height),j.set(0,0,o.canvas.width,o.canvas.height),l.reset(),c.reset(),u.reset()}return{buffers:{color:l,depth:c,stencil:u},enable:he,disable:ve,bindFramebuffer:Ie,bindXRFramebuffer:re,useProgram:ge,setBlending:be,setMaterial:ye,setFlipSided:ce,setCullFace:ue,setLineWidth:Ce,setPolygonOffset:Ve,setScissorTest:ie,activeTexture:ae,bindTexture:Ae,unbindTexture:De,compressedTexImage2D:Be,texImage2D:ze,texImage3D:We,scissor:$e,viewport:qe,reset:et}}function WebGLTextures(o,t,e,n,r,a,s){const l=r.isWebGL2,c=r.maxTextures,u=r.maxCubemapSize,f=r.maxTextureSize,p=r.maxSamples,g=new WeakMap;let y,E=!1;try{E=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function h(ie,ae){return E?new OffscreenCanvas(ie,ae):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(ie,ae,Ae,De){let Be=1;if((ie.width>De||ie.height>De)&&(Be=De/Math.max(ie.width,ie.height)),Be<1||ae===!0)if(typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ie instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ie instanceof ImageBitmap){const ze=ae?floorPowerOfTwo:Math.floor,We=ze(Be*ie.width),$e=ze(Be*ie.height);y===void 0&&(y=h(We,$e));const qe=Ae?h(We,$e):y;return qe.width=We,qe.height=$e,qe.getContext("2d").drawImage(ie,0,0,We,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ie.width+"x"+ie.height+") to ("+We+"x"+$e+")."),qe}else return"data"in ie&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ie.width+"x"+ie.height+")."),ie;return ie}function C(ie){return isPowerOfTwo(ie.width)&&isPowerOfTwo(ie.height)}function x(ie){return l?!1:ie.wrapS!==ClampToEdgeWrapping||ie.wrapT!==ClampToEdgeWrapping||ie.minFilter!==NearestFilter&&ie.minFilter!==LinearFilter}function w(ie,ae){return ie.generateMipmaps&&ae&&ie.minFilter!==NearestFilter&&ie.minFilter!==LinearFilter}function _(ie,ae,Ae,De,Be=1){o.generateMipmap(ie);const ze=n.get(ae);ze.__maxMipLevel=Math.log2(Math.max(Ae,De,Be))}function S(ie,ae,Ae){if(l===!1)return ae;if(ie!==null){if(o[ie]!==void 0)return o[ie];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ie+"'")}let De=ae;return ae===6403&&(Ae===5126&&(De=33326),Ae===5131&&(De=33325),Ae===5121&&(De=33321)),ae===6407&&(Ae===5126&&(De=34837),Ae===5131&&(De=34843),Ae===5121&&(De=32849)),ae===6408&&(Ae===5126&&(De=34836),Ae===5131&&(De=34842),Ae===5121&&(De=32856)),(De===33325||De===33326||De===34842||De===34836)&&t.get("EXT_color_buffer_float"),De}function M(ie){return ie===NearestFilter||ie===NearestMipmapNearestFilter||ie===NearestMipmapLinearFilter?9728:9729}function T(ie){const ae=ie.target;ae.removeEventListener("dispose",T),P(ae),ae.isVideoTexture&&g.delete(ae),s.memory.textures--}function R(ie){const ae=ie.target;ae.removeEventListener("dispose",R),I(ae)}function P(ie){const ae=n.get(ie);ae.__webglInit!==void 0&&(o.deleteTexture(ae.__webglTexture),n.remove(ie))}function I(ie){const ae=ie.texture,Ae=n.get(ie),De=n.get(ae);if(ie){if(De.__webglTexture!==void 0&&(o.deleteTexture(De.__webglTexture),s.memory.textures--),ie.depthTexture&&ie.depthTexture.dispose(),ie.isWebGLCubeRenderTarget)for(let Be=0;Be<6;Be++)o.deleteFramebuffer(Ae.__webglFramebuffer[Be]),Ae.__webglDepthbuffer&&o.deleteRenderbuffer(Ae.__webglDepthbuffer[Be]);else o.deleteFramebuffer(Ae.__webglFramebuffer),Ae.__webglDepthbuffer&&o.deleteRenderbuffer(Ae.__webglDepthbuffer),Ae.__webglMultisampledFramebuffer&&o.deleteFramebuffer(Ae.__webglMultisampledFramebuffer),Ae.__webglColorRenderbuffer&&o.deleteRenderbuffer(Ae.__webglColorRenderbuffer),Ae.__webglDepthRenderbuffer&&o.deleteRenderbuffer(Ae.__webglDepthRenderbuffer);if(ie.isWebGLMultipleRenderTargets)for(let Be=0,ze=ae.length;Be<ze;Be++){const We=n.get(ae[Be]);We.__webglTexture&&(o.deleteTexture(We.__webglTexture),s.memory.textures--),n.remove(ae[Be])}n.remove(ae),n.remove(ie)}}let B=0;function W(){B=0}function D(){const ie=B;return ie>=c&&console.warn("THREE.WebGLTextures: Trying to use "+ie+" texture units while this GPU supports only "+c),B+=1,ie}function O(ie,ae){const Ae=n.get(ie);if(ie.isVideoTexture&&ye(ie),ie.version>0&&Ae.__version!==ie.version){const De=ie.image;if(De===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(De.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(Ae,ie,ae);return}}e.activeTexture(33984+ae),e.bindTexture(3553,Ae.__webglTexture)}function z(ie,ae){const Ae=n.get(ie);if(ie.version>0&&Ae.__version!==ie.version){Q(Ae,ie,ae);return}e.activeTexture(33984+ae),e.bindTexture(35866,Ae.__webglTexture)}function G(ie,ae){const Ae=n.get(ie);if(ie.version>0&&Ae.__version!==ie.version){Q(Ae,ie,ae);return}e.activeTexture(33984+ae),e.bindTexture(32879,Ae.__webglTexture)}function k(ie,ae){const Ae=n.get(ie);if(ie.version>0&&Ae.__version!==ie.version){le(Ae,ie,ae);return}e.activeTexture(33984+ae),e.bindTexture(34067,Ae.__webglTexture)}const $={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},Z={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function K(ie,ae,Ae){if(Ae?(o.texParameteri(ie,10242,$[ae.wrapS]),o.texParameteri(ie,10243,$[ae.wrapT]),(ie===32879||ie===35866)&&o.texParameteri(ie,32882,$[ae.wrapR]),o.texParameteri(ie,10240,Z[ae.magFilter]),o.texParameteri(ie,10241,Z[ae.minFilter])):(o.texParameteri(ie,10242,33071),o.texParameteri(ie,10243,33071),(ie===32879||ie===35866)&&o.texParameteri(ie,32882,33071),(ae.wrapS!==ClampToEdgeWrapping||ae.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(ie,10240,M(ae.magFilter)),o.texParameteri(ie,10241,M(ae.minFilter)),ae.minFilter!==NearestFilter&&ae.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const De=t.get("EXT_texture_filter_anisotropic");if(ae.type===FloatType&&t.has("OES_texture_float_linear")===!1||l===!1&&ae.type===HalfFloatType&&t.has("OES_texture_half_float_linear")===!1)return;(ae.anisotropy>1||n.get(ae).__currentAnisotropy)&&(o.texParameterf(ie,De.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ae.anisotropy,r.getMaxAnisotropy())),n.get(ae).__currentAnisotropy=ae.anisotropy)}}function j(ie,ae){ie.__webglInit===void 0&&(ie.__webglInit=!0,ae.addEventListener("dispose",T),ie.__webglTexture=o.createTexture(),s.memory.textures++)}function Q(ie,ae,Ae){let De=3553;ae.isDataTexture2DArray&&(De=35866),ae.isDataTexture3D&&(De=32879),j(ie,ae),e.activeTexture(33984+Ae),e.bindTexture(De,ie.__webglTexture),o.pixelStorei(37440,ae.flipY),o.pixelStorei(37441,ae.premultiplyAlpha),o.pixelStorei(3317,ae.unpackAlignment),o.pixelStorei(37443,0);const Be=x(ae)&&C(ae.image)===!1,ze=v(ae.image,Be,!1,f),We=C(ze)||l,$e=a.convert(ae.format);let qe=a.convert(ae.type),et=S(ae.internalFormat,$e,qe);K(De,ae,We);let F;const H=ae.mipmaps;if(ae.isDepthTexture)et=6402,l?ae.type===FloatType?et=36012:ae.type===UnsignedIntType?et=33190:ae.type===UnsignedInt248Type?et=35056:et=33189:ae.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ae.format===DepthFormat&&et===6402&&ae.type!==UnsignedShortType&&ae.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ae.type=UnsignedShortType,qe=a.convert(ae.type)),ae.format===DepthStencilFormat&&et===6402&&(et=34041,ae.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ae.type=UnsignedInt248Type,qe=a.convert(ae.type))),e.texImage2D(3553,0,et,ze.width,ze.height,0,$e,qe,null);else if(ae.isDataTexture)if(H.length>0&&We){for(let X=0,oe=H.length;X<oe;X++)F=H[X],e.texImage2D(3553,X,et,F.width,F.height,0,$e,qe,F.data);ae.generateMipmaps=!1,ie.__maxMipLevel=H.length-1}else e.texImage2D(3553,0,et,ze.width,ze.height,0,$e,qe,ze.data),ie.__maxMipLevel=0;else if(ae.isCompressedTexture){for(let X=0,oe=H.length;X<oe;X++)F=H[X],ae.format!==RGBAFormat&&ae.format!==RGBFormat?$e!==null?e.compressedTexImage2D(3553,X,et,F.width,F.height,0,F.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):e.texImage2D(3553,X,et,F.width,F.height,0,$e,qe,F.data);ie.__maxMipLevel=H.length-1}else if(ae.isDataTexture2DArray)e.texImage3D(35866,0,et,ze.width,ze.height,ze.depth,0,$e,qe,ze.data),ie.__maxMipLevel=0;else if(ae.isDataTexture3D)e.texImage3D(32879,0,et,ze.width,ze.height,ze.depth,0,$e,qe,ze.data),ie.__maxMipLevel=0;else if(H.length>0&&We){for(let X=0,oe=H.length;X<oe;X++)F=H[X],e.texImage2D(3553,X,et,$e,qe,F);ae.generateMipmaps=!1,ie.__maxMipLevel=H.length-1}else e.texImage2D(3553,0,et,$e,qe,ze),ie.__maxMipLevel=0;w(ae,We)&&_(De,ae,ze.width,ze.height),ie.__version=ae.version,ae.onUpdate&&ae.onUpdate(ae)}function le(ie,ae,Ae){if(ae.image.length!==6)return;j(ie,ae),e.activeTexture(33984+Ae),e.bindTexture(34067,ie.__webglTexture),o.pixelStorei(37440,ae.flipY),o.pixelStorei(37441,ae.premultiplyAlpha),o.pixelStorei(3317,ae.unpackAlignment),o.pixelStorei(37443,0);const De=ae&&(ae.isCompressedTexture||ae.image[0].isCompressedTexture),Be=ae.image[0]&&ae.image[0].isDataTexture,ze=[];for(let X=0;X<6;X++)!De&&!Be?ze[X]=v(ae.image[X],!1,!0,u):ze[X]=Be?ae.image[X].image:ae.image[X];const We=ze[0],$e=C(We)||l,qe=a.convert(ae.format),et=a.convert(ae.type),F=S(ae.internalFormat,qe,et);K(34067,ae,$e);let H;if(De){for(let X=0;X<6;X++){H=ze[X].mipmaps;for(let oe=0;oe<H.length;oe++){const te=H[oe];ae.format!==RGBAFormat&&ae.format!==RGBFormat?qe!==null?e.compressedTexImage2D(34069+X,oe,F,te.width,te.height,0,te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):e.texImage2D(34069+X,oe,F,te.width,te.height,0,qe,et,te.data)}}ie.__maxMipLevel=H.length-1}else{H=ae.mipmaps;for(let X=0;X<6;X++)if(Be){e.texImage2D(34069+X,0,F,ze[X].width,ze[X].height,0,qe,et,ze[X].data);for(let oe=0;oe<H.length;oe++){const Me=H[oe].image[X].image;e.texImage2D(34069+X,oe+1,F,Me.width,Me.height,0,qe,et,Me.data)}}else{e.texImage2D(34069+X,0,F,qe,et,ze[X]);for(let oe=0;oe<H.length;oe++){const te=H[oe];e.texImage2D(34069+X,oe+1,F,qe,et,te.image[X])}}ie.__maxMipLevel=H.length}w(ae,$e)&&_(34067,ae,We.width,We.height),ie.__version=ae.version,ae.onUpdate&&ae.onUpdate(ae)}function he(ie,ae,Ae,De,Be){const ze=a.convert(Ae.format),We=a.convert(Ae.type),$e=S(Ae.internalFormat,ze,We);Be===32879||Be===35866?e.texImage3D(Be,0,$e,ae.width,ae.height,ae.depth,0,ze,We,null):e.texImage2D(Be,0,$e,ae.width,ae.height,0,ze,We,null),e.bindFramebuffer(36160,ie),o.framebufferTexture2D(36160,De,Be,n.get(Ae).__webglTexture,0),e.bindFramebuffer(36160,null)}function ve(ie,ae,Ae){if(o.bindRenderbuffer(36161,ie),ae.depthBuffer&&!ae.stencilBuffer){let De=33189;if(Ae){const Be=ae.depthTexture;Be&&Be.isDepthTexture&&(Be.type===FloatType?De=36012:Be.type===UnsignedIntType&&(De=33190));const ze=be(ae);o.renderbufferStorageMultisample(36161,ze,De,ae.width,ae.height)}else o.renderbufferStorage(36161,De,ae.width,ae.height);o.framebufferRenderbuffer(36160,36096,36161,ie)}else if(ae.depthBuffer&&ae.stencilBuffer){if(Ae){const De=be(ae);o.renderbufferStorageMultisample(36161,De,35056,ae.width,ae.height)}else o.renderbufferStorage(36161,34041,ae.width,ae.height);o.framebufferRenderbuffer(36160,33306,36161,ie)}else{const De=ae.isWebGLMultipleRenderTargets===!0?ae.texture[0]:ae.texture,Be=a.convert(De.format),ze=a.convert(De.type),We=S(De.internalFormat,Be,ze);if(Ae){const $e=be(ae);o.renderbufferStorageMultisample(36161,$e,We,ae.width,ae.height)}else o.renderbufferStorage(36161,We,ae.width,ae.height)}o.bindRenderbuffer(36161,null)}function re(ie,ae){if(ae&&ae.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,ie),!(ae.depthTexture&&ae.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(ae.depthTexture).__webglTexture||ae.depthTexture.image.width!==ae.width||ae.depthTexture.image.height!==ae.height)&&(ae.depthTexture.image.width=ae.width,ae.depthTexture.image.height=ae.height,ae.depthTexture.needsUpdate=!0),O(ae.depthTexture,0);const De=n.get(ae.depthTexture).__webglTexture;if(ae.depthTexture.format===DepthFormat)o.framebufferTexture2D(36160,36096,3553,De,0);else if(ae.depthTexture.format===DepthStencilFormat)o.framebufferTexture2D(36160,33306,3553,De,0);else throw new Error("Unknown depthTexture format")}function Ie(ie){const ae=n.get(ie),Ae=ie.isWebGLCubeRenderTarget===!0;if(ie.depthTexture){if(Ae)throw new Error("target.depthTexture not supported in Cube render targets");re(ae.__webglFramebuffer,ie)}else if(Ae){ae.__webglDepthbuffer=[];for(let De=0;De<6;De++)e.bindFramebuffer(36160,ae.__webglFramebuffer[De]),ae.__webglDepthbuffer[De]=o.createRenderbuffer(),ve(ae.__webglDepthbuffer[De],ie,!1)}else e.bindFramebuffer(36160,ae.__webglFramebuffer),ae.__webglDepthbuffer=o.createRenderbuffer(),ve(ae.__webglDepthbuffer,ie,!1);e.bindFramebuffer(36160,null)}function ge(ie){const ae=ie.texture,Ae=n.get(ie),De=n.get(ae);ie.addEventListener("dispose",R),ie.isWebGLMultipleRenderTargets!==!0&&(De.__webglTexture=o.createTexture(),De.__version=ae.version,s.memory.textures++);const Be=ie.isWebGLCubeRenderTarget===!0,ze=ie.isWebGLMultipleRenderTargets===!0,We=ie.isWebGLMultisampleRenderTarget===!0,$e=ae.isDataTexture3D||ae.isDataTexture2DArray,qe=C(ie)||l;if(l&&ae.format===RGBFormat&&(ae.type===FloatType||ae.type===HalfFloatType)&&(ae.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Be){Ae.__webglFramebuffer=[];for(let et=0;et<6;et++)Ae.__webglFramebuffer[et]=o.createFramebuffer()}else if(Ae.__webglFramebuffer=o.createFramebuffer(),ze)if(r.drawBuffers){const et=ie.texture;for(let F=0,H=et.length;F<H;F++){const X=n.get(et[F]);X.__webglTexture===void 0&&(X.__webglTexture=o.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(We)if(l){Ae.__webglMultisampledFramebuffer=o.createFramebuffer(),Ae.__webglColorRenderbuffer=o.createRenderbuffer(),o.bindRenderbuffer(36161,Ae.__webglColorRenderbuffer);const et=a.convert(ae.format),F=a.convert(ae.type),H=S(ae.internalFormat,et,F),X=be(ie);o.renderbufferStorageMultisample(36161,X,H,ie.width,ie.height),e.bindFramebuffer(36160,Ae.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064,36161,Ae.__webglColorRenderbuffer),o.bindRenderbuffer(36161,null),ie.depthBuffer&&(Ae.__webglDepthRenderbuffer=o.createRenderbuffer(),ve(Ae.__webglDepthRenderbuffer,ie,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Be){e.bindTexture(34067,De.__webglTexture),K(34067,ae,qe);for(let et=0;et<6;et++)he(Ae.__webglFramebuffer[et],ie,ae,36064,34069+et);w(ae,qe)&&_(34067,ae,ie.width,ie.height),e.bindTexture(34067,null)}else if(ze){const et=ie.texture;for(let F=0,H=et.length;F<H;F++){const X=et[F],oe=n.get(X);e.bindTexture(3553,oe.__webglTexture),K(3553,X,qe),he(Ae.__webglFramebuffer,ie,X,36064+F,3553),w(X,qe)&&_(3553,X,ie.width,ie.height)}e.bindTexture(3553,null)}else{let et=3553;$e&&(l?et=ae.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),e.bindTexture(et,De.__webglTexture),K(et,ae,qe),he(Ae.__webglFramebuffer,ie,ae,36064,et),w(ae,qe)&&_(et,ae,ie.width,ie.height,ie.depth),e.bindTexture(et,null)}ie.depthBuffer&&Ie(ie)}function Se(ie){const ae=C(ie)||l,Ae=ie.isWebGLMultipleRenderTargets===!0?ie.texture:[ie.texture];for(let De=0,Be=Ae.length;De<Be;De++){const ze=Ae[De];if(w(ze,ae)){const We=ie.isWebGLCubeRenderTarget?34067:3553,$e=n.get(ze).__webglTexture;e.bindTexture(We,$e),_(We,ze,ie.width,ie.height),e.bindTexture(We,null)}}}function Le(ie){if(ie.isWebGLMultisampleRenderTarget)if(l){const ae=ie.width,Ae=ie.height;let De=16384;ie.depthBuffer&&(De|=256),ie.stencilBuffer&&(De|=1024);const Be=n.get(ie);e.bindFramebuffer(36008,Be.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,Be.__webglFramebuffer),o.blitFramebuffer(0,0,ae,Ae,0,0,ae,Ae,De,9728),e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,Be.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function be(ie){return l&&ie.isWebGLMultisampleRenderTarget?Math.min(p,ie.samples):0}function ye(ie){const ae=s.render.frame;g.get(ie)!==ae&&(g.set(ie,ae),ie.update())}let ce=!1,ue=!1;function Ce(ie,ae){ie&&ie.isWebGLRenderTarget&&(ce===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ce=!0),ie=ie.texture),O(ie,ae)}function Ve(ie,ae){ie&&ie.isWebGLCubeRenderTarget&&(ue===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ue=!0),ie=ie.texture),k(ie,ae)}this.allocateTextureUnit=D,this.resetTextureUnits=W,this.setTexture2D=O,this.setTexture2DArray=z,this.setTexture3D=G,this.setTextureCube=k,this.setupRenderTarget=ge,this.updateRenderTargetMipmap=Se,this.updateMultisampleRenderTarget=Le,this.safeSetTexture2D=Ce,this.safeSetTextureCube=Ve}function WebGLUtils(o,t,e){const n=e.isWebGL2;function r(a){let s;if(a===UnsignedByteType)return 5121;if(a===UnsignedShort4444Type)return 32819;if(a===UnsignedShort5551Type)return 32820;if(a===UnsignedShort565Type)return 33635;if(a===ByteType)return 5120;if(a===ShortType)return 5122;if(a===UnsignedShortType)return 5123;if(a===IntType)return 5124;if(a===UnsignedIntType)return 5125;if(a===FloatType)return 5126;if(a===HalfFloatType)return n?5131:(s=t.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(a===AlphaFormat)return 6406;if(a===RGBFormat)return 6407;if(a===RGBAFormat)return 6408;if(a===LuminanceFormat)return 6409;if(a===LuminanceAlphaFormat)return 6410;if(a===DepthFormat)return 6402;if(a===DepthStencilFormat)return 34041;if(a===RedFormat)return 6403;if(a===RedIntegerFormat)return 36244;if(a===RGFormat)return 33319;if(a===RGIntegerFormat)return 33320;if(a===RGBIntegerFormat)return 36248;if(a===RGBAIntegerFormat)return 36249;if(a===RGB_S3TC_DXT1_Format||a===RGBA_S3TC_DXT1_Format||a===RGBA_S3TC_DXT3_Format||a===RGBA_S3TC_DXT5_Format)if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(a===RGB_S3TC_DXT1_Format)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===RGBA_S3TC_DXT1_Format)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===RGBA_S3TC_DXT3_Format)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===RGBA_S3TC_DXT5_Format)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===RGB_PVRTC_4BPPV1_Format||a===RGB_PVRTC_2BPPV1_Format||a===RGBA_PVRTC_4BPPV1_Format||a===RGBA_PVRTC_2BPPV1_Format)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(a===RGB_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===RGB_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===RGBA_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===RGBA_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===RGB_ETC1_Format)return s=t.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((a===RGB_ETC2_Format||a===RGBA_ETC2_EAC_Format)&&(s=t.get("WEBGL_compressed_texture_etc"),s!==null)){if(a===RGB_ETC2_Format)return s.COMPRESSED_RGB8_ETC2;if(a===RGBA_ETC2_EAC_Format)return s.COMPRESSED_RGBA8_ETC2_EAC}if(a===RGBA_ASTC_4x4_Format||a===RGBA_ASTC_5x4_Format||a===RGBA_ASTC_5x5_Format||a===RGBA_ASTC_6x5_Format||a===RGBA_ASTC_6x6_Format||a===RGBA_ASTC_8x5_Format||a===RGBA_ASTC_8x6_Format||a===RGBA_ASTC_8x8_Format||a===RGBA_ASTC_10x5_Format||a===RGBA_ASTC_10x6_Format||a===RGBA_ASTC_10x8_Format||a===RGBA_ASTC_10x10_Format||a===RGBA_ASTC_12x10_Format||a===RGBA_ASTC_12x12_Format||a===SRGB8_ALPHA8_ASTC_4x4_Format||a===SRGB8_ALPHA8_ASTC_5x4_Format||a===SRGB8_ALPHA8_ASTC_5x5_Format||a===SRGB8_ALPHA8_ASTC_6x5_Format||a===SRGB8_ALPHA8_ASTC_6x6_Format||a===SRGB8_ALPHA8_ASTC_8x5_Format||a===SRGB8_ALPHA8_ASTC_8x6_Format||a===SRGB8_ALPHA8_ASTC_8x8_Format||a===SRGB8_ALPHA8_ASTC_10x5_Format||a===SRGB8_ALPHA8_ASTC_10x6_Format||a===SRGB8_ALPHA8_ASTC_10x8_Format||a===SRGB8_ALPHA8_ASTC_10x10_Format||a===SRGB8_ALPHA8_ASTC_12x10_Format||a===SRGB8_ALPHA8_ASTC_12x12_Format)return s=t.get("WEBGL_compressed_texture_astc"),s!==null?a:null;if(a===RGBA_BPTC_Format)return s=t.get("EXT_texture_compression_bptc"),s!==null?a:null;if(a===UnsignedInt248Type)return n?34042:(s=t.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}class ArrayCamera extends PerspectiveCamera{constructor(t=[]){super(),this.cameras=t}}ArrayCamera.prototype.isArrayCamera=!0;class Group extends Object3D{constructor(){super(),this.type="Group"}}Group.prototype.isGroup=!0;const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let r=null,a=null,s=null;const l=this._targetRay,c=this._grip,u=this._hand;if(t&&e.session.visibilityState!=="visible-blurred")if(l!==null&&(r=e.getPose(t.targetRaySpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent))),u&&t.hand){s=!0;for(const h of t.hand.values()){const v=e.getJointPose(h,n);if(u.joints[h.jointName]===void 0){const x=new Group;x.matrixAutoUpdate=!1,x.visible=!1,u.joints[h.jointName]=x,u.add(x)}const C=u.joints[h.jointName];v!==null&&(C.matrix.fromArray(v.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.jointRadius=v.radius),C.visible=v!==null}const f=u.joints["index-finger-tip"],p=u.joints["thumb-tip"],g=f.position.distanceTo(p.position),y=.02,E=.005;u.inputState.pinching&&g>y+E?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&g<=y-E&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else c!==null&&t.gripSpace&&(a=e.getPose(t.gripSpace,n),a!==null&&(c.matrix.fromArray(a.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),a.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(a.linearVelocity)):c.hasLinearVelocity=!1,a.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(a.angularVelocity)):c.hasAngularVelocity=!1));return l!==null&&(l.visible=r!==null),c!==null&&(c.visible=a!==null),u!==null&&(u.visible=s!==null),this}}class WebXRManager extends EventDispatcher$1{constructor(t,e){super();const n=this,r=t.state;let a=null,s=1,l=null,c="local-floor",u=null,f=null,p=null,g=null,y=null;const E=[],h=new Map,v=new PerspectiveCamera;v.layers.enable(1),v.viewport=new Vector4;const C=new PerspectiveCamera;C.layers.enable(2),C.viewport=new Vector4;const x=[v,C],w=new ArrayCamera;w.layers.enable(1),w.layers.enable(2);let _=null,S=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(G){let k=E[G];return k===void 0&&(k=new WebXRController,E[G]=k),k.getTargetRaySpace()},this.getControllerGrip=function(G){let k=E[G];return k===void 0&&(k=new WebXRController,E[G]=k),k.getGripSpace()},this.getHand=function(G){let k=E[G];return k===void 0&&(k=new WebXRController,E[G]=k),k.getHandSpace()};function M(G){const k=h.get(G.inputSource);k&&k.dispatchEvent({type:G.type,data:G.inputSource})}function T(){h.forEach(function(G,k){G.disconnect(k)}),h.clear(),_=null,S=null,r.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),z.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(G){s=G,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(G){c=G,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getSession=function(){return a},this.setSession=async function(G){if(a=G,a!==null){a.addEventListener("select",M),a.addEventListener("selectstart",M),a.addEventListener("selectend",M),a.addEventListener("squeeze",M),a.addEventListener("squeezestart",M),a.addEventListener("squeezeend",M),a.addEventListener("end",T),a.addEventListener("inputsourceschange",R);const k=e.getContextAttributes();if(k.xrCompatible!==!0&&await e.makeXRCompatible(),a.renderState.layers===void 0){const $={antialias:k.antialias,alpha:k.alpha,depth:k.depth,stencil:k.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(a,e,$),a.updateRenderState({baseLayer:y})}else{let $=0;if(k.antialias){const Z={antialias:!0,alpha:k.alpha,depth:k.depth,stencil:k.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(a,e,Z),a.updateRenderState({layers:[y]})}else{k.depth&&($=k.stencil?34041:6402);const Z={colorFormat:k.alpha?6408:6407,depthFormat:$,scaleFactor:s};f=new XRWebGLBinding(a,e),g=f.createProjectionLayer(Z),p=e.createFramebuffer(),a.updateRenderState({layers:[g]})}}l=await a.requestReferenceSpace(c),z.setContext(a),z.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function R(G){const k=a.inputSources;for(let $=0;$<E.length;$++)h.set(k[$],E[$]);for(let $=0;$<G.removed.length;$++){const Z=G.removed[$],K=h.get(Z);K&&(K.dispatchEvent({type:"disconnected",data:Z}),h.delete(Z))}for(let $=0;$<G.added.length;$++){const Z=G.added[$],K=h.get(Z);K&&K.dispatchEvent({type:"connected",data:Z})}}const P=new Vector3,I=new Vector3;function B(G,k,$){P.setFromMatrixPosition(k.matrixWorld),I.setFromMatrixPosition($.matrixWorld);const Z=P.distanceTo(I),K=k.projectionMatrix.elements,j=$.projectionMatrix.elements,Q=K[14]/(K[10]-1),le=K[14]/(K[10]+1),he=(K[9]+1)/K[5],ve=(K[9]-1)/K[5],re=(K[8]-1)/K[0],Ie=(j[8]+1)/j[0],ge=Q*re,Se=Q*Ie,Le=Z/(-re+Ie),be=Le*-re;k.matrixWorld.decompose(G.position,G.quaternion,G.scale),G.translateX(be),G.translateZ(Le),G.matrixWorld.compose(G.position,G.quaternion,G.scale),G.matrixWorldInverse.copy(G.matrixWorld).invert();const ye=Q+Le,ce=le+Le,ue=ge-be,Ce=Se+(Z-be),Ve=he*le/ce*ye,ie=ve*le/ce*ye;G.projectionMatrix.makePerspective(ue,Ce,Ve,ie,ye,ce)}function W(G,k){k===null?G.matrixWorld.copy(G.matrix):G.matrixWorld.multiplyMatrices(k.matrixWorld,G.matrix),G.matrixWorldInverse.copy(G.matrixWorld).invert()}this.updateCamera=function(G){if(a===null)return;w.near=C.near=v.near=G.near,w.far=C.far=v.far=G.far,(_!==w.near||S!==w.far)&&(a.updateRenderState({depthNear:w.near,depthFar:w.far}),_=w.near,S=w.far);const k=G.parent,$=w.cameras;W(w,k);for(let K=0;K<$.length;K++)W($[K],k);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),G.position.copy(w.position),G.quaternion.copy(w.quaternion),G.scale.copy(w.scale),G.matrix.copy(w.matrix),G.matrixWorld.copy(w.matrixWorld);const Z=G.children;for(let K=0,j=Z.length;K<j;K++)Z[K].updateMatrixWorld(!0);$.length===2?B(w,v,C):w.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){if(g!==null)return g.fixedFoveation;if(y!==null)return y.fixedFoveation},this.setFoveation=function(G){g!==null&&(g.fixedFoveation=G),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=G)};let D=null;function O(G,k){if(u=k.getViewerPose(l),u!==null){const Z=u.views;y!==null&&r.bindXRFramebuffer(y.framebuffer);let K=!1;Z.length!==w.cameras.length&&(w.cameras.length=0,K=!0);for(let j=0;j<Z.length;j++){const Q=Z[j];let le=null;if(y!==null)le=y.getViewport(Q);else{const ve=f.getViewSubImage(g,Q);r.bindXRFramebuffer(p),ve.depthStencilTexture!==void 0&&e.framebufferTexture2D(36160,36096,3553,ve.depthStencilTexture,0),e.framebufferTexture2D(36160,36064,3553,ve.colorTexture,0),le=ve.viewport}const he=x[j];he.matrix.fromArray(Q.transform.matrix),he.projectionMatrix.fromArray(Q.projectionMatrix),he.viewport.set(le.x,le.y,le.width,le.height),j===0&&w.matrix.copy(he.matrix),K===!0&&w.cameras.push(he)}}const $=a.inputSources;for(let Z=0;Z<E.length;Z++){const K=E[Z],j=$[Z];K.update(j,k,l)}D&&D(G,k)}const z=new WebGLAnimation;z.setAnimationLoop(O),this.setAnimationLoop=function(G){D=G},this.dispose=function(){}}}function WebGLMaterials(o){function t(C,x){C.fogColor.value.copy(x.color),x.isFog?(C.fogNear.value=x.near,C.fogFar.value=x.far):x.isFogExp2&&(C.fogDensity.value=x.density)}function e(C,x,w,_,S){x.isMeshBasicMaterial?n(C,x):x.isMeshLambertMaterial?(n(C,x),c(C,x)):x.isMeshToonMaterial?(n(C,x),f(C,x)):x.isMeshPhongMaterial?(n(C,x),u(C,x)):x.isMeshStandardMaterial?(n(C,x),x.isMeshPhysicalMaterial?g(C,x,S):p(C,x)):x.isMeshMatcapMaterial?(n(C,x),y(C,x)):x.isMeshDepthMaterial?(n(C,x),E(C,x)):x.isMeshDistanceMaterial?(n(C,x),h(C,x)):x.isMeshNormalMaterial?(n(C,x),v(C,x)):x.isLineBasicMaterial?(r(C,x),x.isLineDashedMaterial&&a(C,x)):x.isPointsMaterial?s(C,x,w,_):x.isSpriteMaterial?l(C,x):x.isShadowMaterial?(C.color.value.copy(x.color),C.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function n(C,x){C.opacity.value=x.opacity,x.color&&C.diffuse.value.copy(x.color),x.emissive&&C.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(C.map.value=x.map),x.alphaMap&&(C.alphaMap.value=x.alphaMap),x.specularMap&&(C.specularMap.value=x.specularMap);const w=o.get(x).envMap;if(w){C.envMap.value=w,C.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,C.reflectivity.value=x.reflectivity,C.refractionRatio.value=x.refractionRatio;const M=o.get(w).__maxMipLevel;M!==void 0&&(C.maxMipLevel.value=M)}x.lightMap&&(C.lightMap.value=x.lightMap,C.lightMapIntensity.value=x.lightMapIntensity),x.aoMap&&(C.aoMap.value=x.aoMap,C.aoMapIntensity.value=x.aoMapIntensity);let _;x.map?_=x.map:x.specularMap?_=x.specularMap:x.displacementMap?_=x.displacementMap:x.normalMap?_=x.normalMap:x.bumpMap?_=x.bumpMap:x.roughnessMap?_=x.roughnessMap:x.metalnessMap?_=x.metalnessMap:x.alphaMap?_=x.alphaMap:x.emissiveMap?_=x.emissiveMap:x.clearcoatMap?_=x.clearcoatMap:x.clearcoatNormalMap?_=x.clearcoatNormalMap:x.clearcoatRoughnessMap?_=x.clearcoatRoughnessMap:x.specularIntensityMap?_=x.specularIntensityMap:x.specularTintMap&&(_=x.specularTintMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),C.uvTransform.value.copy(_.matrix));let S;x.aoMap?S=x.aoMap:x.lightMap&&(S=x.lightMap),S!==void 0&&(S.isWebGLRenderTarget&&(S=S.texture),S.matrixAutoUpdate===!0&&S.updateMatrix(),C.uv2Transform.value.copy(S.matrix))}function r(C,x){C.diffuse.value.copy(x.color),C.opacity.value=x.opacity}function a(C,x){C.dashSize.value=x.dashSize,C.totalSize.value=x.dashSize+x.gapSize,C.scale.value=x.scale}function s(C,x,w,_){C.diffuse.value.copy(x.color),C.opacity.value=x.opacity,C.size.value=x.size*w,C.scale.value=_*.5,x.map&&(C.map.value=x.map),x.alphaMap&&(C.alphaMap.value=x.alphaMap);let S;x.map?S=x.map:x.alphaMap&&(S=x.alphaMap),S!==void 0&&(S.matrixAutoUpdate===!0&&S.updateMatrix(),C.uvTransform.value.copy(S.matrix))}function l(C,x){C.diffuse.value.copy(x.color),C.opacity.value=x.opacity,C.rotation.value=x.rotation,x.map&&(C.map.value=x.map),x.alphaMap&&(C.alphaMap.value=x.alphaMap);let w;x.map?w=x.map:x.alphaMap&&(w=x.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),C.uvTransform.value.copy(w.matrix))}function c(C,x){x.emissiveMap&&(C.emissiveMap.value=x.emissiveMap)}function u(C,x){C.specular.value.copy(x.specular),C.shininess.value=Math.max(x.shininess,1e-4),x.emissiveMap&&(C.emissiveMap.value=x.emissiveMap),x.bumpMap&&(C.bumpMap.value=x.bumpMap,C.bumpScale.value=x.bumpScale,x.side===BackSide&&(C.bumpScale.value*=-1)),x.normalMap&&(C.normalMap.value=x.normalMap,C.normalScale.value.copy(x.normalScale),x.side===BackSide&&C.normalScale.value.negate()),x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias)}function f(C,x){x.gradientMap&&(C.gradientMap.value=x.gradientMap),x.emissiveMap&&(C.emissiveMap.value=x.emissiveMap),x.bumpMap&&(C.bumpMap.value=x.bumpMap,C.bumpScale.value=x.bumpScale,x.side===BackSide&&(C.bumpScale.value*=-1)),x.normalMap&&(C.normalMap.value=x.normalMap,C.normalScale.value.copy(x.normalScale),x.side===BackSide&&C.normalScale.value.negate()),x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias)}function p(C,x){C.roughness.value=x.roughness,C.metalness.value=x.metalness,x.roughnessMap&&(C.roughnessMap.value=x.roughnessMap),x.metalnessMap&&(C.metalnessMap.value=x.metalnessMap),x.emissiveMap&&(C.emissiveMap.value=x.emissiveMap),x.bumpMap&&(C.bumpMap.value=x.bumpMap,C.bumpScale.value=x.bumpScale,x.side===BackSide&&(C.bumpScale.value*=-1)),x.normalMap&&(C.normalMap.value=x.normalMap,C.normalScale.value.copy(x.normalScale),x.side===BackSide&&C.normalScale.value.negate()),x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias),o.get(x).envMap&&(C.envMapIntensity.value=x.envMapIntensity)}function g(C,x,w){p(C,x),C.reflectivity.value=x.reflectivity,C.clearcoat.value=x.clearcoat,C.clearcoatRoughness.value=x.clearcoatRoughness,x.sheen&&C.sheen.value.copy(x.sheen),x.clearcoatMap&&(C.clearcoatMap.value=x.clearcoatMap),x.clearcoatRoughnessMap&&(C.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap),x.clearcoatNormalMap&&(C.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),C.clearcoatNormalMap.value=x.clearcoatNormalMap,x.side===BackSide&&C.clearcoatNormalScale.value.negate()),C.transmission.value=x.transmission,x.transmissionMap&&(C.transmissionMap.value=x.transmissionMap),x.transmission>0&&(C.transmissionSamplerMap.value=w.texture,C.transmissionSamplerSize.value.set(w.width,w.height)),C.thickness.value=x.thickness,x.thicknessMap&&(C.thicknessMap.value=x.thicknessMap),C.attenuationDistance.value=x.attenuationDistance,C.attenuationTint.value.copy(x.attenuationTint),C.specularIntensity.value=x.specularIntensity,C.specularTint.value.copy(x.specularTint),x.specularIntensityMap&&(C.specularIntensityMap.value=x.specularIntensityMap),x.specularTintMap&&(C.specularTintMap.value=x.specularTintMap)}function y(C,x){x.matcap&&(C.matcap.value=x.matcap),x.bumpMap&&(C.bumpMap.value=x.bumpMap,C.bumpScale.value=x.bumpScale,x.side===BackSide&&(C.bumpScale.value*=-1)),x.normalMap&&(C.normalMap.value=x.normalMap,C.normalScale.value.copy(x.normalScale),x.side===BackSide&&C.normalScale.value.negate()),x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias)}function E(C,x){x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias)}function h(C,x){x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias),C.referencePosition.value.copy(x.referencePosition),C.nearDistance.value=x.nearDistance,C.farDistance.value=x.farDistance}function v(C,x){x.bumpMap&&(C.bumpMap.value=x.bumpMap,C.bumpScale.value=x.bumpScale,x.side===BackSide&&(C.bumpScale.value*=-1)),x.normalMap&&(C.normalMap.value=x.normalMap,C.normalScale.value.copy(x.normalScale),x.side===BackSide&&C.normalScale.value.negate()),x.displacementMap&&(C.displacementMap.value=x.displacementMap,C.displacementScale.value=x.displacementScale,C.displacementBias.value=x.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:e}}function createCanvasElement(){const o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return o.style.display="block",o}function WebGLRenderer(o={}){const t=o.canvas!==void 0?o.canvas:createCanvasElement(),e=o.context!==void 0?o.context:null,n=o.alpha!==void 0?o.alpha:!1,r=o.depth!==void 0?o.depth:!0,a=o.stencil!==void 0?o.stencil:!0,s=o.antialias!==void 0?o.antialias:!1,l=o.premultipliedAlpha!==void 0?o.premultipliedAlpha:!0,c=o.preserveDrawingBuffer!==void 0?o.preserveDrawingBuffer:!1,u=o.powerPreference!==void 0?o.powerPreference:"default",f=o.failIfMajorPerformanceCaveat!==void 0?o.failIfMajorPerformanceCaveat:!1;let p=null,g=null;const y=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const h=this;let v=!1,C=0,x=0,w=null,_=-1,S=null;const M=new Vector4,T=new Vector4;let R=null,P=t.width,I=t.height,B=1,W=null,D=null;const O=new Vector4(0,0,P,I),z=new Vector4(0,0,P,I);let G=!1;const k=[],$=new Frustum;let Z=!1,K=!1,j=null;const Q=new Matrix4,le=new Vector3,he={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ve(){return w===null?B:1}let re=e;function Ie(_e,Xe){for(let Ue=0;Ue<_e.length;Ue++){const Ye=_e[Ue],ot=t.getContext(Ye,Xe);if(ot!==null)return ot}return null}try{const _e={alpha:n,depth:r,stencil:a,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:f};if(t.addEventListener("webglcontextlost",Te,!1),t.addEventListener("webglcontextrestored",q,!1),re===null){const Xe=["webgl2","webgl","experimental-webgl"];if(h.isWebGL1Renderer===!0&&Xe.shift(),re=Ie(Xe,_e),re===null)throw Ie(Xe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}re.getShaderPrecisionFormat===void 0&&(re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(_e){throw console.error("THREE.WebGLRenderer: "+_e.message),_e}let ge,Se,Le,be,ye,ce,ue,Ce,Ve,ie,ae,Ae,De,Be,ze,We,$e,qe,et,F,H,X,oe;function te(){ge=new WebGLExtensions(re),Se=new WebGLCapabilities(re,ge,o),ge.init(Se),X=new WebGLUtils(re,ge,Se),Le=new WebGLState(re,ge,Se),k[0]=1029,be=new WebGLInfo,ye=new WebGLProperties,ce=new WebGLTextures(re,ge,Le,ye,Se,X,be),ue=new WebGLCubeMaps(h),Ce=new WebGLCubeUVMaps(h),Ve=new WebGLAttributes(re,Se),oe=new WebGLBindingStates(re,ge,Ve,Se),ie=new WebGLGeometries(re,Ve,be,oe),ae=new WebGLObjects(re,ie,Ve,be),et=new WebGLMorphtargets(re),We=new WebGLClipping(ye),Ae=new WebGLPrograms(h,ue,Ce,ge,Se,oe,We),De=new WebGLMaterials(ye),Be=new WebGLRenderLists(ye),ze=new WebGLRenderStates(ge,Se),qe=new WebGLBackground(h,ue,Le,ae,l),$e=new WebGLShadowMap(h,ae,Se),F=new WebGLBufferRenderer(re,ge,be,Se),H=new WebGLIndexedBufferRenderer(re,ge,be,Se),be.programs=Ae.programs,h.capabilities=Se,h.extensions=ge,h.properties=ye,h.renderLists=Be,h.shadowMap=$e,h.state=Le,h.info=be}te();const Me=new WebXRManager(h,re);this.xr=Me,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){const _e=ge.get("WEBGL_lose_context");_e&&_e.loseContext()},this.forceContextRestore=function(){const _e=ge.get("WEBGL_lose_context");_e&&_e.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(_e){_e!==void 0&&(B=_e,this.setSize(P,I,!1))},this.getSize=function(_e){return _e.set(P,I)},this.setSize=function(_e,Xe,Ue){if(Me.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}P=_e,I=Xe,t.width=Math.floor(_e*B),t.height=Math.floor(Xe*B),Ue!==!1&&(t.style.width=_e+"px",t.style.height=Xe+"px"),this.setViewport(0,0,_e,Xe)},this.getDrawingBufferSize=function(_e){return _e.set(P*B,I*B).floor()},this.setDrawingBufferSize=function(_e,Xe,Ue){P=_e,I=Xe,B=Ue,t.width=Math.floor(_e*Ue),t.height=Math.floor(Xe*Ue),this.setViewport(0,0,_e,Xe)},this.getCurrentViewport=function(_e){return _e.copy(M)},this.getViewport=function(_e){return _e.copy(O)},this.setViewport=function(_e,Xe,Ue,Ye){_e.isVector4?O.set(_e.x,_e.y,_e.z,_e.w):O.set(_e,Xe,Ue,Ye),Le.viewport(M.copy(O).multiplyScalar(B).floor())},this.getScissor=function(_e){return _e.copy(z)},this.setScissor=function(_e,Xe,Ue,Ye){_e.isVector4?z.set(_e.x,_e.y,_e.z,_e.w):z.set(_e,Xe,Ue,Ye),Le.scissor(T.copy(z).multiplyScalar(B).floor())},this.getScissorTest=function(){return G},this.setScissorTest=function(_e){Le.setScissorTest(G=_e)},this.setOpaqueSort=function(_e){W=_e},this.setTransparentSort=function(_e){D=_e},this.getClearColor=function(_e){return _e.copy(qe.getClearColor())},this.setClearColor=function(){qe.setClearColor.apply(qe,arguments)},this.getClearAlpha=function(){return qe.getClearAlpha()},this.setClearAlpha=function(){qe.setClearAlpha.apply(qe,arguments)},this.clear=function(_e,Xe,Ue){let Ye=0;(_e===void 0||_e)&&(Ye|=16384),(Xe===void 0||Xe)&&(Ye|=256),(Ue===void 0||Ue)&&(Ye|=1024),re.clear(Ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Te,!1),t.removeEventListener("webglcontextrestored",q,!1),Be.dispose(),ze.dispose(),ye.dispose(),ue.dispose(),Ce.dispose(),ae.dispose(),oe.dispose(),Me.dispose(),Me.removeEventListener("sessionstart",Fe),Me.removeEventListener("sessionend",it),j&&(j.dispose(),j=null),U.stop()};function Te(_e){_e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function q(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const _e=be.autoReset,Xe=$e.enabled,Ue=$e.autoUpdate,Ye=$e.needsUpdate,ot=$e.type;te(),be.autoReset=_e,$e.enabled=Xe,$e.autoUpdate=Ue,$e.needsUpdate=Ye,$e.type=ot}function Ee(_e){const Xe=_e.target;Xe.removeEventListener("dispose",Ee),Pe(Xe)}function Pe(_e){tt(_e),ye.remove(_e)}function tt(_e){const Xe=ye.get(_e).programs;Xe!==void 0&&Xe.forEach(function(Ue){Ae.releaseProgram(Ue)})}function Oe(_e,Xe){_e.render(function(Ue){h.renderBufferImmediate(Ue,Xe)})}this.renderBufferImmediate=function(_e,Xe){oe.initAttributes();const Ue=ye.get(_e);_e.hasPositions&&!Ue.position&&(Ue.position=re.createBuffer()),_e.hasNormals&&!Ue.normal&&(Ue.normal=re.createBuffer()),_e.hasUvs&&!Ue.uv&&(Ue.uv=re.createBuffer()),_e.hasColors&&!Ue.color&&(Ue.color=re.createBuffer());const Ye=Xe.getAttributes();_e.hasPositions&&(re.bindBuffer(34962,Ue.position),re.bufferData(34962,_e.positionArray,35048),oe.enableAttribute(Ye.position),re.vertexAttribPointer(Ye.position,3,5126,!1,0,0)),_e.hasNormals&&(re.bindBuffer(34962,Ue.normal),re.bufferData(34962,_e.normalArray,35048),oe.enableAttribute(Ye.normal),re.vertexAttribPointer(Ye.normal,3,5126,!1,0,0)),_e.hasUvs&&(re.bindBuffer(34962,Ue.uv),re.bufferData(34962,_e.uvArray,35048),oe.enableAttribute(Ye.uv),re.vertexAttribPointer(Ye.uv,2,5126,!1,0,0)),_e.hasColors&&(re.bindBuffer(34962,Ue.color),re.bufferData(34962,_e.colorArray,35048),oe.enableAttribute(Ye.color),re.vertexAttribPointer(Ye.color,3,5126,!1,0,0)),oe.disableUnusedAttributes(),re.drawArrays(4,0,_e.count),_e.count=0},this.renderBufferDirect=function(_e,Xe,Ue,Ye,ot,gt){Xe===null&&(Xe=he);const Et=ot.isMesh&&ot.matrixWorld.determinant()<0,yt=pt(_e,Xe,Ye,ot);Le.setMaterial(Ye,Et);let mt=Ue.index;const St=Ue.attributes.position;if(mt===null){if(St===void 0||St.count===0)return}else if(mt.count===0)return;let vt=1;Ye.wireframe===!0&&(mt=ie.getWireframeAttribute(Ue),vt=2),(Ue.morphAttributes.position!==void 0||Ue.morphAttributes.normal!==void 0)&&et.update(ot,Ue,Ye,yt),oe.setup(ot,Ye,yt,Ue,mt);let Rt,xt=F;mt!==null&&(Rt=Ve.get(mt),xt=H,xt.setIndex(Rt));const dr=mt!==null?mt.count:St.count,$t=Ue.drawRange.start*vt,pr=Ue.drawRange.count*vt,qt=gt!==null?gt.start*vt:0,Lr=gt!==null?gt.count*vt:1/0,yr=Math.max($t,qt),or=Math.min(dr,$t+pr,qt+Lr)-1,xr=Math.max(0,or-yr+1);if(xr!==0){if(ot.isMesh)Ye.wireframe===!0?(Le.setLineWidth(Ye.wireframeLinewidth*ve()),xt.setMode(1)):xt.setMode(4);else if(ot.isLine){let mr=Ye.linewidth;mr===void 0&&(mr=1),Le.setLineWidth(mr*ve()),ot.isLineSegments?xt.setMode(1):ot.isLineLoop?xt.setMode(2):xt.setMode(3)}else ot.isPoints?xt.setMode(0):ot.isSprite&&xt.setMode(4);if(ot.isInstancedMesh)xt.renderInstances(yr,xr,ot.count);else if(Ue.isInstancedBufferGeometry){const mr=Math.min(Ue.instanceCount,Ue._maxInstanceCount);xt.renderInstances(yr,xr,mr)}else xt.render(yr,xr)}},this.compile=function(_e,Xe){g=ze.get(_e),g.init(),E.push(g),_e.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(Xe.layers)&&(g.pushLight(Ue),Ue.castShadow&&g.pushShadow(Ue))}),g.setupLights(),_e.traverse(function(Ue){const Ye=Ue.material;if(Ye)if(Array.isArray(Ye))for(let ot=0;ot<Ye.length;ot++){const gt=Ye[ot];je(gt,_e,Ue)}else je(Ye,_e,Ue)}),E.pop(),g=null};let Je=null;function ee(_e){Je&&Je(_e)}function Fe(){U.stop()}function it(){U.start()}const U=new WebGLAnimation;U.setAnimationLoop(ee),typeof window<"u"&&U.setContext(window),this.setAnimationLoop=function(_e){Je=_e,Me.setAnimationLoop(_e),_e===null?U.stop():U.start()},Me.addEventListener("sessionstart",Fe),Me.addEventListener("sessionend",it),this.render=function(_e,Xe){if(Xe!==void 0&&Xe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;_e.autoUpdate===!0&&_e.updateMatrixWorld(),Xe.parent===null&&Xe.updateMatrixWorld(),Me.enabled===!0&&Me.isPresenting===!0&&(Me.cameraAutoUpdate===!0&&Me.updateCamera(Xe),Xe=Me.getCamera()),_e.isScene===!0&&_e.onBeforeRender(h,_e,Xe,w),g=ze.get(_e,E.length),g.init(),E.push(g),Q.multiplyMatrices(Xe.projectionMatrix,Xe.matrixWorldInverse),$.setFromProjectionMatrix(Q),K=this.localClippingEnabled,Z=We.init(this.clippingPlanes,K,Xe),p=Be.get(_e,y.length),p.init(),y.push(p),ke(_e,Xe,0,h.sortObjects),p.finish(),h.sortObjects===!0&&p.sort(W,D),Z===!0&&We.beginShadows();const Ue=g.state.shadowsArray;$e.render(Ue,_e,Xe),g.setupLights(),g.setupLightsView(Xe),Z===!0&&We.endShadows(),this.info.autoReset===!0&&this.info.reset(),qe.render(p,_e);const Ye=p.opaque,ot=p.transmissive,gt=p.transparent;Ye.length>0&&se(Ye,_e,Xe),ot.length>0&&de(Ye,ot,_e,Xe),gt.length>0&&se(gt,_e,Xe),w!==null&&(ce.updateMultisampleRenderTarget(w),ce.updateRenderTargetMipmap(w)),_e.isScene===!0&&_e.onAfterRender(h,_e,Xe),Le.buffers.depth.setTest(!0),Le.buffers.depth.setMask(!0),Le.buffers.color.setMask(!0),Le.setPolygonOffset(!1),oe.resetDefaultState(),_=-1,S=null,E.pop(),E.length>0?g=E[E.length-1]:g=null,y.pop(),y.length>0?p=y[y.length-1]:p=null};function ke(_e,Xe,Ue,Ye){if(_e.visible===!1)return;if(_e.layers.test(Xe.layers)){if(_e.isGroup)Ue=_e.renderOrder;else if(_e.isLOD)_e.autoUpdate===!0&&_e.update(Xe);else if(_e.isLight)g.pushLight(_e),_e.castShadow&&g.pushShadow(_e);else if(_e.isSprite){if(!_e.frustumCulled||$.intersectsSprite(_e)){Ye&&le.setFromMatrixPosition(_e.matrixWorld).applyMatrix4(Q);const Et=ae.update(_e),yt=_e.material;yt.visible&&p.push(_e,Et,yt,Ue,le.z,null)}}else if(_e.isImmediateRenderObject)Ye&&le.setFromMatrixPosition(_e.matrixWorld).applyMatrix4(Q),p.push(_e,null,_e.material,Ue,le.z,null);else if((_e.isMesh||_e.isLine||_e.isPoints)&&(_e.isSkinnedMesh&&_e.skeleton.frame!==be.render.frame&&(_e.skeleton.update(),_e.skeleton.frame=be.render.frame),!_e.frustumCulled||$.intersectsObject(_e))){Ye&&le.setFromMatrixPosition(_e.matrixWorld).applyMatrix4(Q);const Et=ae.update(_e),yt=_e.material;if(Array.isArray(yt)){const mt=Et.groups;for(let St=0,vt=mt.length;St<vt;St++){const Rt=mt[St],xt=yt[Rt.materialIndex];xt&&xt.visible&&p.push(_e,Et,xt,Ue,le.z,Rt)}}else yt.visible&&p.push(_e,Et,yt,Ue,le.z,null)}}const gt=_e.children;for(let Et=0,yt=gt.length;Et<yt;Et++)ke(gt[Et],Xe,Ue,Ye)}function de(_e,Xe,Ue,Ye){if(j===null){const yt=s===!0&&Se.isWebGL2===!0?WebGLMultisampleRenderTarget:WebGLRenderTarget;j=new yt(1024,1024,{generateMipmaps:!0,type:X.convert(HalfFloatType)!==null?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,magFilter:NearestFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping})}const ot=h.getRenderTarget();h.setRenderTarget(j),h.clear();const gt=h.toneMapping;h.toneMapping=NoToneMapping,se(_e,Ue,Ye),h.toneMapping=gt,ce.updateMultisampleRenderTarget(j),ce.updateRenderTargetMipmap(j),h.setRenderTarget(ot),se(Xe,Ue,Ye)}function se(_e,Xe,Ue){const Ye=Xe.isScene===!0?Xe.overrideMaterial:null;if(Ue.isArrayCamera){const ot=Ue.cameras;for(let gt=0,Et=ot.length;gt<Et;gt++){const yt=ot[gt];Le.viewport(M.copy(yt.viewport)),g.setupLightsView(yt);for(let mt=0,St=_e.length;mt<St;mt++){const vt=_e[mt],Rt=vt.object,xt=vt.geometry,dr=Ye===null?vt.material:Ye,$t=vt.group;Rt.layers.test(yt.layers)&&fe(Rt,Xe,yt,xt,dr,$t)}}}else for(let ot=0,gt=_e.length;ot<gt;ot++){const Et=_e[ot],yt=Et.object,mt=Et.geometry,St=Ye===null?Et.material:Ye,vt=Et.group;fe(yt,Xe,Ue,mt,St,vt)}}function fe(_e,Xe,Ue,Ye,ot,gt){if(_e.onBeforeRender(h,Xe,Ue,Ye,ot,gt),_e.modelViewMatrix.multiplyMatrices(Ue.matrixWorldInverse,_e.matrixWorld),_e.normalMatrix.getNormalMatrix(_e.modelViewMatrix),_e.isImmediateRenderObject){const Et=pt(Ue,Xe,ot,_e);Le.setMaterial(ot),oe.reset(),Oe(_e,Et)}else ot.transparent===!0&&ot.side===DoubleSide?(ot.side=BackSide,ot.needsUpdate=!0,h.renderBufferDirect(Ue,Xe,Ye,ot,_e,gt),ot.side=FrontSide,ot.needsUpdate=!0,h.renderBufferDirect(Ue,Xe,Ye,ot,_e,gt),ot.side=DoubleSide):h.renderBufferDirect(Ue,Xe,Ye,ot,_e,gt);_e.onAfterRender(h,Xe,Ue,Ye,ot,gt)}function je(_e,Xe,Ue){Xe.isScene!==!0&&(Xe=he);const Ye=ye.get(_e),ot=g.state.lights,gt=g.state.shadowsArray,Et=ot.state.version,yt=Ae.getParameters(_e,ot.state,gt,Xe,Ue),mt=Ae.getProgramCacheKey(yt);let St=Ye.programs;Ye.environment=_e.isMeshStandardMaterial?Xe.environment:null,Ye.fog=Xe.fog,Ye.envMap=(_e.isMeshStandardMaterial?Ce:ue).get(_e.envMap||Ye.environment),St===void 0&&(_e.addEventListener("dispose",Ee),St=new Map,Ye.programs=St);let vt=St.get(mt);if(vt!==void 0){if(Ye.currentProgram===vt&&Ye.lightsStateVersion===Et)return ht(_e,yt),vt}else yt.uniforms=Ae.getUniforms(_e),_e.onBuild(yt,h),_e.onBeforeCompile(yt,h),vt=Ae.acquireProgram(yt,mt),St.set(mt,vt),Ye.uniforms=yt.uniforms;const Rt=Ye.uniforms;(!_e.isShaderMaterial&&!_e.isRawShaderMaterial||_e.clipping===!0)&&(Rt.clippingPlanes=We.uniform),ht(_e,yt),Ye.needsLights=At(_e),Ye.lightsStateVersion=Et,Ye.needsLights&&(Rt.ambientLightColor.value=ot.state.ambient,Rt.lightProbe.value=ot.state.probe,Rt.directionalLights.value=ot.state.directional,Rt.directionalLightShadows.value=ot.state.directionalShadow,Rt.spotLights.value=ot.state.spot,Rt.spotLightShadows.value=ot.state.spotShadow,Rt.rectAreaLights.value=ot.state.rectArea,Rt.ltc_1.value=ot.state.rectAreaLTC1,Rt.ltc_2.value=ot.state.rectAreaLTC2,Rt.pointLights.value=ot.state.point,Rt.pointLightShadows.value=ot.state.pointShadow,Rt.hemisphereLights.value=ot.state.hemi,Rt.directionalShadowMap.value=ot.state.directionalShadowMap,Rt.directionalShadowMatrix.value=ot.state.directionalShadowMatrix,Rt.spotShadowMap.value=ot.state.spotShadowMap,Rt.spotShadowMatrix.value=ot.state.spotShadowMatrix,Rt.pointShadowMap.value=ot.state.pointShadowMap,Rt.pointShadowMatrix.value=ot.state.pointShadowMatrix);const xt=vt.getUniforms(),dr=WebGLUniforms.seqWithValue(xt.seq,Rt);return Ye.currentProgram=vt,Ye.uniformsList=dr,vt}function ht(_e,Xe){const Ue=ye.get(_e);Ue.outputEncoding=Xe.outputEncoding,Ue.instancing=Xe.instancing,Ue.skinning=Xe.skinning,Ue.morphTargets=Xe.morphTargets,Ue.morphNormals=Xe.morphNormals,Ue.numClippingPlanes=Xe.numClippingPlanes,Ue.numIntersection=Xe.numClipIntersection,Ue.vertexAlphas=Xe.vertexAlphas,Ue.vertexTangents=Xe.vertexTangents}function pt(_e,Xe,Ue,Ye){Xe.isScene!==!0&&(Xe=he),ce.resetTextureUnits();const ot=Xe.fog,gt=Ue.isMeshStandardMaterial?Xe.environment:null,Et=w===null?h.outputEncoding:w.texture.encoding,yt=(Ue.isMeshStandardMaterial?Ce:ue).get(Ue.envMap||gt),mt=Ue.vertexColors===!0&&!!Ye.geometry&&!!Ye.geometry.attributes.color&&Ye.geometry.attributes.color.itemSize===4,St=!!Ye.geometry&&!!Ye.geometry.attributes.tangent,vt=!!Ye.geometry&&!!Ye.geometry.morphAttributes.position,Rt=!!Ye.geometry&&!!Ye.geometry.morphAttributes.normal,xt=ye.get(Ue),dr=g.state.lights;if(Z===!0&&(K===!0||_e!==S)){const mr=_e===S&&Ue.id===_;We.setState(Ue,_e,mr)}let $t=!1;Ue.version===xt.__version?(xt.needsLights&&xt.lightsStateVersion!==dr.state.version||xt.outputEncoding!==Et||Ye.isInstancedMesh&&xt.instancing===!1||!Ye.isInstancedMesh&&xt.instancing===!0||Ye.isSkinnedMesh&&xt.skinning===!1||!Ye.isSkinnedMesh&&xt.skinning===!0||xt.envMap!==yt||Ue.fog&&xt.fog!==ot||xt.numClippingPlanes!==void 0&&(xt.numClippingPlanes!==We.numPlanes||xt.numIntersection!==We.numIntersection)||xt.vertexAlphas!==mt||xt.vertexTangents!==St||xt.morphTargets!==vt||xt.morphNormals!==Rt)&&($t=!0):($t=!0,xt.__version=Ue.version);let pr=xt.currentProgram;$t===!0&&(pr=je(Ue,Xe,Ye));let qt=!1,Lr=!1,yr=!1;const or=pr.getUniforms(),xr=xt.uniforms;if(Le.useProgram(pr.program)&&(qt=!0,Lr=!0,yr=!0),Ue.id!==_&&(_=Ue.id,Lr=!0),qt||S!==_e){if(or.setValue(re,"projectionMatrix",_e.projectionMatrix),Se.logarithmicDepthBuffer&&or.setValue(re,"logDepthBufFC",2/(Math.log(_e.far+1)/Math.LN2)),S!==_e&&(S=_e,Lr=!0,yr=!0),Ue.isShaderMaterial||Ue.isMeshPhongMaterial||Ue.isMeshToonMaterial||Ue.isMeshStandardMaterial||Ue.envMap){const mr=or.map.cameraPosition;mr!==void 0&&mr.setValue(re,le.setFromMatrixPosition(_e.matrixWorld))}(Ue.isMeshPhongMaterial||Ue.isMeshToonMaterial||Ue.isMeshLambertMaterial||Ue.isMeshBasicMaterial||Ue.isMeshStandardMaterial||Ue.isShaderMaterial)&&or.setValue(re,"isOrthographic",_e.isOrthographicCamera===!0),(Ue.isMeshPhongMaterial||Ue.isMeshToonMaterial||Ue.isMeshLambertMaterial||Ue.isMeshBasicMaterial||Ue.isMeshStandardMaterial||Ue.isShaderMaterial||Ue.isShadowMaterial||Ye.isSkinnedMesh)&&or.setValue(re,"viewMatrix",_e.matrixWorldInverse)}if(Ye.isSkinnedMesh){or.setOptional(re,Ye,"bindMatrix"),or.setOptional(re,Ye,"bindMatrixInverse");const mr=Ye.skeleton;mr&&(Se.floatVertexTextures?(mr.boneTexture===null&&mr.computeBoneTexture(),or.setValue(re,"boneTexture",mr.boneTexture,ce),or.setValue(re,"boneTextureSize",mr.boneTextureSize)):or.setOptional(re,mr,"boneMatrices"))}return(Lr||xt.receiveShadow!==Ye.receiveShadow)&&(xt.receiveShadow=Ye.receiveShadow,or.setValue(re,"receiveShadow",Ye.receiveShadow)),Lr&&(or.setValue(re,"toneMappingExposure",h.toneMappingExposure),xt.needsLights&&dt(xr,yr),ot&&Ue.fog&&De.refreshFogUniforms(xr,ot),De.refreshMaterialUniforms(xr,Ue,B,I,j),WebGLUniforms.upload(re,xt.uniformsList,xr,ce)),Ue.isShaderMaterial&&Ue.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(re,xt.uniformsList,xr,ce),Ue.uniformsNeedUpdate=!1),Ue.isSpriteMaterial&&or.setValue(re,"center",Ye.center),or.setValue(re,"modelViewMatrix",Ye.modelViewMatrix),or.setValue(re,"normalMatrix",Ye.normalMatrix),or.setValue(re,"modelMatrix",Ye.matrixWorld),pr}function dt(_e,Xe){_e.ambientLightColor.needsUpdate=Xe,_e.lightProbe.needsUpdate=Xe,_e.directionalLights.needsUpdate=Xe,_e.directionalLightShadows.needsUpdate=Xe,_e.pointLights.needsUpdate=Xe,_e.pointLightShadows.needsUpdate=Xe,_e.spotLights.needsUpdate=Xe,_e.spotLightShadows.needsUpdate=Xe,_e.rectAreaLights.needsUpdate=Xe,_e.hemisphereLights.needsUpdate=Xe}function At(_e){return _e.isMeshLambertMaterial||_e.isMeshToonMaterial||_e.isMeshPhongMaterial||_e.isMeshStandardMaterial||_e.isShadowMaterial||_e.isShaderMaterial&&_e.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return w},this.setRenderTarget=function(_e,Xe=0,Ue=0){w=_e,C=Xe,x=Ue,_e&&ye.get(_e).__webglFramebuffer===void 0&&ce.setupRenderTarget(_e);let Ye=null,ot=!1,gt=!1;if(_e){const yt=_e.texture;(yt.isDataTexture3D||yt.isDataTexture2DArray)&&(gt=!0);const mt=ye.get(_e).__webglFramebuffer;_e.isWebGLCubeRenderTarget?(Ye=mt[Xe],ot=!0):_e.isWebGLMultisampleRenderTarget?Ye=ye.get(_e).__webglMultisampledFramebuffer:Ye=mt,M.copy(_e.viewport),T.copy(_e.scissor),R=_e.scissorTest}else M.copy(O).multiplyScalar(B).floor(),T.copy(z).multiplyScalar(B).floor(),R=G;if(Le.bindFramebuffer(36160,Ye)&&Se.drawBuffers){let yt=!1;if(_e)if(_e.isWebGLMultipleRenderTargets){const mt=_e.texture;if(k.length!==mt.length||k[0]!==36064){for(let St=0,vt=mt.length;St<vt;St++)k[St]=36064+St;k.length=mt.length,yt=!0}}else(k.length!==1||k[0]!==36064)&&(k[0]=36064,k.length=1,yt=!0);else(k.length!==1||k[0]!==1029)&&(k[0]=1029,k.length=1,yt=!0);yt&&(Se.isWebGL2?re.drawBuffers(k):ge.get("WEBGL_draw_buffers").drawBuffersWEBGL(k))}if(Le.viewport(M),Le.scissor(T),Le.setScissorTest(R),ot){const yt=ye.get(_e.texture);re.framebufferTexture2D(36160,36064,34069+Xe,yt.__webglTexture,Ue)}else if(gt){const yt=ye.get(_e.texture),mt=Xe||0;re.framebufferTextureLayer(36160,36064,yt.__webglTexture,Ue||0,mt)}},this.readRenderTargetPixels=function(_e,Xe,Ue,Ye,ot,gt,Et){if(!(_e&&_e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let yt=ye.get(_e).__webglFramebuffer;if(_e.isWebGLCubeRenderTarget&&Et!==void 0&&(yt=yt[Et]),yt){Le.bindFramebuffer(36160,yt);try{const mt=_e.texture,St=mt.format,vt=mt.type;if(St!==RGBAFormat&&X.convert(St)!==re.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Rt=vt===HalfFloatType&&(ge.has("EXT_color_buffer_half_float")||Se.isWebGL2&&ge.has("EXT_color_buffer_float"));if(vt!==UnsignedByteType&&X.convert(vt)!==re.getParameter(35738)&&!(vt===FloatType&&(Se.isWebGL2||ge.has("OES_texture_float")||ge.has("WEBGL_color_buffer_float")))&&!Rt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}re.checkFramebufferStatus(36160)===36053?Xe>=0&&Xe<=_e.width-Ye&&Ue>=0&&Ue<=_e.height-ot&&re.readPixels(Xe,Ue,Ye,ot,X.convert(St),X.convert(vt),gt):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const mt=w!==null?ye.get(w).__webglFramebuffer:null;Le.bindFramebuffer(36160,mt)}}},this.copyFramebufferToTexture=function(_e,Xe,Ue=0){const Ye=Math.pow(2,-Ue),ot=Math.floor(Xe.image.width*Ye),gt=Math.floor(Xe.image.height*Ye);let Et=X.convert(Xe.format);Se.isWebGL2&&(Et===6407&&(Et=32849),Et===6408&&(Et=32856)),ce.setTexture2D(Xe,0),re.copyTexImage2D(3553,Ue,Et,_e.x,_e.y,ot,gt,0),Le.unbindTexture()},this.copyTextureToTexture=function(_e,Xe,Ue,Ye=0){const ot=Xe.image.width,gt=Xe.image.height,Et=X.convert(Ue.format),yt=X.convert(Ue.type);ce.setTexture2D(Ue,0),re.pixelStorei(37440,Ue.flipY),re.pixelStorei(37441,Ue.premultiplyAlpha),re.pixelStorei(3317,Ue.unpackAlignment),Xe.isDataTexture?re.texSubImage2D(3553,Ye,_e.x,_e.y,ot,gt,Et,yt,Xe.image.data):Xe.isCompressedTexture?re.compressedTexSubImage2D(3553,Ye,_e.x,_e.y,Xe.mipmaps[0].width,Xe.mipmaps[0].height,Et,Xe.mipmaps[0].data):re.texSubImage2D(3553,Ye,_e.x,_e.y,Et,yt,Xe.image),Ye===0&&Ue.generateMipmaps&&re.generateMipmap(3553),Le.unbindTexture()},this.copyTextureToTexture3D=function(_e,Xe,Ue,Ye,ot=0){if(h.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const gt=_e.max.x-_e.min.x+1,Et=_e.max.y-_e.min.y+1,yt=_e.max.z-_e.min.z+1,mt=X.convert(Ye.format),St=X.convert(Ye.type);let vt;if(Ye.isDataTexture3D)ce.setTexture3D(Ye,0),vt=32879;else if(Ye.isDataTexture2DArray)ce.setTexture2DArray(Ye,0),vt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}re.pixelStorei(37440,Ye.flipY),re.pixelStorei(37441,Ye.premultiplyAlpha),re.pixelStorei(3317,Ye.unpackAlignment);const Rt=re.getParameter(3314),xt=re.getParameter(32878),dr=re.getParameter(3316),$t=re.getParameter(3315),pr=re.getParameter(32877),qt=Ue.isCompressedTexture?Ue.mipmaps[0]:Ue.image;re.pixelStorei(3314,qt.width),re.pixelStorei(32878,qt.height),re.pixelStorei(3316,_e.min.x),re.pixelStorei(3315,_e.min.y),re.pixelStorei(32877,_e.min.z),Ue.isDataTexture||Ue.isDataTexture3D?re.texSubImage3D(vt,ot,Xe.x,Xe.y,Xe.z,gt,Et,yt,mt,St,qt.data):Ue.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),re.compressedTexSubImage3D(vt,ot,Xe.x,Xe.y,Xe.z,gt,Et,yt,mt,qt.data)):re.texSubImage3D(vt,ot,Xe.x,Xe.y,Xe.z,gt,Et,yt,mt,St,qt),re.pixelStorei(3314,Rt),re.pixelStorei(32878,xt),re.pixelStorei(3316,dr),re.pixelStorei(3315,$t),re.pixelStorei(32877,pr),ot===0&&Ye.generateMipmaps&&re.generateMipmap(vt),Le.unbindTexture()},this.initTexture=function(_e){ce.setTexture2D(_e,0),Le.unbindTexture()},this.resetState=function(){C=0,x=0,w=null,Le.reset(),oe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Fog{constructor(t,e=1,n=1e3){this.name="",this.color=new Color(t),this.near=e,this.far=n}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fog.prototype.isFog=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),e}}Scene.prototype.isScene=!0;class InterleavedBuffer{constructor(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,a=this.stride;r<a;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}InterleavedBuffer.prototype.isInterleavedBuffer=!0;const _vector$6=new Vector3;class InterleavedBufferAttribute{constructor(t,e,n,r=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyMatrix4(t),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyNormalMatrix(t),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.transformDirection(t),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,a){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=a,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)e.push(this.data.array[r+a])}return new BufferAttribute(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)e.push(this.data.array[r+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}InterleavedBufferAttribute.prototype.isInterleavedBufferAttribute=!0;class SpriteMaterial extends Material{constructor(t){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}SpriteMaterial.prototype.isSpriteMaterial=!0;let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(t){if(super(),this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new InterleavedBuffer(e,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(n,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(n,2,3,!1))}this.geometry=_geometry,this.material=t!==void 0?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const n=this.material.rotation;let r,a;n!==0&&(a=Math.cos(n),r=Math.sin(n));const s=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,s,_worldScale,r,a),transformVertex(_vB.set(.5,-.5,0),_mvPosition,s,_worldScale,r,a),transformVertex(_vC.set(.5,.5,0),_mvPosition,s,_worldScale,r,a),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let l=t.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(l===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,s,_worldScale,r,a),_uvB.set(0,1),l=t.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),l===null))return;const c=t.ray.origin.distanceTo(_intersectPoint);c<t.near||c>t.far||e.push({distance:c,point:_intersectPoint.clone(),uv:Triangle$1.getUV(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(t){return super.copy(t),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}Sprite.prototype.isSprite=!0;function transformVertex(o,t,e,n,r,a){_alignedPosition.subVectors(o,e).addScalar(.5).multiply(n),r!==void 0?(_rotatedPosition.x=a*_alignedPosition.x-r*_alignedPosition.y,_rotatedPosition.y=r*_alignedPosition.x+a*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),o.copy(t),o.x+=_rotatedPosition.x,o.y+=_rotatedPosition.y,o.applyMatrix4(_viewWorldMatrix)}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector$5=new Vector3,_matrix=new Matrix4;class SkinnedMesh extends Mesh{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Vector4,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const a=1/t.manhattanLength();a!==1/0?t.multiplyScalar(a):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,r=this.geometry;_skinIndex.fromBufferAttribute(r.attributes.skinIndex,t),_skinWeight.fromBufferAttribute(r.attributes.skinWeight,t),_basePosition.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let a=0;a<4;a++){const s=_skinWeight.getComponent(a);if(s!==0){const l=_skinIndex.getComponent(a);_matrix.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),e.addScaledVector(_vector$5.copy(_basePosition).applyMatrix4(_matrix),s)}}return e.applyMatrix4(this.bindMatrixInverse)}}SkinnedMesh.prototype.isSkinnedMesh=!0;class Bone extends Object3D{constructor(){super(),this.type="Bone"}}Bone.prototype.isBone=!0;class DataTexture extends Texture{constructor(t=null,e=1,n=1,r,a,s,l,c,u=NearestFilter,f=NearestFilter,p,g){super(null,s,l,c,u,f,r,a,p,g),this.image={data:t,width:e,height:n},this.magFilter=u,this.minFilter=f,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;let InstancedMesh$1=class extends Mesh{constructor(t,e,n){super(t,e),this.instanceMatrix=new BufferAttribute(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const n=this.matrixWorld,r=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0)for(let a=0;a<r;a++){this.getMatrixAt(a,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(n,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(t,_instanceIntersects);for(let s=0,l=_instanceIntersects.length;s<l;s++){const c=_instanceIntersects[s];c.instanceId=a,c.object=this,e.push(c)}_instanceIntersects.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new BufferAttribute(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};InstancedMesh$1.prototype.isInstancedMesh=!0;class LineBasicMaterial extends Material{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(t=new BufferGeometry,e=new LineBasicMaterial){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,n=[0];for(let r=1,a=e.count;r<a;r++)_start$1.fromBufferAttribute(e,r-1),_end$1.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=_start$1.distanceTo(_end$1);t.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,a=t.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$1.copy(n.boundingSphere),_sphere$1.applyMatrix4(r),_sphere$1.radius+=a,t.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(r).invert(),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);const l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=new Vector3,f=new Vector3,p=new Vector3,g=new Vector3,y=this.isLineSegments?2:1;if(n.isBufferGeometry){const E=n.index,v=n.attributes.position;if(E!==null){const C=Math.max(0,s.start),x=Math.min(E.count,s.start+s.count);for(let w=C,_=x-1;w<_;w+=y){const S=E.getX(w),M=E.getX(w+1);if(u.fromBufferAttribute(v,S),f.fromBufferAttribute(v,M),_ray$1.distanceSqToSegment(u,f,g,p)>c)continue;g.applyMatrix4(this.matrixWorld);const R=t.ray.origin.distanceTo(g);R<t.near||R>t.far||e.push({distance:R,point:p.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else{const C=Math.max(0,s.start),x=Math.min(v.count,s.start+s.count);for(let w=C,_=x-1;w<_;w+=y){if(u.fromBufferAttribute(v,w),f.fromBufferAttribute(v,w+1),_ray$1.distanceSqToSegment(u,f,g,p)>c)continue;g.applyMatrix4(this.matrixWorld);const M=t.ray.origin.distanceTo(g);M<t.near||M>t.far||e.push({distance:M,point:p.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const r=e[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=r.length;a<s;a++){const l=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=a}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Line.prototype.isLine=!0;const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,n=[];for(let r=0,a=e.count;r<a;r+=2)_start.fromBufferAttribute(e,r),_end.fromBufferAttribute(e,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}LineSegments.prototype.isLineSegments=!0;class LineLoop extends Line{constructor(t,e){super(t,e),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends Material{constructor(t){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}PointsMaterial.prototype.isPointsMaterial=!0;const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(t=new BufferGeometry,e=new PointsMaterial){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,a=t.params.Points.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere.copy(n.boundingSphere),_sphere.applyMatrix4(r),_sphere.radius+=a,t.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(r).invert(),_ray.copy(t.ray).applyMatrix4(_inverseMatrix);const l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l;if(n.isBufferGeometry){const u=n.index,p=n.attributes.position;if(u!==null){const g=Math.max(0,s.start),y=Math.min(u.count,s.start+s.count);for(let E=g,h=y;E<h;E++){const v=u.getX(E);_position$2.fromBufferAttribute(p,v),testPoint(_position$2,v,c,r,t,e,this)}}else{const g=Math.max(0,s.start),y=Math.min(p.count,s.start+s.count);for(let E=g,h=y;E<h;E++)_position$2.fromBufferAttribute(p,E),testPoint(_position$2,E,c,r,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const r=e[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=r.length;a<s;a++){const l=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=a}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Points.prototype.isPoints=!0;function testPoint(o,t,e,n,r,a,s){const l=_ray.distanceSqToPoint(o);if(l<e){const c=new Vector3;_ray.closestPointToPoint(o,c),c.applyMatrix4(n);const u=r.ray.origin.distanceTo(c);if(u<r.near||u>r.far)return;a.push({distance:u,distanceToRay:Math.sqrt(l),point:c,index:t,face:null,object:s})}}class VideoTexture extends Texture{constructor(t,e,n,r,a,s,l,c,u){super(t,e,n,r,a,s,l,c,u),this.format=l!==void 0?l:RGBFormat,this.minFilter=s!==void 0?s:LinearFilter,this.magFilter=a!==void 0?a:LinearFilter,this.generateMipmaps=!1;const f=this;function p(){f.needsUpdate=!0,t.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(p)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(t,e,n,r,a,s,l,c,u,f,p,g){super(null,s,l,c,u,f,r,a,p,g),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(t,e,n,r,a,s,l,c,u){super(t,e,n,r,a,s,l,c,u),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(t,e,n,r,a,s,l,c,u,f){if(f=f!==void 0?f:DepthFormat,f!==DepthFormat&&f!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&f===DepthFormat&&(n=UnsignedShortType),n===void 0&&f===DepthStencilFormat&&(n=UnsignedInt248Type),super(null,r,a,s,l,c,f,n,u),this.image={width:t,height:e},this.magFilter=l!==void 0?l:NearestFilter,this.minFilter=c!==void 0?c:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CylinderGeometry extends BufferGeometry{constructor(t=1,e=1,n=1,r=8,a=1,s=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:a,openEnded:s,thetaStart:l,thetaLength:c};const u=this;r=Math.floor(r),a=Math.floor(a);const f=[],p=[],g=[],y=[];let E=0;const h=[],v=n/2;let C=0;x(),s===!1&&(t>0&&w(!0),e>0&&w(!1)),this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(g,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2));function x(){const _=new Vector3,S=new Vector3;let M=0;const T=(e-t)/n;for(let R=0;R<=a;R++){const P=[],I=R/a,B=I*(e-t)+t;for(let W=0;W<=r;W++){const D=W/r,O=D*c+l,z=Math.sin(O),G=Math.cos(O);S.x=B*z,S.y=-I*n+v,S.z=B*G,p.push(S.x,S.y,S.z),_.set(z,T,G).normalize(),g.push(_.x,_.y,_.z),y.push(D,1-I),P.push(E++)}h.push(P)}for(let R=0;R<r;R++)for(let P=0;P<a;P++){const I=h[P][R],B=h[P+1][R],W=h[P+1][R+1],D=h[P][R+1];f.push(I,B,D),f.push(B,W,D),M+=6}u.addGroup(C,M,0),C+=M}function w(_){const S=E,M=new Vector2,T=new Vector3;let R=0;const P=_===!0?t:e,I=_===!0?1:-1;for(let W=1;W<=r;W++)p.push(0,v*I,0),g.push(0,I,0),y.push(.5,.5),E++;const B=E;for(let W=0;W<=r;W++){const O=W/r*c+l,z=Math.cos(O),G=Math.sin(O);T.x=P*G,T.y=v*I,T.z=P*z,p.push(T.x,T.y,T.z),g.push(0,I,0),M.x=z*.5+.5,M.y=G*.5*I+.5,y.push(M.x,M.y),E++}for(let W=0;W<r;W++){const D=S+W,O=B+W;_===!0?f.push(O,O+1,D):f.push(O+1,O,D),R+=3}u.addGroup(C,R,_===!0?1:2),C+=R}}static fromJSON(t){return new CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),a=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),a+=n.distanceTo(r),e.push(a),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const a=n.length;let s;e?s=e:s=t*n[a-1];let l=0,c=a-1,u;for(;l<=c;)if(r=Math.floor(l+(c-l)/2),u=n[r]-s,u<0)l=r+1;else if(u>0)c=r-1;else{c=r;break}if(r=c,n[r]===s)return r/(a-1);const f=n[r],g=n[r+1]-f,y=(s-f)/g;return(r+y)/(a-1)}getTangent(t,e){let r=t-1e-4,a=t+1e-4;r<0&&(r=0),a>1&&(a=1);const s=this.getPoint(r),l=this.getPoint(a),c=e||(s.isVector2?new Vector2:new Vector3);return c.copy(l).sub(s).normalize(),c}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Vector3,r=[],a=[],s=[],l=new Vector3,c=new Matrix4;for(let y=0;y<=t;y++){const E=y/t;r[y]=this.getTangentAt(E,new Vector3),r[y].normalize()}a[0]=new Vector3,s[0]=new Vector3;let u=Number.MAX_VALUE;const f=Math.abs(r[0].x),p=Math.abs(r[0].y),g=Math.abs(r[0].z);f<=u&&(u=f,n.set(1,0,0)),p<=u&&(u=p,n.set(0,1,0)),g<=u&&n.set(0,0,1),l.crossVectors(r[0],n).normalize(),a[0].crossVectors(r[0],l),s[0].crossVectors(r[0],a[0]);for(let y=1;y<=t;y++){if(a[y]=a[y-1].clone(),s[y]=s[y-1].clone(),l.crossVectors(r[y-1],r[y]),l.length()>Number.EPSILON){l.normalize();const E=Math.acos(clamp$1(r[y-1].dot(r[y]),-1,1));a[y].applyMatrix4(c.makeRotationAxis(l,E))}s[y].crossVectors(r[y],a[y])}if(e===!0){let y=Math.acos(clamp$1(a[0].dot(a[t]),-1,1));y/=t,r[0].dot(l.crossVectors(a[0],a[t]))>0&&(y=-y);for(let E=1;E<=t;E++)a[E].applyMatrix4(c.makeRotationAxis(r[E],y*E)),s[E].crossVectors(r[E],a[E])}return{tangents:r,normals:a,binormals:s}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(t=0,e=0,n=1,r=1,a=0,s=Math.PI*2,l=!1,c=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=a,this.aEndAngle=s,this.aClockwise=l,this.aRotation=c}getPoint(t,e){const n=e||new Vector2,r=Math.PI*2;let a=this.aEndAngle-this.aStartAngle;const s=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(s?a=0:a=r),this.aClockwise===!0&&!s&&(a===r?a=-r:a=a-r);const l=this.aStartAngle+t*a;let c=this.aX+this.xRadius*Math.cos(l),u=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const f=Math.cos(this.aRotation),p=Math.sin(this.aRotation),g=c-this.aX,y=u-this.aY;c=g*f-y*p+this.aX,u=g*p+y*f+this.aY}return n.set(c,u)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(t,e,n,r,a,s){super(t,e,n,n,r,a,s),this.type="ArcCurve"}}ArcCurve.prototype.isArcCurve=!0;function CubicPoly(){let o=0,t=0,e=0,n=0;function r(a,s,l,c){o=a,t=l,e=-3*a+3*s-2*l-c,n=2*a-2*s+l+c}return{initCatmullRom:function(a,s,l,c,u){r(s,l,u*(l-a),u*(c-s))},initNonuniformCatmullRom:function(a,s,l,c,u,f,p){let g=(s-a)/u-(l-a)/(u+f)+(l-s)/f,y=(l-s)/f-(c-s)/(f+p)+(c-l)/p;g*=f,y*=f,r(s,l,g,y)},calc:function(a){const s=a*a,l=s*a;return o+t*a+e*s+n*l}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new Vector3){const n=e,r=this.points,a=r.length,s=(a-(this.closed?0:1))*t;let l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:c===0&&l===a-1&&(l=a-2,c=1);let u,f;this.closed||l>0?u=r[(l-1)%a]:(tmp.subVectors(r[0],r[1]).add(r[0]),u=tmp);const p=r[l%a],g=r[(l+1)%a];if(this.closed||l+2<a?f=r[(l+2)%a]:(tmp.subVectors(r[a-1],r[a-2]).add(r[a-1]),f=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let E=Math.pow(u.distanceToSquared(p),y),h=Math.pow(p.distanceToSquared(g),y),v=Math.pow(g.distanceToSquared(f),y);h<1e-4&&(h=1),E<1e-4&&(E=h),v<1e-4&&(v=h),px.initNonuniformCatmullRom(u.x,p.x,g.x,f.x,E,h,v),py.initNonuniformCatmullRom(u.y,p.y,g.y,f.y,E,h,v),pz.initNonuniformCatmullRom(u.z,p.z,g.z,f.z,E,h,v)}else this.curveType==="catmullrom"&&(px.initCatmullRom(u.x,p.x,g.x,f.x,this.tension),py.initCatmullRom(u.y,p.y,g.y,f.y,this.tension),pz.initCatmullRom(u.z,p.z,g.z,f.z,this.tension));return n.set(px.calc(c),py.calc(c),pz.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const r=t.points[e];this.points.push(new Vector3().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;function CatmullRom(o,t,e,n,r){const a=(n-t)*.5,s=(r-e)*.5,l=o*o,c=o*l;return(2*e-2*n+a+s)*c+(-3*e+3*n-2*a-s)*l+a*o+e}function QuadraticBezierP0(o,t){const e=1-o;return e*e*t}function QuadraticBezierP1(o,t){return 2*(1-o)*o*t}function QuadraticBezierP2(o,t){return o*o*t}function QuadraticBezier(o,t,e,n){return QuadraticBezierP0(o,t)+QuadraticBezierP1(o,e)+QuadraticBezierP2(o,n)}function CubicBezierP0(o,t){const e=1-o;return e*e*e*t}function CubicBezierP1(o,t){const e=1-o;return 3*e*e*o*t}function CubicBezierP2(o,t){return 3*(1-o)*o*o*t}function CubicBezierP3(o,t){return o*o*o*t}function CubicBezier(o,t,e,n,r){return CubicBezierP0(o,t)+CubicBezierP1(o,e)+CubicBezierP2(o,n)+CubicBezierP3(o,r)}class CubicBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,n=new Vector2,r=new Vector2){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Vector2){const n=e,r=this.v0,a=this.v1,s=this.v2,l=this.v3;return n.set(CubicBezier(t,r.x,a.x,s.x,l.x),CubicBezier(t,r.y,a.y,s.y,l.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3,n=new Vector3,r=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Vector3){const n=e,r=this.v0,a=this.v1,s=this.v2,l=this.v3;return n.set(CubicBezier(t,r.x,a.x,s.x,l.x),CubicBezier(t,r.y,a.y,s.y,l.y),CubicBezier(t,r.z,a.z,s.z,l.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(t=new Vector2,e=new Vector2){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Vector2){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Vector2;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Vector3){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,n=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Vector2){const n=e,r=this.v0,a=this.v1,s=this.v2;return n.set(QuadraticBezier(t,r.x,a.x,s.x),QuadraticBezier(t,r.y,a.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3,n=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Vector3){const n=e,r=this.v0,a=this.v1,s=this.v2;return n.set(QuadraticBezier(t,r.x,a.x,s.x),QuadraticBezier(t,r.y,a.y,s.y),QuadraticBezier(t,r.z,a.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Vector2){const n=e,r=this.points,a=(r.length-1)*t,s=Math.floor(a),l=a-s,c=r[s===0?s:s-1],u=r[s],f=r[s>r.length-2?r.length-1:s+1],p=r[s>r.length-3?r.length-1:s+2];return n.set(CatmullRom(l,c.x,u.x,f.x,p.x),CatmullRom(l,c.y,u.y,f.y,p.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const r=t.points[e];this.points.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const r=t.points[e];this.points.push(new Vector2().fromArray(r))}return this}}SplineCurve.prototype.isSplineCurve=!0;var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});const Earcut={triangulate:function(o,t,e=2){const n=t&&t.length,r=n?t[0]*e:o.length;let a=linkedList(o,0,r,e,!0);const s=[];if(!a||a.next===a.prev)return s;let l,c,u,f,p,g,y;if(n&&(a=eliminateHoles(o,t,a,e)),o.length>80*e){l=u=o[0],c=f=o[1];for(let E=e;E<r;E+=e)p=o[E],g=o[E+1],p<l&&(l=p),g<c&&(c=g),p>u&&(u=p),g>f&&(f=g);y=Math.max(u-l,f-c),y=y!==0?1/y:0}return earcutLinked(a,s,e,l,c,y),s}};function linkedList(o,t,e,n,r){let a,s;if(r===signedArea(o,t,e,n)>0)for(a=t;a<e;a+=n)s=insertNode(a,o[a],o[a+1],s);else for(a=e-n;a>=t;a-=n)s=insertNode(a,o[a],o[a+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(o,t){if(!o)return o;t||(t=o);let e=o,n;do if(n=!1,!e.steiner&&(equals(e,e.next)||area(e.prev,e,e.next)===0)){if(removeNode(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function earcutLinked(o,t,e,n,r,a,s){if(!o)return;!s&&a&&indexCurve(o,n,r,a);let l=o,c,u;for(;o.prev!==o.next;){if(c=o.prev,u=o.next,a?isEarHashed(o,n,r,a):isEar(o)){t.push(c.i/e),t.push(o.i/e),t.push(u.i/e),removeNode(o),o=u.next,l=u.next;continue}if(o=u,o===l){s?s===1?(o=cureLocalIntersections(filterPoints(o),t,e),earcutLinked(o,t,e,n,r,a,2)):s===2&&splitEarcut(o,t,e,n,r,a):earcutLinked(filterPoints(o),t,e,n,r,a,1);break}}}function isEar(o){const t=o.prev,e=o,n=o.next;if(area(t,e,n)>=0)return!1;let r=o.next.next;for(;r!==o.prev;){if(pointInTriangle(t.x,t.y,e.x,e.y,n.x,n.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(o,t,e,n){const r=o.prev,a=o,s=o.next;if(area(r,a,s)>=0)return!1;const l=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,c=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,u=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,f=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,p=zOrder(l,c,t,e,n),g=zOrder(u,f,t,e,n);let y=o.prevZ,E=o.nextZ;for(;y&&y.z>=p&&E&&E.z<=g;){if(y!==o.prev&&y!==o.next&&pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,y.x,y.y)&&area(y.prev,y,y.next)>=0||(y=y.prevZ,E!==o.prev&&E!==o.next&&pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,E.x,E.y)&&area(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;y&&y.z>=p;){if(y!==o.prev&&y!==o.next&&pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;E&&E.z<=g;){if(E!==o.prev&&E!==o.next&&pointInTriangle(r.x,r.y,a.x,a.y,s.x,s.y,E.x,E.y)&&area(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function cureLocalIntersections(o,t,e){let n=o;do{const r=n.prev,a=n.next.next;!equals(r,a)&&intersects(r,n,n.next,a)&&locallyInside(r,a)&&locallyInside(a,r)&&(t.push(r.i/e),t.push(n.i/e),t.push(a.i/e),removeNode(n),removeNode(n.next),n=o=a),n=n.next}while(n!==o);return filterPoints(n)}function splitEarcut(o,t,e,n,r,a){let s=o;do{let l=s.next.next;for(;l!==s.prev;){if(s.i!==l.i&&isValidDiagonal(s,l)){let c=splitPolygon(s,l);s=filterPoints(s,s.next),c=filterPoints(c,c.next),earcutLinked(s,t,e,n,r,a),earcutLinked(c,t,e,n,r,a);return}l=l.next}s=s.next}while(s!==o)}function eliminateHoles(o,t,e,n){const r=[];let a,s,l,c,u;for(a=0,s=t.length;a<s;a++)l=t[a]*n,c=a<s-1?t[a+1]*n:o.length,u=linkedList(o,l,c,n,!1),u===u.next&&(u.steiner=!0),r.push(getLeftmost(u));for(r.sort(compareX),a=0;a<r.length;a++)eliminateHole(r[a],e),e=filterPoints(e,e.next);return e}function compareX(o,t){return o.x-t.x}function eliminateHole(o,t){if(t=findHoleBridge(o,t),t){const e=splitPolygon(t,o);filterPoints(t,t.next),filterPoints(e,e.next)}}function findHoleBridge(o,t){let e=t;const n=o.x,r=o.y;let a=-1/0,s;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const g=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(g<=n&&g>a){if(a=g,g===n){if(r===e.y)return e;if(r===e.next.y)return e.next}s=e.x<e.next.x?e:e.next}}e=e.next}while(e!==t);if(!s)return null;if(n===a)return s;const l=s,c=s.x,u=s.y;let f=1/0,p;e=s;do n>=e.x&&e.x>=c&&n!==e.x&&pointInTriangle(r<u?n:a,r,c,u,r<u?a:n,r,e.x,e.y)&&(p=Math.abs(r-e.y)/(n-e.x),locallyInside(e,o)&&(p<f||p===f&&(e.x>s.x||e.x===s.x&&sectorContainsSector(s,e)))&&(s=e,f=p)),e=e.next;while(e!==l);return s}function sectorContainsSector(o,t){return area(o.prev,o,t.prev)<0&&area(t.next,o,o.next)<0}function indexCurve(o,t,e,n){let r=o;do r.z===null&&(r.z=zOrder(r.x,r.y,t,e,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==o);r.prevZ.nextZ=null,r.prevZ=null,sortLinked(r)}function sortLinked(o){let t,e,n,r,a,s,l,c,u=1;do{for(e=o,o=null,a=null,s=0;e;){for(s++,n=e,l=0,t=0;t<u&&(l++,n=n.nextZ,!!n);t++);for(c=u;l>0||c>0&&n;)l!==0&&(c===0||!n||e.z<=n.z)?(r=e,e=e.nextZ,l--):(r=n,n=n.nextZ,c--),a?a.nextZ=r:o=r,r.prevZ=a,a=r;e=n}a.nextZ=null,u*=2}while(s>1);return o}function zOrder(o,t,e,n,r){return o=32767*(o-e)*r,t=32767*(t-n)*r,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,o|t<<1}function getLeftmost(o){let t=o,e=o;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==o);return e}function pointInTriangle(o,t,e,n,r,a,s,l){return(r-s)*(t-l)-(o-s)*(a-l)>=0&&(o-s)*(n-l)-(e-s)*(t-l)>=0&&(e-s)*(a-l)-(r-s)*(n-l)>=0}function isValidDiagonal(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!intersectsPolygon(o,t)&&(locallyInside(o,t)&&locallyInside(t,o)&&middleInside(o,t)&&(area(o.prev,o,t.prev)||area(o,t.prev,t))||equals(o,t)&&area(o.prev,o,o.next)>0&&area(t.prev,t,t.next)>0)}function area(o,t,e){return(t.y-o.y)*(e.x-t.x)-(t.x-o.x)*(e.y-t.y)}function equals(o,t){return o.x===t.x&&o.y===t.y}function intersects(o,t,e,n){const r=sign(area(o,t,e)),a=sign(area(o,t,n)),s=sign(area(e,n,o)),l=sign(area(e,n,t));return!!(r!==a&&s!==l||r===0&&onSegment(o,e,t)||a===0&&onSegment(o,n,t)||s===0&&onSegment(e,o,n)||l===0&&onSegment(e,t,n))}function onSegment(o,t,e){return t.x<=Math.max(o.x,e.x)&&t.x>=Math.min(o.x,e.x)&&t.y<=Math.max(o.y,e.y)&&t.y>=Math.min(o.y,e.y)}function sign(o){return o>0?1:o<0?-1:0}function intersectsPolygon(o,t){let e=o;do{if(e.i!==o.i&&e.next.i!==o.i&&e.i!==t.i&&e.next.i!==t.i&&intersects(e,e.next,o,t))return!0;e=e.next}while(e!==o);return!1}function locallyInside(o,t){return area(o.prev,o,o.next)<0?area(o,t,o.next)>=0&&area(o,o.prev,t)>=0:area(o,t,o.prev)<0||area(o,o.next,t)<0}function middleInside(o,t){let e=o,n=!1;const r=(o.x+t.x)/2,a=(o.y+t.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&r<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==o);return n}function splitPolygon(o,t){const e=new Node(o.i,o.x,o.y),n=new Node(t.i,t.x,t.y),r=o.next,a=t.prev;return o.next=t,t.prev=o,e.next=r,r.prev=e,n.next=e,e.prev=n,a.next=n,n.prev=a,n}function insertNode(o,t,e,n){const r=new Node(o,t,e);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function removeNode(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Node(o,t,e){this.i=o,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(o,t,e,n){let r=0;for(let a=t,s=e-n;a<e;a+=n)r+=(o[s]-o[a])*(o[a+1]+o[s+1]),s=a;return r}class ShapeUtils{static area(t){const e=t.length;let n=0;for(let r=e-1,a=0;a<e;r=a++)n+=t[r].x*t[a].y-t[a].x*t[r].y;return n*.5}static isClockWise(t){return ShapeUtils.area(t)<0}static triangulateShape(t,e){const n=[],r=[],a=[];removeDupEndPts(t),addContour(n,t);let s=t.length;e.forEach(removeDupEndPts);for(let c=0;c<e.length;c++)r.push(s),s+=e[c].length,addContour(n,e[c]);const l=Earcut.triangulate(n,r);for(let c=0;c<l.length;c+=3)a.push(l.slice(c,c+3));return a}}function removeDupEndPts(o){const t=o.length;t>2&&o[t-1].equals(o[0])&&o.pop()}function addContour(o,t){for(let e=0;e<t.length;e++)o.push(t[e].x),o.push(t[e].y)}class ExtrudeGeometry extends BufferGeometry{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],a=[];for(let l=0,c=t.length;l<c;l++){const u=t[l];s(u)}this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),this.computeVertexNormals();function s(l){const c=[],u=e.curveSegments!==void 0?e.curveSegments:12,f=e.steps!==void 0?e.steps:1;let p=e.depth!==void 0?e.depth:100,g=e.bevelEnabled!==void 0?e.bevelEnabled:!0,y=e.bevelThickness!==void 0?e.bevelThickness:6,E=e.bevelSize!==void 0?e.bevelSize:y-2,h=e.bevelOffset!==void 0?e.bevelOffset:0,v=e.bevelSegments!==void 0?e.bevelSegments:3;const C=e.extrudePath,x=e.UVGenerator!==void 0?e.UVGenerator:WorldUVGenerator;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),p=e.amount);let w,_=!1,S,M,T,R;C&&(w=C.getSpacedPoints(f),_=!0,g=!1,S=C.computeFrenetFrames(f,!1),M=new Vector3,T=new Vector3,R=new Vector3),g||(v=0,y=0,E=0,h=0);const P=l.extractPoints(u);let I=P.shape;const B=P.holes;if(!ShapeUtils.isClockWise(I)){I=I.reverse();for(let ye=0,ce=B.length;ye<ce;ye++){const ue=B[ye];ShapeUtils.isClockWise(ue)&&(B[ye]=ue.reverse())}}const D=ShapeUtils.triangulateShape(I,B),O=I;for(let ye=0,ce=B.length;ye<ce;ye++){const ue=B[ye];I=I.concat(ue)}function z(ye,ce,ue){return ce||console.error("THREE.ExtrudeGeometry: vec does not exist"),ce.clone().multiplyScalar(ue).add(ye)}const G=I.length,k=D.length;function $(ye,ce,ue){let Ce,Ve,ie;const ae=ye.x-ce.x,Ae=ye.y-ce.y,De=ue.x-ye.x,Be=ue.y-ye.y,ze=ae*ae+Ae*Ae,We=ae*Be-Ae*De;if(Math.abs(We)>Number.EPSILON){const $e=Math.sqrt(ze),qe=Math.sqrt(De*De+Be*Be),et=ce.x-Ae/$e,F=ce.y+ae/$e,H=ue.x-Be/qe,X=ue.y+De/qe,oe=((H-et)*Be-(X-F)*De)/(ae*Be-Ae*De);Ce=et+ae*oe-ye.x,Ve=F+Ae*oe-ye.y;const te=Ce*Ce+Ve*Ve;if(te<=2)return new Vector2(Ce,Ve);ie=Math.sqrt(te/2)}else{let $e=!1;ae>Number.EPSILON?De>Number.EPSILON&&($e=!0):ae<-Number.EPSILON?De<-Number.EPSILON&&($e=!0):Math.sign(Ae)===Math.sign(Be)&&($e=!0),$e?(Ce=-Ae,Ve=ae,ie=Math.sqrt(ze)):(Ce=ae,Ve=Ae,ie=Math.sqrt(ze/2))}return new Vector2(Ce/ie,Ve/ie)}const Z=[];for(let ye=0,ce=O.length,ue=ce-1,Ce=ye+1;ye<ce;ye++,ue++,Ce++)ue===ce&&(ue=0),Ce===ce&&(Ce=0),Z[ye]=$(O[ye],O[ue],O[Ce]);const K=[];let j,Q=Z.concat();for(let ye=0,ce=B.length;ye<ce;ye++){const ue=B[ye];j=[];for(let Ce=0,Ve=ue.length,ie=Ve-1,ae=Ce+1;Ce<Ve;Ce++,ie++,ae++)ie===Ve&&(ie=0),ae===Ve&&(ae=0),j[Ce]=$(ue[Ce],ue[ie],ue[ae]);K.push(j),Q=Q.concat(j)}for(let ye=0;ye<v;ye++){const ce=ye/v,ue=y*Math.cos(ce*Math.PI/2),Ce=E*Math.sin(ce*Math.PI/2)+h;for(let Ve=0,ie=O.length;Ve<ie;Ve++){const ae=z(O[Ve],Z[Ve],Ce);Ie(ae.x,ae.y,-ue)}for(let Ve=0,ie=B.length;Ve<ie;Ve++){const ae=B[Ve];j=K[Ve];for(let Ae=0,De=ae.length;Ae<De;Ae++){const Be=z(ae[Ae],j[Ae],Ce);Ie(Be.x,Be.y,-ue)}}}const le=E+h;for(let ye=0;ye<G;ye++){const ce=g?z(I[ye],Q[ye],le):I[ye];_?(T.copy(S.normals[0]).multiplyScalar(ce.x),M.copy(S.binormals[0]).multiplyScalar(ce.y),R.copy(w[0]).add(T).add(M),Ie(R.x,R.y,R.z)):Ie(ce.x,ce.y,0)}for(let ye=1;ye<=f;ye++)for(let ce=0;ce<G;ce++){const ue=g?z(I[ce],Q[ce],le):I[ce];_?(T.copy(S.normals[ye]).multiplyScalar(ue.x),M.copy(S.binormals[ye]).multiplyScalar(ue.y),R.copy(w[ye]).add(T).add(M),Ie(R.x,R.y,R.z)):Ie(ue.x,ue.y,p/f*ye)}for(let ye=v-1;ye>=0;ye--){const ce=ye/v,ue=y*Math.cos(ce*Math.PI/2),Ce=E*Math.sin(ce*Math.PI/2)+h;for(let Ve=0,ie=O.length;Ve<ie;Ve++){const ae=z(O[Ve],Z[Ve],Ce);Ie(ae.x,ae.y,p+ue)}for(let Ve=0,ie=B.length;Ve<ie;Ve++){const ae=B[Ve];j=K[Ve];for(let Ae=0,De=ae.length;Ae<De;Ae++){const Be=z(ae[Ae],j[Ae],Ce);_?Ie(Be.x,Be.y+w[f-1].y,w[f-1].x+ue):Ie(Be.x,Be.y,p+ue)}}}he(),ve();function he(){const ye=r.length/3;if(g){let ce=0,ue=G*ce;for(let Ce=0;Ce<k;Ce++){const Ve=D[Ce];ge(Ve[2]+ue,Ve[1]+ue,Ve[0]+ue)}ce=f+v*2,ue=G*ce;for(let Ce=0;Ce<k;Ce++){const Ve=D[Ce];ge(Ve[0]+ue,Ve[1]+ue,Ve[2]+ue)}}else{for(let ce=0;ce<k;ce++){const ue=D[ce];ge(ue[2],ue[1],ue[0])}for(let ce=0;ce<k;ce++){const ue=D[ce];ge(ue[0]+G*f,ue[1]+G*f,ue[2]+G*f)}}n.addGroup(ye,r.length/3-ye,0)}function ve(){const ye=r.length/3;let ce=0;re(O,ce),ce+=O.length;for(let ue=0,Ce=B.length;ue<Ce;ue++){const Ve=B[ue];re(Ve,ce),ce+=Ve.length}n.addGroup(ye,r.length/3-ye,1)}function re(ye,ce){let ue=ye.length;for(;--ue>=0;){const Ce=ue;let Ve=ue-1;Ve<0&&(Ve=ye.length-1);for(let ie=0,ae=f+v*2;ie<ae;ie++){const Ae=G*ie,De=G*(ie+1),Be=ce+Ce+Ae,ze=ce+Ve+Ae,We=ce+Ve+De,$e=ce+Ce+De;Se(Be,ze,We,$e)}}}function Ie(ye,ce,ue){c.push(ye),c.push(ce),c.push(ue)}function ge(ye,ce,ue){Le(ye),Le(ce),Le(ue);const Ce=r.length/3,Ve=x.generateTopUV(n,r,Ce-3,Ce-2,Ce-1);be(Ve[0]),be(Ve[1]),be(Ve[2])}function Se(ye,ce,ue,Ce){Le(ye),Le(ce),Le(Ce),Le(ce),Le(ue),Le(Ce);const Ve=r.length/3,ie=x.generateSideWallUV(n,r,Ve-6,Ve-3,Ve-2,Ve-1);be(ie[0]),be(ie[1]),be(ie[3]),be(ie[1]),be(ie[2]),be(ie[3])}function Le(ye){r.push(c[ye*3+0]),r.push(c[ye*3+1]),r.push(c[ye*3+2])}function be(ye){a.push(ye.x),a.push(ye.y)}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,n=this.parameters.options;return toJSON$1(e,n,t)}static fromJSON(t,e){const n=[];for(let a=0,s=t.shapes.length;a<s;a++){const l=e[t.shapes[a]];n.push(l)}const r=t.options.extrudePath;return r!==void 0&&(t.options.extrudePath=new Curves[r.type]().fromJSON(r)),new ExtrudeGeometry(n,t.options)}}const WorldUVGenerator={generateTopUV:function(o,t,e,n,r){const a=t[e*3],s=t[e*3+1],l=t[n*3],c=t[n*3+1],u=t[r*3],f=t[r*3+1];return[new Vector2(a,s),new Vector2(l,c),new Vector2(u,f)]},generateSideWallUV:function(o,t,e,n,r,a){const s=t[e*3],l=t[e*3+1],c=t[e*3+2],u=t[n*3],f=t[n*3+1],p=t[n*3+2],g=t[r*3],y=t[r*3+1],E=t[r*3+2],h=t[a*3],v=t[a*3+1],C=t[a*3+2];return Math.abs(l-f)<Math.abs(s-u)?[new Vector2(s,1-c),new Vector2(u,1-p),new Vector2(g,1-E),new Vector2(h,1-C)]:[new Vector2(l,1-c),new Vector2(f,1-p),new Vector2(y,1-E),new Vector2(v,1-C)]}};function toJSON$1(o,t,e){if(e.shapes=[],Array.isArray(o))for(let n=0,r=o.length;n<r;n++){const a=o[n];e.shapes.push(a.uuid)}else e.shapes.push(o.uuid);return t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class ShapeGeometry extends BufferGeometry{constructor(t,e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],r=[],a=[],s=[];let l=0,c=0;if(Array.isArray(t)===!1)u(t);else for(let f=0;f<t.length;f++)u(t[f]),this.addGroup(l,c,f),l+=c,c=0;this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2));function u(f){const p=r.length/3,g=f.extractPoints(e);let y=g.shape;const E=g.holes;ShapeUtils.isClockWise(y)===!1&&(y=y.reverse());for(let v=0,C=E.length;v<C;v++){const x=E[v];ShapeUtils.isClockWise(x)===!0&&(E[v]=x.reverse())}const h=ShapeUtils.triangulateShape(y,E);for(let v=0,C=E.length;v<C;v++){const x=E[v];y=y.concat(x)}for(let v=0,C=y.length;v<C;v++){const x=y[v];r.push(x.x,x.y,0),a.push(0,0,1),s.push(x.x,x.y)}for(let v=0,C=h.length;v<C;v++){const x=h[v],w=x[0]+p,_=x[1]+p,S=x[2]+p;n.push(w,_,S),c+=3}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return toJSON(e,t)}static fromJSON(t,e){const n=[];for(let r=0,a=t.shapes.length;r<a;r++){const s=e[t.shapes[r]];n.push(s)}return new ShapeGeometry(n,t.curveSegments)}}function toJSON(o,t){if(t.shapes=[],Array.isArray(o))for(let e=0,n=o.length;e<n;e++){const r=o[e];t.shapes.push(r.uuid)}else t.shapes.push(o.uuid);return t}class SphereGeometry extends BufferGeometry{constructor(t=1,e=32,n=16,r=0,a=Math.PI*2,s=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:a,thetaStart:s,thetaLength:l},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const c=Math.min(s+l,Math.PI);let u=0;const f=[],p=new Vector3,g=new Vector3,y=[],E=[],h=[],v=[];for(let C=0;C<=n;C++){const x=[],w=C/n;let _=0;C==0&&s==0?_=.5/e:C==n&&c==Math.PI&&(_=-.5/e);for(let S=0;S<=e;S++){const M=S/e;p.x=-t*Math.cos(r+M*a)*Math.sin(s+w*l),p.y=t*Math.cos(s+w*l),p.z=t*Math.sin(r+M*a)*Math.sin(s+w*l),E.push(p.x,p.y,p.z),g.copy(p).normalize(),h.push(g.x,g.y,g.z),v.push(M+_,1-w),x.push(u++)}f.push(x)}for(let C=0;C<n;C++)for(let x=0;x<e;x++){const w=f[C][x+1],_=f[C][x],S=f[C+1][x],M=f[C+1][x+1];(C!==0||s>0)&&y.push(w,_,M),(C!==n-1||c<Math.PI)&&y.push(_,S,M)}this.setIndex(y),this.setAttribute("position",new Float32BufferAttribute(E,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(v,2))}static fromJSON(t){return new SphereGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class ShadowMaterial extends Material{constructor(t){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class MeshStandardMaterial extends Material{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=clamp$1(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Color(1,1,1),this.specularTintMap=null,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Color).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationTint.copy(t.attenuationTint),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularTint.copy(t.specularTint),this.specularTintMap=t.specularTintMap,this}}MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;class MeshPhongMaterial extends Material{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends Material{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends Material{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends Material{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends Material{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;const AnimationUtils={arraySlice:function(o,t,e){return AnimationUtils.isTypedArray(o)?new o.constructor(o.subarray(t,e!==void 0?e:o.length)):o.slice(t,e)},convertArray:function(o,t,e){return!o||!e&&o.constructor===t?o:typeof t.BYTES_PER_ELEMENT=="number"?new t(o):Array.prototype.slice.call(o)},isTypedArray:function(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)},getKeyframeOrder:function(o){function t(r,a){return o[r]-o[a]}const e=o.length,n=new Array(e);for(let r=0;r!==e;++r)n[r]=r;return n.sort(t),n},sortedArray:function(o,t,e){const n=o.length,r=new o.constructor(n);for(let a=0,s=0;s!==n;++a){const l=e[a]*t;for(let c=0;c!==t;++c)r[s++]=o[l+c]}return r},flattenJSON:function(o,t,e,n){let r=1,a=o[0];for(;a!==void 0&&a[n]===void 0;)a=o[r++];if(a===void 0)return;let s=a[n];if(s!==void 0)if(Array.isArray(s))do s=a[n],s!==void 0&&(t.push(a.time),e.push.apply(e,s)),a=o[r++];while(a!==void 0);else if(s.toArray!==void 0)do s=a[n],s!==void 0&&(t.push(a.time),s.toArray(e,e.length)),a=o[r++];while(a!==void 0);else do s=a[n],s!==void 0&&(t.push(a.time),e.push(s)),a=o[r++];while(a!==void 0)},subclip:function(o,t,e,n,r=30){const a=o.clone();a.name=t;const s=[];for(let c=0;c<a.tracks.length;++c){const u=a.tracks[c],f=u.getValueSize(),p=[],g=[];for(let y=0;y<u.times.length;++y){const E=u.times[y]*r;if(!(E<e||E>=n)){p.push(u.times[y]);for(let h=0;h<f;++h)g.push(u.values[y*f+h])}}p.length!==0&&(u.times=AnimationUtils.convertArray(p,u.times.constructor),u.values=AnimationUtils.convertArray(g,u.values.constructor),s.push(u))}a.tracks=s;let l=1/0;for(let c=0;c<a.tracks.length;++c)l>a.tracks[c].times[0]&&(l=a.tracks[c].times[0]);for(let c=0;c<a.tracks.length;++c)a.tracks[c].shift(-1*l);return a.resetDuration(),a},makeClipAdditive:function(o,t=0,e=o,n=30){n<=0&&(n=30);const r=e.tracks.length,a=t/n;for(let s=0;s<r;++s){const l=e.tracks[s],c=l.ValueTypeName;if(c==="bool"||c==="string")continue;const u=o.tracks.find(function(C){return C.name===l.name&&C.ValueTypeName===c});if(u===void 0)continue;let f=0;const p=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);let g=0;const y=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=y/3);const E=l.times.length-1;let h;if(a<=l.times[0]){const C=f,x=p-f;h=AnimationUtils.arraySlice(l.values,C,x)}else if(a>=l.times[E]){const C=E*p+f,x=C+p-f;h=AnimationUtils.arraySlice(l.values,C,x)}else{const C=l.createInterpolant(),x=f,w=p-f;C.evaluate(a),h=AnimationUtils.arraySlice(C.resultBuffer,x,w)}c==="quaternion"&&new Quaternion().fromArray(h).normalize().conjugate().toArray(h);const v=u.times.length;for(let C=0;C<v;++C){const x=C*y+g;if(c==="quaternion")Quaternion.multiplyQuaternionsFlat(u.values,x,h,0,u.values,x);else{const w=y-g*2;for(let _=0;_<w;++_)u.values[x+_]-=h[_]}}}return o.blendMode=AdditiveAnimationBlendMode,o}};class Interpolant{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],a=e[n-1];e:{t:{let s;r:{n:if(!(t<r)){for(let l=n+2;;){if(r===void 0){if(t<a)break n;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,a)}if(n===l)break;if(a=r,r=e[++n],t<r)break t}s=e.length;break r}if(!(t>=a)){const l=e[1];t<l&&(n=2,a=l);for(let c=n-2;;){if(a===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===c)break;if(r=a,a=e[--n-1],t>=a)break t}s=n,n=0;break r}break e}for(;n<s;){const l=n+s>>>1;t<e[l]?s=l:n=l+1}if(r=e[n],a=e[n-1],a===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(r===void 0)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,a,t)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=t*r;for(let s=0;s!==r;++s)e[s]=n[a+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Interpolant.prototype.beforeStart_=Interpolant.prototype.copySampleValue_;Interpolant.prototype.afterEnd_=Interpolant.prototype.copySampleValue_;class CubicInterpolant extends Interpolant{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(t,e,n){const r=this.parameterPositions;let a=t-2,s=t+1,l=r[a],c=r[s];if(l===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:a=t,l=2*e-n;break;case WrapAroundEnding:a=r.length-2,l=e+r[a]-r[a+1];break;default:a=t,l=n}if(c===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:s=t,c=2*n-e;break;case WrapAroundEnding:s=1,c=n+r[1]-r[0];break;default:s=t-1,c=e}const u=(n-e)*.5,f=this.valueSize;this._weightPrev=u/(e-l),this._weightNext=u/(c-n),this._offsetPrev=a*f,this._offsetNext=s*f}interpolate_(t,e,n,r){const a=this.resultBuffer,s=this.sampleValues,l=this.valueSize,c=t*l,u=c-l,f=this._offsetPrev,p=this._offsetNext,g=this._weightPrev,y=this._weightNext,E=(n-e)/(r-e),h=E*E,v=h*E,C=-g*v+2*g*h-g*E,x=(1+g)*v+(-1.5-2*g)*h+(-.5+g)*E+1,w=(-1-y)*v+(1.5+y)*h+.5*E,_=y*v-y*h;for(let S=0;S!==l;++S)a[S]=C*s[f+S]+x*s[u+S]+w*s[c+S]+_*s[p+S];return a}}class LinearInterpolant extends Interpolant{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const a=this.resultBuffer,s=this.sampleValues,l=this.valueSize,c=t*l,u=c-l,f=(n-e)/(r-e),p=1-f;for(let g=0;g!==l;++g)a[g]=s[u+g]*p+s[c+g]*f;return a}}class DiscreteInterpolant extends Interpolant{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class KeyframeTrack{constructor(t,e,n,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=AnimationUtils.convertArray(e,this.TimeBufferType),this.values=AnimationUtils.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:AnimationUtils.convertArray(t.times,Array),values:AnimationUtils.convertArray(t.values,Array)};const r=t.getInterpolation();r!==t.DefaultInterpolation&&(n.interpolation=r)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case InterpolateDiscrete:e=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:e=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let a=0,s=r-1;for(;a!==r&&n[a]<t;)++a;for(;s!==-1&&n[s]>e;)--s;if(++s,a!==0||s!==r){a>=s&&(s=Math.max(s,1),a=s-1);const l=this.getValueSize();this.times=AnimationUtils.arraySlice(n,a,s),this.values=AnimationUtils.arraySlice(this.values,a*l,s*l)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,a=n.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let l=0;l!==a;l++){const c=n[l];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,c),t=!1;break}if(s!==null&&s>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,c,s),t=!1;break}s=c}if(r!==void 0&&AnimationUtils.isTypedArray(r))for(let l=0,c=r.length;l!==c;++l){const u=r[l];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,u),t=!1;break}}return t}optimize(){const t=AnimationUtils.arraySlice(this.times),e=AnimationUtils.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===InterpolateSmooth,a=t.length-1;let s=1;for(let l=1;l<a;++l){let c=!1;const u=t[l],f=t[l+1];if(u!==f&&(l!==1||u!==t[0]))if(r)c=!0;else{const p=l*n,g=p-n,y=p+n;for(let E=0;E!==n;++E){const h=e[p+E];if(h!==e[g+E]||h!==e[y+E]){c=!0;break}}}if(c){if(l!==s){t[s]=t[l];const p=l*n,g=s*n;for(let y=0;y!==n;++y)e[g+y]=e[p+y]}++s}}if(a>0){t[s]=t[a];for(let l=a*n,c=s*n,u=0;u!==n;++u)e[c+u]=e[l+u];++s}return s!==t.length?(this.times=AnimationUtils.arraySlice(t,0,s),this.values=AnimationUtils.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=AnimationUtils.arraySlice(this.times,0),e=AnimationUtils.arraySlice(this.values,0),n=this.constructor,r=new n(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const a=this.resultBuffer,s=this.sampleValues,l=this.valueSize,c=(n-e)/(r-e);let u=t*l;for(let f=u+l;u!==f;u+=4)Quaternion.slerpFlat(a,0,s,u-l,s,u,c);return a}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(t,e=-1,n,r=NormalAnimationBlendMode){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let s=0,l=n.length;s!==l;++s)e.push(parseKeyframeTrack(n[s]).scale(r));const a=new this(t.name,t.duration,e,t.blendMode);return a.uuid=t.uuid,a}static toJSON(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let a=0,s=n.length;a!==s;++a)e.push(KeyframeTrack.toJSON(n[a]));return r}static CreateFromMorphTargetSequence(t,e,n,r){const a=e.length,s=[];for(let l=0;l<a;l++){let c=[],u=[];c.push((l+a-1)%a,l,(l+1)%a),u.push(0,1,0);const f=AnimationUtils.getKeyframeOrder(c);c=AnimationUtils.sortedArray(c,1,f),u=AnimationUtils.sortedArray(u,1,f),!r&&c[0]===0&&(c.push(a),u.push(u[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[l].name+"]",c,u).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const r=t;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const r={},a=/^([\w-]*?)([\d]+)$/;for(let l=0,c=t.length;l<c;l++){const u=t[l],f=u.name.match(a);if(f&&f.length>1){const p=f[1];let g=r[p];g||(r[p]=g=[]),g.push(u)}}const s=[];for(const l in r)s.push(this.CreateFromMorphTargetSequence(l,r[l],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(p,g,y,E,h){if(y.length!==0){const v=[],C=[];AnimationUtils.flattenJSON(y,v,C,E),v.length!==0&&h.push(new p(g,v,C))}},r=[],a=t.name||"default",s=t.fps||30,l=t.blendMode;let c=t.length||-1;const u=t.hierarchy||[];for(let p=0;p<u.length;p++){const g=u[p].keys;if(!(!g||g.length===0))if(g[0].morphTargets){const y={};let E;for(E=0;E<g.length;E++)if(g[E].morphTargets)for(let h=0;h<g[E].morphTargets.length;h++)y[g[E].morphTargets[h]]=-1;for(const h in y){const v=[],C=[];for(let x=0;x!==g[E].morphTargets.length;++x){const w=g[E];v.push(w.time),C.push(w.morphTarget===h?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+h+"]",v,C))}c=y.length*(s||1)}else{const y=".bones["+e[p].name+"]";n(VectorKeyframeTrack,y+".position",g,"pos",r),n(QuaternionKeyframeTrack,y+".quaternion",g,"rot",r),n(VectorKeyframeTrack,y+".scale",g,"scl",r)}}return r.length===0?null:new this(a,c,r,l)}resetDuration(){const t=this.tracks;let e=0;for(let n=0,r=t.length;n!==r;++n){const a=this.tracks[n];e=Math.max(e,a.times[a.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function parseKeyframeTrack(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(o.type);if(o.times===void 0){const e=[],n=[];AnimationUtils.flattenJSON(o.keys,e,n,"value"),o.times=e,o.values=n}return t.parse!==void 0?t.parse(o):new t(o.name,o.times,o.values,o.interpolation)}const Cache={enabled:!1,files:{},add:function(o,t){this.enabled!==!1&&(this.files[o]=t)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class LoadingManager{constructor(t,e,n){const r=this;let a=!1,s=0,l=0,c;const u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(f){l++,a===!1&&r.onStart!==void 0&&r.onStart(f,s,l),a=!0},this.itemEnd=function(f){s++,r.onProgress!==void 0&&r.onProgress(f,s,l),s===l&&(a=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(f){r.onError!==void 0&&r.onError(f)},this.resolveURL=function(f){return c?c(f):f},this.setURLModifier=function(f){return c=f,this},this.addHandler=function(f,p){return u.push(f,p),this},this.removeHandler=function(f){const p=u.indexOf(f);return p!==-1&&u.splice(p,2),this},this.getHandler=function(f){for(let p=0,g=u.length;p<g;p+=2){const y=u[p],E=u[p+1];if(y.global&&(y.lastIndex=0),y.test(f))return E}return null}}}const DefaultLoadingManager=new LoadingManager;let Loader$1=class{constructor(t){this.manager=t!==void 0?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(r,a){n.load(t,r,e,a)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};const loading={};let FileLoader$1=class extends Loader$1{constructor(t){super(t)}load(t,e,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,s=Cache.get(t);if(s!==void 0)return a.manager.itemStart(t),setTimeout(function(){e&&e(s),a.manager.itemEnd(t)},0),s;if(loading[t]!==void 0){loading[t].push({onLoad:e,onProgress:n,onError:r});return}const l=/^data:(.*?)(;base64)?,(.*)$/,c=t.match(l);let u;if(c){const f=c[1],p=!!c[2];let g=c[3];g=decodeURIComponent(g),p&&(g=atob(g));try{let y;const E=(this.responseType||"").toLowerCase();switch(E){case"arraybuffer":case"blob":const h=new Uint8Array(g.length);for(let C=0;C<g.length;C++)h[C]=g.charCodeAt(C);E==="blob"?y=new Blob([h.buffer],{type:f}):y=h.buffer;break;case"document":y=new DOMParser().parseFromString(g,f);break;case"json":y=JSON.parse(g);break;default:y=g;break}setTimeout(function(){e&&e(y),a.manager.itemEnd(t)},0)}catch(y){setTimeout(function(){r&&r(y),a.manager.itemError(t),a.manager.itemEnd(t)},0)}}else{loading[t]=[],loading[t].push({onLoad:e,onProgress:n,onError:r}),u=new XMLHttpRequest,u.open("GET",t,!0),u.addEventListener("load",function(f){const p=this.response,g=loading[t];if(delete loading[t],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(t,p);for(let y=0,E=g.length;y<E;y++){const h=g[y];h.onLoad&&h.onLoad(p)}a.manager.itemEnd(t)}else{for(let y=0,E=g.length;y<E;y++){const h=g[y];h.onError&&h.onError(f)}a.manager.itemError(t),a.manager.itemEnd(t)}},!1),u.addEventListener("progress",function(f){const p=loading[t];for(let g=0,y=p.length;g<y;g++){const E=p[g];E.onProgress&&E.onProgress(f)}},!1),u.addEventListener("error",function(f){const p=loading[t];delete loading[t];for(let g=0,y=p.length;g<y;g++){const E=p[g];E.onError&&E.onError(f)}a.manager.itemError(t),a.manager.itemEnd(t)},!1),u.addEventListener("abort",function(f){const p=loading[t];delete loading[t];for(let g=0,y=p.length;g<y;g++){const E=p[g];E.onError&&E.onError(f)}a.manager.itemError(t),a.manager.itemEnd(t)},!1),this.responseType!==void 0&&(u.responseType=this.responseType),this.withCredentials!==void 0&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const f in this.requestHeader)u.setRequestHeader(f,this.requestHeader[f]);u.send(null)}return a.manager.itemStart(t),u}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}};class ImageLoader extends Loader$1{constructor(t){super(t)}load(t,e,n,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,s=Cache.get(t);if(s!==void 0)return a.manager.itemStart(t),setTimeout(function(){e&&e(s),a.manager.itemEnd(t)},0),s;const l=document.createElementNS("http://www.w3.org/1999/xhtml","img");function c(){l.removeEventListener("load",c,!1),l.removeEventListener("error",u,!1),Cache.add(t,this),e&&e(this),a.manager.itemEnd(t)}function u(f){l.removeEventListener("load",c,!1),l.removeEventListener("error",u,!1),r&&r(f),a.manager.itemError(t),a.manager.itemEnd(t)}return l.addEventListener("load",c,!1),l.addEventListener("error",u,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),a.manager.itemStart(t),l.src=t,l}}class CubeTextureLoader extends Loader$1{constructor(t){super(t)}load(t,e,n,r){const a=new CubeTexture,s=new ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let l=0;function c(u){s.load(t[u],function(f){a.images[u]=f,l++,l===6&&(a.needsUpdate=!0,e&&e(a))},void 0,r)}for(let u=0;u<t.length;++u)c(u);return a}}class TextureLoader extends Loader$1{constructor(t){super(t)}load(t,e,n,r){const a=new Texture,s=new ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(l){a.image=l;const c=t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0;a.format=c?RGBFormat:RGBAFormat,a.needsUpdate=!0,e!==void 0&&e(a)},n,r),a}}class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new LineCurve(e,t))}getPoint(t){const e=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=e){const a=n[r]-e,s=this.curves[r],l=s.getLength(),c=l===0?0:1-a/l;return s.getPointAt(c)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let r=0,a=this.curves;r<a.length;r++){const s=a[r],l=s&&s.isEllipseCurve?t*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,c=s.getPoints(l);for(let u=0;u<c.length;u++){const f=c[u];n&&n.equals(f)||(e.push(f),n=f)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const r=t.curves[e];this.curves.push(new Curves[r.type]().fromJSON(r))}return this}}class Path extends CurvePath{constructor(t){super(),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new LineCurve(this.currentPoint.clone(),new Vector2(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,r){const a=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}bezierCurveTo(t,e,n,r,a,s){const l=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(n,r),new Vector2(a,s));return this.curves.push(l),this.currentPoint.set(a,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new SplineCurve(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,r,a,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(t+l,e+c,n,r,a,s),this}absarc(t,e,n,r,a,s){return this.absellipse(t,e,n,n,r,a,s),this}ellipse(t,e,n,r,a,s,l,c){const u=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(t+u,e+f,n,r,a,s,l,c),this}absellipse(t,e,n,r,a,s,l,c){const u=new EllipseCurve(t,e,n,r,a,s,l,c);if(this.curves.length>0){const p=u.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(u);const f=u.getPoint(1);return this.currentPoint.copy(f),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Shape extends Path{constructor(t){super(t),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const r=t.holes[e];this.holes.push(new Path().fromJSON(r))}return this}}class Light extends Object3D{constructor(t,e=1){super(),this.type="Light",this.color=new Color(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(e)}copy(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(t.matrixWorld),e.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(_lookTarget$1),e.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=RAD2DEG*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=t.distance||e.far;(n!==e.fov||r!==e.aspect||a!==e.far)&&(e.fov=n,e.aspect=r,e.far=a,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(t,e,n=0,r=Math.PI/3,a=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=n,this.angle=r,this.penumbra=a,this.decay=s,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,a=t.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(t.matrixWorld),n.position.copy(_lightPositionWorld),_lookTarget.copy(n.position),_lookTarget.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(_lookTarget),n.updateMatrixWorld(),r.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(t,e,n=0,r=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(t,e){super(t,e),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(t,e,n=10,r=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=r}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,a=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*a),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],1.092548*(n*r)),e.addScaledVector(s[5],1.092548*(r*a)),e.addScaledVector(s[6],.315392*(3*a*a-1)),e.addScaledVector(s[7],1.092548*(n*a)),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,a=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],2*.511664*r),e.addScaledVector(s[2],2*.511664*a),e.addScaledVector(s[3],2*.511664*n),e.addScaledVector(s[4],2*.429043*n*r),e.addScaledVector(s[5],2*.429043*r*a),e.addScaledVector(s[6],.743125*a*a-.247708),e.addScaledVector(s[7],2*.429043*n*a),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+r*3);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+r*3);return t}static getBasisAt(t,e){const n=t.x,r=t.y,a=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*a,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*a,e[6]=.315392*(3*a*a-1),e[7]=1.092548*n*a,e[8]=.546274*(n*n-r*r)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(t=new SphericalHarmonics3,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}LightProbe.prototype.isLightProbe=!0;class LoaderUtils{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.substr(0,e+1)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0;class InstancedBufferAttribute extends BufferAttribute{constructor(t,e,n,r=1){typeof n=="number"&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0;class ImageBitmapLoader extends Loader$1{constructor(t){super(t),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,s=Cache.get(t);if(s!==void 0)return a.manager.itemStart(t),setTimeout(function(){e&&e(s),a.manager.itemEnd(t)},0),s;const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader,fetch(t,l).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(c){Cache.add(t,c),e&&e(c),a.manager.itemEnd(t)}).catch(function(c){r&&r(c),a.manager.itemError(t),a.manager.itemEnd(t)}),a.manager.itemStart(t)}}ImageBitmapLoader.prototype.isImageBitmapLoader=!0;let _context;const AudioContext={getContext:function(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(o){_context=o}};class AudioLoader extends Loader$1{constructor(t){super(t)}load(t,e,n,r){const a=this,s=new FileLoader$1(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(l){try{const c=l.slice(0);AudioContext.getContext().decodeAudioData(c,function(f){e(f)})}catch(c){r?r(c):console.error(c),a.manager.itemError(t)}},n,r)}}class HemisphereLightProbe extends LightProbe{constructor(t,e,n=1){super(void 0,n);const r=new Color().set(t),a=new Color().set(e),s=new Vector3(r.r,r.g,r.b),l=new Vector3(a.r,a.g,a.b),c=Math.sqrt(Math.PI),u=c*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(l).multiplyScalar(c),this.sh.coefficients[1].copy(s).sub(l).multiplyScalar(u)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(t,e=1){super(void 0,e);const n=new Color().set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;const _eyeRight=new Matrix4,_eyeLeft=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const r=t.projectionMatrix.clone(),a=e.eyeSep/2,s=a*e.near/e.focus,l=e.near*Math.tan(DEG2RAD*e.fov*.5)/e.zoom;let c,u;_eyeLeft.elements[12]=-a,_eyeRight.elements[12]=a,c=-l*e.aspect+s,u=l*e.aspect+s,r.elements[0]=2*e.near/(u-c),r.elements[8]=(u+c)/(u-c),this.cameraL.projectionMatrix.copy(r),c=-l*e.aspect-s,u=l*e.aspect-s,r.elements[0]=2*e.near/(u-c),r.elements[8]=(u+c)/(u-c),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}class PropertyMixer{constructor(t,e,n){this.binding=t,this.valueSize=n;let r,a,s;switch(e){case"quaternion":r=this._slerp,a=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,a=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,r=this.valueSize,a=t*r+r;let s=this.cumulativeWeight;if(s===0){for(let l=0;l!==r;++l)n[a+l]=n[l];s=e}else{s+=e;const l=e/s;this._mixBufferRegion(n,a,0,l,r)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,r=t*e+e,a=this.cumulativeWeight,s=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const c=e*this._origIndex;this._mixBufferRegion(n,r,c,1-a,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let c=e,u=e+e;c!==u;++c)if(n[c]!==n[c+e]){l.setValue(n,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let a=n,s=r;a!==s;++a)e[a]=e[r+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,a){if(r>=.5)for(let s=0;s!==a;++s)t[e+s]=t[n+s]}_slerp(t,e,n,r){Quaternion.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,a){const s=this._workIndex*a;Quaternion.multiplyQuaternionsFlat(t,s,t,e,t,n),Quaternion.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,n,r,a){const s=1-r;for(let l=0;l!==a;++l){const c=e+l;t[c]=t[c]*s+t[n+l]*r}}_lerpAdditive(t,e,n,r,a){for(let s=0;s!==a;++s){const l=e+s;t[l]=t[l]+t[n+s]*r}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];class Composite{constructor(t,e,n){const r=n||PropertyBinding.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}class PropertyBinding{constructor(t,e,n){this.path=e,this.parsedPath=n||PropertyBinding.parseTrackName(e),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,e,n):new PropertyBinding(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(t){const e=_trackRe.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const a=n.nodeName.substring(r+1);_supportedObjectNames.indexOf(a)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=a)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(!e||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){const n=function(a){for(let s=0;s<a.length;s++){const l=a[s];if(l.name===e||l.uuid===e)return l;const c=n(l.children);if(c)return c}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.node[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let a=e.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let u=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let f=0;f<t.length;f++)if(t[f].name===u){u=f;break}break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(u!==void 0){if(t[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[u]}}const s=t[r];if(s===void 0){const u=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",t);return}let l=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(a!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[a]!==void 0&&(a=t.morphTargetDictionary[a])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else s.fromArray!==void 0&&s.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationAction{constructor(t,e,n=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;const a=e.tracks,s=a.length,l=new Array(s),c={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let u=0;u!==s;++u){const f=a[u].createInterpolant(null);l[u]=f,f.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const r=this._clip.duration,a=t._clip.duration,s=a/r,l=r/a;t.warp(1,s,e),this.warp(l,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const r=this._mixer,a=r.time,s=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=r._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,u=l.sampleValues;return c[0]=a,c[1]=a+n,u[0]=t/s,u[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled){this._updateWeight(t);return}const a=this._startTime;if(a!==null){const c=(t-a)*n;if(c<0||n===0)return;this._startTime=null,e=n*c}e*=this._updateTimeScale(t);const s=this._updateTime(e),l=this._updateWeight(t);if(l>0){const c=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let f=0,p=c.length;f!==p;++f)c[f].evaluate(s),u[f].accumulateAdditive(l);break;case NormalAnimationBlendMode:default:for(let f=0,p=c.length;f!==p;++f)c[f].evaluate(s),u[f].accumulate(r,l)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let r=this.time+t,a=this._loopCount;const s=n===LoopPingPong;if(t===0)return a===-1?r:s&&(a&1)===1?e-r:r;if(n===LoopOnce){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=e)r=e;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(a===-1&&(t>=0?(a=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=e||r<0){const l=Math.floor(r/e);r-=e*l,a+=Math.abs(l);const c=this.repetitions-a;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(c===1){const u=t<0;this._setEndings(u,!u,s)}else this._setEndings(!1,!1,s);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=r;if(s&&(a&1)===1)return e-r}return r}_setEndings(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=ZeroSlopeEnding,r.endingEnd=ZeroSlopeEnding):(t?r.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:r.endingStart=WrapAroundEnding,e?r.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:r.endingEnd=WrapAroundEnding)}_scheduleFading(t,e,n){const r=this._mixer,a=r.time;let s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const l=s.parameterPositions,c=s.sampleValues;return l[0]=a,c[0]=e,l[1]=a+t,c[1]=n,this}}class AnimationMixer extends EventDispatcher$1{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,a=r.length,s=t._propertyBindings,l=t._interpolants,c=n.uuid,u=this._bindingsByRootAndName;let f=u[c];f===void 0&&(f={},u[c]=f);for(let p=0;p!==a;++p){const g=r[p],y=g.name;let E=f[y];if(E!==void 0)s[p]=E;else{if(E=s[p],E!==void 0){E._cacheIndex===null&&(++E.referenceCount,this._addInactiveBinding(E,c,y));continue}const h=e&&e._propertyBindings[p].binding.parsedPath;E=new PropertyMixer(PropertyBinding.create(n,y,h),g.ValueTypeName,g.getValueSize()),++E.referenceCount,this._addInactiveBinding(E,c,y),s[p]=E}l[p].resultBuffer=E.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const n=(t._localRoot||this._root).uuid,r=t._clip.uuid,a=this._actionsByClip[r];this._bindAction(t,a&&a.knownActions[0]),this._addInactiveAction(t,r,n)}const e=t._propertyBindings;for(let n=0,r=e.length;n!==r;++n){const a=e[n];a.useCount++===0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let n=0,r=e.length;n!==r;++n){const a=e[n];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,n){const r=this._actions,a=this._actionsByClip;let s=a[e];if(s===void 0)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,a[e]=s;else{const l=s.knownActions;t._byClipCacheIndex=l.length,l.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const a=t._clip.uuid,s=this._actionsByClip,l=s[a],c=l.knownActions,u=c[c.length-1],f=t._byClipCacheIndex;u._byClipCacheIndex=f,c[f]=u,c.pop(),t._byClipCacheIndex=null;const p=l.actionByRoot,g=(t._localRoot||this._root).uuid;delete p[g],c.length===0&&delete s[a],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,r=e.length;n!==r;++n){const a=e[n];--a.referenceCount===0&&this._removeInactiveBinding(a)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,a=e[r];t._cacheIndex=r,e[r]=t,a._cacheIndex=n,e[n]=a}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,a=e[r];t._cacheIndex=r,e[r]=t,a._cacheIndex=n,e[n]=a}_addInactiveBinding(t,e,n){const r=this._bindingsByRootAndName,a=this._bindings;let s=r[e];s===void 0&&(s={},r[e]=s),s[n]=t,t._cacheIndex=a.length,a.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,a=n.path,s=this._bindingsByRootAndName,l=s[r],c=e[e.length-1],u=t._cacheIndex;c._cacheIndex=u,e[u]=c,e.pop(),delete l[a],Object.keys(l).length===0&&delete s[r]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,a=e[r];t._cacheIndex=r,e[r]=t,a._cacheIndex=n,e[n]=a}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,a=e[r];t._cacheIndex=r,e[r]=t,a._cacheIndex=n,e[n]=a}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return n===void 0&&(n=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,a=e[r];t.__cacheIndex=r,e[r]=t,a.__cacheIndex=n,e[n]=a}clipAction(t,e,n){const r=e||this._root,a=r.uuid;let s=typeof t=="string"?AnimationClip.findByName(r,t):t;const l=s!==null?s.uuid:t,c=this._actionsByClip[l];let u=null;if(n===void 0&&(s!==null?n=s.blendMode:n=NormalAnimationBlendMode),c!==void 0){const p=c.actionByRoot[a];if(p!==void 0&&p.blendMode===n)return p;u=c.knownActions[0],s===null&&(s=u._clip)}if(s===null)return null;const f=new AnimationAction(this,s,e,n);return this._bindAction(f,u),this._addInactiveAction(f,l,a),f}existingAction(t,e){const n=e||this._root,r=n.uuid,a=typeof t=="string"?AnimationClip.findByName(n,t):t,s=a?a.uuid:t,l=this._actionsByClip[s];return l!==void 0&&l.actionByRoot[r]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let n=e-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,r=this.time+=t,a=Math.sign(t),s=this._accuIndex^=1;for(let u=0;u!==n;++u)e[u]._update(r,t,a,s);const l=this._bindings,c=this._nActiveBindings;for(let u=0;u!==c;++u)l[u].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,a=r[n];if(a!==void 0){const s=a.knownActions;for(let l=0,c=s.length;l!==c;++l){const u=s[l];this._deactivateAction(u);const f=u._cacheIndex,p=e[e.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,p._cacheIndex=f,e[f]=p,e.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const s in n){const l=n[s].actionByRoot,c=l[e];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName,a=r[e];if(a!==void 0)for(const s in a){const l=a[s];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(t,e){const n=this.existingAction(t,e);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0;class Raycaster{constructor(t,e,n=0,r=1/0){this.ray=new Ray(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!1,n=[]){return intersectObject(t,this,n,e),n.sort(ascSort),n}intersectObjects(t,e=!1,n=[]){for(let r=0,a=t.length;r<a;r++)intersectObject(t[r],this,n,e);return n.sort(ascSort),n}}function ascSort(o,t){return o.distance-t.distance}function intersectObject(o,t,e,n){if(o.layers.test(t.layers)&&o.raycast(t,e),n===!0){const r=o.children;for(let a=0,s=r.length;a<s;a++)intersectObject(r[a],t,e,!0)}}class ImmediateRenderObject extends Object3D{constructor(t){super(),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const e=getBoneList(t),n=new BufferGeometry,r=[],a=[],s=new Color(0,0,1),l=new Color(0,1,0);for(let u=0;u<e.length;u++){const f=e[u];f.parent&&f.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),a.push(s.r,s.g,s.b),a.push(l.r,l.g,l.b))}n.setAttribute("position",new Float32BufferAttribute(r,3)),n.setAttribute("color",new Float32BufferAttribute(a,3));const c=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,c),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let a=0,s=0;a<e.length;a++){const l=e[a];l.parent&&l.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,l.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),r.setXYZ(s,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,l.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),r.setXYZ(s+1,_vector$2.x,_vector$2.y,_vector$2.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function getBoneList(o){const t=[];o&&o.isBone&&t.push(o);for(let e=0;e<o.children.length;e++)t.push.apply(t,getBoneList(o.children[e]));return t}class GridHelper extends LineSegments{constructor(t=10,e=10,n=4473924,r=8947848){n=new Color(n),r=new Color(r);const a=e/2,s=t/e,l=t/2,c=[],u=[];for(let g=0,y=0,E=-l;g<=e;g++,E+=s){c.push(-l,0,E,l,0,E),c.push(E,0,-l,E,0,l);const h=g===a?n:r;h.toArray(u,y),y+=3,h.toArray(u,y),y+=3,h.toArray(u,y),y+=3,h.toArray(u,y),y+=3}const f=new BufferGeometry;f.setAttribute("position",new Float32BufferAttribute(c,3)),f.setAttribute("color",new Float32BufferAttribute(u,3));const p=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(f,p),this.type="GridHelper"}}class AxesHelper extends LineSegments{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(e,3)),r.setAttribute("color",new Float32BufferAttribute(n,3));const a=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(r,a),this.type="AxesHelper"}setColors(t,e,n){const r=new Color,a=this.geometry.attributes.color.array;return r.set(t),r.toArray(a,0),r.toArray(a,3),r.set(e),r.toArray(a,6),r.toArray(a,9),r.set(n),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const _floatView=new Float32Array(1);new Int32Array(_floatView.buffer);Curve.create=function(o,t){return console.log("THREE.Curve.create() has been deprecated"),o.prototype=Object.create(Curve.prototype),o.prototype.constructor=o,o.prototype.getPoint=t,o};Path.prototype.fromPoints=function(o){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(o)};GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Loader$1.prototype.extractUrlBase=function(o){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(o)};Loader$1.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Box3.prototype.center=function(o){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(o)};Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Box3.prototype.isIntersectionBox=function(o){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};Box3.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};Box3.prototype.size=function(o){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(o)};Sphere.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Frustum.prototype.setFromMatrix=function(o){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(o)};Matrix3.prototype.flattenToArrayOffset=function(o,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,t)};Matrix3.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Matrix3.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),o.applyMatrix3(this)};Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Matrix3.prototype.getInverse=function(o){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};Matrix4.prototype.extractPosition=function(o){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(o)};Matrix4.prototype.flattenToArrayOffset=function(o,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(o,t)};Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Vector3().setFromMatrixColumn(this,3)};Matrix4.prototype.setRotationFromQuaternion=function(o){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(o)};Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Matrix4.prototype.multiplyVector3=function(o){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Matrix4.prototype.multiplyVector4=function(o){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Matrix4.prototype.rotateAxis=function(o){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),o.transformDirection(this)};Matrix4.prototype.crossVector=function(o){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Matrix4.prototype.applyToBufferAttribute=function(o){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),o.applyMatrix4(this)};Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Matrix4.prototype.makeFrustum=function(o,t,e,n,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(o,t,n,e,r,a)};Matrix4.prototype.getInverse=function(o){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(o).invert()};Plane.prototype.isIntersectionLine=function(o){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(o)};Quaternion.prototype.multiplyVector3=function(o){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),o.applyQuaternion(this)};Quaternion.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Ray.prototype.isIntersectionBox=function(o){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(o)};Ray.prototype.isIntersectionPlane=function(o){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(o)};Ray.prototype.isIntersectionSphere=function(o){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(o)};Triangle$1.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Triangle$1.prototype.barycoordFromPoint=function(o,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(o,t)};Triangle$1.prototype.midpoint=function(o){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(o)};Triangle$1.prototypenormal=function(o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(o)};Triangle$1.prototype.plane=function(o){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(o)};Triangle$1.barycoordFromPoint=function(o,t,e,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle$1.getBarycoord(o,t,e,n,r)};Triangle$1.normal=function(o,t,e,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle$1.getNormal(o,t,e,n)};Shape.prototype.extractAllPoints=function(o){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(o)};Shape.prototype.extrude=function(o){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,o)};Shape.prototype.makeGeometry=function(o){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,o)};Vector2.prototype.fromAttribute=function(o,t,e){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,t,e)};Vector2.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};Vector3.prototype.getPositionFromMatrix=function(o){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(o)};Vector3.prototype.getScaleFromMatrix=function(o){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(o)};Vector3.prototype.getColumnFromMatrix=function(o,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,o)};Vector3.prototype.applyProjection=function(o){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(o)};Vector3.prototype.fromAttribute=function(o,t,e){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,t,e)};Vector3.prototype.distanceToManhattan=function(o){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(o)};Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Vector4.prototype.fromAttribute=function(o,t,e){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(o,t,e)};Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Object3D.prototype.getChildByName=function(o){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(o)};Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Object3D.prototype.translate=function(o,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,o)};Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Object3D.prototype.applyMatrix=function(o){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(o){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=o}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};PerspectiveCamera.prototype.setLens=function(o,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(o)};Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(o){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=o}},shadowCameraLeft:{set:function(o){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=o}},shadowCameraRight:{set:function(o){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=o}},shadowCameraTop:{set:function(o){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=o}},shadowCameraBottom:{set:function(o){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=o}},shadowCameraNear:{set:function(o){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=o}},shadowCameraFar:{set:function(o){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=o}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(o){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=o}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(o){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=o}},shadowMapHeight:{set:function(o){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=o}}});Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}});BufferAttribute.prototype.setDynamic=function(o){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?DynamicDrawUsage:StaticDrawUsage),this};BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};BufferGeometry.prototype.addIndex=function(o){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(o)};BufferGeometry.prototype.addAttribute=function(o,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(o,new BufferAttribute(arguments[1],arguments[2]))):o==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(o,t)};BufferGeometry.prototype.addDrawCall=function(o,t,e){e!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(o,t)};BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};BufferGeometry.prototype.removeAttribute=function(o){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(o)};BufferGeometry.prototype.applyMatrix=function(o){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(o)};Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});InterleavedBuffer.prototype.setDynamic=function(o){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(o===!0?DynamicDrawUsage:StaticDrawUsage),this};InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(o){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=o===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(o){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=o}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(o){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=o}}});WebGLRenderer.prototype.clearTarget=function(o,t,e,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(o),this.clear(t,e,n)};WebGLRenderer.prototype.animate=function(o){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(o)};WebGLRenderer.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};WebGLRenderer.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};WebGLRenderer.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};WebGLRenderer.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};WebGLRenderer.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};WebGLRenderer.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};WebGLRenderer.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};WebGLRenderer.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};WebGLRenderer.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};WebGLRenderer.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};WebGLRenderer.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};WebGLRenderer.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};WebGLRenderer.prototype.enableScissorTest=function(o){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(o)};WebGLRenderer.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};WebGLRenderer.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};WebGLRenderer.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};WebGLRenderer.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};WebGLRenderer.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};WebGLRenderer.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};WebGLRenderer.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};WebGLRenderer.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};WebGLRenderer.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};WebGLRenderer.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=o}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(o){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=o}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(o){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=o===!0?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=o}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(o){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=o}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=o}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(o){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=o}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(o){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=o}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(o){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=o}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(o){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=o}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(o){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=o}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(o){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=o}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(o){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=o}}});Audio.prototype.load=function(o){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return new AudioLoader().load(o,function(n){t.setBuffer(n)}),this};CubeCamera.prototype.updateCubeMap=function(o,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(o,t)};CubeCamera.prototype.clear=function(o,t,e,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(o,t,e,n)};ImageUtils.crossOrigin=void 0;ImageUtils.loadTexture=function(o,t,e,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new TextureLoader;r.setCrossOrigin(this.crossOrigin);const a=r.load(o,e,void 0,n);return t&&(a.mapping=t),a};ImageUtils.loadTextureCube=function(o,t,e,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new CubeTextureLoader;r.setCrossOrigin(this.crossOrigin);const a=r.load(o,e,void 0,n);return t&&(a.mapping=t),a};ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);function _typeof(o){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(o)}function _classCallCheck(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(o,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function _createClass(o,t,e){return t&&_defineProperties(o.prototype,t),e&&_defineProperties(o,e),Object.defineProperty(o,"prototype",{writable:!1}),o}function _assertThisInitialized(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function _setPrototypeOf(o,t){return _setPrototypeOf=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},_setPrototypeOf(o,t)}function _inherits(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(o,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),writable:!1}),t&&_setPrototypeOf(o,t)}function _possibleConstructorReturn(o,t){if(t&&(_typeof(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(o)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(o)}function _arrayWithHoles(o){if(Array.isArray(o))return o}function _iterableToArrayLimit(o,t){var e=o==null?null:typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(e!=null){var n=[],r=!0,a=!1,s,l;try{for(e=e.call(o);!(r=(s=e.next()).done)&&(n.push(s.value),!(t&&n.length===t));r=!0);}catch(c){a=!0,l=c}finally{try{!r&&e.return!=null&&e.return()}finally{if(a)throw l}}return n}}function _arrayLikeToArray$1(o,t){(t==null||t>o.length)&&(t=o.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=o[e];return n}function _unsupportedIterableToArray$1(o,t){if(o){if(typeof o=="string")return _arrayLikeToArray$1(o,t);var e=Object.prototype.toString.call(o).slice(8,-1);if(e==="Object"&&o.constructor&&(e=o.constructor.name),e==="Map"||e==="Set")return Array.from(o);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _arrayLikeToArray$1(o,t)}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _slicedToArray(o,t){return _arrayWithHoles(o)||_iterableToArrayLimit(o,t)||_unsupportedIterableToArray$1(o,t)||_nonIterableRest()}var __assign=function(){return __assign=Object.assign||function(o){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(o[r]=t[r])}return o},__assign.apply(this,arguments)},defaults$1={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},Spinner=function(){function o(t){t===void 0&&(t={}),this.opts=__assign(__assign({},defaults$1),t)}return o.prototype.spin=function(t){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),css(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),t&&t.insertBefore(this.el,t.firstChild||null),drawLines(this.el,this.opts),this},o.prototype.stop=function(){return this.el&&(typeof requestAnimationFrame<"u"?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},o}();function css(o,t){for(var e in t)o.style[e]=t[e];return o}function getColor(o,t){return typeof o=="string"?o:o[t%o.length]}function drawLines(o,t){var e=Math.round(t.corners*t.width*500)/1e3+"px",n="none";t.shadow===!0?n="0 2px 4px #000":typeof t.shadow=="string"&&(n=t.shadow);for(var r=parseBoxShadow(n),a=0;a<t.lines;a++){var s=~~(360/t.lines*a+t.rotate),l=css(document.createElement("div"),{position:"absolute",top:-t.width/2+"px",width:t.length+t.width+"px",height:t.width+"px",background:getColor(t.fadeColor,a),borderRadius:e,transformOrigin:"left",transform:"rotate("+s+"deg) translateX("+t.radius+"px)"}),c=a*t.direction/t.lines/t.speed;c-=1/t.speed;var u=css(document.createElement("div"),{width:"100%",height:"100%",background:getColor(t.color,a),borderRadius:e,boxShadow:normalizeShadow(r,s),animation:1/t.speed+"s linear "+c+"s infinite "+t.animation});l.appendChild(u),o.appendChild(l)}}function parseBoxShadow(o){for(var t=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,e=[],n=0,r=o.split(",");n<r.length;n++){var a=r[n],s=a.match(t);if(s!==null){var l=+s[2],c=+s[5],u=s[4],f=s[7];l===0&&!u&&(u=f),c===0&&!f&&(f=u),u===f&&e.push({prefix:s[1]||"",x:l,y:c,xUnits:u,yUnits:f,end:s[8]})}}return e}function normalizeShadow(o,t){for(var e=[],n=0,r=o;n<r.length;n++){var a=r[n],s=convertOffset(a.x,a.y,t);e.push(a.prefix+s[0]+a.xUnits+" "+s[1]+a.yUnits+a.end)}return e.join(", ")}function convertOffset(o,t,e){var n=e*Math.PI/180,r=Math.sin(n),a=Math.cos(n);return[Math.round((o*a+t*r)*1e3)/1e3,Math.round((-o*r+t*a)*1e3)/1e3]}var Timer=function(){function o(){_classCallCheck(this,o),this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return _createClass(o,[{key:"start",value:function(){this.startTime=o.now(),this.oldTime=this.startTime,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1}},{key:"getElapsedTime",value:function(){return this.update(),this.elapsedTime}},{key:"update",value:function(){var e=0;if(this.running){var n=o.now();e=.001*(n-this.oldTime),this.oldTime=n,this.elapsedTime+=e}return e}}]),o}();Timer.now=function(){var o=typeof window<"u"&&window.performance;return o&&o.now?o.now.bind(o):Date.now}();var now=Timer.now;function createElement$2(o,t,e){var n=document.createElement(o);return n.id=t,n.style.cssText=e,n}var Stats=function(){function o(){_classCallCheck(this,o),this.domElement=createElement$2("div","stats","padding:8px"),this._text=createElement$2("p","fps","margin:0;color:silver;font-size:large"),this.domElement.appendChild(this._text),this._startTime=now(),this._prevTime=this._startTime,this._deltas=new Array(20),this._index=0,this._total=0,this._count=0}return _createClass(o,[{key:"end",value:function(){var e=now(),n=e-this._startTime;return this._count<this._deltas.length?this._count++:this._total-=this._deltas[this._index],this._total+=n,this._deltas[this._index]=n,this._index=(this._index+1)%this._deltas.length,this.ms=this._total/this._count,this.fps=1e3/this.ms,e>this._prevTime+1e3&&(this._text.textContent=this.fps.toPrecision(2),this._prevTime=e),e}},{key:"update",value:function(){this._startTime=this.end()}},{key:"show",value:function(e){e===void 0&&(e=!0),this.domElement.style.display=e?"block":"none"}}]),o}();function _isNativeFunction(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function _isNativeReflectConstruct$23(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _construct(o,t,e){return _isNativeReflectConstruct$23()?_construct=Reflect.construct:_construct=function(r,a,s){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(r,l),u=new c;return s&&_setPrototypeOf(u,s.prototype),u},_construct.apply(null,arguments)}function _wrapNativeSuper(o){var t=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(n){if(n===null||!_isNativeFunction(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,r)}function r(){return _construct(n,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,n)},_wrapNativeSuper(o)}function isUndefOrEqual(o,t){return!o||o===t}function EventDispatcher(){this._handlers={}}EventDispatcher.prototype.addEventListener=function(o,t,e){var n=this._handlers[o];n||(this._handlers[o]=[],n=this._handlers[o]);var r=[t,e];function a(s){return s[0]===r[0]&&s[1]===r[1]}lodashExports.find(n,a)===void 0&&n.push(r)};EventDispatcher.prototype.removeEventListener=function(o,t,e){var n=this;lodashExports.forEach(n._handlers,function(r,a){lodashExports.remove(r,function(s){return isUndefOrEqual(o,a)&&isUndefOrEqual(t,s[0])&&isUndefOrEqual(e,s[1]||n)})}),this._handlers=lodashExports.omitBy(n._handlers,function(r){return r.length===0})};EventDispatcher.prototype.dispatchEvent=function(o){var t=this;lodashExports.forEach(this._handlers[o.type],function(e){var n=e[1]||t;e[0].apply(n,[o])})};var priorities={debug:0,info:1,report:2,warn:3,error:4};function Logger(){EventDispatcher.call(this),this.console=!1,this._priority=priorities.warn}Logger.prototype=Object.create(EventDispatcher.prototype);Logger.prototype.constructor=Logger;Logger.prototype.instantiate=function(){return new Logger};function verify(o){if(!lodashExports.isNumber(o))throw new Error("Wrong log level specified!");return o}Object.defineProperty(Logger.prototype,"level",{get:function(){var t=this;return lodashExports.findKey(priorities,function(e){return e===t._priority})},set:function(t){this._priority=verify(priorities[t])}});Logger.prototype.levels=function(){return Object.keys(priorities)};Logger.prototype.message=function(o,t){var e=verify(priorities[o]);this._message(e,t)};Logger.prototype.debug=function(o){this._message(priorities.debug,o)};Logger.prototype.info=function(o){this._message(priorities.info,o)};Logger.prototype.report=function(o){this._message(priorities.report,o)};Logger.prototype.warn=function(o){this._message(priorities.warn,o)};Logger.prototype.error=function(o){this._message(priorities.error,o)};Logger.prototype._message=function(o,t){if(!(o<this._priority)){var e=lodashExports.findKey(priorities,function(r){return r===o});if(t=String(t),this.console){var n="miew:".concat(e,": ").concat(t);e==="error"?console.error(n):e==="warn"?console.warn(n):console.log(n)}this.dispatchEvent({type:"message",level:e,message:t})}};var logger=new Logger;function _createSuper$22(o){var t=_isNativeReflectConstruct$22();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$22(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var browserType={DEFAULT:0,SAFARI:1};function encodeQueryComponent(o,t){var e=function(r){return String.fromCharCode(parseInt(r.substr(1),16))};return encodeURIComponent(o).replace(t,e).replace(/%20/g,"+")}function decodeQueryComponent(o){return decodeURIComponent(o.replace(/\+/g," "))}function getUrlParameters(o){o=o||window.location.search;for(var t=o.substring(o.indexOf("?")+1),e=/([^&=]+)=?([^&]*)/g,n=[],r;(r=e.exec(t))!==null;)n.push([decodeQueryComponent(r[1]),decodeQueryComponent(r[2])]);return n}function getUrlParametersAsDict(o){for(var t={},e=getUrlParameters(o),n=0;n<e.length;++n){var r=_slicedToArray(e[n],2),a=r[0],s=r[1];t[a]=s}return t}function resolveURL(o){if(typeof URL<"u")try{return typeof window<"u"?new URL(o,window.location).href:new URL(o).href}catch{}if(typeof document<"u"){var t=document.createElement("a");return t.href=o,t.href}return o}function generateRegExp(o){for(var t=[],e=0,n=o.length;e<n;++e)t[t.length]=o[e].charCodeAt(0).toString(16);var r=t.join("|");return new RegExp("%(?:".concat(r,")"),"gi")}function createElement$1(o,t,e){var n=document.createElement(o),r,a;if(t){var s=Object.keys(t);for(r=0,a=s.length;r<a;++r){var l=s[r];n.setAttribute(l,t[l])}}if(e)for(e instanceof Array||(e=[e]),r=0,a=e.length;r<a;++r){var c=e[r];typeof c=="string"?n.appendChild(document.createTextNode(c)):c instanceof HTMLElement&&n.appendChild(c)}return n}function deriveClass(o,t,e,n){return o.prototype=lodashExports.assign(Object.create(t.prototype),{constructor:o},e),n&&lodashExports.assign(o,n),o}function deriveDeep(o,t){var e=o,n,r;if(o instanceof Array)for(e=new Array(o.length),n=0,r=o.length;n<r;++n)e[n]=deriveDeep(o[n]);else if(o instanceof Object){e=Object.create(o);var a=Object.keys(o);for(n=0,r=a.length;n<r;++n){var s=a[n],l=o[s],c=deriveDeep(l);c!==l&&(e[s]=c)}t&&Object.keys(e).length>0&&(e=Object.create(e))}return e}function hexColor(o){var t="0000000".concat(o.toString(16)).substr(-6);return"#".concat(t)}function DebugTracer(o){var t=!1;this.enable=function(u){t=u};var e=0,n=Object.keys(o);function r(u,f){return function(){var p=DebugTracer.spaces.substr(0,e*2);t&&logger.debug("".concat(p+f," {")),e++;for(var g=arguments.length,y=new Array(g),E=0;E<g;E++)y[E]=arguments[E];var h=u.apply(this,y);return e--,t&&logger.debug("".concat(p,"} // ").concat(f)),h}}for(var a=0,s=n.length;a<s;++a){var l=n[a],c=o[l];c instanceof Function&&l!=="constructor"&&(o[l]=r(c,l))}}DebugTracer.spaces="                                                                                          ";var OutOfMemoryError=function(o){_inherits(e,o);var t=_createSuper$22(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r.name="OutOfMemoryError",r.message=n,r}return _createClass(e)}(_wrapNativeSuper(Error));function allocateTyped(o,t){var e=null;try{e=new o(t)}catch(n){throw n instanceof RangeError?new OutOfMemoryError(n.message):n}return e}function bytesToBase64(o){for(var t=new Uint8Array(o),e="",n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return window.btoa(e)}function bytesFromBase64(o){for(var t=window.atob(o),e=new Uint8Array(t.length),n=0;n<e.length;++n)e[n]=t[n].charCodeAt(0);return e.buffer}function arrayToBase64(o,t){return bytesToBase64(new t(o).buffer)}function arrayFromBase64(o,t){return Array.prototype.slice.call(new t(bytesFromBase64(o)))}function compareOptionsWithDefaults(o,t){var e=[];if(t&&o){for(var n=Object.keys(o),r=0;r<n.length;++r){var a=n[r],s=o[a];!(s instanceof Object)&&typeof t[a]<"u"&&t[a]!==s&&e.push("".concat(a,":").concat(s))}if(e.length>0)return"!".concat(e.join())}return""}function isAlmostPlainObject(o){if(lodashExports.isPlainObject(o))return!0;var t=o&&Object.getPrototypeOf(o);return!!t&&!t.hasOwnProperty("constructor")&&isAlmostPlainObject(t)}function objectsDiff(o,t){var e={};return lodashExports.forIn(o,function(n,r){var a=t[r];if(isAlmostPlainObject(n)&&isAlmostPlainObject(a)){var s=objectsDiff(n,a);lodashExports.isEmpty(s)||(e[r]=s)}else lodashExports.isEqual(n,a)||(e[r]=n)}),e}function forInRecursive(o,t){function e(n,r){lodashExports.forIn(n,function(a,s){var l=r+(r.length>0?".":"");a instanceof Object?e(a,l+s):a!==void 0&&t(a,l+s)})}e(o,"")}function enquoteString(o){return lodashExports.isString(o)?'"'.concat(o.replace(/"/g,'\\"'),'"'):o}function unquoteString(o){if(!lodashExports.isString(o))return o;if(o[0]==='"'&&o[o.length-1]==='"')return o=o.slice(1,o.length-1),o.replace(/\\"/g,'"');if(o[0]==="'"&&o[o.length-1]==="'")return o=o.slice(1,o.length-1),o.replace(/\\'/g,"'");throw new SyntaxError("Incorrect string format, can't unqute it")}function getFileExtension(o){return o.slice(Math.max(0,o.lastIndexOf("."))||1/0)}function splitFileName(o){var t=getFileExtension(o),e=o.slice(0,o.length-t.length);return[e,t]}function dataUrlToBlob(o){var t=o.split(/[:;,]/),e=t.length;return e>=3&&t[e-2]==="base64"?new Blob([bytesFromBase64(t[e-1])]):null}function getBrowser(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")===-1&&navigator.userAgent.indexOf("FxiOS")===-1?browserType.SAFARI:browserType.DEFAULT}function shotOpen(o){typeof window<"u"&&window.open().document.write('<body style="margin:0"><img src="'.concat(o,'" /></body>'))}function shotDownload(o,t){if(!(!o||o.substr(0,5)!=="data:")){if(t||(t=["screenshot-",+new Date,".png"].join("")),typeof window<"u"&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(dataUrlToBlob(o),t);else if(typeof document<"u"){var e=document.createElement("a");e.download=t,e.innerHTML="download",e.href=window.URL.createObjectURL(dataUrlToBlob(o)),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}}function download(o,t,e){var n=new Blob([o]);if(t||(t=["data",+new Date].join("")),e?t+=".".concat(e):t+=n.type||".bin",typeof window<"u"&&window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,t);else if(typeof document<"u"){var r=document.createElement("a");r.download=t,r.innerHTML="download",r.href=window.URL.createObjectURL(n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}}function copySubArrays$2(o,t,e,n){for(var r=0,a=e.length;r<a;++r)for(var s=0;s<n;++s)t[r*n+s]=o[e[r]*n+s]}function shallowCloneNode(o){var t=o.cloneNode(!0);return t.worldPos=o.worldPos,t}var unquotedStringRE=/^[a-zA-Z0-9_]*$/,enquoteHelper=['"',"",'"'];function correctSelectorIdentifier(o){return unquotedStringRE.test(o)?o:(enquoteHelper[1]=o,enquoteHelper.join(""))}function concatTypedArraysUnsafe(o,t){var e=new o.constructor(o.length+t.length);return e.set(o),e.set(t,o.length),e}function mergeTypedArraysUnsafe(o){if(o.length<=0)return null;for(var t=o.reduce(function(s,l){return s+l.length},0),e=new o[0].constructor(t),n=0,r=0;n<o.length;n++){var a=o[n].length;e.set(o[n],r),r+=a}return e}var utils={browserType,encodeQueryComponent,decodeQueryComponent,getUrlParameters,getUrlParametersAsDict,resolveURL,generateRegExp,createElement:createElement$1,deriveClass,deriveDeep,hexColor,DebugTracer,OutOfMemoryError,allocateTyped,bytesFromBase64,bytesToBase64,arrayFromBase64,arrayToBase64,compareOptionsWithDefaults,objectsDiff,forInRecursive,enquoteString,unquoteString,getBrowser,shotOpen,shotDownload,copySubArrays:copySubArrays$2,shallowCloneNode,correctSelectorIdentifier,getFileExtension,splitFileName,download,concatTypedArraysUnsafe,mergeTypedArraysUnsafe};function _createSuper$21(o){var t=_isNativeReflectConstruct$21();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$21(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var JobHandle=function(o){_inherits(e,o);var t=_createSuper$21(e);function e(){var n;return _classCallCheck(this,e),n=t.call(this),n._shouldCancel=!1,n}return _createClass(e,[{key:"cancel",value:function(){this._shouldCancel=!0,this.dispatchEvent({type:"cancel"})}},{key:"shouldCancel",value:function(){return this._shouldCancel}},{key:"notify",value:function(r){this.dispatchEvent({type:"notification",slaveEvent:r})}}]),e}(EventDispatcher),VERSION=0,defaults={modes:{BS:{atom:.23,bond:.15,space:.5,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},VW:{polyComplexity:{poor:4,low:6,medium:8,high:16,ultra:32}},LN:{multibond:!0,showarom:!0,offsarom:.2,chunkarom:10,atom:.23,lineWidth:2},LC:{bond:.2,space:0,multibond:!0,aromrad:.1,showarom:!0,polyComplexity:{poor:3,low:4,medium:6,high:12,ultra:32}},SA:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},SE:{zClip:!1,probeRadius:1.5,subset:"",wireframe:!1,polyComplexity:{poor:6,low:8,medium:16,high:30,ultra:60}},QS:{isoValue:.5,gaussLim:{poor:1.5,low:2,medium:2.5,high:3,ultra:4},scale:1,wireframe:!1,gridSpacing:{poor:2,low:1.5,medium:1,high:.5,ultra:.25},subset:"",zClip:!1},CS:{probeRadius:1.4,isoValue:1.5,wireframe:!1,probePositions:30,polyComplexity:{poor:.5,low:1,medium:1.5,high:1.75,ultra:2},subset:"",zClip:!1},TR:{radius:.3,polyComplexity:{poor:12,low:16,medium:32,high:64,ultra:64}},TU:{radius:.3,heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},CA:{radius:.3,depth:.25,ss:{helix:{width:1,arrow:2},strand:{width:1,arrow:2}},heightSegmentsRatio:1.5,tension:-.7,polyComplexity:{poor:4,low:6,medium:10,high:18,ultra:34}},TX:{template:"{{Chain}}.{{Residue}}{{Sequence}}.{{Name}}",horizontalAlign:"center",verticalAlign:"middle",dx:0,dy:0,dz:1,fg:"none",bg:"0x202020",showBg:!0},VD:{kSigma:1,kSigmaMed:2,kSigmaMax:4,frame:!0,isoMode:!1,polyComplexity:{poor:2,low:3,medium:4,high:8,ultra:10}}},colorers:{EL:{carbon:-1},UN:{color:16777215},CO:{subset:"charged",color:16711680,baseColor:16777215},CB:{color:9474192,factor:.6},SQ:{gradient:"rainbow"},TM:{gradient:"temp",min:5,max:40},OC:{gradient:"reds"},HY:{gradient:"blue-red"},MO:{gradient:"rainbow"}},antialias:!0,camFov:45,camNear:.5,camFar:100,camDistance:2.5,radiusToFit:1,fogNearFactor:.5,fogFarFactor:1,fogAlpha:1,fogColor:0,fogColorEnable:!1,palette:"JM",resolution:"medium",autoResolution:!1,autoPreset:!0,preset:"default",presets:{default:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],empty:[],wire:[{mode:"LN",colorer:"EL",selector:"all",material:"SF"}],small:[{mode:"BS",colorer:"EL",selector:"all",material:"SF"}],macro:[{mode:"CA",colorer:"SS",selector:"not hetatm",material:"SF"},{mode:"BS",colorer:"EL",selector:"hetatm and not water",material:"SF"}]},objects:{line:{color:4294967295,dashSize:.3,gapSize:.05}},bg:{color:2105376,transparent:!1},draft:{clipPlane:!1,clipPlaneFactor:.5,clipPlaneSpeed:3e-5},plugins:{},axes:!0,fog:!0,fps:!0,zSprites:!0,isoSurfaceFakeOpacity:!0,suspendRender:!0,nowater:!1,autobuild:!0,fxaa:!0,outline:{on:!1,color:0,threshold:.1,thickness:1},ao:!1,shadow:{on:!1,type:"random",radius:1},autoRotation:0,maxfps:30,fbxprec:4,autoRotationAxisFixed:!0,zooming:!0,picking:!0,pick:"atom",editing:!1,aromatic:!1,singleUnit:!0,stereo:"NONE",interpolateViews:!0,transparency:"prepass",translationSpeed:2,debug:{example:3.5,text:"hello!",good:!0,ssaoKernelRadius:.7,ssaoFactor:.7,stereoBarrel:.25},use:{multiFile:!1}};function Settings(){EventDispatcher.call(this),this.old=null,this.now={},this._changed={},this.reset()}utils.deriveClass(Settings,EventDispatcher,{defaults,set:function(t,e){if(lodashExports.isString(t)){var n=lodashExports.get(this.now,t);n!==e&&(lodashExports.set(this.now,t,e),this._notifyChange(t,e))}else{var r=utils.objectsDiff(t,this.now);lodashExports.isEmpty(r)||(lodashExports.merge(this.now,r),this._notifyChanges(r))}},get:function(t,e){return lodashExports.get(this.now,t,e)},reset:function(){var t=utils.objectsDiff(defaults,this.now);this.now=lodashExports.cloneDeep(defaults),this.old=null,this._notifyChanges(t),this._changed={}},checkpoint:function(){this.old=lodashExports.cloneDeep(this.now),this._changed={}},_notifyChange:function(t,e){this._changed[t]=!0,this.dispatchEvent({type:"change:".concat(t),value:e})},_notifyChanges:function(t){var e=this;utils.forInRecursive(t,function(n,r){e._notifyChange(r,n)})},changed:function(){if(!this.old)return[];var t=this.old,e=this.now,n=lodashExports.filter(Object.keys(this._changed),function(r){return lodashExports.get(t,r)!==lodashExports.get(e,r)});return n},applyDiffs:function(t){if(t.hasOwnProperty("VERSION")&&t.VERSION!==VERSION)throw new Error("Settings version does not match!");delete t.VERSION,this.reset(),this.set(t)},getDiffs:function(t){var e=utils.objectsDiff(this.now,defaults);return t&&(e.VERSION=VERSION),e},setPluginOpts:function(t,e){defaults.plugins[t]=lodashExports.cloneDeep(e),this.now.plugins[t]=lodashExports.cloneDeep(e)}});var settings$1=new Settings,repIndex=0;function asBoolean(o){return!(!o||o==="0"||lodashExports.isString(o)&&o.toLowerCase()==="false")}var adapters={string:String,number:Number,boolean:asBoolean},cL1Ass="=",cOptsSep="!",cL2Ass=":",cLSep=",",cCommonIgnoreSymbols="$;@/?";function getLevel1ExcludedExpr(){var o=":,";return utils.generateRegExp(cCommonIgnoreSymbols+o)}function getLevel2ExcludedExpr(){var o=" ";return utils.generateRegExp(cCommonIgnoreSymbols+o)}var cL1ExclExpr=getLevel1ExcludedExpr();function encodeQueryComponentL1(o){return utils.encodeQueryComponent(o,cL1ExclExpr)}var cL2ExclExpr=getLevel2ExcludedExpr();function encodeQueryComponentL2(o){return utils.encodeQueryComponent(o,cL2ExclExpr)}function ensureRepList(o){var t=o.reps;if(!t){var e=settings$1.now.presets,n=o.preset||settings$1.now.preset;if(t=e[n],!t){logger.warn('Unknown preset "'.concat(n,'"'));var r=Object.keys(e),a=_slicedToArray(r,1);n=a[0],t=e[n]}o.preset=n,o.reps=utils.deriveDeep(t,!0)}}function ensureRepAssign(o,t,e){ensureRepList(o);var n=o.reps[repIndex];n.hasOwnProperty(t)&&(repIndex=o.reps.length,o.reps[repIndex]=utils.deriveDeep(n,!0)),e!==void 0&&(o.reps[repIndex][t]=e)}function addObject(o,t,e){o._objects===void 0&&(o._objects=[]);var n=_slicedToArray(e,2),r=n[0],a=n[1],s={type:r,params:t};a!==void 0&&(s.opts=a),o._objects[o._objects.length]=s}function parseParams(o,t){var e=o.indexOf(",");return e>=0?(t.push(o.substr(e+1).split(",")),o.substr(0,e)):o}function extractArgs(o,t,e){if(o){var n=o.indexOf(cOptsSep),r=parseParams(o.substr(0,n>=0?n:void 0),e);if(n>=0){var a=o.substr(n+1).split(cLSep);if(o=r,t){var s=t[o],l=utils.deriveDeep(s,!0);a.forEach(function(c){var u=c.split(cL2Ass,2),f=decodeURIComponent(u[0]),p=decodeURIComponent(u[1]),g=adapters[_typeof(lodashExports.get(s,f))];g?lodashExports.set(l,f,g(p)):logger.warn('Unknown argument "'.concat(f,'" for option "').concat(o,'"'))}),Object.keys(l).length>0&&(o=[o,l])}}else o=r}return o}var actions={l:"load",load:String,t:"type",type:String,v:"view",view:String,u:"unit",unit:Number,menu:asBoolean,o:"object",object:function(t,e){var n=[],r=extractArgs(t,settings$1.defaults.objects,n);Array.isArray(r)||(r=[r]),addObject(e,n[0],r)},p:"preset",preset:function(t,e){e.preset=t,e.reps=null,ensureRepList(e)},r:"rep",rep:function(t,e){ensureRepList(e),repIndex=Number(t),repIndex=repIndex<=e.reps.length?repIndex<0?0:repIndex:e.reps.length,repIndex===e.reps.length&&(e.reps[repIndex]=repIndex>0?utils.deriveDeep(e.reps[repIndex-1],!0):utils.deriveDeep(settings$1.defaults.presets.default[0],!0))},s:"select",select:function(t,e){ensureRepAssign(e,"selector",t)},m:"mode",mode:function(t,e){ensureRepAssign(e,"mode",extractArgs(t,settings$1.defaults.modes))},c:"color",color:function(t,e){ensureRepAssign(e,"colorer",extractArgs(t,settings$1.defaults.colorers))},mt:"material",material:function(t,e){ensureRepAssign(e,"material",extractArgs(t,settings$1.defaults.materials))},dup:function(t,e){ensureRepList(e);var n=e.reps,r=n[repIndex];repIndex=n.length,n[repIndex]=utils.deriveDeep(r,!0)},ar:"autoResolution"};function _fromArray(o){repIndex=0;for(var t={},e=0,n=o.length;e<n;++e){var r=o[e],a=r[0],s=r[1];if(actions.hasOwnProperty(a)){for(var l=actions[a];lodashExports.isString(l);)a=l,l=actions[a];if(typeof l=="function"){var c=l(s,t);c!==void 0&&(t[a]=c)}}else{var u=adapters[_typeof(lodashExports.get(settings$1.defaults,a))];u?lodashExports.set(t,"settings.".concat(a),u(s)):logger.warn('Unknown option "'.concat(a,'"'))}}return t}function fromAttr(o){return _fromArray(utils.getUrlParameters("?".concat(o||"")))}function fromURL(o){return _fromArray(utils.getUrlParameters(o))}function _processOptsForURL(o){var t=[],e=0;return utils.forInRecursive(o,function(n,r){t[e++]=encodeQueryComponentL2(r)+cL2Ass+encodeQueryComponentL2(n)}),t.join(cLSep)}function _processArgsForURL(o){return lodashExports.isArray(o)?o.length<2?o[0]:"".concat(o[0]).concat(cOptsSep).concat(_processOptsForURL(o[1])):o}function _processObjForURL(o){if(!(!o||!o.type)){var t=o.type;return lodashExports.isArray(o.params)&&o.params.length>0&&(t+=",".concat(o.params.join(","))),o.opts&&(t+=cOptsSep+_processOptsForURL(o.opts)),t}}function toURL(o){var t=[],e=0;function n(u,f){f!=null&&(t[e++]=encodeQueryComponentL1(u)+cL1Ass+encodeQueryComponentL1(f))}function r(u){if(u)for(var f=0,p=u.length;f<p;++f)lodashExports.isEmpty(u[f])||(n("r",f),n("s",u[f].selector),n("m",_processArgsForURL(u[f].mode)),n("c",_processArgsForURL(u[f].colorer)),n("mt",_processArgsForURL(u[f].material)))}function a(u){if(u)for(var f=0,p=u.length;f<p;++f)n("o",_processObjForURL(u[f]))}n("l",o.load),n("u",o.unit),n("p",o.preset),r(o.reps),a(o._objects),n("v",o.view),utils.forInRecursive(o.settings,function(u,f){f!=="preset"&&n(f,u)});var s="";if(typeof window<"u"){var l=window,c=l.location;s="".concat(c.protocol,"//").concat(c.host).concat(c.pathname)}return t.length>0&&(s+="?".concat(t.join("&"))),s}function _processOptsForScript(o){var t=[],e=0;return utils.forInRecursive(o,function(n,r){t[e++]="".concat(r,"=").concat(utils.enquoteString(n))}),t.join(" ")}function _processArgsForScript(o){return lodashExports.isArray(o)?o.length<2?o[0]:"".concat(o[0]," ").concat(_processOptsForScript(o[1])):o}function _processObjForScript(o){if(!(!o||!o.type)){var t=o.type;return lodashExports.isArray(o.params)&&o.params.length>0&&(t+=" ".concat(o.params.map(utils.enquoteString).join(" "))),o.opts&&(t+=" ".concat(_processOptsForScript(o.opts))),t}}function _processRepsForScript(o,t){var e=[],n=0;function r(a,s){s!=null&&(e[n++]=a+s)}return lodashExports.isEmpty(o)?null:(r("",t),r("s=",utils.enquoteString(o.selector)),r("m=",_processArgsForScript(o.mode)),r("c=",_processArgsForScript(o.colorer)),r("mt=",_processArgsForScript(o.material)),e.join(" "))}function toScript(o){var t=[],e=0;function n(s,l,c){if(l!=null){var u=typeof l=="string"&&c?'"':"";t[e++]="".concat(s," ").concat(u).concat(l).concat(u).trim()}}function r(s){if(s)for(var l=0,c=s.length;l<c;++l)n("rep",_processRepsForScript(s[l],l))}function a(s){if(s)for(var l=0,c=s.length;l<c;++l)n("",_processObjForScript(s[l]))}return n("set","autobuild false"),n("load",o.load,!0),n("unit",o.unit),n("preset",o.preset),r(o.reps),a(o._objects),utils.forInRecursive(o.settings,function(s,l){l!=="preset"&&n("set ".concat(l),s,!0)}),n("view",o.view),n("set","autobuild true"),t.join(`
`)}var options$1={fromURL,fromAttr,adapters,toURL,toScript};function _defineProperty(o,t,e){return t in o?Object.defineProperty(o,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[t]=e,o}var Atom$2=function(){function o(t,e,n,r,a,s,l,c,u,f,p){_classCallCheck(this,o),this.index=-1,this.residue=t,this.name=e,this.element=n,this.position=r,this.role=a,this.mask=1,this.het=s,this.serial=l,this.location=(c||" ").charCodeAt(0),this.occupancy=u||1,this.temperature=f,this.charge=p,this.hydrogenCount=-1,this.radicalCount=0,this.valence=-1,this.bonds=[],this.flags=0,n.name==="H"?this.flags|=o.Flags.HYDROGEN:n.name==="C"&&(this.flags|=o.Flags.CARBON)}return _createClass(o,[{key:"isHet",value:function(){return this.het}},{key:"isHydrogen",value:function(){return this.element.number===1}},{key:"getVisualName",value:function(){var e=this.name;return e.length>0?e:this.element.name.trim()}},{key:"forEachBond",value:function(e){for(var n=this.bonds,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"getFullName",value:function(){var e="";return this.residue!==null&&(this.residue._chain!==null&&(e+="".concat(this.residue._chain.getName(),".")),e+="".concat(this.residue._sequence,".")),e+=this.name,e}}]),o}();_defineProperty(Atom$2,"Flags",{CARBON:1,HYDROGEN:8,NONPOLARH:4104});var Element$a=_createClass(function o(t,e,n,r,a,s,l){_classCallCheck(this,o),this.number=t,this.name=e,this.fullName=n,this.weight=r,this.radius=a,this.radiusBonding=s,this.hydrogenValency=l});_defineProperty(Element$a,"Constants",{U1:1,Lead:2,U2:3,Wing:4,U18:18});_defineProperty(Element$a,"Role",{N:Element$a.Constants.U1,CA:Element$a.Constants.Lead,C:Element$a.Constants.U2,O:Element$a.Constants.Wing,SG:Element$a.Constants.U18});_defineProperty(Element$a,"ByAtomicNumber",[null,new Element$a(1,"H","Hydrogen",1.008,1.2,.23,[1]),new Element$a(2,"HE","Helium",4.003,1.4,.93,[0]),new Element$a(3,"LI","Lithium",6.941,1.82,.68,[1]),new Element$a(4,"BE","Beryllium",9.012,1.7,.35,[2]),new Element$a(5,"B","Boron",10.81,2.08,.83,[3]),new Element$a(6,"C","Carbon",12.011,1.95,.68,[4]),new Element$a(7,"N","Nitrogen",14.007,1.85,.68,[3,5]),new Element$a(8,"O","Oxygen",15.999,1.7,.68,[2,4]),new Element$a(9,"F","Fluorine",18.998,1.73,.64,[1]),new Element$a(10,"NE","Neon",20.18,1.54,1.12,[0]),new Element$a(11,"NA","Sodium",22.99,2.27,.97,[1]),new Element$a(12,"MG","Magnesium",24.305,1.73,1.1,[2]),new Element$a(13,"AL","Aluminum",26.981,2.05,1.35,[3]),new Element$a(14,"SI","Silicon",28.086,2.1,1.2,[4]),new Element$a(15,"P","Phosphorus",30.974,2.08,.75,[3,5]),new Element$a(16,"S","Sulfur",32.07,2,1.02,[2,4,6]),new Element$a(17,"CL","Chlorine",35.453,1.97,.99,[1,3,5,7]),new Element$a(18,"AR","Argon",39.948,1.88,1.57,[0]),new Element$a(19,"K","Potassium",39.1,2.75,1.33,[1]),new Element$a(20,"CA","Calcium",40.08,1.973,.99,[2]),new Element$a(21,"SC","Scandium",44.956,1.7,1.44,[0]),new Element$a(22,"TI","Titanium",47.88,1.7,1.47,[0]),new Element$a(23,"V","Vanadium",50.941,1.7,1.33,[0]),new Element$a(24,"CR","Chromium",52,1.7,1.35,[0]),new Element$a(25,"MN","Manganese",54.938,1.7,1.35,[0]),new Element$a(26,"FE","Iron",55.847,1.7,1.34,[0]),new Element$a(27,"CO","Cobalt",58.93,1.7,1.33,[0]),new Element$a(28,"NI","Nickel",58.69,1.63,1.5,[0]),new Element$a(29,"CU","Copper",63.55,1.4,1.52,[0]),new Element$a(30,"ZN","Zinc",65.39,1.39,1.45,[0]),new Element$a(31,"GA","Gallium",69.72,1.87,1.22,[3]),new Element$a(32,"GE","Germanium",72.61,1.7,1.17,[4]),new Element$a(33,"AS","Arsenic",74.92,1.85,1.21,[3,5]),new Element$a(34,"SE","Selenium",78.96,1.9,1.22,[2,4,6]),new Element$a(35,"BR","Bromine",79.9,2.1,1.21,[1,3,5,7]),new Element$a(36,"KR","Krypton",83.8,2.02,1.91,[0]),new Element$a(37,"RB","Rubidium",85.47,1.7,1.47,[1]),new Element$a(38,"SR","Strontium",87.62,1.7,1.12,[2]),new Element$a(39,"Y","Yttrium",88.91,1.7,1.78,[0]),new Element$a(40,"ZR","Zirconium",91.22,1.7,1.56,[0]),new Element$a(41,"NB","Niobium",92.91,1.7,1.48,[0]),new Element$a(42,"MO","Molybdenum",95.94,1.7,1.47,[0]),new Element$a(43,"TC","Technetium",98.91,1.7,1.35,[0]),new Element$a(44,"RU","Ruthenium",101.07,1.7,1.4,[0]),new Element$a(45,"RH","Rhodium",102.91,1.7,1.45,[0]),new Element$a(46,"PD","Palladium",106.42,1.63,1.5,[0]),new Element$a(47,"AG","Silver",107.87,1.72,1.59,[0]),new Element$a(48,"CD","Cadmium",112.41,1.58,1.69,[0]),new Element$a(49,"IN","Indium",114.82,1.93,1.63,[3]),new Element$a(50,"SN","Tin",118.71,2.17,1.46,[2,4]),new Element$a(51,"SB","Antimony",121.75,2.2,1.46,[3,5]),new Element$a(52,"TE","Tellurium",127.6,2.06,1.47,[2,4,6]),new Element$a(53,"I","Iodine",126.91,2.15,1.4,[1,3,5,7]),new Element$a(54,"XE","Xenon",131.29,2.16,1.98,[0]),new Element$a(55,"CS","Cesium",132.91,1.7,1.67,[1]),new Element$a(56,"BA","Barium",137.33,1.7,1.34,[2]),new Element$a(57,"LA","Lanthanum",138.91,1.7,1.87,[0]),new Element$a(58,"CE","Cerium",140.12,1.7,1.83,[0]),new Element$a(59,"PR","Praseodymium",140.91,1.7,1.82,[0]),new Element$a(60,"ND","Neodymium",144.24,1.7,1.81,[0]),new Element$a(61,"PM","Promethium",144.9,1.7,1.8,[0]),new Element$a(62,"SM","Samarium",150.36,1.7,1.8,[0]),new Element$a(63,"EU","Europium",151.96,1.7,1.99,[0]),new Element$a(64,"GD","Gadolinium",157.25,1.7,1.79,[0]),new Element$a(65,"TB","Terbium",158.93,1.7,1.76,[0]),new Element$a(66,"DY","Dysprosium",162.5,1.7,1.75,[0]),new Element$a(67,"HO","Holmium",164.93,1.7,1.74,[0]),new Element$a(68,"ER","Erbium",167.26,1.7,1.73,[0]),new Element$a(69,"TM","Thulium",168.93,1.7,1.72,[0]),new Element$a(70,"YB","Ytterbium",173.04,1.7,1.94,[0]),new Element$a(71,"LU","Lutetium",174.97,1.7,1.72,[0]),new Element$a(72,"HF","Hafnium",178.49,1.7,1.57,[0]),new Element$a(73,"TA","Tantalum",180.95,1.7,1.43,[0]),new Element$a(74,"W","Tungsten",183.85,1.7,1.37,[0]),new Element$a(75,"RE","Rhenium",186.21,1.7,1.35,[0]),new Element$a(76,"OS","Osmium",190.2,1.7,1.37,[0]),new Element$a(77,"IR","Iridium",192.22,1.7,1.32,[0]),new Element$a(78,"PT","Platinum",195.08,1.72,1.5,[0]),new Element$a(79,"AU","Gold",196.97,1.66,1.5,[0]),new Element$a(80,"HG","Mercury",200.59,1.55,1.7,[0]),new Element$a(81,"TL","Thallium",204.38,1.96,1.55,[1,3]),new Element$a(82,"PB","Lead",207.2,2.02,1.54,[2,4]),new Element$a(83,"BI","Bismuth",208.98,1.7,1.54,[3,5]),new Element$a(84,"PO","Polonium",210,1.7,1.68,[2,4,6]),new Element$a(85,"AT","Astatine",210,1.7,1.7,[1,3,5,7]),new Element$a(86,"RN","Radon",222,1.7,2.4,[0]),new Element$a(87,"FR","Francium",223,1.7,2,[1]),new Element$a(88,"RA","Radium",226.03,1.7,1.9,[2]),new Element$a(89,"AC","Actinium",227.03,1.7,1.88,[0]),new Element$a(90,"TH","Thorium",232.04,1.7,1.79,[0]),new Element$a(91,"PA","Protactinium",231.04,1.7,1.61,[0]),new Element$a(92,"U","Uranium",238.03,1.86,1.58,[0]),new Element$a(93,"NP","Neptunium",237.05,1.7,1.55,[0]),new Element$a(94,"PU","Plutonium",239.1,1.7,1.53,[0]),new Element$a(95,"AM","Americium",243.1,1.7,1.51,[0]),new Element$a(96,"CM","Curium",247.1,1.7,1.5,[0]),new Element$a(97,"BK","Berkelium",247.1,1.7,1.5,[0]),new Element$a(98,"CF","Californium",252.1,1.7,1.5,[0]),new Element$a(99,"ES","Einsteinium",252.1,1.7,1.5,[0]),new Element$a(100,"FM","Fermium",257.1,1.7,1.5,[0]),new Element$a(101,"MD","Mendelevium",256.1,1.7,1.5,[0]),new Element$a(102,"NO","Nobelium",259.1,1.7,1.5,[0]),new Element$a(103,"LR","Lawrencium",260.1,1.7,1.5,[0]),new Element$a(104,"RF","Rutherfordium",261,1.7,1.6,[0]),new Element$a(105,"DB","Dubnium",262,1.7,1.6,[0]),new Element$a(106,"SG","Seaborgium",263,1.7,1.6,[0]),new Element$a(107,"BH","Bohrium",262,1.7,1.6,[0]),new Element$a(108,"HS","Hassium",265,1.7,1.6,[0]),new Element$a(109,"MT","Meitnerium",268,1.7,1.6,[0])]);_defineProperty(Element$a,"ByName",{D:new Element$a(1,"D","Deuterium",2.014,1.2,.23,[1]),T:new Element$a(1,"T","Tritium",3.016,1.2,.23,[1])});(function(){for(var o=Element$a.ByAtomicNumber,t=Element$a.ByName,e=0,n=o.length;e<n;++e){var r=o[e];r&&(t[r.name]=r)}})();Element$a.getByName=function(o){var t=Element$a.ByName[o];return t||(t=Element$a.ByName[o]=new Element$a(0,o,"Unknown",0,1,.01,[0])),t};var cBondTypes={UNKNOWN:0,COVALENT:1,AROMATIC:2};function getAtomPos(o){return o.position}var Bond$5=function(){function o(t,e,n,r,a){if(_classCallCheck(this,o),this._left=t,this._right=e,this._fixed=a,this._index=-1,t>e)throw new Error("In a bond atom indices must be in increasing order");this._order=n,this._type=r}return _createClass(o,[{key:"getLeft",value:function(){return this._left}},{key:"getRight",value:function(){return this._right}},{key:"getOrder",value:function(){return this._order}},{key:"calcLength",value:function(){return this._left.position.distanceTo(this._right.position)}},{key:"_forEachNeighbour",value:function(e,n){for(var r=e.bonds,a=0,s=r.length;a<s;++a)n(r[a]._left!==e?r[a]._left:r[a]._right)}},{key:"forEachLevelOne",value:function(e){var n=this._left,r=this._right;this._forEachNeighbour(n,function(a){a!==r&&e(a)}),this._forEachNeighbour(r,function(a){a!==n&&e(a)})}},{key:"forEachLevelTwo",value:function(e){var n=this._left,r=this._right,a=this;a._forEachNeighbour(n,function(s){s!==r&&a._forEachNeighbour(s,function(l){l!==n&&e(l)})}),a._forEachNeighbour(r,function(s){s!==n&&a._forEachNeighbour(s,function(l){l!==r&&e(l)})})}},{key:"_fixDir",value:function(e,n,r){var a=0,s=0,l=e.clone();function c(g){l.copy(r(g)),l.sub(e);var y=n.dot(l);y>0?++a:++s}function u(g){g.element.name==="C"&&c(g)}for(var f=[[this.forEachLevelOne,u],[this.forEachLevelOne,c],[this.forEachLevelTwo,u],[this.forEachLevelTwo,c]],p=0;p<f.length;++p){if(f[p][0].call(this,f[p][1]),s>a)return n.multiplyScalar(-1);if(s<a)return n}return n}},{key:"calcNormalDir",value:function(e){var n=this._left,r=this._right,a=n,s=r;e=e===void 0?getAtomPos:e,n.bonds.length>r.bonds.length&&(a=r,s=n);for(var l=a,c=0,u=s,f=u.bonds,p=0,g=f.length;p<g;++p){var y=f[p]._left;f[p]._left===s&&(y=f[p]._right),y.bonds.length>c&&y!==a&&(l=y,c=y.bonds.length)}var E=e(s),h=e(a).clone().sub(E),v=e(l).clone().sub(E);return v.crossVectors(h,v),v.lengthSq()<1e-4&&v.set(0,1,0),h.normalize(),v.normalize(),h.crossVectors(v,h),h.lengthSq()<1e-4&&h.set(0,1,0),h.normalize(),this._fixDir(E,h,e)}}]),o}();_defineProperty(Bond$5,"BondType",cBondTypes);Bond$5.prototype.BondType=cBondTypes;var cNucleicControlNames=["C3'","C3*","P","H5T","H3T"],cNucleicWing1Names=["OP1","O1P"],cNucleicWing2Names=["OP2","O2P"],cCylinderSource=["C3'","C3*","C1","C1'","C1*","P"],cCylinderTarget=[{types:["A","DA","G","DG"],atoms:["N1"]},{types:["C","DC"],atoms:["N3"]},{types:["T","DT","U","DU"],atoms:["O4"]}],Residue$1=function(){function o(t,e,n,r){_classCallCheck(this,o),this._chain=t,this._component=null,this._type=e,this._sequence=n,this._icode=r,this._mask=1,this._index=-1,this._atoms=[],this._secondary=null,this._firstAtom=null,this._leadAtom=null,this._wingAtom=null,this._lastAtom=null,this._controlPoint=null,this._midPoint=null,this._wingVector=null,this._cylinders=null,this._isValid=!0,this._het=!1,this._molecule=null,this.temperature=null,this.occupancy=null}return _createClass(o,[{key:"getChain",value:function(){return this._chain}},{key:"getMolecule",value:function(){return this._molecule}},{key:"getType",value:function(){return this._type}},{key:"getSequence",value:function(){return this._sequence}},{key:"getSecondary",value:function(){return this._secondary}},{key:"getICode",value:function(){return this._icode}},{key:"addAtom",value:function(e,n,r,a,s,l,c,u,f,p){var g=new Atom$2(this,e,n,r,a,s,l,c,u,f,p),y=this._chain.getComplex();return y.addAtom(g),this._atoms.push(g),this._het=this._het||s,g}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"forEachAtom",value:function(e){for(var n=this._atoms,r=0,a=n.length;r<a&&!e(n[r]);++r);}},{key:"_findAtomByName",value:function(e){var n=null;return this.forEachAtom(function(r){return r.name===e?(n=r,!0):!1}),n}},{key:"_findFirstAtomInList",value:function(e){for(var n=null,r=0;r<e.length;++r)if(n=this._findAtomByName(e[r]),n!==null)return n;return n}},{key:"collectMask",value:function(){for(var e=4294967295,n=this._atoms,r=0,a=n.length;r<a;++r)e&=n[r].mask;this._mask=e}},{key:"getCylinderTargetList",value:function(){for(var e=this._type._name,n=0,r=cCylinderTarget.length;n<r;++n)for(var a=0,s=cCylinderTarget[n].types.length;a<s;++a)if(e===cCylinderTarget[n].types[a])return cCylinderTarget[n].atoms;return null}},{key:"_detectLeadWing",value:function(e,n,r){var a=this._findFirstAtomInList(cNucleicControlNames),s=this._findFirstAtomInList(cNucleicWing1Names),l=this._findFirstAtomInList(cNucleicWing2Names);if(s===null&&n!==null&&(s=n._findFirstAtomInList(cNucleicWing1Names)),l===null&&n!==null&&(l=n._findFirstAtomInList(cNucleicWing2Names)),!(a===null||s===null||l===null)){e._leadAtom=a,e._controlPoint=r(a),e._wingVector=r(l).clone().sub(r(s)),e._isValid=!0;var c=this._findFirstAtomInList(cCylinderSource),u=this.getCylinderTargetList(),f=u!==null?this._findFirstAtomInList(u):null;c===null||f===null||(e._cylinders=[r(c),r(f)])}}},{key:"calcWing",value:function(e,n,r,a){var s=n.clone().sub(e),l=e.clone().sub(r);if(l.crossVectors(s,l),l.crossVectors(s,l).normalize(),a!==null&&a.length()>1e-4){var c=l.length()>1e-4&&Math.abs(a.angleTo(l))>Math.PI/2;c&&l.negate()}return l}},{key:"_innerFinalize",value:function(e,n,r,a,s,l){var c=n===null,u=l(this._leadAtom),f=new Vector3(u.x,u.y,u.z);if(s){this._detectLeadWing(a,r,l);return}if(c)a._midPoint=l(this._firstAtom).clone();else{var p=n._controlPoint;a._midPoint=p.clone().lerp(f,.5),a._wingVector=this.calcWing(p,f,l(e._wingAtom),n._wingVector)}a._controlPoint=f}},{key:"_finalize2",value:function(e,n,r){this._innerFinalize(e,e,n,this,r,function(a){return a.position})}},{key:"isConnected",value:function(e){if(this._chain!==e._chain)return!1;if(this===e)return!0;var n=!1;return this.forEachAtom(function(r){for(var a=r.bonds,s=0,l=a.length;s<l;++s){var c=a[s];if(c._left.residue===e||c._right.residue===e)return n=!0,!0}return!1}),n}},{key:"_finalize",value:function(){var e=this,n=_slicedToArray(this._atoms,1);this._firstAtom=n[0],this._lastAtom=this._atoms[this._atoms.length-1],this._leadAtom=null,this._wingAtom=null;var r=0,a=0,s=0,l=0;this.forEachAtom(function(c){return e._leadAtom===null&&c.role===Element$a.Constants.Lead&&(e._leadAtom=c),e._wingAtom===null&&c.role===Element$a.Constants.Wing&&(e._wingAtom=c),c.temperature&&(a+=c.temperature,r++),c.occupancy&&(l+=c.occupancy,s++),e._leadAtom!==null&&e._wingAtom!==null}),r>0&&(this.temperature=a/r),s>0&&(this.occupancy=l/s),(this._leadAtom===null||this._wingAtom===null)&&(this._isValid=!1),this._leadAtom===null&&(this._leadAtom=this._firstAtom),this._wingAtom===null&&(this._wingAtom=this._lastAtom)}}]),o}(),ResidueType$1=function(){function o(t,e,n){_classCallCheck(this,o),this._name=t,this._fullName=e,this.letterCode=n,this.flags=0}return _createClass(o,[{key:"getName",value:function(){return this._name}}]),o}();_defineProperty(ResidueType$1,"StandardTypes",{ALA:new ResidueType$1("ALA","Alanine","A"),ARG:new ResidueType$1("ARG","Arginine","R"),ASN:new ResidueType$1("ASN","Asparagine","N"),ASP:new ResidueType$1("ASP","Aspartic Acid","D"),CYS:new ResidueType$1("CYS","Cysteine","C"),GLN:new ResidueType$1("GLN","Glutamine","Q"),GLU:new ResidueType$1("GLU","Glutamic Acid","E"),GLY:new ResidueType$1("GLY","Glycine","G"),HIS:new ResidueType$1("HIS","Histidine","H"),ILE:new ResidueType$1("ILE","Isoleucine","I"),LEU:new ResidueType$1("LEU","Leucine","L"),LYS:new ResidueType$1("LYS","Lysine","K"),MET:new ResidueType$1("MET","Methionine","M"),PHE:new ResidueType$1("PHE","Phenylalanine","F"),PRO:new ResidueType$1("PRO","Proline","P"),PYL:new ResidueType$1("PYL","Pyrrolysine","O"),SEC:new ResidueType$1("SEC","Selenocysteine","U"),SER:new ResidueType$1("SER","Serine","S"),THR:new ResidueType$1("THR","Threonine","T"),TRP:new ResidueType$1("TRP","Tryptophan","W"),TYR:new ResidueType$1("TYR","Tyrosine","Y"),VAL:new ResidueType$1("VAL","Valine","V"),A:new ResidueType$1("A","Adenine","A"),C:new ResidueType$1("C","Cytosine","C"),G:new ResidueType$1("G","Guanine","G"),I:new ResidueType$1("I","Inosine","I"),T:new ResidueType$1("T","Thymine","T"),U:new ResidueType$1("U","Uracil","U"),DA:new ResidueType$1("DA","Adenine","A"),DC:new ResidueType$1("DC","Cytosine","C"),DG:new ResidueType$1("DG","Guanine","G"),DI:new ResidueType$1("DI","Inosine","I"),DT:new ResidueType$1("DT","Thymine","T"),DU:new ResidueType$1("DU","Uracil","U"),"+A":new ResidueType$1("+A","Adenine","A"),"+C":new ResidueType$1("+C","Cytosine","C"),"+G":new ResidueType$1("+G","Guanine","G"),"+I":new ResidueType$1("+I","Inosine","I"),"+T":new ResidueType$1("+T","Thymine","T"),"+U":new ResidueType$1("+U","Uracil","U"),WAT:new ResidueType$1("WAT","Water",""),H2O:new ResidueType$1("H2O","Water",""),HOH:new ResidueType$1("HOH","Water",""),DOD:new ResidueType$1("DOD","Water",""),UNK:new ResidueType$1("UNK","Unknown",""),UNL:new ResidueType$1("UNL","Unknown Ligand","")});_defineProperty(ResidueType$1,"Flags",{PROTEIN:1,BASIC:2,ACIDIC:4,POLAR:8,NONPOLAR:16,AROMATIC:32,NUCLEIC:256,PURINE:512,PYRIMIDINE:1024,DNA:2048,RNA:4096,WATER:65536});function _addFlag(o,t){for(var e=0,n=t.length;e<n;++e){var r=ResidueType$1.StandardTypes[t[e]];r&&(r.flags|=o)}}var Flags=ResidueType$1.Flags;_addFlag(Flags.WATER,["WAT","H2O","HOH","DOD"]);_addFlag(Flags.PROTEIN,["ALA","ARG","ASN","ASP","CYS","GLY","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","PRO","PYL","SEC","SER","THR","TRP","TYR","VAL"]);_addFlag(Flags.BASIC,["ARG","HIS","LYS"]);_addFlag(Flags.ACIDIC,["ASP","GLU"]);_addFlag(Flags.POLAR,["ASN","CYS","GLN","SER","THR","TYR"]);_addFlag(Flags.NONPOLAR,["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL","GLY"]);_addFlag(Flags.AROMATIC,["PHE","TRP","TYR"]);_addFlag(Flags.NUCLEIC,["A","G","I","DA","DG","DI","+A","+G","+I","C","T","U","DC","DT","DU","+C","+T","+U"]);_addFlag(Flags.PURINE,["A","G","I","DA","DG","DI","+A","+G","+I"]);_addFlag(Flags.PYRIMIDINE,["C","T","U","DC","DT","DU","+C","+T","+U"]);_addFlag(Flags.DNA,["DA","DG","DI","DC","DT","DU"]);_addFlag(Flags.RNA,["A","G","I","C","T","U"]);var hydro={ILE:4.5,VAL:4.2,LEU:3.8,PHE:2.8,CYS:2.5,MET:1.9,ALA:1.8,GLY:-.4,THR:-.7,SER:-.8,TRP:-.9,TYR:-1.3,PRO:-1.6,HIS:-3.2,GLU:-3.5,GLN:-3.5,ASP:-3.5,ASN:-3.5,LYS:-3.9,ARG:-4.5};function _addParam(o,t){for(var e=Object.keys(t),n=0,r=e.length;n<r;++n){var a=e[n],s=t[a];ResidueType$1.StandardTypes[a][o]=s}}_addParam("hydrophobicity",hydro);var ChainType={UNKNOWN:0,PROTEIN:1,NUCLEIC:2},Chain$2=function(){function o(t,e){_classCallCheck(this,o),this._complex=t,this._name=e,this._mask=1,this._index=-1,this._residues=[],this.minSequence=Number.POSITIVE_INFINITY,this.maxSequence=Number.NEGATIVE_INFINITY}return _createClass(o,[{key:"getComplex",value:function(){return this._complex}},{key:"getName",value:function(){return this._name}},{key:"getResidues",value:function(){return this._residues}},{key:"_determineType",value:function(){var e=this._residues,n=ResidueType$1.Flags,r=n.PROTEIN,a=n.NUCLEIC;this.type=ChainType.UNKNOWN;for(var s=0,l=e.length;s<l;++s){var c=e[s]._type.flags;if(c&a){this.type=ChainType.NUCLEIC;break}else if(c&r){this.type=ChainType.PROTEIN;break}}}},{key:"findResidue",value:function(e,n){for(var r=this._residues,a=0,s=r.length;a<s;++a){var l=r[a];if(l._sequence===e&&l._icode===n)return[l,a]}return null}},{key:"_finalize",value:function(){this._determineType();for(var e=this._residues,n=null,r=0,a=e.length;r<a;++r){var s=r+1<a?e[r+1]:null,l=e[r];l._finalize2(n,s,this.type===ChainType.NUCLEIC),n=l}if(e.length>1&&e[1]._wingVector){var c=e[1]._wingVector;e[0]._wingVector=new Vector3(c.x,c.y,c.z)}else e.length>0&&(e[0]._wingVector=new Vector3(1,0,0))}},{key:"updateToFrame",value:function(e){var n=this._residues,r=null,a=null,s=e._residues,l=n.length;function c(y){return e.getAtomPos(y.index)}for(var u=0;u<l;++u){var f=n[u],p=s[f._index],g=u+1<l?n[u+1]:null;f._innerFinalize(r,a,g,p,this.type===ChainType.NUCLEIC,c),r=f,a=p}s[n[0]._index]._wingVector=l>1?s[n[1]._index]._wingVector:new Vector3(1,0,0)}},{key:"addResidue",value:function(e,n,r){var a=this._complex.getResidueType(e);a===null&&(a=this._complex.addResidueType(e));var s=new Residue$1(this,a,n,r);return this._complex.addResidue(s),this._residues.push(s),a.flags&(ResidueType$1.Flags.NUCLEIC|ResidueType$1.Flags.PROTEIN)&&(this.maxSequence<n&&(this.maxSequence=n),this.minSequence>n&&(this.minSequence=n)),s}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"forEachResidue",value:function(e){for(var n=this._residues,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"collectMask",value:function(){for(var e=4294967295,n=this._residues,r=0,a=n.length;r<a;++r)e&=n[r]._mask;this._mask=e}}]),o}(),_StructuralElement$ge,StructuralElement=function(){function o(t,e,n){_classCallCheck(this,o),this.type=t,this.generic=o.genericByType[this.type]||"loop",this.init=e,this.term=n}return _createClass(o,[{key:"_finalize",value:function(e,n,r){if(!(this.init instanceof Residue$1&&this.term instanceof Residue$1)){for(var a=r.splitUnifiedSerial(this.init),s=r.splitUnifiedSerial(this.term),l=a.chain;l<=s.chain;l++)for(var c=a.serial;c<=s.serial;c++)for(var u=a.iCode;u<=s.iCode;u++){var f=r.getUnifiedSerial(l,c,u);n[f]&&(n[f]._secondary=this)}this.init=n[this.init],this.term=n[this.term]}}}]),o}();StructuralElement.Type={STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",HELIX:"X",TURN_310:"3",TURN_ALPHA:"4",TURN_PI:"5",TURN:"T",BEND:"S",COIL:"C"};StructuralElement.Generic={STRAND:"strand",HELIX:"helix",LOOP:"loop"};var StructuralElementType$5=StructuralElement.Type,StructuralElementGeneric=StructuralElement.Generic;StructuralElement.genericByType=(_StructuralElement$ge={},_defineProperty(_StructuralElement$ge,StructuralElementType$5.STRAND,StructuralElementGeneric.STRAND),_defineProperty(_StructuralElement$ge,StructuralElementType$5.HELIX_310,StructuralElementGeneric.HELIX),_defineProperty(_StructuralElement$ge,StructuralElementType$5.HELIX_ALPHA,StructuralElementGeneric.HELIX),_defineProperty(_StructuralElement$ge,StructuralElementType$5.HELIX_PI,StructuralElementGeneric.HELIX),_defineProperty(_StructuralElement$ge,StructuralElementType$5.HELIX,StructuralElementGeneric.HELIX),_StructuralElement$ge);function _createSuper$20(o){var t=_isNativeReflectConstruct$20();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$20(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var StructuralElementType$4=StructuralElement.Type,typeByPDBHelixClass={1:StructuralElementType$4.HELIX_ALPHA,3:StructuralElementType$4.HELIX_PI,5:StructuralElementType$4.HELIX_310},Helix$3=function(o){_inherits(e,o);var t=_createSuper$20(e);function e(n,r,a,s,l,c,u){var f;return _classCallCheck(this,e),f=t.call(this,typeByPDBHelixClass[n]||StructuralElement.Type.HELIX,r,a),f.serial=s,f.name=l,f.comment=c,f.length=u,f}return _createClass(e)}(StructuralElement);function _superPropBase(o,t){for(;!Object.prototype.hasOwnProperty.call(o,t)&&(o=_getPrototypeOf(o),o!==null););return o}function _get(){return typeof Reflect<"u"&&Reflect.get?_get=Reflect.get:_get=function(t,e,n){var r=_superPropBase(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?t:n):a.value}},_get.apply(this,arguments)}function _createSuper$1$(o){var t=_isNativeReflectConstruct$1$();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Strand$3=function(o){_inherits(e,o);var t=_createSuper$1$(e);function e(n,r,a,s,l,c){var u;return _classCallCheck(this,e),u=t.call(this,StructuralElement.Type.STRAND,r,a),u.sheet=n,u.sense=s,u.atomCur=l,u.atomPrev=c,u}return _createClass(e,[{key:"_finalize",value:function(r,a,s){_get(_getPrototypeOf(e.prototype),"_finalize",this).call(this,r,a,s);var l=this.atomCur;l!==null&&!Number.isNaN(l)&&(this.atomCur=r[l]),l=this.atomPrev,l!==null&&!Number.isNaN(l)&&(this.atomPrev=r[l])}}]),e}(StructuralElement),Sheet$3=function(){function o(t,e){_classCallCheck(this,o),this._name=t,this._width=e,this._strands=[]}return _createClass(o,[{key:"getName",value:function(){return this._name}},{key:"getWidth",value:function(){return this._width}},{key:"addStrand",value:function(e){this._strands.push(e),this._width=this._strands.length}},{key:"addEmptyStrand",value:function(){this._strands.push(new Strand$3(null,null,null,null,null,null))}},{key:"_finalize",value:function(e,n,r){for(var a=this._strands,s=0,l=a.length;s<l;++s)a[s]._finalize(e,n,r);if(this._width||(this._width=a.length),a.length!==this._width)throw new Error("Sheet ".concat(this._name," is inconsistent."))}}]),o}(),SGroup$1=function(){function o(t,e,n,r,a){_classCallCheck(this,o),this._id=t,this._name=e,this._position=n||new Vector3,this._atoms=r||[],this._charge=0,this._repeat=1,this._center=null,this.xmlNodeRef=a||null}return _createClass(o,[{key:"getName",value:function(){return this._name}},{key:"getPosition",value:function(){return this._position}},{key:"getCentralPoint",value:function(){return this._center}},{key:"_rebuildSGroupOnAtomChange",value:function(){var e=1e8;if(this._center!==null){for(var n=new Vector3(e,e,e),r=new Vector3(-e,-e,-e),a=0,s=this._atoms.length;a<s;a++){var l=this._atoms[a].position;n.set(Math.min(n.x,l.x),Math.min(n.y,l.y),Math.min(n.z,l.z)),r.set(Math.max(r.x,l.x),Math.max(r.y,l.y),Math.max(r.z,l.z))}this._center.addVectors(n,r),this._center.multiplyScalar(.5)}}}]),o}(),commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},parser$1=function(){var o=function(w,_,S,M){for(S=S||{},M=w.length;M--;S[w[M]]=_);return S},t=[1,4],e=[1,5],n=[1,6],r=[1,7],a=[1,8],s=[1,9],l=[1,11],c=[1,12],u=[5,7,8,11],f=[1,17],p=[1,22],g=[1,20],y=[1,21],E=[5,7,8,11,19],h={trace:function(){},yy:{},symbols_:{error:2,Program:3,Expression:4,EOF:5,Selector:6,OR:7,AND:8,NOT:9,"(":10,")":11,SELECTOR:12,NAMED_SELECTOR:13,SELECTOR_RANGED:14,RangeList:15,SELECTOR_NAMED:16,NameList:17,Range:18,",":19,NUMBER:20,":":21,Name:22,IDENTIFIER:23,STRING:24,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"OR",8:"AND",9:"NOT",10:"(",11:")",12:"SELECTOR",13:"NAMED_SELECTOR",14:"SELECTOR_RANGED",16:"SELECTOR_NAMED",19:",",20:"NUMBER",21:":",23:"IDENTIFIER",24:"STRING"},productions_:[0,[3,2],[4,1],[4,3],[4,3],[4,2],[4,3],[6,1],[6,1],[6,2],[6,2],[15,1],[15,3],[18,1],[18,3],[17,1],[17,3],[22,1],[22,1],[22,1]],performAction:function(w,_,S,M,T,R,P){var I=R.length-1;switch(T){case 1:return R[I-1];case 3:this.$=M.keyword("or")(R[I-2],R[I]);break;case 4:this.$=M.keyword("and")(R[I-2],R[I]);break;case 5:this.$=M.keyword("not")(R[I]);break;case 6:this.$=R[I-1];break;case 7:this.$=M.keyword(R[I])();break;case 8:this.$=M.GetSelector(R[I].toLowerCase().slice(1,R[I].length));break;case 9:case 10:this.$=M.keyword(R[I-1])(R[I]);break;case 11:this.$=new M.RangeList(R[I]);break;case 12:case 16:this.$=R[I-2].append(R[I]);break;case 13:this.$=new M.Range(Number(R[I]));break;case 14:this.$=new M.Range(Number(R[I-2]),Number(R[I]));break;case 15:this.$=new M.ValueList(R[I]);break}},table:[{3:1,4:2,6:3,9:t,10:e,12:n,13:r,14:a,16:s},{1:[3]},{5:[1,10],7:l,8:c},o(u,[2,2]),{4:13,6:3,9:t,10:e,12:n,13:r,14:a,16:s},{4:14,6:3,9:t,10:e,12:n,13:r,14:a,16:s},o(u,[2,7]),o(u,[2,8]),{15:15,18:16,20:f},{17:18,20:p,22:19,23:g,24:y},{1:[2,1]},{4:23,6:3,9:t,10:e,12:n,13:r,14:a,16:s},{4:24,6:3,9:t,10:e,12:n,13:r,14:a,16:s},o(u,[2,5]),{7:l,8:c,11:[1,25]},o(u,[2,9],{19:[1,26]}),o(E,[2,11]),o(E,[2,13],{21:[1,27]}),o(u,[2,10],{19:[1,28]}),o(E,[2,15]),o(E,[2,17]),o(E,[2,18]),o(E,[2,19]),o([5,7,11],[2,3],{8:c}),o(u,[2,4]),o(u,[2,6]),{18:29,20:f},{20:[1,30]},{20:p,22:31,23:g,24:y},o(E,[2,12]),o(E,[2,14]),o(E,[2,16])],defaultActions:{10:[2,1]},parseError:function(w,_){if(_.recoverable)this.trace(w);else{var S=new Error(w);throw S.hash=_,S}},parse:function(w){var _=this,S=[0],M=[],T=[null],R=[],P=this.table,I="",B=0,W=0,D=2,O=1,z=R.slice.call(arguments,1),G=Object.create(this.lexer),k={yy:{}};for(var $ in this.yy)Object.prototype.hasOwnProperty.call(this.yy,$)&&(k.yy[$]=this.yy[$]);G.setInput(w,k.yy),k.yy.lexer=G,k.yy.parser=this,typeof G.yylloc>"u"&&(G.yylloc={});var Z=G.yylloc;R.push(Z);var K=G.options&&G.options.ranges;typeof k.yy.parseError=="function"?this.parseError=k.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function j(){var ye;return ye=M.pop()||G.lex()||O,typeof ye!="number"&&(ye instanceof Array&&(M=ye,ye=M.pop()),ye=_.symbols_[ye]||ye),ye}for(var Q,le,he,ve,re={},Ie,ge,Se,Le;;){if(le=S[S.length-1],this.defaultActions[le]?he=this.defaultActions[le]:((Q===null||typeof Q>"u")&&(Q=j()),he=P[le]&&P[le][Q]),typeof he>"u"||!he.length||!he[0]){var be="";Le=[];for(Ie in P[le])this.terminals_[Ie]&&Ie>D&&Le.push("'"+this.terminals_[Ie]+"'");G.showPosition?be="Parse error on line "+(B+1)+`:
`+G.showPosition()+`
Expecting `+Le.join(", ")+", got '"+(this.terminals_[Q]||Q)+"'":be="Parse error on line "+(B+1)+": Unexpected "+(Q==O?"end of input":"'"+(this.terminals_[Q]||Q)+"'"),this.parseError(be,{text:G.match,token:this.terminals_[Q]||Q,line:G.yylineno,loc:Z,expected:Le})}if(he[0]instanceof Array&&he.length>1)throw new Error("Parse Error: multiple actions possible at state: "+le+", token: "+Q);switch(he[0]){case 1:S.push(Q),T.push(G.yytext),R.push(G.yylloc),S.push(he[1]),Q=null,W=G.yyleng,I=G.yytext,B=G.yylineno,Z=G.yylloc;break;case 2:if(ge=this.productions_[he[1]][1],re.$=T[T.length-ge],re._$={first_line:R[R.length-(ge||1)].first_line,last_line:R[R.length-1].last_line,first_column:R[R.length-(ge||1)].first_column,last_column:R[R.length-1].last_column},K&&(re._$.range=[R[R.length-(ge||1)].range[0],R[R.length-1].range[1]]),ve=this.performAction.apply(re,[I,W,B,k.yy,he[1],T,R].concat(z)),typeof ve<"u")return ve;ge&&(S=S.slice(0,-1*ge*2),T=T.slice(0,-1*ge),R=R.slice(0,-1*ge)),S.push(this.productions_[he[1]][0]),T.push(re.$),R.push(re._$),Se=P[S[S.length-2]][S[S.length-1]],S.push(Se);break;case 3:return!0}}return!0}},v=function(){var x={EOF:1,parseError:function(_,S){if(this.yy.parser)this.yy.parser.parseError(_,S);else throw new Error(_)},setInput:function(_,S){return this.yy=S||this.yy||{},this._input=_,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var _=this._input[0];this.yytext+=_,this.yyleng++,this.offset++,this.match+=_,this.matched+=_;var S=_.match(/(?:\r\n?|\n).*/g);return S?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),_},unput:function(_){var S=_.length,M=_.split(/(?:\r\n?|\n)/g);this._input=_+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-S),this.offset-=S;var T=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),M.length-1&&(this.yylineno-=M.length-1);var R=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:M?(M.length===T.length?this.yylloc.first_column:0)+T[T.length-M.length].length-M[0].length:this.yylloc.first_column-S},this.options.ranges&&(this.yylloc.range=[R[0],R[0]+this.yyleng-S]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(_){this.unput(this.match.slice(_))},pastInput:function(){var _=this.matched.substr(0,this.matched.length-this.match.length);return(_.length>20?"...":"")+_.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var _=this.match;return _.length<20&&(_+=this._input.substr(0,20-_.length)),(_.substr(0,20)+(_.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var _=this.pastInput(),S=new Array(_.length+1).join("-");return _+this.upcomingInput()+`
`+S+"^"},test_match:function(_,S){var M,T,R;if(this.options.backtrack_lexer&&(R={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(R.yylloc.range=this.yylloc.range.slice(0))),T=_[0].match(/(?:\r\n?|\n).*/g),T&&(this.yylineno+=T.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:T?T[T.length-1].length-T[T.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+_[0].length},this.yytext+=_[0],this.match+=_[0],this.matches=_,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(_[0].length),this.matched+=_[0],M=this.performAction.call(this,this.yy,this,S,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),M)return M;if(this._backtrack){for(var P in R)this[P]=R[P];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var _,S,M,T;this._more||(this.yytext="",this.match="");for(var R=this._currentRules(),P=0;P<R.length;P++)if(M=this._input.match(this.rules[R[P]]),M&&(!S||M[0].length>S[0].length)){if(S=M,T=P,this.options.backtrack_lexer){if(_=this.test_match(M,R[P]),_!==!1)return _;if(this._backtrack){S=!1;continue}else return!1}else if(!this.options.flex)break}return S?(_=this.test_match(S,R[T]),_!==!1?_:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var _=this.next();return _||this.lex()},begin:function(_){this.conditionStack.push(_)},popState:function(){var _=this.conditionStack.length-1;return _>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(_){return _=this.conditionStack.length-1-Math.abs(_||0),_>=0?this.conditionStack[_]:"INITIAL"},pushState:function(_){this.begin(_)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(_,S,M,T){switch(M){case 0:break;case 1:return 20;case 2:return 7;case 3:return 8;case 4:return 9;case 5:return 12;case 6:return 16;case 7:return 14;case 8:return 10;case 9:return 11;case 10:return 19;case 11:return 21;case 12:return"<=";case 13:return">=";case 14:return"<";case 15:return">";case 16:return S.yytext=S.yytext.substr(1,S.yyleng-2),24;case 17:return 13;case 18:return 23;case 19:return 5;case 20:return"INVALID"}},rules:[/^(?:\s+)/i,/^(?:(-?(?:[1-9][0-9]+|[0-9]))\b)/i,/^(?:OR\b)/i,/^(?:AND\b)/i,/^(?:NOT\b)/i,/^(?:((ALL|NONE|HETATM|PROTEIN|BASIC|ACIDIC|CHARGED|POLAR|NONPOLAR|AROMATIC|NUCLEIC|PURINE|PYRIMIDINE|WATER|POLARH|NONPOLARH))\b)/i,/^(?:((NAME|ELEM|TYPE|RESIDUE|ICODE|CHAIN|ALTLOC))\b)/i,/^(?:((SERIAL|SEQUENCE|RESIDX))\b)/i,/^(?:\()/i,/^(?:\))/i,/^(?:,)/i,/^(?::)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:(@[_A-Z0-9]+))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],inclusive:!0}}};return x}();h.lexer=v;function C(){this.yy={}}return C.prototype=h,h.Parser=C,new C}(),SelectionParser={parser:parser$1};function _createSuper$1_(o){var t=_isNativeReflectConstruct$1_();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1_(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Range=function(){function o(t,e){_classCallCheck(this,o),this.min=t,this.max=typeof e>"u"?t:e}return _createClass(o,[{key:"includes",value:function(e){return this.min<=e&&e<=this.max}},{key:"toString",value:function(){var e=this.min,n=this.max;return e===n?String(e):[e,n].join(":")}},{key:"toJSON",value:function(){return[this.min,this.max]}}]),o}(),List=function(){function o(t){if(_classCallCheck(this,o),t instanceof this.constructor)return t;t instanceof Array?this._values=t.slice(0):t?this._values=[t]:this._values=[]}return _createClass(o,[{key:"append",value:function(e){var n=this._values;return n[n.length]=e,this}},{key:"remove",value:function(e){var n=this._values,r=n.indexOf(e);return r>=0&&n.splice(r,1),this}},{key:"toString",value:function(){return this._values.join(",")}},{key:"toJSON",value:function(){for(var e=this._values,n=[],r=0,a=e.length;r<a;++r){var s=e[r];n[r]=s.toJSON?s.toJSON():s}return n}}]),o}(),RangeList=function(o){_inherits(e,o);var t=_createSuper$1_(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includes",value:function(r){for(var a=this._values,s=0,l=a.length;s<l;++s)if(a[s].includes(r))return!0;return!1}}]),e}(List),valuesArray=[],ValueList=function(o){_inherits(e,o);var t=_createSuper$1_(e);function e(n,r){var a;_classCallCheck(this,e);var s=a=t.call(this,n);if(r){a.upperOnly=!0;for(var l=s._values,c=0,u=l.length;c<u;++c){var f=l[c];typeof f=="string"&&(l[c]=f.toUpperCase())}}else a.upperOnly=!1;return _possibleConstructorReturn(a,s)}return _createClass(e,[{key:"includes",value:function(r){return this._values.indexOf(r)!==-1}},{key:"toString",value:function(){var r=this._values;valuesArray.length=0;for(var a=0,s=r.length;a<s;++a)valuesArray[a]=utils.correctSelectorIdentifier(String(r[a]));return valuesArray.join(",")}},{key:"_validate",value:function(r){return this.upperOnly&&typeof r=="string"?r.toUpperCase():r}},{key:"append",value:function(r){return _get(_getPrototypeOf(e.prototype),"append",this).call(this,this._validate(r)),this}},{key:"remove",value:function(r){return _get(_getPrototypeOf(e.prototype),"remove",this).call(this,this._validate(r)),this}}]),e}(List);function _createSuper$1Z(o){var t=_isNativeReflectConstruct$1Z();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1Z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Selector=function(){function o(){_classCallCheck(this,o)}return _createClass(o,[{key:"toString",value:function(){return this.keyword}},{key:"toJSON",value:function(){return[this.name]}}]),o}();Selector.prototype.name="Error";Selector.prototype.keyword="error";var ListSelector=function(o){_inherits(e,o);var t=_createSuper$1Z(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r.list=n,r}return _createClass(e,[{key:"toString",value:function(){return"".concat(this.keyword," ").concat(this.list)}},{key:"toJSON",value:function(){return[this.name,this.list.toJSON()]}}]),e}(Selector),RangeListSelector=function(o){_inherits(e,o);var t=_createSuper$1Z(e);function e(n){return _classCallCheck(this,e),t.call(this,new RangeList(n))}return _createClass(e)}(ListSelector),ValueListSelector=function(o){_inherits(e,o);var t=_createSuper$1Z(e);function e(n,r){return _classCallCheck(this,e),t.call(this,new ValueList(n,!r))}return _createClass(e)}(ListSelector),NoneSelector=function(o){_inherits(e,o);var t=_createSuper$1Z(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return!1}}]),e}(Selector);NoneSelector.prototype.name="None";NoneSelector.prototype.keyword="none";var AllSelector=function(o){_inherits(e,o);var t=_createSuper$1Z(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return!0}}]),e}(Selector);AllSelector.prototype.name="All";AllSelector.prototype.keyword="all";function _createSuper$1Y(o){var t=_isNativeReflectConstruct$1Y();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1Y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var none=new NoneSelector,PrefixOperator=function(o){_inherits(e,o);var t=_createSuper$1Y(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r.rhs=n||none,r}return _createClass(e,[{key:"toString",value:function(){var r=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(this.keyword," ").concat(r)}},{key:"toJSON",value:function(){return[this.name,this.rhs.toJSON()]}}]),e}(Selector);PrefixOperator.prototype.priority=1;var InfixOperator=function(o){_inherits(e,o);var t=_createSuper$1Y(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this),a.lhs=n||none,a.rhs=r||none,a}return _createClass(e,[{key:"toString",value:function(){var r=this.lhs.priority&&this.lhs.priority>this.priority?"(".concat(this.lhs,")"):this.lhs,a=this.rhs.priority&&this.rhs.priority>this.priority?"(".concat(this.rhs,")"):this.rhs;return"".concat(r," ").concat(this.keyword," ").concat(a)}},{key:"toJSON",value:function(){return[this.name,this.lhs.toJSON(),this.rhs.toJSON()]}}]),e}(Selector);InfixOperator.prototype.priority=1e3;function _createSuper$1X(o){var t=_isNativeReflectConstruct$1X();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1X(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var keywords={};function defineSelector(o,t){var e=o.toLowerCase();t.prototype.keyword=e,t.prototype.name=o;var n=function(){for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return _construct(t,s)};return n.SelectorClass=t,keywords[e]=n,t}defineSelector("Serial",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.serial)}}]),e}(RangeListSelector));defineSelector("Name",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.name)}}]),e}(ValueListSelector));defineSelector("AltLoc",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(String.fromCharCode(r.location))}}]),e}(ValueListSelector));defineSelector("Elem",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.element.name)}}]),e}(ValueListSelector));defineSelector("Residue",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.residue._type._name)}}]),e}(ValueListSelector));defineSelector("Sequence",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.residue._sequence)}}]),e}(RangeListSelector));defineSelector("ICode",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(n){return _classCallCheck(this,e),t.call(this,n,!0)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.residue._icode)}}]),e}(ValueListSelector));defineSelector("ResIdx",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.residue._index)}}]),e}(RangeListSelector));defineSelector("Chain",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(n){return _classCallCheck(this,e),t.call(this,n,!0)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.list.includes(r.residue._chain._name)}}]),e}(ValueListSelector));defineSelector("Hetatm",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return r.het}}]),e}(Selector));defineSelector("PolarH",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return(r.flags&Atom$2.Flags.NONPOLARH)===Atom$2.Flags.HYDROGEN}}]),e}(Selector));defineSelector("NonPolarH",function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return(r.flags&Atom$2.Flags.NONPOLARH)===Atom$2.Flags.NONPOLARH}}]),e}(Selector));defineSelector("All",AllSelector);defineSelector("None",NoneSelector);var NULL_SELECTOR=keywords.none();function defineOperator(o,t,e){return e.prototype.priority=t,defineSelector(o,e)}defineOperator("Not",1,function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return!this.rhs.includesAtom(r)}}]),e}(PrefixOperator));defineOperator("And",2,function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.lhs.includesAtom(r)&&this.rhs.includesAtom(r)}}]),e}(InfixOperator));defineOperator("Or",3,function(o){_inherits(e,o);var t=_createSuper$1X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"includesAtom",value:function(r){return this.lhs.includesAtom(r)||this.rhs.includesAtom(r)}}]),e}(InfixOperator));function byResidueTypeFlag(o,t){return defineSelector(t,function(e){_inherits(r,e);var n=_createSuper$1X(r);function r(){return _classCallCheck(this,r),n.apply(this,arguments)}return _createClass(r,[{key:"includesAtom",value:function(s){return(s.residue._type.flags&o)!==0}}]),r}(Selector))}byResidueTypeFlag(ResidueType$1.Flags.PROTEIN,"Protein");byResidueTypeFlag(ResidueType$1.Flags.BASIC,"Basic");byResidueTypeFlag(ResidueType$1.Flags.ACIDIC,"Acidic");byResidueTypeFlag(ResidueType$1.Flags.BASIC|ResidueType$1.Flags.ACIDIC,"Charged");byResidueTypeFlag(ResidueType$1.Flags.POLAR,"Polar");byResidueTypeFlag(ResidueType$1.Flags.NONPOLAR,"NonPolar");byResidueTypeFlag(ResidueType$1.Flags.AROMATIC,"Aromatic");byResidueTypeFlag(ResidueType$1.Flags.NUCLEIC,"Nucleic");byResidueTypeFlag(ResidueType$1.Flags.PURINE,"Purine");byResidueTypeFlag(ResidueType$1.Flags.PYRIMIDINE,"Pyrimidine");byResidueTypeFlag(ResidueType$1.Flags.WATER,"Water");var selectors$5=Object.create(keywords);selectors$5.Selector=Selector;selectors$5.RangeListSelector=RangeListSelector;selectors$5.ValueListSelector=ValueListSelector;selectors$5.Range=Range;selectors$5.RangeList=RangeList;selectors$5.ValueList=ValueList;selectors$5.PrefixOperator=PrefixOperator;selectors$5.InfixOperator=InfixOperator;selectors$5.Context=Object.create({});selectors$5.GetSelector=function(o){if(!selectors$5.Context.hasOwnProperty(o)){var t={message:"selector ".concat(o," is not registered")};throw t}return selectors$5.Context[o]||NULL_SELECTOR};selectors$5.ClearContext=function(){Object.keys(selectors$5.Context).forEach(function(o){delete selectors$5.Context[o]})};selectors$5.keyword=function(o){return keywords[o.toLowerCase()]||keywords.none};selectors$5.parse=function(o){var t={};try{t.selector=SelectionParser.parser.parse(o)}catch(e){t.selector=NULL_SELECTOR,t.error=e.message}return t};SelectionParser.parser.yy=selectors$5;SelectionParser.parser.yy.parseError=SelectionParser.parser.parseError;var BiologicalUnit=function(){function o(t){_classCallCheck(this,o),this._complex=t,this._selector=selectors$5.keyword("All")(),this._boundaries={boundingBox:new Box3,boundingSphere:new Sphere}}return _createClass(o,[{key:"computeBoundaries",value:function(){var e=this._complex._atoms,n=e.length,r=this._selector,a=this._boundaries.boundingBox;if(a.makeEmpty(),n===1){a.expandByPoint(e[0].position);var s=new Vector3;a.getCenter(s);var l=2*e[0].element.radius;a.setFromCenterAndSize(s,new Vector3(l,l,l))}else for(var c=0;c<n;++c)r.includesAtom(e[c])&&a.expandByPoint(e[c].position);var u=0,f=new Vector3;if(a.getCenter(f),n===1)this._boundaries.boundingSphere.set(f,e[0].element.radius);else{for(var p=0;p<n;++p)if(r.includesAtom(e[p])){var g=e[p].position,y=f.distanceToSquared(g);u<y&&(u=y)}this._boundaries.boundingSphere.set(f,Math.sqrt(u))}}},{key:"getTransforms",value:function(){return[]}},{key:"getSelector",value:function(){return this._selector}},{key:"getBoundaries",value:function(){return this._boundaries}},{key:"finalize",value:function(){}}]),o}();function _createSuper$1W(o){var t=_isNativeReflectConstruct$1W();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1W(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Assembly$3=function(o){_inherits(e,o);var t=_createSuper$1W(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n),r.chains=[],r.matrices=[],r}return _createClass(e,[{key:"computeBoundaries",value:function(){_get(_getPrototypeOf(e.prototype),"computeBoundaries",this).call(this);var r=this.matrices,a=this._boundaries.boundingSphere.center,s=this._boundaries.boundingSphere.radius,l=this._boundaries.boundingBox=new Box3;l.makeEmpty();for(var c=0,u=r.length;c<u;++c)l.expandByPoint(a.clone().applyMatrix4(r[c]));var f=l.max.distanceTo(l.min)/2+s,p=new Vector3;l.getCenter(p),this._boundaries.boundingSphere=new Sphere().set(p,f),l.max.addScalar(s),l.min.subScalar(s)}},{key:"addChain",value:function(r){this.chains[this.chains.length]=r}},{key:"addMatrix",value:function(r){this.matrices[this.matrices.length]=r}},{key:"getTransforms",value:function(){return this.matrices}},{key:"finalize",value:function(){this.chains.length>0?this._selector=selectors$5.keyword("Chain")(this.chains):this._selector=selectors$5.keyword("None")()}}]),e}(BiologicalUnit),Component=function(){function o(t){_classCallCheck(this,o),this._complex=t,this._index=-1,this._residueIndices=[],this._cycles=[],this._subDivs=[],this._residueCount=0}return _createClass(o,[{key:"getResidues",value:function(){return this._complex._residues}},{key:"getResidueCount",value:function(){return this._residueCount}},{key:"forEachResidue",value:function(e){for(var n=this._complex._residues,r=this._residueIndices,a=0,s=r.length;a<s;++a)for(var l=r[a].start,c=r[a].end;l<=c;++l)e(n[l])}},{key:"setSubDivs",value:function(e){this._subDivs=e;for(var n=0,r=[],a=0,s=0,l=e.length;s<l;++s)if(s===l-1||e[s].end+1!==e[s+1].start){var c=e[n].start,u=e[s].end;r[r.length]={start:c,end:u},a+=u-c+1,n=s+1}this._residueIndices=r,this._residueCount=a}},{key:"getComplex",value:function(){return this._complex}},{key:"forEachBond",value:function(e){for(var n=this._complex._bonds,r=0,a=n.length;r<a;++r){var s=n[r];s._left.residue._component===this&&e(s)}}},{key:"update",value:function(){this.forEachCycle(function(e){e.update()})}},{key:"forEachAtom",value:function(e){this.forEachResidue(function(n){n.forEachAtom(e)})}},{key:"addCycle",value:function(e){this._cycles.push(e)}},{key:"forEachCycle",value:function(e){for(var n=this._cycles,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"markResidues",value:function(){var e=this;e.forEachResidue(function(n){n._component=e})}},{key:"_forEachSubChain",value:function(e,n){for(var r=this._complex._residues,a=this._subDivs,s=0,l=a.length;s<l;++s)for(var c=a[s].start,u=a[s].end;c<=u;++c){var f=r[c];if(e&f._mask&&f._isValid){for(var p=c+1;p<=u;++p){var g=r[p];if(!(e&g._mask&&g._isValid))break}n(s,c,p-1),c=p}}}},{key:"getMaskedSequences",value:function(e){var n=[],r=0;return this._forEachSubChain(e,function(a,s,l){n[r++]={start:s,end:l}}),n}},{key:"getMaskedSubdivSequences",value:function(e){var n=[],r=-1,a=-1,s=this._subDivs;return this._forEachSubChain(e,function(l,c,u){a!==l&&(++r,n[r]={arr:[],boundaries:s[l]},a=l),n[r].arr[n[r].arr.length]={start:c,end:u}}),n}}]),o}(),cMaxPairsForHashCode=32,cHashTableSize=1024*1024,cNumbersPerPair=4,cMaxNeighbours=14,cInvalidVal=-1,cBigPrime=89237,AtomPairs=function(){function o(t){_classCallCheck(this,o),this.numPairs=0,this.numMaxPairs=t,this.intBuffer=utils.allocateTyped(Int32Array,t*cNumbersPerPair);for(var e=0;e<t*cNumbersPerPair;e++)this.intBuffer[e]=cInvalidVal;this.hashBuffer=utils.allocateTyped(Int32Array,cHashTableSize*cMaxPairsForHashCode);for(var n=0;n<cHashTableSize*cMaxPairsForHashCode;n++)this.hashBuffer[n]=cInvalidVal}return _createClass(o,[{key:"destroy",value:function(){this.intBuffer=null,this.hashBuffer=null}},{key:"addPair",value:function(e,n){for(var r=e<n?e:n,a=e>n?e:n,s=r+(a<<cMaxNeighbours),l=r+a*cBigPrime&cHashTableSize-1,c=l*cMaxPairsForHashCode,u=0;u<cMaxPairsForHashCode;u++){var f=this.hashBuffer[c+u];if(f===cInvalidVal)break;if(f===s)return!1}if(u>=cMaxPairsForHashCode)throw new Error("addPair: increase cMaxPairsForHashCode");if(this.hashBuffer[c+u]=s,this.numPairs>=this.numMaxPairs)throw new Error("addPair: increase num pairs");return c=this.numPairs*cNumbersPerPair,this.intBuffer[c]=r,this.intBuffer[c+1]=a,this.intBuffer[c+2]=s,this.numPairs++,!0}}]),o}(),cEstBondsMultiplier=4,cSpaceCode=32,cBondTolerance=.45,cEpsilon=.001;function _getBondingRadius(o){var t=o.element;if(t)return t.radiusBonding;throw new Error("_getBondingRadius: Logic error.")}function _isAtomEligible(o){return!o.isHet()||o.bonds&&o.bonds.length===0}var AutoBond=function(){function o(t){_classCallCheck(this,o),this._complex=t,this._maxRad=1.8;var e=this._complex.getDefaultBoundaries().boundingBox;this._vBoxMin=e.min.clone(),this._vBoxMax=e.max.clone(),this._pairCollection=null}return _createClass(o,[{key:"_addExistingPairs",value:function(){for(var e=this._complex.getAtoms(),n=e.length,r=0,a=this._pairCollection;r<n;r++)for(var s=e[r].bonds,l=s.length,c=0;c<l;c++){var u=s[c],f=u._left.index;f===r&&a.addPair(r,u._right.index)}return 0}},{key:"_findPairs",value:function(){var e=this._complex.getVoxelWorld();if(e!==null)for(var n=this._complex._atoms,r=n.length,a=this,s,l,c,u,f,p=function(E){if(!(l&&E.isHydrogen())){var h=E.location;if(!(u!==cSpaceCode&&h!==cSpaceCode&&u!==h)){var v=c.distanceToSquared(E.position),C=E.element.radiusBonding,x=s+C+cBondTolerance;v>x*x||v<cEpsilon||a._pairCollection.addPair(f.index,E.index)}}},g=0;g<r;++g)f=n[g],_isAtomEligible(f)&&(s=f.element.radiusBonding,l=f.isHydrogen(),c=f.position,u=f.location,e.forEachAtomWithinRadius(c,2*this._maxRad+cBondTolerance,p))}},{key:"_addPairs",value:function(){for(var e=this._complex._atoms,n=0,r=0;n<this._pairCollection.numPairs;n++,r+=4){var a=this._pairCollection.intBuffer[r],s=this._pairCollection.intBuffer[r+1];this._addPair(e[a],e[s])}}},{key:"_addPair",value:function(e,n){for(var r=e.bonds,a=e.index,s=n.index,l=0,c=r.length;l<c;++l){var u=r[l];if(u._left.index===s||u._right.index===s)return}var f=a<s?e:n,p=a<s?n:e,g=this._complex.addBond(f,p,0,Bond$5.BondType.UNKNOWN,!1);r.push(g),n.bonds.push(g)}},{key:"build",value:function(){this._buildInner()}},{key:"_buildInner",value:function(){var e=this._complex._atoms;if(!(e.length<2)){if(e[0].index<0)throw new Error("AutoBond: Atoms in complex were not indexed.");this._calcBoundingBox(),this._pairCollection=new AtomPairs(e.length*cEstBondsMultiplier),this._addExistingPairs(),this._findPairs(),this._addPairs()}}},{key:"_calcBoundingBox",value:function(){for(var e=this._complex._atoms,n=e.length,r=_getBondingRadius(e[0]),a=1;a<n;++a)r=Math.max(r,_getBondingRadius(e[a]));this._vBoxMax.addScalar(r),this._vBoxMin.addScalar(-r),this._maxRad=r*1.2}},{key:"destroy",value:function(){this._pairCollection&&this._pairCollection.destroy()}}]),o}(),cCrossThresh=.1,cAromaticType=Bond$5.BondType.AROMATIC,cAromaticAtoms=[Element$a.ByName.C.number,Element$a.ByName.N.number],_coDirVectors=function(){var o=new Vector3,t=new Vector3,e=new Vector3;return function(n,r){return o.copy(n).normalize(),t.copy(r).normalize(),e.crossVectors(o,t),e.length()>cCrossThresh?!1:o.dot(t)>=0}}();function _insertAscending(o,t){for(var e=0;e<o.length&&o[e]<t;)++e;o.splice(e,0,t)}function _anotherAtom(o,t){return o._left===t?o._right:o._left}function _cosBetween(o,t){var e=o.dot(t)/Math.sqrt(o.lengthSq()*t.lengthSq());return MathUtils.clamp(e,-1,1)}function _markAromatic(o){o._type=cAromaticType}var Cycle=function(){function o(t){_classCallCheck(this,o),this.atoms=t,this.update()}return _createClass(o,[{key:"update",value:function(){for(var e=this.atoms,n=new Vector3,r=e.length,a=0;a<r;++a)n.add(e[a].position);n.multiplyScalar(1/r),this.center=n,this.radius=n.distanceTo(e[0].position.clone().lerp(e[1].position,.5))}},{key:"forEachBond",value:function(e){var n=this.atoms,r=n.length,a=n[0],s;function l(u){(u._left===s||u._right===s)&&e(u)}for(var c=0;c<r;++c)s=n[(c+1)%r],a.forEachBond(l),a=s}}]),o}();function _isAromatic(o){return o._type===cAromaticType}function _isPossibleAromatic(o){if(o.type===cAromaticType)return!0;var t=cAromaticAtoms.indexOf(o._right.element.number),e=cAromaticAtoms.indexOf(o._left.element.number);return t!==-1&&e!==-1}function _checkCycleSimple(o){return o.length>3}function _checkCycleComplex(o){return console.assert(o.length>2),!0}var AromaticLoopsMarker=function(){function o(t){_classCallCheck(this,o),this._complex=t;for(var e=new Array(t._bonds.length),n=new Array(t._bonds.length),r=0,a=e.length;r<a;++r)e[r]=[],n[r]=!1;this._bondsData=e,this._bondMarks=n,this._resetCycles()}return _createClass(o,[{key:"_resetCycles",value:function(){this._cycles=[],this._currIdx=-1}},{key:"_haveSameCycle",value:function(e,n,r){for(var a=e[n._index],s=e[r._index],l=a.length,c=s.length,u=0,f=0;u<l&&f<c;){if(a[u]===s[f])return!0;a[u]>s[f]?++f:++u}return!1}},{key:"_tryBond",value:function(e,n,r){var a=[],s=this._bondsData,l=_anotherAtom(e,n),c=n.position.clone().sub(l.position),u=this._currStart,f=this,p=this._bondMarks,g=this._checkBond;p[e._index]=!0,g=g===void 0?_isAromatic:g,n.forEachBond(function(C){if(!(!g(C)||C===e||p[C._index]||f._haveSameCycle(s,e,C))){var x=_anotherAtom(C,n),w=x.position.clone().sub(n.position),_=x===u?-2:1-_cosBetween(c,w),S=w.cross(c);if(_coDirVectors(S,r)){for(var M=0;M<a.length&&a[M].val<_;)++M;a.splice(M,0,{bond:C,val:_,dir:S})}}});for(var y=0,E=a.length;y<E;++y){var h=a[y].bond,v=h._left===n?h._right:h._left;if(v===u)return++this._currIdx,this._cycles.push([n]),p[e._index]=!1,!0;if(this._tryBond(h,v,a[y].dir))return _insertAscending(s[h._index],this._currIdx),this._cycles[this._currIdx].push(n),p[e._index]=!1,!0}return p[e._index]=!1,!1}},{key:"_startCycle",value:function(e){this._currStart=e._left,this._tryBond(e,e._right,new Vector3)&&(_insertAscending(this._bondsData[e._index],this._currIdx),this._cycles[this._currIdx].push(e._left))}},{key:"_findLoops",value:function(e,n){this._checkBond=e;var r=this._complex,a=this;r.forEachComponent(function(s){a._resetCycles(),s.forEachBond(function(g){e(g)&&a._startCycle(g)});for(var l=a._cycles,c=0,u=l.length;c<u;++c){var f=l[c];if(n(f)){var p=new Cycle(f);p.forEachBond(_markAromatic),s.addCycle(p)}}})}},{key:"markCycles",value:function(){this._findLoops(_isAromatic,_checkCycleSimple)}},{key:"detectCycles",value:function(){this._findLoops(_isPossibleAromatic,_checkCycleComplex)}}]),o}();function _getSphereSliceRadiusRange(o,t,e,n){var r=e-o.z,a=n-o.z,s=Math.sqrt(Math.max(t*t-r*r,0)),l=Math.sqrt(Math.max(t*t-a*a,0)),c=Math.min(s,l),u;return e<=o.z&&n>=o.z?u=t:u=Math.max(s,l),[c,u]}function _getCircleSliceRadiusRange(o,t,e,n){var r=e-o.y,a=n-o.y,s=Math.sqrt(Math.max(t*t-r*r,0)),l=Math.sqrt(Math.max(t*t-a*a,0)),c=Math.min(s,l),u;return e<=o.y&&n>=o.y?u=t:u=Math.max(s,l),[c,u]}var VoxelWorld=function(){function o(t,e){_classCallCheck(this,o),this._box=t.clone();var n=new Vector3;t.getSize(n),this._count=n.clone().divide(e).floor().max(new Vector3(1,1,1)),this._last=this._count.clone().subScalar(1),this._cellSize=n.clone().divide(this._count),this._cellInnerR=.5*Math.min(Math.min(this._cellSize.x,this._cellSize.y),this._cellSize.z),this._cellOuterR=.5*Math.sqrt(this._cellSize.dot(this._cellSize));var r=this._count.x*this._count.y*this._count.z;this._voxels=utils.allocateTyped(Int32Array,r);for(var a=0;a<r;++a)this._voxels[a]=-1;this._atoms=[]}return _createClass(o,[{key:"addAtoms",value:function(e){var n=this,r=this._atoms.length;this._atoms.length+=2*e.getAtomCount(),e.forEachAtom(function(a){var s=n._findVoxel(a.position);n._atoms[r]=a,n._atoms[r+1]=n._voxels[s],n._voxels[s]=r,r+=2})}},{key:"_findVoxel",value:function(e){var n=o._zero,r=o._voxel;return r.copy(e).sub(this._box.min).divide(this._cellSize).floor().clamp(n,this._last),r.x+this._count.x*(r.y+this._count.y*r.z)}},{key:"_forEachAtomInVoxel",value:function(e,n){for(var r=this._voxels[e];r>=0;r=this._atoms[r+1])n(this._atoms[r])}},{key:"_forEachVoxelWithinRadius",value:function(e,n,r){var a=o._xRange,s=o._yRange,l=o._zRange;if(n/this._cellInnerR<10){this._forEachVoxelWithinRadiusSimple(e,n,r);return}var c,u,f,p,g,y,E,h;l.set(e.z-n,e.z+n),l.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor().clampScalar(0,this._count.z-1);for(var v=l.x;v<=l.y;++v){g=[this._box.min.z+v*this._cellSize.z,this._box.min.z+(v+1)*this._cellSize.z],h=e.z-n<=g[0]&&g[1]<=e.z+n,c=_getSphereSliceRadiusRange(e,n,g[0],g[1]),s.set(e.y-c[1],e.y+c[1]),s.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor().clampScalar(0,this._count.y-1);for(var C=s.x;C<=s.y;++C){p=[this._box.min.y+C*this._cellSize.y,this._box.min.y+(C+1)*this._cellSize.y],E=e.y-c[0]<=p[0]&&p[1]<=e.y+c[0],u=_getCircleSliceRadiusRange(e,c[1],p[0],p[1]),a.set(e.x-u[1],e.x+u[1]),a.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor().clampScalar(0,this._count.x-1);for(var x=a.x;x<=a.y;++x)f=[this._box.min.x+x*this._cellSize.x,this._box.min.x+(x+1)*this._cellSize.x],y=e.x-u[0]<=f[0]&&f[1]<=e.x+u[0],r(x+this._count.x*(C+this._count.y*v),y&&E&&h)}}}},{key:"_forEachVoxelWithinRadiusSimple",value:function(e,n,r){var a=o._xRange,s=o._yRange,l=o._zRange,c=o._vCenter,u=(n+this._cellOuterR)*(n+this._cellOuterR),f=-1;n>this._cellOuterR&&(f=(n-this._cellOuterR)*(n-this._cellOuterR)),a.set(e.x-n,e.x+n),a.subScalar(this._box.min.x).divideScalar(this._cellSize.x).floor(),a.x=Math.min(Math.max(a.x,0),this._count.x-1),a.y=Math.min(Math.max(a.y,0),this._count.x-1),s.set(e.y-n,e.y+n),s.subScalar(this._box.min.y).divideScalar(this._cellSize.y).floor(),s.x=Math.min(Math.max(s.x,0),this._count.y-1),s.y=Math.min(Math.max(s.y,0),this._count.y-1),l.set(e.z-n,e.z+n),l.subScalar(this._box.min.z).divideScalar(this._cellSize.z).floor(),l.x=Math.min(Math.max(l.x,0),this._count.z-1),l.y=Math.min(Math.max(l.y,0),this._count.z-1);for(var p=l.x;p<=l.y;++p){var g=[this._box.min.z+p*this._cellSize.z,this._box.min.z+(p+1)*this._cellSize.z];c.z=.5*(g[0]+g[1]);for(var y=s.x;y<=s.y;++y){var E=[this._box.min.y+y*this._cellSize.y,this._box.min.y+(y+1)*this._cellSize.y];c.y=.5*(E[0]+E[1]);for(var h=a.x;h<=a.y;++h){var v=[this._box.min.x+h*this._cellSize.x,this._box.min.x+(h+1)*this._cellSize.x];c.x=.5*(v[0]+v[1]);var C=e.distanceToSquared(c);C<=u&&r(h+this._count.x*(y+this._count.y*p),C<=f)}}}}},{key:"forEachAtomWithinRadius",value:function(e,n,r){var a=this,s=n*n;a._forEachVoxelWithinRadius(e,n,function(l,c){c?a._forEachAtomInVoxel(l,r):a._forEachAtomInVoxel(l,function(u){e.distanceToSquared(u.position)<=s&&r(u)})})}},{key:"forEachAtomWithinDistFromMasked",value:function(e,n,r,a){this._forEachAtomWithinDistFromGroup(function(s){e.forEachAtom(function(l){l.mask&n&&s(l)})},r,a)}},{key:"forEachAtomWithinDistFromSelected",value:function(e,n,r,a){this._forEachAtomWithinDistFromGroup(function(s){e.forEachAtom(function(l){n.includesAtom(l)&&s(l)})},r,a)}},{key:"_forEachAtomWithinDistFromGroup",value:function(e,n,r){var a=this,s=n*n,l=[],c=[],u=0;e(function(g){a._forEachVoxelWithinRadius(g.position,n,function(y,E){E?l[y]=-1:typeof l[y]>"u"?(c.push(g),c.push(-1),l[y]=u,u+=2):l[y]!==-1&&(c.push(g),c.push(l[y]),l[y]=u,u+=2)})});var f,p=function(y){if(!(typeof l[f]>"u")){if(u=l[f],u===-1){r(y);return}for(;u>=0;u=c[u+1])if(y.position.distanceToSquared(c[u].position)<s){r(y);break}}};for(f in l)l.hasOwnProperty(f)&&a._forEachAtomInVoxel(f,p)}}]),o}();_defineProperty(VoxelWorld,"_zero",new Vector3(0,0,0));_defineProperty(VoxelWorld,"_voxel",new Vector3);_defineProperty(VoxelWorld,"_xRange",new Vector2);_defineProperty(VoxelWorld,"_yRange",new Vector2);_defineProperty(VoxelWorld,"_zRange",new Vector2);_defineProperty(VoxelWorld,"_vCenter",new Vector3);var MINIMAL_DISTANCE=.5,MIN_HBOND_ENERGY=-9.9,MAX_HBOND_ENERGY=-.5,COUPLING_CONSTANT=-27.888,MAX_COUPLING_DISTANCE=5,MAX_RESIDUES_THRESHOLD=1e3,HBondInfo=function(){function o(t){_classCallCheck(this,o),this._complex=t,this._hbonds=[],this._complex._residues.length>MAX_RESIDUES_THRESHOLD?this._buildVW():this._build()}return _createClass(o,[{key:"isBond",value:function(e,n){if(this._hbonds[e]){var r=_slicedToArray(this._hbonds[e].acceptor,2),a=r[0],s=r[1];if(a&&a.residue===n&&a.energy<MAX_HBOND_ENERGY||s&&s.residue===n&&s.energy<MAX_HBOND_ENERGY)return!0}return!1}},{key:"_build",value:function(){for(var e=this,n=0;n<this._complex._residues.length-1;++n){var r=this._complex._residues[n];if(r.getType().flags&ResidueType$1.Flags.PROTEIN){var a=null;n>0&&this._complex._residues[n-1].getType().flags&ResidueType$1.Flags.PROTEIN&&r._sequence===this._complex._residues[n-1]._sequence+1&&(a=this._complex._residues[n-1]);for(var s=n+1;s<this._complex._residues.length;++s){var l=this._complex._residues[s];if(l.getType().flags&ResidueType$1.Flags.PROTEIN){var c=null;this._complex._residues[s-1].getType().flags&ResidueType$1.Flags.PROTEIN&&l._sequence===this._complex._residues[s-1]._sequence+1&&(c=this._complex._residues[s-1]),e._calcHBondEnergy(a,r,l),s!==n+1&&e._calcHBondEnergy(c,l,r)}}}}}},{key:"_buildVW",value:function(){var e=this,n=this._complex._residues,r,a,s=this._complex.getVoxelWorld();if(s===null)return;var l=new AtomPairs(this._complex._residues.length*this._complex._residues.length/2);function c(f){var p=f.residue;if(p._index!==r._index&&p.getType().flags&ResidueType$1.Flags.PROTEIN&&l.addPair(r._index,p._index)){var g=p._index>0?n[p._index-1]:null;g&&(!(g.getType().flags&ResidueType$1.Flags.PROTEIN)||p._sequence!==g._sequence+1)&&(g=null),e._calcHBondEnergy(a,r,p),p._index!==r._index+1&&e._calcHBondEnergy(g,p,r)}}for(var u=0;u<n.length-1;++u)r=n[u],r.getType().flags&ResidueType$1.Flags.PROTEIN&&(a=u>0?n[u-1]:null,a&&(!(a.getType().flags&ResidueType$1.Flags.PROTEIN)||r._sequence!==a._sequence+1)&&(a=null),s.forEachAtomWithinRadius(this._residueGetCAlpha(r),MAX_COUPLING_DISTANCE,c))}},{key:"_residueGetCAlpha",value:function(e){for(var n=0;n<e._atoms.length;++n){var r=e._atoms[n].name;if(r==="CA"||r==="C1")return e._atoms[n].position}return null}},{key:"_residueGetCO",value:function(e){var n=null,r=null;return e.forEachAtom(function(a){a.name==="C"?n=a.position:a.name==="O"&&(r=a.position)}),[n,r]}},{key:"_residueGetNH",value:function(e,n){var r=this._residueGetCO(e),a=_slicedToArray(r,2),s=a[0],l=a[1],c;if(n.forEachAtom(function(f){f.name==="N"&&(c=f.position)}),s&&l&&c){var u=s.clone();return u.sub(l),u.multiplyScalar(1/u.length()),u.add(c),[c,u]}return[null,null]}},{key:"_calcHBondEnergy",value:function(e,n,r){var a=0;if(e===null)return a;if(n.getType().getName()!=="PRO"){var s=this._residueGetNH(e,n),l=_slicedToArray(s,2),c=l[0],u=l[1],f=this._residueGetCO(r),p=_slicedToArray(f,2),g=p[0],y=p[1];if(c===null||u===null||g===null||y===null)return a;var E=u.distanceTo(y),h=u.distanceTo(g),v=c.distanceTo(g),C=c.distanceTo(y);E<MINIMAL_DISTANCE||h<MINIMAL_DISTANCE||v<MINIMAL_DISTANCE||C<MINIMAL_DISTANCE?a=MIN_HBOND_ENERGY:a=COUPLING_CONSTANT/E-COUPLING_CONSTANT/h+COUPLING_CONSTANT/v-COUPLING_CONSTANT/C,a=Math.round(a*1e3)/1e3,a<MIN_HBOND_ENERGY&&(a=MIN_HBOND_ENERGY)}typeof this._hbonds[n._index]>"u"&&(this._hbonds[n._index]={donor:[],acceptor:[]});var x=this._hbonds[n._index];x.acceptor.length<2&&x.acceptor.push({residue:r._index,energy:a}),x.acceptor.length>1&&(a<x.acceptor[0].energy?(x.acceptor[1].residue=x.acceptor[0].residue,x.acceptor[1].energy=x.acceptor[0].energy,x.acceptor[0].residue=r._index,x.acceptor[0].energy=a):a<x.acceptor[1].energy&&(x.acceptor[1].residue=r._index,x.acceptor[1].energy=a)),typeof this._hbonds[r._index]>"u"&&(this._hbonds[r._index]={donor:[],acceptor:[]});var w=this._hbonds[r._index];return w.donor.length<2&&w.donor.push({residue:n._index,energy:a}),w.donor.length>1&&(a<w.donor[0].energy?(w.donor[1].residue=w.donor[0].residue,w.donor[1].energy=w.donor[0].energy,w.donor[0].residue=n._index,w.donor[0].energy=a):a<w.donor[1].energy&&(w.donor[1].residue=n._index,w.donor[1].energy=a)),a}}]),o}();function _createForOfIteratorHelper(o,t){var e=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!e){if(Array.isArray(o)||(e=_unsupportedIterableToArray(o))||t&&o&&typeof o.length=="number"){e&&(o=e);var n=0,r=function(){};return{s:r,n:function(){return n>=o.length?{done:!0}:{done:!1,value:o[n++]}},e:function(u){throw u},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){e=e.call(o)},n:function(){var u=e.next();return a=u.done,u},e:function(u){s=!0,l=u},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(s)throw l}}}}function _unsupportedIterableToArray(o,t){if(o){if(typeof o=="string")return _arrayLikeToArray(o,t);var e=Object.prototype.toString.call(o).slice(8,-1);if(e==="Object"&&o.constructor&&(e=o.constructor.name),e==="Map"||e==="Set")return Array.from(o);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _arrayLikeToArray(o,t)}}function _arrayLikeToArray(o,t){(t==null||t>o.length)&&(t=o.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=o[e];return n}var BridgeType=Object.freeze({NO_BRIDGE:0,PARALLEL:1,ANTI_PARALLEL:2}),HelixFlag=Object.freeze({START:1,MIDDLE:2,END:3,START_AND_END:4}),StructureType$1=Object.freeze({STRAND:"E",BRIDGE:"B",HELIX_310:"G",HELIX_ALPHA:"H",HELIX_PI:"I",TURN:"T",BEND:"S",LOOP:" "}),SecondaryStructureMap=function(){function o(t){_classCallCheck(this,o),this._complex=t,this._build()}return _createClass(o,[{key:"_build",value:function(){var e=this;this._hbonds=new HBondInfo(this._complex),this._ss=[],this._sheet=[],this._betaPartners=[],this._bend=[];for(var n=0;n<this._complex.getResidues().length;++n)this._betaPartners[n]=[];this._helixFlags=[],this._helixFlags[3]=[],this._helixFlags[4]=[],this._helixFlags[5]=[],this._chainLengths=[];for(var r=0;r<this._complex._chains.length;++r){for(var a=this._complex._chains[r].getResidues(),s=0;s<a.length&&a[s].getType().flags&ResidueType$1.Flags.PROTEIN;++s);this._chainLengths[r]=s}this._buildBetaSheets();for(var l=0;l<this._complex._chains.length;++l)e._buildAlphaHelices(this._complex._chains[l].getResidues(),this._chainLengths[l],!1)}},{key:"_buildAlphaHelices",value:function(e,n,r){for(var a=3;a<=5&&!(e.length<a);++a)for(var s=0;s+a<n;++s)if(this._hbonds.isBond(e[s+a]._index,e[s]._index)){this._helixFlags[a][e[s+a]._index]=HelixFlag.END;for(var l=s+1;l<s+a;++l)typeof this._helixFlags[a][e[l]._index]>"u"&&(this._helixFlags[a][e[l]._index]=HelixFlag.MIDDLE);this._helixFlags[a][e[s]._index]===HelixFlag.END?this._helixFlags[a][e[s]._index]=HelixFlag.START_AND_END:this._helixFlags[a][e[s]._index]=HelixFlag.START}for(var c=2;c<n-2;++c){var u=this._kappa(e[c-2],e[c],e[c+2]);this._bend[e[c]._index]=u!==360&&u>70}for(var f=1;f+4<n;++f)if(this._isHelixStart(e[f]._index,4)&&this._isHelixStart(e[f-1]._index,4))for(var p=f;p<=f+3;++p)this._ss[e[p]._index]=StructureType$1.HELIX_ALPHA;for(var g=1;g+3<n;++g)if(this._isHelixStart(e[g]._index,3)&&this._isHelixStart(e[g-1]._index,3)){for(var y=!0,E=g;y&&E<=g+2;++E)y=typeof this._ss[e[E]._index]>"u"||this._ss[e[E]._index]===StructureType$1.HELIX_310;if(y)for(var h=g;h<=g+2;++h)this._ss[e[h]._index]=StructureType$1.HELIX_310}for(var v=1;v+5<n;++v)if(this._isHelixStart(e[v]._index,5)&&this._isHelixStart(e[v-1]._index,5)){for(var C=!0,x=v;C&&x<=v+4;++x)C=typeof this._ss[e[x]._index]>"u"||this._ss[e[x]._index]===StructureType$1.HELIX_PI||r&&this._ss[e[x]._index]===StructureType$1.HELIX_ALPHA;if(C)for(var w=v;w<=v+4;++w)this._ss[e[w]._index]=StructureType$1.HELIX_PI}for(var _=1;_+1<n;++_)if(typeof this._ss[e[_]._index]>"u"){for(var S=!1,M=3;M<=5&&!S;++M)for(var T=1;T<M&&!S;++T)S=_>=T&&this._isHelixStart(e[_-T]._index,M);S?this._ss[e[_]._index]=StructureType$1.TURN:this._bend[e[_]._index]&&(this._ss[e[_]._index]=StructureType$1.BEND)}}},{key:"_residueGetCAlpha",value:function(e){for(var n=0;n<e._atoms.length;++n){var r=e._atoms[n].name;if(r==="CA"||r==="C1")return e._atoms[n].position}return null}},{key:"_cosinusAngle",value:function(e,n,r,a){var s=e.clone().sub(n),l=r.clone().sub(a),c=0,u=s.dot(s)*l.dot(l);return u>0&&(c=s.dot(l)/Math.sqrt(u)),c}},{key:"_kappa",value:function(e,n,r){var a=this._residueGetCAlpha(n),s=this._residueGetCAlpha(e),l=this._residueGetCAlpha(r);if(a===null||s===null||l===null)return 180;var c=this._cosinusAngle(a,s,l,a),u=Math.sqrt(1-c*c);return Math.atan2(u,c)*180/Math.PI}},{key:"_isHelixStart",value:function(e,n){return this._helixFlags[n][e]===HelixFlag.START||this._helixFlags[n][e]===HelixFlag.START_AND_END}},{key:"_buildBetaSheets",value:function(){for(var e=[],n=0;n<this._complex._chains.length;++n){var r=this._chainLengths[n];if(!(r<=4))for(var a=this._complex._chains[n].getResidues(),s=n;s<this._complex._chains.length;++s){var l=this._chainLengths[s];if(!(l<=4))for(var c=this._complex._chains[s].getResidues(),u=1;u+1<r;++u){var f=a[u],p=1;for(s===n&&(p=u+3);p+1<l;++p){var g=c[p],y=this._testBridge(a,u,c,p);if(y!==BridgeType.NO_BRIDGE){var E=!1,h=_createForOfIteratorHelper(e),v;try{for(h.s();!(v=h.n()).done;){var C=v.value;if(!(y!==C.type||f._index!==C.i[C.i.length-1]+1)){if(y===BridgeType.PARALLEL&&C.j[C.j.length-1]+1===g._index){C.i.push(f._index),C.j.push(g._index),E=!0;break}if(y===BridgeType.ANTI_PARALLEL&&C.j[0]-1===g._index){C.i.push(f._index),C.j.unshift(g._index),E=!0;break}}}}catch(qe){h.e(qe)}finally{h.f()}E||e.push({type:y,i:[f._index],chainI:f.getChain()._index,j:[g._index],chainJ:g.getChain()._index})}}}}}e.sort(function(qe,et){return qe.chainI<et.chainI||qe.chainI===et.chainI&&qe.i[0]<et.i[0]?-1:1});for(var x=0;x<e.length;++x)for(var w=x+1;w<e.length;++w){var _=e[x].i[0],S=e[x].i[e[x].i.length-1],M=e[x].j[0],T=e[x].j[e[x].j.length-1],R=e[w].i[0],P=e[w].i[e[w].i.length-1],I=e[w].j[0],B=e[w].j[e[w].j.length-1];if(!(e[x].type!==e[w].type||this._hasChainBreak(Math.min(_,R),Math.max(S,P))||this._hasChainBreak(Math.min(M,I),Math.max(T,B))||R-S>=6||S>=R&&_<=P)){var W=!1;e[x].type===BridgeType.PARALLEL?W=I-T<6&&R-S<3||I-T<3:W=M-B<6&&R-S<3||M-B<3,W&&(e[x].i=e[x].i.concat(e[w].i),e[x].type===BridgeType.PARALLEL?e[x].j=e[x].j.concat(e[w].j):e[x].j=e[w].j.concat(e[x].j),e.splice(w--,1))}}for(var D=new Set,O=0;O<e.length;++O)D.add(e[O]);for(var z=1,G=0;D.size>0;){var k=D.values().next().value;D.delete(k);var $=new Set;$.add(k);var Z=void 0;do{Z=new Set;var K=_createForOfIteratorHelper($.values()),j;try{for(K.s();!(j=K.n()).done;){var Q=j.value,le=_createForOfIteratorHelper(D.values()),he;try{for(le.s();!(he=le.n()).done;){var ve=he.value;this._areBridgesLinked(Q,ve)&&Z.add(ve)}}catch(qe){le.e(qe)}finally{le.f()}}}catch(qe){K.e(qe)}finally{K.f()}var re=_createForOfIteratorHelper(Z.values()),Ie;try{for(re.s();!(Ie=re.n()).done;)k=Ie.value,$.add(k),D.delete(k)}catch(qe){re.e(qe)}finally{re.f()}}while(Z.size>0);var ge=_createForOfIteratorHelper($.values()),Se;try{for(ge.s();!(Se=ge.n()).done;)k=Se.value,k.ladder=G,k.sheet=z,k.link=$,++G}catch(qe){ge.e(qe)}finally{ge.f()}++z}for(var Le=0;Le<e.length;++Le){for(var be=e[Le],ye=0,ce=0,ue=0;ue<be.i.length;++ue)if(this._betaPartners[be.i[ue]][0]){ye=1;break}for(var Ce=0;Ce<be.j.length;++Ce)if(this._betaPartners[be.j[Ce]][0]){ce=1;break}var Ve=StructureType$1.BRIDGE;if(be.i.length>1&&(Ve=StructureType$1.STRAND),be.type===BridgeType.PARALLEL){for(var ie=0,ae=0;ae<be.i.length;++ae)this._betaPartners[be.i[ae]][ye]={residue:be.j[ie++],ladder:be.ladder,parallel:!0};ie=0;for(var Ae=0;Ae<be.j.length;++Ae)this._betaPartners[be.j[Ae]][ce]={residue:be.i[ie++],ladder:be.ladder,parallel:!0}}else{for(var De=be.j.length-1,Be=0;Be<be.i.length;++Be)this._betaPartners[be.i[Be]][ye]={residue:be.j[De--],ladder:be.ladder,parallel:!1};De=be.i.length-1;for(var ze=0;ze<be.j.length;++ze)this._betaPartners[be.j[ze]][ce]={residue:be.i[De--],ladder:be.ladder,parallel:!1}}for(var We=be.i[0];We<=be.i[be.i.length-1];++We)this._ss[We]!==StructureType$1.STRAND&&(this._ss[We]=Ve,this._sheet[We]=be.sheet);for(var $e=be.j[0];$e<=be.j[be.j.length-1];++$e)this._ss[$e]!==StructureType$1.STRAND&&(this._ss[$e]=Ve,this._sheet[$e]=be.sheet)}}},{key:"_testBridge",value:function(e,n,r,a){var s=BridgeType.NO_BRIDGE,l=e[n-1]._index,c=e[n]._index,u=e[n+1]._index,f=r[a-1]._index,p=r[a]._index,g=r[a+1]._index,y=this._hbonds.isBond.bind(this._hbonds);return y(u,p)&&y(p,l)||y(g,c)&&y(c,f)?s=BridgeType.PARALLEL:(y(u,f)&&y(g,l)||y(p,c)&&y(c,p))&&(s=BridgeType.ANTI_PARALLEL),s}},{key:"_areBridgesLinked",value:function(e,n){var r=new Set(e.i),a=new Set(e.j),s=_createForOfIteratorHelper(n.i),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;if(r.has(c)||a.has(c))return!0}}catch(g){s.e(g)}finally{s.f()}var u=_createForOfIteratorHelper(n.j),f;try{for(u.s();!(f=u.n()).done;){var p=f.value;if(r.has(p)||a.has(p))return!0}}catch(g){u.e(g)}finally{u.f()}return!1}},{key:"_hasChainBreak",value:function(e,n){for(var r=e+1;r<=n;++r)if(this._complex._residues[r]._sequence!==this._complex._residues[r-1]._sequence+1)return!0;return!1}}]),o}();SecondaryStructureMap.StructureType=StructureType$1;var _helixClassMap,_loopMap,VOXEL_SIZE=5,StructureType=SecondaryStructureMap.StructureType,StructuralElementType$3=StructuralElement.Type,helixClassMap=(_helixClassMap={},_defineProperty(_helixClassMap,StructureType.HELIX_ALPHA,1),_defineProperty(_helixClassMap,StructureType.HELIX_PI,3),_defineProperty(_helixClassMap,StructureType.HELIX_310,5),_helixClassMap),loopMap=(_loopMap={},_defineProperty(_loopMap,StructureType.BRIDGE,StructuralElementType$3.BRIDGE),_defineProperty(_loopMap,StructureType.TURN,StructuralElementType$3.TURN),_defineProperty(_loopMap,StructureType.BEND,StructuralElementType$3.BEND),_defineProperty(_loopMap,StructureType.LOOP,StructuralElementType$3.COIL),_loopMap),Complex$9=function(){function o(){_classCallCheck(this,o),this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._residueTypes=Object.create(ResidueType$1.StandardTypes),this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[],this._molecules=[],this._maskNeedsUpdate=!1,this.metadata={},this.symmetry=[],this.units=[new BiologicalUnit(this)],this._currentUnit=0}return _createClass(o,[{key:"addAtom",value:function(e){var n=this._atoms.length;return this._atoms.push(e),n}},{key:"addSheet",value:function(e){var n=this._sheets.length;return this._sheets.push(e),n}},{key:"addHelix",value:function(e){var n=this._helices.length;return this._helices.push(e),n}},{key:"getAtoms",value:function(){return this._atoms}},{key:"getBonds",value:function(){return this._bonds}},{key:"getAtomCount",value:function(){return this._atoms.length}},{key:"addResidue",value:function(e){var n=this._residues.length;return this._residues.push(e),n}},{key:"updateToFrame",value:function(e){this.forEachChain(function(n){n.updateToFrame(e)})}},{key:"addResidueType",value:function(e){var n=this._residueTypes[e]=new ResidueType$1(e,"Unknown","");return n}},{key:"getResidueCount",value:function(){return this._residues.length}},{key:"getResidues",value:function(){return this._residues}},{key:"getSGroupCount",value:function(){return this._sgroups.length}},{key:"getSGroups",value:function(){return this._sgroups}},{key:"getAtomByFullname",value:function(e){var n=e.split(".");if(n.length!==3)return null;var r=n[0],a=parseInt(n[1],10);if(Number.isNaN(a))return null;var s=n[2].toUpperCase(),l=null;return this.forEachChain(function(c){l||c._name.localeCompare(r)===0&&c.forEachResidue(function(u){l||u._sequence===a&&u.forEachAtom(function(f){l||s.localeCompare(f.name)===0&&(l=f)})})}),l}},{key:"addChain",value:function(e){var n=new Chain$2(this,e);return this._chains.push(n),n}},{key:"getChain",value:function(e){for(var n=0,r=this._chains.length;n<r;++n){var a=this._chains[n];if(a.getName()===e)return a}return null}},{key:"getChainCount",value:function(){return this._chains.length}},{key:"getMolecules",value:function(){return this._molecules}},{key:"getMoleculeCount",value:function(){return this._molecules.length}},{key:"forEachAtom",value:function(e){for(var n=this._atoms,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"forEachBond",value:function(e){for(var n=this._bonds,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"forEachResidue",value:function(e){for(var n=this._residues,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"forEachChain",value:function(e){for(var n=this._chains,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"forEachMolecule",value:function(e){for(var n=this._molecules,r=n.length,a=0;a<r;++a)e(n[a])}},{key:"forEachSGroup",value:function(e){for(var n=this._sgroups,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"forEachComponent",value:function(e){for(var n=this._components,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"forEachVisibleComponent",value:function(e){for(var n=this._components,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"addBond",value:function(e,n,r,a,s){var l=new Bond$5(e,n,r,a,s);return this._bonds.push(l),l}},{key:"getBondCount",value:function(){return this._bonds.length}},{key:"getResidueType",value:function(e){return this._residueTypes[e]||null}},{key:"getUnifiedSerial",value:function(e,n,r){var a=65536,s=a*256;return n+r*a+e*s}},{key:"splitUnifiedSerial",value:function(e){var n=65536,r=n*256,a=Math.floor(e/r),s=e-a*r,l=Math.floor(s/n),c=s-l*n;return{chain:a,serial:c,iCode:l}}},{key:"_fillCmpEdit",value:function(){var e=this,n=this._components;function r(){var a=new Component(e);return a._index=n.length,n[a._index]=a,a}this.forEachChain(function(a){var s=a._residues,l=s.length;if(!(l<1))for(var c=r(),u=s[0]._index,f=0;f<l;++f){var p=s[f];p._component=c;var g=f===l-1?null:s[f+1];(!g||!p.isConnected(g)||p._index!==g._index-1)&&(c.setSubDivs([{start:u,end:p._index}]),g&&(u=g._index,c=r()))}})}},{key:"_fillCmpNoedit",value:function(){var e=new Component(this);e._index=0;var n=this._residues,r=n.length;if(r!==0){for(var a=[],s=0,l=0;l<r;++l){var c=n[l];c._component=e;var u=l===r-1?null:n[l+1];(!u||!c.isConnected(u))&&(a[a.length]={start:s,end:l},u&&(s=l+1))}e.setSubDivs(a),this._components[e._index]=e}}},{key:"_fillComponents",value:function(e){e?this._fillCmpEdit():this._fillCmpNoedit()}},{key:"getCurrentUnit",value:function(){return this._currentUnit}},{key:"getDefaultBoundaries",value:function(){return this.units[0].getBoundaries()}},{key:"getBoundaries",value:function(){return this.units[this._currentUnit].getBoundaries()}},{key:"getTransforms",value:function(){return this.units[this._currentUnit].getTransforms()}},{key:"getSelector",value:function(){return this.units[this._currentUnit].getSelector()}},{key:"resetCurrentUnit",value:function(){this._currentUnit=0,this.setCurrentUnit(1)}},{key:"setCurrentUnit",value:function(e){return e!=null&&e!==this._currentUnit&&e>=0&&e<this.units.length?(this._currentUnit=e,!0):!1}},{key:"_computeBounds",value:function(){for(var e=this.units,n=0,r=e.length;n<r;++n)e[n].computeBoundaries()}},{key:"onAtomPositionChanged",value:function(){this.forEachChain(function(e){e._finalize()}),this.forEachComponent(function(e){e.update()}),this._computeBounds(),this._finalizeBonds(),this.forEachSGroup(function(e){e._rebuildSGroupOnAtomChange()})}},{key:"update",value:function(){this._maskNeedsUpdate&&(this.updateStructuresMask(),this._maskNeedsUpdate=!1)}},{key:"_finalizeBonds",value:function(){for(var e=this.getBonds(),n=e.length,r=0;r<n;++r)e[r]._index=r}},{key:"finalize",value:function(e){e=e||{};var n=this._bonds,r,a;for(r=n.length-1;r>=0;r--){var s=n[r];s._left===null||s._right===null?n.splice(r,1):(s._left.bonds.push(s),s._right.bonds.push(s))}var l=this._residues;for(r=0,a=l.length;r<a;++r)l[r]._finalize();this.forEachChain(function(M){M._finalize()});var c=this.units;for(r=0,a=c.length;r<a;++r)c[r].finalize();this.setCurrentUnit(1);var u={};for(r=0,a=l.length;r<a;++r){var f=l[r];u[this.getUnifiedSerial(f.getChain().getName().charCodeAt(0),f.getSequence(),f.getICode().charCodeAt(0))]=f}var p=this.structures;for(r=0,a=p.length;r<a;++r)p[r]._finalize(e.serialAtomMap,u,this);var g=this._helices;for(r=0,a=g.length;r<a;++r)g[r]._finalize(e.serialAtomMap,u,this);var y=this._sheets;for(r=0,a=y.length;r<a;++r)y[r]._finalize(e.serialAtomMap,u,this);this._computeBounds();var E=this._atoms;for(r=0,a=E.length;r<a;++r){var h=E[r];h.index=r}if(e.needAutoBonding){var v=new AutoBond(this);v.build(),v.destroy()}var C=this._chains;for(r=0,a=C.length;r<a;++r)C[r]._index=r;for(r=0,a=l.length;r<a;++r)l[r]._index=r;for(r=0,a=E.length;r<a;++r){var x=E[r];if(x.flags&Atom$2.Flags.HYDROGEN&&x.bonds.length===1){var w=x.bonds[0],_=w._left!==x&&w._left||w._right;_.flags&Atom$2.Flags.CARBON&&(x.flags|=Atom$2.Flags.NONPOLARH)}}this._finalizeBonds(),this._fillComponents(e.enableEditing);var S=new AromaticLoopsMarker(this);S.markCycles(),e.detectAromaticLoops&&S.detectCycles(),this._finalizeMolecules()}},{key:"_finalizeMolecules",value:function(){for(var e=0;e<this._molecules.length;e++)for(var n=this._molecules[e],r=n.residues.length,a=0;a<r;a++){var s=n.residues[a];s._molecule=n}}},{key:"updateStructuresMask",value:function(){var e=function(r){return r.collectMask()};this.forEachResidue(e),this.forEachChain(e),this.forEachMolecule(e)}},{key:"countAtomsByMask",value:function(e){var n=0;return this.forEachAtom(function(r){r.mask&e&&n++}),n}},{key:"getNumAtomsBySelector",value:function(e){var n=0;return this.forEachAtom(function(r){e.includesAtom(r)&&n++}),n}},{key:"resetAtomMask",value:function(e){this.forEachAtom(function(n){n.mask=e})}},{key:"markAtoms",value:function(e,n){var r=n,a=~r,s=0,l=selectors$5.keyword("And")(e,this.getSelector());return this.forEachAtom(function(c){l.includesAtom(c)?(c.mask|=r,s++):c.mask&=a}),this._maskNeedsUpdate=!0,s}},{key:"markAtomsAdditionally",value:function(e,n){var r=n,a=0;return this.forEachAtom(function(s){e.includesAtom(s)&&(s.mask&n)!==n&&(s.mask|=r,a++)}),a}},{key:"clearAtomBits",value:function(e){var n=~e;this.forEachAtom(function(a){a.mask&=n});var r=function(s){s._mask&=n};this.forEachAtom(r),this.forEachResidue(r),this.forEachChain(r),this.forEachMolecule(r)}},{key:"getAtomNames",value:function(){if(this.hasOwnProperty("_atomNames"))return this._atomNames;var e={};return this.forEachAtom(function(n){e[n.name]=1}),this._atomNames=Object.keys(e),this._atomNames}},{key:"getElements",value:function(){if(this.hasOwnProperty("_elements"))return this._elements;var e={};return this.forEachAtom(function(n){e[n.element.name]=1}),this._elements=Object.keys(e),this._elements}},{key:"getResidueNames",value:function(){if(this.hasOwnProperty("_residueNames"))return this._residueNames;var e={};return this.forEachResidue(function(n){e[n._type._name]=1}),this._residueNames=Object.keys(e),this._residueNames}},{key:"getChainNames",value:function(){if(this.hasOwnProperty("_chainNames"))return this._chainNames;var e={};return this.forEachChain(function(n){e[n._name]=1}),this._chainNames=Object.keys(e),this._chainNames}},{key:"getAltLocNames",value:function(){if(this.hasOwnProperty("_altlocNames"))return this._altlocNames;var e={};return this.forEachAtom(function(n){e[String.fromCharCode(n.location)]=1}),this._altlocNames=Object.keys(e),this._altlocNames}},{key:"getVoxelWorld",value:function(){if(!this.hasOwnProperty("_voxelWorld"))try{this._voxelWorld=new VoxelWorld(this.getDefaultBoundaries().boundingBox,new Vector3(VOXEL_SIZE,VOXEL_SIZE,VOXEL_SIZE)),this._voxelWorld.addAtoms(this)}catch{logger.warn("Unable to create voxel world"),this._voxelWorld=null}return this._voxelWorld}},{key:"addElement",value:function(e,n,r,a){for(var s=e.length,l=0;l<s;++l){var c=e[l];a(c,r),n.push(c)}}},{key:"joinComplexes",value:function(e){this._chains=[],this._components=[],this._helices=[],this._sheets=[],this.structures=[],this._atoms=[],this._residues=[],this._bonds=[],this._sgroups=[];var n=this,r=0,a=0,s=0,l=0,c=0;function u(x,w){x.serial+=w,x.index+=w}function f(x,w){x._index+=w}function p(x,w){x._index+=w}function g(x,w){x._complex=n,x._index+=w}function y(x,w){x._complex=n,x._index+=w}function E(){}for(var h=0;h<e.length;++h){var v=e[h];this.addElement(v._atoms,this._atoms,r,u),this.addElement(v._bonds,this._bonds,a,f),this.addElement(v._residues,this._residues,s,p),this.addElement(v._chains,this._chains,l,g),this.addElement(v._sheets,this._sheets,0,E),this.addElement(v._helices,this._helices,0,E),this.addElement(v._sgroups,this._sgroups,0,E),this.addElement(v._components,this._components,c,y),this.addElement(v.structures,this.structures,0,E);for(var C in v._residueTypes)v._residueTypes.hasOwnProperty(C)&&(this._residueTypes[C]=v._residueTypes[C]);r+=v._atoms.length,a+=v._bonds.length,s+=v._residues.length,l+=v._chains.length,c+=v._components.length}this._computeBounds()}},{key:"dssp",value:function(){for(var e=new SecondaryStructureMap(this),n=this.structures=[],r=this._helices=[],a=this._sheets=[],s=function(_){var S=a[_];return S||(S=a[_]=new Sheet$3(String(_),0)),S},l,c,u=0,f=null,p=0,g=this._residues.length;p<g;++p){var y=e._ss[p],E=this._residues[p],h=e._sheet[p];if(y===l&&h===c){E._secondary=f,f&&(f.term=E),f instanceof Helix$3&&f.length++;continue}var v=helixClassMap[y],C=loopMap[y];if(y===StructureType.STRAND){var x=s(h);f=new Strand$3(x,E,E,0,null,null),x.addStrand(f)}else v!==void 0?(u++,f=new Helix$3(v,E,E,u,String(u),"",1),r.push(f)):C!==void 0?f=new StructuralElement(C,E,E):f=null;f&&n.push(f),E._secondary=f,l=y,c=h}this._sheets=a.filter(function(w){return!0})}}]),o}();Complex$9.prototype.id="Complex";Complex$9.prototype.name="";function pow2ceil(o){var t=2;for(o=o-1>>1;o;)t<<=1,o>>=1;return t}var Volume$2=function(){function o(t,e,n,r,a,s){if(_classCallCheck(this,o),this._box=n.clone(),this._dimVec=Math.max(Math.floor(r||1),1),this._volumeInfo=s,e instanceof Array){var l=_slicedToArray(e,3);this._dimX=l[0],this._dimY=l[1],this._dimZ=l[2]}else this._dimX=e.x,this._dimY=e.y,this._dimZ=e.z;switch(this._dimX=Math.max(Math.floor(this._dimX),1),this._dimY=Math.max(Math.floor(this._dimY),1),this._dimZ=Math.max(Math.floor(this._dimZ),1),this._rowElements=this._dimVec*this._dimX,this._planeElements=this._rowElements*this._dimY,this._totalElements=this._planeElements*this._dimZ,this._data=a||utils.allocateTyped(t,this._totalElements),this._dimVec){case 1:break;case 2:this.getValue=function(c,u,f){var p=c*this._dimVec+u*this._rowElements+f*this._planeElements;return[this._data[p],this._data[p+1]]},this.setValue=function(c,u,f,p,g){var y=c*this._dimVec+u*this._rowElements+f*this._planeElements;this._data[y]=p,this._data[y+1]=g},this.addValue=function(c,u,f,p,g){var y=c*this._dimVec+u*this._rowElements+f*this._planeElements;this._data[y]+=p,this._data[y+1]+=g};break;case 3:this.getValue=function(c,u,f){var p=c*this._dimVec+u*this._rowElements+f*this._planeElements;return[this._data[p],this._data[p+1],this._data[p+2]]},this.setValue=function(c,u,f,p,g,y){var E=c*this._dimVec+u*this._rowElements+f*this._planeElements;this._data[E]=p,this._data[E+1]=g,this._data[E+2]=y},this.addValue=function(c,u,f,p,g,y){var E=c*this._dimVec+u*this._rowElements+f*this._planeElements;this._data[E]+=p,this._data[E+1]+=g,this._data[E+2]+=y};break;default:throw new Error("Volume: invalid vector dimension")}}return _createClass(o,[{key:"getValue",value:function(e,n,r){return this._data[e+n*this._rowElements+r*this._planeElements]}},{key:"setValue",value:function(e,n,r,a){this._data[e+n*this._rowElements+r*this._planeElements]=a}},{key:"addValue",value:function(e,n,r,a){this._data[e+n*this._rowElements+r*this._planeElements]+=a}},{key:"getDimensions",value:function(){return[this._dimX,this._dimY,this._dimZ]}},{key:"getBox",value:function(){return this._box}},{key:"getVolumeInfo",value:function(){return this._volumeInfo}},{key:"getCellSize",value:function(){var e=new Vector3;this._box.getSize(e);var n=new Vector3;return n.x=this._dimX>1?e.x/(this._dimX-1):0,n.y=this._dimY>1?e.y/(this._dimY-1):0,n.z=this._dimZ>1?e.z/(this._dimZ-1):0,n}},{key:"computeGradient",value:function(){if(this._dimVec!==1)return null;var e=new o(Float32Array,[this._dimX,this._dimY,this._dimZ],this._box,3),n=this.getCellSize(),r=new Vector3(-.5/n.x,-.5/n.y,-.5/n.z);function a(_,S,M){return Math.min(M,Math.max(S,_))}var s=this._dimX,l=this._dimY,c=this._dimZ,u=this._data;function f(_,S,M){return u[M*s*l+S*s+_]}for(var p=0;p<c;++p)for(var g=a(p-1,0,c-1),y=a(p+1,0,c-1),E=0;E<l;++E)for(var h=a(E-1,0,l-1),v=a(E+1,0,l-1),C=0;C<s;++C){var x=a(C-1,0,s-1),w=a(C+1,0,s-1);e.setValue(C,E,p,(f(w,E,p)-f(x,E,p))*r.x,(f(C,v,p)-f(C,h,p))*r.y,(f(C,E,y)-f(C,E,g))*r.z)}return e}},{key:"normalize",value:function(){for(var e=this._data,n=e[0],r=e[0],a=1;a<e.length;++a)n=Math.min(n,e[a]),r=Math.max(r,e[a]);var s=1/(r-n);if(s!==0)for(var l=0;l<e.length;++l)e[l]=s*(e[l]-n)}},{key:"getTiledTextureStride",value:function(){return[this._dimX+2,this._dimY+2]}},{key:"buildTiledTexture",value:function(){var e=Math.ceil(Math.sqrt(this._dimZ*this._dimY/this._dimX)),n=e*(this._dimX+2)-1;n=pow2ceil(n),e=Math.floor(n/(this._dimX+2));var r=Math.ceil(this._dimZ/e),a=r*(this._dimY+2)-1;a=pow2ceil(a);for(var s=new Uint8Array(n*a),l,c,u=0;u<r;++u)for(var f=0;f<this._dimY;++f){l=u*e*this._planeElements+f*this._rowElements,c=n*(u*(this._dimY+2)+f);for(var p=0;p<e;++p){for(var g=0;g<this._dimX;++g)s[c++]=255*this._data[l++];s[c++]=255*this._data[l-1],p<e-1&&(l+=this._planeElements-this._rowElements,s[c++]=255*this._data[l])}}for(var y=0;y<r;++y){l=n*(y*(this._dimY+2)+this._dimY-1),c=l+n;for(var E=0;E<n;++E)s[c++]=s[l++];if(y<r-1){l=n*(y+1)*(this._dimY+2),c=l-n;for(var h=0;h<n;++h)s[c++]=s[l++]}}var v=new DataTexture(s,n,a,LuminanceFormat,UnsignedByteType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearFilter);return v.needsUpdate=!0,v}},{key:"getData",value:function(){return this._data}},{key:"getDirectIdx",value:function(e,n,r){return e*this._dimVec+n*this._rowElements+r*this._planeElements}},{key:"getStrideX",value:function(){return this._dimVec}},{key:"getStrideY",value:function(){return this._rowElements}},{key:"getStrideZ",value:function(){return this._planeElements}}]),o}();Volume$2.prototype.id="Volume";var Molecule$8=function(){function o(t,e,n){_classCallCheck(this,o),this.complex=t,this.name=e||"",this.residues=[],this.mask=1,this.index=n||-1}return _createClass(o,[{key:"forEachResidue",value:function(e){for(var n=this.residues,r=0,a=n.length;r<a;++r)e(n[r])}},{key:"collectMask",value:function(){for(var e=4294967295,n=this.residues,r=0,a=n.length;r<a;++r)e&=n[r]._mask;this.mask=e}}]),o}(),chem={Atom:Atom$2,Element:Element$a,Bond:Bond$5,Residue:Residue$1,ResidueType:ResidueType$1,Chain:Chain$2,Helix:Helix$3,Strand:Strand$3,Sheet:Sheet$3,SGroup:SGroup$1,Assembly:Assembly$3,Complex:Complex$9,Volume:Volume$2,VoxelWorld,selectors:selectors$5,Molecule:Molecule$8};function _createSuper$1V(o){var t=_isNativeReflectConstruct$1V();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1V(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CSS2DObject=function(o){_inherits(e,o);var t=_createSuper$1V(e);function e(n){var r;_classCallCheck(this,e),r=t.call(this);var a=_assertThisInitialized(r);return r._element=n,r._element.style.position="absolute",r.addEventListener("removed",function(){a._element.parentNode!==null&&a._element.parentNode.removeChild(a._element)}),r}return _createClass(e,[{key:"getElement",value:function(){return this._element}},{key:"setTransparency",value:function(r){var a=this.getElement();if(a!==null){if(r===1){a.style.display="none";return}a.style.display="inline";var s=1-r,l=s.toString(),c=s*100;a.style.opacity=l,a.style.filter="alpha(opacity=".concat(c,")")}}},{key:"clone",value:function(){var r=new e(this._element);return r.copy(this),r}}]),e}(Object3D);function _createSuper$1U(o){var t=_isNativeReflectConstruct$1U();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1U(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var RCGroup=function(o){_inherits(e,o);var t=_createSuper$1U(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"raycast",value:function(r,a){if(this.visible)for(var s=this.children,l=0,c=s.length;l<c;++l)s[l].raycast(r,a)}},{key:"enableSubset",value:function(r,a){for(var s=this.children,l=0,c=s.length;l<c;++l)s[l].enableSubset&&s[l].enableSubset(r,a)}},{key:"disableSubset",value:function(r,a){for(var s=this.children,l=0,c=s.length;l<c;++l)s[l].disableSubset&&s[l].disableSubset(r,a)}},{key:"isEmpty",value:function(){return this.children.length===0}},{key:"updateToFrame",value:function(r){for(var a=this.children,s=0,l=a.length;s<l;++s)a[s].updateToFrame&&a[s].updateToFrame(r)}},{key:"getSubset",value:function(r,a){for(var s=[],l=this.children,c=0,u=l.length;c<u;++c)l[c].getSubset&&Array.prototype.push.apply(s,l[c].getSubset(r,a));return s}}]),e}(Group),vertexScreenQuadShader=`uniform mat4 projectionMatrix;\r
uniform mat4 modelViewMatrix;\r
\r
attribute vec2 uv;\r
attribute vec3 position;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
  vUv = uv;\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r
}\r
`,fragmentScreenQuadFromTex=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform float opacity;\r
\r
void main() {\r
  vec4 color = texture2D(srcTex, vUv);\r
  gl_FragColor = vec4(color.xyz, color.a * opacity);\r
}\r
`,fragmentScreenQuadFromTexWithDistortion=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform float coef;\r
\r
void main() {\r
  vec2 uv = vUv * 2.0 - 1.0;\r
  float r2 = dot(uv, uv);\r
  vec2 tc = uv * (1.0 + coef * r2);\r
  if (!all(lessThan(abs(tc), vec2(1.0))))\r
    discard;\r
  tc = 0.5 * (tc + 1.0);\r
  gl_FragColor = texture2D(srcTex, tc);\r
}\r
`;function _createSuper$1T(o){var t=_isNativeReflectConstruct$1T();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LAYERS={DEFAULT:0,VOLUME:1,TRANSPARENT:2,PREPASS_TRANSPARENT:3,VOLUME_BFPLANE:4,COLOR_FROM_POSITION:5,SHADOWMAP:6},SELECTION_LAYERS=[LAYERS.DEFAULT,LAYERS.TRANSPARENT];Object3D.prototype.resetTransform=function(){this.position.set(0,0,0),this.quaternion.set(0,0,0,1),this.scale.set(1,1,1)};Object3D.prototype.updateMatrixWorldRecursive=function(){this.parent!=null&&this.parent.updateMatrixWorldRecursive(),this.updateMatrixWorld()};Object3D.prototype.addSavingWorldTransform=function(){var o=new Matrix4;return function(t){t instanceof Object3D&&(o.copy(this.matrixWorld).invert(),o.multiply(t.matrixWorld),t.matrix.copy(o),t.matrix.decompose(t.position,t.quaternion,t.scale),this.add(t))}}();WebGLRenderer.prototype.renderDummyQuad=function(){var o=new MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1}),t=new Scene,e=new Mesh(new PlaneGeometry(.01,.01),o);t.add(e);var n=new OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4);return n.position.z=100,function(){this.render(t,n)}}();WebGLRenderer.prototype.renderScreenQuad=function(){var o=new Scene,t=new Mesh(new PlaneGeometry(1,1));o.add(t);var e=new OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4);return e.position.z=100,function(n){t.material=n,this.render(o,e)}}();Matrix4.prototype.isIdentity=function(){var o=new Matrix4;return function(){return o.equals(this)}}();Matrix4.prototype.applyToPointsArray=function(o,t,e){if(!o||!t||t<3)return o;e=e||0;for(var n=this.elements,r=0;r<o.length;r+=t){var a=o[r],s=o[r+1],l=o[r+2],c=1/(n[3]*a+n[7]*s+n[11]*l+n[15]);o[r]=(n[0]*a+n[4]*s+n[8]*l+n[12]*e)*c,o[r+1]=(n[1]*a+n[5]*s+n[9]*l+n[13]*e)*c,o[r+2]=(n[2]*a+n[6]*s+n[10]*l+n[14]*e)*c}return o};var ScreenQuadMaterial=function(o){_inherits(e,o);var t=_createSuper$1T(e);function e(n){return _classCallCheck(this,e),n.uniforms===void 0&&(n.uniforms={}),n.uniforms.srcTex={type:"t",value:null},n.vertexShader=vertexScreenQuadShader,n.transparent=!1,n.depthTest=!1,n.depthWrite=!1,t.call(this,n)}return _createClass(e)}(RawShaderMaterial);WebGLRenderer.prototype.renderScreenQuadFromTex=function(){var o=new ScreenQuadMaterial({uniforms:{opacity:{type:"f",value:1}},fragmentShader:fragmentScreenQuadFromTex,transparent:!0});return function(t,e){o.uniforms.srcTex.value=t,o.transparent=e<1,o.uniforms.opacity.value=e,this.renderScreenQuad(o)}}();WebGLRenderer.prototype.renderScreenQuadFromTexWithDistortion=function(){var o=new ScreenQuadMaterial({uniforms:{coef:{type:"f",value:1}},fragmentShader:fragmentScreenQuadFromTexWithDistortion});return function(t,e){o.uniforms.srcTex.value=t,o.uniforms.coef.value=e,this.renderScreenQuad(o)}}();PerspectiveCamera.prototype.setMinimalFov=function(o){this.aspect>=1?this.fov=o:this.fov=MathUtils.radToDeg(2*Math.atan(Math.tan(MathUtils.degToRad(o)*.5)/this.aspect))};StereoCamera.prototype.updateHalfSized=function(o,t){var e=o.aspect,n=o.fov;o.aspect=e/2,o.setMinimalFov(t),o.updateProjectionMatrix(),this.update(o),o.aspect=e,o.fov=n,o.updateProjectionMatrix()};PerspectiveCamera.prototype.setDistanceToFit=function(o,t){this.position.z=o/Math.sin(.5*MathUtils.degToRad(t))};Raycaster.prototype.intersectVisibleObject=function(o,t,e,n){var r=this.intersectObject(o,!1);if(r.length===0)return null;var a=Math.min(t.near,e),s,l=r[0],c=new Vector3;for(s=0;s<r.length&&(l=r[s],c.copy(l.point),c.applyMatrix4(t.matrixWorldInverse),!(c.z<=-a));++s);if(s===r.length)return null;var u=Math.min(t.far,n);return c.copy(l.point),c.applyMatrix4(t.matrixWorldInverse),c.z<=-u?null:l};Matrix4.prototype.extractScale=function(){var o=new Vector3;return function(t){t===void 0&&(logger.debug("extractScale(): new is too expensive operation to do it on-the-fly"),t=o.clone());var e=this.elements;t.x=o.set(e[0],e[1],e[2]).length(),t.y=o.set(e[4],e[5],e[6]).length(),t.z=o.set(e[8],e[9],e[10]).length();var n=this.determinant();return n<0&&(t.x=-t.x),t}}();function _calcCylinderMatrix(o,t,e){var n=o.clone().lerp(t,.5),r=new Matrix4;r.makeScale(e,o.distanceTo(t),e);var a=new Matrix4;a.makeRotationX(Math.PI/2);var s=new Matrix4,l=new Vector3(0,1,0);return s.lookAt(n,t,l),s.multiply(a),s.multiply(r),s.setPosition(n),s}function _calcChunkMatrix(o,t,e,n){var r=new Matrix4;r.makeScale(n.x,n.y,0);var a=new Matrix4;return a.lookAt(o,t,e),a.multiply(r),a.setPosition(o),a}function _groupHasGeometryToRender(o){var t=!1;return o.traverse(function(e){(e.hasOwnProperty("geometry")||e instanceof CSS2DObject)&&(t=!0)}),t}function _buildDistorionMesh(o,t,e){function n(f){for(var p=1e-5,g=0,y=f,E=1;Math.abs(y-g)>p;)E=1+e*y,g=y,y=f/(E*E);return 1/E}for(var r=new PlaneGeometry(2,2,o,t),a=r.getAttribute("position"),s=0;s<a.count;++s){var l=a.array[3*s],c=a.array[3*s+1],u=n(l*l+c*c);a.setXY(s,u*l,u*c)}return r}BufferAttribute.prototype.copyAtList=function(o,t){console.assert(this.itemSize===o.itemSize,"false: BufferAttribute.copyAtList buffers have different item size.");for(var e=this.itemSize,n=0,r=t.length;n<r;++n)for(var a=0;a<e;++a)this.array[n*e+a]=o.array[t[n]*e+a];return this};function fillArray(o,t,e,n){e=typeof e<"u"?e:0,n=typeof n<"u"?n:o.length;for(var r=e;r<n;++r)o[r]=t}function removeChildren(o){for(var t=o.children,e=0,n=t.length;e<n;++e){var r=t[e];r.parent=null,r.dispatchEvent({type:"removed"})}o.children=[]}function clearTree(o){o.traverse(function(t){(t instanceof Mesh||t instanceof LineSegments||t instanceof Line)&&t.geometry.dispose()}),removeChildren(o)}function destroyObject(o){clearTree(o),o.parent?o.parent.remove(o):o.dispatchEvent({type:"removed"})}function belongToSelectLayers(o){for(var t=0;t<SELECTION_LAYERS.length;t++)if((o.layers.mask>>SELECTION_LAYERS[t]&1)===1)return!0;return!1}function processObjRenderOrder(o,t){var e=+(t!=="BA");o.traverse(function(n){n.isGroup&&(n.renderOrder=e)})}function applySelectionMaterial(o){o.traverse(function(t){"material"in t&&(t.material=t.material.clone(!0),t.material.setValues({depthFunc:LessEqualDepth,overrideColor:!0,fog:!1,lights:!1,shadowmap:!1}),t.material.setUberOptions({fixedColor:new Color(16776960),zOffset:-1e-6}))})}function getMiddlePoint(o,t,e){var n=e||new Vector3;return n.set(0,0,0),n.addScaledVector(o,.5),n.addScaledVector(t,.5),n}var _oldInstancedBufferGeometryCopy=InstancedBufferGeometry.prototype.copy;InstancedBufferGeometry.prototype.copy=function(o){_oldInstancedBufferGeometryCopy.call(this,o),this.instanceCount===void 0&&(this.instanceCount=1/0)};var gfxutils={calcCylinderMatrix:_calcCylinderMatrix,calcChunkMatrix:_calcChunkMatrix,groupHasGeometryToRender:_groupHasGeometryToRender,buildDistorionMesh:_buildDistorionMesh,RCGroup,fillArray,clearTree,destroyObject,belongToSelectLayers,processObjRenderOrder,applySelectionMaterial,getMiddlePoint,LAYERS};function _createSuper$1S(o){var t=_isNativeReflectConstruct$1S();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _defaultBoundaries={boundingBox:new Box3(new Vector3(-1,-1,-1),new Vector3(1,1,1)),boundingSphere:new Sphere(new Vector3(0,0,0),1)},Visual=function(o){_inherits(e,o);var t=_createSuper$1S(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a.name=n,a._dataSource=r,a}return _createClass(e,[{key:"release",value:function(){this.parent&&this.parent.remove(this)}},{key:"getDataSource",value:function(){return this._dataSource}},{key:"getBoundaries",value:function(){return _defaultBoundaries}}]),e}(gfxutils.RCGroup);function _arrayWithoutHoles(o){if(Array.isArray(o))return _arrayLikeToArray$1(o)}function _iterableToArray(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _toConsumableArray(o){return _arrayWithoutHoles(o)||_iterableToArray(o)||_unsupportedIterableToArray$1(o)||_nonIterableSpread()}function _ensureArray(o){return o==null||Array.isArray(o)?o:[o]}var EntityList=function(){function o(){var t=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["id"];_classCallCheck(this,o),this._list=[],this._dict={},this._indices=_toConsumableArray(n),this._indices.forEach(function(r){t._dict[r]={}}),e.forEach(function(r){return t.register(r)})}return _createClass(o,[{key:"register",value:function(e){var n=this;o.registerInList(this._list,e),this._indices.forEach(function(r){o.registerInDict(n._dict[r],_ensureArray(e[r]),e)})}},{key:"unregister",value:function(e){var n=this;o.unregisterFromList(this._list,e),this._indices.forEach(function(r){o.unregisterFromDict(n._dict[r],_ensureArray(e[r]),e)})}},{key:"all",get:function(){return _toConsumableArray(this._list)}},{key:"first",get:function(){return this._list[0]}},{key:"keys",value:function(e){return Object.keys(this._dict[e||this._indices[0]])}},{key:"get",value:function(e,n){var r=this._dict[n||this._indices[0]];if(r){var a=r[e&&e.toLowerCase()];return a&&a.length>0?a[0]:void 0}}}],[{key:"registerInList",value:function(e,n){e.includes(n)||e.push(n)}},{key:"unregisterFromList",value:function(e,n){var r=e.indexOf(n);r!==-1&&e.splice(r,1)}},{key:"registerInDict",value:function(e,n,r){n.forEach(function(a){a=a.toLowerCase();var s=e[a]=e[a]||[];s.includes(r)||s.push(r)})}},{key:"unregisterFromDict",value:function(e,n,r){n.forEach(function(a){a=a.toLowerCase();var s=e[a];if(s){var l=s.indexOf(r);l!==-1&&s.splice(l,1),s.length===0&&delete e[a]}})}}]),o}();function makeContextDependent(o){Object.defineProperties(o,{logger:{get:function(){return this.context&&this.context.logger?this.context.logger:logger}},settings:{get:function(){return this.context&&this.context.settings?this.context.settings:settings$1}}})}function _createSuper$1R(o){var t=_isNativeReflectConstruct$1R();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CollisionSphere=function(){function o(t,e){_classCallCheck(this,o),this._position=t,this._radius=e}return _createClass(o,[{key:"raycast",value:function(e){var n=o._sphere;n.set(this._position,this._radius);var r=new Vector3;return e.ray.intersectSphere(n,r)?{distance:e.ray.origin.distanceTo(r),point:r}:null}}]),o}();_defineProperty(CollisionSphere,"_sphere",new Sphere);var SphereCollisionGeo=function(t){return function(e){_inherits(r,e);var n=_createSuper$1R(r);function r(a){var s;_classCallCheck(this,r);for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];return s=n.call.apply(n,[this].concat(c)),s._objects=new Array(a),s.boundingSphere=null,s.boundingBox=null,s}return _createClass(r,[{key:"setSphere",value:function(s,l,c){this._objects[s]=new CollisionSphere(l,c)}},{key:"raycast",value:function(s,l){for(var c=0,u=this._objects.length;c<u;++c){var f=this._objects[c].raycast(s);f&&(f.chunkIdx=c,l.push(f))}}},{key:"computeBoundingBox",value:function(){var s=this._objects,l=this.boundingBox;l===null&&(this.boundingBox=l=new Box3),l.makeEmpty();for(var c=0,u=s.length;c<u;++c)l.expandByPoint(s[c]._position)}},{key:"computeBoundingSphere",value:function(){this.computeBoundingBox();var s=this._objects,l=this.boundingBox,c=0,u=new Vector3;l.getCenter(u);for(var f=0,p=s.length;f<p;++f){var g=s[f]._position,y=u.distanceToSquared(g);c<y&&(c=y)}this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.set(u,Math.sqrt(c))}}]),r}(t)};function _createSuper$1Q(o){var t=_isNativeReflectConstruct$1Q();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1Q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tmpColor$4=new Color,OFFSET_SIZE$1=4,COLOR_SIZE$3=3,copySubArrays$1=utils.copySubArrays;function setArrayXYZ$2(o,t,e,n,r){o[t]=e,o[t+1]=n,o[t+2]=r}function setArrayXYZW$2(o,t,e,n,r,a){o[t]=e,o[t+1]=n,o[t+2]=r,o[t+3]=a}var InstancedSpheresGeometry=function(o){_inherits(e,o);var t=_createSuper$1Q(e);function e(n,r,a){var s;return _classCallCheck(this,e),s=t.call(this,n),s._sphGeometry=a?new PlaneGeometry(2,2,1,1):new SphereGeometry(1,r*2,r,0,Math.PI*2,0,Math.PI),s._init(n,s._sphGeometry),s}return _createClass(e,[{key:"setItem",value:function(r,a,s){setArrayXYZW$2(this._offsets,r*OFFSET_SIZE$1,a.x,a.y,a.z,s),this.setSphere(r,a,s)}},{key:"setColor",value:function(r,a){tmpColor$4.set(a),setArrayXYZ$2(this._colors,r*COLOR_SIZE$3,tmpColor$4.r,tmpColor$4.g,tmpColor$4.b)}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("offset").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(r,a){for(var s=this._alpha,l=0,c=r.length;l<c;++l)s[r[l]]=a;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(r){var a=r.length,s=new InstancedBufferGeometry;return this._init.call(s,a,this._sphGeometry),copySubArrays$1(this._offsets,s._offsets,r,OFFSET_SIZE$1),copySubArrays$1(this._colors,s._colors,r,COLOR_SIZE$3),s.boundingSphere=this.boundingSphere,s.boundingBox=this.boundingBox,[s]}},{key:"_init",value:function(r,a){this.copy(a),this._offsets=utils.allocateTyped(Float32Array,r*OFFSET_SIZE$1),this._colors=utils.allocateTyped(Float32Array,r*COLOR_SIZE$3);var s=this._alpha=utils.allocateTyped(Float32Array,r);lodashExports.fill(s,1),this.setAttribute("offset",new InstancedBufferAttribute(this._offsets,OFFSET_SIZE$1,!1,1)),this.setAttribute("color",new InstancedBufferAttribute(this._colors,COLOR_SIZE$3,!1,1)),this.setAttribute("alphaColor",new InstancedBufferAttribute(s,1,!1,1))}}]),e}(SphereCollisionGeo(InstancedBufferGeometry));function _createSuper$1P(o){var t=_isNativeReflectConstruct$1P();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MAX_IDC_16BIT$1=65535,VEC_SIZE$4=3,tmpColor$3=new Color,ChunkedObjectsGeometry=function(o){_inherits(e,o);var t=_createSuper$1P(e);function e(n,r){var a;if(_classCallCheck(this,e),a=t.call(this),a.constructor===e)throw new Error("Can not instantiate abstract class!");return a._chunkGeo=n,a._init(n,r),a}return _createClass(e,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("normal").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0}},{key:"setColor",value:function(r,a){tmpColor$3.set(a);for(var s=this._colors,l=this._chunkSize,c=r*l,u=c+l;c<u;++c){var f=c*VEC_SIZE$4;s[f]=tmpColor$3.r,s[f+1]=tmpColor$3.g,s[f+2]=tmpColor$3.b}}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(r,a){for(var s=this._alpha,l=this._chunkSize,c=0,u=r.length;c<u;++c){var f=r[c]*l;lodashExports.fill(s,a,f,f+l)}this.getAttribute("alphaColor").needsUpdate=!0}},{key:"raycast",value:function(r,a){var s=[],l=new Mesh;l.geometry=this,l.raycast(r,s);for(var c=this._chunkGeo.index.count/3,u=0,f=s.length;u<f;++u)s[u].hasOwnProperty("faceIndex")&&(s[u].chunkIdx=Math.floor(s[u].faceIndex/c),a.push(s[u]))}},{key:"getSubset",value:function(r){var a=r.length,s=new BufferGeometry;this._init.call(s,this._chunkGeo,a);for(var l=this._positions,c=this._normals,u=this._colors,f=s._positions,p=s._normals,g=s._colors,y=this._chunkSize*VEC_SIZE$4,E=0,h=r.length;E<h;++E){var v=E*y,C=r[E]*y,x=C+y;f.set(l.subarray(C,x),v),p.set(c.subarray(C,x),v),g.set(u.subarray(C,x),v)}return s.boundingSphere=this.boundingSphere,s.boundingBox=this.boundingBox,[s]}},{key:"_init",value:function(r,a){var s=this._chunkSize=r.attributes.position.count,l=r.index.array,c=l.length,u=this._chunkSize*a,f=u>MAX_IDC_16BIT$1,p=c*a,g=this._index=utils.allocateTyped(f?Uint32Array:Uint16Array,p);this._positions=utils.allocateTyped(Float32Array,u*VEC_SIZE$4),this._normals=utils.allocateTyped(Float32Array,u*VEC_SIZE$4),this._colors=utils.allocateTyped(Float32Array,u*VEC_SIZE$4);var y=this._alpha=utils.allocateTyped(Float32Array,u);lodashExports.fill(y,1);for(var E=0;E<a;++E){var h=E*c,v=E*s;g.set(l,h);for(var C=0;C<c;++C)g[h+C]+=v}this.setIndex(new BufferAttribute(this._index,1)),this.setAttribute("position",new BufferAttribute(this._positions,VEC_SIZE$4)),this.setAttribute("normal",new BufferAttribute(this._normals,VEC_SIZE$4)),this.setAttribute("color",new BufferAttribute(this._colors,VEC_SIZE$4)),this.setAttribute("alphaColor",new BufferAttribute(y,1))}}]),e}(BufferGeometry);function _createSuper$1O(o){var t=_isNativeReflectConstruct$1O();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VEC_SIZE$3=3,SimpleSpheresGeometry=function(o){_inherits(e,o);var t=_createSuper$1O(e);function e(n,r){var a;_classCallCheck(this,e);var s=new SphereGeometry(1,r*2,r,0,Math.PI*2,0,Math.PI);a=t.call(this,n,s,n);var l=a._normals,c=s.attributes.normal.array,u=a._chunkSize;a._chunkPos=a._chunkGeo.attributes.position.array,a._tmpPositions=utils.allocateTyped(Float32Array,u*VEC_SIZE$3);for(var f=0;f<n;++f)l.set(c,u*VEC_SIZE$3*f);return a}return _createClass(e,[{key:"setItem",value:function(r,a,s){for(var l=this._tmpPositions,c=this._chunkSize,u=this._chunkPos,f=0;f<c;++f){var p=f*3;l[p]=a.x+u[p]*s,l[p+1]=a.y+u[p+1]*s,l[p+2]=a.z+u[p+2]*s}this._positions.set(l,c*r*VEC_SIZE$3),this.setSphere(r,a,s)}}]),e}(SphereCollisionGeo(ChunkedObjectsGeometry));function _createSuper$1N(o){var t=_isNativeReflectConstruct$1N();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1N(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VEC_SIZE$2=3,centerPos=new Vector3,tmpVector$2=new Vector3,normMtx$1=new Matrix3,Simple2CCylindersGeometry=function(o){_inherits(e,o);var t=_createSuper$1N(e);function e(n,r){var a;_classCallCheck(this,e);var s=new CylinderGeometry(1,1,1,Math.max(3,r),2,!0);a=t.call(this,s,2*n);var l=a._chunkSize;return a._chunkPos=a._chunkGeo.attributes.position.array,a._chunkNorms=a._chunkGeo.attributes.normal.array,a._tmpVector=utils.allocateTyped(Float32Array,l*VEC_SIZE$2),a}return _createClass(e,[{key:"setItem",value:function(r,a,s,l){var c=this._chunkSize,u=c*2*r*VEC_SIZE$2,f=u+c*VEC_SIZE$2,p=this._tmpVector,g=this._chunkPos,y=this._chunkNorms;centerPos.lerpVectors(a,s,.5);var E=gfxutils.calcCylinderMatrix(a,centerPos,l);normMtx$1.getNormalMatrix(E);for(var h,v=0;v<c;++v)h=v*VEC_SIZE$2,tmpVector$2.fromArray(g,h),tmpVector$2.applyMatrix4(E),tmpVector$2.toArray(p,h);this._positions.set(p,u),centerPos.sub(a);for(var C=0;C<c;++C)h=C*VEC_SIZE$2,p[h]+=centerPos.x,p[h+1]+=centerPos.y,p[h+2]+=centerPos.z;this._positions.set(p,f);for(var x=0;x<c;++x)h=x*VEC_SIZE$2,tmpVector$2.fromArray(y,h),tmpVector$2.applyMatrix3(normMtx$1),tmpVector$2.toArray(p,h);this._normals.set(p,u),this._normals.set(p,f)}},{key:"setColor",value:function(r,a,s){var l=2*r;_get(_getPrototypeOf(e.prototype),"setColor",this).call(this,l,a);var c=l+1;_get(_getPrototypeOf(e.prototype),"setColor",this).call(this,c,s)}}]),e}(ChunkedObjectsGeometry);function _createSuper$1M(o){var t=_isNativeReflectConstruct$1M();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1M(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MAX_POINTS_COUNT_16BIT=65536,PTS_PER_TRIANGLE=3,CylinderBufferGeometry=function(o){_inherits(e,o);var t=_createSuper$1M(e);function e(n,r,a,s,l,c){var u;_classCallCheck(this,e),u=t.call(this);var f=0,p=2*Math.PI;u.type="CylinderBufferGeometry",u.parameters={radiusTop:n,radiusBottom:r,height:a,radialSegments:s,heightSegments:l,openEnded:c};var g=c===!1&&n>0,y=c===!1&&r>0,E=(l+1)*s+g*(s+1)+y*(s+1),h=(2*l+g+y)*s,v=a/2,C=new BufferAttribute(utils.allocateTyped(Float32Array,E*3),3),x=new BufferAttribute(utils.allocateTyped(Float32Array,E*3),3),w=new Uint16BufferAttribute(utils.allocateTyped(Uint16Array,h*PTS_PER_TRIANGLE),1),_=new BufferAttribute(utils.allocateTyped(Float32Array,E*2),2);console.assert(E<MAX_POINTS_COUNT_16BIT,"false: Cylinder Geometry has too many vertices (65536 max).");for(var S=0,M=0,T=-(r-n)/a,R=0;R<=l;R++){if(R!==l)for(var P=0;P<s;P++){var I=S+P,B=S+s+P,W=S+s+(P+1)%s,D=S+(P+1)%s;w.setXYZ(M*PTS_PER_TRIANGLE,I,D,B),M++,w.setXYZ(M*PTS_PER_TRIANGLE,B,D,W),M++}for(var O=R/l,z=O*(r-n)+n,G=0;G<s;G++){var k=G/s,$=z*Math.sin(k*p+f),Z=O*a-v,K=z*Math.cos(k*p+f),j=new Vector3($,Math.sqrt($*$+K*K)*T,K).normalize();C.setXYZ(S,$,Z,K),x.setXYZ(S,j.x,j.y,j.z),_.setXY(S,k,O),++S}}if(g){for(var Q=S,le=S+s,he=0;he<s;++he){var ve=S-s;C.setXYZ(S,C.getX(ve),C.getY(ve),C.getZ(ve)),x.setXYZ(S,0,1,0),_.setXY(S,1,1);var re=Q+(he+1)%s;w.setXYZ(M*PTS_PER_TRIANGLE,S,re,le),M++,S++}C.setXYZ(S,0,v,0),x.setXYZ(S,0,1,0),_.setXY(S,1,1),++S}if(y){for(var Ie=S,ge=S+s,Se=0;Se<s;++Se){var Le=Se;C.setXYZ(S,C.getX(Le),C.getY(Le),C.getZ(Le)),x.setXYZ(S,0,-1,0),_.setXY(S,0,0);var be=Ie+(Se+1)%s;w.setXYZ(M*PTS_PER_TRIANGLE,be,S,ge),M++,S++}C.setXYZ(S,0,-v,0),x.setXYZ(S,0,-1,0),_.setXY(S,0,0)}return u.setIndex(w),u.setAttribute("position",C),u.setAttribute("normal",x),u.setAttribute("uv",_),u}return _createClass(e,[{key:"clone",value:function(){var r=this.parameters;return new e(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded)}}]),e}(BufferGeometry);function _createSuper$1L(o){var t=_isNativeReflectConstruct$1L();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tmpColor$2=new Color,invMatrix=new Matrix4,OFFSET_SIZE=4,COLOR_SIZE$2=3,copySubArrays=utils.copySubArrays;function setArrayXYZ$1(o,t,e,n,r){o[t]=e,o[t+1]=n,o[t+2]=r}function setArrayXYZW$1(o,t,e,n,r,a){o[t]=e,o[t+1]=n,o[t+2]=r,o[t+3]=a}function sortNumber(o,t){return o-t}function _prepareCylinderInfo(o){o.sort(sortNumber);for(var t=[],e=[],n=0,r=o.length;n<r;++n){var a=o[n],s=(a|0)%2===0,l={first:!1,second:!1};s?(l.first=!0,l.second=n+1<r&&o[n+1]===o[n]+1,l.second&&++n):l.second=!0,t.push(Math.floor(a/2)),e.push(l)}return{indices:t,cylinderInfo:e}}function _assignOpacity(o,t,e){for(var n=0,r=o.length;n<r;++n){var a=o[n];a.first||(t[COLOR_SIZE$2*n]=-.5),a.second||(e[COLOR_SIZE$2*n]=-.5)}}var Instanced2CCylindersGeometry=function(o){_inherits(e,o);var t=_createSuper$1L(e);function e(n,r,a,s){var l;return _classCallCheck(this,e),l=t.call(this),l._useZSprites=a,l._cylGeometry=a?new PlaneGeometry(2,2,1,1):new CylinderBufferGeometry(1,1,1,Math.max(3,r),2,s),l._init(n,l._cylGeometry,l._useZSprites),l._collisionGeo=new Simple2CCylindersGeometry(n,3),l}return _createClass(e,[{key:"setItem",value:function(r,a,s,l){var c=gfxutils.calcCylinderMatrix(a,s,l),u=c.elements,f=r*OFFSET_SIZE;this._collisionGeo.setItem(r,a,s,l),setArrayXYZW$1(this._matVector1,f,u[0],u[4],u[8],u[12]),setArrayXYZW$1(this._matVector2,f,u[1],u[5],u[9],u[13]),setArrayXYZW$1(this._matVector3,f,u[2],u[6],u[10],u[14]),this._useZSprites&&(invMatrix.copy(c).invert(),u=invMatrix.elements,setArrayXYZW$1(this._invmatVector1,f,u[0],u[4],u[8],u[12]),setArrayXYZW$1(this._invmatVector2,f,u[1],u[5],u[9],u[13]),setArrayXYZW$1(this._invmatVector3,f,u[2],u[6],u[10],u[14]))}},{key:"setColor",value:function(r,a,s){var l=r*COLOR_SIZE$2;tmpColor$2.set(a),setArrayXYZ$1(this._color1,l,tmpColor$2.r,tmpColor$2.g,tmpColor$2.b),tmpColor$2.set(s),setArrayXYZ$1(this._color2,l,tmpColor$2.r,tmpColor$2.g,tmpColor$2.b)}},{key:"computeBoundingSphere",value:function(){this._collisionGeo.computeBoundingSphere(),this.boundingSphere=this._collisionGeo.boundingSphere}},{key:"computeBoundingBox",value:function(){this._collisionGeo.computeBoundingBox(),this.boundingBox=this._collisionGeo.boundingBox}},{key:"raycast",value:function(r,a){this._collisionGeo.raycast(r,a)}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("matVector1").needsUpdate=!0,this.getAttribute("matVector2").needsUpdate=!0,this.getAttribute("matVector3").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("color2").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this._useZSprites&&(this.getAttribute("invmatVector1").needsUpdate=!0,this.getAttribute("invmatVector2").needsUpdate=!0,this.getAttribute("invmatVector3").needsUpdate=!0),this._collisionGeo.finishUpdate()}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(r,a){for(var s=this._alpha,l=0,c=r.length;l<c;++l)s[Math.floor(r[l]/2)]=a;this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubset",value:function(r){var a=_prepareCylinderInfo(r),s=a.indices,l=s.length,c=new InstancedBufferGeometry;return this._init.call(c,l,this._cylGeometry,this._useZSprites),copySubArrays(this._matVector1,c._matVector1,s,OFFSET_SIZE),copySubArrays(this._matVector2,c._matVector2,s,OFFSET_SIZE),copySubArrays(this._matVector3,c._matVector3,s,OFFSET_SIZE),this._useZSprites&&(copySubArrays(this._invmatVector1,c._invmatVector1,s,OFFSET_SIZE),copySubArrays(this._invmatVector2,c._invmatVector2,s,OFFSET_SIZE),copySubArrays(this._invmatVector3,c._invmatVector3,s,OFFSET_SIZE)),copySubArrays(this._color1,c._color1,s,COLOR_SIZE$2),copySubArrays(this._color2,c._color2,s,COLOR_SIZE$2),_assignOpacity(a.cylinderInfo,c._color1,c._color2),c.boundingSphere=this.boundingSphere,c.boundingBox=this.boundingBox,[c]}},{key:"getGeoParams",value:function(){return this._cylGeometry.parameters}},{key:"_init",value:function(r,a,s){this.copy(a),this._matVector1=utils.allocateTyped(Float32Array,r*OFFSET_SIZE),this._matVector2=utils.allocateTyped(Float32Array,r*OFFSET_SIZE),this._matVector3=utils.allocateTyped(Float32Array,r*OFFSET_SIZE),this._color1=utils.allocateTyped(Float32Array,r*COLOR_SIZE$2),this._color2=utils.allocateTyped(Float32Array,r*COLOR_SIZE$2);var l=this._alpha=utils.allocateTyped(Float32Array,r);lodashExports.fill(l,1),this.setAttribute("matVector1",new InstancedBufferAttribute(this._matVector1,OFFSET_SIZE,!1,1)),this.setAttribute("matVector2",new InstancedBufferAttribute(this._matVector2,OFFSET_SIZE,!1,1)),this.setAttribute("matVector3",new InstancedBufferAttribute(this._matVector3,OFFSET_SIZE,!1,1)),this.setAttribute("color",new InstancedBufferAttribute(this._color1,COLOR_SIZE$2,!1,1)),this.setAttribute("color2",new InstancedBufferAttribute(this._color2,COLOR_SIZE$2,!1,1)),this.setAttribute("alphaColor",new InstancedBufferAttribute(this._alpha,1,!1,1)),s&&(this._invmatVector1=utils.allocateTyped(Float32Array,r*OFFSET_SIZE),this._invmatVector2=utils.allocateTyped(Float32Array,r*OFFSET_SIZE),this._invmatVector3=utils.allocateTyped(Float32Array,r*OFFSET_SIZE),this.setAttribute("invmatVector1",new InstancedBufferAttribute(this._invmatVector1,OFFSET_SIZE,!1,1)),this.setAttribute("invmatVector2",new InstancedBufferAttribute(this._invmatVector2,OFFSET_SIZE,!1,1)),this.setAttribute("invmatVector3",new InstancedBufferAttribute(this._invmatVector3,OFFSET_SIZE,!1,1)))}}]),e}(InstancedBufferGeometry);function _createSuper$1K(o){var t=_isNativeReflectConstruct$1K();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1K(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VEC_SIZE$1=3,TRI_SIZE=3,tmpPrev=new Vector3,tmpNext=new Vector3,tmpRes=new Vector3,simpleNormal=new Vector3(1,0,0),normalOnCut=new Vector3,nearRingPt=new Vector3;function _createExtrudedChunkGeometry(o,t){for(var e=new BufferGeometry,n=o.length,r=n*t,a=r<=65536?Uint16Array:Uint32Array,s=(t-1)*n*2,l=new BufferAttribute(utils.allocateTyped(a,s*TRI_SIZE),1),c=0,u=0,f=0;f<t;f++){if(f!==t-1)for(var p=0;p<n;p++){var g=c+p,y=c+n+p,E=c+n+(p+1)%n,h=c+(p+1)%n;l.setXYZ(u*TRI_SIZE,g,h,y),u++,l.setXYZ(u*TRI_SIZE,y,h,E),u++}c+=n}e.setIndex(l);var v=utils.allocateTyped(Float32Array,r*VEC_SIZE$1);return e.setAttribute("position",new BufferAttribute(v,VEC_SIZE$1)),e._positions=o,e}var ExtrudedObjectsGeometry=function(o){_inherits(e,o);var t=_createSuper$1K(e);function e(n,r,a){var s;_classCallCheck(this,e);var l=_createExtrudedChunkGeometry(n,r);s=t.call(this,l,a),s._ringsCount=r;for(var c=s._tmpShape=[],u=0;u<n.length;++u)c[u]=new Vector3;return s}return _createClass(e,[{key:"setItem",value:function(r,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,c=this._chunkGeo._positions.length,u=this._ringsCount,f=c*this._ringsCount*r*VEC_SIZE$1;this._setPoints(a,c,u,f),s?this._setSlopeNormals(c,u,f):this._setBaseNormals(c,u,f),l&&this._addCut(c,u,f)}},{key:"_setPoints",value:function(r,a,s,l){for(var c=this._tmpShape,u=this._positions,f=this._chunkGeo._positions,p=0,g=l;p<s;++p)for(var y=r[p],E=0;E<a;++E,g+=VEC_SIZE$1)c[E].copy(f[E]).applyMatrix4(y).toArray(u,g)}},{key:"_setBaseNormals",value:function(r,a,s){for(var l=r*VEC_SIZE$1,c=0,u=s;c<a;++c,u+=l)this._countNormalsInRing(r,u,!1)}},{key:"_setSlopeNormals",value:function(r,a,s){for(var l=this._normals,c=r*VEC_SIZE$1,u=s,f=0;f<r;++f,u+=VEC_SIZE$1)simpleNormal.toArray(l,u);if(u-2*c>0)for(var p=0;p<r;++p,u+=VEC_SIZE$1)tmpRes.fromArray(l,u-2*c).toArray(l,u);else this._countNormalsInRing(r,u,!0,+c),u+=c;for(var g=2;g<a;++g,u+=c)this._countNormalsInRing(r,u,!0,-c)}},{key:"_countNormalsInRing",value:function(r,a,s,l){var c=this._tmpShape,u=this._normals;c[0].fromArray(this._positions,a),c[r-1].fromArray(this._positions,a+(r-1)*VEC_SIZE$1);for(var f=0;f<r;++f,a+=VEC_SIZE$1)f<r-1&&c[f+1].fromArray(this._positions,a+VEC_SIZE$1),s?(nearRingPt.fromArray(this._positions,a+l),tmpPrev.subVectors(c[(f+r-1)%r],c[(f+1)%r]).normalize(),tmpNext.subVectors(c[f],nearRingPt).normalize(),tmpRes.crossVectors(tmpNext,tmpPrev).normalize().toArray(u,a)):(tmpPrev.subVectors(c[f],c[(f+r-1)%r]).normalize(),tmpNext.subVectors(c[f],c[(f+1)%r]).normalize(),tmpRes.addVectors(tmpPrev,tmpNext).normalize().toArray(u,a))}},{key:"_addCut",value:function(r,a,s){if(!(r<3||a<2)){var l=this._positions,c=this._normals,u=this._tmpShape,f=r*VEC_SIZE$1;u[0].fromArray(l,s),u[1].fromArray(l,s+VEC_SIZE$1),u[2].fromArray(l,s+2*VEC_SIZE$1),tmpPrev.subVectors(u[1],u[0]).normalize(),tmpNext.subVectors(u[1],u[2]).normalize(),normalOnCut.crossVectors(tmpPrev,tmpNext).normalize();for(var p=s,g=0;g<r*2;++g,p+=VEC_SIZE$1)normalOnCut.toArray(c,p);if(a>2)for(var y=0;y<r;++y,p+=VEC_SIZE$1)tmpRes.fromArray(l,p-f).toArray(l,p)}}}]),e}(ChunkedObjectsGeometry);function _createSuper$1J(o){var t=_isNativeReflectConstruct$1J();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1J(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MAX_IDC_16BIT=65535,VERTEX_PER_SEGMENT=4,POS_SIZE=4,DIR_SIZE=3,COL_SIZE=3,tmpColor$1=new Color,direction=new Vector3;function setArrayXYZ(o,t,e,n,r){o[t]=e,o[t+1]=n,o[t+2]=r}function setArrayXYZW(o,t,e,n,r,a){o[t]=e,o[t+1]=n,o[t+2]=r,o[t+3]=a}function getSubset(o,t,e,n){var r=t*VERTEX_PER_SEGMENT,a=r+e*VERTEX_PER_SEGMENT;return o.subarray(r*n,a*n)}var ThickLinesGeometry=function(o){_inherits(e,o);var t=_createSuper$1J(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r._initVertices(n),r}return _createClass(e,[{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.getAttribute("position").needsUpdate=!0,this.getAttribute("color").needsUpdate=!0,this.getAttribute("alphaColor").needsUpdate=!0,this.getAttribute("direction").needsUpdate=!0}},{key:"setColor",value:function(r,a){tmpColor$1.set(a);var s=r*VERTEX_PER_SEGMENT*COL_SIZE;setArrayXYZ(this._colors,s,tmpColor$1.r,tmpColor$1.g,tmpColor$1.b),s+=COL_SIZE,setArrayXYZ(this._colors,s,tmpColor$1.r,tmpColor$1.g,tmpColor$1.b),s+=COL_SIZE,setArrayXYZ(this._colors,s,tmpColor$1.r,tmpColor$1.g,tmpColor$1.b),s+=COL_SIZE,setArrayXYZ(this._colors,s,tmpColor$1.r,tmpColor$1.g,tmpColor$1.b)}},{key:"setSegment",value:function(r,a,s){direction.subVectors(a,s),direction.normalize();var l=this._positions,c=this._directions,u=r*VERTEX_PER_SEGMENT*POS_SIZE,f=r*VERTEX_PER_SEGMENT*DIR_SIZE;setArrayXYZW(l,u,a.x,a.y,a.z,.5),setArrayXYZ(c,f,direction.x,direction.y,direction.z),u+=POS_SIZE,f+=DIR_SIZE,setArrayXYZW(l,u,a.x,a.y,a.z,-.5),setArrayXYZ(c,f,direction.x,direction.y,direction.z),u+=POS_SIZE,f+=DIR_SIZE,setArrayXYZW(l,u,s.x,s.y,s.z,.5),setArrayXYZ(c,f,direction.x,direction.y,direction.z),u+=POS_SIZE,f+=DIR_SIZE,setArrayXYZW(l,u,s.x,s.y,s.z,-.5),setArrayXYZ(c,f,direction.x,direction.y,direction.z)}},{key:"setOpacity",value:function(r,a,s){var l=r*VERTEX_PER_SEGMENT,c=a*VERTEX_PER_SEGMENT;lodashExports.fill(this.alpha,s,c,l),this.getAttribute("alphaColor").needsUpdate=!0}},{key:"getSubsetSegments",value:function(r,a){return[getSubset(this._positions,r,a,POS_SIZE),getSubset(this._directions,r,a,DIR_SIZE)]}},{key:"getSubsetColors",value:function(r,a){return getSubset(this._colors,r,a,COL_SIZE)}},{key:"getSubsetOpacities",value:function(r,a){return getSubset(this._alpha,r,a,1)}},{key:"getNumVertexPerSegment",value:function(){return VERTEX_PER_SEGMENT}},{key:"getPositionSize",value:function(){return POS_SIZE}},{key:"setSegments",value:function(r,a){var s=r*VERTEX_PER_SEGMENT*POS_SIZE;if(a instanceof Array&&a.length===2){this._positions.set(a[0],s);var l=r*VERTEX_PER_SEGMENT*DIR_SIZE;this._directions.set(a[1],l)}else this._positions.set(a,s)}},{key:"setColors",value:function(r,a){var s=r*VERTEX_PER_SEGMENT*COL_SIZE;this._colors.set(a,s)}},{key:"_initVertices",value:function(r){this._buffersSize=r*VERTEX_PER_SEGMENT;var a=this._buffersSize,s=a>MAX_IDC_16BIT;this._index=utils.allocateTyped(s?Uint32Array:Uint16Array,r*6),this._positions=utils.allocateTyped(Float32Array,a*POS_SIZE),this._colors=utils.allocateTyped(Float32Array,a*COL_SIZE),this._directions=utils.allocateTyped(Float32Array,a*DIR_SIZE);var l=this._alpha=utils.allocateTyped(Float32Array,a);lodashExports.fill(l,1);for(var c=this._index,u=0,f=0,p=0;p<r;p++,u+=6,f+=VERTEX_PER_SEGMENT)c[u]=f,c[u+1]=f+1,c[u+2]=f+3,c[u+3]=f,c[u+4]=f+2,c[u+5]=f+3;this.setIndex(new BufferAttribute(this._index,1)),this.setAttribute("position",new BufferAttribute(this._positions,POS_SIZE)),this.setAttribute("color",new BufferAttribute(this._colors,COL_SIZE)),this.setAttribute("alphaColor",new BufferAttribute(l,1)),this.setAttribute("direction",new BufferAttribute(this._directions,DIR_SIZE))}}]),e}(BufferGeometry);function _createSuper$1I(o){var t=_isNativeReflectConstruct$1I();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LinesGeometry=function(o){_inherits(e,o);var t=_createSuper$1I(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var r=this.boundingBox,a=0,s=new Vector3;r&&r.getCenter(s);for(var l=this._positions,c=this.boundingSphere||new Sphere,u=this._positions.length,f=new Vector3,p=this.getPositionSize(),g=0;g<u;g+=p){f.set(l[g],l[g+1],l[g+2]);var y=s.distanceToSquared(f);a<y&&(a=y)}c.set(s,Math.sqrt(a)),this.boundingSphere=c}},{key:"computeBoundingBox",value:function(){for(var r=this._positions,a=new Box3,s=this._positions.length,l=new Vector3,c=this.getPositionSize(),u=0;u<s;u+=c)l.set(r[u],r[u+1],r[u+2]),a.expandByPoint(l);this.boundingBox=a}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}}]),e}(ThickLinesGeometry);function _createSuper$1H(o){var t=_isNativeReflectConstruct$1H();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1H(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VEC_SIZE=3,tmpVector$1=new Vector3,normMtx=new Matrix3,CylinderCollisionGeo=function(o){_inherits(e,o);var t=_createSuper$1H(e);function e(n,r){var a;_classCallCheck(this,e);var s=new CylinderGeometry(1,1,1,Math.max(3,r),2,!0);a=t.call(this,s,n);var l=a._chunkSize;return a._chunkPos=a._chunkGeo.attributes.position.array,a._chunkNorms=a._chunkGeo.attributes.normal.array,a._tmpVector=utils.allocateTyped(Float32Array,l*VEC_SIZE),a}return _createClass(e,[{key:"setItem",value:function(r,a,s,l){var c=this._chunkSize,u=c*r*VEC_SIZE,f=this._tmpVector,p=this._chunkPos,g=this._chunkNorms,y=gfxutils.calcCylinderMatrix(a,s,l);normMtx.getNormalMatrix(y);for(var E,h=0;h<c;++h)E=h*VEC_SIZE,tmpVector$1.fromArray(p,E),tmpVector$1.applyMatrix4(y),tmpVector$1.toArray(f,E);this._positions.set(f,u);for(var v=0;v<c;++v)E=v*VEC_SIZE,tmpVector$1.fromArray(g,E),tmpVector$1.applyMatrix3(normMtx),tmpVector$1.toArray(f,E);this._normals.set(f,u)}}]),e}(ChunkedObjectsGeometry);function _createSuper$1G(o){var t=_isNativeReflectConstruct$1G();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1G(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var COLLISION_RAD$1=.1,ChunkedLinesGeometry=function(o){_inherits(e,o);var t=_createSuper$1G(e);function e(n,r,a){var s;return _classCallCheck(this,e),s=t.call(this,n*r),s._init(r),s._collisionGeo=a?new CylinderCollisionGeo(n*r,3):null,s}return _createClass(e,[{key:"startUpdate",value:function(){return!0}},{key:"computeBoundingSphere",value:function(){var r=this._collisionGeo;if(r){r.computeBoundingSphere(),this.boundingSphere=r.boundingSphere;return}_get(_getPrototypeOf(e.prototype),"computeBoundingSphere",this).call(this)}},{key:"computeBoundingBox",value:function(){var r=this._collisionGeo;if(r){r.computeBoundingBox(),this.boundingBox=r.boundingBox;return}_get(_getPrototypeOf(e.prototype),"computeBoundingBox",this).call(this)}},{key:"raycast",value:function(r,a){var s=this._collisionGeo;if(s){var l=this._chunkSize;this._collisionGeo.raycast(r,a);for(var c=0,u=a.length;c<u;++c){var f=a[c].chunkIdx;f!==void 0&&(f=f/l|0,a[c].chunkIdx=f)}}}},{key:"setColor",value:function(r,a){for(var s=this._chunkSize,l=r*s,c=l+s;l<c;++l)_get(_getPrototypeOf(e.prototype),"setColor",this).call(this,l,a)}},{key:"setSegment",value:function(r,a,s,l){var c=this._chunkSize,u=r*c+a;_get(_getPrototypeOf(e.prototype),"setSegment",this).call(this,u,s,l),this._collisionGeo&&this._collisionGeo.setItem(r*c+a,s,l,COLLISION_RAD$1)}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"setOpacity",value:function(r,a){for(var s=this._chunkSize,l=0,c=r.length;l<c;++l){var u=r[l]*s;_get(_getPrototypeOf(e.prototype),"setOpacity",this).call(this,u,u+s-1,a)}}},{key:"getSubset",value:function(r){for(var a=r.length,s=this._chunkSize,l=new e(a,s,!1),c=0,u=r.length;c<u;++c){var f=c*s,p=r[c]*s;l.setSegments(f,this.getSubsetSegments(p,s)),l.setColors(f,this.getSubsetColors(p,s))}return l.boundingSphere=this.boundingSphere,l.boundingBox=this.boundingBox,[l]}},{key:"_init",value:function(r){this._chunkSize=r}}]),e}(LinesGeometry);function _createSuper$1F(o){var t=_isNativeReflectConstruct$1F();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1F(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var COLLISION_RAD=.3,tmpVector=new Vector3,TwoColorLinesGeometry=function(o){_inherits(e,o);var t=_createSuper$1F(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n*2),r._init(n),r._collisionGeo=new Simple2CCylindersGeometry(n,3),r}return _createClass(e,[{key:"setItem",value:function(r,a,s){this._collisionGeo.setItem(r,a,s,COLLISION_RAD);var l=2*r;tmpVector.lerpVectors(a,s,.5),_get(_getPrototypeOf(e.prototype),"setSegment",this).call(this,l,a,tmpVector),_get(_getPrototypeOf(e.prototype),"setSegment",this).call(this,l+1,tmpVector,s)}},{key:"setColor",value:function(r,a,s){var l=2*r;_get(_getPrototypeOf(e.prototype),"setColor",this).call(this,l,a),_get(_getPrototypeOf(e.prototype),"setColor",this).call(this,l+1,s)}},{key:"raycast",value:function(r,a){this._collisionGeo&&this._collisionGeo.raycast(r,a)}},{key:"getSubset",value:function(r){for(var a=r.length,s=new e(a),l=0,c=a;l<c;++l){var u=r[l];s.setSegments(l,this.getSubsetSegments(u,1)),s.setColors(l,this.getSubsetColors(u,1))}return s.boundingSphere=this.boundingSphere,s.boundingBox=this.boundingBox,[s]}},{key:"_init",value:function(r){this._segCounts=r*2}}]),e}(LinesGeometry);function _createSuper$1E(o){var t=_isNativeReflectConstruct$1E();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vectors=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,1,0),new Vector3(0,-1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],vecCount=vectors.length,tempPos1=new Vector3,tempPos2=new Vector3,CrossGeometry=function(o){_inherits(e,o);var t=_createSuper$1E(e);function e(n){return _classCallCheck(this,e),t.call(this,n,n,vecCount/2|0,!1)}return _createClass(e,[{key:"setItem",value:function(r,a,s){this.setSphere(r,a,s);for(var l=0;l<vecCount/2;++l){var c=l*2;tempPos1.x=a.x+vectors[c].x*s,tempPos1.y=a.y+vectors[c].y*s,tempPos1.z=a.z+vectors[c].z*s;var u=c+1;tempPos2.x=a.x+vectors[u].x*s,tempPos2.y=a.y+vectors[u].y*s,tempPos2.z=a.z+vectors[u].z*s,this.setSegment(r,l,tempPos1,tempPos2)}}}]),e}(SphereCollisionGeo(ChunkedLinesGeometry));function _createSuper$1D(o){var t=_isNativeReflectConstruct$1D();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var POS_RAD_SIZE=4,COLOR_SIZE$1=3,tmpColor=new Color,IsoSurfaceGeometry=function(o){_inherits(e,o);var t=_createSuper$1D(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this),a._opts=r,a.zClip=a._opts.zClip,a._posRad=utils.allocateTyped(Float32Array,n*POS_RAD_SIZE),a._colors=utils.allocateTyped(Float32Array,n*COLOR_SIZE$1),a}return _createClass(e,[{key:"setItem",value:function(r,a,s){var l=this._posRad,c=POS_RAD_SIZE*r;l[c++]=a.x,l[c++]=a.y,l[c++]=a.z,l[c]=s}},{key:"setColor",value:function(r,a){tmpColor.set(a);var s=this._colors,l=COLOR_SIZE$1*r;s[l++]=tmpColor.r,s[l++]=tmpColor.g,s[l]=tmpColor.b}},{key:"finalize",value:function(){this.finishUpdate(),this.computeBoundingSphere()}},{key:"finishUpdate",value:function(){this._build()}},{key:"setOpacity",value:function(){}},{key:"raycast",value:function(){}},{key:"getSubset",value:function(){return[]}}]),e}(BufferGeometry),IsoSurfaceMarchCube=function(){function o(){_classCallCheck(this,o),this.pointsValuesLinear=null,this.hasIntersection=null,this.bitsInside=null}return _createClass(o,[{key:"create",value:function(e){var n=117440512,r=e*e*e;if(r>n)throw new Error("Too large cube dimension: lead to memory huge uasge");return this.pointsValuesLinear=utils.allocateTyped(Float32Array,32*r),this.hasIntersection=utils.allocateTyped(Int32Array,r),this.bitsInside=utils.allocateTyped(Int32Array,r),0}},{key:"destroy",value:function(){this.bitsInside=null,this.hasIntersection=null,this.pointsValuesLinear=null}}]),o}();IsoSurfaceMarchCube.prototype.striIndicesMarchCube=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];var edgeTable=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0];function _voxelGradientFast(o,t,e){var n=o.getValue(t.x,t.y,t.z);e.set(n[0],n[1],n[2])}var GridCell=_createClass(function o(){_classCallCheck(this,o),this._arrSize=8,this.p=new Array(this._arrSize),this.g=new Array(this._arrSize),this.val=new Array(this._arrSize);for(var t=0;t<this._arrSize;++t)this.p[t]=new Vector3,this.g[t]=new Vector3;this.cubeIndex=0}),Triangle=_createClass(function o(){_classCallCheck(this,o),this.a={p:new Vector3,n:new Vector3},this.b={p:new Vector3,n:new Vector3},this.c={p:new Vector3,n:new Vector3}});function createArray(o){for(var t=new Array(o),e=0;e<o;++e)t[e]=new Vector3;return t}var IsoSurface=function(){function o(){_classCallCheck(this,o),this._numTriangles=0,this._numVertices=0,this._position=[],this._normals=[],this._colors=null,this._indices=[],this._volumetricData=null,this._xAxis=new Vector3,this._yAxis=new Vector3,this._zAxis=new Vector3,this._xDir=new Vector3,this._yDir=new Vector3,this._zDir=new Vector3}return _createClass(o,[{key:"_prepareAxesAndDirs",value:function(){var e=this._volumetricData,n=e.getCellSize(),r=this._xAxis,a=this._yAxis,s=this._zAxis,l=this._xDir,c=this._yDir,u=this._zDir;r.set(n.x,0,0),a.set(0,n.y,0),s.set(0,0,n.z),l.set(1,0,0),c.set(0,1,0),u.set(0,0,1);var f=new Vector3;if(f.crossVectors(l,c),f.dot(u)<0&&(l.negate(),c.negate(),u.negate()),l.x<0||l.y<0||l.z<0||c.x<0||c.y<0||c.z<0||u.x<0||u.y<0||u.z<0)return!1;var p=function(y){return Math.abs(y)>Number.EPSILON};return!(p(r.y)||p(r.z)||p(a.x)||p(a.z)||p(s.x)||p(s.y))}},{key:"_vertexInterp",value:function(e,n,r,a,s,l){var c=n.p[r],u=n.p[a],f=n.g[r],p=n.g[a],g=n.val[r],y=n.val[a],E=e-g,h=y-g,v=0;Math.abs(h)>0&&(v=E/h),v=v>1?1:v,s.lerpVectors(c,u,v),l.lerpVectors(f,p,v)}},{key:"_polygonize",value:function(e,n,r){for(var a=e.cubeIndex,s=0,l=o._arrSize,c=o._firstIndices,u=o._secondIndices,f=o._vertexList,p=o._normalList;s<l;++s)edgeTable[a]&1<<s&&this._vertexInterp(n,e,c[s],u[s],f[s],p[s]);var g=0,y=a*16,E=o._triTable;for(s=0;E[y+s]!==-1;s+=3)r[g].a.p.copy(f[E[y+s]]),r[g].a.n.copy(p[E[y+s]]),r[g].b.p.copy(f[E[y+s+1]]),r[g].b.n.copy(p[E[y+s+1]]),r[g].c.p.copy(f[E[y+s+2]]),r[g].c.n.copy(p[E[y+s+2]]),++g;return g}},{key:"_doGridPosNorms",value:function(e,n,r){for(var a=this._volumetricData,s=this._volumetricData.getData(),l=a.getDimensions(),c=l[0],u=l[1],f=l[2],p=n*a.getStrideX(),g=n*a.getStrideY(),y=n*a.getStrideZ(),E=new GridCell,h=E.val,v=E.val.length,C=[new Vector3(0,0,0),new Vector3(n,0,0),new Vector3(n,n,0),new Vector3(0,n,0),new Vector3(0,0,n),new Vector3(n,0,n),new Vector3(n,n,n),new Vector3(0,n,n)],x=5,w=new Array(x),_=0;_<x;++_)w[_]=new Triangle;var S,M=this,T=this._position,R=this._normals;r?S=function(){var $=new Vector3(M._xAxis.x,M._yAxis.y,M._zAxis.z);return function(Z){var K=Z.p.clone();K.multiply($),T.push(K.add(M._origin)),R.push(Z.n.clone())}}():S=function(){var $=new Matrix3;$.set(M._xAxis.x,M._yAxis.x,M._zAxis.x,M._xAxis.y,M._yAxis.y,M._zAxis.y,M._xAxis.z,M._yAxis.z,M._zAxis.z);var Z=new Matrix3;return Z.set(M._xDir.x,M._yDir.x,M._zDir.x,M._xDir.y,M._yDir.y,M._zDir.y,M._xDir.z,M._yDir.z,M._zDir.z),function(K){T.push(K.p.clone().applyMatrix3($).add(M._origin)),R.push(K.n.clone().applyMatrix3(Z))}}();for(var P=this._indices,I=0,B=0;B<f-n;B+=n)for(var W=0;W<u-n;W+=n)for(var D=a.getDirectIdx(0,W,B),O=0;O<c-n;O+=n,D+=p){h[0]=s[D],h[1]=s[D+p],h[3]=s[D+g],h[2]=s[D+p+g],h[4]=s[D+y],h[5]=s[D+p+y],h[7]=s[D+g+y],h[6]=s[D+p+g+y];for(var z=0,G=0;G<v;++G)h[G]<e&&(z|=1<<G);if(edgeTable[z]!==0){for(E.cubeIndex=z,G=0;G<v;++G)E.p[G].set(O+C[G].x,W+C[G].y,B+C[G].z),_voxelGradientFast(this._gradient,E.p[G],E.g[G]);var k=this._polygonize(E,e,w);for(I+=k,G=0;G<k;++G)P.push(this._numTriangles*3),P.push(this._numTriangles*3+1),P.push(this._numTriangles*3+2),++this._numTriangles,S(w[G].a),S(w[G].b),S(w[G].c)}}return I}},{key:"compute",value:function(e,n,r,a){this._volumetricData=e,this._origin=n,this._gradient=e.computeGradient(),this._doGridPosNorms(r,a,this._prepareAxesAndDirs())}},{key:"_remapIndices",value:function(e,n){for(var r=this._indices,a=utils.allocateTyped(Uint32Array,n),s=0;s<n;++s)r[s]=e[r[s]],a[s]=r[s];this._indices=a}},{key:"_remapVertices",value:function(e,n,r){for(var a=utils.allocateTyped(Float32Array,r*3),s=utils.allocateTyped(Float32Array,r*3),l=0;l<r;++l){var c=e[l];a[l*3]=c.x,a[l*3+1]=c.y,a[l*3+2]=c.z;var u=n[l].normalize();s[l*3]=u.x,s[l*3+1]=u.y,s[l*3+2]=u.z}this._position=a,this._normals=s}},{key:"vertexFusion",value:function(e,n){var r=this._indices.length,a=this._position,s=this._normals,l=a.length|0;if(!(r===0||l===0)){var c=utils.allocateTyped(Uint32Array,l);c[0]=0;for(var u=1,f=1;f<l;++f){for(var p=u-e<0?0:u-e,g=p+n>u?u:p+n,y=-1,E=p;E<g;++E)if(Math.abs(a[f]-a[E])<Number.EPSILON){y=E;break}y!==-1?c[f]=y:(a[u].copy(a[f]),s[u].copy(s[f]),c[f]=u,++u)}this._remapIndices(c,r),this._remapVertices(a,s,u)}}},{key:"setColorVolTex",value:function(e,n,r,a){var s,l,c=this._position.length/3,u=this._position,f=this._origin,p=this._volumetricData.getDimensions(),g=p[0]-1,y=p[1]-1,E=p[2]-1,h=e.getData(),v=e.getStrideX(),C=e.getStrideY(),x=e.getStrideZ(),w,_,S,M;a!==null&&(w=r.getData(),_=r.getStrideX(),S=r.getStrideY(),M=r.getStrideZ());var T=1/this._xAxis.x,R=1/this._yAxis.y,P=1/this._zAxis.z,I=[],B=[],W=utils.allocateTyped(Float32Array,c*3);function D(qe,et,F,H){H[0]=(1-qe)*h[et]+qe*h[F],H[1]=(1-qe)*h[et+1]+qe*h[F+1],H[2]=(1-qe)*h[et+2]+qe*h[F+2]}function O(qe,et,F,H){var X=n[qe];if(X!=null){I[X.index]=X;var oe=et*F*H*w[qe];typeof B[X.index]>"u"?B[X.index]=oe:B[X.index]+=oe}}var z=utils.allocateTyped(Int32Array,c),G=0;for(s=0;s<c;s++){var k=s*3,$=(u[k]-f.x)*T,Z=(u[k+1]-f.y)*R,K=(u[k+2]-f.z)*P,j=Math.min(Math.max($,0),g)|0,Q=Math.min(Math.max(Z,0),y)|0,le=Math.min(Math.max(K,0),E)|0,he=$-j,ve=Z-Q,re=K-le;if(a!=null){I=[],B=[],l=r.getDirectIdx(j,Q,le),O(l,1-he,1-ve,1-re),O(l+_,he,1-ve,1-re),O(l+S,1-he,ve,1-re),O(l+_+S,he,ve,1-re),O(l+M,1-he,1-ve,re),O(l+_+M,he,1-ve,re),O(l+S+M,1-he,ve,re),O(l+_+S+M,he,ve,re);var Ie=0,ge=-1;for(var Se in B)B[Se]>Ie&&(ge=Se,Ie=B[Se]);if(ge<0||!a.includesAtom(I[ge])){z[s]=-1;continue}}z[s]=G++;var Le=j<g?v:0,be=Q<y?C:0,ye=le<E?x:0,ce=[0,0,0],ue=[0,0,0],Ce=[0,0,0],Ve=[0,0,0];l=e.getDirectIdx(j,Q,le),D(he,l,l+Le,ce),D(he,l+be,l+Le+be,ue),D(he,l+ye,l+Le+ye,Ce),D(he,l+be+ye,l+Le+be+ye,Ve);var ie=[0,0,0];ie[0]=(1-ve)*ce[0]+ve*ue[0],ie[1]=(1-ve)*ce[1]+ve*ue[1],ie[2]=(1-ve)*ce[2]+ve*ue[2];var ae=[0,0,0];ae[0]=(1-ve)*Ce[0]+ve*Ve[0],ae[1]=(1-ve)*Ce[1]+ve*Ve[1],ae[2]=(1-ve)*Ce[2]+ve*Ve[2],W[k]=(1-re)*ie[0]+re*ae[0],W[k+1]=(1-re)*ie[1]+re*ae[1],W[k+2]=(1-re)*ie[2]+re*ae[2]}if(this._colors=W,a!=null){for(s=0;s<c;++s){var Ae=z[s];Ae<0||(this._position[Ae*3]=this._position[s*3],this._position[Ae*3+1]=this._position[s*3+1],this._position[Ae*3+2]=this._position[s*3+2],this._normals[Ae*3]=this._normals[s*3],this._normals[Ae*3+1]=this._normals[s*3+1],this._normals[Ae*3+2]=this._normals[s*3+2],this._colors[Ae*3]=this._colors[s*3],this._colors[Ae*3+1]=this._colors[s*3+1],this._colors[Ae*3+2]=this._colors[s*3+2])}var De=this._indices.length/3,Be=0;for(s=0;s<De;++s){var ze=z[this._indices[3*s]],We=z[this._indices[3*s+1]],$e=z[this._indices[3*s+2]];ze>=0&&We>=0&&$e>=0&&(this._indices[3*Be]=ze,this._indices[3*Be+1]=We,this._indices[3*Be+2]=$e,++Be)}this._position=new Float32Array(this._position.buffer.slice(0,G*3*4)),this._normals=new Float32Array(this._normals.buffer.slice(0,G*3*4)),this._colors=new Float32Array(this._colors.buffer.slice(0,G*3*4)),this._indices=new Uint32Array(this._indices.buffer.slice(0,Be*3*4))}}},{key:"toMesh",value:function(){var e=new BufferGeometry;return e.setIndex(new BufferAttribute(this._indices,1)),e.setAttribute("position",new BufferAttribute(this._position,3)),e.setAttribute("normal",new BufferAttribute(this._normals,3)),e.setAttribute("color",new BufferAttribute(this._colors,3)),e.computeBoundingSphere(),e}}]),o}();_defineProperty(IsoSurface,"_triTable",IsoSurfaceMarchCube.prototype.striIndicesMarchCube);_defineProperty(IsoSurface,"_arrSize",12);_defineProperty(IsoSurface,"_firstIndices",[0,1,2,3,4,5,6,7,0,1,2,3]);_defineProperty(IsoSurface,"_secondIndices",[1,2,3,0,5,6,7,4,4,5,6,7]);_defineProperty(IsoSurface,"_vertexList",createArray(IsoSurface._arrSize));_defineProperty(IsoSurface,"_normalList",createArray(IsoSurface._arrSize));function _createSuper$1C(o){var t=_isNativeReflectConstruct$1C();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1C(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VolumeSurfaceGeometry=function(o){_inherits(e,o);var t=_createSuper$1C(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_build",value:function(){var r=this._opts;this.numVoxels=[128,128,128],this.xAxis=new Vector3(1,0,0),this.yAxis=new Vector3(0,1,0),this.zAxis=new Vector3(0,0,1),this.origin=new Vector3(0,0,0),this._visibilitySelector=r.visibilitySelector,this._calcSurface(r)}},{key:"_findMinMax",value:function(r){for(var a=4,s=r.length/a,l=[r[0],r[1],r[2],r[3]],c=[r[0],r[1],r[2],r[3]],u=1;u<s;++u)for(var f=u*a,p=0;p<a;++p){var g=r[f+p];l[p]=Math.max(g,l[p]),c[p]=Math.min(g,c[p])}return{maxPosRad:l,minPosRad:c}}},{key:"_findNumVoxels",value:function(r,a){var s=this.numVoxels,l=this._findMinMax(r),c=l.minPosRad,u=l.maxPosRad;c[3]>4&&(a.gridSpacing*=c[3]);var f=a.radScale*u[3]*1.7,p=f;p=.65*Math.sqrt(4/3*Math.PI*p*p*p),f=Math.max(f,p);for(var g=0;g<3;++g)c[g]-=f,u[g]+=f;for(g=0;g<3;++g)s[g]=Math.ceil((u[g]-c[g])/a.gridSpacing);this.xAxis.x=(s[0]-1)*a.gridSpacing,this.yAxis.y=(s[1]-1)*a.gridSpacing,this.zAxis.z=(s[2]-1)*a.gridSpacing;var y=_slicedToArray(c,3);return this.origin.x=y[0],this.origin.y=y[1],this.origin.z=y[2],{bbox:l,dim:s}}},{key:"_makeSurface",value:function(r,a){var s=new IsoSurface;s.compute(r.volMap,this.origin,a.isoValue,1),s.vertexFusion(9,9),s._numTriangles>0?(s.setColorVolTex(r.volTexMap,r.atomMap,r.atomWeightMap,this._visibilitySelector),this.setIndex(new BufferAttribute(s._indices,1)),this.setAttribute("position",new BufferAttribute(s._position,3)),this.setAttribute("normal",new BufferAttribute(s._normals,3)),this.setAttribute("color",new BufferAttribute(s._colors,3))):this.setAttribute("position",new BufferAttribute(utils.allocateTyped(Float32Array,0),3))}},{key:"_calcSurface",value:function(r){var a={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};if(a.posRad.length!==0){var s=this._findNumVoxels(a.posRad,r),l=new Box3(this.origin,new Vector3(this.xAxis.x,this.yAxis.y,this.zAxis.z).add(this.origin)),c=this._computeSurface(a,l,s,r);this._makeSurface(c,r)}}}]),e}(IsoSurfaceGeometry);function _createSuper$1B(o){var t=_isNativeReflectConstruct$1B();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1B(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Volume$1=chem.Volume,QuickSurfGeometry=function(o){_inherits(e,o);var t=_createSuper$1B(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_computeSurface",value:function(r,a,s,l){this._shiftByOrigin(r.posRad);var c={volMap:new Volume$1(Float32Array,this.numVoxels,a),volTexMap:new Volume$1(Float32Array,this.numVoxels,a,3)};return this._visibilitySelector!=null&&(c.atomMap=[],c.atomWeightMap=new Volume$1(Float32Array,this.numVoxels,a)),this.gaussdensity(c,r,null,l),c}},{key:"gaussdensity",value:function(r,a,s,l){var c=a.posRad.length/4,u=a.posRad,f=a.colors,p=this.numVoxels,g=l.radScale,y=l.gaussLim,E=l.gridSpacing,h=1/l.isoValue,v=1/E,C=p[0]-1,x=p[1]-1,w=p[2]-1,_=r.volMap,S=r.volTexMap,M=_.getData(),T=_.getStrideX(),R=S.getData(),P=S.getStrideX(),I;this._visibilitySelector!=null&&(I=r.atomWeightMap.getData());for(var B=r.atomMap,W=0;W<c;++W){var D=W*4,O=u[D+3]*g,z=s===null?1:s[W],G=1/(2*O*O),k=y*O,$=k*k;k*=v;var Z=u[D]*v,K=Math.max(Z-k|0,0),j=Math.min(Z+k|0,C);Z=u[D+1]*v;var Q=Math.max(Z-k|0,0),le=Math.min(Z+k|0,x);Z=u[D+2]*v;for(var he=Math.max(Z-k|0,0),ve=Math.min(Z+k|0,w),re=he*E-u[D+2],Ie=he;Ie<=ve;++Ie,re+=E)for(var ge=Q*E-u[D+1],Se=Q;Se<=le;++Se,ge+=E){var Le=ge*ge+re*re;if(!(Le>=$))for(var be=_.getDirectIdx(K,Se,Ie),ye=S.getDirectIdx(K,Se,Ie),ce=K*E-u[D],ue=K;ue<=j;++ue,ce+=E,be+=T,ye+=P){var Ce=ce*ce+Le,Ve=-Ce*G,ie=Math.exp(Ve)*z;this._visibilitySelector!=null&&ie>I[be]&&(I[be]=ie,B[be]=a.atoms[W]),M[be]+=ie,ie*=h;var ae=W*3;R[ye]+=ie*f[ae],R[ye+1]+=ie*f[ae+1],R[ye+2]+=ie*f[ae+2]}}}}},{key:"_shiftByOrigin",value:function(r){for(var a=this.origin.x,s=this.origin.y,l=this.origin.z,c=4,u=r.length/c,f=0;f<u;++f){var p=f*c;r[p]-=a,r[p+1]-=s,r[p+2]-=l}}}]),e}(VolumeSurfaceGeometry);function AVHash(o,t,e,n){var r=4,a=o.length/r,s=t[0],l=t[1],c=t[2],u=e[0],f=e[1],p=e[2];function g(G,k){return Math.floor((G-k)/n)}var y=g(u,s)+1,E=g(f,l)+1,h=g(p,c)+1,v=y*E*h,C=E*h,x=function(k,$,Z){return(g(k,s)*E+g($,l))*h+g(Z,c)},w=[],_,S;for(_=0;_<a;_++){var M=r*_;S=x(o[M],o[M+1],o[M+2]),w[S]===void 0?w[S]=[_]:w[S].push(_)}var T=utils.allocateTyped(Uint32Array,v),R=utils.allocateTyped(Uint16Array,v),P=utils.allocateTyped(Uint32Array,a),I=0,B=0,W;for(_=0;_<v;_++){var D=T[_]=I,O=w[_];if(O!==void 0)for(W=0;W<O.length;W++)P[I]=O[W],I++;var z=I-D;R[_]=z,z>B&&(B=z)}this.neighbourListLength=27*B+1,this.withinRadii=function(G,k,$,Z,K){var j=0,Q=g(G,s),le=g(k,l),he=g($,c),ve=Math.max(0,Q-1),re=Math.max(0,le-1),Ie=Math.max(0,he-1),ge=Math.min(y-1,Q+1),Se=Math.min(E-1,le+1),Le=Math.min(h-1,he+1);for(_=ve;_<=ge;++_){var be=_*C;for(W=re;W<=Se;++W)for(var ye=W*h,ce=Ie;ce<=Le;++ce){S=be+ye+ce;for(var ue=T[S],Ce=ue+R[S],Ve=ue;Ve<Ce;Ve++){var ie=P[Ve],ae=r*ie,Ae=o[ae]-G,De=o[ae+1]-k,Be=o[ae+2]-$,ze=o[ae+3]+Z;Ae*Ae+De*De+Be*Be<=ze*ze&&(K[j++]=P[Ve])}}}K[j]=-1}}function ContactSurface(o,t,e,n){var r=4,a=o.posRad,s=o.colors,l=o.atoms,c=a.length/r,u=t.bbox,f=u.minPosRad,p=u.maxPosRad,g,y,E,h,v,C=-1,x,w,_,S,M=null,T=null,R=null,P,I,B,W,D,O,z,G=new Vector3(0,0,0),k=new Vector3(0,0,0),$=new Vector3(0,0,0),Z;function K(ue,Ce,Ve){for(var ie=utils.allocateTyped(ue,Ce),ae=0;ae<Ce;++ae)ie[ae]=Ve;return ie}function j(ue,Ce,Ve){for(var ie=0;ie<ue.length;ie++)ue[ie]=Ce+Ve*ie}function Q(){h=e.scaleFactor,x=t.dim,Z=Math.min(5,2+Math.floor(E*h));var ue=x[0]*x[1]*x[2];w=K(Float32Array,ue,-1001),_=utils.allocateTyped(Float32Array,ue*3),S=utils.allocateTyped(Float32Array,ue),R&&(M=utils.allocateTyped(Float32Array,ue),T=[]),P=utils.allocateTyped(Float32Array,x[0]),I=utils.allocateTyped(Float32Array,x[1]),B=utils.allocateTyped(Float32Array,x[2]),j(P,f[0],1/h),j(I,f[1],1/h),j(B,f[2],1/h)}function le(){var ue=0,Ce=2*Math.PI/v;D=utils.allocateTyped(Float32Array,v),W=utils.allocateTyped(Float32Array,v);for(var Ve=0;Ve<v;Ve++)D[Ve]=Math.cos(ue),W[Ve]=Math.sin(ue),ue+=Ce}function he(){O=new AVHash(a,f,p,2.01*y),z=new Int32Array(O.neighbourListLength)}function ve(){E=e.probeRadius,h=e.scaleFactor,v=e.probePositions,R=e.visibilitySelector,g=utils.allocateTyped(Float32Array,c),y=0;for(var ue=0;ue<c;++ue){var Ce=a[ue*r+3]+=E;Ce>y&&(y=Ce),g[ue]=Ce*Ce}Q(),le(),he(),C=-1}function re(ue,Ce,Ve,ie){var ae=r*ue,Ae=g[ue],De=a[ae]-Ce,Be=a[ae+1]-Ve,ze=a[ae+2]-ie,We=De*De+Be*Be+ze*ze;return We<Ae}function Ie(ue,Ce,Ve,ie,ae){var Ae;if(C!==-1){if(Ae=C,Ae!==ie&&Ae!==ae&&re(Ae,ue,Ce,Ve))return Ae;C=-1}var De=0;for(Ae=z[De];Ae>=0;){if(Ae!==ie&&Ae!==ae&&re(Ae,ue,Ce,Ve))return C=Ae,Ae;Ae=z[++De]}return C=-1,-1}function ge(){for(var ue=4,Ce=ue/3,Ve=1/(2*Ce*Ce),ie=0;ie<c;ie++){var ae=r*ie,Ae=a[ae],De=a[ae+1],Be=a[ae+2],ze=a[ae+3],We=g[ie];O.withinRadii(Ae,De,Be,ze,z);for(var $e=Math.ceil(ze*h),qe=Math.floor(h*(Ae-f[0])),et=Math.floor(h*(De-f[1])),F=Math.floor(h*(Be-f[2])),H=Math.max(0,qe-$e),X=Math.max(0,et-$e),oe=Math.max(0,F-$e),te=Math.min(x[0],qe+$e+2),Me=Math.min(x[1],et+$e+2),Te=Math.min(x[2],F+$e+2),q=ie*3,Ee=s[q],Pe=s[q+1],tt=s[q+2],Oe=oe;Oe<Te;Oe++)for(var Je=B[Oe]-Be,ee=x[1]*x[0]*Oe,Fe=X;Fe<Me;Fe++)for(var it=I[Fe]-De,U=Je*Je+it*it,ke=ee+x[0]*Fe,de=H;de<te;de++){var se=de+ke,fe=P[de]-Ae,je=U+fe*fe;if(je<We){var ht=Math.exp(-je*Ve),pt=se*3;_[pt]+=Ee*ht,_[pt+1]+=Pe*ht,_[pt+2]+=tt*ht,S[se]+=ht,R!==null&&ht>M[se]&&(M[se]=ht,T[se]=l[ie]),w[se]<0&&(w[se]=-w[se]);var dt=Math.sqrt(je),At=ze/dt,_e=fe*At,Xe=it*At,Ue=Je*At;if(_e+=Ae,Xe+=De,Ue+=Be,Ie(_e,Xe,Ue,ie,-1)===-1){var Ye=ze-dt;Ye<w[se]&&(w[se]=Ye)}}}}}function Se(ue,Ce){return ue.x=ue.y=ue.z=1,Ce.x!==0?ue.x=(Ce.y+Ce.z)/-Ce.x:Ce.y!==0?ue.y=(Ce.x+Ce.z)/-Ce.y:Ce.z!==0&&(ue.z=(Ce.x+Ce.y)/-Ce.z),ue}function Le(ue,Ce){var Ve=r*ue,ie=r*Ce,ae=a[Ve],Ae=a[Ve+1],De=a[Ve+2],Be=a[Ve+3],ze=G.x=a[ie]-ae,We=G.y=a[ie+1]-Ae,$e=G.z=a[ie+2]-De,qe=a[ie+3],et=ze*ze+We*We+$e*$e,F=Math.sqrt(et),H=(Be*Be+F*F-qe*qe)/(2*Be*F),X=Be*H;G.normalize(),Se(k,G),k.normalize(),$.crossVectors(G,k),$.normalize();var oe=Math.sqrt(Be*Be-X*X);k.multiplyScalar(oe),$.multiplyScalar(oe),G.multiplyScalar(X),G.x+=ae,G.y+=Ae,G.z+=De,C=-1;for(var te=Z,Me=0;Me<v;Me++){var Te=D[Me],q=W[Me],Ee=G.x+Te*k.x+q*$.x,Pe=G.y+Te*k.y+q*$.y,tt=G.z+Te*k.z+q*$.z;if(Ie(Ee,Pe,tt,ue,Ce)===-1)for(var Oe=Math.floor(h*(Ee-f[0])),Je=Math.floor(h*(Pe-f[1])),ee=Math.floor(h*(tt-f[2])),Fe=Math.max(0,Oe-te),it=Math.max(0,Je-te),U=Math.max(0,ee-te),ke=Math.min(x[0],Oe+te+2),de=Math.min(x[1],Je+te+2),se=Math.min(x[2],ee+te+2),fe=U;fe<se;fe++){$e=tt-B[fe];for(var je=x[1]*x[0]*fe,ht=it;ht<de;ht++){We=Pe-I[ht];for(var pt=$e*$e+We*We,dt=je+x[0]*ht,At=Fe;At<ke;At++){ze=Ee-P[At],et=pt+ze*ze;var _e=At+dt,Xe=w[_e];Xe>0&&et<Xe*Xe&&(w[_e]=Math.sqrt(et))}}}}}function be(){for(var ue=0;ue<c;ue++){var Ce=r*ue;O.withinRadii(a[Ce],a[Ce+1],a[Ce+2],a[Ce+3],z);for(var Ve=0,ie=z[Ve];ie>=0;)ue<ie&&Le(ue,ie),ie=z[++Ve]}}function ye(){for(var ue=0,Ce=w.length;ue<Ce;ue++){w[ue]<0&&(w[ue]=0);var Ve=S[ue];if(Ve>0){Ve=1/Ve;var ie=ue*3;_[ie]*=Ve,_[ie+1]*=Ve,_[ie+2]*=Ve}}}function ce(){console.time("ContactSurface.getVolume"),console.time("ContactSurface.init"),ve(),console.timeEnd("ContactSurface.init"),console.time("ContactSurface.projectPoints"),ge(),console.timeEnd("ContactSurface.projectPoints"),console.time("ContactSurface.projectTorii"),be(),console.timeEnd("ContactSurface.projectTorii"),ye(),console.timeEnd("ContactSurface.getVolume")}this.build=function(){ce(),this.volTexMap=_,this.weightsMap=M,this.atomMap=T,this.volMap=w}}function _createSuper$1A(o){var t=_isNativeReflectConstruct$1A();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Volume=chem.Volume,ContactSurfaceGeometry=function(o){_inherits(e,o);var t=_createSuper$1A(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_computeSurface",value:function(r,a,s,l){var c=new ContactSurface(r,s,l);c.build();var u={volMap:new Volume(Float32Array,this.numVoxels,a,1,c.volMap),volTexMap:new Volume(Float32Array,this.numVoxels,a,3,c.volTexMap),atomMap:c.atomMap,atomWeightMap:new Volume(Float32Array,this.numVoxels,a,1,c.weightsMap)};return u}}]),e}(VolumeSurfaceGeometry),IsoSurfaceAtomColored=_createClass(function o(t,e){_classCallCheck(this,o),this.coord=new Vector3,this.coord.copy(t),this.radius=e,this.colorX=.99999,this.colorY=0,this.colorZ=0,this.atomType=0,this.srcAtom=null}),IsosurfaceBuildNormals=function(){function o(t,e,n,r,a){_classCallCheck(this,o),this._numAtoms=t,this._atoms=e,this._vBoxMin=new Vector3,this._vBoxMax=new Vector3,this._vBoxMin.copy(n),this._vBoxMax.copy(r),this._probeRadius=a,this._atomsList=null,this._voxelList=null}return _createClass(o,[{key:"createVoxels",value:function(){var e,n,r=4.5,a=this._numAtoms|0,s=this._atoms,l=this._vBoxMax.x-this._vBoxMin.x,c=this._vBoxMax.y-this._vBoxMin.y,u=this._vBoxMax.z-this._vBoxMin.z,f=l<c?l:c;f=u<f?u:f;var p=0,g=0,y;for(y=0;y<a;y++)n=(s[y].radius+this._probeRadius)*2,p=n>p?n:p,g+=n;var E=Math.floor(f/p);E<2&&(E=2),g/=a,this._numCells=E,this._aveRad=g,this._maxRad=p;var h=E,v=E*E,C=E*E*E,x=this._xScale=1/(this._vBoxMax.x-this._vBoxMin.x),w=this._yScale=1/(this._vBoxMax.y-this._vBoxMin.y),_=this._zScale=1/(this._vBoxMax.z-this._vBoxMin.z),S=0,M=x*E,T=w*E,R=_*E;for(y=0;y<a;y++){var P=(s[y].radius+this._probeRadius)*r,I=P*2,B=Math.floor(M*I+.8),W=Math.floor(T*I+.8),D=Math.floor(R*I+.8);B++,W++,D++,S+=B*W*D}this._voxelList=utils.allocateTyped(Int32Array,C);var O=[];if(O.length=S,this._voxelList===null||O===null)return-1;for(y=0;y<C;y++)this._voxelList[y]=-1;for(e=0,y=0;y<a;y++){n=(s[y].radius+this._probeRadius)*r;var z=Math.floor((s[y].coord.x-this._vBoxMin.x-n)*E*x),G=Math.floor((s[y].coord.y-this._vBoxMin.y-n)*E*w),k=Math.floor((s[y].coord.z-this._vBoxMin.z-n)*E*_),$=Math.floor((s[y].coord.x-this._vBoxMin.x+n)*E*x),Z=Math.floor((s[y].coord.y-this._vBoxMin.y+n)*E*w),K=Math.floor((s[y].coord.z-this._vBoxMin.z+n)*E*_);z=z>=0?z:0,G=G>=0?G:0,k=k>=0?k:0,$=$<E?$:E-1,Z=Z<E?Z:E-1,K=K<E?K:E-1;for(var j=k;j<=K;j++)for(var Q=G;Q<=Z;Q++)for(var le=z;le<=$;le++){var he=le+Q*h+j*v;if(this._voxelList[he]<0){O[e*2+0]=y,O[e*2+1]=-1,this._voxelList[he]=e,e++;continue}var ve=this._voxelList[he];this._voxelList[he]=e,O[e*2+0]=y,O[e*2+1]=ve,e++}}return this._atomsList=Int32Array.from(O),0}},{key:"destroyVoxels",value:function(){this._atomsList=null,this._voxelList=null,this._atoms=null,this._vertices=null,this._vBoxMin=null,this._vBoxMax=null}},{key:"forEachRelatedAtom",value:function(e,n){for(var r=Math.floor((e.x-this._vBoxMin.x)*this._numCells*this._xScale),a=Math.floor((e.y-this._vBoxMin.y)*this._numCells*this._yScale),s=Math.floor((e.z-this._vBoxMin.z)*this._numCells*this._zScale),l=r+a*this._numCells+s*this._numCells*this._numCells,c=this._atoms,u=this._voxelList[l];u>=0;u=this._atomsList[u*2+1]){var f=this._atomsList[u*2];n(c[f])}}},{key:"getClosestAtom",value:function(e){var n=null,r=Number.MAX_VALUE;return this.forEachRelatedAtom(e,function(a){var s=e.distanceToSquared(a.coord);s<r&&(r=s,n=a)}),n}},{key:"buildNormals",value:function(e,n,r){for(var a=this,s=0,l=0,c=0,u=0,f,p=0,g=0,y=0,E=0,h=0,v=2.5,C=.1,x=this._aveRad*v,w=x*x,_=-this._aveRad*C,S=function(R){var P=l-R.coord.x,I=c-R.coord.y,B=u-R.coord.z;if(f=P*P+I*I+B*B,!(f>w)){var W=R.radius+a._probeRadius;E=f-W*W,E<0&&(E=-E),h=Math.exp(_*E),p+=P*h,g+=I*h,y+=B*h,s++}},M=0;M<e;M++)l=n[M].x,c=n[M].y,u=n[M].z,s=0,p=g=y=0,this.forEachRelatedAtom(n[M],S),f=p*p+g*g+y*y,s>0&&(E=1/Math.sqrt(f),p*=E,g*=E,y*=E),r[M].x=p,r[M].y=g,r[M].z=y;return 0}},{key:"buildColors",value:function(e,n,r,a){for(var s=this,l=0,c=0,u=0,f=0,p=0,g=.8,y=a,E=y*y,h=[],v=[],C=0,x=function(T){var R=l-T.coord.x,P=c-T.coord.y,I=u-T.coord.z,B=R*R+P*P+I*I;if(!(B>E)){var W=T.radius+s._probeRadius;f=B-W*W,f<0&&(f=-f),p=1/(g+f),h.push([T.colorX,T.colorY,T.colorZ]),v.push(p),C+=p}},w=0;w<e;w++){l=n[w].x,c=n[w].y,u=n[w].z,h=[],v=[],C=0,this.forEachRelatedAtom(n[w],x);for(var _=0;_<h.length;++_){var S=v[_]/C;r[w].x+=h[_][0]*S,r[w].y+=h[_][1]*S,r[w].z+=h[_][2]*S}}return 0}}]),o}(),IsoSurfaceGeo=function(){function o(t,e,n){_classCallCheck(this,o),this._maxNumVertices=t,this._maxNumTriangles=e,this._vertices=new Array(t),this._normals=new Array(t),this._colors=null,n&&(this._colors=new Array(t)),this._indices=new Array(e*3),this._numVertices=0,this._numTriangles=0;var r;for(r=0;r<t;r++)this._vertices[r]=new Vector3,this._normals[r]=new Vector3;for(r=0;r<e*3;r++)this._indices[r]=-1;if(n)for(r=0;r<t;r++)this._colors[r]=new Vector3}return _createClass(o,[{key:"destroy",value:function(){this._vertices=null,this._normals=null,this._indices=null}}]),o}();function _createSuper$1z(o){var t=_isNativeReflectConstruct$1z();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var COLOR_SIZE=3,HASH_SIZE=32768,Element$9=chem.Element,SSIsosurfaceGeometry=function(o){_inherits(e,o);var t=_createSuper$1z(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_build",value:function(){this._innerBuild();var r=this.getGeo();this.destroy(),this._fromGeo(r)}},{key:"_fromGeo",value:function(r){var a=null,s=utils.allocateTyped(Float32Array,3*r._numVertices),l=utils.allocateTyped(Float32Array,3*r._numVertices);r._colors!==null&&(a=utils.allocateTyped(Float32Array,3*r._numVertices));for(var c=utils.allocateTyped(Uint32Array,3*r._numTriangles),u=0,f=0;u<r._numVertices;u++)s[f+0]=r._vertices[u].x,s[f+1]=r._vertices[u].y,s[f+2]=r._vertices[u].z,l[f+0]=r._normals[u].x,l[f+1]=r._normals[u].y,l[f+2]=r._normals[u].z,f+=3;if(a!==null)for(var p=0,g=0;p<r._numVertices;p++,g+=3)a[g+0]=r._colors[p].x,a[g+1]=r._colors[p].y,a[g+2]=r._colors[p].z;for(var y=r._numTriangles*3,E=0;E<y;E++)c[E]=r._indices[E];this.setIndex(new BufferAttribute(c,1)),this.setAttribute("position",new BufferAttribute(s,3)),this.setAttribute("normal",new BufferAttribute(l,3)),this.setAttribute("color",new BufferAttribute(a,3)),this.computeBoundingBox(),this.computeBoundingSphere(),r.destroy()}},{key:"convertToAtomsColored",value:function(r,a){for(var s=r.atoms,l=r.colors,c=0,u=s.length;c<u;c++){var f=s[c].position,p=s[c].element.radius;a[c]=new IsoSurfaceAtomColored(f,p);var g=s[c].element.number;a[c].atomType=this.getType(g);var y=COLOR_SIZE*c;a[c].colorX=l[y++],a[c].colorY=l[y++],a[c].colorZ=l[y],a[c].srcAtom=s[c]}}},{key:"getGeo",value:function(){return this.geoOut}},{key:"destroy",value:function(){this.atoms=null,this.hashLines=null,this.hashEntries=null}},{key:"getBoundingBox",value:function(r,a,s){var l=1e7;a.x=a.y=a.z=l,s.x=s.y=s.z=0-l;for(var c=this.probeRadius*this.atomRadiusScale,u=0,f=0,p=r.length;f<p;f++){var g=r[f].coord,y=r[f].radius+c;u=y>u?y:u,g.x-y<a.x&&(a.x=g.x-y),g.y-y<a.y&&(a.y=g.y-y),g.z-y<a.z&&(a.z=g.z-y),g.x+y>s.x&&(s.x=g.x+y),g.y+y>s.y&&(s.y=g.y+y),g.z+y>s.z&&(s.z=g.z+y)}a.x-=u,a.y-=u,a.z-=u,s.x+=u,s.y+=u,s.z+=u}},{key:"getCornerCoord",value:function(r,a,s,l,c,u,f){var p=1/(u-1),g=s*p,y=l*p,E=c*p;f.x=r.x*(1-g)+a.x*g,f.y=r.y*(1-y)+a.y*y,f.z=r.z*(1-E)+a.z*E}},{key:"buildEdgePoint",value:function(r,a,s,l,c,u){if(s[r]^s[a]){var f=24,p=0-l.pointsValuesLinear[c+f+r],g=l.pointsValuesLinear[c+f+a],y=l.pointsValuesLinear[c+f+r],E=p/(g-y),h=l.pointsValuesLinear[c+r*3+0],v=l.pointsValuesLinear[c+r*3+1],C=l.pointsValuesLinear[c+r*3+2],x=l.pointsValuesLinear[c+a*3+0],w=l.pointsValuesLinear[c+a*3+1],_=l.pointsValuesLinear[c+a*3+2];u.x=h*(1-E)+x*E,u.y=v*(1-E)+w*E,u.z=C*(1-E)+_*E}}},{key:"isTriangleVisible",value:function(r,a,s){var l=this.voxelWorld.getClosestAtom(r),c=this.voxelWorld.getClosestAtom(a),u=this.voxelWorld.getClosestAtom(s);return l===null||c===null||u===null||l.srcAtom===null||c.srcAtom===null||u.srcAtom===null?!1:this.visibilitySelector.includesAtom(l.srcAtom)&&this.visibilitySelector.includesAtom(c.srcAtom)&&this.visibilitySelector.includesAtom(u.srcAtom)}},{key:"addTriangle",value:function(r,a,s){if(this.visibilitySelector&&!this.isTriangleVisible(r,a,s))return!0;var l=this.geoOut;if(l._numTriangles>=this.maxNumTriangles)return!1;var c=this.addVertexToGeo(l,r),u=this.addVertexToGeo(l,a),f=this.addVertexToGeo(l,s);if((c|u|f)<0)return!1;var p=3*l._numTriangles;return l._indices[p+0]=c,l._indices[p+1]=u,l._indices[p+2]=f,l._numTriangles++,!0}},{key:"buildGeoFromCorners",value:function(r,a,s,l,c,u){for(var f=12,p=8,g=r-1,y=r,E=r*r,h=new Array(f),v=0;v<f;v++)h[v]=new Vector3;for(var C=[],x=0;x<p;x++)C[x]=1;for(var w=new Vector3,_=0,S=0,M=0;M<g;M++,S+=E)for(var T=0,R=0;R<g;R++,T+=y)for(var P=0;P<g;P++){if(!u.hasIntersection[_]){_++;continue}var I=u.bitsInside[_];this.getCornerCoord(a,s,P,M,R,r,w);for(var B=_*32,W=0,D=0;W<p;W++)u.pointsValuesLinear[B+D++]=w.x,u.pointsValuesLinear[B+D++]=w.y,u.pointsValuesLinear[B+D++]=w.z;u.pointsValuesLinear[B+3]+=c.x,u.pointsValuesLinear[B+2*3]+=c.x,u.pointsValuesLinear[B+5*3]+=c.x,u.pointsValuesLinear[B+6*3]+=c.x,u.pointsValuesLinear[B+2*3+2]+=c.z,u.pointsValuesLinear[B+3*3+2]+=c.z,u.pointsValuesLinear[B+6*3+2]+=c.z,u.pointsValuesLinear[B+7*3+2]+=c.z,u.pointsValuesLinear[B+4*3+1]+=c.y,u.pointsValuesLinear[B+5*3+1]+=c.y,u.pointsValuesLinear[B+6*3+1]+=c.y,u.pointsValuesLinear[B+7*3+1]+=c.y;for(var O=B+24,z=0;z<p;++z)C[z]=u.pointsValuesLinear[O+z]<0?1:0;this.buildEdgePoint(0,1,C,u,B,h[0]),this.buildEdgePoint(1,2,C,u,B,h[1]),this.buildEdgePoint(2,3,C,u,B,h[2]),this.buildEdgePoint(3,0,C,u,B,h[3]),this.buildEdgePoint(4,5,C,u,B,h[4]),this.buildEdgePoint(5,6,C,u,B,h[5]),this.buildEdgePoint(6,7,C,u,B,h[6]),this.buildEdgePoint(7,4,C,u,B,h[7]),this.buildEdgePoint(0,4,C,u,B,h[8]),this.buildEdgePoint(1,5,C,u,B,h[9]),this.buildEdgePoint(2,6,C,u,B,h[10]),this.buildEdgePoint(3,7,C,u,B,h[11]);for(var G=I*16,k=0,$=0;k<6;k++,$+=3){var Z=u.striIndicesMarchCube[G+$];if(Z<0)break;var K=u.striIndicesMarchCube[G+$+1],j=u.striIndicesMarchCube[G+$+2];if(!this.addTriangle(h[Z],h[K],h[j]))return-2}_++}return 0}},{key:"getNumIntersectedCells",value:function(r,a,s,l){for(var c=r*r,u=8,f=0,p=0,g=0,y=0;y<a;y++,g+=c)for(var E=0,h=0;h<a;h++,E+=r)for(var v=0;v<a;v++){var C=p*32+24,x=v+E+g;l.pointsValuesLinear[C]=s[x],l.pointsValuesLinear[C+1]=s[x+1],l.pointsValuesLinear[C+2]=s[x+r+1],l.pointsValuesLinear[C+3]=s[x+r],l.pointsValuesLinear[C+4]=s[c+x],l.pointsValuesLinear[C+5]=s[c+x+1],l.pointsValuesLinear[C+6]=s[c+x+r+1],l.pointsValuesLinear[C+7]=s[c+x+r];for(var w=0,_=0;_<u;++_)l.pointsValuesLinear[C+_]<0&&(w|=1<<_);w===0||w===(1<<u)-1?l.hasIntersection[p]=!1:(l.hasIntersection[p]=!0,f++),l.bitsInside[p]=w,p++}return f}},{key:"getType",value:function(r){var a=[0,0,1,1,2,6,3,6,4,6,5,6,6,0,7,3,8,2,9,6,10,6,11,6,12,6,13,6,14,6,15,4,16,5,17,6,18,6,19,6,20,6,21,6,22,6,23,6,24,6,25,6,26,6,27,6,28,6,29,6,30,6,31,6,32,6,33,6,34,6,35,6,36,6,37,6,38,6,39,6,40,6,41,6,42,6,43,6,44,6,45,6,46,6,47,6,48,6,49,6,50,6,51,6,52,6,53,6,54,6,55,6,56,6,57,6,58,6,59,6,60,6,61,6,62,6,63,6,64,6,65,6,66,6,67,6,68,6,69,6,70,6,71,6,72,6,73,6,74,6,75,6,76,6,77,6,78,6,79,6,80,6,81,6,82,6,83,6,84,6,85,6,86,6,87,6,88,6,89,6,90,6,91,6,92,6,93,6,94,6,95,6,96,6,97,6,98,6,99,6,100,6,101,6,102,6,103,6,104,6,105,6,106,6,107,6,108,6,109,6];if(r<1||r>a.length/2||Object.keys(Element$9.ByAtomicNumber).length*2!==a.length)throw new Error("atomT.length  should be equal Element.ByAtomicNumber.length * 2");return a[r*2]}},{key:"calculateGridCorners",value:function(r,a,s,l,c,u){for(var f=a*a,p=f*a,g=new Vector3,y=new Vector3,E=1e12,h=0;h<p;h++)r[h]=E;for(var v=(a-1)/(l.x-s.x),C=(a-1)/(l.y-s.y),x=(a-1)/(l.z-s.z),w=0,_=c.length;w<_;w++){var S=c[w],M=S.radius+u,T=(S.coord.x-M-s.x)*v,R=(S.coord.y-M-s.y)*C,P=(S.coord.z-M-s.z)*x,I=Math.floor(T),B=Math.floor(R),W=Math.floor(P),D=Math.floor((S.coord.x+M-s.x)*v),O=Math.floor((S.coord.y+M-s.y)*C),z=Math.floor((S.coord.z+M-s.z)*x);D++,O++,z++,D=D<=a-1?D:a-1,O=O<=a-1?O:a-1,z=z<=a-1?z:a-1;for(var G=B;G<=O;G++)for(var k=G*f,$=W;$<=z;$++)for(var Z=$*a,K=I;K<=D;K++){var j=k+Z+K;this.getCornerCoord(s,l,K,G,$,a,g),y.x=g.x-S.coord.x,y.y=g.y-S.coord.y,y.z=g.z-S.coord.z;var Q=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z),le=Q-M;le<r[j]&&(r[j]=le)}}}},{key:"createVertexHash",value:function(r,a){if(this.hashLines=utils.allocateTyped(Int32Array,HASH_SIZE*2),this.hashLines===null)return-1;for(var s=0,l=0;s<HASH_SIZE;s++)this.hashLines[l++]=0,this.hashLines[l++]=-1;if(this.maxNumVertices=r,this.maxNumTriangles=a,this.numHashEtriesAllocated=r,this.hashEntries=utils.allocateTyped(Int32Array,2*this.numHashEtriesAllocated),this.hashEntries===null)return-1;for(var c=0,u=0;c<this.numHashEtriesAllocated;c++)this.hashEntries[u++]=-1,this.hashEntries[u++]=-1;return this.numHashEntryIndex=0,0}},{key:"getNewHashEntry",value:function(){if(this.numHashEntryIndex<this.numHashEtriesAllocated){var r=this.numHashEntryIndex;return this.numHashEntryIndex++,r}return-1}},{key:"addVertexToGeo",value:function(r,a){var s,l=.01,c=815851,u=37633,f=2453543,p=1e-6,g=this.marCubeResoultion<<2,y=new Vector3,E=Math.floor(g*(a.x-this.vBoxMin.x)/(this.vBoxMax.x+l-this.vBoxMin.x)),h=Math.floor(g*(a.y-this.vBoxMin.y)/(this.vBoxMax.y+l-this.vBoxMin.y)),v=Math.floor(g*(a.z-this.vBoxMin.z)/(this.vBoxMax.z+l-this.vBoxMin.z)),C=E*c+v*u+h*f;C&=HASH_SIZE-1;var x=C+C;if(this.vBoxMin!==null&&this.vBoxMax!==null)for(s=this.hashLines[x+1];s>=0;s=this.hashEntries[s*2+1]){var w=this.hashEntries[s*2+0];y.copy(r._vertices[w]),y.x-=a.x,y.y-=a.y,y.z-=a.z;var _=y.x*y.x+y.y*y.y+y.z*y.z;if(_<p)return w}if(r._numVertices>=this.maxNumVertices)return-1;var S=r._numVertices;if(r._vertices[S].copy(a),this.vBoxMin!==null&&this.vBoxMax!==null){if(s=this.getNewHashEntry(),s<0)return-1;var M=this.hashLines[x+1];this.hashLines[x+1]=s,this.hashEntries[s*2+0]=S,this.hashEntries[s*2+1]=M,this.hashLines[x+0]++}return r._numVertices++,S}},{key:"modifyExcludedFromGeo",value:function(r,a,s,l,c,u){var f,p,g,y=1.1;function E(){g>0&&u[f]<0&&(u[f]=g),g>u[f]&&(u[f]=g)}for(var h=r*r,v=(r-1)/(l.x-s.x),C=(r-1)/(l.y-s.y),x=(r-1)/(l.z-s.z),w=a*2*(a*2),_=1/(r-1),S=0;S<c._numVertices;S++){var M=c._vertices[S],T=a*y,R=Math.floor((M.x-T-s.x)*v),P=Math.floor((M.y-T-s.y)*C),I=Math.floor((M.z-T-s.z)*x),B=Math.floor((M.x+T-s.x)*v),W=Math.floor((M.y+T-s.y)*C),D=Math.floor((M.z+T-s.z)*x);R=R>=0?R:0,P=P>=0?P:0,I=I>=0?I:0,B=B<=r-1?B:r-1,W=W<=r-1?W:r-1,D=D<=r-1?D:r-1;for(var O=P;O<=W;O++)for(var z=O*h,G=I;G<=D;G++)for(var k=G*r,$=R;$<=B;$++){f=z+k+$;var Z=$*_,K=s.x*(1-Z)+l.x*Z;Z=O*_;var j=s.y*(1-Z)+l.y*Z;Z=G*_;var Q=s.z*(1-Z)+l.z*Z,le=K-M.x,he=j-M.y,ve=Q-M.z,re=le*le+he*he+ve*ve;re<w&&(p=Math.sqrt(re),g=-(p-a),E())}}return 0}},{key:"_innerBuild",value:function(){var r,a=1.2,s={posRad:this._posRad,colors:this._colors,atoms:this._opts.atoms};this.complex=this._opts.parent,this.atoms=s.atoms,this.meshResolution=this._opts.gridSpacing,this.atomRadiusScale=this._opts.radScale,this.colorMode=this._opts.colorMode,this.probeRadius=this._opts.probeRadius,this.useVertexColors=!0,this.excludeProbe=this._opts.excludeProbe,this.visibilitySelector=this._opts.visibilitySelector,this.geoOut=null,this.hashLines=null,this.hashEntries=null,this.numHashEtriesAllocated=0,this.numHashEntryIndex=0,this.maxNumVertices=0,this.maxNumTriangles=0;var l=new Array(this.atoms.length);this.convertToAtomsColored(s,l);var c=this.vBoxMin=new Vector3,u=this.vBoxMax=new Vector3;this.getBoundingBox(l,c,u);var f=this.marCubeResoultion=this.meshResolution*4,p=f,g=p*p,y=g*p,E=utils.allocateTyped(Float32Array,y),h=this.probeRadius*this.atomRadiusScale;this.calculateGridCorners(E,p,c,u,l,h);var v=f-1,C=new IsoSurfaceMarchCube;if(r=C.create(v),r<0)return r;var x=new Vector3;x.x=(u.x-c.x)/v,x.y=(u.y-c.y)/v,x.z=(u.z-c.z)/v;var w=this.getNumIntersectedCells(p,v,E,C),_=Math.floor(w*a),S=Math.floor(w*a*2);if(this.geoOut=new IsoSurfaceGeo(_,S,this.useVertexColors),r=this.createVertexHash(_,S),r<0)return r;var M=h;if(this.excludeProbe&&(M=.01),this.voxelWorld=new IsosurfaceBuildNormals(l.length,l,c,u,M),this.voxelWorld.createVoxels(),r=this.buildGeoFromCorners(f,c,u,E,x,C),this.excludeProbe){if(this.modifyExcludedFromGeo(p,h,c,u,this.geoOut,E),this.geoOut._vertices=null,this.geoOut._colors=null,this.geoOut._indices=null,this.geoOut._normals=null,this.geoOut._numVertices=0,this.geoOut._numTriangles=0,this.geoOut=null,w=this.getNumIntersectedCells(p,v,E,C),_=Math.floor(w*a),S=Math.floor(w*a*2),this.geoOut=new IsoSurfaceGeo(_,S,this.useVertexColors),r=this.createVertexHash(_,S),r<0)return r;r=this.buildGeoFromCorners(p,c,u,E,x,C)}this.voxelWorld.buildNormals(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._normals);var T=6.5;return this.excludeProbe&&(T-=1.5),this.useVertexColors&&this.voxelWorld.buildColors(this.geoOut._vertices.length,this.geoOut._vertices,this.geoOut._colors,T),this.voxelWorld.destroyVoxels(),this.voxelWorld=null,C.destroy(),r}}]),e}(IsoSurfaceGeometry);function _createSuper$1y(o){var t=_isNativeReflectConstruct$1y();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function createLabel(o,t){var e=document.createElement("div");if(e.className=t,typeof o=="string"){var n=document.createElement("span");n.style.fontSize="150%";for(var r=o.split(`
`),a=0,s=r.length;a<s;++a){var l=document.createElement("span"),c=document.createTextNode(r[a]);l.appendChild(c),n.appendChild(l),a<s-1&&n.appendChild(document.createElement("br"))}e.appendChild(n)}else e.appendChild(o);return e.worldPos=new Vector3,e}var LabelsGeometry=function(o){_inherits(e,o);var t=_createSuper$1y(e);function e(n,r){var a;_classCallCheck(this,e),a=t.call(this),a._opts=r,a.items=[],a.needsUpdate=!1;var s=-50,l=-50;switch(r.horizontalAlign){case"left":s=0;break;case"right":s=-100;break}switch(r.verticalAlign){case"top":l=-100;break;case"bottom":l=0;break}var c=new Vector3(r.dx||0,r.dy||0,r.dz||0);return a.userData={translation:"translate(".concat(s,"%, ").concat(l,"%)"),offset:c},a}return _createClass(e,[{key:"setItem",value:function(r,a,s){var l=this._opts,c=this.items[r]||createLabel(s,"label");c.worldPos.copy(a),c.style.textAlign=l.horizontalAlign,c.style.verticalAlign=l.verticalAlign,this.items[r]=c}},{key:"setColor",value:function(r,a,s){var l=this.items[r];l.opts={color:a,background:s}}},{key:"startUpdate",value:function(){return!0}},{key:"finishUpdate",value:function(){this.needsUpdate=!0,this.dispatchEvent({type:"update"})}},{key:"finalize",value:function(){this.finishUpdate()}},{key:"raycast",value:function(){}},{key:"setOpacity",value:function(){}},{key:"getSubset",value:function(){return[]}}]),e}(EventDispatcher),geometries={InstancedSpheresGeometry,SimpleSpheresGeometry,Simple2CCylindersGeometry,Instanced2CCylindersGeometry,ExtrudedObjectsGeometry,ChunkedLinesGeometry,TwoColorLinesGeometry,CrossGeometry,QuickSurfGeometry,ContactSurfaceGeometry,SSIsosurfaceGeometry,LabelsGeometry},vertexShader=`float INSTANCED_SPRITE_OVERSCALE = 1.3;\r
\r
attribute vec3 normal;\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  varying vec3 viewNormal;\r
#endif\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  varying vec3 vNormal;\r
#endif\r
\r
#ifdef THICK_LINE\r
  attribute vec4 position; // W contains vert pos or neg offset\r
#else\r
  attribute vec3 position;\r
#endif\r
\r
varying vec3 vWorldPosition;\r
varying vec3 vViewPosition;\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  attribute float alphaColor;\r
  varying float alphaCol;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r
		varying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  attribute vec3 color;\r
  varying vec3 vColor;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  attribute vec3 color2;\r
  varying vec3 vColor2;\r
  attribute vec2 uv;\r
  #ifndef CYLINDER_SPRITE\r
    varying vec2 vUv;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_POS\r
  attribute vec4 offset;\r
  #ifdef SPHERE_SPRITE\r
    varying vec4 instOffset;\r
  varying vec4 spritePosEye;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  attribute vec4 matVector1;\r
  attribute vec4 matVector2;\r
  attribute vec4 matVector3;\r
  attribute vec4 invmatVector1;\r
  attribute vec4 invmatVector2;\r
  attribute vec4 invmatVector3;\r
\r
  #ifdef CYLINDER_SPRITE\r
    varying vec4 matVec1;\r
    varying vec4 matVec2;\r
    varying vec4 matVec3;\r
    varying vec4 invmatVec1;\r
    varying vec4 invmatVec2;\r
    varying vec4 invmatVec3;\r
    varying vec4 spritePosEye;\r
  #endif\r
#endif\r
\r
uniform mat4 modelViewMatrix; // optional\r
uniform mat4 projectionMatrix; // optional\r
uniform mat3 normalMatrix; // optional\r
uniform mat4 modelMatrix; // optional\r
\r
#ifdef DASHED_LINE\r
  attribute float lineDistance;\r
  varying float vLineDistance;\r
#endif\r
\r
#ifdef THICK_LINE\r
  attribute vec3 direction;\r
  uniform mat4 projMatrixInv;\r
  uniform vec2 viewport;\r
  uniform float lineWidth;\r
\r
  vec4 transform(vec4 coord){\r
    return projectionMatrix * modelViewMatrix * coord;\r
  }\r
\r
  vec2 project(vec4 device){\r
    vec3 device_normal = device.xyz/device.w;\r
    vec2 clip_pos = (device_normal*0.5+0.5).xy;\r
    return clip_pos * viewport;\r
  }\r
\r
  vec4 unproject(vec2 screen, float z, float w){\r
    vec2 clip_pos = screen/viewport;\r
    vec2 device_normal = clip_pos*2.0-1.0;\r
    return vec4(device_normal*w, z, w);\r
  }\r
#endif\r
\r
\r
/////////////////////////////////////////// Main ///////////////////////////////////////////////\r
void main() {\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  alphaCol = alphaColor;\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  vec3 objectNormal = vec3(\r
    dot(normal, matVector1.xyz),\r
    dot(normal, matVector2.xyz),\r
    dot(normal, matVector3.xyz));\r
#else\r
  vec3 objectNormal = vec3( normal );\r
#endif\r
\r
vec3 transformedNormal = normalMatrix * objectNormal;\r
\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  vNormal = normalize(transformedNormal);\r
#endif\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  viewNormal = normalize(mat3(modelViewMatrix)*objectNormal);\r
#endif\r
\r
  vec4 localPos = vec4(position.xyz, 1.0);\r
  vec4 worldPos = modelMatrix * localPos;\r
  vec4 mvPosition = modelViewMatrix * localPos;\r
\r
// make thick line offset\r
#ifdef THICK_LINE\r
   // get screen pos\r
   vec4 dPos = transform(vec4(position.xyz, 1.0));\r
   vec2 sPos = project(dPos);\r
   // move pos forward\r
   vec3 position2 = position.xyz + direction.xyz * 0.5;\r
   // get screen offset pos\r
   vec4 dPos2 = transform(vec4(position2.xyz, 1.0));\r
   vec2 sPos2 = project(dPos2);\r
   // screen line direction\r
   vec2 sDir = normalize(sPos2 - sPos);\r
   // vertex offset (orthogonal to line direction)\r
   vec2 offset1 = vec2(-sDir.y, sDir.x);\r
   // move screen vertex\r
   vec2 newPos = sPos + offset1 * position.w * lineWidth;\r
   // get moved pos in view space\r
   vec4 dNewPos =  unproject(newPos, dPos.z, dPos.w);\r
   mvPosition.xyz = (projMatrixInv * dNewPos).xyz;\r
#endif // THICK_LINE\r
\r
#ifdef INSTANCED_POS\r
  #ifdef SPHERE_SPRITE\r
    instOffset = offset;\r
\r
    vec4 posEye = modelViewMatrix * vec4( offset.xyz, 1.0 );\r
    float scale = length(modelViewMatrix[0]);\r
    mvPosition = posEye + vec4( position.xyz * offset.w * scale * INSTANCED_SPRITE_OVERSCALE, 0.0 );\r
    posEye.w = offset.w * scale;\r
\r
    spritePosEye = posEye;\r
 #else\r
    localPos = vec4( offset.xyz + position.xyz * offset.w, 1.0 );\r
    worldPos = modelMatrix * localPos;\r
    mvPosition = modelViewMatrix * localPos;\r
  #endif\r
#endif\r
\r
#ifdef INSTANCED_MATRIX\r
  #ifdef CYLINDER_SPRITE\r
    matVec1 = matVector1;\r
    matVec2 = matVector2;\r
    matVec3 = matVector3;\r
    invmatVec1 = invmatVector1;\r
    invmatVec2 = invmatVector2;\r
    invmatVec3 = invmatVector3;\r
\r
    // calculate eye coords of cylinder endpoints\r
    vec4 v = vec4(0, -0.5, 0, 1);\r
    vec4 p1 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r
    v.y = 0.5;\r
    vec4 p2 = modelViewMatrix * vec4(dot(v, matVector1), dot(v, matVector2), dot(v, matVector3), 1.0);\r
\r
    // sprite is placed at the center of cylinder\r
    vec4 posEye;\r
    posEye.xyz = mix(p1.xyz, p2.xyz, 0.5);\r
    posEye.w = 1.0;\r
    spritePosEye = posEye;\r
\r
    // cylinder radius in eye space\r
    float rad = length(modelViewMatrix[0]) * length(vec3(matVector1.x, matVector2.x, matVector3.x));\r
    vec2 spriteSize;\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // In ortho projection we skip z coordinate\r
      // basic sprite size at screen plane (covers only cylinder axis)\r
      vec2 spriteSizeScreen = abs(p2.xy - p1.xy);\r
\r
      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * (spriteSizeScreen + 2.0 * rad);\r
    #else\r
      // basic sprite size at screen plane (covers only cylinder axis)\r
      vec2 spriteSizeScreen = abs(p2.xy / p2.z - p1.xy / p1.z);\r
\r
      // full sprite size in eye coords\r
      float minZ = min(abs(p1.z), abs(p2.z));\r
      spriteSize = vec2(1.0, 1.0) * INSTANCED_SPRITE_OVERSCALE * abs(posEye.z) * (spriteSizeScreen + 2.0 * rad / minZ);\r
    #endif\r
\r
    mvPosition = posEye + vec4( position.xy * 0.5 * spriteSize, 0, 0 );\r
  #else\r
    localPos = vec4(dot(localPos, matVector1), dot(localPos, matVector2), dot(localPos, matVector3), 1.0);\r
    worldPos = modelMatrix * localPos;\r
    mvPosition = modelViewMatrix * localPos;\r
  #endif\r
#endif\r
\r
  gl_Position = projectionMatrix * mvPosition;\r
\r
  vWorldPosition = worldPos.xyz;\r
  vViewPosition = - mvPosition.xyz;\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
	  vec4 worldPosition;\r
	  // see THREE.WebGLProgram.unrollLoops\r
	  #pragma unroll_loop_start\r
	  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
      vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * vec4(vWorldPosition, 1.0);\r
      vDirectionalShadowNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(objectNormal, 0.0))).xyz;\r
	  }\r
	  #pragma unroll_loop_end\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  vColor = color.xyz;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  vColor2 = color2;\r
  #ifndef CYLINDER_SPRITE\r
    vUv = uv;\r
  #endif\r
#endif\r
\r
#ifdef DASHED_LINE\r
  vLineDistance = lineDistance;\r
#endif\r
}\r
`,fragmentShader$6=`#if defined (NORMALS_TO_G_BUFFER)\r
  #define fragColor gl_FragData[0]\r
#else\r
  #define fragColor gl_FragColor\r
#endif\r
\r
#ifdef ATTR_ALPHA_COLOR\r
  varying float alphaCol;\r
#endif\r
\r
#ifdef COLOR_FROM_POS\r
  uniform mat4 world2colorMatrix;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
	#if NUM_DIR_LIGHTS > 0\r
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r
    uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ]; //only for sprites\r
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r
		varying vec3 vDirectionalShadowNormal[ NUM_DIR_LIGHTS ];\r
    vec4 vDirLightWorldCoord[ NUM_DIR_LIGHTS ];\r
    vec3 vDirLightWorldNormal[ NUM_DIR_LIGHTS ];\r
\r
    #ifdef SHADOWMAP_PCF_RAND\r
      // We use 4 instead uniform variable or define because this value is used in for(... i < value; ...) with\r
      // unroll_loop and unroll_loop has pattern:\r
      // /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g\r
      uniform vec2 samplesKernel[4]; // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
      uniform sampler2D noiseTex;\r
      uniform vec2 noiseTexelSize;\r
      uniform vec2 srcTexelSize;\r
      uniform mat4 projectionMatrix;\r
    #endif\r
	#endif\r
#endif\r
\r
#ifdef ATTR_COLOR\r
  varying vec3 vColor;\r
#endif\r
\r
#ifdef ATTR_COLOR2\r
  varying vec3 vColor2;\r
  #ifndef CYLINDER_SPRITE\r
    varying vec2 vUv;\r
  #endif\r
#endif\r
\r
uniform vec3 diffuse;\r
uniform vec3 emissive;\r
uniform vec3 specular;\r
uniform float shininess;\r
uniform vec3 fixedColor;\r
uniform float opacity;\r
uniform float zClipValue;\r
uniform float clipPlaneValue;\r
\r
#ifdef NORMALS_TO_G_BUFFER\r
  varying vec3 viewNormal;\r
#endif\r
\r
#define PI 3.14159265359\r
#define RECIPROCAL_PI 0.31830988618\r
#define saturate(a) clamp( a, 0.0, 1.0 )\r
\r
#ifdef USE_FOG\r
  uniform vec3 fogColor;\r
  uniform float fogAlpha;\r
  uniform float fogNear;\r
  uniform float fogFar;\r
#endif\r
\r
varying vec3 vWorldPosition; // world position of the pixel (invalid when INSTANCED_SPRITE is defined)\r
varying vec3 vViewPosition;\r
\r
#if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
  varying vec3 vNormal;\r
#endif\r
\r
/////////////////////////////////////////// ZSprites ////////////////////////////////////////////////\r
#if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r
  uniform float nearPlaneValue;\r
#endif\r
\r
#ifdef SPHERE_SPRITE\r
  varying vec4 spritePosEye;\r
#endif\r
\r
#if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
  uniform float zOffset;\r
\r
  #if !defined(USE_LIGHTS) || !defined(SHADOWMAP) || !defined(SHADOWMAP_PCF_RAND) || !(NUM_DIR_LIGHTS > 0)\r
    uniform mat4 projectionMatrix;\r
  #endif\r
\r
  float calcDepthForSprites(vec4 pixelPosEye, float zOffset, mat4 projMatrix) {\r
    vec4 pixelPosScreen = projMatrix * pixelPosEye;\r
    return 0.5 * (pixelPosScreen.z / pixelPosScreen.w + 1.0) + zOffset;\r
  }\r
#endif\r
\r
#ifdef SPHERE_SPRITE\r
  varying vec4 instOffset;\r
  uniform mat4 modelMatrix;\r
  uniform mat4 modelViewMatrix;\r
  uniform mat4 invModelViewMatrix;\r
  uniform mat3 normalMatrix;\r
\r
\r
  bool intersect_ray_sphere(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r
\r
    // intersect XZ-projected ray with circle\r
    float a = dot(ray, ray);\r
    float b = dot(ray, origin);\r
    float c = dot(origin, origin) - 1.0;\r
    float det = b * b - a * c;\r
    if (det < 0.0) return false;\r
    float t1 = (-b - sqrt(det)) / a;\r
    float t2 = (-b + sqrt(det)) / a;\r
\r
    // calculate both intersection points\r
    vec3 p1 = origin + ray * t1;\r
    vec3 p2 = origin + ray * t2;\r
\r
    // choose nearest point inside frustum\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // orthografic camera is used for dirLight sources. So in it for all spheres the point with smaller 't' is visible\r
      // t1 is always smaller than t2 (from calculations)\r
      point = p1;\r
      frontFaced = 1.0;\r
      return true;\r
    #else\r
      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r
      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r
      if (t1 >= 0.0) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (t2 >= 0.0) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #endif\r
\r
    return false;\r
  }\r
\r
  bool get_sphere_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r
    vec3 origin, ray;\r
\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // transform vector from sprite center to curPixel into sphere local coords\r
      origin = pixelPosEye.xyz - spritePosEye.xyz;\r
      origin = (invModelViewMatrix * vec4(origin, 0.0)).xyz / instOffset.w;\r
\r
      // transform camera orientation vector into sphere local coords\r
      ray = (invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;\r
    #else\r
      // find point of intersection near plane by the ray from camera to curPixel\r
      vec4 v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r
\r
      // transform intersection point into sphere local coords\r
      v = invModelViewMatrix * v;\r
      origin = (v.xyz - instOffset.xyz) / instOffset.w;\r
\r
      // transform vector from camera pos to curPixel into sphere local coords\r
      ray = (invModelViewMatrix * vec4(pixelPosEye, 0.0)).xyz;\r
    #endif\r
    ray = normalize(ray);\r
\r
    return intersect_ray_sphere(origin, ray, point, frontFaced);\r
  }\r
#endif\r
\r
#ifdef CYLINDER_SPRITE\r
  varying vec4 matVec1;\r
  varying vec4 matVec2;\r
  varying vec4 matVec3;\r
  varying vec4 invmatVec1;\r
  varying vec4 invmatVec2;\r
  varying vec4 invmatVec3;\r
\r
  uniform mat4 modelMatrix;\r
  uniform mat4 modelViewMatrix;\r
  uniform mat4 invModelViewMatrix;\r
  uniform mat3 normalMatrix;\r
\r
  varying vec4 spritePosEye;\r
\r
  bool intersect_ray_cylinder(in vec3 origin, in vec3 ray, out vec3 point, out float frontFaced) {\r
\r
    // intersect XZ-projected ray with circle\r
    float a = dot(ray.xz, ray.xz);\r
    float b = dot(ray.xz, origin.xz);\r
    float c = dot(origin.xz, origin.xz) - 1.0;\r
    float det = b * b - a * c;\r
    if (det < 0.0) return false;\r
    float t1 = (-b - sqrt(det)) / a;\r
    float t2 = (-b + sqrt(det)) / a;\r
\r
    // calculate both intersection points\r
    vec3 p1 = origin + ray * t1;\r
    vec3 p2 = origin + ray * t2;\r
\r
    float halfHeight = 0.5;\r
\r
    // choose nearest point\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // orthografic camera is used for dirLight sources. So in it for all cylinders the point with smaller 't' is visible\r
      // if it is not outside of cylinnder (t1 is always smaller than t2).\r
      if (p1.y >= -halfHeight && p1.y <= halfHeight) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (p2.y >= -halfHeight && p2.y <= halfHeight) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #else\r
      // for perspective camera first intersection can be in front of near plane. If not intersection is p1 else - p2\r
      // t* = 0.0 corresponds to point of intersection near plane by the ray from camera to curPixel\r
      if (t1 >= 0.0 && p1.y >= -halfHeight && p1.y <= halfHeight) {\r
        point = p1;\r
        frontFaced = 1.0;\r
        return true;\r
      }\r
      if (t2 >= 0.0 && p2.y >= -halfHeight && p2.y <= halfHeight) {\r
        point = p2;\r
        frontFaced = -1.0;\r
        return true;\r
      }\r
    #endif\r
\r
    return false;\r
  }\r
\r
  bool get_cylinder_point(in vec3 pixelPosEye, out vec3 point, out float frontFaced) {\r
    vec3 origin, ray;\r
    vec4 v;\r
\r
    #ifdef ORTHOGRAPHIC_CAMERA\r
      // transform vector from sprite center to curPixel into cylinder local coords\r
      v = invModelViewMatrix * vec4(pixelPosEye.xyz - spritePosEye.xyz, 0.0);\r
      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
\r
      // transform camera orientation vector into cylinder local coords\r
      v = invModelViewMatrix * vec4(0.0, 0.0, -1.0, 0.0);\r
      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
    #else\r
      // find point of intersection near plane by the ray from camera to curPixel\r
      v = vec4(-(nearPlaneValue / pixelPosEye.z) * pixelPosEye, 1.0);\r
\r
      // transform intersection point into cylinder local coords\r
      v = invModelViewMatrix * v;\r
      origin = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
\r
      // transform vector from camera pos to curPixel into cylinder local coords\r
      v = invModelViewMatrix * vec4(pixelPosEye, 0.0);\r
      ray = vec3(dot(v, invmatVec1), dot(v, invmatVec2), dot(v, invmatVec3));\r
    #endif\r
    ray = normalize(ray);\r
\r
    return intersect_ray_cylinder(origin, ray, point, frontFaced);\r
  }\r
#endif\r
\r
///////////////////////////////////// Pack and unpack ///////////////////////////////////////////////\r
const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r
\r
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r
\r
\r
const float ShiftRight8 = 1. / 256.;\r
\r
vec4 packDepthToRGBA( const in float v ) {\r
  vec4 r = vec4( fract( v * PackFactors ), v );\r
  r.yzw -= r.xyz * ShiftRight8; // tidy overflow\r
  return r * PackUpscale;\r
}\r
\r
float unpackRGBAToDepth( const in vec4 v ) {\r
  return dot( v, UnpackFactors );\r
}\r
\r
////////////////////////////////////////// All Lighting /////////////////////////////////////////////////\r
#ifdef TOON_SHADING\r
  #define LOW_TOON_BORDER 0.0\r
  #define MEDIUM_TOON_BORDER 0.7\r
  #define HIGH_TOON_BORDER 1.0\r
\r
  #define MEDIUM_TOON_RANGE 0.5\r
  #define HIGH_TOON_RANGE 0.95\r
#endif\r
#if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r
  struct ReflectedLight {\r
    vec3 directDiffuse;\r
    vec3 directSpecular;\r
    vec3 indirectDiffuse;\r
  };\r
\r
  struct BlinnPhongMaterial {\r
    vec3  diffuseColor;\r
    vec3  specularColor;\r
    float specularShininess;\r
  };\r
\r
  struct GeometricContext {\r
    vec3 normal;\r
    vec3 viewDir;\r
  };\r
\r
  struct DirectionalLight {\r
    vec3 direction;\r
    vec3 color;\r
  };\r
  uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r
\r
  struct DirectionalLightShadow {\r
     vec2 shadowMapSize;\r
     float shadowBias;\r
     float shadowRadius;\r
   };\r
  uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHTS ];\r
\r
  uniform vec3 ambientLightColor;\r
\r
  /////////////////////////////////////////// Shadowmap ////////////////////////////////////////////////\r
\r
  #if defined(SHADOWMAP)\r
  	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r
  		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r
  	}\r
\r
    float getShadow( sampler2D shadowMap, DirectionalLightShadow dirLight, vec4 shadowCoord, vec3 vViewPosition, vec3 vNormal ) {\r
   	  float shadow = 0.0;\r
\r
      // When shadows for sprites will appear use here for them normals as it done for G-buffer\r
      shadowCoord.xyz += dirLight.shadowBias * vNormal;\r
      shadowCoord.xyz /= shadowCoord.w;\r
\r
      bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r
      bool inFrustum = all( inFrustumVec );\r
      bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r
      bool frustumTest = all( frustumTestVec );\r
\r
      if ( frustumTest ) {\r
        #ifdef SHADOWMAP_BASIC\r
      	  shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r
      	#endif\r
\r
      	#ifdef SHADOWMAP_PCF_SHARP\r
      	  vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r
\r
            float dx0 = - texelSize.x * dirLight.shadowRadius;\r
            float dy0 = - texelSize.y * dirLight.shadowRadius;\r
            float dx1 = + texelSize.x * dirLight.shadowRadius;\r
            float dy1 = + texelSize.y * dirLight.shadowRadius;\r
\r
            shadow = (\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r
            	texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r
            ) * ( 1.0 / 9.0 );\r
        #endif\r
\r
        #ifdef SHADOWMAP_PCF_RAND\r
          vec2 texelSize = vec2( 1.0 ) / dirLight.shadowMapSize;\r
\r
          vec4 vUv = ((projectionMatrix * vec4(vViewPosition, 1.0)) + 1.0) / 2.0;\r
          vec2 vUvNoise = vUv.xy / srcTexelSize * noiseTexelSize;\r
\r
          vec2 noiseVec = normalize(texture2D(noiseTex, vUvNoise).rg);\r
          mat2 mNoise = mat2(noiseVec.x, noiseVec.y, -noiseVec.y, noiseVec.x);\r
\r
          vec2 offset;\r
          #pragma unroll_loop_start\r
          for ( int i = 0; i < 4; i ++ ) { // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
            offset = mNoise * ( normalize( samplesKernel[ i ]) * texelSize * dirLight.shadowRadius );\r
            shadow +=  texture2DCompare( shadowMap, shadowCoord.xy + offset, shadowCoord.z );\r
          }\r
          #pragma unroll_loop_end\r
          shadow /= float( 4 ); // 4 is length of _samplesKernel which is defined in UberMaterial.js\r
        #endif\r
      }\r
      return shadow;//(shadow != 1.0) ? 0.5 : 1.0;//vec4(shadow, shadow, shadow, 1.0);\r
   }\r
  #endif\r
\r
  /////////////////////////////////////////// Lighting /////////////////////////////////////////////////\r
\r
  vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r
    return RECIPROCAL_PI * diffuseColor;\r
  } // validated\r
\r
  vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r
    // Original approximation by Christophe Schlick '94\r
    //;float fresnel = pow( 1.0 - dotLH, 5.0 );\r
    // Optimized variant (presented by Epic at SIGGRAPH '13)\r
    float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r
    return ( 1.0 - specularColor ) * fresnel + specularColor;\r
  } // validated\r
\r
  float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r
    // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r
    return 0.25;\r
  }\r
\r
  float D_BlinnPhong( const in float shininess, const in float dotNH ) {\r
    return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r
  }\r
\r
  vec3 BRDF_Specular_BlinnPhong( const in DirectionalLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r
    vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r
    float dotNH = saturate(dot( geometry.normal, halfDir ));\r
    float dotLH = saturate(dot( incidentLight.direction, halfDir ));\r
\r
    vec3 F = F_Schlick( specularColor, dotLH );\r
    float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r
    float D = D_BlinnPhong( shininess, dotNH );\r
\r
    return F * ( G * D );\r
  } // validated\r
\r
  void RE_Direct_BlinnPhong( const in DirectionalLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight, float penumbra ) {\r
\r
    float dotNL = saturate( dot( geometry.normal, directLight.direction ));\r
    #ifdef TOON_SHADING\r
      if(dotNL < MEDIUM_TOON_RANGE){\r
        dotNL = LOW_TOON_BORDER;\r
      }\r
      else if(dotNL < HIGH_TOON_RANGE){\r
        dotNL = MEDIUM_TOON_BORDER;\r
      }\r
      else{\r
        dotNL = HIGH_TOON_BORDER;\r
      }\r
    #endif\r
\r
    vec3 irradiance = dotNL * directLight.color * PI;\r
    reflectedLight.directDiffuse += penumbra * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r
    reflectedLight.directSpecular += penumbra * irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess );\r
  }\r
\r
  void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r
    reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r
  }\r
\r
  vec3 calcLighting(const in GeometricContext geometry, const in BlinnPhongMaterial material, vec3 vViewPosition) {\r
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));\r
    vec3 irradiance = ambientLightColor * PI;\r
\r
    float shadowMask = 1.0;\r
    // see THREE.WebGLProgram.unrollLoops\r
  	#pragma unroll_loop_start\r
  	  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
  	    #ifdef SHADOWMAP\r
  	      shadowMask = getShadow( directionalShadowMap[ i ], directionalLightShadows[ i ], vDirLightWorldCoord[ i ], vViewPosition, vDirLightWorldNormal[ i ] );\r
        #endif\r
\r
  		  if ( shadowMask > 0.0 ) RE_Direct_BlinnPhong( directionalLights[ i ], geometry, material, reflectedLight, shadowMask );\r
  		}\r
  		#pragma unroll_loop_end\r
\r
    RE_IndirectDiffuse_BlinnPhong(irradiance, material, reflectedLight);\r
\r
    return saturate(reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular);\r
  }\r
#endif\r
\r
/////////////////////////////////////////// Dashed Line ///////////////////////////////////////////////\r
#ifdef DASHED_LINE\r
  uniform float dashedLineSize;\r
  uniform float dashedLinePeriod;\r
  varying float vLineDistance;\r
#endif\r
\r
/////////////////////////////////////////// Main ///////////////////////////////////////////////\r
void main() {\r
\r
#ifdef CLIP_PLANE\r
  if (vViewPosition.z < clipPlaneValue) discard;\r
#endif\r
\r
#ifdef ZCLIP\r
  if (vViewPosition.z < zClipValue) discard;\r
#endif\r
\r
#if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
  #if NUM_DIR_LIGHTS > 0\r
    // see THREE.WebGLProgram.unrollLoops\r
    #pragma unroll_loop_start\r
    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
      vDirLightWorldCoord[ i ] = vDirectionalShadowCoord[ i ];\r
      vDirLightWorldNormal[ i ] = vDirectionalShadowNormal[ i ];\r
    }\r
    #pragma unroll_loop_end\r
  #endif\r
#endif\r
\r
  vec4 pixelPosWorld = vec4(vWorldPosition, 1.0);\r
  vec4 pixelPosEye;\r
\r
#ifdef SPHERE_SPRITE\r
\r
  vec3 viewNormalSprites;\r
  float frontFaced = 1.0;\r
  vec3 normal;\r
\r
/* quick-and-dirty method\r
  normal.xy = ' + INSTANCED_SPRITE_OVERSCALE + ' * (2.0 * vUv - 1.0);\r
  float r2 = dot(normal.xy, normal.xy);\r
  if (r2 > 1.0) discard;\r
  float normalZ = sqrt(1.0 - r2);\r
  normal.z = normalZ;\r
  normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r
  pixelPosEye = vec4(spritePosEye.xyz, 1.0);\r
  pixelPosEye.z += spritePosEye.w * normalZ;\r
*/\r
\r
  // ray-trace sphere surface\r
  {\r
    vec3 p;\r
    if (!get_sphere_point(-vViewPosition, p, frontFaced)) discard;\r
    vec4 v = vec4(instOffset.xyz + p * instOffset.w, 1.0);\r
    pixelPosWorld = modelMatrix * v;\r
    pixelPosEye = modelViewMatrix * v;\r
    normal = normalize(normalMatrix * p);\r
    #ifdef NORMALS_TO_G_BUFFER\r
      viewNormalSprites = normalize(mat3(modelViewMatrix)*p);\r
    #endif\r
\r
    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
      #if NUM_DIR_LIGHTS > 0\r
        // see THREE.WebGLProgram.unrollLoops\r
        #pragma unroll_loop_start\r
          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r
            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(p, 0.0))).xyz;\r
          }\r
        #pragma unroll_loop_end\r
      #endif\r
    #endif\r
  }\r
#endif\r
\r
#ifdef CYLINDER_SPRITE\r
  vec3 normal;\r
  vec3 viewNormalSprites;\r
  float frontFaced = 1.0;\r
  float cylinderY = 0.0;\r
\r
  // ray-trace cylinder surface\r
  {\r
    vec3 p;\r
    if (!get_cylinder_point(-vViewPosition, p, frontFaced)) discard;\r
\r
    cylinderY = 0.5 * (p.y + 1.0);\r
\r
    vec4 v = vec4(p, 1.0);\r
    v = vec4(dot(v, matVec1), dot(v, matVec2), dot(v, matVec3), 1.0);\r
    pixelPosWorld = modelMatrix * v;\r
    pixelPosEye = modelViewMatrix * v;\r
\r
    vec3 localNormal = normalize(vec3(p.x, 0.0, p.z));\r
    normal = vec3(\r
      dot(localNormal, matVec1.xyz),\r
      dot(localNormal, matVec2.xyz),\r
      dot(localNormal, matVec3.xyz));\r
    #ifdef NORMALS_TO_G_BUFFER\r
      viewNormalSprites = normalize(mat3(modelViewMatrix)*normal);\r
    #endif\r
\r
    #if defined(USE_LIGHTS) && defined(SHADOWMAP)\r
      #if NUM_DIR_LIGHTS > 0\r
        // see THREE.WebGLProgram.unrollLoops\r
        #pragma unroll_loop_start\r
          for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r
            vDirLightWorldCoord[ i ] = directionalShadowMatrix[ i ] * pixelPosWorld;\r
            vDirLightWorldNormal[ i ] = (directionalShadowMatrix[ i ] * (modelMatrix * vec4(normal, 0.0))).xyz;\r
          }\r
        #pragma unroll_loop_end\r
      #endif\r
    #endif\r
\r
    normal = normalize(normalMatrix * normal);\r
  }\r
#endif\r
\r
  #ifdef ATTR_COLOR\r
    vec3 vertexColor = vColor;\r
  #else\r
    vec3 vertexColor = vec3(1.0, 1.0, 1.0);\r
  #endif\r
\r
  #ifdef ATTR_COLOR2\r
    #ifdef CYLINDER_SPRITE\r
      float colorCoef = cylinderY; // cylinder parameter is calculated from ray-tracing\r
    #else\r
      float colorCoef = vUv.y; // cylinder parameter is interpolated as tex coord\r
    #endif\r
      // choose either color or color2\r
    vertexColor = mix(vColor2, vColor, step(0.5, colorCoef));\r
  #endif\r
\r
  // negative red component is a special condition\r
  if (vertexColor.x < 0.0) discard;\r
\r
  #ifdef DASHED_LINE\r
    if ( mod( vLineDistance, dashedLinePeriod ) > dashedLineSize ) discard;\r
  #endif\r
\r
  // transparency prepass writes only z, so we don't need to calc the color\r
  #ifdef PREPASS_TRANSP\r
    fragColor = vec4(1.0, 1.0, 1.0, 1.0);\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
    #endif\r
    return;\r
  #endif\r
\r
    float totalOpacity = opacity;\r
\r
  #ifdef ATTR_ALPHA_COLOR\r
    totalOpacity *= alphaCol;\r
  #endif\r
\r
  // discard fully transparent pixels\r
  if (totalOpacity == 0.0) discard;\r
\r
  #ifdef FAKE_OPACITY\r
    // discard pixels in checker pattern\r
    vec2 dm_coord = floor(gl_FragCoord.xy);\r
    dm_coord = fract(dm_coord * 0.5);\r
    if (totalOpacity < 1.0 && (dm_coord.x < 0.5 ^^ dm_coord.y < 0.5)) discard;\r
    vec4 diffuseColor = vec4(diffuse, 1.0);\r
  #else\r
    vec4 diffuseColor = vec4(diffuse, totalOpacity);\r
  #endif\r
\r
  float flipNormal;\r
  #if !defined (SPHERE_SPRITE) && !defined (CYLINDER_SPRITE)\r
    flipNormal = 1.0;\r
    #ifdef DOUBLE_SIDED\r
      flipNormal = float( gl_FrontFacing );\r
    #endif\r
    vec3 normal = normalize( vNormal ) * flipNormal;\r
  #endif\r
\r
    diffuseColor.rgb *= vertexColor;\r
\r
  #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
    gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
  #endif\r
\r
  #ifdef NORMALS_TO_G_BUFFER\r
    #if defined (SPHERE_SPRITE) || defined (CYLINDER_SPRITE)\r
      vec3 viewNormaInColor = viewNormalSprites;\r
    #else\r
      vec3 viewNormaInColor = viewNormal;\r
      float frontFaced = float( gl_FrontFacing );\r
    #endif\r
    // [-1, 1] -> [0, 1]\r
    viewNormaInColor = 0.5 * viewNormaInColor + 0.5;\r
    gl_FragData[1] = vec4(viewNormaInColor, frontFaced);\r
  #endif\r
\r
  #if defined(USE_LIGHTS) && NUM_DIR_LIGHTS > 0\r
    vec3 viewDir;\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      viewDir = -pixelPosEye.xyz;\r
    #else\r
      viewDir = vViewPosition;\r
    #endif\r
    GeometricContext geometry = GeometricContext(normal, normalize( viewDir ));\r
    BlinnPhongMaterial material = BlinnPhongMaterial(diffuseColor.rgb, specular, shininess);\r
    vec3 outgoingLight = calcLighting(geometry, material, viewDir);\r
  #else\r
    vec3 outgoingLight = diffuseColor.rgb;\r
  #endif\r
\r
  #ifdef COLOR_FROM_DEPTH\r
    float depth = 0.0;\r
    #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
      gl_FragDepthEXT = calcDepthForSprites(pixelPosEye, zOffset, projectionMatrix);\r
      depth = gl_FragDepthEXT;\r
    #else\r
      depth = gl_FragCoord.z;\r
    #endif\r
    fragColor = packDepthToRGBA(depth);\r
    return;\r
  #endif\r
\r
  #ifdef COLOR_FROM_POS\r
    fragColor = world2colorMatrix * pixelPosWorld;\r
  #else\r
    #ifdef OVERRIDE_COLOR\r
      fragColor = vec4(fixedColor, diffuseColor.a);\r
    #else\r
      fragColor = vec4(outgoingLight, diffuseColor.a);//vec4(vNormal, 1.0);\r
    #endif\r
\r
    #ifdef USE_FOG\r
      float viewDistance;\r
      #if defined(SPHERE_SPRITE) || defined(CYLINDER_SPRITE)\r
        viewDistance = abs(pixelPosEye.z);\r
      #else\r
        viewDistance = vViewPosition.z;\r
      #endif\r
      float fogFactor = smoothstep( fogNear, fogFar, viewDistance) * fogAlpha;\r
      #ifdef FOG_TRANSPARENT\r
        fragColor.a = fragColor.a * (1.0 - fogFactor);\r
      #else\r
        fragColor.rgb = mix( fragColor.rgb, fogColor, fogFactor );\r
      #endif\r
    #endif\r
\r
  #endif\r
}\r
`,capabilities={precision:"mediump",init:function(t){this.precision=t.capabilities.getMaxPrecision("highp")}},noiseWidth=4,noiseHeight=4,_noiseData=new Uint8Array([24,52,0,254,145,0,122,0,0,7,170,0,34,214,0,173,8,0,86,249,0,160,4,0,226,46,0,224,211,0,3,157,0,174,247,0,12,182,0,220,216,0,1,109,0,253,154,0]),_noiseWrapS=RepeatWrapping,_noiseWrapT=RepeatWrapping,_noiseMinFilter=NearestFilter,_noiseMagFilter=NearestFilter,_noiseMapping=UVMapping,noiseTexture=new DataTexture(_noiseData,noiseWidth,noiseHeight,RGBFormat,UnsignedByteType,_noiseMapping,_noiseWrapS,_noiseWrapT,_noiseMagFilter,_noiseMinFilter,1);noiseTexture.needsUpdate=!0;var noise={noiseWidth,noiseHeight,noiseTexture};function ownKeys(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable})),e.push.apply(e,n)}return e}function _objectSpread(o){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ownKeys(Object(e),!0).forEach(function(n){_defineProperty(o,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):ownKeys(Object(e)).forEach(function(n){Object.defineProperty(o,n,Object.getOwnPropertyDescriptor(e,n))})}return o}function _createSuper$1x(o){var t=_isNativeReflectConstruct$1x();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _samplesKernel$1=[new Vector2(-.541978,.840393),new Vector2(.125533,-.992089),new Vector2(.374329,.927296),new Vector2(-.105475,.994422)],defaultUniforms=UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{diffuse:{value:new Color(15658734)},opacity:{value:1},specular:{type:"c",value:new Color(1118481)},shininess:{type:"f",value:30},fixedColor:{type:"c",value:new Color(16777215)},zOffset:{type:"f",value:0},zClipValue:{type:"f",value:0},clipPlaneValue:{type:"f",value:0},nearPlaneValue:{type:"f",value:-.5},invModelViewMatrix:{type:"4fv",value:new Matrix4},world2colorMatrix:{type:"4fv",value:new Matrix4},dashedLineSize:{type:"f",value:.1},dashedLinePeriod:{type:"f",value:.2},projMatrixInv:{type:"4fv",value:new Matrix4},viewport:{type:"v2",value:new Vector2},lineWidth:{type:"f",value:2},fogAlpha:{type:"f",value:1},samplesKernel:{type:"v2v",value:null},noiseTex:{type:"t",value:null},noiseTexelSize:{type:"v2",value:null},srcTexelSize:{type:"v2",value:null}}]),uberOptionNames=["shininess","opacity","zOffset","diffuse","specular","fixedColor","zClipCoef","zClipValue","clipPlaneValue","world2colorMatrix","dashedLineSize","dashedLinePeriod","projMatrixInv","viewport","lineWidth","fogAlpha","samplesKernel","noiseTex","noiseTexelSize","srcTexelSize"],uberOptions={diffuse:new Color(16777215),specular:new Color(1118481),shininess:30,opacity:1,fixedColor:new Color(16777215),zOffset:0,zClipCoef:2,zClipValue:0,clipPlaneValue:0,world2colorMatrix:new Matrix4,dashedLineSize:.1,dashedLinePeriod:.3,projMatrixInv:new Matrix4,viewport:new Vector2(800,600),lineWidth:2,fogAlpha:1,samplesKernel:_samplesKernel$1,noiseTex:noise.noiseTexture,noiseTexelSize:new Vector2(1/noise.noiseWidth,1/noise.noiseHeight),srcTexelSize:new Vector2(1/800,1/600),copy:function(t){this.diffuse.copy(t.diffuse),this.specular.copy(t.specular),this.shininess=t.shininess,this.opacity=t.opacity,this.fixedColor.copy(t.fixedColor),this.zOffset=t.zOffset,this.zClipCoef=t.zClipCoef,this.zClipValue=t.zClipValue,this.clipPlaneValue=t.clipPlaneValue,this.world2colorMatrix.copy(t.world2colorMatrix),this.dashedLineSize=t.dashedLineSize,this.dashedLinePeriod=t.dashedLinePeriod,this.projMatrixInv=t.projMatrixInv,this.viewport=t.viewport,this.lineWidth=t.lineWidth,this.toonShading=t.toonShading,this.fogAlpha=t.fogAlpha,this.samplesKernel=t.samplesKernel,this.noiseTex=t.noiseTex,this.noiseTexelSize=t.noiseTexelSize,this.srcTexelSize=t.srcTexelSize}},UberMaterial=function(o){_inherits(e,o);var t=_createSuper$1x(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n),r.fog=!0,r.instancedPos=!1,r.instancedMatrix=!1,r.attrColor=!1,r.attrColor2=!1,r.attrAlphaColor=!1,r.overrideColor=!1,r.sphereSprite=!1,r.cylinderSprite=!1,r.zClip=!1,r.clipPlane=!1,r.fakeOpacity=!1,r.prepassTransparancy=!1,r.colorFromPos=!1,r.shadowmap=!1,r.shadowmapType="random",r.colorFromDepth=!1,r.orthoCam=!1,r.dashedLine=!1,r.transparent=!0,r.thickLine=!1,r.fogTransparent=!1,r.normalsToGBuffer=!1,r.toonShading=!1,r.uberOptions=uberOptions,r.setValues(_objectSpread({uniforms:UniformsUtils.clone(defaultUniforms),vertexShader:r.precisionString()+vertexShader,fragmentShader:r.precisionString()+fragmentShader$6,lights:!0,fog:!0,side:DoubleSide},n)),r}return _createClass(e,[{key:"precisionString",value:function(){var r=capabilities.precision,a="precision ".concat(r,` float;
`)+"precision ".concat(r,` int;

`);return a}},{key:"copy",value:function(r){return _get(_getPrototypeOf(e.prototype),"copy",this).call(this,r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=UniformsUtils.clone(r.uniforms),this.defines=_objectSpread({},r.defines),this.extensions=r.extensions,this.fog=r.fog,this.instancedPos=r.instancedPos,this.instancedMatrix=r.instancedMatrix,this.attrColor=r.attrColor,this.attrColor2=r.attrColor2,this.attrAlphaColor=r.attrAlphaColor,this.overrideColor=r.overrideColor,this.sphereSprite=r.sphereSprite,this.cylinderSprite=r.cylinderSprite,this.zClip=r.zClip,this.clipPlane=r.clipPlane,this.fakeOpacity=r.fakeOpacity,this.colorFromPos=r.colorFromPos,this.shadowmap=r.shadowmap,this.shadowmapType=r.shadowmapType,this.colorFromDepth=r.colorFromDepth,this.orthoCam=r.orthoCam,this.prepassTransparancy=r.prepassTransparancy,this.dashedLine=r.dashedLine,this.thickLine=r.thickLine,this.fogTransparent=r.fogTransparent,this.normalsToGBuffer=r.normalsToGBuffer,this.toonShading=r.toonShading,this.uberOptions.copy(r.uberOptions),this}},{key:"createInstance",value:function(){var r=new e;return r.copy(this),r.uberOptions=Object.create(this.uberOptions),r}},{key:"setValues",value:function(r){if(!(typeof r>"u")){_get(_getPrototypeOf(e.prototype),"setValues",this).call(this,r);var a={},s={};this.fog&&(a.USE_FOG=1),this.instancedPos&&(a.INSTANCED_POS=1),this.instancedMatrix&&(a.INSTANCED_MATRIX=1),this.attrColor&&(a.ATTR_COLOR=1),this.attrColor2&&(a.ATTR_COLOR2=1),this.attrAlphaColor&&(a.ATTR_ALPHA_COLOR=1),this.overrideColor&&(a.OVERRIDE_COLOR=1),this.sphereSprite&&(a.SPHERE_SPRITE=1,s.fragDepth=1),this.cylinderSprite&&(a.CYLINDER_SPRITE=1,s.fragDepth=1),this.zClip&&(a.ZCLIP=1),this.clipPlane&&(a.CLIP_PLANE=1),this.fakeOpacity&&(a.FAKE_OPACITY=1),this.lights&&(a.USE_LIGHTS=1),this.colorFromPos&&(a.COLOR_FROM_POS=1),this.shadowmap&&(a.SHADOWMAP=1,this.shadowmapType==="pcf"?a.SHADOWMAP_PCF_SHARP=1:this.shadowmapType==="random"?a.SHADOWMAP_PCF_RAND=1:a.SHADOWMAP_BASIC=1),this.colorFromDepth&&(a.COLOR_FROM_DEPTH=1),this.orthoCam&&(a.ORTHOGRAPHIC_CAMERA=1),this.prepassTransparancy&&(a.PREPASS_TRANSP=1),this.dashedLine&&(a.DASHED_LINE=1),this.thickLine&&(a.THICK_LINE=1),this.fogTransparent&&(a.FOG_TRANSPARENT=1),this.normalsToGBuffer&&(s.drawBuffers=1,a.NORMALS_TO_G_BUFFER=1),this.toonShading&&(a.TOON_SHADING=1),this.defines=a,this.extensions=s}}},{key:"setUberOptions",value:function(r){if(!(typeof r>"u"))for(var a in r)r.hasOwnProperty(a)&&(this.uberOptions[a]instanceof Color?this.uberOptions[a]=r[a].clone():this.uberOptions[a]=r[a])}},{key:"clone",value:function(r){return r?this.createInstance():Material.prototype.clone.call(this)}},{key:"updateUniforms",value:function(){var r=this;uberOptionNames.forEach(function(a){r.uniforms.hasOwnProperty(a)&&(r.uberOptions[a]instanceof Color||r.uberOptions[a]instanceof Matrix4?r.uniforms[a].value=r.uberOptions[a].clone():r.uniforms[a].value=r.uberOptions[a])})}}]),e}(RawShaderMaterial);function _createSuper$1w(o){var t=_isNativeReflectConstruct$1w();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function UberObject(o){var t=function(e){_inherits(r,e);var n=_createSuper$1w(r);function r(){var a;_classCallCheck(this,r);for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return a=n.call.apply(n,[this].concat(l)),a.onBeforeRender=r.prototype.onBeforeRender,a}return _createClass(r,[{key:"onBeforeRender",value:function(s,l,c,u,f,p){this._onBeforeRender(s,l,c,u,f,p),this._update()}},{key:"_onBeforeRender",value:function(){}},{key:"_update",value:function(){var s=this.material;s&&s instanceof UberMaterial&&s.updateUniforms()}}]),r}(o);return t}function _createSuper$1v(o){var t=_isNativeReflectConstruct$1v();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OurMesh$4=UberObject(Mesh),ZSpriteMesh=function(o){_inherits(e,o);var t=_createSuper$1v(e);function e(){var n;_classCallCheck(this,e);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),n.castShadow=!0,n.receiveShadow=!0,n}return _createClass(e,[{key:"_onBeforeRender",value:function(r,a,s,l,c,u){OurMesh$4.prototype._onBeforeRender.call(this,r,a,s);var f=this.material;f&&f.uniforms.invModelViewMatrix&&(this.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,this.matrixWorld),f.uniforms.invModelViewMatrix.value.copy(this.modelViewMatrix).invert(),f.uniforms.nearPlaneValue.value=s.near,f.uniformsNeedUpdate=!0)}}]),e}(OurMesh$4);function _createSuper$1u(o){var t=_isNativeReflectConstruct$1u();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OurMesh$3=UberObject(Mesh),ZClippedMesh=function(o){_inherits(e,o);var t=_createSuper$1u(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a.castShadow=!0,a.receiveShadow=!0,a}return _createClass(e,[{key:"_onBeforeRender",value:function(r,a,s){OurMesh$3.prototype._onBeforeRender.call(this,r,a,s);var l=this.geometry,c=this.material;if(!(!l.zClip||!c.uberOptions)){var u=.5,f=e._modelView,p=e._mvLength,g=e._center;f.multiplyMatrices(this.matrixWorld,s.matrixWorldInverse);var y=p.setFromMatrixColumn(f,0).length();g.copy(l.boundingSphere.center),this.localToWorld(g),c.uberOptions.zClipValue=s.position.z-g.z-y*(u*l.boundingSphere.radius)}}}]),e}(OurMesh$3);_defineProperty(ZClippedMesh,"_mvLength",new Vector3);_defineProperty(ZClippedMesh,"_center",new Vector3);_defineProperty(ZClippedMesh,"_modelView",new Matrix4);function _createSuper$1t(o){var t=_isNativeReflectConstruct$1t();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1t(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TextMesh=function(o){_inherits(e,o);var t=_createSuper$1t(e);function e(n,r){var a;_classCallCheck(this,e),a=t.call(this),a.geometry=n;var s=_assertThisInitialized(a);return s.initialized=!1,a.geometry.addEventListener("update",function(){s.update()}),a}return _createClass(e,[{key:"init",value:function(){for(var r=this.children,a=r.length-1;a>=0;--a)this.remove(r[a]);for(var s=this.geometry,l=s.items,c=s.userData,u=0,f=l.length;u<f;++u){var p=l[u];if(p){var g=utils.shallowCloneNode(p),y=new CSS2DObject(g);y.userData=lodashExports.clone(c);var E=y.getElement();E.style.visibility="visible",y.source=p,this.add(y)}}this.initialized=!0}},{key:"update",value:function(){var r=this.geometry;if(r.needsUpdate){var a=this.children;this.initialized||this.init();for(var s=0,l=a.length;s<l;++s){var c=a[s],u=c.source;c.position.copy(u.worldPos),c.userData.color=u.opts.color,c.userData.background=u.opts.background}}}}]),e}(Group);function _createSuper$1s(o){var t=_isNativeReflectConstruct$1s();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1s(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OurMesh$2=UberObject(Mesh),SimpleMesh=function(o){_inherits(e,o);var t=_createSuper$1s(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a.castShadow=!0,a.receiveShadow=!0,a}return _createClass(e)}(OurMesh$2);function _createSuper$1r(o){var t=_isNativeReflectConstruct$1r();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1r(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OurMesh$1=UberObject(Mesh),_viewport=new Vector2,ThickLineMesh=function(o){_inherits(e,o);var t=_createSuper$1r(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_onBeforeRender",value:function(r,a,s,l,c,u){var f=this.material;f.uberOptions&&(f.uberOptions.projMatrixInv.copy(s.projectionMatrix).invert(),r.getSize(_viewport),f.uberOptions.viewport.set(_viewport.width,_viewport.height))}}]),e}(OurMesh$1);function _createSuper$1q(o){var t=_isNativeReflectConstruct$1q();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OurMesh=UberObject(Mesh),InstancedMesh=function(o){_inherits(e,o);var t=_createSuper$1q(e);function e(){var n;_classCallCheck(this,e);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),n.castShadow=!0,n.receiveShadow=!0,n}return _createClass(e)}(OurMesh),meshes={ZClipped:ZClippedMesh,ZSprite:ZSpriteMesh,Text:TextMesh,Line:UberObject(Line),LineSegments:UberObject(LineSegments),Mesh:SimpleMesh,ThickLineMesh,Instanced:InstancedMesh};function setMatParams(o,t){return function(e){e.setValues(o),e.setUberOptions(t)}}function _createInstancedCylinders(o,t){return{Geometry:function(n,r){return new geometries.Instanced2CCylindersGeometry(n,r,o,t)},Object:o?meshes.ZSprite:meshes.Instanced,initMaterial:setMatParams({instancedMatrix:!0,attrColor:!0,attrColor2:!0,attrAlphaColor:!0,cylinderSprite:o})}}function _createLineSegmentsGeoTriplet(o,t){var e=o.prototype instanceof ThickLinesGeometry,n=t.lineWidth||0;return{Geometry:o,Object:e?meshes.ThickLineMesh:meshes.LineSegments,initMaterial:setMatParams({lights:!1,attrColor:!0,attrAlphaColor:!0,thickLine:e},{lineWidth:n})}}function _createSimpleGeoTriplet(o){return{Geometry:o,Object:meshes.Mesh,initMaterial:setMatParams({attrColor:!0,attrAlphaColor:!0})}}function _createIsoSurfaceGeoTriplet(o,t,e,n){var r={wireframe:!!n.wireframe,fakeOpacity:e.now.isoSurfaceFakeOpacity,zClip:n.zClip};return{Geometry:o,Object:meshes.ZClipped,initMaterial:setMatParams({attrColor:!0,attrAlphaColor:!1,wireframe:r.wireframe,fakeOpacity:r.fakeOpacity,zClip:r.zClip})}}var MeshCreator=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"createSpheres",value:function(e,n){var r=n.now.zSprites;return{Geometry:function(s,l){return new geometries.InstancedSpheresGeometry(s,l,r)},Object:r?meshes.ZSprite:meshes.Instanced,initMaterial:setMatParams({instancedPos:!0,attrColor:!0,attrAlphaColor:!0,sphereSprite:r})}}},{key:"create2CClosedCylinders",value:function(e,n){return _createInstancedCylinders(!1,!1)}},{key:"create2CCylinders",value:function(e,n){return _createInstancedCylinders(n.now.zSprites,!0)}},{key:"create2CLines",value:function(e,n,r){return _createLineSegmentsGeoTriplet(geometries.TwoColorLinesGeometry,r)}},{key:"createCrosses",value:function(e,n,r){return _createLineSegmentsGeoTriplet(geometries.CrossGeometry,r)}},{key:"createExtrudedChains",value:function(e,n){return _createSimpleGeoTriplet(geometries.ExtrudedObjectsGeometry)}},{key:"createChunkedLines",value:function(e,n,r){return _createLineSegmentsGeoTriplet(geometries.ChunkedLinesGeometry,r)}},{key:"createQuickSurface",value:function(e,n,r){return _createIsoSurfaceGeoTriplet(geometries.QuickSurfGeometry,e,n,r)}},{key:"createContactSurface",value:function(e,n,r){return _createIsoSurfaceGeoTriplet(geometries.ContactSurfaceGeometry,e,n,r)}},{key:"createSASSES",value:function(e,n,r){return _createIsoSurfaceGeoTriplet(geometries.SSIsosurfaceGeometry,e,n,r)}},{key:"createLabels",value:function(e,n){return{Geometry:geometries.LabelsGeometry,Object:meshes.Text,initMaterial:function(){}}}}]),o}();function _createSuper$1p(o){var t=_isNativeReflectConstruct$1p();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1p(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TransformGroup=function(o){_inherits(e,o);var t=_createSuper$1p(e);function e(n,r,a,s){var l;_classCallCheck(this,e),l=t.call(this),l._geometry=n,l._geoParams=r;var c=a.createInstance();r.initMaterial(c),l._material=c,l._transforms=s.length>0?s:[new Matrix4];for(var u=l._createMeshes(n),f=0,p=u.length;f<p;++f)l.add(u[f]);return l}return _createClass(e,[{key:"raycast",value:function(r,a){var s=e._ray,l=e._inverseMatrix,c=this.children;s.copy(r.ray);for(var u=0,f=c.length;u<f;++u){var p=c[u];if(gfxutils.belongToSelectLayers(p)){p.updateMatrixWorld();var g=p.matrixWorld;l.copy(g).invert(),r.ray.copy(s).applyMatrix4(l);var y=[];this._geometry.raycast(r,y);for(var E=0,h=y.length;E<h;++E){var v=y[E];v.point&&(v.point.applyMatrix4(g),v.distance=s.origin.distanceTo(v.point)),v.object=p,a[a.length]=v}}}r.ray.copy(s)}},{key:"getSubset",value:function(r){for(var a=this._geometry.getSubset(r),s=[],l=0,c=0,u=a.length;c<u;++c)for(var f=this._createMeshes(a[c]),p=0,g=f.length;p<g;++p)s[l++]=f[p];return s}},{key:"_createMeshes",value:function(r){for(var a=this._transforms,s=this._geoParams.Object,l=this._material,c=[],u=0,f=a.length;u<f;++u){var p=new s(r,l);p.applyMatrix4(a[u]),c[u]=p}return c}}]),e}(Object3D);_defineProperty(TransformGroup,"_inverseMatrix",new Matrix4);_defineProperty(TransformGroup,"_ray",new Ray);function _createSuper$1o(o){var t=_isNativeReflectConstruct$1o();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function wrapper(o,t){var e=[o].concat(t);return o.bind.apply(o,_toConsumableArray(e))}var ChemGroup=function(o){_inherits(e,o);var t=_createSuper$1o(e);function e(n,r,a,s,l,c,u){var f;if(_classCallCheck(this,e),f=t.call(this),f.constructor===e)throw new Error("Can not instantiate abstract class!");return f._selection=r,f._mode=s,f._colorer=a,f._chunksIdc=r.chunks,f._polyComplexity=c,f._geo=new(wrapper(n.Geometry,f._makeGeoArgs())),f._mesh=new TransformGroup(f._geo,n,u,l),f.add(f._mesh),f._build(),f}return _createClass(e,[{key:"_makeGeoArgs",value:function(){throw new Error("ChemGroup subclass must override _makeGeoArgs() method")}},{key:"getSubset",value:function(r,a){a=a!==void 0?a:!1;var s=this._calcChunksList(r,a);return s.length===0?[]:this._mesh.getSubset(s)}},{key:"_changeSubsetOpacity",value:function(r,a,s){var l=this._calcChunksList(r,s);l.length!==0&&this._geo.setOpacity(l,a)}},{key:"enableSubset",value:function(r,a){a=a!==void 0?a:!0,this._changeSubsetOpacity(r,1,a)}},{key:"disableSubset",value:function(r,a){a=a!==void 0?a:!0,this._changeSubsetOpacity(r,0,a)}}]),e}(RCGroup);function _createSuper$1n(o){var t=_isNativeReflectConstruct$1n();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1n(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AtomsGroup=function(o){_inherits(e,o);var t=_createSuper$1n(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"raycast",value:function(r,a){var s=this._selection.atoms,l=[];this._mesh.raycast(r,l);for(var c=this._chunksIdc,u=0,f=l.length;u<f;++u)if(l[u].hasOwnProperty("chunkIdx")){var p=c[l[u].chunkIdx];p<s.length&&(l[u].atom=s[p],a.push(l[u]))}}},{key:"_calcChunksList",value:function(r){for(var a=[],s=this._selection.atoms,l=this._chunksIdc,c=0,u=l.length;c<u;++c){var f=s[l[c]];f.mask&r&&a.push(c)}return a}}]),e}(ChemGroup);function _createSuper$1m(o){var t=_isNativeReflectConstruct$1m();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1m(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AtomsSphereGroup=function(o){_inherits(e,o);var t=_createSuper$1m(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_build",value:function(){for(var r=this._selection.chunks,a=this._selection,s=a.atoms,l=a.parent,c=this._mode,u=this._colorer,f=this._geo,p=0,g=r.length;p<g;++p){var y=s[r[p]];f.setItem(p,y.position,c.calcAtomRadius(y)),f.setColor(p,u.getAtomColor(y,l))}f.finalize()}},{key:"updateToFrame",value:function(r){for(var a=this._selection.chunks,s=this._selection.atoms,l=this._mode,c=this._colorer,u=r.needsColorUpdate(c),f=this._geo,p=0,g=a.length;p<g;++p){var y=s[a[p]];f.setItem(p,r.getAtomPos(a[p]),l.calcAtomRadius(y)),u&&f.setColor(p,r.getAtomColor(c,y))}f.finalize()}}]),e}(AtomsGroup);function _createSuper$1l(o){var t=_isNativeReflectConstruct$1l();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AtomsSurfaceGroup=function(o){_inherits(e,o);var t=_createSuper$1l(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){for(var r=[],a=this._selection,s=a.atoms,l=a.chunks,c=l.length,u=0;u<c;++u)r[u]=s[l[u]];var f=this._mode.getSurfaceOpts();return f.atoms=r,[c,f]}}]),e}(AtomsSphereGroup);function _createSuper$1k(o){var t=_isNativeReflectConstruct$1k();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1k(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AtomsSASSESGroupStub=function(o){_inherits(e,o);var t=_createSuper$1k(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){for(var r=[],a=this._selection,s=a.atoms,l=a.chunks,c=l.length,u=0;u<c;++u)r[u]=s[l[u]];var f=this._mode.getSurfaceOpts();return f.atoms=r,f.selection=this._selection,f.colorMode=this._colorer,[c,f]}}]),e}(AtomsSphereGroup);function _createSuper$1j(o){var t=_isNativeReflectConstruct$1j();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1j(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function adjustColor(o){var t=o>>16&255,e=o>>8&255,n=o&255;return .2126*t+.7152*e+.0722*n>127?(t=t*3/10,e=e*3/10,n=n*3/10):(t=255-(255-t)*3/10,e=255-(255-e)*3/10,n=255-(255-n)*3/10),t<<16|e<<8|n}function inverseColor(o){var t=o>>16&255,e=o>>8&255,n=o&255;return 255-t<<16|255-e<<8|255-n}function getAtomText(o){return o.name.getNode()!==null?o.name.getNode():o.getVisualName()}var colorMappings={none:function(t){return t},adjust:adjustColor,inverse:inverseColor};function propagateColor(o,t){var e;if(colorMappings.hasOwnProperty(t))e=utils.hexColor(colorMappings[t](o));else{var n=parseInt(t,16);!Number.isNaN(n)&&t.toLowerCase().startsWith("0x")?e=utils.hexColor(n):e="#000000"}return e}var templateMappings={serial:function(t){return t.serial},name:function(t){return t.getVisualName()},elem:function(t){return t.element.name},residue:function(t){return t.residue.getType().getName()},sequence:function(t){return t.residue.getSequence()},chain:function(t){return t.residue.getChain().getName()},hetatm:function(t){return t.isHet()},water:function(t){return t.residue.getType().getName()==="HOH"||t.residue.getType().getName()==="WAT"}},parseTemplate=function(t,e){return e.replace(/\{\{(\s*\w+\s*)\}\}/g,function(n){var r=n.replace(/\s+/g,"");return r=r.substring(2,r.length-2).toLowerCase(),templateMappings.hasOwnProperty(r)?templateMappings[r](t):"null"})},AtomsTextGroup=function(o){_inherits(e,o);var t=_createSuper$1j(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){var r=this._mode.getLabelOpts();return[this._selection.chunks.length,r]}},{key:"_build",value:function(){for(var r=this._mode.getLabelOpts(),a=this._selection.chunks,s=this._selection,l=s.atoms,c=s.parent,u=this._colorer,f=this._geo,p=0,g=a.length;p<g;++p){var y=l[a[p]],E=r.template?parseTemplate(y,r.template):getAtomText(y);if(E){var h=u.getAtomColor(y,c),v=parseInt(propagateColor(h,r.fg).substring(1),16),C=r.showBg?parseInt(propagateColor(h,r.bg).substring(1),16):"transparent";f.setItem(p,y.position,E),f.setColor(p,v,C)}}f.finalize()}},{key:"updateToFrame",value:function(r){for(var a=this._mode.getLabelOpts(),s=this._selection.chunks,l=this._selection.atoms,c=this._colorer,u=this._geo,f=r.needsColorUpdate(c),p=0,g=s.length;p<g;++p){var y=l[s[p]],E=a.template?parseTemplate(y,a.template):getAtomText(y);if(E){var h=r.getAtomColor(c,y),v=parseInt(propagateColor(h,a.fg).substring(1),16),C=a.showBg?parseInt(propagateColor(h,a.bg).substring(1),16):"transparent";u.setItem(p,r.getAtomPos(s[p]),E),f&&u.setColor(p,v,C)}}u.finalize()}}]),e}(AtomsGroup);function _createSuper$1i(o){var t=_isNativeReflectConstruct$1i();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1i(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _slerp(o,t,e,n){var r=Math.sin(o);return t.clone().multiplyScalar(Math.sin((1-n)*o)/r).addScaledVector(e,Math.sin(n*o)/r)}var AromaticGroup=function(o){_inherits(e,o);var t=_createSuper$1i(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_buildInner",value:function(r,a){for(var s=this._selection.chunks,l=new Vector3,c=new Vector3,u=this._segmentsHeight,f=1/u,p=this._colorer,g=this._selection,y=g.cycles,E=g.parent,h=0,v=s[h],C=0,x=y.length;C<x;++C){var w=y[C],_=w.atoms,S=[],M=[],T=w.center,R=w.radius-r,P=_.length,I=0,B=_[P-1].position,W=_[I].position;l.subVectors(B,T),c.subVectors(W,T);for(var D=c.clone().cross(l).normalize();I<P;++I){var O=l.angleTo(c);M[I]=_slerp(O,l,c,.5).normalize(),W=_[(I+1)%P].position,l.copy(c),c.subVectors(W,T)}for(I=0;I<P;++I)if(_[I].index===v){for(var z=M[I],G=M[(I+1)%P],k=p.getAtomColor(_[I],E),$=z.angleTo(G),Z=0;Z<=u;++Z)S[Z]=_slerp($,z,G,Z*f).multiplyScalar(R).add(T);a(h++,k,S,T,D),v=s[h]}}}}]),e}(AtomsGroup);function _createSuper$1h(o){var t=_isNativeReflectConstruct$1h();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1h(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _createShape$1(o,t){for(var e=[],n=0;n<t;++n){var r=-2*n/t*Math.PI;e.push(new Vector3(Math.cos(r)*o,Math.sin(r)*o,0))}return e}var calcChunkMatrix=gfxutils.calcChunkMatrix,AromaticTorusGroup=function(o){_inherits(e,o);var t=_createSuper$1h(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_build",value:function(){var r=this._segmentsHeight,a=this._mode.getAromRadius(),s=new Vector2(a,a),l=this._mode.calcStickRadius()+2*a,c=new Vector3,u=[],f=this._geo;this._buildInner(l,function(p,g,y,E,h){for(var v=0;v<=r;++v){var C=y[v],x=C.clone().sub(E).cross(h);c.addVectors(C,x),u[v]=calcChunkMatrix(C,c,h,s)}f.setItem(p,u),f.setColor(p,g)}),f.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._polyComplexity,[_createShape$1(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length]}}]),e}(AromaticGroup);function _createSuper$1g(o){var t=_isNativeReflectConstruct$1g();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AromaticLinesGroup=function(o){_inherits(e,o);var t=_createSuper$1g(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_build",value:function(){var r=this,a=this._geo,s=this._mode.getAromaticOffset();this._buildInner(s,function(l,c,u){for(var f=u[0],p=1;p<=r._segmentsHeight;++p){var g=u[p];a.setSegment(l,p-1,f,g),f=g}a.setColor(l,c)}),a.finalize()}},{key:"_makeGeoArgs",value:function(){return this._segmentsHeight=this._mode.getAromaticArcChunks(),[this._selection.chunks.length,this._segmentsHeight,!0]}}]),e}(AromaticGroup);function _createSuper$1f(o){var t=_isNativeReflectConstruct$1f();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1f(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ResiduesGroup=function(o){_inherits(e,o);var t=_createSuper$1f(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"raycast",value:function(r,a){var s=this._selection.residues,l=[];this._mesh.raycast(r,l);for(var c=this._chunksIdc,u=0,f=l.length;u<f;++u)if(l[u].hasOwnProperty("chunkIdx")){var p=c[l[u].chunkIdx];p<s.length&&(l[u].residue=s[p],a.push(l[u]))}}},{key:"_calcChunksList",value:function(r){for(var a=[],s=this._selection.residues,l=this._chunksIdc,c=0,u=l.length;c<u;++c){var f=s[l[c]];f._mask&r&&a.push(c)}return a}}]),e}(ChemGroup);function _createSuper$1e(o){var t=_isNativeReflectConstruct$1e();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NucleicItemGroup=function(o){_inherits(e,o);var t=_createSuper$1e(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"raycast",value:function(r,a){var s=this._selection.residues,l=[];this._mesh.raycast(r,l);for(var c=this._chunksIdc,u=0,f=l.length;u<f;++u)if(l[u].hasOwnProperty("chunkIdx")){var p=c[Math.floor(l[u].chunkIdx/2)];p<s.length&&(l[u].residue=s[p],a.push(l[u]))}}},{key:"_build",value:function(){for(var r=this._selection,a=r.residues,s=r.parent,l=this._colorer,c=this._geo,u=this._mode.calcStickRadius(),f=0,p=this._selection.chunks,g=0,y=p.length;g<y;++g){var E=a[p[g]],h=l.getResidueColor(E,s);this._processItem(f++,E._cylinders[0],E._cylinders[1],u,h)}c.finalize()}},{key:"_calcChunksList",value:function(r){for(var a=[],s=0,l=this._selection.residues,c=this._chunksIdc,u=0,f=c.length;u<f;++u){var p=l[c[u]];p._mask&r&&(a[s++]=2*u,a[s++]=2*u+1)}return a}},{key:"updateToFrame",value:function(r){for(var a=r.getResidues(),s=this._selection.parent,l=this._colorer,c=this._geo,u=this._mode.calcStickRadius(),f=0,p=this._selection.chunks,g=0,y=p.length;g<y;++g){var E=a[p[g]],h=l.getResidueColor(E,s);this._processItem(f++,E._cylinders[0],E._cylinders[1],u,h)}c.finishUpdate()}}]),e}(ResiduesGroup);function _createSuper$1d(o){var t=_isNativeReflectConstruct$1d();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NucleicCylindersGroup=function(o){_inherits(e,o);var t=_createSuper$1d(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length,this._polyComplexity]}},{key:"_processItem",value:function(r,a,s,l,c){var u=this._geo;u.setItem(r,a,s,l),u.setColor(r,c,c)}}]),e}(NucleicItemGroup);function _createSuper$1c(o){var t=_isNativeReflectConstruct$1c();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1c(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NucleicSpheresGroup=function(o){_inherits(e,o);var t=_createSuper$1c(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){return[this._selection.chunks.length*2,this._polyComplexity]}},{key:"_processItem",value:function(r,a,s,l,c){var u=this._geo,f=r*2;u.setItem(f,a,l),u.setColor(f,c),f++,u.setItem(f,s,l),u.setColor(f,c)}}]),e}(NucleicItemGroup),Smooth={};(function(o){(function(){var t,e,n,r,a,s,l,c,u,f,p,g,y,E,h,v,C,x,w,_,S,M,T,R,P,I,B=Object.prototype.hasOwnProperty,W=function(O,z){for(var G in z)B.call(z,G)&&(O[G]=z[G]);function k(){this.constructor=O}return k.prototype=z.prototype,O.prototype=new k,O.__super__=z.prototype,O};n={METHOD_NEAREST:"nearest",METHOD_LINEAR:"linear",METHOD_CUBIC:"cubic",METHOD_LANCZOS:"lanczos",METHOD_SINC:"sinc",CLIP_CLAMP:"clamp",CLIP_ZERO:"zero",CLIP_PERIODIC:"periodic",CLIP_MIRROR:"mirror",CUBIC_TENSION_DEFAULT:0,CUBIC_TENSION_CATMULL_ROM:0},g={method:n.METHOD_CUBIC,cubicTension:n.CUBIC_TENSION_DEFAULT,clip:n.CLIP_CLAMP,scaleTo:0,sincFilterSize:2,sincWindow:void 0},u=function(O,z){return Math.max(0,Math.min(O,z-1))},p=function(O,z){return O=O%z,O<0&&(O+=z),O},f=function(O,z){var G;return G=2*(z-1),O=p(O,G),O>z-1&&(O=G-O),O},t=function(){function D(O,z){if(this.array=O.slice(0),this.length=this.array.length,!(this.clipHelper={clamp:this.clipHelperClamp,zero:this.clipHelperZero,periodic:this.clipHelperPeriodic,mirror:this.clipHelperMirror}[z.clip]))throw"Invalid clip: "+z.clip}return D.prototype.getClippedInput=function(O){return 0<=O&&O<this.length?this.array[O]:this.clipHelper(O)},D.prototype.clipHelperClamp=function(O){return this.array[u(O,this.length)]},D.prototype.clipHelperZero=function(O){return 0},D.prototype.clipHelperPeriodic=function(O){return this.array[p(O,this.length)]},D.prototype.clipHelperMirror=function(O){return this.array[f(O,this.length)]},D.prototype.interpolate=function(O){throw"Subclasses of AbstractInterpolator must override the interpolate() method."},D}(),a=function(D){W(O,D);function O(){O.__super__.constructor.apply(this,arguments)}return O.prototype.interpolate=function(z){return this.getClippedInput(Math.round(z))},O}(t),r=function(D){W(O,D);function O(){O.__super__.constructor.apply(this,arguments)}return O.prototype.interpolate=function(z){var G;return G=Math.floor(z),z-=G,(1-z)*this.getClippedInput(G)+z*this.getClippedInput(G+1)},O}(t),e=function(D){W(O,D);function O(z,G){this.tangentFactor=1-Math.max(-1,Math.min(1,G.cubicTension)),O.__super__.constructor.apply(this,arguments)}return O.prototype.getTangent=function(z){return this.tangentFactor*(this.getClippedInput(z+1)-this.getClippedInput(z-1))/2},O.prototype.interpolate=function(z){var G,k,$,Z,K;return G=Math.floor(z),k=[this.getTangent(G),this.getTangent(G+1)],$=[this.getClippedInput(G),this.getClippedInput(G+1)],z-=G,Z=z*z,K=z*Z,(2*K-3*Z+1)*$[0]+(K-2*Z+z)*k[0]+(-2*K+3*Z)*$[1]+(K-Z)*k[1]},O}(t),M=Math.sin,s=Math.PI,T=function(O){return O===0?1:M(s*O)/(s*O)},C=function(O){return function(z){return T(z/O)}},w=function(O){return function(z){return T(z)*O(z)}},l=function(D){W(O,D);function O(z,G){if(O.__super__.constructor.apply(this,arguments),this.a=G.sincFilterSize,!G.sincWindow)throw"No sincWindow provided";this.kernel=w(G.sincWindow)}return O.prototype.interpolate=function(z){var G,k,$,Z,K;for(G=Math.floor(z),$=0,k=Z=G-this.a+1,K=G+this.a;Z<=K?k<=K:k>=K;Z<=K?k++:k--)$+=this.kernel(z-k)*this.getClippedInput(k);return $},O}(t),y=function(O,z){var G,k,$,Z;for(Z=[],k=0,$=O.length;k<$;k++)G=O[k],Z.push(G[z]);return Z},x=function(O,z,G){var k,$;return G.join==="0,1"?O:(k=z/(G[1]-G[0]),$=G[0],function(Z){return O(k*(Z-$))})},E=function(O){return Object.prototype.toString.call(O).slice(8,-1)},P=function(O){if(isNaN(O))throw"NaN in Smooth() input";if(E(O)!=="Number")throw"Non-number in Smooth() input";if(!isFinite(O))throw"Infinity in Smooth() input"},I=function(O,z){var G,k,$;if(E(O)!=="Array")throw"Non-vector in Smooth() input";if(O.length!==z)throw"Inconsistent dimension in Smooth() input";for(k=0,$=O.length;k<$;k++)G=O[k],P(G)},h=function(O){return E(O)==="Number"&&isFinite(O)&&!isNaN(O)},_=function(O){var z;switch(z="scaleTo param must be number or array of two numbers",E(O)){case"Number":if(!h(O))throw z;O=[0,O];break;case"Array":if(O.length!==2||!(h(O[0])&&h(O[1])))throw z;break;default:throw z}return O},S=function(O){var z,G,k;z={};for(G in O)B.call(O,G)&&(k=O[G],z[G]=k);return z},c=function(O,z){var G,k,$,Z,K,j,Q,le,he,ve,re;z==null&&(z={}),he={},z=S(z),he.config=S(z),z.scaleTo==null&&(z.scaleTo=z.period),z.sincFilterSize==null&&(z.sincFilterSize=z.lanczosFilterSize);for(Q in g)B.call(g,Q)&&(re=g[Q],z[Q]==null&&(z[Q]=re));if(!(K={nearest:a,linear:r,cubic:e,lanczos:l,sinc:l}[z.method]))throw"Invalid method: "+z.method;if(z.method==="lanczos"&&(z.sincWindow=C(z.sincFilterSize)),O.length<2)throw"Array must have at least two elements";he.count=O.length,ve=function(){var Ie,ge,Se,Le;switch(E(O[0])){case"Number":if(he.dimension="scalar",c.deepValidation)for(Ie=0,Se=O.length;Ie<Se;Ie++)le=O[Ie],P(le);return Z=new K(O,z),function(be){return Z.interpolate(be)};case"Array":if(he.dimension=k=O[0].length,!k)throw"Vectors must be non-empty";if(c.deepValidation)for(ge=0,Le=O.length;ge<Le;ge++)re=O[ge],I(re,k);return j=function(){var be;for(be=[],$=0;0<=k?$<k:$>k;0<=k?$++:$--)be.push(new K(y(O,$),z));return be}(),function(be){var ye,ce,ue,Ce;for(Ce=[],ce=0,ue=j.length;ce<ue;ce++)ye=j[ce],Ce.push(ye.interpolate(be));return Ce};default:throw"Invalid element type: "+E(O[0])}}(),z.clip==="periodic"?G=O.length:G=O.length-1,z.scaleTo||(z.scaleTo=G),he.domain=_(z.scaleTo),ve=x(ve,G,he.domain),he.domain.sort();for(Q in he)B.call(he,Q)&&(re=he[Q],ve[Q]=re);return ve};for(v in n)B.call(n,v)&&(R=n[v],c[v]=R);c.deepValidation=!0,(o!==null?o:window).Smooth=c}).call(commonjsGlobal)})(Smooth);var ResidueType=chem.ResidueType,calcMatrix=gfxutils.calcChunkMatrix;function _buildStructureInterpolator(o,t){var e=Smooth.Smooth(o,{method:Smooth.Smooth.METHOD_CUBIC,clip:Smooth.Smooth.CLIP_CLAMP,cubicTension:t,scaleTo:1});return function(n,r){var a=r;a===null&&(a=function(u){return(u*(o.length-1-2)+1)/(o.length-1)});var s=a(n),l=e(s);return new Vector3(l[0],l[1],l[2])}}function _addPoints(o,t,e,n){if(!n._isValid){o[e]=o[e-1],t[e]=t[e-1];return}var r=n._controlPoint;o[e]=[r.x,r.y,r.z];var a=r.clone().add(n._wingVector);t[e]=[a.x,a.y,a.z]}function _addPointsForLoneResidue(o,t,e,n){var r=(n._type.flags&ResidueType.Flags.NUCLEIC)!==0,a=r?"C5'":"N",s=r?"C3'":"C",l,c;if(n.forEachAtom(function(C){var x=C.getVisualName();!l&&x===a?l=C.position:!c&&x===s&&(c=C.position)}),l&&c||(l=n._firstAtom.position,c=n._lastAtom.position),l&&c){var u=c.clone().sub(l),f=n._wingVector,p=n._controlPoint,g=p.clone().add(f),y=p.clone().sub(u),E=y.clone().add(f);o[e]=[y.x,y.y,y.z],t[e]=[E.x,E.y,E.z],++e,o[e]=[y.x,y.y,y.z],t[e]=[E.x,E.y,E.z],++e,o[e]=[p.x,p.y,p.z],t[e]=[g.x,g.y,g.z],++e;var h=p.clone().add(u),v=h.clone().add(f);o[e]=[h.x,h.y,h.z],t[e]=[v.x,v.y,v.z],++e,o[e]=[h.x,h.y,h.z],t[e]=[v.x,v.y,v.z]}}function _calcPoints(o,t,e,n){var r=n.start,a=n.end;function s(h){return h>r&&o[h-1]._isValid?h-1:h}function l(h){return h<a&&o[h+1]._isValid?h+1:h}var c=[],u=[],f=0;function p(h,v){var C=o[h]._controlPoint.clone().lerp(o[v]._controlPoint,-.25),x=C.clone().add(o[h]._wingVector);u[f]=[C.x,C.y,C.z],c[f++]=[x.x,x.y,x.z],u[f]=[C.x,C.y,C.z],c[f++]=[x.x,x.y,x.z]}var g=s(t),y=l(e);if(g===y)return _addPointsForLoneResidue(u,c,f,o[t]),{centerPoints:u,topPoints:c};t===g?p(t,l(t)):(_addPoints(u,c,f++,o[s(g)]),_addPoints(u,c,f++,o[g]));for(var E=t;E<=e;++E)_addPoints(u,c,f++,o[E]);return y===l(y)?p(e,s(e)):(_addPoints(u,c,f++,o[y]),_addPoints(u,c,f,o[l(y)])),{centerPoints:u,topPoints:c}}var CartoonHelper=function(){function o(t,e,n,r,a,s){_classCallCheck(this,o);var l=_calcPoints(t,e,n,s);this._topInterp=_buildStructureInterpolator(l.topPoints,a),this._centerInterp=_buildStructureInterpolator(l.centerPoints,a),this._shift=.5/(n-e+2),this._valueStep=(1-2*this._shift)/(2*(n-e+1)*(r-1)),this._segmentsCount=r}return _createClass(o,[{key:"prepareMatrices",value:function(e,n,r){for(var a=this._segmentsCount,s=new Array(a),l=new Vector2(0,0),c=this._topInterp,u=this._centerInterp,f=this._shift+this._valueStep*(a-1)*e,p=0;p<a;++p){var g=Math.min(1,p/(a-1));l.lerpVectors(n,r,g);var y=c(f,null),E=u(f,null);f+=this._valueStep;var h=u(f,null);s[p]=calcMatrix(E.clone(),h.clone(),y.clone().sub(E),l)}return s}}]),o}();function _createSuper$1b(o){var t=_isNativeReflectConstruct$1b();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1b(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _createShape(o,t){for(var e=[],n=0;n<t;++n){var r=Math.PI/2-2*Math.PI*n/t;e.push(new Vector3(Math.cos(r)*o,Math.sin(r)*o,0))}return e}function _loopThrough(o,t,e,n,r,a){for(var s=0,l=o.length;s<l;++s)for(var c=o[s].arr,u=o[s].boundaries,f=0,p=c.length;f<p;++f)for(var g=[c[f].start,c[f].end],y=new CartoonHelper(t,g[0],g[1],e,n,u),E=null,h=c[f].start*2,v=c[f].end*2+1,C=r.getResidueRadius(t[0],0),x=h;x<=v;++x){var w=x/2|0,_=t[w],S=r.getResidueRadius(_,x%2),M=r.getResidueRadius(_,1+x%2),T=y.prepareMatrices(x-g[0]*2,S,M);T.unshift(E===null?T[0]:E);var R=S.x!==M.x||S.y!==M.y,P=S.x!==C.x||S.y!==C.y;a(_,T,R,P),E=T[e],C=M}}var ResiduesSubseqGroup=function(o){_inherits(e,o);var t=_createSuper$1b(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){var r=this._mode.getHeightSegmentsRatio();return this._segmentsHeight=this._polyComplexity*r|0,[_createShape(1,this._polyComplexity),this._segmentsHeight+1,this._selection.chunks.length*2]}},{key:"_build",value:function(){var r=this._selection,a=r.residues,s=r.parent,l=this._mode,c=this._colorer,u=l.getTension(),f=this._geo,p=0,g=[];_loopThrough(this._selection.subdivs,a,this._segmentsHeight,u,l,function(y,E){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,C=c.getResidueColor(y,s);g[p]=y._index,f.setItem(p,E,h,v),f.setColor(p++,C)}),this._chunksIdc=g,f.finalize()}},{key:"updateToFrame",value:function(r){var a=this._selection.parent,s=this._mode,l=this._colorer,c=s.getTension(),u=this._geo,f=r.getResidues(),p=0,g=r.needsColorUpdate(l);_loopThrough(this._selection.subdivs,f,this._segmentsHeight,c,s,function(y,E){u.setItem(p,E),g&&u.setColor(p,l.getResidueColor(y,a)),p++}),u.finalize()}}]),e}(ResiduesGroup);function _createSuper$1a(o){var t=_isNativeReflectConstruct$1a();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1a(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ResiduesTraceGroup=function(o){_inherits(e,o);var t=_createSuper$1a(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){for(var r=this._selection.subdivs,a=0,s=0,l=r.length;s<l;++s)for(var c=r[s].arr,u=0,f=c.length;u<f;++u)a+=c[u].end-c[u].start;return[a,this._polyComplexity]}},{key:"_build",value:function(){for(var r=this._selection,a=r.residues,s=r.parent,l=this._mode,c=this._colorer,u=this._geo,f=0,p=[],g=this._selection.subdivs,y=l.calcStickRadius(),E=0,h=g.length;E<h;++E)for(var v=g[E].arr,C=0,x=v.length;C<x;++C)for(var w=v[C].start,_=v[C].end,S=a[w],M=w+1;M<=_;++M){var T=a[M];p[f]={first:S._index,second:T._index},u.setItem(f,S._controlPoint,T._controlPoint,y),u.setColor(f,c.getResidueColor(S,s),c.getResidueColor(T,s)),f++,S=T}this._chunksIdc=p,u.finalize()}},{key:"updateToFrame",value:function(r){for(var a=r.getResidues(),s=this._selection.parent,l=this._mode,c=this._colorer,u=this._geo,f=0,p=this._selection.subdivs,g=l.calcStickRadius(),y=r.needsColorUpdate(c),E=0,h=p.length;E<h;++E)for(var v=p[E].arr,C=0,x=v.length;C<x;++C)for(var w=v[C].start,_=v[C].end,S=a[w],M=w+1;M<=_;++M){var T=a[M];u.setItem(f,S._controlPoint,T._controlPoint,g),y&&u.setColor(f,c.getResidueColor(S,s),c.getResidueColor(T,s)),f++,S=T}u.finalize()}},{key:"raycast",value:function(r,a){var s=[],l=this._selection.residues;this._mesh.raycast(r,s);for(var c=this._chunksIdc,u=0,f=s.length;u<f;++u)if(s[u].hasOwnProperty("chunkIdx")){var p=s[u].chunkIdx,g=c[Math.floor(p/2)],y=p%2===0?g.first:g.second;y<l.length&&(s[u].residue=l[y],a.push(s[u]))}}},{key:"_calcChunksList",value:function(r){for(var a=[],s=this._chunksIdc,l=this._selection.residues,c=0,u=s.length;c<u;++c){var f=s[c];l[f.first]._mask&r&&a.push(c*2),l[f.second]._mask&r&&a.push(c*2+1)}return a}}]),e}(ChemGroup);function _createSuper$19(o){var t=_isNativeReflectConstruct$19();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$19(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function getCylinderCount(o){return o<2?1:o}var BondsGroup=function(o){_inherits(e,o);var t=_createSuper$19(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_makeGeoArgs",value:function(){for(var r=this._mode.drawMultiorderBonds(),a=this._mode.showAromaticLoops(),s=this._selection.chunks,l=this._selection.bonds,c=0,u=0,f=s.length;u<f;++u)c+=this.getBondOrder(l[s[u]],r,a);return[c,this._polyComplexity]}},{key:"getBondOrder",value:function(r,a,s){var l=1;return a&&(!s||r._type!==Bond$5.BondType.AROMATIC)&&(l=getCylinderCount(r._order)),l}},{key:"raycast",value:function(r,a){var s=this._selection.bonds,l=[];this._mesh.raycast(r,l);for(var c=this._chunksIdc,u=0,f=l.length;u<f;++u)if(l[u].hasOwnProperty("chunkIdx")){var p=l[u].chunkIdx,g=c[Math.floor(p/2)];if(g<s.length){var y=s[g];l[u].atom=p%2===0?y._left:y._right,a.push(l[u])}}}},{key:"_calcChunksList",value:function(r,a){for(var s=[],l=this._selection.bonds,c=this._chunksIdc,u=0,f=c.length;u<f;++u){var p=l[c[u]];p._left.mask&r&&(!a||p._right.mask&r)&&s.push(2*u),p._right.mask&r&&(!a||p._left.mask&r)&&s.push(2*u+1)}return s}}]),e}(ChemGroup);function _createSuper$18(o){var t=_isNativeReflectConstruct$18();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$18(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BondsCylinderGroup=function(o){_inherits(e,o);var t=_createSuper$18(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_build",value:function(){for(var r=this._selection.chunks,a=this._selection,s=a.bonds,l=a.parent,c=this._mode,u=this._colorer,f=this._geo,p=c.drawMultiorderBonds(),g=c.showAromaticLoops(),y=c.calcStickRadius(),E=c.calcSpaceFraction(),h,v=new Vector3,C=new Vector3,x=0,w=[],_=0,S=r.length;_<S;++_){var M=s[r[_]],T=M._left,R=M._right,P=T.position,I=R.position;h=M.calcNormalDir();for(var B=this.getBondOrder(M,p,g),W=Math.min(c.calcAtomRadius(T),c.calcAtomRadius(R)),D=2*W/B,O=p?Math.min(y,D*.5*(1-E)):y,z=0;z<B;++z){var G=D*(B%2===0?((z/2|0)+.5)*(1-2*(z%2)):((z+1)/2|0)*(-1+2*(z%2)));w[x]=M._index,v.copy(P),v.addScaledVector(h,G),C.copy(I),C.addScaledVector(h,G),f.setItem(x,v,C,O),f.setColor(x++,u.getAtomColor(T,l),u.getAtomColor(R,l))}}f.finalize(),this._chunksIdc=w}},{key:"updateToFrame",value:function(r){for(var a=this._selection.chunks,s=this._selection.bonds,l=this._mode,c=this._colorer,u=this._geo,f=l.drawMultiorderBonds(),p=l.showAromaticLoops(),g=l.calcStickRadius(),y=l.calcSpaceFraction(),E,h=new Vector3,v=new Vector3,C=0,x=r.needsColorUpdate(c),w=0,_=a.length;w<_;++w){var S=s[a[w]],M=S._left,T=S._right,R=r.getAtomPos(M.index).clone(),P=r.getAtomPos(T.index);E=S.calcNormalDir();for(var I=this.getBondOrder(S,f,p),B=Math.min(l.calcAtomRadius(M),l.calcAtomRadius(T)),W=2*B/I,D=f?Math.min(g,W*.5*(1-y)):g,O=0;O<I;++O){var z=W*(I%2===0?((O/2|0)+.5)*(1-2*(O%2)):((O+1)/2|0)*(-1+2*(O%2)));h.copy(R),h.addScaledVector(E,z),v.copy(P),v.addScaledVector(E,z),u.setItem(C,h,v,D),x&&u.setColor(C,r.getAtomColor(c,M),r.getAtomColor(c,T)),C++}}u.finalize()}}]),e}(BondsGroup);function _createSuper$17(o){var t=_isNativeReflectConstruct$17();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$17(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var STEP_SIZE=.15,BondsLinesGroup=function(o){_inherits(e,o);var t=_createSuper$17(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_build",value:function(){for(var r=this._selection.chunks,a=this._selection,s=a.bonds,l=a.parent,c=this._mode,u=this._colorer,f=this._geo,p=c.drawMultiorderBonds(),g=c.showAromaticLoops(),y=new Vector3,E=new Vector3,h=new Vector3,v=0,C=[],x=0,w=r.length;x<w;++x){var _=s[r[x]],S=_._left,M=_._right,T=S.position,R=M.position,P=S.bonds.length===1,I=M.bonds.length===1;y.subVectors(R,T);for(var B=y.length(),W=_.calcNormalDir(),D=this.getBondOrder(_,p,g),O=0;O<D;++O){E.copy(T),h.copy(R);var z=D%2===0?((O/2|0)+.5)*(1-2*(O%2)):((O+1)/2|0)*(-1+2*(O%2));C[v]=_._index,D===2&&!P&&!I&&(z-=.5,z*=-1),!P&&!I&&D>1&&z!==0&&(E.lerpVectors(T,R,STEP_SIZE/B),h.lerpVectors(T,R,1-STEP_SIZE/B)),z*=STEP_SIZE,E.addScaledVector(W,z),h.addScaledVector(W,z),f.setItem(v,E,h),f.setColor(v++,u.getAtomColor(S,l),u.getAtomColor(M,l))}}f.finalize(),this._chunksIdc=C}},{key:"updateToFrame",value:function(r){for(var a=this._selection.chunks,s=this._selection.bonds,l=this._mode,c=this._colorer,u=this._geo,f=l.drawMultiorderBonds(),p=l.showAromaticLoops(),g=new Vector3,y=new Vector3,E=new Vector3,h=0,v=r.needsColorUpdate(c),C=0,x=a.length;C<x;++C){var w=s[a[C]],_=w._left,S=w._right,M=r.getAtomPos(_.index).clone(),T=r.getAtomPos(S.index),R=_.bonds.length===1,P=S.bonds.length===1;g.subVectors(T,M);for(var I=g.length(),B=w.calcNormalDir(),W=this.getBondOrder(w,f,p),D=0;D<W;++D){y.copy(M),E.copy(T);var O=W%2===0?((D/2|0)+.5)*(1-2*(D%2)):((D+1)/2|0)*(-1+2*(D%2));W===2&&!R&&!P&&(O-=.5,O*=-1),!R&&!P&&W>1&&O!==0&&(y.lerpVectors(M,T,STEP_SIZE/I),E.lerpVectors(M,T,1-STEP_SIZE/I)),O*=STEP_SIZE,y.addScaledVector(B,O),E.addScaledVector(B,O),u.setItem(h,y,E),v&&u.setColor(h,r.getAtomColor(c,_),r.getAtomColor(c,S)),h++}}u.finalize()}}]),e}(BondsGroup),groups={AtomsSphereGroup,AtomsSurfaceGroup,AtomsSASSESGroupStub,AtomsTextGroup,AromaticTorusGroup,AromaticLinesGroup,NucleicCylindersGroup,NucleicSpheresGroup,ResiduesSubseqGroup,ResiduesTraceGroup,BondsCylinderGroup,BondsLinesGroup};function _createSuper$16(o){var t=_isNativeReflectConstruct$16();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$16(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AtomsProcessor=function(o){_inherits(e,o);var t=_createSuper$16(e);function e(n,r,a,s,l,c,u,f){var p;_classCallCheck(this,e),p=t.call(this);var g=_assertThisInitialized(p);p._complex=a,p._mode=l;var y=a.getAtoms(),E=a.getTransforms();return a.forEachComponent(function(h){var v=[],C=0;if(h.forEachAtom(function(w){g._checkAtom(w,u)&&(v[C++]=w.index)}),C!==0){var x=new n(r,{atoms:y,chunks:v,parent:a},s,l,E,c,f);x._component=h,g.add(x)}}),p}return _createClass(e,[{key:"_checkAtom",value:function(r,a){return r.mask&a}},{key:"getSubset",value:function(r,a){for(var s=[],l=this.children,c=0,u=0,f=l.length;u<f;++u)if(l[u].getSubset)for(var p=l[u].getSubset(r,a),g=0,y=p.length;g<y;++g){var E=p[g];E._component=l[u]._component,s[c++]=E}return s}}]),e}(RCGroup);function _createSuper$15(o){var t=_isNativeReflectConstruct$15();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$15(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OrphanAtomsProcessor=function(o){_inherits(e,o);var t=_createSuper$15(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_checkAtom",value:function(r,a){if(!(r.mask&a))return!1;for(var s=r.bonds,l=0,c=s.length;l<c;++l)if(s[l]._left.mask&a&&s[l]._right.mask&a)return!1;return!0}}]),e}(AtomsProcessor);function _createSuper$14(o){var t=_isNativeReflectConstruct$14();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$14(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ResiduesProcessor=function(o){_inherits(e,o);var t=_createSuper$14(e);function e(n,r,a,s,l,c,u,f){var p;_classCallCheck(this,e),p=t.call(this);var g=_assertThisInitialized(p);p._complex=a;var y=a.getResidues(),E=a.getTransforms();return a.forEachComponent(function(h){var v=0,C=[];if(h.forEachResidue(function(w){g._checkResidue(w,u)&&(C[v++]=w._index)}),v!==0){var x=new n(r,{residues:y,chunks:C,parent:a},s,l,E,c,f);x._component=h,g.add(x)}}),p}return _createClass(e,[{key:"checkResidue",value:function(r,a){return r._mask&a}},{key:"getSubset",value:function(r,a){for(var s=[],l=this.children,c=0,u=0,f=l.length;u<f;++u)if(l[u].getSubset)for(var p=l[u].getSubset(r,a),g=0,y=p.length;g<y;++g){var E=p[g];E._component=l[u]._component,s[c++]=E}return s}}]),e}(RCGroup);function _createSuper$13(o){var t=_isNativeReflectConstruct$13();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$13(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NucleicProcessor=function(o){_inherits(e,o);var t=_createSuper$13(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_checkResidue",value:function(r,a){return a&r._mask&&r._cylinders!==null}}]),e}(ResiduesProcessor);function _createSuper$12(o){var t=_isNativeReflectConstruct$12();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$12(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SubseqsProcessor=function(o){_inherits(e,o);var t=_createSuper$12(e);function e(n,r,a,s,l,c,u,f){var p;_classCallCheck(this,e),p=t.call(this);var g=_assertThisInitialized(p);p._complex=a;var y=a.getResidues(),E=a.getTransforms();return a.forEachComponent(function(h){for(var v=h.getMaskedSubdivSequences(u),C=0,x=[],w=0,_=v.length;w<_;++w)for(var S=v[w].arr,M=0,T=S.length;M<T;++M)for(var R=S[M].start,P=S[M].end;R<=P;++R)x[C++]=y[R]._index;if(C!==0){var I=new n(r,{residues:y,chunks:x,subdivs:v,parent:a},s,l,E,c,f);I._component=h,g.add(I)}}),p}return _createClass(e,[{key:"getSubset",value:function(r,a){for(var s=[],l=this.children,c=0,u=0,f=l.length;u<f;++u)if(l[u].getSubset)for(var p=l[u].getSubset(r,a),g=0,y=p.length;g<y;++g){var E=p[g];E._component=l[u]._component,s[c++]=E}return s}}]),e}(RCGroup);function _createSuper$11(o){var t=_isNativeReflectConstruct$11();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$11(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BondsProcessor=function(o){_inherits(e,o);var t=_createSuper$11(e);function e(n,r,a,s,l,c,u,f){var p;_classCallCheck(this,e),p=t.call(this);var g=_assertThisInitialized(p);p._complex=a;var y=a.getBonds(),E=a.getTransforms();return a.forEachComponent(function(h){var v=[],C=0;if(h.forEachBond(function(w){var _=w._left,S=w._right;!(_.mask&u)||!(S.mask&u)||(v[C++]=w._index)}),C!==0){var x=new n(r,{bonds:y,chunks:v,parent:a},s,l,E,c,f);x._component=h,g.add(x)}}),p}return _createClass(e,[{key:"getSubset",value:function(r,a){for(var s=[],l=this.children,c=0,u=0,f=l.length;u<f;++u)if(l[u].getSubset)for(var p=l[u].getSubset(r,a),g=0,y=p.length;g<y;++g){var E=p[g];E._component=l[u]._component,s[c++]=E}return s}}]),e}(RCGroup);function _createSuper$10(o){var t=_isNativeReflectConstruct$10();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$10(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AromaticProcessor=function(o){_inherits(e,o);var t=_createSuper$10(e);function e(n,r,a,s,l,c,u,f){var p;_classCallCheck(this,e),p=t.call(this);var g=_assertThisInitialized(p);p._complex=a;var y=a.getAtoms(),E=a.getTransforms();return l.showAromaticLoops()?(a.forEachComponent(function(h){var v=[],C=0,x=[],w=0;h.forEachCycle(function(S){for(var M=S.atoms,T=0,R=0,P=M.length;R<P;++R)M[R].mask&u&&(++T,v[C++]=M[R].index);T>0&&(x[w++]=S)});var _=new n(r,{cycles:x,atoms:y,chunks:v,parent:a},s,l,E,c,f);_._component=h,g.add(_)}),p):_possibleConstructorReturn(p)}return _createClass(e,[{key:"getSubset",value:function(r,a){for(var s=[],l=this.children,c=0,u=0,f=l.length;u<f;++u)if(l[u].getSubset)for(var p=l[u].getSubset(r,a),g=0,y=p.length;g<y;++g){var E=p[g];E._component=l[u]._component,s[c++]=E}return s}}]),e}(RCGroup),processors={Atoms:AtomsProcessor,OrphanAtoms:OrphanAtomsProcessor,Residues:ResiduesProcessor,Nucleic:NucleicProcessor,Subseqs:SubseqsProcessor,Bonds:BondsProcessor,Aromatic:AromaticProcessor};function _bakeGroup(o,t,e){return function(n,r,a,s,l,c){return new t(e,o,n,r,a,s,l,c)}}var GroupsFactory=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"AtomsSpheres",value:function(e,n){var r=MeshCreator.createSpheres(e,n);return _bakeGroup(r,processors.Atoms,groups.AtomsSphereGroup)}},{key:"OrphanedAtomsCrosses",value:function(e,n,r){var a=MeshCreator.createCrosses(e,n,r);return _bakeGroup(a,processors.OrphanAtoms,groups.AtomsSphereGroup)}},{key:"BondsCylinders",value:function(e,n){var r=MeshCreator.create2CCylinders(e,n);return _bakeGroup(r,processors.Bonds,groups.BondsCylinderGroup)}},{key:"BondsLines",value:function(e,n,r){var a=MeshCreator.create2CLines(e,n,r);return _bakeGroup(a,processors.Bonds,groups.BondsLinesGroup)}},{key:"CartoonChains",value:function(e,n){var r=MeshCreator.createExtrudedChains(e,n);return _bakeGroup(r,processors.Subseqs,groups.ResiduesSubseqGroup)}},{key:"TraceChains",value:function(e,n){var r=MeshCreator.create2CClosedCylinders(e,n);return _bakeGroup(r,processors.Subseqs,groups.ResiduesTraceGroup)}},{key:"NucleicSpheres",value:function(e,n){var r=MeshCreator.createSpheres(e,n);return _bakeGroup(r,processors.Nucleic,groups.NucleicSpheresGroup)}},{key:"NucleicCylinders",value:function(e,n){var r=MeshCreator.create2CCylinders(e,n);return _bakeGroup(r,processors.Nucleic,groups.NucleicCylindersGroup)}},{key:"ALoopsTorus",value:function(e,n){var r=MeshCreator.createExtrudedChains(e,n);return _bakeGroup(r,processors.Aromatic,groups.AromaticTorusGroup)}},{key:"ALoopsLines",value:function(e,n,r){var a=MeshCreator.createChunkedLines(e,n,r);return _bakeGroup(a,processors.Aromatic,groups.AromaticLinesGroup)}},{key:"QuickSurfGeo",value:function(e,n,r){var a=MeshCreator.createQuickSurface(e,n,r);return _bakeGroup(a,processors.Atoms,groups.AtomsSurfaceGroup)}},{key:"ContactSurfaceGeo",value:function(e,n,r){var a=MeshCreator.createContactSurface(e,n,r);return _bakeGroup(a,processors.Atoms,groups.AtomsSurfaceGroup)}},{key:"SASSESSurfaceGeo",value:function(e,n,r){var a=MeshCreator.createSASSES(e,n,r);return _bakeGroup(a,processors.Atoms,groups.AtomsSASSESGroupStub)}},{key:"TextLabelsGeo",value:function(e,n){var r=MeshCreator.createLabels(e,n);return _bakeGroup(r,processors.Atoms,groups.AtomsTextGroup)}}]),o}(),Mode=function(){function o(t){if(_classCallCheck(this,o),this.constructor===o)throw new Error("Can not instantiate abstract class!");this.opts=lodashExports.merge(utils.deriveDeep(this.settings.now.modes[this.id],!0),t)}return _createClass(o,[{key:"identify",value:function(){var e=utils.objectsDiff(this.opts,this.settings.now.modes[this.id]);return lodashExports.isEmpty(e)?this.id:[this.id,e]}},{key:"buildGeometry",value:function(e,n,r,a){for(var s=this.opts.polyComplexity?this.opts.polyComplexity[this.settings.now.resolution]:0,l=this.depGroups,c=l.length,u=new gfxutils.RCGroup,f=this,p=0;p<c;++p){var g=l[p],y={};if(lodashExports.isArray(g)){y=g[1].call(this);var E=g,h=_slicedToArray(E,1);g=h[0]}var v=GroupsFactory[g](null,this.settings,y),C=new v(e,n,f,s,r,a);C.children.length>0&&u.add(C)}return u}}]),o}();makeContextDependent(Mode.prototype);Mode.prototype.id="__";Mode.prototype.depGroups=[];function _createSuper$$(o){var t=_isNativeReflectConstruct$$();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function getRenderParams$1(){return{lineWidth:this.opts.lineWidth}}var LinesMode=function(o){_inherits(e,o);var t=_createSuper$$(e);function e(n){var r;_classCallCheck(this,e),r=t.call(this,n),r.depGroups=r.depGroups.slice(0);for(var a=r.depGroups,s=0,l=a.length;s<l;++s)a[s]=[a[s],getRenderParams$1];return r}return _createClass(e,[{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}},{key:"calcAtomRadius",value:function(){return this.opts.atom}},{key:"getAromaticOffset",value:function(){return this.opts.offsarom}},{key:"getAromaticArcChunks",value:function(){return this.opts.chunkarom}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}}]),e}(Mode);_defineProperty(LinesMode,"id","LN");LinesMode.prototype.id="LN";LinesMode.prototype.name="Lines";LinesMode.prototype.shortName="Lines";LinesMode.prototype.depGroups=["ALoopsLines","BondsLines","OrphanedAtomsCrosses"];function _createSuper$_(o){var t=_isNativeReflectConstruct$_();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$_(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LicoriceMode=function(o){_inherits(e,o);var t=_createSuper$_(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"calcAtomRadius",value:function(r){return this.opts.bond}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),e}(Mode);_defineProperty(LicoriceMode,"id","LC");LicoriceMode.prototype.id="LC";LicoriceMode.prototype.name="Licorice";LicoriceMode.prototype.shortName="Licorice";LicoriceMode.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];function _createSuper$Z(o){var t=_isNativeReflectConstruct$Z();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$Z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BallsAndSticksMode=function(o){_inherits(e,o);var t=_createSuper$Z(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"calcAtomRadius",value:function(r){return r.element.radius*this.opts.atom}},{key:"calcStickRadius",value:function(){return this.opts.bond}},{key:"getAromRadius",value:function(){return this.opts.aromrad}},{key:"showAromaticLoops",value:function(){return this.opts.showarom}},{key:"calcSpaceFraction",value:function(){return this.opts.space}},{key:"drawMultiorderBonds",value:function(){return this.opts.multibond}}]),e}(Mode);_defineProperty(BallsAndSticksMode,"id","BS");BallsAndSticksMode.prototype.id="BS";BallsAndSticksMode.prototype.name="Balls and Sticks";BallsAndSticksMode.prototype.shortName="Balls";BallsAndSticksMode.prototype.depGroups=["AtomsSpheres","BondsCylinders","ALoopsTorus"];function _createSuper$Y(o){var t=_isNativeReflectConstruct$Y();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$Y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VanDerWaalsMode=function(o){_inherits(e,o);var t=_createSuper$Y(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"calcAtomRadius",value:function(r){return r.element.radius}}]),e}(Mode);_defineProperty(VanDerWaalsMode,"id","VW");VanDerWaalsMode.prototype.id="VW";VanDerWaalsMode.prototype.name="Van der Waals";VanDerWaalsMode.prototype.shortName="VDW";VanDerWaalsMode.prototype.depGroups=["AtomsSpheres"];function _createSuper$X(o){var t=_isNativeReflectConstruct$X();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$X(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TraceMode=function(o){_inherits(e,o);var t=_createSuper$X(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"calcStickRadius",value:function(){return this.opts.radius}}]),e}(Mode);_defineProperty(TraceMode,"id","TR");TraceMode.prototype.id="TR";TraceMode.prototype.name="Trace";TraceMode.prototype.shortName="Trace";TraceMode.prototype.depGroups=["TraceChains"];function _createSuper$W(o){var t=_isNativeReflectConstruct$W();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$W(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TubeMode=function(o){_inherits(e,o);var t=_createSuper$W(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getResidueRadius",value:function(r){return this.TUBE_RADIUS}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(r,a,s,l){var c=this.opts.radius;return this.TUBE_RADIUS=new Vector2(c,c),Mode.prototype.buildGeometry.call(this,r,a,s,l)}}]),e}(Mode);_defineProperty(TubeMode,"id","TU");TubeMode.prototype.id="TU";TubeMode.prototype.name="Tube";TubeMode.prototype.shortName="Tube";TubeMode.prototype.depGroups=["CartoonChains"];function _createSuper$V(o){var t=_isNativeReflectConstruct$V();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$V(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CartoonMode=function(o){_inherits(e,o);var t=_createSuper$V(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n),r.secCache={},r}return _createClass(e,[{key:"getResidueStartRadius",value:function(r){var a=r.getSecondary();if(!a||!a.generic)return this.TUBE_RADIUS;var s=this.secCache[a.generic];return s?a.term===r?s.start:s.center:this.TUBE_RADIUS}},{key:"getResidueEndRadius",value:function(r){var a=r.getSecondary();if(a===null||!a.generic)return this.TUBE_RADIUS;var s=this.secCache[a.generic];return s?a.term===r?this.ARROW_END:s.center:this.TUBE_RADIUS}},{key:"getResidueRadius",value:function(r,a){var s=this.getResidueStartRadius(r);if(a===0)return s;var l=this.getResidueEndRadius(r);return a===2?l:s.clone().lerp(l,a/2)}},{key:"calcStickRadius",value:function(r){return this.opts.radius}},{key:"getHeightSegmentsRatio",value:function(){return this.opts.heightSegmentsRatio}},{key:"getTension",value:function(){return this.opts.tension}},{key:"buildGeometry",value:function(r,a,s,l){var c=this.opts.radius,u=this.opts.depth;this.TUBE_RADIUS=new Vector2(c,c),this.ARROW_END=new Vector2(u,c);var f={},p=this.opts.ss;for(var g in p)f[g]={center:new Vector2(u,p[g].width),start:new Vector2(u,p[g].arrow)};return this.secCache=f,Mode.prototype.buildGeometry.call(this,r,a,s,l)}}]),e}(Mode);_defineProperty(CartoonMode,"id","CA");CartoonMode.prototype.id="CA";CartoonMode.prototype.name="Cartoon";CartoonMode.prototype.shortName="Cartoon";CartoonMode.prototype.depGroups=["CartoonChains","NucleicSpheres","NucleicCylinders"];function _createSuper$U(o){var t=_isNativeReflectConstruct$U();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$U(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var selectors$4=chem.selectors;function getRenderParams(){return{wireframe:this.opts.wireframe,zClip:this.opts.zClip}}var SurfaceMode=function(o){_inherits(e,o);var t=_createSuper$U(e);function e(n){var r;_classCallCheck(this,e),r=t.call(this,n),r.depGroups=r.depGroups.slice(0);for(var a=r.surfaceNames,s=r.depGroups,l=0,c=a.length;l<c;++l)s[s.length]=[a[l],getRenderParams];return r}return _createClass(e,[{key:"calcAtomRadius",value:function(r){return r.element.radius}},{key:"getVisibilitySelector",value:function(){var r=null;if(this.opts.subset!==""){var a=selectors$4.parse(this.opts.subset);a.error||(r=a.selector)}return r}}]),e}(Mode);SurfaceMode.prototype.isSurface=!0;SurfaceMode.prototype.surfaceNames=[];function _createSuper$T(o){var t=_isNativeReflectConstruct$T();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var QuickSurfaceMode=function(o){_inherits(e,o);var t=_createSuper$T(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getSurfaceOpts",value:function(){return{useBeads:!1,isoValue:this.opts.isoValue,gaussLim:this.opts.gaussLim[this.settings.now.resolution],radScale:this.opts.scale,gridSpacing:this.opts.gridSpacing[this.settings.now.resolution],zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),e}(SurfaceMode);_defineProperty(QuickSurfaceMode,"id","QS");QuickSurfaceMode.prototype.id="QS";QuickSurfaceMode.prototype.name="Quick Surface";QuickSurfaceMode.prototype.shortName="Quick Surf";QuickSurfaceMode.prototype.surfaceNames=["QuickSurfGeo"];function _createSuper$S(o){var t=_isNativeReflectConstruct$S();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IsoSurfaceMode=function(o){_inherits(e,o);var t=_createSuper$S(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,r),a._excludeProbe=n,a}return _createClass(e,[{key:"calcAtomRadius",value:function(r){return r.element.radius}},{key:"getSurfaceOpts",value:function(){return{gridSpacing:this.opts.polyComplexity[this.settings.now.resolution],radScale:this._radScale,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector(),probeRadius:this.opts.probeRadius,excludeProbe:this._excludeProbe}}}]),e}(SurfaceMode);IsoSurfaceMode.prototype.id="SU";IsoSurfaceMode.prototype.name="Surface";IsoSurfaceMode.prototype.shortName="Surface";IsoSurfaceMode.prototype.surfaceNames=["SASSESSurfaceGeo"];IsoSurfaceMode.prototype._radScale=1;IsoSurfaceMode.prototype._excludeProbe=!1;function _createSuper$R(o){var t=_isNativeReflectConstruct$R();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IsoSurfaceSASMode=function(o){_inherits(e,o);var t=_createSuper$R(e);function e(n){return _classCallCheck(this,e),t.call(this,!1,n)}return _createClass(e)}(IsoSurfaceMode);_defineProperty(IsoSurfaceSASMode,"id","SA");IsoSurfaceSASMode.prototype.id="SA";IsoSurfaceSASMode.prototype.name="Solvent Accessible Surface";IsoSurfaceSASMode.prototype.shortName="SAS";function _createSuper$Q(o){var t=_isNativeReflectConstruct$Q();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$Q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IsoSurfaceSESMode=function(o){_inherits(e,o);var t=_createSuper$Q(e);function e(n){return _classCallCheck(this,e),t.call(this,!0,n)}return _createClass(e)}(IsoSurfaceMode);_defineProperty(IsoSurfaceSESMode,"id","SE");IsoSurfaceSESMode.prototype.id="SE";IsoSurfaceSESMode.prototype.name="Solvent Excluded Surface";IsoSurfaceSESMode.prototype.shortName="SES";function _createSuper$P(o){var t=_isNativeReflectConstruct$P();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ContactSurfaceMode=function(o){_inherits(e,o);var t=_createSuper$P(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getSurfaceOpts",value:function(){return{probeRadius:this.opts.probeRadius,radScale:this.opts.polyComplexity[this.settings.now.resolution],scaleFactor:this.opts.polyComplexity[this.settings.now.resolution],gridSpacing:1/this.opts.polyComplexity[this.settings.now.resolution],isoValue:this.opts.isoValue,probePositions:this.opts.probePositions,zClip:this.opts.zClip,visibilitySelector:this.getVisibilitySelector()}}}]),e}(SurfaceMode);_defineProperty(ContactSurfaceMode,"id","CS");ContactSurfaceMode.prototype.id="CS";ContactSurfaceMode.prototype.name="Contact Surface";ContactSurfaceMode.prototype.shortName="Contact Surf";ContactSurfaceMode.prototype.isSurface=!0;ContactSurfaceMode.prototype.surfaceNames=["ContactSurfaceGeo"];function _createSuper$O(o){var t=_isNativeReflectConstruct$O();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TextMode=function(o){_inherits(e,o);var t=_createSuper$O(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getTemplateOptions",value:function(){return this.opts.template}},{key:"getLabelOpts",value:function(){return lodashExports.merge(this.opts,{colors:!0,adjustColor:!0,transparent:!0})}}]),e}(Mode);_defineProperty(TextMode,"id","TX");TextMode.prototype.id="TX";TextMode.prototype.name="Text mode";TextMode.prototype.shortName="Text";TextMode.prototype.depGroups=["TextLabelsGeo"];var modes$1=new EntityList([LinesMode,LicoriceMode,BallsAndSticksMode,VanDerWaalsMode,TraceMode,TubeMode,CartoonMode,QuickSurfaceMode,IsoSurfaceSASMode,IsoSurfaceSESMode,ContactSurfaceMode,TextMode]);function clamp(o,t,e){return o<=e?o<0?0:o:e}function lerpColor(o,t,e){var n=1-e,r=o>>16&255,a=o>>8&255,s=o&255,l=t>>16&255,c=t>>8&255,u=t&255,f=n*r+e*l,p=n*a+e*c,g=n*s+e*u;return f<<16|p<<8|g}var Palette=function(){function o(t,e){_classCallCheck(this,o),this.name=t||"Custom",this.id=e||"CP"}return _createClass(o,[{key:"getElementColor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.elementColors[e];return r===void 0&&!n?this.defaultElementColor:r}},{key:"getResidueColor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.residueColors[e];return r===void 0&&!n?this.defaultResidueColor:r}},{key:"getChainColor",value:function(e){var n=e.charCodeAt(0);return n=((n<0?0:n>=256?n-256:n)&31)%this.chainColors.length,this.chainColors[n]}},{key:"getSecondaryColor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.secondaryColors[e];return r===void 0&&!n?this.defaultSecondaryColor:r}},{key:"getSequentialColor",value:function(e){var n=this.colors,r=n.length;return e<0?n[e%r+r]:n[e%r]}},{key:"getGradientColor",value:function(e,n){var r=this.gradients[n];if(!r)return this.defaultNamedColor;var a=r.length,s=e*(a-1),l=Math.floor(s),c=clamp(l+1,0,a-1);return l=clamp(l,0,a-1),lerpColor(r[l],r[c],s-l)}},{key:"getNamedColor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.namedColors[e];return r===void 0&&!n?this.defaultNamedColor:r}}]),o}();lodashExports.assign(Palette.prototype,{colors:[16777215,16711680,65280,255,8421504],minRangeColor:0,midRangeColor:8355711,maxRangeColor:16777215,defaultElementColor:16777215,elementColors:{},defaultResidueColor:16777215,residueColors:{},chainColors:[16777215],defaultSecondaryColor:16777215,secondaryColors:{},defaultGradientColor:0,defaultNamedColor:16777215,namedColorsArray:[["indianred",13458524],["lightcoral",15761536],["salmon",16416882],["darksalmon",15308410],["lightsalmon",16752762],["crimson",14423100],["red",16711680],["firebrick",11674146],["darkred",9109504],["pink",16761035],["lightpink",16758465],["hotpink",16738740],["deeppink",16716947],["mediumvioletred",13047173],["palevioletred",14381203],["coral",16744272],["tomato",16737095],["orangered",16729344],["darkorange",16747520],["orange",16753920],["gold",16766720],["yellow",16776960],["lightyellow",16777184],["lemonchiffon",16775885],["lightgoldenrodyellow",16448210],["papayawhip",16773077],["moccasin",16770229],["peachpuff",16767673],["palegoldenrod",15657130],["khaki",15787660],["darkkhaki",12433259],["lavender",15132410],["thistle",14204888],["plum",14524637],["violet",15631086],["orchid",14315734],["fuchsia",16711935],["magenta",16711935],["mediumorchid",12211667],["mediumpurple",9662683],["rebeccapurple",6697881],["blueviolet",9055202],["darkviolet",9699539],["darkorchid",10040012],["darkmagenta",9109643],["purple",8388736],["indigo",4915330],["slateblue",6970061],["mediumslateblue",8087790],["darkslateblue",4734347],["greenyellow",11403055],["chartreuse",8388352],["lawngreen",8190976],["lime",65280],["limegreen",3329330],["palegreen",10025880],["lightgreen",9498256],["mediumspringgreen",64154],["springgreen",65407],["mediumseagreen",3978097],["seagreen",3050327],["forestgreen",2263842],["green",32768],["darkgreen",25600],["yellowgreen",10145074],["olivedrab",7048739],["olive",8421376],["darkolivegreen",5597999],["mediumaquamarine",6737322],["darkseagreen",9419919],["lightseagreen",2142890],["darkcyan",35723],["teal",32896],["aqua",65535],["cyan",65535],["lightcyan",14745599],["paleturquoise",11529966],["aquamarine",8388564],["turquoise",4251856],["mediumturquoise",4772300],["darkturquoise",52945],["cadetblue",6266528],["steelblue",4620980],["lightsteelblue",11584734],["powderblue",11591910],["lightblue",11393254],["skyblue",8900331],["lightskyblue",8900346],["deepskyblue",49151],["dodgerblue",2003199],["cornflowerblue",6591981],["royalblue",4286945],["blue",255],["mediumblue",205],["darkblue",139],["navy",128],["midnightblue",1644912],["cornsilk",16775388],["blanchedalmond",16772045],["bisque",16770244],["navajowhite",16768685],["wheat",16113331],["burlywood",14596231],["tan",13808780],["rosybrown",12357519],["sandybrown",16032864],["goldenrod",14329120],["darkgoldenrod",12092939],["peru",13468991],["chocolate",13789470],["saddlebrown",9127187],["sienna",10506797],["brown",10824234],["maroon",8388608],["white",16777215],["snow",16775930],["honeydew",15794160],["mintcream",16121850],["azure",15794175],["aliceblue",15792383],["ghostwhite",16316671],["whitesmoke",16119285],["seashell",16774638],["beige",16119260],["oldlace",16643558],["floralwhite",16775920],["ivory",16777200],["antiquewhite",16444375],["linen",16445670],["lavenderblush",16773365],["mistyrose",16770273],["gainsboro",14474460],["lightgray",13882323],["silver",12632256],["darkgray",11119017],["gray",8421504],["dimgray",6908265],["lightslategray",7833753],["slategray",7372944],["darkslategray",3100495],["black",0]],namedColors:{},gradients:{rainbow:[255,65535,65280,16776960,16711680],temp:[255,32767,16777215,16744192,16711680],hot:[16777215,16744192,16711680],cold:[16777215,32767,255],"blue-red":[255,16777215,16711680],reds:[16777215,16711680],blues:[16777215,255]}});var _Palette$prototype=Palette.prototype,namedColorsArray=_Palette$prototype.namedColorsArray,namedColors=_Palette$prototype.namedColors;for(var i=0,length=namedColorsArray.length;i<length;++i){var _namedColorsArray$i=_slicedToArray(namedColorsArray[i],2),name=_namedColorsArray$i[0],value=_namedColorsArray$i[1];namedColors[name]=value}var palette$2=new Palette("CPK","CP");palette$2.elementColors={H:16777215,C:2105376,N:2121983,O:15605776,F:65280,P:8397055,S:16776960,CL:47872,FE:13684944,CO:13684944,NI:13684944,CU:13684944,BR:34816,I:21760};var _palette$secondaryCol$1,palette$1=new Palette("Jmol","JM");palette$1.colors=[255,22015,44031,65535,65451,65365,65280,5635840,11271936,16776960,16755456,16733440,16711680,16711765,16711851,16711935,11206911,5570815];palette$1.elementColors={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:4366e3,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998};palette$1.defaultResidueColor=12492910;palette$1.residueColors={ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,A:10526975,C:16747595,G:16740464,I:8454143,T:10551200,U:16744576,DA:10526975,DC:16747595,DG:16740464,DI:8454143,DT:10551200,DU:16744576,"+A":10526975,"+C":16747595,"+G":16740464,"+I":8454143,"+T":10551200,"+U":16744576};palette$1.chainColors=[4294967295,4290826495,4289789872,4294951112,4294967168,4294951167,4289786096,4294955120,4293951616,4294303411,4278239231,4291648604,4284927402,4288335154,4293821166,4278243025,4278255487,4282168177,4278190219,4290623339,4278215680,4286578688,4286611456,4286578816,4278222976,4290283019,4289864226];var StructuralElementType$2=StructuralElement.Type;palette$1.secondaryColors=(_palette$secondaryCol$1={},_defineProperty(_palette$secondaryCol$1,StructuralElementType$2.HELIX_ALPHA,16711808),_defineProperty(_palette$secondaryCol$1,StructuralElementType$2.HELIX_PI,6291584),_defineProperty(_palette$secondaryCol$1,StructuralElementType$2.HELIX_310,10485888),_defineProperty(_palette$secondaryCol$1,StructuralElementType$2.STRAND,16762880),_defineProperty(_palette$secondaryCol$1,StructuralElementType$2.TURN,6324479),_defineProperty(_palette$secondaryCol$1,"dna",11403518),_defineProperty(_palette$secondaryCol$1,"rna",16580962),_palette$secondaryCol$1);var _palette$secondaryCol,palette=new Palette("VMD","VM");palette.colors=[255,16711680,6316128,16744448,16776960,8421427,10066329,65280,16777215,16751001,4243648,10879142,8447590,15099571,8408320,8421568];palette.defaultElementColor=8408320;palette.elementColors={H:16777215,C:4243391,N:255,O:16711680,P:8421427,S:16776960};palette.defaultResidueColor=4243648;palette.residueColors={ALA:255,ARG:16777215,ASN:8421427,ASP:16711680,CYS:16776960,GLN:16744448,GLU:16751001,GLY:16777215,HIS:4243648,ILE:65280,LEU:16751001,LYS:4243648,MET:16776960,PHE:10879142,PRO:8408064,SER:16776960,THR:15099571,TRP:10066329,TYR:65280,VAL:8421427,A:255,C:16744448,G:16776960,T:10879142,U:65280,DA:255,DC:16744448,DG:16776960,DT:10879142,DU:65280,"+A":255,"+C":16744448,"+G":16776960,"+T":10879142,"+U":65280,WAT:4243648,H2O:4243648,HOH:4243648};palette.chainColors=[16777215].concat(palette.colors);var StructuralElementType$1=StructuralElement.Type;palette.secondaryColors=(_palette$secondaryCol={},_defineProperty(_palette$secondaryCol,StructuralElementType$1.HELIX_ALPHA,10879142),_defineProperty(_palette$secondaryCol,StructuralElementType$1.HELIX_310,255),_defineProperty(_palette$secondaryCol,StructuralElementType$1.HELIX_PI,16711680),_defineProperty(_palette$secondaryCol,StructuralElementType$1.STRAND,16776960),_defineProperty(_palette$secondaryCol,StructuralElementType$1.BRIDGE,8421427),_defineProperty(_palette$secondaryCol,StructuralElementType$1.TURN,4243648),_palette$secondaryCol);var palettes$1=new EntityList([palette$2,palette$1,palette]),Colorer=function(){function o(t){if(_classCallCheck(this,o),this.constructor===o)throw new Error("Can not instantiate abstract class!");this.opts=lodashExports.merge(utils.deriveDeep(settings$1.now.colorers[this.id],!0),t),this.palette=palettes$1.first}return _createClass(o,[{key:"identify",value:function(){var e=utils.objectsDiff(this.opts,settings$1.now.colorers[this.id]);return lodashExports.isEmpty(e)?this.id:[this.id,e]}}]),o}();Colorer.prototype.id="__";function _createSuper$N(o){var t=_isNativeReflectConstruct$N();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$N(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ElementColorer=function(o){_inherits(e,o);var t=_createSuper$N(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){var s=r.element.name;return s==="C"&&this.opts.carbon>=0?this.opts.carbon:this.palette.getElementColor(s)}},{key:"getResidueColor",value:function(r,a){return this.palette.defaultResidueColor}}]),e}(Colorer);_defineProperty(ElementColorer,"id","EL");ElementColorer.prototype.id="EL";ElementColorer.prototype.name="Element";ElementColorer.prototype.shortName="Element";function _createSuper$M(o){var t=_isNativeReflectConstruct$M();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$M(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ResidueTypeColorer=function(o){_inherits(e,o);var t=_createSuper$M(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.getResidueColor(r.residue,a)}},{key:"getResidueColor",value:function(r,a){return this.palette.getResidueColor(r._type._name)}}]),e}(Colorer);_defineProperty(ResidueTypeColorer,"id","RT");ResidueTypeColorer.prototype.id="RT";ResidueTypeColorer.prototype.name="Residue Type";ResidueTypeColorer.prototype.shortName="Residue";function _createSuper$L(o){var t=_isNativeReflectConstruct$L();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SequenceColorer=function(o){_inherits(e,o);var t=_createSuper$L(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.getResidueColor(r.residue,a)}},{key:"getResidueColor",value:function(r,a){var s=r._chain;if(s.minSequence===Number.POSITIVE_INFINITY&&s.maxSequence===Number.NEGATIVE_INFINITY)return this.palette.defaultNamedColor;var l=s.minSequence,c=s.maxSequence>l?s.maxSequence:l+1;return this.palette.getGradientColor((r._sequence-l)/(c-l),this.opts.gradient)}}]),e}(Colorer);_defineProperty(SequenceColorer,"id","SQ");SequenceColorer.prototype.id="SQ";SequenceColorer.prototype.name="Sequence";SequenceColorer.prototype.shortName="Sequence";function _createSuper$K(o){var t=_isNativeReflectConstruct$K();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$K(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ChainColorer=function(o){_inherits(e,o);var t=_createSuper$K(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.getResidueColor(r.residue,a)}},{key:"getResidueColor",value:function(r,a){return this.palette.getChainColor(r.getChain()._name)}}]),e}(Colorer);_defineProperty(ChainColorer,"id","CH");ChainColorer.prototype.id="CH";ChainColorer.prototype.name="Chain";ChainColorer.prototype.shortName="Chain";function _createSuper$J(o){var t=_isNativeReflectConstruct$J();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$J(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SecondaryStructureColorer=function(o){_inherits(e,o);var t=_createSuper$J(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.getResidueColor(r.residue,a)}},{key:"getResidueColor",value:function(r,a){if(r._type.flags&ResidueType$1.Flags.DNA)return this.palette.getSecondaryColor("dna");if(r._type.flags&ResidueType$1.Flags.RNA)return this.palette.getSecondaryColor("rna");var s=r.getSecondary();if(s){var l=this.palette.getSecondaryColor(s.type,!0);return l===void 0&&(l=this.palette.getSecondaryColor(s.generic)),l}return this.palette.defaultSecondaryColor}}]),e}(Colorer);_defineProperty(SecondaryStructureColorer,"id","SS");SecondaryStructureColorer.prototype.id="SS";SecondaryStructureColorer.prototype.name="Secondary Structure";SecondaryStructureColorer.prototype.shortName="Structure";function _createSuper$I(o){var t=_isNativeReflectConstruct$I();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UniformColorer=function(o){_inherits(e,o);var t=_createSuper$I(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.opts.color}},{key:"getResidueColor",value:function(r,a){return this.opts.color}}]),e}(Colorer);_defineProperty(UniformColorer,"id","UN");UniformColorer.prototype.id="UN";UniformColorer.prototype.name="Uniform";UniformColorer.prototype.shortName="Uniform";function _createSuper$H(o){var t=_isNativeReflectConstruct$H();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$H(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ConditionalColorer=function(o){_inherits(e,o);var t=_createSuper$H(e);function e(n){var r;_classCallCheck(this,e),r=t.call(this,n);var a=selectors$5.parse(r.opts.subset);return r._subsetCached=a.error?selectors$5.none():a.selector,r}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this._subsetCached.includesAtom(r)?this.opts.color:this.opts.baseColor}},{key:"getResidueColor",value:function(r,a){for(var s=this._subsetCached,l=r._atoms,c=0,u=l.length;c<u;++c)if(!s.includesAtom(l[c]))return this.opts.baseColor;return this.opts.color}}]),e}(Colorer);_defineProperty(ConditionalColorer,"id","CO");ConditionalColorer.prototype.id="CO";ConditionalColorer.prototype.name="Conditional";ConditionalColorer.prototype.shortName="Conditional";function _createSuper$G(o){var t=_isNativeReflectConstruct$G();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$G(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ConformationColorer=function(o){_inherits(e,o);var t=_createSuper$G(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.palette.getChainColor(String.fromCharCode(r.location))}},{key:"getResidueColor",value:function(r,a){return this.palette.defaultResidueColor}}]),e}(Colorer);_defineProperty(ConformationColorer,"id","CF");ConformationColorer.prototype.id="CF";ConformationColorer.prototype.name="Conformation";ConformationColorer.prototype.shortName="Conformation";function _createSuper$F(o){var t=_isNativeReflectConstruct$F();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$F(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TemperatureColorer=function(o){_inherits(e,o);var t=_createSuper$F(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){var s=this.opts,l=1;return r.temperature&&s?(s.min===s.max?l=r.temperature>s.max?1:0:l=(r.temperature-s.min)/(s.max-s.min),this.palette.getGradientColor(l,s.gradient)):this.palette.defaultGradientColor}},{key:"getResidueColor",value:function(r,a){var s=this.opts;if(!s)return this.palette.defaultGradientColor;if(r.temperature){var l=0;return s.min===s.max?l=r.temperature>s.max?1:0:l=(r.temperature-s.min)/(s.max-s.min),this.palette.getGradientColor(l,s.gradient)}return this.palette.defaultGradientColor}}]),e}(Colorer);_defineProperty(TemperatureColorer,"id","TM");TemperatureColorer.prototype.id="TM";TemperatureColorer.prototype.name="Temperature";TemperatureColorer.prototype.shortName="Temperature";function _createSuper$E(o){var t=_isNativeReflectConstruct$E();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OccupancyColorer=function(o){_inherits(e,o);var t=_createSuper$E(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_getColorByOccupancy",value:function(r,a){if(r!==void 0){var s=1-r;return this.palette.getGradientColor(s,a.gradient)}return this.palette.defaultGradientColor}},{key:"getAtomColor",value:function(r,a){var s=this.opts;return this._getColorByOccupancy(r.occupancy,s)}},{key:"getResidueColor",value:function(r,a){var s=this.opts;return this._getColorByOccupancy(r.occupancy,s)}}]),e}(Colorer);_defineProperty(OccupancyColorer,"id","OC");OccupancyColorer.prototype.id="OC";OccupancyColorer.prototype.name="Occupancy";OccupancyColorer.prototype.shortName="Occupancy";function _createSuper$D(o){var t=_isNativeReflectConstruct$D();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HydrophobicityColorer=function(o){_inherits(e,o);var t=_createSuper$D(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.getResidueColor(r.residue,a)}},{key:"getResidueColor",value:function(r,a){var s=this.palette.defaultResidueColor;if(r._type.hydrophobicity!==void 0){var l=-4.5,c=4.5;s=this.palette.getGradientColor((r._type.hydrophobicity-l)/(c-l),this.opts.gradient)}return s}}]),e}(Colorer);_defineProperty(HydrophobicityColorer,"id","HY");HydrophobicityColorer.prototype.id="HY";HydrophobicityColorer.prototype.name="Hydrophobicity";HydrophobicityColorer.prototype.shortName="Hydrophobicity";function _createSuper$C(o){var t=_isNativeReflectConstruct$C();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$C(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MoleculeColorer=function(o){_inherits(e,o);var t=_createSuper$C(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){return this.getResidueColor(r.residue,a)}},{key:"getResidueColor",value:function(r,a){var s=r._molecule,l=a.getMoleculeCount();return l>1?this.palette.getGradientColor((s.index-1)/(l-1),this.opts.gradient):this.palette.getGradientColor(0,this.opts.gradient)}}]),e}(Colorer);_defineProperty(MoleculeColorer,"id","MO");MoleculeColorer.prototype.id="MO";MoleculeColorer.prototype.name="Molecule";MoleculeColorer.prototype.shortName="Molecule";function _createSuper$B(o){var t=_isNativeReflectConstruct$B();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$B(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function scaleColor(o,t){var e=o>>16&255,n=o>>8&255,r=o&255,a=t*e,s=t*n,l=t*r;return a<<16|s<<8|l}var CarbonColorer=function(o){_inherits(e,o);var t=_createSuper$B(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"getAtomColor",value:function(r,a){var s=this.opts.color,l=scaleColor(s,this.opts.factor);return r.flags&Atom$2.Flags.CARBON?s:l}},{key:"getResidueColor",value:function(r,a){return this.opts.color}}]),e}(Colorer);_defineProperty(CarbonColorer,"id","CB");CarbonColorer.prototype.id="CB";CarbonColorer.prototype.name="Carbon";CarbonColorer.prototype.shortName="Carbon";var colorers$1=new EntityList([ElementColorer,ResidueTypeColorer,SequenceColorer,ChainColorer,SecondaryStructureColorer,UniformColorer,ConditionalColorer,ConformationColorer,TemperatureColorer,OccupancyColorer,HydrophobicityColorer,MoleculeColorer,CarbonColorer]);function neutralColor(o){return new Color(o,o,o)}var materialList=[{id:"DF",name:"Diffuse",shortName:"Diffuse",uberOptions:{diffuse:neutralColor(1),specular:neutralColor(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"SF",name:"Soft Plastic",shortName:"Soft",uberOptions:{diffuse:neutralColor(1),specular:neutralColor(.1),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"PL",name:"Glossy Plastic",shortName:"Glossy",uberOptions:{diffuse:neutralColor(.56),specular:neutralColor(.28),shininess:100,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"ME",name:"Metal",shortName:"Metal",uberOptions:{diffuse:neutralColor(.56),specular:neutralColor(.55),shininess:30,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!1}},{id:"TR",name:"Transparent",shortName:"Transparent",uberOptions:{diffuse:neutralColor(1),specular:neutralColor(0),shininess:1,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"GL",name:"Glass",shortName:"Glass",uberOptions:{diffuse:neutralColor(.5),specular:neutralColor(.65),shininess:100,opacity:.5},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!0,toonShading:!1}},{id:"BA",name:"Backdrop",shortName:"Backdrop",uberOptions:{diffuse:neutralColor(1),specular:neutralColor(0),shininess:1,opacity:1},values:{lights:!1,fog:!1,depthWrite:!1,transparent:!1,toonShading:!1}},{id:"TN",name:"Toon",shortName:"Toon",uberOptions:{diffuse:neutralColor(1),specular:neutralColor(0),shininess:1,opacity:1},values:{lights:!0,fog:!0,depthWrite:!0,transparent:!1,toonShading:!0}},{id:"FL",name:"Flat",shortName:"Flat",uberOptions:{diffuse:neutralColor(1),specular:neutralColor(0),shininess:0,opacity:1},values:{lights:!1,fog:!0,depthWrite:!0,transparent:!1}}],materials$1=new EntityList(materialList);function _gatherObjects(o,t){var e=[];return o.traverse(function(n){for(var r=0;r<t.length;r++)if(n instanceof t[r]){e[e.length]=n;break}}),e}function createDerivativeMesh(o,t,e){var n=o.material.createInstance();n.setValues(t);var r=new o.constructor(o.geometry,n);return r.material.needsUpdate=!0,r.applyMatrix4(o.matrix),r.layers.set(e),r}function traverseMeshes(o,t,e){for(var n=_gatherObjects(o,t),r=0,a=n.length;r<a;++r){var s=n[r];s.parent&&e(s)}}function applyTransformsToMeshes(o,t){var e=t.length;if(!(e<1)){var n=[Mesh,LineSegments,Line];traverseMeshes(o,n,function(r){r.applyMatrix4(t[0]);for(var a=1;a<e;++a){var s=new r.constructor(r.geometry,r.material);r.parent.add(s),s.applyMatrix4(t[a])}})}}var processTransparentMaterial=function(){var o={prepassTransparancy:!0,fakeOpacity:!1,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1};return function(t,e){e instanceof UberMaterial&&traverseMeshes(t,[Mesh,LineSegments],function(n){n.material.setValues({prepassTransparancy:!1,fakeOpacity:!1}),n.material.needsUpdate=!0,n.layers.set(gfxutils.LAYERS.TRANSPARENT);var r=createDerivativeMesh(n,o,gfxutils.LAYERS.PREPASS_TRANSPARENT);n.parent.add(r)})}}(),processColFromPosMaterial=function(){var o={colorFromPos:!0,transparent:!1,colorFromDepth:!1,lights:!1,shadowmap:!1,fog:!1,overrideColor:!1,fogTransparent:!1,attrColor:!1,attrColor2:!1,attrAlphaColor:!1,fakeOpacity:!1};return function(t,e){e instanceof UberMaterial&&traverseMeshes(t,[Mesh,LineSegments],function(n){var r=createDerivativeMesh(n,o,gfxutils.LAYERS.COLOR_FROM_POSITION);n.parent.add(r)})}}(),createShadowmapMaterial=function(){var o={colorFromDepth:!0,orthoCam:!0,lights:!1,shadowmap:!1,fog:!1};return function(t,e){e instanceof UberMaterial&&traverseMeshes(t,[Mesh,LineSegments],function(n){if(!n.receiveShadow&&n.material.shadowmap&&n.material.setValues({shadowmap:!1}),!!n.material.lights&&n.castShadow&&gfxutils.belongToSelectLayers(n)){var r=createDerivativeMesh(n,o,gfxutils.LAYERS.SHADOWMAP);r.isShadowmapMesh=!0,n.parent.add(r)}})}}();function removeShadowmapMaterial(o,t){t instanceof UberMaterial&&traverseMeshes(o,[Mesh,LineSegments],function(e){e.isShadowmapMesh&&e.parent.remove(e)})}function forEachMeshInGroup(o,t){function e(n){n instanceof Mesh&&t(n);for(var r=0,a=n.children.length;r<a;r++)e(n.children[r])}e(o)}function _countMeshTriangles(o){var t=o.geometry;if(t instanceof InstancedBufferGeometry){var e=t.attributes;for(var n in e)if(e.hasOwnProperty(n)&&e[n]instanceof InstancedBufferAttribute){var r=e[n],a=t.index?t.index.array.length/3:0;return a*r.array.length/r.itemSize}return 0}return t instanceof BufferGeometry?t.index?t.index.array.length/3:0:t.faces?t.faces.length:0}function countTriangles(o){var t=0;return forEachMeshInGroup(o,function(e){t+=_countMeshTriangles(e)}),t}var meshutils={applyTransformsToMeshes,processTransparentMaterial,processColFromPosMaterial,createShadowmapMaterial,removeShadowmapMaterial,forEachMeshInGroup,countTriangles},selectors$3=chem.selectors,Representation=function(){function o(t,e,n,r){_classCallCheck(this,o);var a={clipPlane:settings$1.now.draft.clipPlane,fogTransparent:settings$1.now.bg.transparent,shadowmap:settings$1.now.shadow.on,shadowmapType:settings$1.now.shadow.type};this.index=t,this.mode=e,this.colorer=n,this.selector=r,this.selectorString="",this.count=0,this.material=new UberMaterial,this.material.setValues(a),this.material.setUberOptions({fogAlpha:settings$1.now.fogAlpha}),this.materialPreset=materials$1.first,this.needsRebuild=!0,this.visible=!0,this.setMode(e)}return _createClass(o,[{key:"markAtoms",value:function(e){return this.count=e.markAtoms(this.selector,1<<this.index),this.needsRebuild=!0,this.count}},{key:"unmarkAtoms",value:function(e){e.clearAtomBits(1<<this.index),this.count=0}},{key:"setMode",value:function(e){this.mode=e}},{key:"setMaterialPreset",value:function(e){this.materialPreset=e,this.material.setUberOptions(e.uberOptions),this.material.setValues(e.values)}},{key:"reset",value:function(){this.geo=null,this.selectionGeo=null}},{key:"buildGeometry",value:function(e){return this.reset(),this.needsRebuild=!1,settings$1.now.ao&&this.material.setValues({normalsToGBuffer:settings$1.now.ao}),this.geo=this.mode.buildGeometry(e,this.colorer,1<<this.index,this.material),this.material.uberOptions.opacity<.99&&settings$1.now.transparency==="prepass"&&meshutils.processTransparentMaterial(this.geo,this.material),this.geo.visible=this.visible,gfxutils.processObjRenderOrder(this.geo,this.materialPreset.id),meshutils.processColFromPosMaterial(this.geo,this.material),settings$1.now.shadow.on&&meshutils.createShadowmapMaterial(this.geo,this.material),this.geo}},{key:"buildSelectionGeometry",value:function(e){var n=null;if(this.geo&&"getSubset"in this.geo){var r=this.geo.getSubset(e);if(r&&r.length>0){n=new Group,n.matrixAutoUpdate=!1,n.matrix=this.geo.matrix;for(var a=0;a<r.length;a++){var s=r[a];n.add(s)}}}return n&&(n.visible=this.visible),this.selectionGeo=n,this.selectionGeo}},{key:"compare",value:function(e){var n={},r=String(this.selector);(!e||r.valueOf()!==String(e.selector).valueOf())&&(n.selector=r);var a=this.mode.identify();(!e||Array.isArray(a)||a!==e.mode)&&(n.mode=a);var s=this.colorer.identify();return(!e||Array.isArray(s)||s!==e.colorer)&&(n.colorer=s),(!e||this.materialPreset.id!==e.material)&&(n.material=this.materialPreset.id),n}},{key:"change",value:function(e,n,r,a){var s={};if(e.selector){var l=selectors$3.parse(e.selector).selector,c=String(l);this.selectorString!==c&&(s.selector=c,this.selectorString=c,this.selector=l,this.markAtoms(n))}if(e.mode){var u=e.mode;lodashExports.isEqual(this.mode.identify(),u)||(s.mode=u,this.setMode(r))}if(e.colorer){var f=e.colorer;lodashExports.isEqual(this.colorer.identify(),f)||(s.colorer=f,this.colorer=a)}if(e.material){var p=e.material;lodashExports.isEqual(this.materialPreset.id,p)||(s.material=p,this.setMaterialPreset(materials$1.get(e.material)))}return s}},{key:"show",value:function(e){this.visible=e,this.geo&&(this.geo.visible=e),this.selectionGeo&&(this.selectionGeo.visible=e)}}]),o}();function _createSuper$A(o){var t=_isNativeReflectConstruct$A();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _traverseComponentGroups(o,t,e){var n=o.children;if(n)for(var r=0,a=n.length;r<a;++r){var s=n[r];s._component===t&&e(s),s instanceof gfxutils.RCGroup&&_traverseComponentGroups(s,t,e)}}function ComplexEditor(){}var ComplexComponentEditor=function(o){_inherits(e,o);var t=_createSuper$A(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r._complexVisual=n,r._inProgress=!1,r}return _createClass(e,[{key:"begin",value:function(){var r=this._complexVisual.getComplex();this._componentTransforms=[];for(var a=0;a<r._components.length;++a){var s=r._components[a];this._componentTransforms[s._index]=new Object3D}return this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){for(var r=this._complexVisual.getComplex(),a=0;a<r._components.length;++a)this._bakeComponentTransform(r._components[a]);r.onAtomPositionChanged(),this._resetComponentTransform(),this._complexVisual.finalizeEdit()}}},{key:"discard",value:function(){this._inProgress&&(this._resetComponentTransform(),this._complexVisual.finalizeEdit())}},{key:"getAltObj",value:function(){var r={objects:[],pivot:new Vector3(0,0,0)},a=this._complexVisual,s=a.getSelectedComponent();if(s===null)return r;var l=this._complexVisual.getSelectionGeo(),c=1<<a.getSelectionBit(),u,f,p,g;for(_traverseComponentGroups(a,s,function(h){r.objects.push(h)}),u=0;u<l.children.length;++u)for(p=l.children[u],f=0;f<p.children.length;++f)g=p.children[f],g.hasOwnProperty("_component")&&g._component===s&&r.objects.push(g);r.objects.push(this._componentTransforms[s._index]);var y=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return s.forEachResidue(function(h){var v=h._atoms;for(f=0;f<v.length;++f)v[f].mask&c&&(y.min(v[f].position),E.max(v[f].position))}),r.pivot.lerpVectors(y,E,.5),r}},{key:"_bakeComponentTransform",value:function(r){var a=this._componentTransforms[r._index];a&&(!(a.position.x===0&&a.position.y===0&&a.position.z===0)||!(a.quaternion.x===0&&a.quaternion.y===0&&a.quaternion.z===0&&a.quaternion.w===1))&&(a.updateMatrix(),r.forEachResidue(function(s){for(var l=s._atoms,c=0;c<l.length;++c)l[c].position.applyMatrix4(a.matrix)}))}},{key:"_resetComponentTransform",value:function(){var r=this._complexVisual,a=this._complexVisual.getSelectionGeo(),s,l,c,u;for(s=0;s<this._componentTransforms.length;++s)u=this._componentTransforms[s],u.position.set(0,0,0),u.quaternion.set(0,0,0,1);for(s=0;s<r.children.length;++s)for(c=r.children[s],l=0;l<c.children.length;++l)u=c.children[l],u.hasOwnProperty("_component")&&(u.position.set(0,0,0),u.quaternion.set(0,0,0,1));for(s=0;s<a.children.length;++s)for(c=a.children[s],l=0;l<c.children.length;++l)u=c.children[l],u.hasOwnProperty("_component")&&(u.position.set(0,0,0),u.quaternion.set(0,0,0,1))}}]),e}(ComplexEditor),ComplexFragmentEditor=function(o){_inherits(e,o);var t=_createSuper$A(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r._complexVisual=n,r._inProgress=!1,r}return _createClass(e,[{key:"begin",value:function(){var r=this._complexVisual,a=this._complexVisual.getSelectionGeo(),s=this._getSelectionBorderAtoms();if(s.length<1||s.length>2)return logger.error("Can only edit fragments with one or two bound atoms."),!1;this._fragmentBoundAtoms=s;var l=1<<r.getSelectionBit();r.disableSubset(l,!0);for(var c=0;c<a.children.length;++c)a.children[c].visible=!1;var u=s[0].position.clone();s.length===2&&u.lerp(s[1].position,.5),this._fragmentGeo=new Group,r.add(this._fragmentGeo),this._fragmentGeo.position.copy(u),this._fragmentSelectionGeo=new Group,a.add(this._fragmentSelectionGeo),this._fragmentSelectionGeo.position.copy(u);var f=u.clone();f.negate();for(var p=0;p<r.children.length;++p){var g=r.children[p];if("getSubset"in g){var y=new Group;this._fragmentGeo.add(y);var E=new Group;this._fragmentSelectionGeo.add(E);for(var h=g.getSubset(l,!0),v=0;v<h.length;v++){var C=h[v];y.add(C),C.position.copy(f)}for(var x=g.getSubset(l,!0),w=0;w<x.length;w++){var _=x[w];E.add(_),_.position.copy(f)}}}return gfxutils.applySelectionMaterial(this._fragmentSelectionGeo),this._inProgress=!0,!0}},{key:"apply",value:function(){if(this._inProgress){var r=this._complexVisual,a=r.getSelectionBit(),s=this._fragmentGeo.position,l=this._fragmentGeo.matrix.clone();l.multiply(new Matrix4().makeTranslation(-s.x,-s.y,-s.z)),this._bakeAtomTransform(l,1<<a),r.enableSubset(1<<a,!0),r.getComplex().onAtomPositionChanged(),r.finalizeEdit()}}},{key:"discard",value:function(){if(this._inProgress){var r=this._complexVisual,a=this._complexVisual.getSelectionGeo();this._fragmentGeo.parent.remove(this._fragmentGeo),r.enableSubset(1<<r.getSelectionBit(),!0);for(var s=0;s<a.children.length;++s){var l=a.children[s];l.visible?a.remove(l):l.visible=!0}r.finalizeEdit()}}},{key:"isFreeRotationAllowed",value:function(){return this._fragmentBoundAtoms.length<2}},{key:"getAltObj",value:function(){var r={objects:[],pivot:new Vector3(0,0,0)};r.objects.push(this._fragmentGeo,this._fragmentSelectionGeo);var a=this._fragmentBoundAtoms;if(a.length===1){if(a[0].bonds.length===1){var s=a[0].bonds[0];r.axis=new Vector3().subVectors(s._right.position,s._left.position),r.axis.normalize(),r.axis.transformDirection(this._complexVisual.matrixWorld)}}else a.length===2&&(r.axis=new Vector3().subVectors(a[1].position,a[0].position),r.axis.normalize(),r.axis.transformDirection(this._complexVisual.matrixWorld));return r}},{key:"_getSelectionBorderAtoms",value:function(){var r=this._complexVisual.getComplex(),a=1<<this._complexVisual.getSelectionBit(),s={};r.forEachBond(function(g){g._left.mask&a?g._right.mask&a||(s[g._left.index]=1):g._right.mask&a&&(s[g._right.index]=1)});for(var l=[],c=Object.keys(s),u=0,f=c.length;u<f;++u){var p=c[u];l.push(r._atoms[p])}return l}},{key:"_bakeAtomTransform",value:function(r,a){this._complexVisual.getComplex().forEachAtom(function(s){s.mask&a&&s.position.applyMatrix4(r)})}}]),e}(ComplexEditor),ComplexVisualEdit={ComponentEditor:ComplexComponentEditor,FragmentEditor:ComplexFragmentEditor};function _createSuper$z(o){var t=_isNativeReflectConstruct$z();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var selectors$2=chem.selectors;function lookupAndCreate(o,t){Array.isArray(t)||(t=[t]);var e=t,n=_slicedToArray(e,2),r=n[0],a=n[1],s=o.get(r)||o.first;return new s(a)}var ComplexVisual=function(o){_inherits(e,o);var t=_createSuper$z(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._complex=r,a._reprList=[],a._repr=null,a._reprListChanged=!0,a._selectionBit=0,a._reprUsedBits=0,a._selectionCount=0,a._selectionGeometry=new Group,a}return _createClass(e,[{key:"getBoundaries",value:function(){return this._complex.getBoundaries()}},{key:"release",value:function(){this._selectionGeometry.parent&&this._selectionGeometry.remove(this._selectionGeometry),Visual.prototype.release.call(this)}},{key:"getComplex",value:function(){return this._complex}},{key:"getSelectionCount",value:function(){return this._selectionCount}},{key:"getSelectionGeo",value:function(){return this._selectionGeometry}},{key:"getSelectionBit",value:function(){return this._selectionBit}},{key:"getEditor",value:function(){return this._editor}},{key:"resetReps",value:function(r){this._complex&&this._complex.clearAtomBits(-1),this._reprListChanged=!0,this._reprUsedBits=0,this._reprList.length=r.length;for(var a=0,s=r.length;a<s;++a){var l=r[a],c=void 0,u=void 0;if(typeof l.selector=="string"){u=l.selector;var f=selectors$2.parse(u);c=f.selector}else if(typeof l.selector>"u"){u=settings$1.now.presets.default[0].selector;var p=selectors$2.parse(u);c=p.selector}else c=l.selector,u=c.toString();var g=lookupAndCreate(modes$1,l.mode),y=lookupAndCreate(colorers$1,l.colorer),E=materials$1.get(l.material)||materials$1.first;this._reprList[a]=new Representation(a,g,y,c),this._reprList[a].setMaterialPreset(E),this._reprList[a].selectorString=u,this._complex&&this._complex.markAtoms(c,1<<a),this._reprUsedBits|=1<<a}this._repr=r.length>0?this._reprList[0]:null,this._selectionBit=r.length,this._reprUsedBits|=1<<this._selectionBit,this._selectionCount=0,this._complex&&this._complex.update()}},{key:"repCount",value:function(){return this._reprList.length}},{key:"repCurrent",value:function(r){return r>=0&&r<this._reprList.length?this._repr=this._reprList[r]:r=this._reprList.indexOf(this._repr),r}},{key:"rep",value:function(r,a){if(!a&&(r===void 0||r instanceof Object)&&(a=r,r=this.repCurrent()),r<0||r>this._reprList.length)return logger.error("Rep ".concat(r," does not exist!")),null;if(r===this._reprList.length){var s=this.repAdd(a);return logger.warn("Rep ".concat(r," does not exist! New representation was created.")),{desc:s.desc,index:r,status:"created"}}var l=this._reprList[r],c={selector:l.selectorString,mode:l.mode.identify(),colorer:l.colorer.identify(),material:l.materialPreset.id};if(a){var u=l.change(a,this._complex,lookupAndCreate(modes$1,a.mode),lookupAndCreate(colorers$1,a.colorer));if(!lodashExports.isEmpty(u)){l.needsRebuild=!0;for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f],logger.debug("rep[".concat(r,"].").concat(f," changed to ").concat(u[f])));return u.mode&&l.mode.isSurface&&(settings$1.now.resolution==="ultra"||settings$1.now.resolution==="high")&&(logger.report('Surface resolution was changed to "medium" to avoid hang-ups.'),settings$1.set("resolution","medium")),{desc:c,index:r,status:"changed"}}}return{desc:c,index:r,status:""}}},{key:"repGet",value:function(r){return(r===void 0||r instanceof Object)&&(r=this.repCurrent()),r<0||r>=this._reprList.length?null:this._reprList[r]}},{key:"_getFreeReprIdx",value:function(){for(var r=this._reprUsedBits,a=0;a<=e.NUM_REPRESENTATION_BITS;++a,r>>=1)if(!(r&1))return a;return-1}},{key:"repAdd",value:function(r){if(this._reprList.length>=e.NUM_REPRESENTATION_BITS)return null;var a=this._getFreeReprIdx();if(a<0)return null;var s=this.buildSelectorFromMask(1<<this._selectionBit),l=settings$1.now.presets.default[0],c=lodashExports.merge({selector:l.selector,mode:l.mode,colorer:l.colorer,material:l.material},r),u=typeof c.selector=="string"?selectors$2.parse(c.selector).selector:c.selector,f=new Representation(this._selectionBit,lookupAndCreate(modes$1,c.mode),lookupAndCreate(colorers$1,c.colorer),u);return f.selectorString=u.toString(),f.setMaterialPreset(materials$1.get(c.material)),f.markAtoms(this._complex),this._reprList.push(f),this._selectionBit=a,this._reprUsedBits|=1<<this._selectionBit,this._complex.markAtoms(s,1<<this._selectionBit),{desc:c,index:this._reprList.length-1}}},{key:"repRemove",value:function(r){r===void 0&&(r=this.repCurrent());var a=this._reprList.length;if(!(r<0||r>=a||a<=1)){var s=this._reprList[r];s.unmarkAtoms(this._complex),this._reprUsedBits&=~(1<<s.index),this._reprList.splice(r,1),s===this._repr&&(--a,r=r<a?r:a-1,this._repr=this._reprList[r]),this._reprListChanged=!0}}},{key:"repHide",value:function(r,a){if(a===void 0&&(a=!0),!(r<0||r>=this._reprList.length)){var s=this._reprList[r];s.show(!a)}}},{key:"select",value:function(r,a){a?this._selectionCount+=this._complex.markAtomsAdditionally(r,1<<this._selectionBit):this._selectionCount=this._complex.markAtoms(r,1<<this._selectionBit),this._complex.updateStructuresMask(),this.rebuildSelectionGeometry()}},{key:"resetSelectionMask",value:function(){this._selectionCount!==0&&(this._selectionCount=0,this._complex&&this._complex.clearAtomBits(1<<this._selectionBit))}},{key:"updateSelectionMask",value:function(r){var a=this,s=r.atom,l=r.residue,c=r.chain,u=r.molecule,f=1<<this._selectionBit,p=~f;if(s)l=s.residue,c=l._chain,u=l._molecule,s.mask&f?(s.mask&=p,l._mask&=p,c._mask&=p,u&&(u.mask&=p),this._selectionCount--):(s.mask|=f,this._selectionCount++,l.collectMask(),c.collectMask(),u&&u.collectMask());else if(l)c=l._chain,u=l._molecule,l._mask&f?(l._mask&=p,c._mask&=p,l.forEachAtom(function(y){y.mask&f&&(y.mask&=p,a._selectionCount--)})):(l._mask|=f,l.forEachAtom(function(y){y.mask&f||(y.mask|=f,a._selectionCount++)}),c.collectMask(),u&&u.collectMask());else if(c||u){var g=c||u;g._mask&f?(g._mask&=p,g.forEachResidue(function(y){y._mask&f&&(y._mask&=p,y.forEachAtom(function(E){E.mask&f&&(E.mask&=p,a._selectionCount--)}),y._mask&=p)})):(g._mask|=f,g.forEachResidue(function(y){if(!(y._mask&f)){y._mask|=f,y.forEachAtom(function(h){h.mask&f||(h.mask|=f,a._selectionCount++)});var E=c?y.getMolecule():y.getChain();E&&E.collectMask()}}))}else this.resetSelectionMask()}},{key:"expandSelection",value:function(){var r=this,a=1<<this._selectionBit,s=1<<31;this._complex.forEachBond(function(c){c._left.mask&a?c._right.mask&a||(c._right.mask|=s):c._right.mask&a&&(c._left.mask|=s)});var l=~s;this._complex.forEachAtom(function(c){c.mask&s&&(c.mask=c.mask&l|a,++r._selectionCount)}),this._complex.updateStructuresMask()}},{key:"shrinkSelection",value:function(){var r=this,a=1<<this._selectionBit,s=1<<31;this._complex.forEachBond(function(c){c._left.mask&a?c._right.mask&a||(c._left.mask|=s):c._right.mask&a&&(c._right.mask|=s)}),this._complex.forEachAtom(function(c){c.mask&a&&c.bonds.length===1&&(c.mask|=s)});var l=~(a|s);this._complex.forEachAtom(function(c){c.mask&s&&(c.mask&=l,--r._selectionCount)}),this._complex.updateStructuresMask()}},{key:"getSelectedComponent",value:function(){var r=1<<this._selectionBit,a=null,s=!1;return this._complex.forEachAtom(function(l){l.mask&r&&(a===null?a=l.residue._component:a!==l.residue._component&&(s=!0))}),s?null:a}},{key:"getSelectionCenter",value:function(r,a,s){r.set(0,0,0);var l=0;return this._complex.forEachAtom(function(c){a(c,s)&&(r.add(c.position),l++)}),l===0?!1:(r.divideScalar(l),r.applyMatrix4(this.matrix),!0)}},{key:"needsRebuild",value:function(){if(this._reprListChanged)return!0;for(var r=this._reprList,a=0,s=r.length;a<s;++a){var l=r[a];if(l.needsRebuild)return!0}return!1}},{key:"rebuild",value:function(){var r=this;return gfxutils.clearTree(this),new Promise(function(a){var s=r._complex;if(!s){a();return}var l=!1;setTimeout(function(){console.time("build");for(var c=r._reprList,u=palettes$1.get(settings$1.now.palette)||palettes$1.first,f=!1,p=0,g=c.length;p<g;++p){var y=c[p];if(y.colorer.palette=u,y.needsRebuild){y.reset();try{y.buildGeometry(s)}catch(E){if(E instanceof utils.OutOfMemoryError)y.needsRebuild=!1,y.reset(),logger.error("Not enough memory to build geometry for representation ".concat(y.index+1)),l=!0;else throw E}}f=l||f||gfxutils.groupHasGeometryToRender(y.geo),y.geo&&r.add(y.geo)}r._reprListChanged=!1,console.timeEnd("build"),a()},10)})}},{key:"setNeedsRebuild",value:function(){for(var r=this._reprList,a=0,s=r.length;a<s;++a)r[a].needsRebuild=!0}},{key:"rebuildSelectionGeometry",value:function(){var r=1<<this._selectionBit;gfxutils.clearTree(this._selectionGeometry);for(var a=0,s=this._reprList.length;a<s;++a){var l=this._reprList[a],c=l.buildSelectionGeometry(r);if(c){this._selectionGeometry.add(c);for(var u=0;u<c.children.length;u++){var f=c.children[u];if(this._editor&&this._editor._componentTransforms){var p=this._editor._componentTransforms[f._component._index];p&&(f.position.copy(p.position),f.quaternion.copy(p.quaternion))}}gfxutils.applySelectionMaterial(c)}}}},{key:"_buildSelectorFromSortedLists",value:function(r,a,s){var l=this._complex;function c(g){for(var y=[],E=0,h=NaN,v=NaN,C=0,x=g.length;C<x;++C){var w=g[C];w===v+1?v=w:(Number.isNaN(h)||(y[E++]=new selectors$2.Range(h,v)),h=v=w)}return Number.isNaN(h)||(y[E]=new selectors$2.Range(h,v)),y}var u=null;if(s.length===l._chains.length)u=selectors$2.all();else{var f;if(s.length>0&&(f=selectors$2.chain(s),u=u?selectors$2.or(u,f):f),Object.keys(a).length>0)for(var p in a)a.hasOwnProperty(p)&&(f=selectors$2.and(selectors$2.chain(p),selectors$2.residx(c(a[p]))),u=u?selectors$2.or(u,f):f);r.length>0&&(f=selectors$2.serial(c(r)),u=u?selectors$2.or(u,f):f),u||(u=selectors$2.none())}return u}},{key:"buildSelectorFromMask",value:function(r){var a=this._complex,s=[],l={},c=[];return a.forEachChain(function(u){u._mask&r&&s.push(u._name)}),a.forEachResidue(function(u){if(u._mask&r&&!(u._chain._mask&r)){var f=u._chain._name;f in l?l[f].push(u._index):l[f]=[u._index]}}),a.forEachAtom(function(u){u.mask&r&&!(u.residue._mask&r)&&c.push(u.serial)}),this._buildSelectorFromSortedLists(c,l,s)}},{key:"forSelectedResidues",value:function(r){var a=1<<this._selectionBit;this._complex.forEachResidue(function(s){s._mask&a&&r(s)})}},{key:"beginComponentEdit",value:function(){if(this._editor)return null;var r=new ComplexVisualEdit.ComponentEditor(this);return r.begin()?(this._editor=r,r):null}},{key:"beginFragmentEdit",value:function(){if(this._editor)return null;var r=new ComplexVisualEdit.FragmentEditor(this);return r.begin()?(this._editor=r,r):null}},{key:"finalizeEdit",value:function(){this._editor=null}},{key:"setMaterialValues",value:function(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,l=0,c=this._reprList.length;l<c;++l){var u=this._reprList[l];u.material.setValues(r),a&&u.geo.traverse(function(f){f instanceof Mesh&&(f.material.setValues(r),s!==void 0&&s(f),f.material.needsUpdate=!0)})}}},{key:"setUberOptions",value:function(r){for(var a=0,s=this._reprList.length;a<s;++a){var l=this._reprList[a];l.material.setUberOptions(r)}}},{key:"within",value:function(r,a){var s=this._complex.getVoxelWorld();if(s===null)return!1;var l=1<<this._selectionBit;return this._complex.markAtoms(r,l),s&&s.forEachAtomWithinDistFromMasked(this._complex,l,Number(a),function(c){c.mask|=l}),this._selectionCount=this._complex.countAtomsByMask(l),this._complex.updateStructuresMask(),this.buildSelectorFromMask(l)}}]),e}(Visual);ComplexVisual.NUM_REPRESENTATION_BITS=30;var vertexVolumeFaces=`varying vec3 pos;\r
\r
void main() {\r
  // we're assuming local position is in [-0.5, 0.5]\r
  // we need to offset it to be represented in RGB\r
  pos = position.xyz + 0.5;\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`,fragmentVolumeFaces=`varying vec3 pos;\r
\r
void main() {\r
  gl_FragColor = vec4(pos, 0.5);\r
}`,vertexVolume=`varying vec4 screenSpacePos;\r
\r
void main() {\r
  screenSpacePos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
  gl_Position = screenSpacePos;\r
}`,fragmentVolume=`uniform mat4 projectionMatrix;\r
\r
// 3D volume texture\r
uniform vec3 volumeDim;    // volume dimensions, pixels\r
uniform sampler2D tileTex; // tiled texture containing all Z-slices of a 3D data\r
uniform vec2 tileTexSize;  // size of tiled texture, pixels\r
uniform vec2 tileStride;   // UV stride between slices in tile tex, pixels\r
\r
uniform vec3 boxAngles;//value of angles({x: alpha, y:beta, z:gamma}) types 1 - if angle is obtuse, 0 - if acute\r
uniform vec3 delta; //Projection box delta's from non-orthogonal origin axes; {x: XY, y : XZ, z: YZ}\r
\r
uniform vec3 _isoLevel0;\r
uniform float _flipV;\r
uniform sampler2D _BFLeft;\r
uniform sampler2D _BFRight;\r
uniform sampler2D _FFLeft;\r
uniform sampler2D _FFRight;\r
uniform sampler2D _WFFLeft;\r
uniform sampler2D _WFFRight;\r
\r
varying vec4 screenSpacePos;\r
\r
#define NO_COLOR vec4(0., 0., 0., 0.)\r
\r
vec4 sample3DTexture(vec3 texCoord) {\r
  // a pair of Z slices is determined by nearest slice border\r
  float zSliceBorder = floor(texCoord.z * volumeDim.z + 0.5);\r
  float zSliceNumber1 = max(zSliceBorder - 1.0, 0.0);\r
  float zSliceNumber2 = min(zSliceBorder, volumeDim.z - 1.0);\r
\r
  float rowTiles = floor(tileTexSize.x / tileStride.x);\r
\r
  // calculate coords in tile texture for both slices\r
  vec2 tileOffset = vec2(mod(zSliceNumber1, rowTiles), floor(zSliceNumber1 / rowTiles));\r
  vec2 texCoordSlice1 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r
  tileOffset = vec2(mod(zSliceNumber2, rowTiles), floor(zSliceNumber2 / rowTiles));\r
  vec2 texCoordSlice2 = (texCoord.xy * volumeDim.xy + tileOffset * tileStride) / tileTexSize.xy;\r
\r
  // bilinear filtering\r
  vec4 colorSlice1 = texture2D(tileTex, texCoordSlice1);\r
  vec4 colorSlice2 = texture2D(tileTex, texCoordSlice2);\r
  float weightSlice2 = texCoord.z * volumeDim.z - (zSliceNumber1 + 0.5);\r
  return mix(colorSlice1, colorSlice2, weightSlice2);\r
}\r
\r
vec4 sample3DTextureInclined(vec3 boxCoord) { // delta:{ x: XY, y : XZ, z: YZ }\r
  vec3 textCoord = boxCoord;\r
  vec2 currDelta = mix(boxCoord.zz, vec2(1., 1.) - boxCoord.zz, boxAngles.yx) * delta.yz;\r
\r
  textCoord.y = (boxCoord.y  - currDelta.y) / (1. - delta.z);\r
  if (textCoord.y < 0.0 || textCoord.y > 1.0)\r
    return NO_COLOR;\r
\r
  currDelta.x += mix(textCoord.y, 1.0 - textCoord.y, boxAngles.z) * delta.x;\r
\r
  textCoord.x = (boxCoord.x - currDelta.x) / (1. - delta.x - delta.y);\r
  if (textCoord.x < 0.0 || textCoord.x > 1.0)\r
    return NO_COLOR;\r
\r
  return sample3DTexture(textCoord);\r
}\r
\r
float CalcColor(vec3 iter, vec3 dir) {\r
  float d = 1. / 128.;\r
  vec3 dx = vec3(d, 0.0, 0.0);\r
  vec3 dy = vec3(0.0, d, 0.0);\r
  vec3 dz = vec3(0.0, 0.0, d);\r
\r
  // #Opt: coordInc.x:(iter + dx).x > 1. ? 0.: sample3DTextureInclined(iter + dx).x,\r
  vec3 coordInc = mix(\r
    vec3(\r
      sample3DTextureInclined(iter + dx).x,\r
      sample3DTextureInclined(iter + dy).x,\r
      sample3DTextureInclined(iter + dz).x\r
    ),\r
    vec3(0. ,0. , 0.),\r
    vec3(floor((iter + dx).x), floor((iter + dy).y), floor((iter + dz).z))\r
  );\r
\r
  // #Opt: coordDec.x:(iter - dx).x < 0. ? 0.: sample3DTextureInclined(iter - dx).x,\r
  vec3 coordDec = mix(\r
    vec3(0. ,0. , 0.),\r
    vec3(\r
      sample3DTextureInclined(iter - dx).x,\r
      sample3DTextureInclined(iter - dy).x,\r
      sample3DTextureInclined(iter - dz).x\r
    ),\r
    vec3(ceil((iter - dx).x), ceil((iter - dy).y), ceil((iter - dz).z))\r
  );\r
\r
  vec3 N = normalize(coordInc - coordDec);\r
  float dif = max(0.0, dot(N, dir));\r
  return dif;\r
}\r
\r
vec3 AccuracyIso(vec3 left, vec3 right, float volLeft, float threshold) {\r
  for (int i = 0; i < 5; i++) {\r
    vec3 iterator = 0.5 * (left + right);\r
    float vol = sample3DTextureInclined(iterator).r;\r
    if ((volLeft - threshold) * (vol - threshold) < 0.)\r
      right = iterator;\r
    else\r
      left = iterator;\r
  }\r
  return 0.5 * (left + right);\r
}\r
\r
vec3 CorrectIso(vec3 left, vec3 right, float tr) {\r
  for (int j = 0; j < 5; j++) {\r
    vec3 iterator = 0.5 * (left + right);\r
    float vol = sample3DTextureInclined(iterator).r;\r
    if (vol < tr)\r
      right = iterator;\r
    else\r
      left = iterator;\r
  }\r
  return 0.5 * (left + right);\r
}\r
\r
vec4 GetIso1(vec3 start, vec3 back, float molDist, vec3 dir, float tr, int count) {\r
  float vol, stepSize = (float(count) + 2.) / float(STEPS_COUNT);\r
  vec3 step = stepSize * dir, iterator = start, left, right;\r
  vec4 acc = NO_COLOR;\r
\r
  for (int i = 0; i < STEPS_COUNT; i++) {\r
    iterator = iterator + step;\r
    vol = sample3DTextureInclined(iterator).r;\r
    if (length(iterator - back) <= stepSize || (vol > tr))\r
      break;\r
  }\r
\r
  if (vol > tr)\r
    acc = vec4(CorrectIso(iterator, iterator - step, tr).xyz, 1.);\r
\r
  return acc;\r
}\r
\r
float easeOut(float x0, float x1, float x) {\r
  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r
  return 1.0 - (1.0 - t) * (1.0 - t);\r
}\r
\r
float easeIn(float x0, float x1, float x) {\r
  float t = clamp((x - x0) / (x1 - x0), 0.0, 1.0);\r
  return t * t;\r
}\r
\r
vec3 GetColSimple(float vol) {\r
  float t = easeOut(_isoLevel0.x, _isoLevel0.y, vol);\r
  float s = easeIn(_isoLevel0.y, _isoLevel0.z, vol);\r
  return vec3(0.5, 0.6, 0.7) * (1.0 - t) + 2.0 * vec3(s, 0, 0);\r
}\r
\r
vec4 VolRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  vec4 acc = NO_COLOR, iso;\r
  vec3 iterator = start, sumColor = vec3(0., 0., 0.);\r
  float stepSize, alpha, sumAlpha = 0.0, vol, curStepSize, molD;\r
  vec3 step, col, colOld, right;\r
  float tr0 = _isoLevel0.x;\r
  float dif, r, kd, finish;\r
  int count = 0, stopMol = 0;\r
\r
  for (int k = 0; k < 3; k++) {\r
    stepSize = (float(k) + 2.) / float(STEPS_COUNT);\r
    kd = 140. * tr0 * stepSize;\r
    r = 1. - kd;\r
    step = stepSize * dir;\r
    iso = GetIso1(iterator, back, molDist, dir, tr0, k);\r
    if (iso.a < 0.1 || length(iso.xyz - start) > molDist)\r
      break;\r
    iterator = iso.xyz;\r
    dif = 1.;// CalcColor(iterator, dir);\r
    colOld = GetColSimple(tr0);\r
    curStepSize = stepSize;\r
    for (int i = 0; i < STEPS_COUNT; i++) {\r
      iterator = iterator + step;\r
      molD = length(iterator - start);\r
      vol = sample3DTextureInclined(iterator).r;\r
      finish = distance(iterator, back) - stepSize;\r
      if (finish < 0.0 || vol < tr0 || (sumAlpha > 0.97) || molD > molDist)\r
        break;\r
      alpha = (1. - r);\r
      col = GetColSimple(vol);\r
      vol = sample3DTextureInclined(iterator - 0.5 * step).r;\r
      vec3 colMid = GetColSimple(vol);\r
      sumColor += (1. - sumAlpha) * (colOld + 4.* colMid + col) * alpha / 6.;\r
      sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r
      colOld = col;\r
    } // for i\r
\r
    if (finish < 0.0 || sumAlpha > 0.97)\r
      break;\r
\r
    if (molD > molDist) {\r
      curStepSize = stepSize - (molD - molDist);\r
      right = iterator - (molD - molDist) * dir;\r
      vol = sample3DTextureInclined(right).r;\r
    } else {\r
      vec3 left = iterator - step;\r
      right = CorrectIso(left, iterator, tr0);\r
      curStepSize = distance(left, right);\r
      vol = tr0;\r
    }\r
\r
    alpha = (1. - r) * curStepSize / stepSize;\r
    dif = 1.;// CalcColor(right, dir);\r
    col = GetColSimple(vol);\r
    vol = sample3DTextureInclined(iterator - 0.5 * curStepSize / stepSize * step).r;\r
    vec3 colMid = GetColSimple(vol);\r
    sumColor += (1. - sumAlpha) * (colOld + 4. * colMid + col) * alpha / 6.;\r
    sumAlpha += (1. - sumAlpha) * alpha;// *(1. - 1.0*dif*dif);\r
\r
    if (molD > molDist)\r
      break;\r
  } // for k\r
  acc.rgb = 1. * sumColor / sumAlpha;\r
  acc.a = sumAlpha;\r
  return acc;\r
}\r
\r
vec4 VolRender1(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  float stepSize = 1.0 / float(STEPS_COUNT);\r
  float len = length(back - start);\r
  vec3 step = stepSize * dir;\r
  vec3 iterator = start;\r
  float acc = 0.0;\r
\r
  for (int i = 0; i < STEPS_COUNT; i++) {\r
    if (float(i) * stepSize > len)\r
      break;\r
    iterator = iterator + step;\r
    if (sample3DTextureInclined(iterator).r > _isoLevel0.x)\r
      acc += 10. * sample3DTextureInclined(iterator).r / float(STEPS_COUNT);\r
  }\r
\r
  return vec4(1.,1.,1., acc);\r
}\r
\r
vec4 IsoRender(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  vec4 tst = GetIso1(start, back, 2., dir, _isoLevel0.x, 0);\r
  vec4 col = NO_COLOR;\r
\r
  if (length(tst.xyz - start) < molDist && tst.a > 0.1) {\r
    float dif =  CalcColor(tst.xyz, dir);\r
    dif = 0.9 * dif * dif;\r
    col = vec4(dif, dif, dif, 1);\r
  }\r
  return col;\r
}\r
\r
vec4 VolRender2(vec3 start, vec3 back, float molDist, vec3 dir) {\r
  return sample3DTexture(start);\r
}\r
\r
void main() {\r
  vec3 tc = screenSpacePos.xyz / screenSpacePos.w * 0.5 + 0.5;\r
\r
  if (_flipV > 0.0) {\r
    tc.y = 1.0 - tc.y;\r
  }\r
\r
  vec3 start;\r
  vec3 back;\r
  vec3 molBack;\r
  if (projectionMatrix[0][2] < 0.0) {\r
    start = texture2D(_FFLeft, tc.xy).xyz;\r
    back = texture2D(_BFLeft, tc.xy).xyz;\r
    molBack = texture2D(_WFFLeft, tc.xy).xyz;\r
  } else {\r
    start = texture2D(_FFRight, tc.xy).xyz;\r
    back = texture2D(_BFRight, tc.xy).xyz;\r
    molBack = texture2D(_WFFRight, tc.xy).xyz;\r
  }\r
\r
  vec3 dir = normalize(back - start);\r
\r
  float molDist = 2.0;\r
  if (length(molBack) > 0.001) {\r
    molDist = distance(start, molBack);\r
  }\r
\r
  #ifdef ISO_MODE\r
    gl_FragColor = IsoRender(start, back, molDist, dir);\r
  #else\r
    gl_FragColor = VolRender(start, back, molDist, dir);\r
  #endif\r
}\r
`,vertexFarPlane=`varying vec4 volPos;\r
uniform float aspectRatio;\r
uniform float farZ;\r
uniform float tanHalfFOV;\r
uniform mat4  matWorld2Volume;\r
\r
void main() {\r
  // rescale plane to fill in the whole far plane area seen from camera\r
  vec3 pos = position.xyz;\r
  pos.x = pos.x * tanHalfFOV * farZ * aspectRatio;\r
  pos.y = pos.y * tanHalfFOV * farZ;\r
  // common transformation\r
  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\r
  // calc pos in volume CS\r
  volPos = matWorld2Volume * modelMatrix * vec4(pos, 1.0);\r
  // we're assuming local position is in [-0.5, 0.5]\r
  // we need to offset it to be represented in RGB\r
  volPos = volPos + 0.5;\r
  volPos.w = 0.5;\r
}\r
`,fragmentFarPlane=`varying vec4 volPos;\r
\r
void main() {\r
  gl_FragColor = volPos;\r
}`;function _createSuper$y(o){var t=_isNativeReflectConstruct$y();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var volumeUniforms=UniformsUtils.merge([{volumeDim:{type:"v3",value:new Vector3(512,512,512)},tileTex:{type:"t",value:null},tileTexSize:{type:"v2",value:new Vector2(512,512)},tileStride:{type:"v2",value:new Vector2(512,512)},boxAngles:{type:"v3",value:new Vector3(1,1,1)},delta:{type:"v3",value:new Vector3(0,0,0)},_isoLevel0:{type:"v2",value:new Vector3(.5,.75,1)},_flipV:{type:"f",value:0},_BFLeft:{type:"t",value:null},_BFRight:{type:"t",value:null},_FFLeft:{type:"t",value:null},_FFRight:{type:"t",value:null},_WFFLeft:{type:"t",value:null},_WFFRight:{type:"t",value:null}}]);function overrideUniforms(o,t){var e=UniformsUtils.clone(t);for(var n in o)e.hasOwnProperty(n)&&(e[n].value=o[n]);return e}function facesPosMaterialParams(o,t){return{uniforms:overrideUniforms(o,{}),vertexShader:vertexVolumeFaces,fragmentShader:fragmentVolumeFaces,transparent:!1,depthTest:!1,depthWrite:!1,side:t}}var BackFacePosMaterial=function(o){_inherits(e,o);var t=_createSuper$y(e);function e(n){_classCallCheck(this,e);var r=facesPosMaterialParams(n,BackSide);return t.call(this,r)}return _createClass(e)}(ShaderMaterial),ShaderParams=_createClass(function o(t,e,n,r){_classCallCheck(this,o),this.uniforms=overrideUniforms(t,e),this.vertexShader=n,this.fragmentShader=r,this.transparent=!1,this.depthTest=!1,this.depthWrite=!1,this.side=FrontSide}),BackFacePosMaterialFarPlane=function(o){_inherits(e,o);var t=_createSuper$y(e);function e(n){_classCallCheck(this,e);var r=UniformsUtils.merge([{aspectRatio:{type:"f",value:0},farZ:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},matWorld2Volume:{type:"4fv",value:new Matrix4}}]),a=new ShaderParams(n,r,vertexFarPlane,fragmentFarPlane);return t.call(this,a)}return _createClass(e)}(ShaderMaterial),FrontFacePosMaterial=function(o){_inherits(e,o);var t=_createSuper$y(e);function e(n){_classCallCheck(this,e);var r=facesPosMaterialParams(n,FrontSide);return t.call(this,r)}return _createClass(e)}(ShaderMaterial),VolumeMaterial=function(o){_inherits(e,o);var t=_createSuper$y(e);function e(n){var r;_classCallCheck(this,e);var a=new ShaderParams(n,volumeUniforms,vertexVolume,fragmentVolume);return a.transparent=!0,a.depthTest=!0,r=t.call(this,a),r.updateDefines(),r}return _createClass(e,[{key:"updateDefines",value:function(){this.defines={ISO_MODE:settings$1.now.modes.VD.isoMode,STEPS_COUNT:settings$1.now.modes.VD.polyComplexity[settings$1.now.resolution]*100},this.needsUpdate=!0}}]),e}(ShaderMaterial),VolumeMaterial$1={BackFacePosMaterial,BackFacePosMaterialFarPlane,FrontFacePosMaterial,VolumeMaterial};function _createSuper$x(o){var t=_isNativeReflectConstruct$x();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VolumeMesh=function(o){_inherits(e,o);var t=_createSuper$x(e);function e(){var n;_classCallCheck(this,e);var r=new BufferGeometry;n=t.call(this,r),_defineProperty(_assertThisInitialized(n),"volumeInfo",{}),n.clipPlane=new Plane;var a=new Vector3(.5,.5,.5);return n.size=a,n.cullFlag=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1],n.faces=[{indices:[],norm:new Vector3(0,0,-1)},{indices:[],norm:new Vector3(0,0,1)},{indices:[],norm:new Vector3(0,-1,0)},{indices:[],norm:new Vector3(0,1,0)},{indices:[],norm:new Vector3(-1,0,0)},{indices:[],norm:new Vector3(1,0,0)},{indices:[],norm:new Vector3(0,0,0)}],n.vertices=[new Vector3(-a.x,-a.y,-a.z),new Vector3(-a.x,a.y,-a.z),new Vector3(a.x,-a.y,-a.z),new Vector3(a.x,a.y,-a.z),new Vector3(-a.x,-a.y,a.z),new Vector3(-a.x,a.y,a.z),new Vector3(a.x,-a.y,a.z),new Vector3(a.x,a.y,a.z),new Vector3(0,0,0),new Vector3(0,0,0),new Vector3(0,0,0),new Vector3(0,0,0),new Vector3(0,0,0),new Vector3(0,0,0)],r.setAttribute("position",new BufferAttribute(new Float32Array(n.vertices.length*3),3)),n.name="VolumeMesh",n}return _createClass(e,[{key:"_updateVertices",value:function(){var r=e._corners,a=e._edges,s=e._edgeIntersections,l,c=this.clipPlane.normal,u=this.clipPlane.constant,f=this.vertices,p=this.size,g=[0,0,0,0,0,0,0,0],y=[1,1,1,1,1,1,1,1,1,1,1,1],E=new Vector3,h=null;function v(){if(c.x===0)return 0;var W=-(c.dot(E)+u)/c.x;return-p.x<=W&&W<=p.x?(h.set(W,E.y,E.z),W===p.x?2:W===-p.x?-2:1):0}function C(){if(c.y===0)return 0;var W=-(c.dot(E)+u)/c.y;return-p.y<=W&&W<=p.y?(h.set(E.x,W,E.z),W===p.y?2:W===-p.y?-2:1):0}function x(){if(c.z===0)return 0;var W=-(c.dot(E)+u)/c.z;return-p.z<=W&&W<=p.z?(h.set(E.x,E.y,W),W===p.z?2:W===-p.z?-2:1):0}for(var w=0;w<12;++w){var _=a[w];h=s[w],E.set(_[2],_[3],_[4]),E.multiply(p);var S=0;_[2]===0&&(S=v()),_[3]===0&&(S=C()),_[4]===0&&(S=x()),S===-2?g[_[0]]=1:S===2?g[_[1]]=1:S===0&&(y[w]=0)}var M={indices:[],norm:c.clone().negate()},T=8;for(l=0;l<8;++l)g[l]===1&&(f[T].set(r[l][0],r[l][1],r[l][2]).multiply(p),M.indices.push(T++),y[r[l][3]]=0,y[r[l][4]]=0,y[r[l][5]]=0);for(l=0;l<12;++l)y[l]===1&&(f[T].copy(s[l]),M.indices.push(T++));this.faces[6]=M;var R=new Vector3,P=new Vector3;for(this.clipPlane.coplanarPoint(P),l=0;l<f.length;++l)this.cullFlag[l]=!1,l<8?(R.subVectors(f[l],P),this.cullFlag[l]=c.dot(R)>=0):l<8+M.indices.length&&(this.cullFlag[l]=!0);var I=this.geometry.getAttribute("position"),B=0;for(l=0;l<f.length;++l)I.array[B++]=f[l].x,I.array[B++]=f[l].y,I.array[B++]=f[l].z;I.needsUpdate=!0}},{key:"_collectVertices",value:function(r,a){var s,l=this.vertices;for(r.indices=[],s=0;s<l.length;++s)this.cullFlag[s]&&a(l[s])&&r.indices.push(s)}},{key:"_sortIndices",value:function(r,a){var s,l,c=this.vertices,u=[],f=new Vector3;for(s=1;s<r.indices.length;++s)f.subVectors(c[r.indices[s]],c[r.indices[0]]),f.normalize(),f.cross(a),f.negate(),u[s]=r.norm.dot(f);for(s=1;s<r.indices.length-1;++s)for(l=s+1;l<r.indices.length;++l)if(u[l]<u[s]){var p=u[s];u[s]=u[l],u[l]=p,p=r.indices[s],r.indices[s]=r.indices[l],r.indices[l]=p}}},{key:"_updateIndices",value:function(){var r,a,s,l=this.vertices,c=this.size;this._collectVertices(this.faces[0],function(x){return x.z===-c.z}),this._collectVertices(this.faces[1],function(x){return x.z===c.z}),this._collectVertices(this.faces[2],function(x){return x.y===-c.y}),this._collectVertices(this.faces[3],function(x){return x.y===c.y}),this._collectVertices(this.faces[4],function(x){return x.x===-c.x}),this._collectVertices(this.faces[5],function(x){return x.x===c.x});var u=new Vector3,f=new Vector3,p=new Vector3;for(a=0;a<this.faces.length;++a)if(s=this.faces[a],s.indices.length!==0){for(u.set(0,0,0),r=0;r<s.indices.length;++r)u.add(l[s.indices[r]]);u.multiplyScalar(1/s.indices.length),f.subVectors(l[s.indices[0]],u),f.normalize();var g=[];for(r=0;r<s.indices.length;++r)p.subVectors(l[s.indices[r]],u),g[r]=p.dot(f);for(r=1;r<s.indices.length;++r)if(g[r]<g[0]){var y=g[0];g[0]=g[r],g[r]=y;var E=_slicedToArray(s.indices,1);y=E[0],s.indices[0]=s.indices[r],s.indices[r]=y}this._sortIndices(s,f)}var h=0;for(a=0;a<this.faces.length;++a)s=this.faces[a],s.indices.length>=3&&(h+=3*(s.indices.length-2));var v=0,C=new Uint16Array(h);for(a=0;a<this.faces.length;++a)for(s=this.faces[a],r=0;r<s.indices.length-2;++r)C[v]=s.indices[0],C[v+1]=s.indices[r+1],C[v+2]=s.indices[r+2],v+=3;this.geometry.setIndex(new BufferAttribute(C,1))}},{key:"setDataSource",value:function(r){var a=new VolumeMaterial$1.VolumeMaterial,s=r.getDimensions(),l=r.getTiledTextureStride(),c=r.buildTiledTexture(),u=r.getBox();a.uniforms.volumeDim.value.set(s[0],s[1],s[2]),a.uniforms.tileTex.value=c,a.uniforms.tileTexSize.value.set(c.image.width,c.image.height),a.uniforms.tileStride.value.set(l[0],l[1]),Object.assign(this.volumeInfo,r.getVolumeInfo());var f=this.volumeInfo;a.uniforms.delta.value.copy(f.delta),a.uniforms.boxAngles.value.set(f.obtuseAngle[0],f.obtuseAngle[1],f.obtuseAngle[2]),this.material=a,u.getSize(this.scale),u.getCenter(this.position)}},{key:"_updateIsoLevel",value:function(){var r=settings$1.now.modes.VD,a=r.kSigma,s=r.kSigmaMed,l=r.kSigmaMax,c=this.volumeInfo,u=c.dmean-c.dmin,f=c.dmax-c.dmin,p=function(y){return(u+y*c.sd)/f};this.material.uniforms._isoLevel0.value.set(p(a),p(s),p(l))}},{key:"rebuild",value:function(r){var a=e._nearClipPlaneOffset,s=e._pos,l=e._norm,c=e._norm4D,u=e._matrixWorldToLocal,f=e._clipPlane;this._updateIsoLevel(),r.getWorldDirection(l),r.getWorldPosition(s),s.addScaledVector(l,r.near+a),u.copy(this.matrixWorld).invert(),s.applyMatrix4(u),c.set(l.x,l.y,l.z,0),c.applyMatrix4(u),l.copy(c),l.normalize(),f.setFromNormalAndCoplanarPoint(l,s),this.clipPlane.equals(f)||(this.clipPlane=f.clone(),this._updateVertices(),this._updateIndices())}}]),e}(Mesh);_defineProperty(VolumeMesh,"_corners",[[-1,-1,-1,0,4,8],[1,-1,-1,0,5,9],[1,1,-1,1,5,10],[-1,1,-1,1,4,11],[-1,-1,1,2,6,8],[1,-1,1,2,7,9],[1,1,1,3,7,10],[-1,1,1,3,6,11]]);_defineProperty(VolumeMesh,"_edges",[[0,1,0,-1,-1],[2,3,0,1,-1],[4,5,0,-1,1],[6,7,0,1,1],[0,3,-1,0,-1],[1,2,1,0,-1],[4,7,-1,0,1],[5,6,1,0,1],[0,4,-1,-1,0],[1,5,1,-1,0],[2,6,-1,1,0],[3,7,1,1,0]]);_defineProperty(VolumeMesh,"_edgeIntersections",function(){for(var o=[],t=0;t<12;++t)o.push(new Vector3);return o}());_defineProperty(VolumeMesh,"_nearClipPlaneOffset",.2);_defineProperty(VolumeMesh,"_pos",new Vector3);_defineProperty(VolumeMesh,"_norm",new Vector3);_defineProperty(VolumeMesh,"_norm4D",new Vector4);_defineProperty(VolumeMesh,"_matrixWorldToLocal",new Matrix4);_defineProperty(VolumeMesh,"_clipPlane",new Plane);function _flattenArray(o){for(var t=o.length,e=new Float32Array(t*3),n=0;n<t;++n){var r=3*n,a=o[n];e[r]=a.x,e[r+1]=a.y,e[r+2]=a.z}return e}var VolumeBounds=function(){function o(t,e){_classCallCheck(this,o);var n=e.delta,r=e.obtuseAngle,a=new Vector3;t.getSize(a),a.multiplyScalar(.5);for(var s=this._getBaseVertices(n,r),l=new BufferGeometry,c=[],u=0;u<4;u++)c.push(s[u].clone().multiply(a)),c.push(s[(u+1)%4].clone().multiply(a));for(var f=new Vector3(2*a.x*(1-n.x-n.y),0,0),p=0;p<8;p++)c.push(c[p].clone().add(f));for(var g=0;g<4;g++)c.push(c[g*2].clone()),c.push(c[g*2+8].clone());var y=new Vector3;t.getCenter(y),c.forEach(function(h){return h.add(y)});var E=_flattenArray(c);l.setAttribute("position",new BufferAttribute(E,3)),this._lines=new LineSegments(l,new LineBasicMaterial({color:16777215})),this._lines.layers.set(gfxutils.LAYERS.VOLUME)}return _createClass(o,[{key:"_getBaseVertices",value:function(e,n){var r=o._projectionTable,a=function(c,u){var f=e[r[c][0]],p=-.5*(u-1)+u*n[r[c][1]];return p*f},s=[new Vector3(-1+2*(a("XZ",1)+a("XY",1)),-1+2*a("YZ",1),-1),new Vector3(-1+2*(a("XZ",-1)+a("XY",1)),-1+2*a("YZ",-1),1),new Vector3(-1+2*(a("XZ",-1)+a("XY",-1)),1-2*a("YZ",1),1),new Vector3(-1+2*(a("XZ",1)+a("XY",-1)),1-2*a("YZ",-1),-1)];return s}},{key:"getMesh",value:function(){return this._lines}}]),o}();_defineProperty(VolumeBounds,"_projectionTable",{XY:["x",2],XZ:["y",1],YZ:["z",0]});var VolumeFarPlane=function(){function o(t,e,n){_classCallCheck(this,o);var r=this._initPlaneGeo(e,n),a=new VolumeMaterial$1.BackFacePosMaterialFarPlane;this._plane=new meshes.Mesh(r,a),this._plane.frustumCulled=!1,this._plane.doubleSided=!0;var s=new Matrix4;this._plane._onBeforeRender=function(l,c,u,f,p,g){var y=this.material;if(!(!t||!y)){var E=new Vector4(0,0,-(u.far-.1),1);E.applyMatrix4(u.matrixWorld),this.matrix.identity(),this.matrix.makeTranslation(E.x,E.y,E.z),this.matrixWorld.copy(this.matrix),this.modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,this.matrixWorld),this.normalMatrix.getNormalMatrix(this.modelViewMatrix);var h=t.matrixWorld;s.copy(h).invert(),y.uniforms.aspectRatio.value=u.aspect,y.uniforms.farZ.value=u.far,y.uniforms.tanHalfFOV.value=Math.tan(MathUtils.DEG2RAD*.5*u.fov),y.uniforms.matWorld2Volume.value=s}},this._plane.layers.set(gfxutils.LAYERS.VOLUME_BFPLANE)}return _createClass(o,[{key:"_initPlaneGeo",value:function(e,n){var r=new BufferGeometry;e=e||1,n=n||1;var a=new Float32Array([-.5*e,.5*n,0,.5*e,.5*n,0,-.5*e,-.5*n,0,.5*e,-.5*n,0]);return r.setAttribute("position",new BufferAttribute(a,3)),r.setIndex([0,2,1,2,3,1]),r}},{key:"getMesh",value:function(){return this._plane}}]),o}();function _createSuper$w(o){var t=_isNativeReflectConstruct$w();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VolumeVisual=function(o){_inherits(e,o);var t=_createSuper$w(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._mesh=new VolumeMesh,a._mesh.setDataSource(r),a.add(a._mesh),a._frame=new VolumeBounds(a.getBoundaries().boundingBox,a._mesh.volumeInfo),a.add(a._frame.getMesh()),a.showFrame(settings$1.now.modes.VD.frame),a._farPlane=new VolumeFarPlane(a._mesh,2,2),a.add(a._farPlane.getMesh()),a}return _createClass(e,[{key:"getBoundaries",value:function(){var r=this._dataSource.getBox(),a=new Sphere;return r.getBoundingSphere(a),{boundingBox:r,boundingSphere:a}}},{key:"getMesh",value:function(){return this._mesh}},{key:"showFrame",value:function(r){this._frame.getMesh().material.visible=r}}]),e}(Visual);function _createSuper$v(o){var t=_isNativeReflectConstruct$v();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LoaderList=function(o){_inherits(e,o);var t=_createSuper$v(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return _classCallCheck(this,e),t.call(this,n,["types"])}return _createClass(e,[{key:"find",value:function(r){var a=[];if(r.type)a=this._dict.types[r.type.toLowerCase()]||[];else if(r.source)return this._list.filter(function(s){return s.canProbablyLoad&&s.canProbablyLoad(r.source)});return _toConsumableArray(a)}}]),e}(EntityList);function _createSuper$u(o){var t=_isNativeReflectConstruct$u();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Loader=function(o){_inherits(e,o);var t=_createSuper$u(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this),a._source=n,a._options=r||{},a._abort=!1,a._agent=null,a}return _createClass(e,[{key:"load",value:function(){return Promise.reject(new Error("Loading from this source is not implemented"))}},{key:"abort",value:function(){this._abort=!0,this._agent&&this._agent.abort()}}],[{key:"extractName",value:function(r){}}]),e}(EventDispatcher);makeContextDependent(Loader.prototype);function _createSuper$t(o){var t=_isNativeReflectConstruct$t();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$t(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FileLoader=function(o){_inherits(e,o);var t=_createSuper$t(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),r=a._options,a._binary=r.binary===!0,a}return _createClass(e,[{key:"load",value:function(){var r=this;return new Promise(function(a,s){if(r._abort)throw new Error("Loading aborted");var l=r._source,c=r._agent=new FileReader;c.addEventListener("load",function(){a(c.result)}),c.addEventListener("error",function(){s(c.error)}),c.addEventListener("abort",function(){s(new Error("Loading aborted"))}),c.addEventListener("progress",function(u){r.dispatchEvent(u)}),r._binary?c.readAsArrayBuffer(l):c.readAsText(l)})}}],[{key:"canProbablyLoad",value:function(r){return File&&r instanceof File||Blob&&r instanceof Blob}},{key:"extractName",value:function(r){return r&&r.name}}]),e}(Loader);FileLoader.types=["file","blob"];function _createSuper$s(o){var t=_isNativeReflectConstruct$s();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$s(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var urlStartRegexp=/^(https?|ftp):\/\//i,XHRLoader=function(o){_inherits(e,o);var t=_createSuper$s(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),r=a._options,a._binary=r.binary===!0,a}return _createClass(e,[{key:"load",value:function(){var r=this;return new Promise(function(a,s){if(r._abort)throw new Error("Loading aborted");var l=r._source,c=r._agent=new XMLHttpRequest;c.addEventListener("load",function(){c.status===200?a(c.response):s(new Error("HTTP ".concat(c.status," while fetching ").concat(l)))}),c.addEventListener("error",function(){s(new Error("HTTP request failed"))}),c.addEventListener("abort",function(){s(new Error("Loading aborted"))}),c.addEventListener("progress",function(u){r.dispatchEvent(u)}),c.open("GET",l),r._binary?c.responseType="arraybuffer":c.responseType="text",c.send()})}}],[{key:"canProbablyLoad",value:function(r){return lodashExports.isString(r)&&urlStartRegexp.test(r)}},{key:"extractName",value:function(r){if(r){var a=(r.indexOf("?")+1||r.lastIndexOf("#")+1||r.length+1)-1;return r.slice(r.lastIndexOf("/",a)+1,a)}}}]),e}(Loader);XHRLoader.types=["url"];function _createSuper$r(o){var t=_isNativeReflectConstruct$r();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$r(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ImmediateLoader=function(o){_inherits(e,o);var t=_createSuper$r(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"load",value:function(){var r=this;return new Promise(function(a){if(r._abort)throw new Error("Loading aborted");a(r._source)})}}],[{key:"canProbablyLoad",value:function(r){return!1}}]),e}(Loader);ImmediateLoader.types=["immediate"];var loaders=new LoaderList([FileLoader,XHRLoader,ImmediateLoader]);function _createSuper$q(o){var t=_isNativeReflectConstruct$q();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ParserList=function(o){_inherits(e,o);var t=_createSuper$q(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return _classCallCheck(this,e),t.call(this,n,["formats","extensions"])}return _createClass(e,[{key:"find",value:function(r){var a=[];return r.format?a=this._dict.formats[r.format.toLowerCase()]||[]:r.ext&&(a=this._dict.extensions[r.ext.toLowerCase()]||[]),a.length===0&&!r.format&&r.data?this._list.filter(function(s){return s.canProbablyParse&&s.canProbablyParse(r.data)}):_toConsumableArray(a)}}]),e}(EntityList),Parser=function(){function o(t,e){_classCallCheck(this,o),this._data=t,this._options=e||{},this._abort=!1}return _createClass(o,[{key:"parseSync",value:function(){throw new Error("Parsing this type of data is not implemented")}},{key:"parse",value:function(){var e=this;return new Promise(function(n,r){setTimeout(function(){try{return e._abort?r(new Error("Parsing aborted")):n(e.parseSync())}catch(a){return r(a)}})})}},{key:"getModel",value:function(){return this.model._parseHeader(this._data),this.model}},{key:"abort",value:function(){this._abort=!0}}]),o}();makeContextDependent(Parser.prototype);var Remark290=function(){function o(){_classCallCheck(this,o),this.matrices=[],this._matrix=null,this._matrixIndex=-1}return _createClass(o,[{key:"parse",value:function(e){var n=this._matrix;if(e.readString(12,18)==="  SMTRY"){var r=e.readCharCode(19)-49,a=e.readString(20,80).trim().split(/\s+/),s=parseInt(a[0],10);(this._matrix===null||s!==this._matrixIndex)&&(this._matrixIndex=s,this._matrix=n=new Matrix4,this.matrices[this.matrices.length]=n);var l=n,c=l.elements;c[r]=parseFloat(a[1]),c[r+4]=parseFloat(a[2]),c[r+8]=parseFloat(a[3]),c[r+12]=parseFloat(a[4])}}}]),o}();Remark290.prototype.id=290;var Assembly$2=chem.Assembly,Remark350=function(){function o(t){_classCallCheck(this,o),this._complex=t,this.assemblies=[],this._assembly=null,this._matrix=null,this._matrixIndex=-1}return _createClass(o,[{key:"parse",value:function(e){var n=this._assembly,r=this._matrix;if(n&&e.readString(12,18)==="  BIOMT"){var a=e.readCharCode(19)-49,s=e.readString(20,80).trim().split(/\s+/),l=parseInt(s[0],10);(this._matrix===null||l!==this._matrixIndex)&&(this._matrixIndex=l,this._matrix=r=new Matrix4,n.addMatrix(r));var c=r,u=c.elements;u[a]=parseFloat(s[1]),u[a+4]=parseFloat(s[2]),u[a+8]=parseFloat(s[3]),u[a+12]=parseFloat(s[4])}else if(n&&e.readString(35,41)==="CHAINS:")for(var f=e.readString(42,80).split(","),p=0,g=f.length;p<g;++p){var y=f[p].trim();y.length>0&&n.addChain(y)}else e.readString(12,23)==="BIOMOLECULE:"&&(this._matrix=null,this._matrixIndex=-1,this._assembly=n=new Assembly$2(this._complex),this.assemblies.push(n))}}]),o}();Remark350.prototype.id=350;var PDBStream=function(){function o(t){_classCallCheck(this,o),this._data=t,this._start=0,this._nextCR=-1,this._nextLF=-1,this._next=-1,this._end=t.length,this.next()}return _createClass(o,[{key:"readLine",value:function(){return this._data.slice(this._start,this._next)}},{key:"readChar",value:function(e){return e=this._start+e-1,e<this._next?this._data[e]:" "}},{key:"readCharCode",value:function(e){return e=this._start+e-1,e<this._next?this._data.charCodeAt(e):32}},{key:"readString",value:function(e,n){var r=this._start+e-1,a=this._start+n;return this._data.slice(r,a<this._next?a:this._next)}},{key:"readInt",value:function(e,n){return parseInt(this.readString(e,n),10)}},{key:"readFloat",value:function(e,n){return parseFloat(this.readString(e,n))}},{key:"end",value:function(){return this._start>=this._end}},{key:"next",value:function(){var e=this._next+1;this._start=e<this._end?e:this._end,this._start>this._nextCR&&(this._nextCR=(this._data.indexOf("\r",this._start)+1||this._end+1)-1),this._start>this._nextLF&&(this._nextLF=(this._data.indexOf(`
`,this._start)+1||this._end+1)-1),this._next=this._nextCR+1<this._nextLF?this._nextCR:this._nextLF}}]),o}();function _createSuper$p(o){var t=_isNativeReflectConstruct$p();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$p(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$8=chem.Complex,Element$8=chem.Element,Helix$2=chem.Helix,Sheet$2=chem.Sheet,Strand$2=chem.Strand,Bond$4=chem.Bond,Molecule$7=chem.Molecule,TAG_LENGTH=6;function nameToElement$1(o){var t=o.trim().length===4;return o.slice(0,t?1:2).trim()}var pdbStartRegexp=/^(HEADER\s|COMPND\s|REMARK\s|ATOM {2}|HETATM|MODEL )/i,remarkParsers={290:Remark290,350:Remark350},PDBParser=function(o){_inherits(e,o);var t=_createSuper$p(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._complex=null,a._chain=null,a._residue=null,a._sheet=null,a._serialAtomMap=null,a._modelId=1,a._compaundFound=!1,a._biomoleculeFound=!1,a._allowedChainsIDs=null,a._lastMolId=-1,a._remarks={},a._remark=null,a._molecules=[],a._molecule=null,a._compndCurrToken="",a._options.fileType="pdb",a}return _createClass(e,[{key:"_finalize",value:function(){this._fixBondsArray(),this._fixChains();var r=this._remarks[290];this._complex.symmetry=lodashExports.isUndefined(r)?[]:r.matrices;var a=this._remarks[350];this._complex.units=this._complex.units.concat(lodashExports.isUndefined(a)?[]:a.assemblies),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_finalizeMolecules",value:function(){var r={},a,s=this._complex._chains;for(a=0;a<s.length;++a){var l=s[a],c=l._name;r[c]=l}for(a=0;a<this._molecules.length;a++){for(var u=this._molecules[a],f=[],p=0;p<u._chains.length;p++){var g=u._chains[p],y=r[g];f=f.concat(y._residues.slice())}var E=new Molecule$7(this._complex,u._name,a+1);E.residues=f,this._complex._molecules[a]=E}}},{key:"_fixChains",value:function(){for(var r={},a=this._complex,s=0;s<a._chains.length;s++){var l=a._chains[s];r[l._name.charCodeAt(0)]=l}}},{key:"_fixBondsArray",value:function(){for(var r=this._serialAtomMap={},a=this._complex,s=a._atoms,l=0,c=s.length;l<c;++l){var u=s[l];r[u.serial]=u}for(var f=a._bonds,p=this.logger,g=0,y=f.length;g<y;++g){var E=f[g];E._right<E._left&&p.debug("_fixBondsArray: Logic error."),E._left=r[E._left]||null,E._right=r[E._right]||null}}},{key:"_parseATOM",value:function(r){if(this._modelId===1){var a=r.readCharCode(1)===72,s=a?r.readInt(7,11):r.readInt(6,11),l=r.readString(13,16),c=r.readChar(17),u=r.readString(18,20).trim(),f=r.readChar(22),p=r.readInt(23,26),g=r.readChar(27),y=r.readFloat(31,38),E=r.readFloat(39,46),h=r.readFloat(47,54),v=r.readFloat(55,60),C=r.readFloat(61,66),x=r.readString(77,78).trim()||nameToElement$1(l),w=r.readInt(79,80)||0;if(!(this.settings.now.nowater&&(u==="HOH"||u==="WAT"))){l=l.trim();var _=Element$8.getByName(x),S=Element$8.Role[l],M=this._chain;(!M||M.getName()!==f)&&(this._chain=M=this._complex.getChain(f)||this._complex.addChain(f),this._residue=null);var T=this._residue;(!T||T.getSequence()!==p||T.getICode()!==g)&&(this._residue=T=M.addResidue(u,p,g));var R=new Vector3(y,E,h);T.addAtom(l,_,R,S,a,s,c,v,C,w)}}}},{key:"_parseENDMDL",value:function(){this._modelId+=1}},{key:"_parseCONECT",value:function(r){var a=r.readInt(7,11),s=r.readInt(12,16),l=r.readInt(17,21),c=r.readInt(22,26),u=r.readInt(27,31),f=this._complex;s&&s>a&&f.addBond(a,s,0,Bond$4.BondType.UNKNOWN,!0),l&&l>a&&f.addBond(a,l,0,Bond$4.BondType.UNKNOWN,!0),c&&c>a&&f.addBond(a,c,0,Bond$4.BondType.UNKNOWN,!0),u&&u>a&&f.addBond(a,u,0,Bond$4.BondType.UNKNOWN,!0)}},{key:"_parseCOMPND",value:function(r){var a=r.readString(11,80),s=a.indexOf(":");if(this._compndCurrToken=s>0?a.substring(0,s).trim():this._compndCurrToken,this._compndCurrToken==="MOL_ID")this._molecule={_index:"",_chains:[]},this._molecule._index=parseInt(a.substring(s+1,a.indexOf(";")),10),this._molecules.push(this._molecule);else if(this._compndCurrToken==="MOLECULE"&&this._molecule!=null)this._molecule._name=a.substring(s+1,a.indexOf(";")).trim();else if(this._compndCurrToken==="CHAIN"&&this._molecule!=null){var l=a.substring(s+1,80).trim(),c=l[l.length-1];(c===";"||c===",")&&(l=l.slice(0,-1)),l=l.replace(/\s+/g,"");var u=l.split(",");this._molecule._chains=this._molecule._chains.concat(u)}}},{key:"_parseREMARK",value:function(r){var a=r.readInt(8,10),s=this._remarks[a];if(lodashExports.isUndefined(s)){var l=remarkParsers[a];typeof l=="function"&&(this._remarks[a]=s=new l(this._complex))}lodashExports.isUndefined(s)||s.parse(r)}},{key:"_parseHELIX",value:function(r){var a=this,s=[20,22,32,34];this._parseSTRUCTURE(r,s,function(l){a._complex.addHelix(l),a._complex.structures.push(l)})}},{key:"_parseSHEET",value:function(r){var a=this,s=[22,23,33,34];this._parseSTRUCTURE(r,s,function(l){a._complex.addSheet(l)})}},{key:"_parseSTRUCTURE",value:function(r,a,s){var l=0,c=1,u=2,f=3,p=83,g=r.readInt(8,10),y=r.readString(12,14).trim(),E=r.readString(41,70).trim(),h=r.readInt(72,76),v=r.readInt(39,40),C=r.readInt(15,16),x=r.readInt(42,45),w=r.readInt(57,60),_=r.readString(a[l],a[u]+1).charCodeAt(0),S=r.readString(a[u],a[u]+1).charCodeAt(0),M=r.readInt(a[c],a[c]+3),T=r.readString(a[c]+4,a[c]+4),R=0;T.length>0&&(R=T.charCodeAt(0));var P=r.readInt(a[f],a[f]+3);T=r.readString(a[f]+4,a[f]+4);var I=0;T.length>0&&(I=T.charCodeAt(0));var B,W=this._sheet;if(r.readCharCode(1)===p){W!==null&&W.getName()!==y&&(W=null,this._sheet=null),W===null?(this._sheet=B=new Sheet$2(y,C),s(B)):B=W;var D=new Strand$2(B,this._complex.getUnifiedSerial(_,M,R),this._complex.getUnifiedSerial(S,P,I),v,x,w);B.addStrand(D),this._complex.structures.push(D)}else B=new Helix$2(v,this._complex.getUnifiedSerial(_,M,R),this._complex.getUnifiedSerial(S,P,I),g,y,E,h),s(B)}},{key:"_parseHEADER",value:function(r){var a=this._complex.metadata;a.classification=r.readString(11,50).trim(),a.date=r.readString(51,59).trim();var s=r.readString(63,66).trim();a.id=s,s&&(this._complex.name=s),a.format="pdb"}},{key:"_parseTITLE",value:function(r){var a=this._complex.metadata;a.title=a.title||[];var s=r.readInt(9,10)||1;a.title[s-1]=r.readString(11,80).trim()}},{key:"parseSync",value:function(){for(var r=new PDBStream(this._data),a=this._complex=new Complex$8;!r.end();){var s=r.readString(1,TAG_LENGTH),l=e.tagParsers[s];typeof l=="function"&&l.call(this,r),r.next()}if(this._finalize(),this._serialAtomMap=null,this._sheet=null,this._residue=null,this._chain=null,this._complex=null,a.getAtomCount()===0)throw new Error("The data does not contain valid atoms");return a}}],[{key:"canProbablyParse",value:function(r){return lodashExports.isString(r)&&pdbStartRegexp.test(r)}}]),e}(Parser);_defineProperty(PDBParser,"tagParsers",{HEADER:PDBParser.prototype._parseHEADER,"TITLE ":PDBParser.prototype._parseTITLE,"ATOM  ":PDBParser.prototype._parseATOM,HETATM:PDBParser.prototype._parseATOM,ENDMDL:PDBParser.prototype._parseENDMDL,CONECT:PDBParser.prototype._parseCONECT,COMPND:PDBParser.prototype._parseCOMPND,REMARK:PDBParser.prototype._parseREMARK,"HELIX ":PDBParser.prototype._parseHELIX,"SHEET ":PDBParser.prototype._parseSHEET,"ATOM 1":PDBParser.prototype._parseATOM,"ATOM 2":PDBParser.prototype._parseATOM,"ATOM 3":PDBParser.prototype._parseATOM,"ATOM 4":PDBParser.prototype._parseATOM,"ATOM 5":PDBParser.prototype._parseATOM,"ATOM 6":PDBParser.prototype._parseATOM,"ATOM 7":PDBParser.prototype._parseATOM,"ATOM 8":PDBParser.prototype._parseATOM,"ATOM 9":PDBParser.prototype._parseATOM});PDBParser.formats=["pdb"];PDBParser.extensions=[".pdb",".ent"];function _createSuper$o(o){var t=_isNativeReflectConstruct$o();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$7=chem.Complex,Element$7=chem.Element,SGroup=chem.SGroup,Bond$3=chem.Bond,cOrderCharCodes={A:0,S:1,D:2,T:3},cmlStartRegexp=/\s*<\?xml\b[^?>]*\?>\s*<(?:cml|molecule)\b/i,CMLParser=function(o){_inherits(e,o);var t=_createSuper$o(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._complex=null,a._residue=null,a._serialAtomMap=null,a._modelId=1,a._lastMolId=-1,a._readOnlyOneMolecule=!1,a._options.fileType="cml",a}return _createClass(e,[{key:"_rebuidBondIndexes",value:function(r,a){for(var s=r.length,l=0;l<s;l++)for(var c=r[l].id,u=a.length,f=0;f<u;f++){var p=a[f].atomRefs2.split(" ");p[0]===c&&(a[f].start=l),p[1]===c&&(a[f].end=l)}}},{key:"_createSGroup",value:function(r,a){var s=new SGroup(r.id,r.fieldData,new Vector3(parseFloat(r.x),parseFloat(r.y),0),r.atomRefs,r);r.placement==="Relative"&&(s._center=new Vector3(0,0,0)),r.fieldName==="MDLBG_FRAGMENT_CHARGE"&&(s._charge=parseInt(r.fieldData,10)||0),r.fieldName==="MDLBG_FRAGMENT_COEFFICIENT"&&(s._repeat=parseInt(r.fieldData,10)||1),a.push(s)}},{key:"_extractSGroup",value:function(r,a){if(Array.isArray(a)||(a=[]),r)if(Array.isArray(r))for(var s=r.length,l=0;l<s;l++)r[l].molecule&&(a=a.concat(this._extractSGroup(r[l].molecule))),this._createSGroup(r[l],a);else r.molecule&&r.molecule&&(a=a.concat(this._extractSGroup(r.molecule))),this._createSGroup(r,a);return a}},{key:"_extractSGroups",value:function(r,a){var s=this._extractSGroup(r),l=a.length,c,u;for(c=0;c<l;c++){var f=a[c].id;for(u=0;u<s.length;u++){var p=s[u]._atoms.split(" ")[0];p===f&&(a[c].sgroupRef||(a[c].sgroupRef=[]),a[c].sgroupRef.push(s[u]))}}var g={},y=null,E=1e8,h=new Vector3(E,E,E),v=new Vector3(-E,-E,-E);function C(_){y=g[_],y&&s[u]._atoms.push(y.a)}function x(_){y=g[_],y&&(h.set(Math.min(h.x,y.x),Math.min(h.y,y.y),Math.min(h.z,y.z)),v.set(Math.max(v.x,y.x),Math.max(v.y,y.y),Math.max(v.z,y.z)),C(_))}for(c=0;c<a.length;c++)g[a[c].id]={},g[a[c].id].x=a[c].x2,a[c].x3&&(g[a[c].id].x=a[c].x3),g[a[c].id].x=parseFloat(g[a[c].id].x),g[a[c].id].y=a[c].y2,a[c].y3&&(g[a[c].id].y=a[c].y3),g[a[c].id].y=parseFloat(g[a[c].id].y),g[a[c].id].z="0.0",a[c].z3&&(g[a[c].id].z=a[c].z3),g[a[c].id].z=parseFloat(g[a[c].id].z),g[a[c].id].a=a[c];var w;for(u=0;u<s.length;u++)s[u]._center!==null?(h.set(E,E,E),v.set(-E,-E,-E),w=s[u]._atoms.split(" "),s[u]._atoms=[],w.forEach(x),s[u]._center.addVectors(h,v),s[u]._center.multiplyScalar(.5)):(w=s[u]._atoms.split(" "),s[u]._atoms=[],w.forEach(C));g=null}},{key:"_traverseData",value:function(r){function a(c){return Object.prototype.toString.apply(c)==="[object Array]"}function s(c,u){if(!(c.nodeName==="#text"&&c.nodeValue.trim()==="")){var f={};f.xmlNode=c;var p=u[c.nodeName];p?a(p)?u[c.nodeName].push(f):u[c.nodeName]=[p,f]:u[c.nodeName]=f;var g,y;if(c.attributes)for(g=c.attributes.length,y=0;y<g;y++){var E=c.attributes[y];f[E.nodeName]=E.nodeValue}for(g=c.childNodes.length,y=0;y<g;y++)s(c.childNodes[y],f)}}var l={};return r.childNodes.length&&s(r.childNodes[0],l),l}},{key:"_findSuitableMolecule",value:function(r,a){for(var s in r)if(s!=="xmlNode")if(s==="molecule"){if(r.molecule&&(r.molecule.atomArray&&r.molecule.atomArray.atom&&a.push(r),Array.isArray(r.molecule)))for(var l=0;l<r.molecule.length;l++)r.molecule[l].atomArray&&r.molecule[l].atomArray.atom&&a.push({molecule:r.molecule[l]})}else r[s]&&r[s]!==null&&_typeof(r[s])==="object"&&this._findSuitableMolecule(r[s],a)}},{key:"_selectComponents",value:function(r){var a=new DOMParser,s=a.parseFromString(r,"application/xml"),l=this._traverseData(s),c,u=this;function f(y){var E=[];if(y.molecule&&y.molecule.atomArray&&y.molecule.atomArray.atom)Array.isArray(y.molecule.atomArray.atom)?E=y.molecule.atomArray.atom:E.push(y.molecule.atomArray.atom);else if(!y.molecule){var h={};return h.atomLabels=null,h.labelsCount=1,h}y.molecule.molecule&&u._extractSGroups(y.molecule.molecule,E);for(var v,C=E.length,x=0;x<C;x++)v=E[x],v.edges=[];var w=[];y.molecule.bondArray&&y.molecule.bondArray.bond&&(Array.isArray(y.molecule.bondArray.bond)?w=y.molecule.bondArray.bond:w.push(y.molecule.bondArray.bond));var _;C=w.length,u._rebuidBondIndexes(E,w);function S(D){return _=w[D],v=E[_.start],!v||(v.edges.push(_.end),v=E[_.end],!v)?!1:(v.edges.push(_.start),!0)}for(var M=0;M<C;M++)if(S(M)){var T=_.xmlNode.getAttribute("order"),R=parseInt(T,10);if(w[M].order=0,w[M].type=Bond$3.BondType.UNKNOWN,R>1)w[M].order=R;else{var P=cOrderCharCodes[T];P!==void 0&&(w[M].order=P,T==="A"&&(w[M].type=Bond$3.BondType.AROMATIC))}}C=E.length;for(var I=0;I<C;I++)v=E[I],v.edges.sort();var B=u._breadWidthSearch(E,0),W={};return W.atoms=E,W.bonds=w,W.labels=B.atomLabels,W.count=Math.min(1,B.labelsCount),W.curr=-1,W.originalCML=s,W}l.cml?c=l.cml:c=l;var p=[],g=[];return this._findSuitableMolecule(c,g),this._readOnlyOneMolecule&&g.length>1&&g.splice(1,g.length-1),g.forEach(function(y){var E=f(y);E.atoms.length>0&&p.push(E)}),p}},{key:"_packLabel",value:function(r,a){var s=16;return(a<<s)+r}},{key:"_unpackLabel",value:function(r){var a=16,s=(1<<a)-1;return{molId:r>>>a,compId:r&s}}},{key:"_breadWidthSearch",value:function(r,a){var s=new Array(r.length),l;for(l=0;l<s.length;l++)s[l]=this._packLabel(0,a);for(var c=[],u=0,f=r.length;f>0;){u++;var p=-1;for(l=0;l<s.length;l++)if(this._unpackLabel(s[l]).compId===0){p=l;break}if(p<0)break;for(c.push(r[p]),s[p]=this._packLabel(u,a),f--;c.length>0;){var g=c.shift();if(g)for(var y=0;y<g.edges.length;y++)s[g.edges[y]]!==u&&(c.push(r[g.edges[y]]),s[g.edges[y]]=u,f--)}}var E={};return E.atomLabels=s,E.labelsCount=u,E}},{key:"_parseBond",value:function(r,a,s,l){if(r>=0){var c=[Math.min(r,a),Math.max(r,a)];this._complex.addBond(c[0],c[1],s,l,!0)}}},{key:"_fixBondsArray",value:function(){for(var r=this._serialAtomMap={},a=this._complex,s=a._atoms,l=0,c=s.length;l<c;++l){var u=s[l];r[u.serial]=u}for(var f=a._bonds,p=this.logger,g=0,y=f.length;g<y;++g){var E=f[g];E._right<E._left&&p.debug("_fixBondsArray: Logic error."),E._left=r[E._left]||null,E._right=r[E._right]||null}}},{key:"_parseSet",value:function(r){var a=this._complex=new Complex$7,s=r,l=s.curr,c=s.atoms,u=s.labels,f=null,p,g,y=c.length;function E(K){K.xmlNodeRef=f,f.x2&&(f.x3=f.x2,delete f.x2),f.y2&&(f.y3=f.y2,delete f.y2),f.z3||(f.z3="0.0"),f.complexAtom=K}var h={},v=[];for(p=0;p<y;p++)v.push(p);for(v.sort(function(K,j){return u[K]-u[j]}),p=0;p<y;p++){var C=0,x=u[v[p]];if(this._unpackLabel(x).molId===this._unpackLabel(l).molId){f=c[v[p]];var w=f.elementType;if(f.sgroupRef)for(var _=f.sgroupRef.length,S=0;S<_;++S)a._sgroups.push(f.sgroupRef[S]);if(f.x3||f.x2){var M=this._unpackLabel(x).compId,T=" ",R=M,P=" ",I=M.toString();I.length===1&&(I="0".concat(I));var B="N".concat(I),W=h[T];(!W||W.getName()!==T)&&(h[T]=W=this._complex.getChain(T)||this._complex.addChain(T),this._residue=null);var D=this._residue;(!D||D.getSequence()!==R||D.getICode()!==P)&&(this._residue=D=W.addResidue(B,R,P));var O=null;f.x3?O=new Vector3(parseFloat(f.x3),parseFloat(f.y3),parseFloat(f.z3)):f.x2&&(O=new Vector3(parseFloat(f.x2),parseFloat(f.y2),0));var z=Element$7.ByName[f.elementType.toUpperCase()];z||(z=JSON.parse(JSON.stringify(Element$7.ByName[Object.keys(Element$7.ByName)[Object.keys(Element$7.ByName).length-1]])),z.number+=1,z.name=f.elementType.toUpperCase(),z.fullName="Unknown",Element$7.ByName[f.elementType.toUpperCase()]=z);var G=parseInt(f.id.replace(/[^0-9]/,""),10),k=D.addAtom(w,z,O,Element$7.Role.SG,!0,G," ",1,0,C);f.hydrogenCount&&(k.hydrogenCount=parseInt(f.hydrogenCount,10)),f.mrvValence&&(k.valence=parseInt(f.mrvValence,10)),E(k)}}}for(h=null,p=0;p<s.bonds.length;p++){var $=s.bonds[p];if(this._unpackLabel(u[$.start]).molId===this._unpackLabel(l).molId&&this._unpackLabel(u[$.end]).molId===this._unpackLabel(l).molId){if(f=c[$.start],!f||!c[$.end])continue;this._parseBond(parseInt(f.id.replace(/[^0-9]/,""),10),parseInt(c[$.end].id.replace(/[^0-9]/,""),10),$.order,$.type)}}for(p=0;p<this._complex.getSGroupCount();p++){var Z=this._complex.getSGroups()[p];for(g=0;g<Z._atoms.length;g++)Z._atoms[g]=Z._atoms[g].complexAtom}for(p=0;p<y;p++)this._unpackLabel(u[p]).molId===this._unpackLabel(l).molId&&(f=c[p],f.complexAtom=null,delete f.complexAtom);return this._complex.originalCML=s.originalCML,this._fixBondsArray(),a.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._serialAtomMap=null,this._complex=null,a}},{key:"parseSync",value:function(){var r=[],a=this,s=this._selectComponents(this._data);s.forEach(function(u){u.curr=2,u.count===0&&(u.count=1);for(var f=0;f<u.count;f++)u.curr=f+1,r.push(a._parseSet(u,!1))});var l=0;if(r.forEach(function(u){l+=u.getAtomCount()}),l<=0)throw new Error("The data does not contain valid atoms");if(r.length>1){var c=new Complex$7;return c.joinComplexes(r),c.originalCML=r[0].originalCML,c}return r.length===1?r[0]:new Complex$7}}],[{key:"canProbablyParse",value:function(r){return lodashExports.isString(r)&&cmlStartRegexp.test(r)}}]),e}(Parser);CMLParser.formats=["cml"];CMLParser.extensions=[".cml"];var mmtf={exports:{}};(function(o,t){(function(e,n){n(t)})(commonjsGlobal,function(e){function n(F,H,X){for(var oe=(F.byteLength,0),te=X.length;te>oe;oe++){var Me=X.charCodeAt(oe);if(128>Me)F.setUint8(H++,Me>>>0&127|0);else if(2048>Me)F.setUint8(H++,Me>>>6&31|192),F.setUint8(H++,Me>>>0&63|128);else if(65536>Me)F.setUint8(H++,Me>>>12&15|224),F.setUint8(H++,Me>>>6&63|128),F.setUint8(H++,Me>>>0&63|128);else{if(!(1114112>Me))throw new Error("bad codepoint "+Me);F.setUint8(H++,Me>>>18&7|240),F.setUint8(H++,Me>>>12&63|128),F.setUint8(H++,Me>>>6&63|128),F.setUint8(H++,Me>>>0&63|128)}}}function r(F){for(var H=0,X=0,oe=F.length;oe>X;X++){var te=F.charCodeAt(X);if(128>te)H+=1;else if(2048>te)H+=2;else if(65536>te)H+=3;else{if(!(1114112>te))throw new Error("bad codepoint "+te);H+=4}}return H}function a(F,H,X){var oe=_typeof(F);if(oe==="string"){var te=r(F);if(32>te)return H.setUint8(X,160|te),n(H,X+1,F),1+te;if(256>te)return H.setUint8(X,217),H.setUint8(X+1,te),n(H,X+2,F),2+te;if(65536>te)return H.setUint8(X,218),H.setUint16(X+1,te),n(H,X+3,F),3+te;if(4294967296>te)return H.setUint8(X,219),H.setUint32(X+1,te),n(H,X+5,F),5+te}if(F instanceof Uint8Array){var te=F.byteLength,Me=new Uint8Array(H.buffer);if(256>te)return H.setUint8(X,196),H.setUint8(X+1,te),Me.set(F,X+2),2+te;if(65536>te)return H.setUint8(X,197),H.setUint16(X+1,te),Me.set(F,X+3),3+te;if(4294967296>te)return H.setUint8(X,198),H.setUint32(X+1,te),Me.set(F,X+5),5+te}if(oe==="number"){if(!isFinite(F))throw new Error("Number not finite: "+F);if(Math.floor(F)!==F)return H.setUint8(X,203),H.setFloat64(X+1,F),9;if(F>=0){if(128>F)return H.setUint8(X,F),1;if(256>F)return H.setUint8(X,204),H.setUint8(X+1,F),2;if(65536>F)return H.setUint8(X,205),H.setUint16(X+1,F),3;if(4294967296>F)return H.setUint8(X,206),H.setUint32(X+1,F),5;throw new Error("Number too big 0x"+F.toString(16))}if(F>=-32)return H.setInt8(X,F),1;if(F>=-128)return H.setUint8(X,208),H.setInt8(X+1,F),2;if(F>=-32768)return H.setUint8(X,209),H.setInt16(X+1,F),3;if(F>=-2147483648)return H.setUint8(X,210),H.setInt32(X+1,F),5;throw new Error("Number too small -0x"+(-F).toString(16).substr(1))}if(F===null)return H.setUint8(X,192),1;if(oe==="boolean")return H.setUint8(X,F?195:194),1;if(oe==="object"){var te,Ee=0,Te=Array.isArray(F);if(Te)te=F.length;else{var q=Object.keys(F);te=q.length}var Ee;if(16>te?(H.setUint8(X,te|(Te?144:128)),Ee=1):65536>te?(H.setUint8(X,Te?220:222),H.setUint16(X+1,te),Ee=3):4294967296>te&&(H.setUint8(X,Te?221:223),H.setUint32(X+1,te),Ee=5),Te)for(var Pe=0;te>Pe;Pe++)Ee+=a(F[Pe],H,X+Ee);else for(var Pe=0;te>Pe;Pe++){var tt=q[Pe];Ee+=a(tt,H,X+Ee),Ee+=a(F[tt],H,X+Ee)}return Ee}throw new Error("Unknown type "+oe)}function s(F){var H=_typeof(F);if(H==="string"){var X=r(F);if(32>X)return 1+X;if(256>X)return 2+X;if(65536>X)return 3+X;if(4294967296>X)return 5+X}if(F instanceof Uint8Array){var X=F.byteLength;if(256>X)return 2+X;if(65536>X)return 3+X;if(4294967296>X)return 5+X}if(H==="number"){if(Math.floor(F)!==F)return 9;if(F>=0){if(128>F)return 1;if(256>F)return 2;if(65536>F)return 3;if(4294967296>F)return 5;throw new Error("Number too big 0x"+F.toString(16))}if(F>=-32)return 1;if(F>=-128)return 2;if(F>=-32768)return 3;if(F>=-2147483648)return 5;throw new Error("Number too small -0x"+F.toString(16).substr(1))}if(H==="boolean"||F===null)return 1;if(H==="object"){var X,oe=0;if(Array.isArray(F)){X=F.length;for(var te=0;X>te;te++)oe+=s(F[te])}else{var Me=Object.keys(F);X=Me.length;for(var te=0;X>te;te++){var Te=Me[te];oe+=s(Te)+s(F[Te])}}if(16>X)return 1+oe;if(65536>X)return 3+oe;if(4294967296>X)return 5+oe;throw new Error("Array or object too long 0x"+X.toString(16))}throw new Error("Unknown type "+H)}function l(F){var H=new ArrayBuffer(s(F)),X=new DataView(H);return a(F,X,0),new Uint8Array(H)}function c(F,H,X){return H?new F(H.buffer,H.byteOffset,H.byteLength/(X||1)):void 0}function u(F){return c(DataView,F)}function f(F){return c(Uint8Array,F)}function p(F){return c(Int8Array,F)}function g(F){return c(Int32Array,F,4)}function y(F){return c(Float32Array,F,4)}function E(F,H){var X=F.length/2;H||(H=new Int16Array(X));for(var oe=0,te=0;X>oe;++oe,te+=2)H[oe]=F[te]<<8^F[te+1]<<0;return H}function h(F,H){var X=F.length;H||(H=new Uint8Array(2*X));for(var oe=u(H),te=0;X>te;++te)oe.setInt16(2*te,F[te]);return f(H)}function v(F,H){var X=F.length/4;H||(H=new Int32Array(X));for(var oe=0,te=0;X>oe;++oe,te+=4)H[oe]=F[te]<<24^F[te+1]<<16^F[te+2]<<8^F[te+3]<<0;return H}function C(F,H){var X=F.length;H||(H=new Uint8Array(4*X));for(var oe=u(H),te=0;X>te;++te)oe.setInt32(4*te,F[te]);return f(H)}function x(F,H){var X=F.length;H||(H=new Float32Array(X/4));for(var oe=u(H),te=u(F),Me=0,Te=0,q=X/4;q>Me;++Me,Te+=4)oe.setFloat32(Te,te.getFloat32(Te),!0);return H}function w(F,H,X){var oe=F.length,te=1/H;X||(X=new Float32Array(oe));for(var Me=0;oe>Me;++Me)X[Me]=F[Me]*te;return X}function _(F,H,X){var oe=F.length;X||(X=new Int32Array(oe));for(var te=0;oe>te;++te)X[te]=Math.round(F[te]*H);return X}function S(F,H){var X,oe;if(!H){var te=0;for(X=0,oe=F.length;oe>X;X+=2)te+=F[X+1];H=new F.constructor(te)}var Me=0;for(X=0,oe=F.length;oe>X;X+=2)for(var Te=F[X],q=F[X+1],Ee=0;q>Ee;++Ee)H[Me]=Te,++Me;return H}function M(F){if(F.length===0)return new Int32Array;var H,X,oe=2;for(H=1,X=F.length;X>H;++H)F[H-1]!==F[H]&&(oe+=2);var te=new Int32Array(oe),Me=0,Te=1;for(H=1,X=F.length;X>H;++H)F[H-1]!==F[H]?(te[Me]=F[H-1],te[Me+1]=Te,Te=1,Me+=2):++Te;return te[Me]=F[F.length-1],te[Me+1]=Te,te}function T(F,H){var X=F.length;H||(H=new F.constructor(X)),X&&(H[0]=F[0]);for(var oe=1;X>oe;++oe)H[oe]=F[oe]+H[oe-1];return H}function R(F,H){var X=F.length;H||(H=new F.constructor(X)),H[0]=F[0];for(var oe=1;X>oe;++oe)H[oe]=F[oe]-F[oe-1];return H}function P(F,H){var X,oe,te=F instanceof Int8Array?127:32767,Me=-te-1,Te=F.length;if(!H){var q=0;for(X=0;Te>X;++X)F[X]<te&&F[X]>Me&&++q;H=new Int32Array(q)}for(X=0,oe=0;Te>X;){for(var Ee=0;F[X]===te||F[X]===Me;)Ee+=F[X],++X;Ee+=F[X],++X,H[oe]=Ee,++oe}return H}function I(F,H){var X,oe=H?127:32767,te=-oe-1,Me=F.length,Te=0;for(X=0;Me>X;++X){var q=F[X];q===0?++Te:Te+=q===oe||q===te?2:q>0?Math.ceil(q/oe):Math.ceil(q/te)}var Ee=H?new Int8Array(Te):new Int16Array(Te),Pe=0;for(X=0;Me>X;++X){var q=F[X];if(q>=0)for(;q>=oe;)Ee[Pe]=oe,++Pe,q-=oe;else for(;te>=q;)Ee[Pe]=te,++Pe,q-=te;Ee[Pe]=q,++Pe}return Ee}function B(F,H){return T(S(F),H)}function W(F){return M(R(F))}function D(F,H,X){return w(S(F,g(X)),H,X)}function O(F,H){return M(_(F,H))}function z(F,H,X){return w(T(F,g(X)),H,X)}function G(F,H,X){return R(_(F,H),X)}function k(F,H,X){return w(P(F,g(X)),H,X)}function $(F,H,X){var oe=P(F,g(X));return z(oe,H,y(oe))}function Z(F,H,X){return I(G(F,H),X)}function K(Me){var H=u(Me),X=H.getInt32(0),oe=H.getInt32(4),te=Me.subarray(8,12),Me=Me.subarray(12);return[X,Me,oe,te]}function j(F,H,X,oe){var te=new ArrayBuffer(12+oe.byteLength),Me=new Uint8Array(te),Te=new DataView(te);return Te.setInt32(0,F),Te.setInt32(4,H),X&&Me.set(X,8),Me.set(oe,12),Me}function Q(F){var H=F.length,X=f(F);return j(2,H,void 0,X)}function le(F){var H=F.length,X=C(F);return j(4,H,void 0,X)}function he(F,H){var X=F.length/H,oe=C([H]),te=f(F);return j(5,X,oe,te)}function ve(F){var H=F.length,X=C(M(F));return j(6,H,void 0,X)}function re(F){var H=F.length,X=C(W(F));return j(8,H,void 0,X)}function Ie(F,H){var X=F.length,oe=C([H]),te=C(O(F,H));return j(9,X,oe,te)}function ge(F,H){var X=F.length,oe=C([H]),te=h(Z(F,H));return j(10,X,oe,te)}function Se(F){var H={};return De.forEach(function(X){F[X]!==void 0&&(H[X]=F[X])}),F.bondAtomList&&(H.bondAtomList=le(F.bondAtomList)),F.bondOrderList&&(H.bondOrderList=Q(F.bondOrderList)),H.xCoordList=ge(F.xCoordList,1e3),H.yCoordList=ge(F.yCoordList,1e3),H.zCoordList=ge(F.zCoordList,1e3),F.bFactorList&&(H.bFactorList=ge(F.bFactorList,100)),F.atomIdList&&(H.atomIdList=re(F.atomIdList)),F.altLocList&&(H.altLocList=ve(F.altLocList)),F.occupancyList&&(H.occupancyList=Ie(F.occupancyList,100)),H.groupIdList=re(F.groupIdList),H.groupTypeList=le(F.groupTypeList),F.secStructList&&(H.secStructList=Q(F.secStructList)),F.insCodeList&&(H.insCodeList=ve(F.insCodeList)),F.sequenceIndexList&&(H.sequenceIndexList=re(F.sequenceIndexList)),H.chainIdList=he(F.chainIdList,4),F.chainNameList&&(H.chainNameList=he(F.chainNameList,4)),H}function Le(F){function H(Ee){for(var Pe={},tt=0;Ee>tt;tt++){var Oe=Me();Pe[Oe]=Me()}return Pe}function X(Ee){var Pe=F.subarray(Te,Te+Ee);return Te+=Ee,Pe}function oe(Ee){var Pe=F.subarray(Te,Te+Ee);Te+=Ee;var tt=65535;if(Ee>tt){for(var Oe=[],Je=0;Je<Pe.length;Je+=tt)Oe.push(String.fromCharCode.apply(null,Pe.subarray(Je,Je+tt)));return Oe.join("")}return String.fromCharCode.apply(null,Pe)}function te(Ee){for(var Pe=new Array(Ee),tt=0;Ee>tt;tt++)Pe[tt]=Me();return Pe}function Me(){var Ee,Pe,tt=F[Te];if(!(128&tt))return Te++,tt;if((240&tt)===128)return Pe=15&tt,Te++,H(Pe);if((240&tt)===144)return Pe=15&tt,Te++,te(Pe);if((224&tt)===160)return Pe=31&tt,Te++,oe(Pe);if((224&tt)===224)return Ee=q.getInt8(Te),Te++,Ee;switch(tt){case 192:return Te++,null;case 194:return Te++,!1;case 195:return Te++,!0;case 196:return Pe=q.getUint8(Te+1),Te+=2,X(Pe);case 197:return Pe=q.getUint16(Te+1),Te+=3,X(Pe);case 198:return Pe=q.getUint32(Te+1),Te+=5,X(Pe);case 202:return Ee=q.getFloat32(Te+1),Te+=5,Ee;case 203:return Ee=q.getFloat64(Te+1),Te+=9,Ee;case 204:return Ee=F[Te+1],Te+=2,Ee;case 205:return Ee=q.getUint16(Te+1),Te+=3,Ee;case 206:return Ee=q.getUint32(Te+1),Te+=5,Ee;case 208:return Ee=q.getInt8(Te+1),Te+=2,Ee;case 209:return Ee=q.getInt16(Te+1),Te+=3,Ee;case 210:return Ee=q.getInt32(Te+1),Te+=5,Ee;case 217:return Pe=q.getUint8(Te+1),Te+=2,oe(Pe);case 218:return Pe=q.getUint16(Te+1),Te+=3,oe(Pe);case 219:return Pe=q.getUint32(Te+1),Te+=5,oe(Pe);case 220:return Pe=q.getUint16(Te+1),Te+=3,te(Pe);case 221:return Pe=q.getUint32(Te+1),Te+=5,te(Pe);case 222:return Pe=q.getUint16(Te+1),Te+=3,H(Pe);case 223:return Pe=q.getUint32(Te+1),Te+=5,H(Pe)}throw new Error("Unknown type 0x"+tt.toString(16))}var Te=0,q=new DataView(F.buffer);return Me()}function be(F,H,X,oe){switch(F){case 1:return x(H);case 2:return p(H);case 3:return E(H);case 4:return v(H);case 5:return f(H);case 6:return S(v(H),new Uint8Array(X));case 7:return S(v(H));case 8:return B(v(H));case 9:return D(v(H),v(oe)[0]);case 10:return $(E(H),v(oe)[0]);case 11:return w(E(H),v(oe)[0]);case 12:return k(E(H),v(oe)[0]);case 13:return k(p(H),v(oe)[0]);case 14:return P(E(H));case 15:return P(p(H))}}function ye(F,H){H=H||{};var X=H.ignoreFields,oe={};return ze.forEach(function(te){var Me=X?X.indexOf(te)!==-1:!1,Te=F[te];Me||Te===void 0||(Te instanceof Uint8Array?oe[te]=be.apply(null,K(Te)):oe[te]=Te)}),oe}function ce(F){return String.fromCharCode.apply(null,F).replace(/\0/g,"")}function ue(F,H,X){X=X||{};var oe,te,Me,Te,q,Ee,Pe=X.firstModelOnly,tt=H.onModel,Oe=H.onChain,Je=H.onGroup,ee=H.onAtom,Fe=H.onBond,it=0,U=0,ke=0,de=0,se=0,fe=-1,je=F.chainNameList,ht=F.secStructList,pt=F.insCodeList,dt=F.sequenceIndexList,At=F.atomIdList,_e=F.bFactorList,Xe=F.altLocList,Ue=F.occupancyList,Ye=F.bondAtomList,ot=F.bondOrderList;for(oe=0,te=F.chainsPerModel.length;te>oe&&!(Pe&&it>0);++oe){var gt=F.chainsPerModel[it];for(tt&&tt({chainCount:gt,modelIndex:it}),Me=0;gt>Me;++Me){var Et=F.groupsPerChain[U];if(Oe){var yt=ce(F.chainIdList.subarray(4*U,4*U+4)),mt=null;je&&(mt=ce(je.subarray(4*U,4*U+4))),Oe({groupCount:Et,chainIndex:U,modelIndex:it,chainId:yt,chainName:mt})}for(Te=0;Et>Te;++Te){var St=F.groupList[F.groupTypeList[ke]],vt=St.atomNameList.length;if(Je){var Rt=null;ht&&(Rt=ht[ke]);var xt=null;F.insCodeList&&(xt=String.fromCharCode(pt[ke]));var dr=null;dt&&(dr=dt[ke]),Je({atomCount:vt,groupIndex:ke,chainIndex:U,modelIndex:it,groupId:F.groupIdList[ke],groupType:F.groupTypeList[ke],groupName:St.groupName,singleLetterCode:St.singleLetterCode,chemCompType:St.chemCompType,secStruct:Rt,insCode:xt,sequenceIndex:dr})}for(q=0;vt>q;++q){if(ee){var $t=null;At&&($t=At[de]);var pr=null;_e&&(pr=_e[de]);var qt=null;Xe&&(qt=String.fromCharCode(Xe[de]));var Lr=null;Ue&&(Lr=Ue[de]),ee({atomIndex:de,groupIndex:ke,chainIndex:U,modelIndex:it,atomId:$t,element:St.elementList[q],atomName:St.atomNameList[q],formalCharge:St.formalChargeList[q],xCoord:F.xCoordList[de],yCoord:F.yCoordList[de],zCoord:F.zCoordList[de],bFactor:pr,altLoc:qt,occupancy:Lr})}de+=1}if(Fe){var yr=St.bondAtomList;for(q=0,Ee=St.bondOrderList.length;Ee>q;++q)Fe({atomIndex1:de-vt+yr[2*q],atomIndex2:de-vt+yr[2*q+1],bondOrder:St.bondOrderList[q]})}ke+=1}U+=1}if(se=fe+1,fe=de-1,Fe&&Ye)for(q=0,Ee=Ye.length;Ee>q;q+=2){var or=Ye[q],xr=Ye[q+1];(or>=se&&fe>=or||xr>=se&&fe>=xr)&&Fe({atomIndex1:or,atomIndex2:xr,bondOrder:ot?ot[q/2]:null})}it+=1}}function Ce(F){return l(Se(F))}function Ve(F,H){F instanceof ArrayBuffer&&(F=new Uint8Array(F));var X;return X=F instanceof Uint8Array?Le(F):F,ye(X,H)}function ie(F,H,X,oe){function te(){try{var Te=Ve(Me.response);X(Te)}catch(q){oe(q)}}var Me=new XMLHttpRequest;Me.addEventListener("load",te,!0),Me.addEventListener("error",oe,!0),Me.responseType="arraybuffer",Me.open("GET",H+F.toUpperCase()),Me.send()}function ae(F,H,X){ie(F,qe,H,X)}function Ae(F,H,X){ie(F,et,H,X)}var De=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Be=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],ze=De.concat(Be),We="v1.1.0dev",$e="//mmtf.rcsb.org/v1.0/",qe=$e+"full/",et=$e+"reduced/";e.encode=Ce,e.decode=Ve,e.traverse=ue,e.fetch=ae,e.fetchReduced=Ae,e.version=We,e.fetchUrl=qe,e.fetchReducedUrl=et,e.encodeMsgpack=l,e.encodeMmtf=Se,e.decodeMsgpack=Le,e.decodeMmtf=ye})})(mmtf,mmtf.exports);var MMTF=mmtf.exports;function _createSuper$n(o){var t=_isNativeReflectConstruct$n();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$n(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$6=chem.Complex,Chain$1=chem.Chain,Atom$1=chem.Atom,Element$6=chem.Element,Helix$1=chem.Helix,Sheet$1=chem.Sheet,Strand$1=chem.Strand,Bond$2=chem.Bond,Assembly$1=chem.Assembly,Molecule$6=chem.Molecule,ArrayComparator=function(){function o(t){_classCallCheck(this,o),this._original=Array.from(t),this._original.sort(),this._sum=0;for(var e=0;e<this._original.length;++e)this._sum+=this._original[e]}return _createClass(o,[{key:"compare",value:function(e){var n=e.length;if(n!==this._original.length)return!1;var r=0,a;for(a=0;a<n;++a)r+=e[a];if(r!==this._sum)return!1;var s=Array.from(e);for(s.sort(),a=0;a<n;++a)if(s[a]!==this._original[a])return!1;return!0}}]),o}();ArrayComparator.prototype.constructor=ArrayComparator;var StructuralElementType=StructuralElement.Type,secStructToType=[StructuralElementType.HELIX_PI,StructuralElementType.BEND,StructuralElementType.HELIX_ALPHA,StructuralElementType.STRAND,StructuralElementType.HELIX_310,StructuralElementType.BRIDGE,StructuralElementType.TURN,StructuralElementType.COIL];function getFirstByte(o){var t=new Uint8Array(o,0,1);return t[0]}var MMTFParser=function(o){_inherits(e,o);var t=_createSuper$n(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._options.fileType="mmtf",a}return _createClass(e,[{key:"_onModel",value:function(r){}},{key:"_onChain",value:function(r){if(r.modelIndex===0){var a=new Chain$1(this._complex,r.chainName);this._complex._chains[r.chainIndex]=a,a._index=r.chainIndex}}},{key:"_onGroup",value:function(r){if(r.modelIndex===0&&!(this.settings.now.nowater&&(r.groupName==="HOH"||r.groupName==="WAT"))){var a=this._complex._chains[r.chainIndex],s=r.insCode.charCodeAt(0)?r.insCode:"",l=a.addResidue(r.groupName,r.groupId,s);l._index=r.groupIndex,this._updateSecStructure(this._complex,l,r)}}},{key:"_onAtom",value:function(r){if(r.modelIndex===0){var a=r.altLoc.charCodeAt(0)?r.altLoc:"",s=new Atom$1(r.groupIndex,r.atomName,Element$6.getByName(r.element.toUpperCase()),new Vector3(r.xCoord,r.yCoord,r.zCoord),Element$6.Role[r.atomName],!1,r.atomId,a,r.occupancy,r.bFactor,r.formalCharge);this._complex._atoms[r.atomIndex]=s,s.index=r.atomIndex,this._serialAtomMap[r.atomId]=s}}},{key:"_onBond",value:function(r){var a=Math.max(r.atomIndex1,r.atomIndex2);if(!(a>=this._complex._atoms.length)){var s=Math.min(r.atomIndex1,r.atomIndex2);this._complex.addBond(this._complex._atoms[s],this._complex._atoms[a],r.bondOrder,Bond$2.BondType.UNKNOWN,!0)}}},{key:"_updateSecStructure",value:function(r,a,s){var l=[3,-1,1,-1,5];if(!lodashExports.isUndefined(s)&&s.secStruct===this._ssType){a._secondary=this._ssStruct,this._ssStruct&&(this._ssStruct.term=a);return}if(!lodashExports.isUndefined(s)){var c=secStructToType[s.secStruct];this._ssType=s.secStruct,this._ssStart=a;var u=null;switch(this._ssType){case-1:case 7:break;case 0:case 2:case 4:u=new Helix$1(l[this._ssType],a,a,0,"","",0),r._helices.push(u);break;case 3:{var f=new Sheet$1("",0);r._sheets.push(f),u=new Strand$1(f,a,a,0,null,null);break}default:c!==void 0&&(u=new StructuralElement(c,a,a));break}this._ssStruct=u,a._secondary=u,u&&r.structures.push(u)}}},{key:"_updateMolecules",value:function(r){var a=r.entityList;if(a)for(var s=r.chainsPerModel[0],l=0;l<a.length;l++){for(var c=a[l],u=c.chainIndexList,f=[],p=0;p<u.length;p++){var g=u[p];if(!(g>=s)){var y=this._complex._chains[g];f=f.concat(y._residues.slice())}}var E=new Molecule$6(this._complex,c.description,l+1);E.residues=f,this._complex._molecules[l]=E}}},{key:"_traverse",value:function(r){var a=this,s=this._complex.metadata;s.id=r.structureId,s.title=[],s.title[0]=r.title,s.date=r.releaseDate,s.format="mmtf";var l={onModel:function(u){a._onModel(u)},onChain:function(u){a._onChain(u)},onGroup:function(u){a._onGroup(u)},onAtom:function(u){a._onAtom(u)},onBond:function(u){a._onBond(u)}};this._ssType=-1,this._ssStruct=null,this._ssStart=null,MMTF.traverse(r,l),this._updateSecStructure(this._complex),this._updateMolecules(r)}},{key:"_linkAtomsToResidues",value:function(){for(var r=0;r<this._complex._atoms.length;++r){var a=this._complex._atoms[r],s=this._complex._residues[a.residue];a.residue=s,s._atoms.push(a)}}},{key:"_findSynonymousChains",value:function(){for(var r={},a=0;a<this._complex._chains.length;++a){var s=this._complex._chains[a],l=s.getName();r.hasOwnProperty(l)||(r[l]=[]),r[l].push(s._index)}return r}},{key:"_parseAssemblyInfo",value:function(r){var a,s,l,c=[],u=this.logger;for(a=0;a<r.bioAssemblyList.length;++a){var f=r.bioAssemblyList[a];if(f.transformList.length!==0){var p=f.transformList[0].chainIndexList,g=new ArrayComparator(p),y={};for(s=0;s<p.length;++s)y[this._complex._chains[p[s]].getName()]=1;var E=[],h=void 0;for(h in y)y.hasOwnProperty(h)&&Array.prototype.push.apply(E,this._chainsByName[h]);g.compare(E)||u.debug("MMTF: Assembly is missing some of the synonymous chains. Skipping...");var v=new Assembly$1(this._complex);for(h in y)y.hasOwnProperty(h)&&v.addChain(h);for(v.addMatrix(new Matrix4().fromArray(f.transformList[0].matrix).transpose()),s=1;s<f.transformList.length;++s){var C=f.transformList[s];if(!g.compare(C.chainIndexList)){u.debug("MMTF: Chain lists differ for different transforms in one assembly. Skipping...");continue}var x=new Matrix4().fromArray(C.matrix).transpose();for(l=0;l<v.matrices.length&&!v.matrices[l].equals(x);++l);l===v.matrices.length&&v.addMatrix(x)}v.finalize(),c.push(v)}}return c}},{key:"_markHeteroAtoms",value:function(r){for(var a=r.chainsPerModel[0],s=0;s<r.entityList.length;++s){var l=r.entityList[s];if(l.type!=="polymer")for(var c=0;c<l.chainIndexList.length;++c){var u=l.chainIndexList[c];if(!(u>=a))for(var f=this._complex._chains[u],p=0;p<f._residues.length;++p)for(var g=f._residues[p],y=0;y<g._atoms.length;++y)g._atoms[y].het=!0}}}},{key:"_joinSynonymousChains",value:function(){var r,a,s=[],l={};for(r=0;r<this._complex._chains.length;++r){var c=this._complex._chains[r],u=c.getName();if(!l.hasOwnProperty(u)){l[u]=c,c._index=s.length,s.push(c);continue}var f=l[u];for(a=0;a<c._residues.length;++a){var p=c._residues[a];f._residues.push(p),p._chain=f}}this._complex._chains=s}},{key:"parseSync",value:function(){var r=MMTF.decode(this._data);return this._complex=new Complex$6,this._serialAtomMap={},this._traverse(r),this._linkAtomsToResidues(),this._markHeteroAtoms(r),this._chainsByName=this._findSynonymousChains(),Array.prototype.push.apply(this._complex.units,this._parseAssemblyInfo(r)),this._joinSynonymousChains(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex}}],[{key:"canProbablyParse",value:function(r){return lodashExports.isArrayBuffer(r)&&(getFirstByte(r)|1)===223}}]),e}(Parser);MMTFParser.formats=["mmtf"];MMTFParser.extensions=[".mmtf"];MMTFParser.binary=!0;function _createSuper$m(o){var t=_isNativeReflectConstruct$m();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$m(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ParsingError=function(o){_inherits(e,o);var t=_createSuper$m(e);function e(n,r,a){var s;return _classCallCheck(this,e),s=t.call(this,"data:".concat(r,":").concat(a,": ").concat(n)),Error.captureStackTrace&&Error.captureStackTrace(_assertThisInitialized(s),e),s.name="ParsingError",s.parseLine=r,s.parseColumn=a,s}return _createClass(e)}(_wrapNativeSuper(Error));function _isWhitespace(o){return o===32||o===10||o===13||o===9}function _inlineIndexOf(o,t,e){for(var n=t.length,r=-1;e<n&&(r=t.charCodeAt(e),!(r===o||r===10));)++e;return r===o?e:-1}function readCIF(o){var t=0,e=0,n=o.length,r=NaN,a=!0,s=1,l=1,c,u=0,f={},p={},g=[],y=0,E="",h=[],v=0,C;function x(){var M;if((r===46||r===63)&&(t+1>=n||_isWhitespace(o.charCodeAt(t+1)))){++l,++t;return}if(a&&r===59){e=t;var T=0;do{if(e=_inlineIndexOf(10,o,e+1),e===-1)throw new ParsingError("Unterminated text block found",s,l);++T}while(e+1<n&&o.charCodeAt(e+1)!==r||e+1>=n);return M=o.substring(t+1,e).replace(/\r/g,""),t=e+2,s+=T,l=1,a=!1,M}if(r===39||r===34){e=t;do if(e=_inlineIndexOf(r,o,e+1),e===-1)throw new ParsingError("Unterminated quoted string found",s,l);while(e+1<n&&!_isWhitespace(o.charCodeAt(e+1)));return M=o.substring(t+1,e),l+=e-t+1,t=e+1,M}for(e=t;e<n&&!_isWhitespace(o.charCodeAt(e));)++e;M=o.substring(t,e),l+=e-t,t=e;var R=Number(M);return Number.isNaN(R)?M:R}function w(M){g[y++]=M}function _(M){var T=v%y;return h[T].push(M),++v,M}for(;t<=n;){if(r=o.charCodeAt(t),r!==13)if(r===10)a=!0,++s,l=1;else{if(!(r===32||r===9))if(r===35){if(t=_inlineIndexOf(10,o,t+1),t===-1)break;continue}else if(u===0)if((r===68||r===100)&&o.substr(t+1,4).toLowerCase()==="ata_"){for(e=t+5,c=e;e<n&&!_isWhitespace(o.charCodeAt(e));)++e;if(l+=e-t,t=e,c<t){f[o.substring(c,t)]=p={},u=1;continue}else throw new ParsingError("Data block name missing",s,l)}else{if(Number.isNaN(r))break;throw new ParsingError("Unexpected character in state ".concat(u),s,l)}else if(u===1)if((r===68||r===100)&&o.substr(t+1,4).toLowerCase()==="ata_"){u=0;continue}else if(r===95){for(e=t+1,c=e;e<n&&!_isWhitespace(o.charCodeAt(e));)++e;if(l+=e-t,t=e,c<t){E=o.substring(c,t),u=2;continue}else throw new ParsingError("Tag name missing",s,l)}else if((r===76||r===108)&&o.substr(t+1,4).toLowerCase()==="oop_"){if(t+=5,l+=5,t<n&&!_isWhitespace(o.charCodeAt(t)))throw new ParsingError("Unexpected character in state ".concat(u),s,l);g=[],y=0,h=[],v=0,u=3;continue}else{if(Number.isNaN(r))break;throw new ParsingError("Unexpected character in state ".concat(u),s,l)}else if(u===2){if(Number.isNaN(r))break;C=x(),lodashExports.set(p,E,C),u=1;continue}else if(u===3)if(r===95){for(e=t+1,c=e;e<n&&!_isWhitespace(o.charCodeAt(e));)++e;if(l+=e-t,t=e,c<t){w(o.substring(c,t));continue}else throw new ParsingError("Tag name missing",s,l)}else{if(y>0){for(var S=0;S<y;++S)C=[],h[S]=C,lodashExports.set(p,g[S],C);u=4;continue}throw new ParsingError("Data tags are missing inside a loop",s,l)}else if(u===4){(r===68||r===100)&&o.substr(t+1,4).toLowerCase()==="ata_"?u=0:r===95||(r===76||r===108)&&o.substr(t+1,4).toLowerCase()==="oop_"?u=1:Number.isNaN(r)?u=0:_(x());continue}else throw new ParsingError("Unexpected internal state ".concat(u),s,l);a=!1,++l}++t}if(u===2)throw new ParsingError("Unexpected end of file in state ".concat(u),s,l);return f}function _createSuper$l(o){var t=_isNativeReflectConstruct$l();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$5=chem.Complex,Element$5=chem.Element,Helix=chem.Helix,Sheet=chem.Sheet,Strand=chem.Strand,Assembly=chem.Assembly,Molecule$5=chem.Molecule,cRequiredAtomFields=["auth_seq_id","Cartn_x","Cartn_y","Cartn_z","label_atom_id"],cSecondaryCoding={helx:"helix",turn:"turn",strn:"strand"};function getTypeFromId(o){var t=/[A-Za-z]+/.exec(o);return t?cSecondaryCoding[t[0].toLowerCase()]:null}function arrize(o){return o==null||lodashExports.isArray(o)?o:[o]}function nameToElement(o){var t=o.trim().length===4;return o.slice(0,t?1:2).trim()}var AtomDataError=function(o){_inherits(e,o);var t=_createSuper$l(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this),r.name="AtomDataError",r.message=n,r}return _createClass(e)}(_wrapNativeSuper(Error));function _getOperations(o){if(!o)return null;var t=arrize(o.id),e=o.matrix,n=o.vector;if(!t||!e||!n)return null;for(var r=[],a=0,s=t.length;a<s;++a){for(var l=new Matrix4,c=l.elements,u=0;u<3;++u){var f=e[u+1];c[u]=arrize(f[1])[a],c[u+4]=arrize(f[2])[a],c[u+8]=arrize(f[3])[a],c[u+12]=arrize(n[u+1])[a]}r[t[a]]=l}return r}function _extractOperations(o,t){o=lodashExports.isString(o)?o:"".concat(o);for(var e=o.replace(/\)\s*\(/g,"!").replace(/[()']/g,""),n=e.split("!"),r=[],a=0,s=n.length;a<s;++a){for(var l=n[a].split(","),c=[],u=0,f=0,p=l.length;f<p;++f){var g=l[f];if(g.includes("-"))for(var y=g.split("-"),E=parseInt(y[0],10),h=parseInt(y[1],10);E<=h;++E)c[u++]=t[E];else c[u++]=t[g]}r.push(c)}var v=[],C=0;function x(w,_){for(var S=0,M=r[w].length;S<M;++S){var T=_?_.clone():new Matrix4;T.multiplyMatrices(r[w][S],T),w===0?v[C++]=T:x(w-1,T)}}return x(r.length-1),v}var CIFParser=function(o){_inherits(e,o);var t=_createSuper$l(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a.asymDict={},a.molecules=[],a._options.fileType="cif",a}return _createClass(e,[{key:"parseSync",value:function(){this.logger.info("Parsing CIF file..");var r=readCIF(this._data);return this._toComplex(r)}},{key:"_toComplex",value:function(r){var a=new Complex$5,s=r[Object.keys(r)[0]];return this._extractAtoms(a,s),this._extractSecondary(a,s),this._extractAssemblies(a,s),this._extractMolecules(a,s),this._extractMetadata(a,s),a.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing}),a}},{key:"_extractMetadata",value:function(r,a){var s=r.metadata;s.id=a.entry.id,s.classification=a.struct_keywords.pdbx_keywords;var l=a.database_PDB_rev;s.date=l&&l.date_original?l.date_original:"",s.format="cif",s.title=[],s.title[0]=a.struct.title}},{key:"_extractMolecules",value:function(r,a){var s=a.entity,l=arrize(s.pdbx_description),c=l.length,u;for(u=0;u<c;u++)this.molecules[u]?this.molecules[u].name=l[u]:this.molecules[u]={name:l[u],residues:[]};var f=r.getMolecules();for(u=0;u<c;u++){var p=this.molecules[u];f[u]=new Molecule$5(r,p.name,u+1),f[u].residues=p.residues}}},{key:"_extractAtoms",value:function(r,a){var s=a.atom_site;if(!s)throw new AtomDataError("CIF parsing error: atom_site is not specified!");for(var l=0,c=cRequiredAtomFields.length;l<c;++l)if(!s[cRequiredAtomFields[l]])throw new AtomDataError("CIF parsing error: requires field ".concat(cRequiredAtomFields[l]," not found!"));for(var u=this.asymDict,f=arrize(s.auth_seq_id),p=arrize(s.Cartn_x),g=arrize(s.Cartn_y),y=arrize(s.Cartn_z),E=arrize(s.label_atom_id),h=E.length,v=arrize(s.group_PDB)||[],C=arrize(s.auth_asym_id)||[],x=arrize(s.label_asym_id)||[],w=arrize(s.id)||[],_=arrize(s.pdbx_PDB_ins_code)||[],S=arrize(s.label_comp_id)||[],M=arrize(s.type_symbol)||[],T=arrize(s.B_iso_or_equiv)||[],R=arrize(s.occupancy)||[],P=arrize(s.pdbx_formal_charge)||[],I=arrize(s.label_alt_id)||[],B=arrize(s.pdbx_PDB_model_num)||[],W=arrize(s.label_entity_id)||[],D=null,O=null,z=0;z<h;++z){var G=B[z]||1;if(G===1){var k=String(C[z]||" ");(!D||D.getName()!==k)&&(D=r.getChain(k)||r.addChain(k)),u[String(x[z]||" ")]=k;var $=f[z],Z=String(_[z]||" "),K=String(S[z]||"");if(!O||O.getSequence()!==$||O.getICode()!==Z){O=D.addResidue(K,$,Z);var j=W[z]-1,Q=this.molecules[j];Q||(this.molecules[j]={name:"",residues:[]},Q=this.molecules[j]),Q.residues.push(O)}var le=E[z],he=M[z]||nameToElement(le),ve=Element$5.getByName(he),re=Element$5.Role[le.trim()],Ie=new Vector3(p[z],g[z],y[z]),ge=v[z]==="HETATM"||!1,Se=w[z]||z,Le=T[z]||0,be=R[z]||0,ye=String(I[z]||""),ce=P[z]||0;O.addAtom(le,ve,Ie,re,ge,Se,ye,be,Le,ce)}}}},{key:"_extractSecondary",value:function(r,a){a.struct_conf&&this._extractConfs(r,a.struct_conf),a.struct_sheet_range&&this._extractSheets(r,a.struct_sheet_range)}},{key:"_extractSheets",value:function(r,a){var s=this.asymDict;if(!a.sheet_id||!a.id||!a.beg_label_seq_id||!a.end_label_seq_id||!a.beg_label_asym_id)return;var l=r._sheets;function c(D){for(var O=l.length,z=0;z<O;++z)if(l[z]._name===D)return l[z];return l[O]=new Sheet(D,0),l[O]}for(var u=arrize(a.sheet_id),f=arrize(a.id),p=arrize(a.beg_auth_seq_id),g=arrize(a.end_auth_seq_id),y=arrize(a.beg_label_asym_id),E=arrize(a.pdbx_beg_PDB_ins_code)||[],h=arrize(a.pdbx_end_PDB_ins_code)||[],v=0,C=f.length;v<C;++v){var x=r.getChain(s[y[v]]),w=c(u[v]),_=p[v],S=g[v],M=E[v]||" ",T=h[v]||" ",R=x.findResidue(_,M),P=x.findResidue(S,T);if(!(!R||!P)){for(var I=new Strand(w,R[0],P[0],0,null,null),B=x.getResidues(),W=R[1];W<=P[1];++W)B[W]._secondary=I;w.addStrand(I),r.structures.push(I)}}}},{key:"_extractConfs",value:function(r,a){var s=this.asymDict;if(!(!a.conf_type_id||!a.beg_label_seq_id||!a.end_label_seq_id||!a.beg_label_asym_id))for(var l=arrize(a.conf_type_id),c=arrize(a.beg_auth_seq_id),u=arrize(a.pdbx_beg_PDB_ins_code)||[],f=arrize(a.end_auth_seq_id),p=arrize(a.pdbx_end_PDB_ins_code)||[],g=arrize(a.details)||[],y=arrize(a.pdbx_PDB_helix_length)||[],E=arrize(a.pdbx_PDB_helix_class)||[],h=arrize(a.id)||[],v=arrize(a.beg_label_asym_id),C=0,x=l.length;C<x;++C){var w=getTypeFromId(l[C]);if(w){var _=h[C]||l[C],S=r.getChain(s[v[C]]),M=c[C],T=f[C],R=u[C]||" ",P=p[C]||" ",I=S.findResidue(M,R),B=S.findResidue(T,P);if(!(!I||!B)){var W=g[C]||"",D=y[C]||0,O=E[C]||" ",z=void 0;if(w==="helix"){var G=r._helices.length;z=new Helix(O,I[0],B[0],G,_,W,D),r.addHelix(z),r.structures.push(z)}else w==="turn"?(z=new StructuralElement(StructuralElement.Type.TURN,I[0],B[0]),r.structures.push(z)):z=null;if(z)for(var k=S.getResidues(),$=I[1];$<=B[1];++$)k[$]._secondary=z}}}}},{key:"_extractAssemblies",value:function(r,a){var s=this.asymDict,l=a.pdbx_struct_assembly_gen;if(l){var c=arrize(l.assembly_id),u=arrize(l.oper_expression),f=arrize(l.asym_id_list);if(!(!c||!u||!f)){var p=_getOperations(a.pdbx_struct_oper_list);if(p)for(var g=0,y=c.length;g<y;++g){for(var E=new Assembly(r),h=_extractOperations(u[g],p),v=f[g].split(","),C=0,x=v.length;C<x;++C){var w=v[C].trim();w.length>0&&E.addChain(s[w])}E.matrices=h,r.units.push(E)}}}}}],[{key:"canProbablyParse",value:function(r){return lodashExports.isString(r)&&/^\s*data_/i.test(r)}}]),e}(Parser);CIFParser.formats=["cif","mmcif"];CIFParser.extensions=[".cif",".mmcif"];var valueType={singular:0,vector:1,array:2,buffer:3},VolumeModel=function(){function o(){_classCallCheck(this,o),_defineProperty(this,"_xyz2crs",[]),_defineProperty(this,"_origin",new Vector3(0,0,0)),this._header={},this._boxSize=new Vector3,this._boxStart=new Vector3,this._header.delta={},this._header.extent=[],this._header.nstart=[],this._header.grid=[],this._header.crs2xyz=[],this._header.cellDims=new Vector3,this._header.angles=[],this._header.origin=new Vector3(0,0,0),this._header.dmin=0,this._header.dmean=0,this._header.dmax=0}return _createClass(o,[{key:"_typedCheck",value:function(){if(lodashExports.isTypedArray(this._buff))this._buff=this._buff.buffer;else if(!lodashExports.isArrayBuffer(this._buff))throw new TypeError("Expected ArrayBuffer or TypedArray")}},{key:"_fillHeader",value:function(e,n){for(var r in e)if(e.hasOwnProperty(r))switch(e[r][0]){case valueType.singular:this._header[r]=n[e[r][1]][e[r][2]];break;case valueType.array:this._parseArray(this._header[r],n[e[r][1]],e[r][2]);break;case valueType.vector:this._parseVector(this._header[r],n[e[r][1]],e[r][2]);break;case valueType.buffer:this._header[r]=new Uint8Array(n[e[r][1]],[e[r][2]]*4,[e[r][3]]*4);break}}},{key:"_parseVector",value:function(e,n,r){var a=[n[r],n[r+1],n[r+2]];e.x=a[0],e.y=a[1],e.z=a[2]}},{key:"_parseArray",value:function(e,n,r){e[0]=n[r],e[1]=n[r+1],e[2]=n[r+2]}},{key:"_parseHeader",value:function(e){}},{key:"_setAxisIndices",value:function(){}},{key:"_setOrigins",value:function(){}},{key:"_getAxis",value:function(){var e=this._header,n=e.cellDims.x/e.grid[0],r=e.cellDims.y/e.grid[1],a=e.cellDims.z/e.grid[2],s=_slicedToArray(e.angles,3),l=s[0],c=s[1],u=s[2],f=Math.cos(c),p=(Math.cos(l)-Math.cos(c)*Math.cos(u))/Math.sin(u),g=Math.sqrt(1-f*f-p*p),y=new Vector3(n,0,0),E=new Vector3(Math.cos(u)*r,Math.sin(u)*r,0),h=new Vector3(f*a,p*a,g*a);return[y,E,h]}},{key:"_getXYZdim",value:function(){return[this._header.extent[this._xyz2crs[0]],this._header.extent[this._xyz2crs[1]],this._header.extent[this._xyz2crs[2]]]}},{key:"_getVolumeInfo",value:function(){var e=lodashExports.pick(this._header,["dmean","dmin","dmax","sd","delta"]);return e.obtuseAngle=this._header.angles.map(function(n){return+(n>=Math.PI/2)}),e}},{key:"_setBoxParams",value:function(e,n,r){var a=this,s=0,l=0,c=_slicedToArray(this._header.angles,3),u=c[0],f=c[1],p=c[2];p>=Math.PI/2&&(s+=Math.abs(n.x)),f>=Math.PI/2&&(s+=Math.abs(r.x)),u>=Math.PI/2&&(l+=Math.abs(r.y)),this._boxStart=new Vector3(this._origin.x-s,this._origin.y-l,this._origin.z),this._boxSize=new Vector3(Math.abs(e.x)+Math.abs(n.x)+Math.abs(r.x),Math.abs(n.y)+Math.abs(r.y),Math.abs(r.z));var g=function(E,h){return Math.abs(E[h])/a._boxSize[h]};this._header.delta.x=g(n,"x"),this._header.delta.y=g(r,"x"),this._header.delta.z=g(r,"y")}},{key:"_getXYZbox",value:function(){return new Box3(this._boxStart.clone(),this._boxStart.clone().add(this._boxSize))}},{key:"_toXYZData",value:function(){}},{key:"parse",value:function(e){return this._parseHeader(e),this._setOrigins(),new Volume$2(Float32Array,this._getXYZdim(),this._getXYZbox(),1,this._toXYZData(),this._getVolumeInfo())}}]),o}();function _createSuper$k(o){var t=_isNativeReflectConstruct$k();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$k(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CCP4Header={extent:[valueType.array,"u32",0],type:[valueType.singular,"u32",3],nstart:[valueType.array,"i32",4],grid:[valueType.array,"u32",7],cellDims:[valueType.vector,"f32",10],angles:[valueType.array,"f32",13],crs2xyz:[valueType.array,"i32",16],dmin:[valueType.singular,"f32",19],dmax:[valueType.singular,"f32",20],dmean:[valueType.singular,"f32",21],ispg:[valueType.singular,"u32",22],nsymbt:[valueType.singular,"u32",23],lksflg:[valueType.singular,"u32",24],customData:[valueType.buffer,"buffer",25,9],origin:[valueType.vector,"f32",34],map:[valueType.buffer,"buffer",52,1],machine:[valueType.singular,"u32",53],sd:[valueType.singular,"f32",54],nlabel:[valueType.singular,"f32",55],label:[valueType.buffer,"buffer",56,200]},Ccp4Model=function(o){_inherits(e,o);var t=_createSuper$k(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_parseHeader",value:function(r){this._buff=r,this._typedCheck();var a={};a.u32=new Uint32Array(this._buff,0,56),a.i32=new Int32Array(this._buff,0,56),a.f32=new Float32Array(this._buff,0,56),a.buffer=this._buff;var s=this._header;this._fillHeader(CCP4Header,a),s.angles.forEach(function(l,c,u){u[c]*=Math.PI/180})}},{key:"_setAxisIndices",value:function(){var r=this._header;r.cellDims.x===0&&r.cellDims.y===0&&r.cellDims.z===0&&r.cellDims.set(1,1,1);var a=this._header.crs2xyz;a[0]===0&&a[1]===0&&a[2]===0&&(a[0]=1,a[1]=2,a[2]=3);var s=this._xyz2crs;s[a[0]-1]=0,s[a[1]-1]=1,s[a[2]-1]=2}},{key:"_setOrigins",value:function(){var r=this._getAxis(),a=_slicedToArray(r,3),s=a[0],l=a[1],c=a[2];this._setAxisIndices();var u=this._header,f=this._xyz2crs;if(u.origin.x===0&&u.origin.y===0&&u.origin.z===0?(this._origin.addScaledVector(s,u.nstart[f[0]]),this._origin.addScaledVector(l,u.nstart[f[1]]),this._origin.addScaledVector(c,u.nstart[f[2]])):this._origin=u.origin,s.multiplyScalar(u.extent[f[0]]-1),l.multiplyScalar(u.extent[f[1]]-1),c.multiplyScalar(u.extent[f[2]]-1),u.type===2)this._data=new Float32Array(this._buff,1024+u.nsymbt,u.extent[0]*u.extent[1]*u.extent[2]);else throw new Error("CCP4: Unsupported format ".concat(u.type));this._setBoxParams(s,l,c)}},{key:"_toXYZData",value:function(){var r=this._header,a=this._data,s=this._xyz2crs,l=new Float32Array(a.length),c=this._getXYZdim(),u=c[0],f=c[1],p=0,g=[],y,E,h;for(g[2]=0;g[2]<r.extent[2];g[2]++)for(g[1]=0;g[1]<r.extent[1];g[1]++)for(g[0]=0;g[0]<r.extent[0];g[0]++,p++)y=g[s[0]],E=g[s[1]],h=g[s[2]],l[y+u*(E+f*h)]=a[p];return l}}]),e}(VolumeModel),CCP4Parser=function(o){_inherits(e,o);var t=_createSuper$k(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._options.fileType="ccp4",a.model=new Ccp4Model,a}return _createClass(e,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canProbablyParse",value:function(r){return!1}}]),e}(Parser);CCP4Parser.formats=["ccp4"];CCP4Parser.extensions=[".ccp4",".map",".mrc"];CCP4Parser.binary=!0;function _createSuper$j(o){var t=_isNativeReflectConstruct$j();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$j(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$4=chem.Complex,Element$4=chem.Element,Molecule$4=chem.Molecule,XYZParser=function(o){_inherits(e,o);var t=_createSuper$j(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._complex=null,a._atomsInf=null,a._options.fileType="xyz",a._fileName=r.name,a}return _createClass(e,[{key:"_parseToAtomsInf",value:function(r){var a=r.indexOf(`
`),s=parseInt(r.substring(0,a),10),l=r.indexOf(`
`,a+1),c=r.slice(a+1,l).trim();c.length===0&&(c=this._fileName);var u=l+r.substring(l).search(/\S/);if(this._atomsInf=r.substring(u).split(/[\s,]*\n[\s,]*/),!Number.isNaN(s)&&this._atomsInf.length-1!==s){this._complex.error={message:"wrong number of atoms"};return}this._complex.metadata.format="xyz",this._complex.name=c}},{key:"_parseAtomsInf",value:function(){for(var r=!0,a=" ",s=1,l=1,c=0,u=this._complex.addChain("A"),f=u.addResidue("UNK",1," "),p=0;p<this._atomsInf.length-1;p++){var g=this._atomsInf[p].split(/[\s,]+/);if(g.length!==4){this._complex.error={message:"missed parameters"};break}var y=p+1,E=g[0],h=new Vector3(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),v=Element$4.getByName(E),C=void 0;f.addAtom(E,v,h,C,r,y,a,s,l,c)}var x=new Molecule$4(this._complex,this._complex.name,1);x.residues=f,this._complex._molecules[0]=x}},{key:"parseSync",value:function(){var r=this._complex=new Complex$4;if(this._parseToAtomsInf(this._data),this._parseAtomsInf(),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap}),this._complex=null,this._atomsInf=null,r.error)throw new Error(r.error.message);return r}}],[{key:"canProbablyParse",value:function(r){return lodashExports.isString(r)&&/^\s*\d+ *\n[^\n]*\n\s*\w{1,3}\s+-?\d/.test(r)}}]),e}(Parser);_defineProperty(XYZParser,"formats",["xyz"]);_defineProperty(XYZParser,"extensions",[".xyz"]);function _createSuper$i(o){var t=_isNativeReflectConstruct$i();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$i(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$3=chem.Complex,Element$3=chem.Element,PubChemParser=function(o){_inherits(e,o);var t=_createSuper$i(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._options.fileType="pubchem+json",a}return _createClass(e,[{key:"parseSync",value:function(){return this.logger.info("Parsing PubChem JSON file..."),this._toComplex(JSON.parse(this._data))}},{key:"_toComplex",value:function(r){var a=new Complex$3,s=r.PC_Compounds&&r.PC_Compounds[0];return s&&(this._extractAtoms(a,s),a.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing})),a}},{key:"_extractAtoms",value:function(r,a){var s=a.atoms&&a.atoms.aid,l=s&&a.atoms.element;if(!l||s.length!==l.length)throw new Error("Unable to parse atom elements");l=lodashExports.fromPairs(lodashExports.zip(s,l));var c={},u=a.coords&&a.coords[0],f=u&&u.conformers&&u.conformers[0],p=f&&f.x,g=f&&f.y,y=f&&f.z||[];if(s=u&&u.aid,!s||!p||!g)throw new Error("Coordinates are not found in the file");for(var E=r.addChain(" "),h=E.addResidue("UNK",1," "),v=0,C=s.length;v<C;++v){var x=s[v],w=Element$3.ByAtomicNumber[l[x]],_=new Vector3(p[v],g[v],y[v]||0);c[x]=h.addAtom(w.name,w,_,void 0,!0,x," ",1,0,0)}var S=a.bonds&&a.bonds.aid1,M=a.bonds&&a.bonds.aid2,T=a.bonds&&a.bonds.order||[];if(!(!S||!M||S.length!==M.length))for(var R=0,P=S.length;R<P;++R)r.addBond(c[S[R]],c[M[R]],T[R]||1,0,!0)}}],[{key:"canProbablyParse",value:function(r){return lodashExports.isString(r)&&r[0]==="{"}}]),e}(Parser);PubChemParser.formats=["pubchem","pubchem+json","pc"];PubChemParser.extensions=[".json"];var SDFStream=function(){function o(t){_classCallCheck(this,o),this._strings=t.split(/\r?\n|\r/),this._currentStart=0,this._currentStringIndx=0}return _createClass(o,[{key:"setStart",value:function(e){e>=this._strings.length?(this._currentStart=this._strings.length-1,this._currentStringIndx=this._strings.length-1):(this._currentStart=e,this._currentStringIndx=e)}},{key:"getNextString",value:function(){return this._strings[++this._currentStringIndx]}},{key:"getCurrentString",value:function(){return this._strings[this._currentStringIndx]}},{key:"getStringFromStart",value:function(e){return this._currentStringIndx=this._currentStart+e,this._strings[this._currentStart+e]}},{key:"findNextDataItem",value:function(){for(var e=this.getNextString(),n=!1;!lodashExports.isUndefined(e)&&e.trim()!=="$$$$";){if(e.match(/>\s+<(.*)>/)){n=!0;break}e=this.getNextString()}return n}},{key:"findNextCompoundStart",value:function(){for(var e=this.getCurrentString();!lodashExports.isUndefined(e)&&e.trim()!=="$$$$";)e=this.getNextString();return this.setStart(++this._currentStringIndx),this.probablyHaveDataToParse()}},{key:"probablyHaveDataToParse",value:function(){return this._currentStringIndx<this._strings.length-2}}]),o}();function _createSuper$h(o){var t=_isNativeReflectConstruct$h();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$h(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$2=chem.Complex,Element$2=chem.Element,Bond$1=chem.Bond,Molecule$3=chem.Molecule,chargeMap=[0,3,2,1,0,-1,-2,-3],orderMap$1=[0,1,2,3,1,1,1,2],typeMap$1=[Bond$1.BondType.UNKNOWN,Bond$1.BondType.COVALENT,Bond$1.BondType.COVALENT,Bond$1.BondType.COVALENT,Bond$1.BondType.AROMATIC,Bond$1.BondType.UNKNOWN,Bond$1.BondType.AROMATIC,Bond$1.BondType.AROMATIC],sdfAndMolRegexp=/.*(M\s\sEND).*|.*(^$$$$).*|.*>\s+<(.+)>.*/,sdfRegExp=/.*($$$$).*|.*>\s+<(.+)>.*/,fileFormat={SDF:"sdf",MOL:"mol"},possibleNameTags=["PUBCHEM_IUPAC_TRADITIONAL_NAME",/PUBCHEM_(.+)_NAME/,/(.+)name/,/(.+)NAME/],possibleIDTags=["PUBCHEM_COMPOUND_CID","id","ID",/.*CID/,/.*ID/,/.*id/],possibleTitleTags=["msg","MSG","message","title","description","desc"],tagsNames=["name","id","title"],tags={name:possibleNameTags,id:possibleIDTags,title:possibleTitleTags};function buildChainID(o){if(!o)return"A";for(var t=[];o;)t.push(65+o%26),o=Math.trunc(o/26);return t.length>1&&(t.reverse(),t[0]-=1),String.fromCharCode.apply(String,t)}var SDFParser=function(o){_inherits(e,o);var t=_createSuper$h(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._format="sdf",a._complex=null,a._chain=null,a._residue=null,a._molecules=null,a._metadata={},a._metadata.molecules=[],a._currentMolProps={},a._compoundIndx=-1,a._assemblies=[],a._atomsParsed=0,a._atomsIndexes=[],a}return _createClass(e,[{key:"canProbablyParse",value:function(r){return lodashExports.isString(r)&&sdfAndMolRegexp.test(r)}},{key:"_parseHeader",value:function(r){var a={};a.name=r.getStringFromStart(0);var s=parseInt(r.getStringFromStart(1).substr(10,6).trim(),10);a.date=s.toString()||"",a.title=r.getStringFromStart(2),this._metadata.molecules.push(a)}},{key:"_parseAtoms",value:function(r,a){var s,l=this._atomsParsed,c=buildChainID(this._compoundIndx),u="UNK",f=1;this._chain=this._complex.getChain(c)||this._complex.addChain(c),this._residue=this._chain.addResidue(u,f," ");for(var p=0;p<a;p++){s=r.getNextString(),l++;var g=parseFloat(s.substr(0,10)),y=parseFloat(s.substr(10,10)),E=parseFloat(s.substr(20,10)),h=chargeMap[parseInt(s.substr(36,3),10)],v=new Vector3(g,y,E),C=s.substr(31,3).trim().toUpperCase(),x=Element$2.getByName(C);this._atomsIndexes[C]||(this._atomsIndexes[C]=0),this._atomsIndexes[C]+=1,C+=this._atomsIndexes[C],this._residue.addAtom(C,x,v,void 0,!0,l," ",1,0,h)}}},{key:"_parseBonds",value:function(r,a){for(var s,l=0;l<a;l++){s=r.getNextString();var c=parseInt(s.substr(0,3),10)+this._atomsParsed,u=parseInt(s.substr(3,3),10)+this._atomsParsed,f=parseInt(s.substr(6,3),10);if(c>u){var p=[u,c];c=p[0],u=p[1]}this._complex.addBond(c,u,orderMap$1[f]||1,typeMap$1[f]||Bond$1.BondType.UNKNOWN,!0)}}},{key:"_parseMOL",value:function(r){this._compoundIndx++,this._parseHeader(r);var a=r.getStringFromStart(3),s=parseInt(a.substr(0,3),10),l=parseInt(a.substr(3,3),10);this._parseAtoms(r,s),this._parseBonds(r,l),this._atomsParsed+=s,this._metadata.molecules[this._compoundIndx]._residues=[],this._metadata.molecules[this._compoundIndx]._residues.push(this._residue)}},{key:"_parseDataItem",value:function(r){for(var a=r.getCurrentString(),s=[],l=r.getNextString();l.trim()!=="";)s.push(l),l=r.getNextString();if(s.length===1){var c=s,u=_slicedToArray(c,1);s=u[0]}this._currentMolProps[a.replace(/[<>]/g,"").trim()]=s}},{key:"_parseCompound",value:function(r){if(this._parseMOL(r),this._format===fileFormat.SDF){for(this._currentMolProps={};r.findNextDataItem();)this._parseDataItem(r);if(Object.keys(this._currentMolProps).length!==0){var a=this._metadata.molecules[this._compoundIndx];a.props=this._currentMolProps,this._tryToUpdateMoleculeData(a)}}}},{key:"_fixBondsArray",value:function(){for(var r=this._serialAtomMap,a=this._complex,s=a._bonds,l=0;l<s.length;l++){var c=s[l];c._right<c._left&&console.log("_fixBondsArray: Logic error."),c._left=r[c._left]||null,c._right=r[c._right]||null}}},{key:"_buildAssemblies",value:function(){var r=this._complex._chains;if(r.length===1)return this._assemblies;for(var a=0;a<r.length;a++){var s=new Assembly$3(this._complex),l=new Matrix4;s.addMatrix(l),s.addChain(r[a]._name),this._assemblies.push(s)}return this._assemblies}},{key:"_buildMolecules",value:function(){this._complex._molecules=[];for(var r=this._metadata.molecules,a=0;a<r.length;a++){var s=new Molecule$3(this._complex,r[a].name,a+1);s.residues=r[a]._residues,this._complex._molecules[a]=s}return this._complex._molecules}},{key:"_searchTag",value:function(r,a){for(var s=0;s<a.length;s++)if(r instanceof RegExp&&r.test(a[s].tag)||r===a[s].tag)return a[s].data}},{key:"_tryToFind",value:function(r,a){for(var s=0;s<r.length;s++){var l=this._searchTag(r[s],a);if(l)return l}}},{key:"_tryToUpdateMoleculeData",value:function(r){for(var a=!1,s=0;s<tagsNames.length;s++){var l=tags[tagsNames[s]],c=this._tryToFind(l,r.props);c&&(r[tagsNames[s]]=c,a=!0)}return r.name=r.name||r.id,r.name.match(/^\d+$/)&&(r.name="CID: ".concat(r.name)),a}},{key:"_finalizeMetadata",value:function(){var r=this._metadata.molecules,a=this._complex.metadata,s=this._complex;if(r.length===1)s.name=r[0].name,a.title=r[0].title,a.date=r[0].date,a.properties=r[0].props;else if(r.length>1){a.molecules=[];for(var l=0;l<r.length;l++)a.molecules.push({name:r[l].name,date:r[l].date,title:r[l].title,properties:r[l].props})}}},{key:"_finalize",value:function(){for(var r=this._serialAtomMap={},a=this._complex._atoms,s=0;s<a.length;s++){var l=a[s];r[l.serial]=l}this._complex._finalizeBonds(),this._fixBondsArray(),this._finalizeMetadata(),this._buildAssemblies(),this._complex.units=this._complex.units.concat(this._assemblies),this._buildMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:!1,enableEditing:!1,serialAtomMap:this._serialAtomMap})}},{key:"defineFormat",value:function(r){var a;return sdfRegExp.test(r)?a=fileFormat.SDF:a=fileFormat.MOL,a}},{key:"parseSync",value:function(){var r=this._complex=new Complex$2,a=new SDFStream(this._data);this._format=this.defineFormat(this._data),r.metadata.format=this._format;do this._parseCompound(a);while(a.findNextCompoundStart());return this._finalize(),r}}]),e}(Parser);SDFParser.formats=["mol","sdf"];SDFParser.extensions=[".mol",".sdf"];function _createSuper$g(o){var t=_isNativeReflectConstruct$g();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DSN6Header={nstart:[valueType.array,"i16",0],extent:[valueType.array,"i16",3],grid:[valueType.array,"i16",6],cellDims:[valueType.vector,"i16",9],angles:[valueType.array,"i16",12],div:[valueType.singular,"i16",15],adder:[valueType.singular,"i16",16],scaleFactor:[valueType.singular,"i16",17]},DSN6Model=function(o){_inherits(e,o);var t=_createSuper$g(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"_parseHeader",value:function(r){this._buff=r,this._typedCheck();var a={};if(a.i16=new Int16Array(this._buff),a.i16[18]!==100)for(var s=0,l=a.i16.length;s<l;++s){var c=a.i16[s];a.i16[s]=(c&255)<<8|c>>8&255}if(a.i16[18]!==100)throw new Error("DSN6: Incorrect format ");var u=this._header;this._fillHeader(DSN6Header,a),u.cellDims.multiplyScalar(1/u.scaleFactor),u.angles.forEach(function(f,p,g){g[p]*=Math.PI/180/u.scaleFactor}),u.div/=100}},{key:"_setAxisIndices",value:function(){this._xyz2crs[0]=0,this._xyz2crs[1]=1,this._xyz2crs[2]=2}},{key:"_setOrigins",value:function(){var r=this._header,a=this._getAxis(),s=_slicedToArray(a,3),l=s[0],c=s[1],u=s[2];this._setAxisIndices(),this._origin.addScaledVector(l,r.nstart[0]),this._origin.addScaledVector(c,r.nstart[1]),this._origin.addScaledVector(u,r.nstart[2]),l.multiplyScalar(r.extent[0]),c.multiplyScalar(r.extent[1]),u.multiplyScalar(r.extent[2]),this._setBoxParams(l,c,u)}},{key:"_pointCalculate",value:function(r,a,s,l,c,u,f){var p=this._header;if(c<p.extent[0]&&l<p.extent[1]&&s<p.extent[2]){var g=c+p.extent[0]*(l+p.extent[1]*s);r[g]=(a[u.counter]-p.adder)/p.div,++u.counter}else return u.counter+=8-f,!1;return!0}},{key:"_blockCalculate",value:function(r,a,s,l,c,u){for(var f=0;f<8;++f)for(var p=8*s+f,g=0;g<8;++g)for(var y=8*l+g,E=!0,h=0;E&&h<8;){var v=8*c+h;E=this._pointCalculate(r,a,p,y,v,u,h),h++}}},{key:"_toXYZData",value:function(){var r=this._header,a=new Uint8Array(this._buff),s=new Float32Array(r.extent[0]*r.extent[1]*r.extent[2]),l=new Vector3(r.extent[0]/8,r.extent[1]/8,r.extent[2]/8),c={};c.counter=512;for(var u=0;u<l.z;++u)for(var f=0;f<l.y;++f)for(var p=0;p<l.x;++p)this._blockCalculate(s,a,u,f,p,c);return this._calculateInfoParams(s),s}},{key:"_calculateInfoParams",value:function(r){this._header.dmean/=r.length;for(var a=0,s=r[0],l=r[0],c=0;c<r.length;c++)a+=Math.pow(this._header.dmean-r[c],2),r[c]<s&&(s=r[c]),r[c]>l&&(l=r[c]);this._header.sd=Math.sqrt(a/r.length),this._header.dmax=l,this._header.dmin=s}}]),e}(VolumeModel),DSN6Parser=function(o){_inherits(e,o);var t=_createSuper$g(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._options.fileType="dsn6",a.model=new DSN6Model,a}return _createClass(e,[{key:"parseSync",value:function(){return this.model.parse(this._data)}}],[{key:"canParse",value:function(r,a){return r?r instanceof ArrayBuffer&&Parser.checkDataTypeOptions(a,"dsn6"):!1}},{key:"canProbablyParse",value:function(r){return!1}}]),e}(Parser);DSN6Parser.formats=["dsn6"];DSN6Parser.extensions=[".dsn6",".omap"];DSN6Parser.binary=!0;function _createSuper$f(o){var t=_isNativeReflectConstruct$f();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$f(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GROReader=function(o){_inherits(e,o);var t=_createSuper$f(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n),r._next=-1,r.next(),r}return _createClass(e,[{key:"getNext",value:function(){return this._next}}]),e}(PDBStream);function _createSuper$e(o){var t=_isNativeReflectConstruct$e();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex$1=chem.Complex,Element$1=chem.Element,Molecule$2=chem.Molecule,GROParser=function(o){_inherits(e,o);var t=_createSuper$e(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._time=null,a._numAtoms=null,a._residueNumber=null,a._residueName="",a._atomName="",a._atomNumber=null,a._atomPosition=[],a._atomVelocity=[],a._complex=null,a._molecules=[],a._molecule=null,a._options.filetype="gro",a}return _createClass(e,[{key:"canProbablyParse",value:function(r){return lodashExports.isString(this._data)&&/^\s*[^\n]*\n\s*\d+ *\n\s*\d+[^\n\d]{3}\s*\w+\s*\d+\s*-?\d/.test(r)}},{key:"_parseTitle",value:function(r){var a=this._complex.metadata;a.id=r.readLine().trim(),a.name=a.id.slice(a.id.lastIndexOf("\\")+1,a.id.lastIndexOf(".")),a.format="gro"}},{key:"_parseNumberOfAtoms",value:function(r){if(this._numAtoms=r.readInt(0,r.getNext()),Number.isNaN(this._numAtoms))throw new Error("Line 2 is not representing atom number. Consider checking input file")}},{key:"_parseAtom",value:function(r){this._residueNumber=r.readInt(1,5),this._residueName=r.readString(6,10).trim(),this._atomName=r.readString(11,15).trim(),this._atomNumber=r.readInt(16,20);var a=r.readFloat(21,28)*10,s=r.readFloat(29,36)*10,l=r.readFloat(37,45)*10;if(Number.isNaN(a)||Number.isNaN(s)||Number.isNaN(l)){this._complex.error={message:'Atom position is invalid in "'.concat(r.readLine(),'"')};return}var c=Element$1.getByName(this._atomName[0]);if(c.fullName==="Unknown"){this._complex.error={message:"".concat(this._atomName[0]," hasn't been recognised as an atom name.")};return}var u=Element$1.Role[this._atomName],f=this._chain;f||(this._chain=f=this._complex.addChain("A"));var p=this._residue;(!p||p.getSequence()!==this._residueNumber)&&(this._residue=p=f.addResidue(this._residueName,this._residueNumber," ")),this._atomPosition=new Vector3(a,s,l);var g=!0,y=" ",E=1,h=1,v=0;p.addAtom(this._atomName,c,this._atomPosition,u,g,this._atomNumber,y,E,h,v)}},{key:"_finalize",value:function(){var r=new Molecule$2(this._complex,this._complex.metadata.name,1);r.residues=this._chain._residues,r._chains=this._chain,this._complex._molecules[0]=r,this._molecules.push(r),this._complex.finalize({needAutoBonding:!0,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"parseSync",value:function(){var r=this._complex=new Complex$1,a=new GROReader(this._data),s=0;for(this._parseTitle(a),a.next(),this._parseNumberOfAtoms(a),a.next(),s=0;s<this._numAtoms&&!a.end();++s)this._parseAtom(a),a.next();if(s<this._numAtoms&&(this._complex.error={message:"File ended unexpectedly."}),r.error)throw new Error(r.error.message);return this._finalize(),this._atomPosition=null,this._complex=null,this._molecules=null,this._molecule=null,r}}]),e}(Parser);GROParser.formats=["gro"];GROParser.extensions=[".gro"];function _createSuper$d(o){var t=_isNativeReflectConstruct$d();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Complex=chem.Complex,Element=chem.Element,Bond=chem.Bond,Molecule$1=chem.Molecule,orderMap={un:0,1:1,2:2,3:3,ar:1,am:1,nc:0,du:1},typeMap={un:Bond.BondType.UNKNOWN,1:Bond.BondType.COVALENT,2:Bond.BondType.COVALENT,3:Bond.BondType.COVALENT,ar:Bond.BondType.AROMATIC,am:Bond.BondType.COVALENT,nc:Bond.BondType.UNKNOWN,du:Bond.BondType.COVALENT},resNumberRegex=/\d+$/,spacesRegex=/\s+/;function splitToFields(o){return o.trim().split(spacesRegex)}var MOL2Parser=function(o){_inherits(e,o);var t=_createSuper$d(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._complex=null,a._chain=null,a._residue=null,a._compoundIndx=-1,a._molecules=[],a._molecule=null,a._currPosIdx=0,a._currStartIdx=0,a._serialAtomMap={},a._options.fileType="mol2",a}return _createClass(e,[{key:"_parseRawStrings",value:function(r){return r.split(/\r?\n|\r/)}},{key:"_toStringFromStart",value:function(r,a){var s=this._currStartIdx+r;this._currPosIdx=s<a.length?s:this._currStartIdx}},{key:"_toHeaderString",value:function(r,a){for(this._toStringFromStart(0,a);this._currPosIdx<a.length;){if(a[this._currPosIdx].match("@<TRIPOS>".concat(r)))return;this._currPosIdx++}this._toStringFromStart(0,a)}},{key:"_toStringFromHeader",value:function(r,a,s){this._toHeaderString(r,s);var l=this._currPosIdx+a;s[this._currPosIdx].match("@<TRIPOS>".concat(r))&&l<s.length&&(this._currPosIdx=l)}},{key:"_setStart",value:function(r,a){r>=a.length?this._currStartIdx=this._currPosIdx=a.length-1:this._currStartIdx=this._currPosIdx=r}},{key:"_probablyHaveDataToParse",value:function(r){return this._currPosIdx<r.length-2}},{key:"_findNextCompoundStart",value:function(r){for(;this._currPosIdx<r.length&&r[this._currPosIdx].trim()!=="@<TRIPOS>MOLECULE>";)this._currPosIdx++;return this._setStart(++this._currPosIdx,r),this._probablyHaveDataToParse(r)}},{key:"_parseMolecule",value:function(r){this._toHeaderString("MOLECULE",r);var a=this._complex.metadata;a.name=r[++this._currPosIdx],a.format="mol2",this._molecule={_index:"",_chains:[]},this._molecule._index=this._compoundIndx+1,this._molecules.push(this._molecule)}},{key:"_parseAtoms",value:function(r,a){this._toHeaderString("ATOM",a);for(var s=0;s<r;s++){var l=splitToFields(a[++this._currPosIdx]);if(l.length<6)throw new Error("MOL2 parsing error: Not enough information to create atom!");var c=parseInt(l[0],10),u=l[1],f=parseFloat(l[2]),p=parseFloat(l[3]),g=parseFloat(l[4]),y=l[5].split(".")[0].toUpperCase(),E=0;l.length>=9&&(E=parseFloat(l[8])||0);var h=this._chain;if(h||(this._chain=h=this._complex.getChain("A")||this._complex.addChain("A"),this._residue=null),!!this._setResidue(l)){var v=!1,C=" ",x=1,w=0,_=Element.getByName(y),S=Element.Role[u],M=new Vector3(f,p,g);this._residue.addAtom(u,_,M,S,v,c,C,x,w,E)}}}},{key:"_setResidue",value:function(r){var a=1,s="UNK";if(r.length>=7&&(a=parseInt(r[6],10)),r.length>=8&&r[7]!=="<0>"&&(s=r[7].replace(resNumberRegex,"")),this.settings.now.nowater&&(s==="HOH"||s==="WAT"))return!1;var l=this._residue,c=this._chain;return(!l||l.getSequence()!==a)&&(this._residue=c.addResidue(s,a,"A")),!0}},{key:"_parseBonds",value:function(r,a){this._toHeaderString("BOND",a);for(var s=0;s<r;s++){var l=splitToFields(a[++this._currPosIdx]);if(l.length<3)throw new Error("MOL2 parsing error: Missing information about bonds!");var c=parseInt(l[1],10),u=parseInt(l[2],10),f=l[3];if(c>u){var p=[u,c];c=p[0],u=p[1]}this._complex.addBond(c,u,orderMap[f]||0,typeMap[f]||Bond.BondType.UNKNOWN,!0)}}},{key:"_fixSerialAtoms",value:function(){for(var r=this._complex._atoms,a=0;a<r.length;a++){var s=r[a];this._serialAtomMap[s.serial]=s}}},{key:"_fixBondsArray",value:function(){var r=this._serialAtomMap,a=this._complex;if(Object.keys(r).length===0)throw new Error("MOL2 parsing error: Missing atom information!");for(var s=a._bonds,l=0;l<s.length;l++){var c=s[l];c._left=r[c._left]||null,c._right=r[c._right]||null}}},{key:"_finalizeMolecules",value:function(){var r=this._complex._chains[0];this._complex._molecules=[];for(var a=0;a<this._molecules.length;a++){var s=this._molecules[a],l=r._residues,c=new Molecule$1(this._complex,s._name,a+1);c.residues=l,this._complex._molecules[a]=c}}},{key:"_finalize",value:function(){this._complex._finalizeBonds(),this._fixSerialAtoms(),this._fixBondsArray(),this._finalizeMolecules(),this._complex.finalize({needAutoBonding:!1,detectAromaticLoops:this.settings.now.aromatic,enableEditing:this.settings.now.editing,serialAtomMap:this._serialAtomMap})}},{key:"_parseCompound",value:function(r){this._compoundIndx++,this._parseMolecule(r),this._toStringFromHeader("MOLECULE",2,r);var a=r[this._currPosIdx].trim().split(spacesRegex),s=a[0],l=a[1];this._parseAtoms(s,r),this._parseBonds(l,r)}},{key:"parseSync",value:function(){var r=this._complex=new Complex,a=this._parseRawStrings(this._data);do this._parseCompound(a);while(this._findNextCompoundStart(a));return this._finalize(),r}}]),e}(Parser);MOL2Parser.formats=["mol2"];MOL2Parser.extensions=[".mol2",".ml2",".sy2"];var parsers=new ParserList([PDBParser,CIFParser,MMTFParser,XYZParser,CMLParser,PubChemParser,SDFParser,CCP4Parser,DSN6Parser,GROParser,MOL2Parser]);function _createSuper$c(o){var t=_isNativeReflectConstruct$c();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$c(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ExporterList=function(o){_inherits(e,o);var t=_createSuper$c(e);function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return _classCallCheck(this,e),t.call(this,n,["formats"])}return _createClass(e,[{key:"find",value:function(r){var a=[];return r.format&&(a=this._dict.formats[r.format.toLowerCase()]||[]),_toConsumableArray(a)}}]),e}(EntityList),Exporter=function(){function o(t,e){_classCallCheck(this,o),this._source=t,this._options=e||{},this._abort=!1}return _createClass(o,[{key:"exportSync",value:function(){throw new Error("Exporting to this source is not implemented")}},{key:"export",value:function(){var e=this;return new Promise(function(n,r){setTimeout(function(){try{return e._abort?r(new Error("Export aborted")):n(e.exportSync())}catch(a){return r(a)}})})}},{key:"abort",value:function(){this._abort=!0}}]),o}();makeContextDependent(Exporter.prototype);var PDBResult=function(){function o(){_classCallCheck(this,o),this._resultArray=[],this._currentStr=-1,this._tag=null,this._fixedNumeration=!1,this._numeration=!1,this._tagStrNum=0}return _createClass(o,[{key:"getResult",value:function(){return this.writeString(`
`,81,81),this._resultArray.join("")}},{key:"_currentStrLength",value:function(){var e=this._resultArray[this._currentStr];return e?e.length:0}},{key:"newTag",value:function(e,n){e?this._tag=e:this._tag=null,lodashExports.isUndefined(n)?(this._numeration=!1,this._fixedNumeration=!1,this._tagStrNum=0):lodashExports.isNumber(n)?(this._tagStrNum=n,this._numeration=!0,this._fixedNumeration=!0):lodashExports.isBoolean(n)&&(this._tagStrNum=0,this._numeration=n,this._fixedNumeration=!1)}},{key:"newString",value:function(e){this.writeString(`
`,81,81),this._currentStr++,this._resultArray.push(""),e?this.writeString(e,1,6):this._tag&&this.writeString(this._tag,1,6),this._numeration&&(this._fixedNumeration||this._tagStrNum++,this._tagStrNum!==1&&this.writeString(this._tagStrNum.toString(),10,8))}},{key:"writeEntireString",value:function(e,n,r){n||(n=81);for(var a=0;a<e.length;a++)this._currentStrLength()===n&&a!==e.length-1&&(this.newString(),r&&this.writeString(r.tag,r.begin,r.end)),e[a]===`
`?this.newString():this.writeString(e[a])}},{key:"writeString",value:function(e,n,r){var a=this._resultArray[this._currentStr],s,l=a?a.length:0;if(!lodashExports.isUndefined(e)){lodashExports.isNumber(n)||(n=l+1),lodashExports.isNumber(r)||(r=l+e.length),lodashExports.isString(e)?s=e:s=e.toString();var c=n<r?r:n,u=n<r?n:r;if(s.length>Math.abs(n-r)+1&&(s=s.substr(0,Math.abs(n-r+1))),u>l+1)this._resultArray[this._currentStr]+=" ".repeat(u-l-1);else if(u<=l){var f=this._resultArray[this._currentStr];this._resultArray[this._currentStr]=f.slice(0,u-1)}if(r<n){var p=n-r+1;s=" ".repeat(p-s.length)+s}u===11&&this._numeration&&this._tagStrNum!==1&&(s=" ".concat(s)),this._resultArray[this._currentStr]+=s,a=this._resultArray[this._currentStr],c>a.length&&(this._resultArray[this._currentStr]+=" ".repeat(c-a.length))}}},{key:"writeBondsArray",value:function(e,n){for(var r=this._getSubArrays(e,4),a=0;a<r.length;a++){this.newString(),this.writeString(n.serial,11,7);for(var s=0;s<r[a].length;s++){var l=r[a][s]._left.serial===n.serial?r[a][s]._right.serial:r[a][s]._left.serial;this.writeString(l,16+5*s,12+5*s)}}}},{key:"_getSubArrays",value:function(e,n){for(var r=[],a=0;a<e.length;a+=n)r.push(e.slice(a,a+n));return r}},{key:"writeMatrix",value:function(e,n,r){for(var a=0;a<3;a++){this.newString(),this.writeString(r,14,18),this.writeString((a+1).toString(),19,19),this.writeString(n.toString(),23,20);for(var s=0;s<3;s++){var l=parseFloat(e.elements[a*4+s]).toFixed(6);this.writeString(l.toString(),33+s*10,24+s*10)}var c=parseFloat(e.elements[a*4+3]).toFixed(5);this.writeString(c.toString(),68,55)}}},{key:"writeMatrices",value:function(e,n){if(e)for(var r=new Matrix4,a=0;a<e.length;a++)r.copy(e[a]).transpose(),this.writeMatrix(r,a+1,n)}}]),o}();function _createSuper$b(o){var t=_isNativeReflectConstruct$b();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$b(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var PDBExporter=function(o){_inherits(e,o);var t=_createSuper$b(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._tags=["HEADER","TITLE","COMPND","REMARK","HELIX","SHEET","ATOM and HETATM","CONECT"],a._result=null,a._tagExtractors={HEADER:a._extractHEADER,TITLE:a._extractTITLE,"ATOM and HETATM":a._extractATOM,CONECT:a._extractCONECT,COMPND:a._extractCOMPND,REMARK:a._extractREMARK,HELIX:a._extractHELIX,SHEET:a._extractSHEET},a._stringForRemark350=`COORDINATES FOR A COMPLETE MULTIMER REPRESENTING THE KNOWN
BIOLOGICALLY SIGNIFICANT OLIGOMERIZATION STATE OF THE
MOLECULE CAN BE GENERATED BY APPLYING BIOMT TRANSFORMATIONS
GIVEN BELOW.  BOTH NON-CRYSTALLOGRAPHIC AND
CRYSTALLOGRAPHIC OPERATIONS ARE GIVEN.`,a._stringForRemark290=`CRYSTALLOGRAPHIC SYMMETRY TRANSFORMATIONS
THE FOLLOWING TRANSFORMATIONS OPERATE ON THE ATOM/HETATM
RECORDS IN THIS ENTRY TO PRODUCE CRYSTALLOGRAPHICALLY
RELATED MOLECULES.`,a}return _createClass(e,[{key:"exportSync",value:function(){var r=new PDBResult;if(!this._source)return this._result;for(var a=0;a<this._tags.length;a++){var s=this._tags[a],l=this._tagExtractors[s];typeof l=="function"&&l.call(this,r)}return this._result=r.getResult(),this._result}},{key:"_extractHEADER",value:function(r){if(this._source.metadata){var a=this._source.metadata;r.newTag("HEADER"),r.newString(),a.classification&&r.writeString(a.classification,11,50),a.date&&r.writeString(a.date,51,59),a.id&&r.writeString(a.id,63,66)}}},{key:"_extractTITLE",value:function(r){if(this._source.metadata){var a=this._source.metadata;if(a.title){r.newTag("TITLE",!0);for(var s=0;s<a.title.length;s++)r.newString(),r.writeString(a.title[s],11,80)}}}},{key:"_extractCONECT",value:function(r){if(this._source._atoms){var a=this._source._atoms;r.newTag("CONECT");for(var s=0;s<a.length;s++){var l=a[s].bonds.filter(function(c){return c._fixed});l.length!==0&&r.writeBondsArray(l.reverse(),a[s])}}}},{key:"_extractSHEET",value:function(r){if(this._source._sheets){r.newTag("SHEET");for(var a=this._source._sheets,s=0;s<a.length;s++)if(a[s]._strands)for(var l=a[s]._strands,c=0;c<l.length;c++)r.newString(),r.writeString(c+1,10,8),r.writeString(a[s]._name,14,12),r.writeString(l.length,16,15),r.writeString(l[c].init._type._name,18,20),r.writeString(l[c].init._chain._name,22,22),r.writeString(l[c].init._sequence,26,23),r.writeString(l[c].init._icode,27,27),r.writeString(l[c].term._type._name,29,31),r.writeString(l[c].init._chain._name,33,33),r.writeString(l[c].term._sequence,37,34),r.writeString(l[c].term._icode,38,38),r.writeString(l[c].sense,40,39)}}},{key:"_extractHELIX",value:function(r){if(this._source._helices){r.newTag("HELIX");for(var a=this._source._helices,s=0;s<a.length;s++){var l=a[s],c=lodashExports.invert(typeByPDBHelixClass);r.newString(),r.writeString(l.serial,10,8),r.writeString(l.name,14,12),r.writeString(l.init._type._name,16,18),r.writeString(l.init._chain._name,20,20),r.writeString(l.init._sequence,25,22),r.writeString(l.init._icode,26,26),r.writeString(l.term._type._name,28,30),r.writeString(l.term._chain._name,32,32),r.writeString(l.term._sequence,37,34),r.writeString(l.term._icode,38,38),r.writeString(c[l.type],40,39),r.writeString(l.comment,41,70),r.writeString(l.length,76,72)}}}},{key:"_extractATOM",value:function(r){if(this._source._atoms)for(var a=this._source._atoms,s=0;s<a.length;s++){var l=a[s].het?"HETATM":"ATOM";r.newString(l);var c=a[s].element.name.length>1||a[s].name.length>3?13:14;r.writeString(a[s].serial,11,7),r.writeString(a[s].name,c,16),r.writeString(String.fromCharCode(a[s].location),17,17),r.writeString(a[s].residue._type._name,20,18),r.writeString(a[s].residue._chain._name,22,22),r.writeString(a[s].residue._sequence,26,23),r.writeString(a[s].residue._icode,27,27),r.writeString(a[s].position.x.toFixed(3),38,31),r.writeString(a[s].position.y.toFixed(3),46,39),r.writeString(a[s].position.z.toFixed(3),54,47),r.writeString(a[s].occupancy.toFixed(2),60,55),r.writeString(a[s].temperature.toFixed(2),66,61),r.writeString(a[s].element.name,78,77),a[s].charge&&r.writeString(a[s].charge,79,80)}}},{key:"_extractCOMPND",value:function(r){if(this._source._molecules){var a=this._source._molecules;r.newTag("COMPND",!0);for(var s=0;s<a.length;s++){var l=this._getMoleculeChains(a[s]);r.newString(),r.writeString("MOL_ID: ".concat(a[s].index,";"),11,80),r.newString(),r.writeString("MOLECULE: ".concat(a[s].name,";"),11,80),r.newString(),r.writeString("CHAIN: ",11,18);var c="".concat(l.join(", "),";");r.writeEntireString(c,81)}}}},{key:"_extractREMARK",value:function(r){this._Remark290(r),this._Remark350(r)}},{key:"_Remark290",value:function(r){if(this._source.symmetry&&this._source.symmetry.length!==0){var a=this._source.symmetry;r.newTag("REMARK",290),r.newString(),r.newString(),r.writeEntireString(this._stringForRemark290),r.writeMatrices(a,"SMTRY"),r.newString(),r.newString(),r.writeString("REMARK: NULL",11,80)}}},{key:"_Remark350",value:function(r){if(this._source.units){var a=this._source.units,s=0;r.newTag("REMARK",350),r.newString(),r.newString(),r.writeEntireString(this._stringForRemark350);for(var l=a.filter(function(p){return p instanceof Assembly$3}),c=0;c<l.length;c++){r.newString(),r.newString(),s++,r.writeString("BIOMOLECULE: ".concat(s),11,80);var u=l[c].chains.join(", ");r.newString(),r.writeString("APPLY THE FOLLOWING TO CHAINS: "),r.writeEntireString(u,69,{tag:"AND CHAINS: ",begin:31,end:42});var f=l[c].matrices;r.writeMatrices(f,"BIOMT")}}}},{key:"_getMoleculeChains",value:function(r){function a(l){return l._chain._name}var s=r.residues.map(a);return s.filter(function(l,c){return s.indexOf(l)===c})}}]),e}(Exporter);PDBExporter.formats=["pdb"];PDBExporter.SourceClass=Complex$9;var FBX_POS_SIZE=3,FBX_NORM_SIZE=3,FBX_COL_SIZE=4;function copyFbxPoint3(o,t,e,n){e[n]=o[t],e[n+1]=o[t+1],e[n+2]=o[t+2]}function copyFbxPoint4(o,t,e,n,r){e[n]=o[t],e[n+1]=o[t+1],e[n+2]=o[t+2],e[n+3]=r}var vector4=new Vector4;function copyTransformedPoint3(o,t,e,n,r){vector4.set(o[t],o[t+1],o[t+2],r.w),vector4.applyMatrix4(r.matrix),e[n]=vector4.x,e[n+1]=vector4.y,e[n+2]=vector4.z}function setSubArray(o,t,e,n,r){if(!((t.array.length-t.start)/t.stride<e||(o.array.length-o.start)/o.stride<e))if(o.stride===t.stride)t.array.set(o.array,t.start);else for(var a=t.start,s=o.start,l=0;l<e;++l,a+=t.stride,s+=o.stride)n(o.array,s,t.array,a,r)}var FBXModel=function(){function o(){_classCallCheck(this,o),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.lastPos=0,this.lastNorm=0,this.lastCol=0,this.lastIdx=0}return _createClass(o,[{key:"init",value:function(e,n){this.positions=new Float32Array(e*FBX_POS_SIZE),this.normals=new Float32Array(e*FBX_NORM_SIZE),this.colors=new Float32Array(e*FBX_COL_SIZE),this.indices=new Int32Array(n)}},{key:"setPositions",value:function(e,n,r,a){var s={array:e,start:n,stride:a},l={array:this.positions,start:this.lastPos,stride:FBX_POS_SIZE};setSubArray(s,l,r,copyFbxPoint3),this.lastPos+=r*FBX_POS_SIZE}},{key:"setTransformedPositions",value:function(e,n,r,a,s){for(var l=this.lastPos,c=n,u={matrix:s,w:1},f=0;f<r;++f,c+=a,l+=FBX_POS_SIZE)copyTransformedPoint3(e,c,this.positions,l,u);this.lastPos+=r*FBX_POS_SIZE}},{key:"setNormals",value:function(e,n,r,a){var s={array:e,start:n,stride:a},l={array:this.normals,start:this.lastNorm,stride:FBX_NORM_SIZE};setSubArray(s,l,r,copyFbxPoint3),this.lastNorm+=r*FBX_NORM_SIZE}},{key:"setTransformedNormals",value:function(e,n,r,a,s){for(var l=this.lastNorm,c=n,u={matrix:s,w:0},f=0;f<r;++f,c+=a,l+=FBX_NORM_SIZE)copyTransformedPoint3(e,c,this.normals,l,u);this.lastNorm+=r*FBX_NORM_SIZE}},{key:"setColors",value:function(e,n,r,a){var s={array:e,start:n,stride:a},l={array:this.colors,start:this.lastCol,stride:FBX_COL_SIZE};setSubArray(s,l,r,copyFbxPoint4,1),this.lastCol+=r*FBX_COL_SIZE}},{key:"setIndices",value:function(e,n,r){this.indices.set(e,this.lastIdx),this.lastIdx+=r}},{key:"setShiftedIndices",value:function(e,n,r){var a=e.map(function(s){return s+r});this.setIndices(a,0,n)}},{key:"getVerticesNumber",value:function(){return this.lastPos/FBX_POS_SIZE}},{key:"addInstance",value:function(e,n){var r=this.getVerticesNumber();this.setShiftedIndices(n.indices,n.indices.length,r);var a=n.itemSize;this.setTransformedPositions(n.positions,0,n.vertsCount,a.position,e),this.setTransformedNormals(n.normals,0,n.vertsCount,a.normal,e),this.setColors(n.colors,0,n.vertsCount,a.color)}}]),o}(),FBXGeometry=function(){function o(){_classCallCheck(this,o),this.positions=null,this.normals=null,this.colors=null,this.indices=null,this.vertsCount=0,this.itemSize=null}return _createClass(o,[{key:"init",value:function(e,n){var r=e.attributes;this.itemSize={position:r.position.itemSize,normal:r.normal.itemSize,color:r.color.itemSize}}}]),o}();function _createSuper$a(o){var t=_isNativeReflectConstruct$a();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$a(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FBX1CGeometry=function(o){_inherits(e,o);var t=_createSuper$a(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"init",value:function(r,a){_get(_getPrototypeOf(e.prototype),"init",this).call(this,r,a);var s=r.attributes,l=s.position,c=s.normal,u=r.index;this.vertsCount=l.count,this.positions=l.array,this.normals=c.array,this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this.indices=u.array}},{key:"setColors",value:function(r){for(var a=0,s=0,l=this.colors.length,c=this.itemSize.color;s<l;s+=c)this.colors[a++]=r.r,this.colors[a++]=r.g,this.colors[a++]=r.b}}]),e}(FBXGeometry);function _createSuper$9(o){var t=_isNativeReflectConstruct$9();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$9(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FBX2CCylinder=function(o){_inherits(e,o);var t=_createSuper$9(e);function e(){var n;return _classCallCheck(this,e),n=t.call(this),n._cutRawStart=0,n._cutRawEnd=0,n._facesPerSlice=0,n}return _createClass(e,[{key:"init",value:function(r,a){_get(_getPrototypeOf(e.prototype),"init",this).call(this,r,a);var s=r.attributes.position,l=r.index;this.vertsCount=s.count+a.addPerCylinder,this._facesPerSlice=a.addPerCylinder,this.positions=new Float32Array(this.vertsCount*s.itemSize),this.normals=new Float32Array(this.vertsCount*this.itemSize.normal),this.colors=new Float32Array(this.vertsCount*this.itemSize.color),this._extendVertices(r,a),this.indices=new Uint32Array(l.count),this._extendIndices(r,a)}},{key:"_extendVertices",value:function(r,a){var s=r.attributes.position,l=r.attributes.normal,c=r.getGeoParams(),u=1;this._cutRawStart=u*c.radialSegments,this._cutRawEnd=this._cutRawStart+a.addPerCylinder;{var f=s.array.slice(0,this._cutRawEnd*s.itemSize);this.positions.set(f,0),f=l.array.slice(0,this._cutRawEnd*l.itemSize),this.normals.set(f,0)}{var p=s.array.slice(this._cutRawStart*s.itemSize,s.array.length);this.positions.set(p,this._cutRawEnd*s.itemSize),p=l.array.slice(this._cutRawStart*l.itemSize,l.array.length),this.normals.set(p,this._cutRawEnd*l.itemSize)}}},{key:"_extendIndices",value:function(r,a){var s=r.index,l=6,c=a.addPerCylinder*l,u=a.addPerCylinder,f=s.array.slice(c,s.count);f=f.map(function(p){return p+u}),this.indices.set(s.array,0),this.indices.set(f,c)}},{key:"_setColorRange",value:function(r,a,s,l){for(var c=l.length,u=r;u<a;u+=c)s.set(l,u)}},{key:"setColors",value:function(r,a){var s=this.itemSize.color,l=this._cutRawEnd*s,c=l*2;if(this._setColorRange(0,l,this.colors,r.toArray()),this._setColorRange(l,c,this.colors,a.toArray()),c<this.colors.length){var u=(this._facesPerSlice+1)*s,f=c+u;this._setColorRange(c,f,this.colors,a.toArray());var p=f+u;this._setColorRange(f,p,this.colors,r.toArray())}}}]),e}(FBXGeometry),FBXInfoExtractor=function(){function o(){_classCallCheck(this,o),this._materials=[],this._models=[]}return _createClass(o,[{key:"process",value:function(e){this._extractModelsAndMaterials(e);var n=this._flattenModels();return{name:e.name,models:n,materials:this._materials}}},{key:"_extractModelsAndMaterials",value:function(e){var n=this,r=new Layers;r.set(gfxutils.LAYERS.DEFAULT),r.enable(gfxutils.LAYERS.TRANSPARENT),e.traverse(function(a){a instanceof Mesh&&a.layers.test(r)&&n.checkExportAbility(a)&&(a.geometry.type==="InstancedBufferGeometry"?n._collectInstancedGeoInfo(a):n._collectGeoInfo(a))})}},{key:"_reworkIndices",value:function(e){for(var n=3,r=n-1;r<e.length;r+=n)e[r]*=-1,e[r]--}},{key:"_flattenModels",value:function(){var e=0;function n(E){return E+e}for(var r=[],a=0,s=this._models.length;a<s;a++){var l=this._models[a],c=[],u=[],f=[],p=[];e=0;for(var g=0;g<l.length;g++){var y=l[g];c.push(y.indices.map(n)),e+=y.getVerticesNumber(),u.push(y.positions),f.push(y.normals),p.push(y.colors)}c=utils.mergeTypedArraysUnsafe(c),this._reworkIndices(c),u=utils.mergeTypedArraysUnsafe(u),f=utils.mergeTypedArraysUnsafe(f),p=utils.mergeTypedArraysUnsafe(p),r.push({indices:c,positions:u,normals:f,colors:p,verticesCount:e})}return r}},{key:"checkExportAbility",value:function(e){return e.geometry.attributes.position.count===0?!1:e instanceof ZSpriteMesh?(logger.warn("Currently we cannot export 'sprites' modes, like BS, WV, LC. Please turn of settings 'zSprites' and try again"),!1):e instanceof ThickLineMesh?(logger.warn("Currently we cannot export Lines mode"),!1):!0}},{key:"_collectGeoInfo",value:function(e){var n=e.geometry,r=n.attributes,a=r.position,s=r.color,l=r.normal,c=n.index,u=e.matrix,f=new FBXModel,p=a.count;f.init(p,c.count),u.isIdentity()?(f.setPositions(a.array,0,p,a.itemSize),f.setNormals(l.array,0,p,l.itemSize)):(f.setTransformedPositions(a.array,0,p,a.itemSize,u),f.setTransformedNormals(l.array,0,p,l.itemSize,u)),f.setColors(s.array,0,p,s.itemSize),f.setIndices(c.array,0,c.count);var g=this._collectMaterialInfo(e);this._addToPool(f,g)}},{key:"_collectSpheresInfo",value:function(e){var n=e.geometry,r=n.attributes,a=r.position,s=r.color,l=n.index,c=e.matrix,u=new FBXModel,f=e.geometry.instanceCount,p=a.count,g=l.count;u.init(f*p,f*g);var y=new FBX1CGeometry;y.init(e.geometry);for(var E=new Matrix4,h=new Matrix4,v=new Color,C=0;C<f;++C){var x=C*s.itemSize;v.fromArray(s.array,x),y.setColors(v),this._getSphereInstanceMatrix(e.geometry,C,E),h.multiplyMatrices(c,E),u.addInstance(h,y)}var w=this._collectMaterialInfo(e);this._addToPool(u,w)}},{key:"_collectCylindersInfo",value:function(e){var n=e.geometry,r=n.attributes,a=r.position,s=r.color,l=r.color2,c=n.index,u=e.matrix,f=new FBXModel,p=e.geometry.instanceCount,g=new FBX1CGeometry;g.init(e.geometry);var y=this._gatherCylindersColoringInfo(e.geometry),E=null;y.needToSplit>0&&(E=new FBX2CCylinder,E.init(e.geometry,y));var h=y.addPerCylinder*y.needToSplit,v=a.count,C=c.count;f.init(p*v+h,p*C);for(var x=new Matrix4,w=new Matrix4,_=new Color,S=new Color,M={},T=0;T<p;++T){var R=T*s.itemSize;y.is2Colored[T]?(_.fromArray(l.array,R),S.fromArray(s.array,R),E&&(E.setColors(_,S),M=E)):(_.fromArray(s.array,R),g.setColors(_),M=g),this._getCylinderInstanceMatrix(e.geometry,T,x),w.multiplyMatrices(u,x),f.addInstance(w,M)}var P=this._collectMaterialInfo(e);this._addToPool(f,P)}},{key:"_addToPool",value:function(e,n){var r=this._checkExistingMaterial(n);if(r<0)this._models.push([e]),this._materials.push(n);else{var a=this._models[r];a.push(e)}}},{key:"_checkExistingMaterial",value:function(e){return lodashExports.findIndex(this._materials,function(n){return lodashExports.isEqual(n,e)})}},{key:"_gatherCylindersColoringInfo",value:function(e){for(var n=e.instanceCount,r=e.attributes.color.array,a=e.attributes.color2.array,s=e.attributes.color.itemSize,l=new Array(n),c=0,u=0,f=0;f<n;f++,u+=s){var p=Math.abs(r[u]-a[u])>1e-7||Math.abs(r[u+1]-a[u+1])>1e-7||Math.abs(r[u+2]-a[u+2])>1e-7;l[f]=p,c+=p}var g=e.getGeoParams(),y=g.radialSegments;return{is2Colored:l,needToSplit:c,addPerCylinder:y}}},{key:"_collectInstancedGeoInfo",value:function(e){e.geometry instanceof InstancedSpheresGeometry?this._collectSpheresInfo(e):e.geometry instanceof Instanced2CCylindersGeometry&&this._collectCylindersInfo(e)}},{key:"_collectMaterialInfo",value:function(e){var n=e.material.uberOptions;return{diffuse:n.diffuse.toArray(),opacity:n.opacity,shininess:n.shininess,specular:n.specular.toArray()}}},{key:"_getCylinderInstanceMatrix",value:function(e,n,r){var a=e.attributes.matVector1.array,s=e.attributes.matVector2.array,l=e.attributes.matVector3.array,c=n*4;r.set(a[c],a[c+1],a[c+2],a[c+3],s[c],s[c+1],s[c+2],s[c+3],l[c],l[c+1],l[c+2],l[c+3],0,0,0,1)}},{key:"_getSphereInstanceMatrix",value:function(e,n,r){var a=e.attributes.offset,s=n*a.itemSize,l=a.array[s],c=a.array[s+1],u=a.array[s+2],f=a.array[s+3];r.set(f,0,0,l,0,f,0,c,0,0,f,u,0,0,0,1)}}]),o}(),defaultDefinitions=`
Definitions:  {
  Version: 100
  Count: 3
  ObjectType: "Model" {
    Count: 1
  }
  ObjectType: "Geometry" {
    Count: 1
  }
  ObjectType: "Material" {
    Count: 1
  }
  ObjectType: "Pose" {
    Count: 1
  }
  ObjectType: "GlobalSettings" {
    Count: 1
  }
} `,defaultProperties=`Properties60: {
      Property: "QuaternionInterpolate", "bool", "",0
      Property: "Visibility", "Visibility", "A",1
      Property: "Lcl Translation", "Lcl Translation", "A",0.000000000000000,0.000000000000000,-1789.238037109375000
      Property: "Lcl Rotation", "Lcl Rotation", "A",0.000009334667643,-0.000000000000000,0.000000000000000
      Property: "Lcl Scaling", "Lcl Scaling", "A",1.000000000000000,1.000000000000000,1.000000000000000
      Property: "RotationOffset", "Vector3D", "",0,0,0
      Property: "RotationPivot", "Vector3D", "",0,0,0
      Property: "ScalingOffset", "Vector3D", "",0,0,0
      Property: "ScalingPivot", "Vector3D", "",0,0,0
      Property: "TranslationActive", "bool", "",0
      Property: "TranslationMin", "Vector3D", "",0,0,0
      Property: "TranslationMax", "Vector3D", "",0,0,0
      Property: "TranslationMinX", "bool", "",0
      Property: "TranslationMinY", "bool", "",0
      Property: "TranslationMinZ", "bool", "",0
      Property: "TranslationMaxX", "bool", "",0
      Property: "TranslationMaxY", "bool", "",0
      Property: "TranslationMaxZ", "bool", "",0
      Property: "RotationOrder", "enum", "",0
      Property: "RotationSpaceForLimitOnly", "bool", "",0
      Property: "AxisLen", "double", "",10
      Property: "PreRotation", "Vector3D", "",0,0,0
      Property: "PostRotation", "Vector3D", "",0,0,0
      Property: "RotationActive", "bool", "",0
      Property: "RotationMin", "Vector3D", "",0,0,0
      Property: "RotationMax", "Vector3D", "",0,0,0
      Property: "RotationMinX", "bool", "",0
      Property: "RotationMinY", "bool", "",0
      Property: "RotationMinZ", "bool", "",0
      Property: "RotationMaxX", "bool", "",0
      Property: "RotationMaxY", "bool", "",0
      Property: "RotationMaxZ", "bool", "",0
      Property: "RotationStiffnessX", "double", "",0
      Property: "RotationStiffnessY", "double", "",0
      Property: "RotationStiffnessZ", "double", "",0
      Property: "MinDampRangeX", "double", "",0
      Property: "MinDampRangeY", "double", "",0
      Property: "MinDampRangeZ", "double", "",0
      Property: "MaxDampRangeX", "double", "",0
      Property: "MaxDampRangeY", "double", "",0
      Property: "MaxDampRangeZ", "double", "",0
      Property: "MinDampStrengthX", "double", "",0
      Property: "MinDampStrengthY", "double", "",0
      Property: "MinDampStrengthZ", "double", "",0
      Property: "MaxDampStrengthX", "double", "",0
      Property: "MaxDampStrengthY", "double", "",0
      Property: "MaxDampStrengthZ", "double", "",0
      Property: "PreferedAngleX", "double", "",0
      Property: "PreferedAngleY", "double", "",0
      Property: "PreferedAngleZ", "double", "",0
      Property: "InheritType", "enum", "",0
      Property: "ScalingActive", "bool", "",0
      Property: "ScalingMin", "Vector3D", "",1,1,1
      Property: "ScalingMax", "Vector3D", "",1,1,1
      Property: "ScalingMinX", "bool", "",0
      Property: "ScalingMinY", "bool", "",0
      Property: "ScalingMinZ", "bool", "",0
      Property: "ScalingMaxX", "bool", "",0
      Property: "ScalingMaxY", "bool", "",0
      Property: "ScalingMaxZ", "bool", "",0
      Property: "GeometricTranslation", "Vector3D", "",0,0,0
      Property: "GeometricRotation", "Vector3D", "",0,0,0
      Property: "GeometricScaling", "Vector3D", "",1,1,1
      Property: "LookAtProperty", "object", ""
      Property: "UpVectorProperty", "object", ""
      Property: "Show", "bool", "",1
      Property: "NegativePercentShapeSupport", "bool", "",1
      Property: "DefaultAttributeIndex", "int", "",0
      Property: "Color", "Color", "A+",0,0,0
      Property: "Size", "double", "",100
      Property: "Look", "enum", "",1
    }`,defaultMaterialLayer=`
    LayerElementMaterial: 0 {
      Version: 101
      Name: ""
      MappingInformationType: "AllSame"
      ReferenceInformationType: "Direct"
      Materials: 0
    }`,defaultLayerBlock=`
    Layer: 0 {
      Version: 100
      LayerElement:  {
        Type: "LayerElementNormal"
        TypedIndex: 0
      }
      LayerElement:  {
        Type: "LayerElementColor"
        TypedIndex: 0
      }
      LayerElement:  {
        Type: "LayerElementMaterial"
        TypedIndex: 0
      }
    }`,globalSettings=`GlobalSettings: {
    Version: 1000
    Properties60:  {
      Property: "UpAxis", "int", "",1
      Property: "UpAxisSign", "int", "",1
      Property: "FrontAxis", "int", "",2
      Property: "FrontAxisSign", "int", "",1
      Property: "CoordAxis", "int", "",0
      Property: "CoordAxisSign", "int", "",1
      Property: "UnitScaleFactor", "double", "",1
    }
  }`,FBXResult=function(){function o(){_classCallCheck(this,o),this._resultArray=[],this._info=null}return _createClass(o,[{key:"getResult",value:function(e){return this._info=e,this._resultArray.push(this._writeHeader()),this._resultArray.push(this._writeDefinitions()),this._resultArray.push(this._writeObjects(e.models,e.materials)),this._resultArray.push(this._writeRelations()),this._resultArray.push(this._writeConnections()),this._info=null,this._resultArray.join("")}},{key:"_writeHeader",value:function(){var e=1003,n=6100,r=new Date,a=1e3,s="Miew FBX Exporter v".concat(this._info.version);return`; FBX 6.1.0 project file
; Created by `.concat(s,` Copyright (c) 2015-2020 EPAM Systems, Inc.
; For support please contact miew@epam.com
; ----------------------------------------------------

FBXHeaderExtension:  {
  FBXHeaderVersion: `).concat(e,`
  FBXVersion: `).concat(n,`
  CreationTimeStamp:  {
    Version: `).concat(a,`
    Year: `).concat(r.getFullYear(),`
    Month: `).concat(r.getMonth()+1,` 
    Day: `).concat(r.getDate(),`
    Hour: `).concat(r.getHours(),`
    Minute: `).concat(r.getMinutes(),`
    Second: `).concat(r.getSeconds(),`
    Millisecond: `).concat(r.getMilliseconds(),`
  }
  Creator: "`).concat(s,`"
  OtherFlags:  {
    FlagPLE: 0
  }
}
CreationTime: "`).concat(r,`"
Creator: "`).concat(s,`"  
`)}},{key:"_writeDefinitions",value:function(){return`
; Object definitions
;------------------------------------------------------------------

`.concat(defaultDefinitions,`
`)}},{key:"_models",value:function(){for(var e=232,n="",r=this._info.models,a=0;a<r.length;++a){var s=r[a],l=s.verticesCount;n+=`
  Model: "Model::`.concat(this._info.name,"_").concat(a,`", "Mesh" {
    Version: `).concat(e,` 
    `).concat(defaultProperties,`
    `).concat(this._verticesIndices(s.positions,s.indices),`
    `).concat(this._normalLayer(s.normals),` 
    `).concat(this._colorLayer(s.colors,l),` 
    `).concat(defaultMaterialLayer,`  
    `).concat(defaultLayerBlock,`
  }`)}return n}},{key:"_materials",value:function(){for(var e=102,n="",r=this._info.materials,a=0;a<r.length;++a){var s=r[a];n+=`
  Material: "Material::`.concat(this._info.name,"_").concat(a,`_default", "" {
    Version: `).concat(e,`
    ShadingModel: "lambert"
    MultiLayer: 0
    `).concat(this._materialProperties(s),`
  }`)}return n}},{key:"_writeObjects",value:function(){return`
; Object properties
;------------------------------------------------------------------

Objects:  {
  `.concat(this._models(),`
  `).concat(this._materials(),`
  `).concat(globalSettings,`
}
`)}},{key:"_writeRelations",value:function(){for(var e="",n=0;n<this._info.models.length;++n)e+=`
  Model: "Model::`.concat(this._info.name,"_").concat(n,`", "Mesh" {
  }`);for(var r="",a=0;a<this._info.materials.length;++a)r+=`
  Material: "Material::`.concat(this._info.name,"_").concat(a,`_default", "" {
  }`);return`
; Object relations
;------------------------------------------------------------------

Relations:  {
  `.concat(e,`
  Model: "Model::Producer Perspective", "Camera" {
  }
  Model: "Model::Producer Top", "Camera" {
  }
  Model: "Model::Producer Bottom", "Camera" {
  }
  Model: "Model::Producer Front", "Camera" {
  }
  Model: "Model::Producer Back", "Camera" {
  }
  Model: "Model::Producer Right", "Camera" {
  }
  Model: "Model::Producer Left", "Camera" {
  }
  Model: "Model::Camera Switcher", "CameraSwitcher" {
  }
  `).concat(r,`
}`)}},{key:"_writeConnections",value:function(){for(var e="",n=this._info.name,r=0;r<this._info.models.length;++r)e+=`
  Connect: "OO", "Model::`.concat(n,"_").concat(r,'", "Model::Scene"');for(var a="",s=0;s<this._info.materials.length;++s)a+=`
  Connect: "OO", "Material::`.concat(n,"_").concat(s,'_default", "Model::').concat(n,"_").concat(s,'"');return`
; Object connections
;------------------------------------------------------------------

Connections:  {
  `.concat(e,`
  `).concat(a,`
}`)}},{key:"_floatArrayToString",value:function(e){for(var n=[],r=0;r<e.length;++r)n[r]=e[r].toFixed(6);return n.join(",")}},{key:"_colorLayer",value:function(e,n){var r=0,a=101,s="",l=this._floatArrayToString(e),c=_toConsumableArray(Array(n).keys());return`
    LayerElementColor: `.concat(r,` {
      Version: `).concat(a,`
      Name: "`).concat(s,`"
      MappingInformationType: "ByVertice"
      ReferenceInformationType: "Direct"
      Colors: `).concat(l,`
      ColorIndex: `).concat(c,`
    }`)}},{key:"_normalLayer",value:function(e){var n=0,r=101,a="",s=this._floatArrayToString(e);return`
    LayerElementNormal: `.concat(n,` {
      Version: `).concat(r,`
      Name: "`).concat(a,`"
      MappingInformationType: "ByVertice"
      ReferenceInformationType: "Direct" 
      Normals: `).concat(s,`
    }`)}},{key:"_verticesIndices",value:function(e,n){var r=0,a=1,s="Y",l="CullingOff",c=124,u=this._floatArrayToString(e);return"MultiLayer: ".concat(r,`
    MultiTake: `).concat(a,`
    Shading: `).concat(s,`
    Culling: "`).concat(l,`"
    Vertices: `).concat(u,`
    PolygonVertexIndex: `).concat(n,`
    GeometryVersion: `).concat(c)}},{key:"_materialProperties",value:function(e){return`Properties60:  {
      Property: "ShadingModel", "KString", "", "Lambert"
      Property: "MultiLayer", "bool", "",0
      Property: "EmissiveColor", "ColorRGB", "",0,0,0
      Property: "EmissiveFactor", "double", "",0.0000
      Property: "AmbientColor", "ColorRGB", "",1,1,1
      Property: "AmbientFactor", "double", "",0.0000
      Property: "DiffuseColor", "ColorRGB", "",`.concat(e.diffuse,`
      Property: "DiffuseFactor", "double", "",1.0000
      Property: "Bump", "Vector3D", "",0,0,0
      Property: "TransparentColor", "ColorRGB", "",1,1,1
      Property: "TransparencyFactor", "double", "",0.0000
      Property: "SpecularColor", "ColorRGB", "",`).concat(e.specular,`
      Property: "SpecularFactor", "double", "",1.0000
      Property: "ShininessExponent", "double", "",`).concat(e.shininess,`
      Property: "ReflectionColor", "ColorRGB", "",0,0,0
      Property: "ReflectionFactor", "double", "",1
      Property: "Ambient", "ColorRGB", "",1,1,1
      Property: "Diffuse", "ColorRGB", "",`).concat(e.diffuse,`
      Property: "Specular", "ColorRGB", "",`).concat(e.specular,`
      Property: "Shininess", "double", "",`).concat(e.shininess,`
      Property: "Opacity", "double", "",`).concat(e.opacity,`
      Property: "Reflectivity", "double", "",0
    }`)}}]),o}();function _createSuper$8(o){var t=_isNativeReflectConstruct$8();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FBXExporter=function(o){_inherits(e,o);var t=_createSuper$8(e);function e(n,r){var a;return _classCallCheck(this,e),a=t.call(this,n,r),a._data=n,a._version=r.miewVersion||"0.0-UNSPECIFIED",a._extractor=new FBXInfoExtractor,a}return _createClass(e,[{key:"exportSync",value:function(){var r=new FBXResult;if(!this._source)return this._result;var a=this._extractor.process(this._data);return a.version=this._version,this._result=r.getResult(a),this._result}}]),e}(Exporter);FBXExporter.formats=["fbx"];FBXExporter.SourceClass=ComplexVisual;var exporters=new ExporterList([PDBExporter,FBXExporter]),io={loaders,parsers,exporters},tempColor=new Color,CSS2DRenderer=function(){function o(){_classCallCheck(this,o),this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this._vector=new Vector3,this._viewMatrix=new Matrix4,this._projectionMatrix=new Matrix4,this._domElement=document.createElement("div"),this._domElement.style.overflow="hidden",this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.zIndex="0",this._domElement.style.pointerEvents="none"}return _createClass(o,[{key:"getElement",value:function(){return this._domElement}},{key:"reset",value:function(){for(var e=this.getElement();e.firstChild;)e.removeChild(e.firstChild)}},{key:"setSize",value:function(e,n){this._width=e,this._height=n,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this._domElement.style.width="".concat(e,"px"),this._domElement.style.height="".concat(n,"px")}},{key:"_renderObject",value:function(e,n,r){function a(h,v,C){return tempColor.setHex(h),tempColor.lerp(v,C),"#".concat(tempColor.getHexString())}function s(h){return tempColor.setHex(h),"#".concat(tempColor.getHexString())}if(e instanceof CSS2DObject){if(this._vector.setFromMatrixPosition(e.matrixWorld),e.userData!==void 0&&e.userData.offset!==void 0){var l=new Vector3(e.userData.offset.x,e.userData.offset.y,0);this._vector.add(l.multiplyScalar(e.matrixWorld.getMaxScaleOnAxis()))}this._vector.applyMatrix4(this._viewMatrix);var c=this._vector.z>-n.near?"hidden":"visible",u=1e4*(n.far- -this._vector.z)/(n.far-n.near),f=e.getElement();if(typeof r.fog>"u")f.style.color=s(e.userData.color),e.userData.background!=="transparent"&&(f.style.background=s(e.userData.background));else{var p=MathUtils.smoothstep(-this._vector.z,r.fog.near,r.fog.far);f.style.color=a(e.userData.color,r.fog.color,p),e.userData.background!=="transparent"&&(f.style.background=a(e.userData.background,r.fog.color,p))}this._vector.applyMatrix4(this._projectionMatrix);var g="".concat(e.userData!=={}?e.userData.translation:"translate(-50%, -50%) ","translate(").concat(this._vector.x*this._widthHalf+this._widthHalf,"px,").concat(-this._vector.y*this._heightHalf+this._heightHalf,"px)");f.style.visibility=c,f.style.WebkitTransform=g,f.style.MozTransform=g,f.style.oTransform=g,f.style.transform=g,f.style.zIndex=Number(u).toFixed(0),f.parentNode!==this._domElement&&this._domElement.appendChild(f)}for(var y=0,E=e.children.length;y<E;y++)this._renderObject(e.children[y],n,r)}},{key:"render",value:function(e,n){e.updateMatrixWorld(),n.parent===null&&n.updateMatrixWorld(),n.matrixWorldInverse.copy(n.matrixWorld).invert(),this._viewMatrix.copy(n.matrixWorldInverse),this._projectionMatrix.copy(n.projectionMatrix),this._renderObject(e,n,e)}}]),o}(),VK_LEFT=37,VK_UP=38,VK_RIGHT=39,VK_DOWN=40,STATE={NONE:-1,ROTATE:0,TRANSLATE:1,SCALE:2,TRANSLATE_PIVOT:3},FULL_STOP_THRESHOLD=.1,quaternion=new Quaternion,matrix4=new Matrix4;function ObjectHandler(o,t,e,n){this.objects=o;var r=_slicedToArray(o,1);this.object=r[0],this.camera=t,this.pivot=e,this.axis=new Vector3(0,0,1),this.options=n,this.lastRotation={axis:new Vector3,angle:0}}ObjectHandler.prototype._rotate=function(){var o=new Vector3,t=new Quaternion,e=new Vector3,n=new Matrix4;return function(r){var a=this.pivot.x===0&&this.pivot.y===0&&this.pivot.z===0;if(n.copy(this.object.matrix),a?n.multiply(matrix4.makeRotationFromQuaternion(r)):(n.multiply(matrix4.makeTranslation(this.pivot.x,this.pivot.y,this.pivot.z)),n.multiply(matrix4.makeRotationFromQuaternion(r)),n.multiply(matrix4.makeTranslation(-this.pivot.x,-this.pivot.y,-this.pivot.z))),n.decompose(o,t,e),!a)for(var s=0;s<this.objects.length;++s)this.objects[s].position.copy(o);for(var l=0;l<this.objects.length;++l)this.objects[l].quaternion.copy(t),this.objects[l].updateMatrix()}}();ObjectHandler.prototype.setObjects=function(o){this.objects=o;var t=_slicedToArray(o,1);this.object=t[0]};ObjectHandler.prototype.rotate=function(){var o={axis:new Vector3,angle:0};return function(t,e,n,r){this.mouse2rotation(o,e,n,r),t.setFromAxisAngle(o.axis,o.angle),o.angle&&this._rotate(t),this.lastRotation=o}}();ObjectHandler.prototype.translate=function(){var o=new Vector3,t=new Vector3;return function(e){o.set(e.x/this.camera.projectionMatrix.elements[0],e.y/this.camera.projectionMatrix.elements[5],0);var n=o.length();o.normalize(),o.transformDirection(matrix4.copy(this.object.matrixWorld).invert()),t.copy(this.pivot),this.object.localToWorld(t),n*=Math.abs(t.z-this.camera.position.z),n/=this.object.matrixWorld.getMaxScaleOnAxis();for(var r=0;r<this.objects.length;++r)this.objects[r].translateOnAxis(o,n)}}();ObjectHandler.prototype.update=function(){var o=new Vector3;return function(t,e){if(settings$1.now.autoRotation!==0)return settings$1.now.autoRotationAxisFixed||this.lastRotation.axis.length()===0?o.set(0,1,0).transformDirection(matrix4.copy(this.object.matrixWorld).invert()):o.copy(this.lastRotation.axis),this._rotate(quaternion.setFromAxisAngle(o,settings$1.now.autoRotation*t)),!0;if(this.options.intertia&&this.lastRotation.angle){var n=this.lastRotation.angle*Math.pow(1-this.options.dynamicDampingFactor,40*e);if(Math.abs(n)<=this.options.intertiaThreshold)this.lastRotation.angle=0;else return this._rotate(quaternion.setFromAxisAngle(this.lastRotation.axis,n)),!0}return!1}}();ObjectHandler.prototype.stop=function(){this.lastRotation.angle=0};ObjectHandler.prototype.mouse2rotation=function(){var o=new Vector3,t=new Vector3,e=new Vector3,n=new Vector3,r=new Vector3,a=new Vector3,s=new Vector2;return function(l,c,u,f){if(f)l.axis.copy(this.axis),l.angle=this.options.axisRotateFactor*(u.y-c.y);else{s.subVectors(u,c);var p=s.length();if(p===0)return;o.copy(this.pivot),this.object.localToWorld(o),t.subVectors(this.camera.position,o),e.copy(t).normalize(),n.copy(this.camera.up).normalize(),r.crossVectors(n,e).normalize(),n.setLength(s.y),r.setLength(s.x),a.copy(n.add(r)),l.axis.crossVectors(a,t),l.angle=-p*this.options.rotateFactor}l.axis.transformDirection(matrix4.copy(this.object.matrixWorld).invert()),l.angle<0&&(l.axis.negate(),l.angle=-l.angle)}}();function ObjectControls(o,t,e,n,r){EventDispatcher.call(this);var a=this;this.object=o,this.objectPivot=t,this.camera=e,this.domElement=typeof n<"u"?n:document,this.getAltObj=r,this.enabled=!0,this.hotkeysEnabled=!0,this.screen={left:0,top:0,width:0,height:0},this.options={rotateFactor:Math.PI,axisRotateFactor:4*Math.PI,intertia:!0,dynamicDampingFactor:.1,intertiaThreshold:.001},this._state=STATE.NONE,this._mousePrevPos=new Vector2,this._mouseCurPos=new Vector2,this._mainObj=new ObjectHandler([this.object],this.camera,new Vector3(0,0,0),this.options),this._altObj=new ObjectHandler([this.object],this.camera,new Vector3(0,0,0),this.options),this._affectedObj=this._mainObj,this._isAltObjFreeRotationAllowed=!0,this._isTranslationAllowed=!0,this._isKeysTranslatingObj=!1,this._pressedKeys=[],this._clock=new Timer,this._clock.start(),this._lastUpdateTime=this._clock.getElapsedTime(),this._listeners=[{obj:a.domElement,type:"mousedown",handler:function(u){a.mousedown(u)}},{obj:a.domElement,type:"mouseup",handler:function(u){a.mouseup(u)}},{obj:a.domElement,type:"mousemove",handler:function(u){a.mousemove(u)}},{obj:a.domElement,type:"mousewheel",handler:function(u){a.mousewheel(u)}},{obj:a.domElement,type:"DOMMouseScroll",handler:function(u){a.mousewheel(u)}},{obj:a.domElement,type:"mouseout",handler:function(u){a.mouseup(u)}},{obj:a.domElement,type:"touchstart",handler:function(u){a.touchstartend(u)}},{obj:a.domElement,type:"touchend",handler:function(u){a.touchstartend(u)}},{obj:a.domElement,type:"touchmove",handler:function(u){a.touchmove(u)}},{obj:a.getKeyBindObject(),type:"keydown",handler:function(u){a.keydownup(u)}},{obj:a.getKeyBindObject(),type:"keyup",handler:function(u){a.keydownup(u)}},{obj:window,type:"resize",handler:function(){a.handleResize()}},{obj:window,type:"blur",handler:function(){a.resetKeys()}},{obj:a.domElement,type:"contextmenu",handler:function(u){a.contextmenu(u)}}];for(var s=0;s<this._listeners.length;s++){var l=this._listeners[s];l.obj.addEventListener(l.type,l.handler)}this.handleResize(),this.resetKeys(),this.update()}ObjectControls.prototype=Object.create(EventDispatcher.prototype);ObjectControls.prototype.constructor=ObjectControls;ObjectControls.prototype.resetKeys=function(){this._pressedKeys[VK_LEFT]=!1,this._pressedKeys[VK_UP]=!1,this._pressedKeys[VK_RIGHT]=!1,this._pressedKeys[VK_DOWN]=!1};ObjectControls.prototype.contextmenu=function(o){o.stopPropagation(),o.preventDefault()};ObjectControls.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var o=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=o.left+window.pageXOffset-t.clientLeft,this.screen.top=o.top+window.pageYOffset-t.clientTop,this.screen.width=o.width,this.screen.height=o.height}};ObjectControls.prototype.enable=function(o){this.enabled=o};ObjectControls.prototype.enableHotkeys=function(o){this.hotkeysEnabled=o};ObjectControls.prototype.allowTranslation=function(o){this._isTranslationAllowed=o};ObjectControls.prototype.allowAltObjFreeRotation=function(o){this._isAltObjFreeRotationAllowed=o};ObjectControls.prototype.keysTranslateObj=function(o){this._isKeysTranslatingObj=o};ObjectControls.prototype.isEditingAltObj=function(){return(this._state===STATE.ROTATE||this._state===STATE.TRANSLATE)&&this._affectedObj===this._altObj};ObjectControls.prototype.convertMouseToOnCircle=function(o,t,e){var n=Math.min(this.screen.width,this.screen.height);if(n===0){o.set(0,0);return}o.set((t-this.screen.width*.5-this.screen.left)/n,(.5*this.screen.height+this.screen.top-e)/n)};ObjectControls.prototype.convertMouseToViewport=function(o,t,e){if(this.screen.width===0||this.screen.height===0){o.set(0,0);return}o.set(2*(t-this.screen.width*.5-this.screen.left)/this.screen.width,2*(.5*this.screen.height+this.screen.top-e)/this.screen.height)};ObjectControls.prototype.stop=function(){this._mainObj.stop(),this._altObj.stop()};ObjectControls.prototype.rotateByMouse=function(){var o=new Quaternion;return function(t){this._affectedObj.rotate(o,this._mousePrevPos,this._mouseCurPos,t),this.dispatchEvent({type:"change",action:"rotate",quaternion:o})}}();ObjectControls.prototype.rotate=function(o){this.object.quaternion.multiply(o),this.dispatchEvent({type:"change",action:"rotate",quaternion:o})};ObjectControls.prototype.getOrientation=function(){return this.object.quaternion};ObjectControls.prototype.setOrientation=function(o){this.object.quaternion.copy(o)};ObjectControls.prototype.translate=function(){var o=new Vector2;return function(){o.subVectors(this._mouseCurPos,this._mousePrevPos),this._affectedObj.translate(o),this.dispatchEvent({type:"change",action:"translate"})}}();ObjectControls.prototype.getScale=function(){return this.object.scale.x};ObjectControls.prototype.setScale=function(o){this.object.scale.set(o,o,o)};ObjectControls.prototype.scale=function(o){o<=0||(this.setScale(this.object.scale.x*o),this.dispatchEvent({type:"change",action:"zoom",factor:o}))};ObjectControls.prototype.update=function(){var o=new Vector2;return function(){var t=this._clock.getElapsedTime(),e=t-this._lastUpdateTime;if(this._state===STATE.NONE){var n=t-this._lastMouseMoveTime;(this._mainObj.update(e,n)||this._altObj.update(e,n))&&this.dispatchEvent({type:"change",action:"auto"})}if(this._isKeysTranslatingObj){var r=Number(this._pressedKeys[VK_RIGHT])-Number(this._pressedKeys[VK_LEFT]),a=Number(this._pressedKeys[VK_UP])-Number(this._pressedKeys[VK_DOWN]);if(r!==0||a!==0){var s=e,l=this.getAltObj();l.objects.length>0&&(this._altObj.setObjects(l.objects),this._altObj.pivot=l.pivot,"axis"in l?this._altObj.axis=l.axis.clone():this._altObj.axis.set(0,0,1),o.set(s*r,s*a),this._altObj.translate(o),this.dispatchEvent({type:"change",action:"translate"}))}}this._lastUpdateTime=t}}();ObjectControls.prototype.reset=function(){this._state=STATE.NONE,this.object.quaternion.copy(quaternion.set(0,0,0,1))};ObjectControls.prototype.mousedown=function(o){if(!(this.enabled===!1||this._state!==STATE.NONE)){if(o.preventDefault(),o.stopPropagation(),this._state===STATE.NONE)if(o.button===0){this._affectedObj.stop();var t=!1;if(o.altKey){var e=this.getAltObj();t=e.objects.length>0,t&&(this._altObj.setObjects(e.objects),this._altObj.pivot=e.pivot,"axis"in e?this._altObj.axis=e.axis.clone():this._altObj.axis.set(0,0,1))}this._affectedObj=t?this._altObj:this._mainObj,this._state=t&&o.ctrlKey&&this._isTranslationAllowed?STATE.TRANSLATE:STATE.ROTATE}else o.button===2&&(this._state=STATE.TRANSLATE_PIVOT);this._state===STATE.ROTATE&&(this.convertMouseToOnCircle(this._mouseCurPos,o.pageX,o.pageY),this._mousePrevPos.copy(this._mouseCurPos)),(this._state===STATE.TRANSLATE||this._state===STATE.TRANSLATE_PIVOT)&&(this.convertMouseToViewport(this._mouseCurPos,o.pageX,o.pageY),this._mousePrevPos.copy(this._mouseCurPos))}};ObjectControls.prototype.mousemove=function(o){if(!(this.enabled===!1||this._state===STATE.NONE))switch(o.preventDefault(),o.stopPropagation(),this._state){case STATE.ROTATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,o.pageX,o.pageY),this.rotateByMouse(o.altKey&&!this._isAltObjFreeRotationAllowed||o.shiftKey),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case STATE.TRANSLATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,o.pageX,o.pageY),this.translate();break;case STATE.TRANSLATE_PIVOT:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToViewport(this._mouseCurPos,o.pageX,o.pageY),this.translatePivotByMouse();break}};ObjectControls.prototype.mousewheel=function(o){if(!(this.enabled===!1||!settings$1.now.zooming||this._state!==STATE.NONE||o.shiftKey)){o.preventDefault();var t=0;o.wheelDelta?t=o.wheelDelta/40:o.detail&&(t=-o.detail/3);var e=1+t*.05;e=Math.max(e,.01),this.scale(e)}};ObjectControls.prototype.mouseup=function(o){this.enabled===!1||this._state===STATE.NONE||(o.preventDefault(),o.stopPropagation(),this._state=STATE.NONE,this._clock.getElapsedTime()-this._lastMouseMoveTime>FULL_STOP_THRESHOLD&&this._affectedObj.stop())};ObjectControls.prototype.touchstartend=function(o){if(this.enabled!==!1)switch(o.preventDefault(),o.stopPropagation(),o.touches.length){case 1:this._state=STATE.ROTATE,this.convertMouseToOnCircle(this._mouseCurPos,o.touches[0].pageX,o.touches[0].pageY),this._mousePrevPos.copy(this._mouseCurPos);break;case 2:{this._mainObj.stop(),this._altObj.stop(),this._state=STATE.SCALE;var t=o.touches[0].pageX-o.touches[1].pageX,e=o.touches[0].pageY-o.touches[1].pageY;this._touchDistanceCur=this._touchDistanceStart=Math.sqrt(t*t+e*e),this._scaleStart=this.object.scale.x;break}default:this._state=STATE.NONE}};ObjectControls.prototype.touchmove=function(o){if(!(this.enabled===!1||this._state===STATE.NONE))switch(o.preventDefault(),o.stopPropagation(),this._state){case STATE.ROTATE:this._mousePrevPos.copy(this._mouseCurPos),this.convertMouseToOnCircle(this._mouseCurPos,o.touches[0].pageX,o.touches[0].pageY),this.rotateByMouse(!1),this._lastMouseMoveTime=this._clock.getElapsedTime();break;case STATE.SCALE:if(settings$1.now.zooming){var t=o.touches[0].pageX-o.touches[1].pageX,e=o.touches[0].pageY-o.touches[1].pageY;this._touchDistanceCur=Math.sqrt(t*t+e*e);var n=this._scaleStart*this._touchDistanceCur/this._touchDistanceStart,r=n/this.object.scale.x;this.scale(r)}break}};ObjectControls.prototype.keydownup=function(o){if(!(this.enabled===!1||this.hotkeysEnabled===!1))switch(o.keyCode){case VK_LEFT:case VK_UP:case VK_RIGHT:case VK_DOWN:this._pressedKeys[o.keyCode]=o.type==="keydown",o.preventDefault(),o.stopPropagation();break}};ObjectControls.prototype.getKeyBindObject=function(){return window.top};ObjectControls.prototype.dispose=function(){for(var o=0;o<this._listeners.length;o++){var t=this._listeners[o];t.obj.removeEventListener(t.type,t.handler)}};ObjectControls.prototype.translatePivotByMouse=function(){var o=new Vector2;return function(){o.subVectors(this._mouseCurPos,this._mousePrevPos),this.translatePivotInWorld(settings$1.now.translationSpeed*o.x,settings$1.now.translationSpeed*o.y,0)}}();ObjectControls.prototype.translatePivotInWorld=function(o,t,e){var n=this.objectPivot.position;n.applyMatrix4(this.object.matrixWorld),n.setX(n.x+o),n.setY(n.y+t),n.setZ(n.z+e),n.applyMatrix4(matrix4.copy(this.object.matrixWorld).invert()),this.dispatchEvent({type:"change",action:"translatePivot"})};ObjectControls.prototype.translatePivot=function(o,t,e){var n=this.objectPivot.position;n.setX(n.x+o),n.setY(n.y+t),n.setZ(n.z+e),this.dispatchEvent({type:"change",action:"translatePivot"})};ObjectControls.prototype.setPivot=function(o){this.objectPivot.position.copy(o),this.dispatchEvent({type:"change",action:"translatePivot"})};function Picker(o,t,e){EventDispatcher.call(this);var n=this;this.gfxObj=o,this.camera=t,this.domElement=typeof e<"u"?e:document,this.screen={left:0,top:0,width:0,height:0},this._lastMousePos=new Vector2(0,0),this._mouseTotalDist=0,this._lastClickBeginTime=-1e3,this._lastClickPos=new Vector2(0,0),this._clickBeginTime=0,this._clock=new Timer,this._clock.start(),this._listeners=[{obj:n.domElement,type:"mousedown",handler:function(l){n.mousedown(l)}},{obj:n.domElement,type:"mouseup",handler:function(l){n.mouseup(l)}},{obj:n.domElement,type:"mousemove",handler:function(l){n.mousemove(l)}},{obj:n.domElement,type:"touchstart",handler:function(l){n.touchstart(l)}},{obj:n.domElement,type:"touchend",handler:function(l){n.touchend(l)}},{obj:window,type:"resize",handler:function(){n.handleResize()}}];for(var r=0;r<this._listeners.length;r++){var a=this._listeners[r];a.obj.addEventListener(a.type,a.handler)}this.handleResize()}Picker.prototype=Object.create(EventDispatcher.prototype);Picker.prototype.constructor=Picker;Picker.prototype.reset=function(){this.picked={},this.dispatchEvent({type:"newpick",obj:{}})};Picker.prototype.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var o=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=o.left+window.pageXOffset-t.clientLeft,this.screen.top=o.top+window.pageYOffset-t.clientTop,this.screen.width=o.width,this.screen.height=o.height}};Picker.prototype.pickObject=function(o){if(!this.gfxObj){this.picked={},this.dispatchEvent({type:"newpick",obj:{}});return}var t=this.gfxObj,e=new Raycaster;e.ray.origin.setFromMatrixPosition(this.camera.matrixWorld),e.ray.direction.set(o.x,o.y,.5).unproject(this.camera).sub(e.ray.origin).normalize();var n=settings$1.now.draft.clipPlane&&this.clipPlaneValue?this.clipPlaneValue:1/0,r=settings$1.now.fog&&this.fogFarValue?this.fogFarValue:1/0,a=e.intersectVisibleObject(t,this.camera,n,r);if(!a){this.picked={},this.dispatchEvent({type:"newpick",obj:{}});return}var s={};if(a.residue||a.atom){var l=a.residue||a.atom.residue;settings$1.now.pick==="chain"?s={chain:l.getChain()}:settings$1.now.pick==="molecule"?s={molecule:l.getMolecule()}:a.residue||settings$1.now.pick==="residue"?s={residue:l}:a.atom&&(s={atom:a.atom})}this.picked=s,this.dispatchEvent({type:"newpick",obj:s})};Picker.prototype.getMouseInViewport=function(o,t){return new Vector2((o-this.screen.left)/this.screen.width*2-1,-(t-this.screen.top)/this.screen.height*2+1)};Picker.prototype.mousedown=function(o){o.preventDefault(),o.stopPropagation(),o.button===0&&(this._lastMousePos=this.getMouseInViewport(o.pageX,o.pageY),this._mouseTotalDist=0,this._clickBeginTime=this._clock.getElapsedTime())};Picker.prototype.mousemove=function(o){o.preventDefault(),o.stopPropagation();var t=this.getMouseInViewport(o.pageX,o.pageY);this._mouseTotalDist+=t.sub(this._lastMousePos).length()};Picker.prototype.mouseup=function(o){var t=this;if(o.preventDefault(),o.stopPropagation(),o.button===0&&this._mouseTotalDist<.01){var e=this._clock.getElapsedTime(),n=this.getMouseInViewport(o.pageX,o.pageY),r=e-this._lastClickBeginTime;if(r<.7){var a=new Vector2().subVectors(n,this._lastClickPos);if(a.length()<.01){this.dispatchEvent({type:"dblclick",obj:this.picked}),this._lastClickPos=n,this._lastClickBeginTime=-1e3;return}}setTimeout(function(){t.pickObject(n)},0),this._lastClickPos=n,this._lastClickBeginTime=this._clickBeginTime}};Picker.prototype.touchstart=function(o){o.preventDefault(),o.stopPropagation(),o.touches.length===1&&(this._lastTouchdownPos=this.getMouseInViewport(o.touches[0].pageX,o.touches[0].pageY))};Picker.prototype.touchend=function(o){var t=this;if(o.preventDefault(),o.stopPropagation(),o.touches.length===0&&o.changedTouches.length===1){var e=this.getMouseInViewport(o.changedTouches[0].pageX,o.changedTouches[0].pageY),n=e.sub(this._lastTouchdownPos).length();n<.01&&setTimeout(function(){t.pickObject(t._lastTouchdownPos)},0)}};Picker.prototype.dispose=function(){for(var o=0;o<this._listeners.length;o++){var t=this._listeners[o];t.obj.removeEventListener(t.type,t.handler)}};var Axes=function(){function o(t,e){_classCallCheck(this,o),this._target=t,this._targetCamera=e,this._camera=new PerspectiveCamera(e.fov,e.aspect,1,100),this._object=new AxesHelper(1),this._scene=new Scene,this._scene.add(this._object),this._full=new Vector2,this._update()}return _createClass(o,[{key:"_update",value:function(){var e=this._targetCamera.fov,n=this._camera;n.aspect=this._targetCamera.aspect,n.setMinimalFov(e),n.setDistanceToFit(1,e),n.updateProjectionMatrix(),this._object.quaternion.copy(this._target.quaternion)}},{key:"render",value:function(e){this._update(),e.getSize(this._full);var n=this._full.width*.25,r=this._full.height*.25,a=e.autoClear;e.autoClear=!1,e.setViewport(0,0,n,r),e.clear(!1,!0,!1),e.render(this._scene,this._camera),e.setViewport(0,0,this._full.width,this._full.height),e.autoClear=a}}]),o}(),cDataOffset=12,cFirstMask=268435200,cFirstShift=8,cSecMask1=255,cSecShift1=12,cSecMask2=4293918720,cSecShift2=20,cThirdMask=1048575,cStrMask=4026531840,cStrShift=28,c219=1<<19,c220=1<<20,cHelixIdx=1,cSheetIdx=2,secTypes=["helix","strand"],cSecNames=["fs","ps","ns","us"];function _createSecondary(o,t){for(var e=t._residues,n=e.length,r=new Uint8Array(n),a=t._atoms,s=0,l=o.length;s<l;++s){var c=a[s];r[c.residue._index]=o[s]}for(var u=[],f=0;f<n;){if(r[f]!==0){for(var p=f,g=r[f];f<n-1&&r[f+1]===g&&e[f].isConnected(e[f+1]);)++f;u.push({start:p,end:f,type:secTypes[g-1]})}++f}return u}function fromUInt20ToInt20(o){return o>=c219?o-c220:o}var FrameInfo=function(){function o(t,e,n){_classCallCheck(this,o),this._complex=t,this._secondary=null,this.isLoading=!1,this._framesRange={start:0,end:-1},this.frameIsReady=!1,this._buffer=null,this._frameRequest=null,this._callbacks=n,typeof e=="function"?(this._framesRequestLength=1,this._downloadDataFn=e):this.parseBinaryData(e,!0),this.reset(),this.setFrame(0)}return _createClass(o,[{key:"_prepareBuffer",value:function(e,n){if(e==null&&(e=0),n==null&&(n=e+this._framesRequestLength),this._framesCount!==void 0&&(n=Math.min(this._framesCount-1,n)),this._downloadDataFn){var r=this,a=function(c){if(r.isLoading=!1,r._callbacks&&typeof r._callbacks.onLoadStatusChanged=="function"&&r._callbacks.onLoadStatusChanged(),r._buffer={data:c,state:"ready",start:e,end:n},r._frameRequest!==null){var u=r._frameRequest;r._frameRequest=null,r.setFrame(u)}},s=function(){r.isLoading=!1,r._callbacks&&typeof r._callbacks.onError=="function"&&r._callbacks.onError("Streaming failed")};this._buffer||(this._buffer={}),this._buffer.state="downloading",this.isLoading=!0,r._callbacks&&typeof r._callbacks.onLoadStatusChanged=="function"&&r._callbacks.onLoadStatusChanged(),this._downloadDataFn({start:e,end:n+1},a,s)}}},{key:"_parseBuffer",value:function(){if(this._buffer&&this._buffer.state==="ready"){this._framesRange={start:this._buffer.start,end:this._buffer.end},this.parseBinaryData(this._buffer.data,!1);var e=(this._buffer.end+1)%this._framesCount;if(e>=this._framesCount&&(e=0),this._buffer={state:"none"},this._prepareBuffer(e,e+this._framesRequestLength),this._frameRequest!==null){var n=this._frameRequest;this._frameRequest=null,this.setFrame(n)}}}},{key:"parseBinaryData",value:function(e){var n=new DataView(e),r=0,a=n.getUint32(r,!0);r+=4;var s=n.getUint32(r,!0);this._framesCount=s,this._framesRange.end=this._framesRange.end>0?Math.min(this._framesRange.end,s-1):s-1,r+=4,this._atomsCount=a;var l=1024*1024;this._framesRequestLength=Math.ceil(l/(a*8));var c=this._framesRange.end-this._framesRange.start+1;if(a!==this._complex._atoms.length||e.byteLength!==cDataOffset+c*a*8)throw new Error;for(var u=this._complex,f=n.getUint32(r,!0),p=0;f>1e3&&p<cSecNames.length-1;)f/=1e3,++p;this._timeStep="".concat(f.toString()," ").concat(cSecNames[p]),r+=4;for(var g=[],y=new Float32Array(c*a*3),E=0,h=new Int8Array(a),v=0;v<c;++v){for(var C=0;C<a;++C){var x=n.getUint32(r,!0);r+=4;var w=n.getUint32(r,!0);r+=4;var _=(w&cStrMask)>>>cStrShift,S=fromUInt20ToInt20((w&cFirstMask)>>>cFirstShift>>0),M=fromUInt20ToInt20(((w&cSecMask1)<<cSecShift1|(x&cSecMask2)>>>cSecShift2)>>0),T=fromUInt20ToInt20((x&cThirdMask)>>0);h[C]=0,_>0&&_<4?h[C]=cHelixIdx:_===4&&(h[C]=cSheetIdx),y[E++]=S/100,y[E++]=M/100,y[E++]=T/100}g.push(_createSecondary(h,u))}this._secondaryData=g,this._data=y}},{key:"nextFrame",value:function(){this.setFrame((this._currFrame+1)%this._framesCount)}},{key:"needsColorUpdate",value:function(e){return e instanceof SecondaryStructureColorer}},{key:"getAtomColor",value:function(e,n){return e.getResidueColor(this._residues[n.residue._index],this._complex)}},{key:"getResidueColor",value:function(e,n){return e.getResidueColor(this._residues[n._index],this._complex)}},{key:"_updateSecondary",value:function(){var e,n=this._residues,r=n.length;for(e=0;e<r;++e)n[e]._secondary=null;var a=this._secondaryData[this._currFrame-this._framesRange.start];for(e=0,r=a.length;e<r;++e)for(var s=a[e],l=s.start,c=s.end,u={_start:n[l],_end:n[c],type:s.type,generic:s.generic},f=l;f<=c;++f)n[f]._secondary=u}},{key:"reset",value:function(){var e=this._complex._residues,n=e.length;this._residues=new Array(n);for(var r=this._residues,a=function(){return this._secondary},s=0;s<n;++s)r[s]={_type:e[s]._type,_isValid:e[s]._isValid,_controlPoint:null,_wingVector:null,_secondary:null,getSecondary:a}}},{key:"setFrame",value:function(e){if(this.frameIsReady=!1,e>=this._framesRange.start&&e<=this._framesRange.end)this._currFrame=e,this._cachedResidues=!1,this._updateSecondary(),this.frameIsReady=!0;else if(this._frameRequest=e,!this._buffer)this._prepareBuffer(e);else{var n=this;switch(this._buffer.state){case"none":this._prepareBuffer(e);break;case"ready":n._parseBuffer();break}}}},{key:"disableEvents",value:function(){this._callbacks=null}},{key:"getAtomPos",value:function(e){var n=o._vec,r=this,a=r._data,s=(r._atomsCount*(r._currFrame-r._framesRange.start)+e)*3;return n.set(a[s],a[s+1],a[s+2]),n}},{key:"getResidues",value:function(){return this._cachedResidues?this._residues:(this._complex.updateToFrame(this),this._residues)}}]),o}();_defineProperty(FrameInfo,"_vec",new Vector3);var SceneObject=function(){function o(t,e){if(_classCallCheck(this,o),this.constructor===o)throw new Error("Can not instantiate abstract class!");this.params=t,this.opts=lodashExports.merge(utils.deriveDeep(settings$1.now.objects[this.type],!0),e),this.needsRebuild=!1,this._mesh=null,this.id=null}return _createClass(o,[{key:"identify",value:function(){var e={type:this.type,params:this.params},n=utils.objectsDiff(this.opts,settings$1.now.modes[this.id]);return lodashExports.isEmpty(n)||(e.opts=n),e}},{key:"toString",value:function(){var e="o=".concat(this.type,",").concat(this.params.join(",")),n=utils.compareOptionsWithDefaults(this.opts,settings$1.defaults.objects[this.type]);return e+n}},{key:"getGeometry",value:function(){return this._mesh}},{key:"destroy",value:function(){this._mesh&&gfxutils.destroyObject(this._mesh)}}]),o}();SceneObject.prototype.type="__";function _createSuper$7(o){var t=_isNativeReflectConstruct$7();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$7(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LinesObj=function(o){_inherits(e,o);var t=_createSuper$7(e);function e(n,r){var a;if(_classCallCheck(this,e),a=t.call(this,n,r),n.length<2)throw new Error("Wrong number of argumets on line object creation!");var s=_slicedToArray(n,2);return a._id1=s[0],a._id2=s[1],a}return _createClass(e,[{key:"_getAtomFromName",value:function(r,a){var s=" - Wrong atom format it must be '#CHAIN_NAME.#RESIDUE_NUMBER.#ATOM_NAME' (e.g. 'A.38.CO1')",l=r.getAtomByFullname(a);if(!l)throw new Error(a+s);return l}},{key:"build",value:function(r){var a=new BufferGeometry;this._atom1=this._getAtomFromName(r,this._id1),this._atom2=this._getAtomFromName(r,this._id2);var s=this._atom1.position,l=this._atom2.position,c=new Float32Array([s.x,s.y,s.z,l.x,l.y,l.z]);a.setAttribute("position",new BufferAttribute(c,3)),a.computeBoundingBox();var u=new UberMaterial;u.setValues({lights:!1,overrideColor:!0,dashedLine:!0,fogTransparent:settings$1.now.bg.transparent}),this._line=new meshes.Line(a,u),this._line.computeLineDistances(),this._line.material.setUberOptions({fixedColor:new Color(this.opts.color),dashedLineSize:this.opts.dashSize,dashedLinePeriod:this.opts.dashSize+this.opts.gapSize}),this._line.material.updateUniforms(),this._line.raycast=function(p,g){},this._mesh=this._line;var f=r.getTransforms();f.length>0&&(this._mesh=new Group,this._mesh.add(this._line),meshutils.applyTransformsToMeshes(this._mesh,f))}},{key:"updateToFrame",value:function(r){if(!(!this._atom1||!this._atom2||!this._line)){var a=this._line.geometry;a.vertices[0].copy(r.getAtomPos(this._atom1.index)),a.vertices[1].copy(r.getAtomPos(this._atom2.index)),this._line.computeLineDistances(),a.computeBoundingSphere(),a.verticesNeedUpdate=!0}}}]),e}(SceneObject);LinesObj.prototype.constructor=LinesObj;LinesObj.prototype.type="line";var fragmentShader$5=`precision highp float;\r
\r
uniform sampler2D srcTex;\r
uniform vec2 srcTexSize;\r
uniform vec2 thickness;\r
varying vec2 vUv;\r
\r
#ifdef DEPTH_OUTLINE\r
  uniform sampler2D srcDepthTex; //depthTexture\r
  uniform vec3 color;\r
  uniform float threshold;\r
#endif\r
\r
void main() {\r
\r
  vec2 pixelSize = thickness / srcTexSize;\r
\r
  #ifdef DEPTH_OUTLINE\r
    float c00 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,-pixelSize.y)).x;\r
    float c01 = texture2D(srcDepthTex, vUv + vec2(0,-pixelSize.y)).x;\r
    float c02 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,-pixelSize.y)).x;\r
    float c10 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,0)).x;\r
    float c12 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,0)).x;\r
    float c20 = texture2D(srcDepthTex, vUv + vec2(-pixelSize.x,pixelSize.y)).x;\r
    float c21 = texture2D(srcDepthTex, vUv + vec2(0,pixelSize.y)).x;\r
    float c22 = texture2D(srcDepthTex, vUv + vec2(pixelSize.x,pixelSize.y)).x;\r
\r
    float horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r
    float vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r
\r
    float grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r
\r
    gl_FragColor = ( grad > threshold ) ? vec4(color.rgb, 1.0) : gl_FragColor = texture2D(srcTex, vUv);\r
\r
  #else\r
    vec4 c00 = texture2D(srcTex, vUv + vec2(-pixelSize.x,-pixelSize.y));\r
    vec4 c01 = texture2D(srcTex, vUv + vec2(0,-pixelSize.y));\r
    vec4 c02 = texture2D(srcTex, vUv + vec2(pixelSize.x,-pixelSize.y));\r
    vec4 c10 = texture2D(srcTex, vUv + vec2(-pixelSize.x,0));\r
    vec4 c12 = texture2D(srcTex, vUv + vec2(pixelSize.x,0));\r
    vec4 c20 = texture2D(srcTex, vUv + vec2(-pixelSize.x,pixelSize.y));\r
    vec4 c21 = texture2D(srcTex, vUv + vec2(0,pixelSize.y));\r
    vec4 c22 = texture2D(srcTex, vUv + vec2(pixelSize.x,pixelSize.y));\r
\r
    vec4 horizEdge = - c00 - 2.0 * c01 - c02 + c20 + 2.0 * c21 + c22;\r
    vec4 vertEdge  = - c00 - 2.0 * c10 - c20 + c02 + 2.0 * c12 + c22;\r
\r
    vec4 grad = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\r
    gl_FragColor = grad;\r
  #endif\r
}\r
`;function _createSuper$6(o){var t=_isNativeReflectConstruct$6();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OutlineMaterial=function(o){_inherits(e,o);var t=_createSuper$6(e);function e(n){var r;_classCallCheck(this,e),r=t.call(this,n);var a={uniforms:{srcTex:{type:"t",value:null},srcDepthTex:{type:"t",value:null},srcTexSize:{type:"v2",value:new Vector2(512,512)},color:{type:"v3",value:null},threshold:{type:"f",value:null},opacity:{type:"f",value:1},thickness:{type:"v2",value:new Vector2(1,1)}},vertexShader:vertexScreenQuadShader,fragmentShader:fragmentShader$5,transparent:!0,depthTest:!1,depthWrite:!1};return r.setValues(a),r}return _createClass(e,[{key:"copy",value:function(r){_get(_getPrototypeOf(e.prototype),"copy",this).call(this,r),this.depth=r.depth}},{key:"setValues",value:function(r){if(!(typeof r>"u")){_get(_getPrototypeOf(e.prototype),"setValues",this).call(this,r);var a={};this.depth&&(a.DEPTH_OUTLINE=1),this.defines=a}}}]),e}(RawShaderMaterial);OutlineMaterial.prototype.depth=!1;var fragmentShader$4=`precision highp float;\r
\r
// edge end finding algorithm parameters\r
#define FXAA_QUALITY_PS 8\r
#define FXAA_QUALITY_P0 1.0\r
#define FXAA_QUALITY_P1 1.5\r
#define FXAA_QUALITY_P2 2.0\r
#define FXAA_QUALITY_P3 2.0\r
#define FXAA_QUALITY_P4 2.0\r
#define FXAA_QUALITY_P5 2.0\r
#define FXAA_QUALITY_P6 4.0\r
#define FXAA_QUALITY_P7 12.0\r
// constants\r
float fxaaQualityEdgeThreshold = 0.125;\r
float fxaaQualityEdgeThresholdMin = 0.0625;\r
float fxaaQualitySubpix = 0.7; //0.65;\r
// global params\r
uniform sampler2D srcTex;\r
uniform vec2 srcTexelSize;\r
uniform vec3 bgColor;\r
// from vs\r
varying vec2 vUv;\r
//=====================================================================//\r
// calc luminance from rgb\r
//'float FxaaLuma(vec3 rgb) {return rgb.y * (0.587/0.299) + rgb.x; } // Lotte's idea about game luminance\r
float FxaaLuma(vec3 rgb) {return dot(rgb, vec3(0.299, 0.587, 0.114)); } // real luminance calculation\r
                                                                           // for non-real scene rendering\r
// texture sampling by pixel position(coords) and offset(in pixels)\r
 vec3 FxaaTex(sampler2D tex, vec2 pos, vec2 off,  vec2 res ) {\r
  #ifdef BG_TRANSPARENT\r
    vec4 color = texture2D( tex, pos + off * res );\r
    return mix(color.rgb, bgColor, 1.0 - color.a);\r
  #else\r
    return texture2D( tex, pos + off * res ).xyz;\r
  #endif\r
}\r
vec3 FxaaTexTop(sampler2D tex, vec2 pos) {\r
  #ifdef BG_TRANSPARENT\r
    vec4 color = texture2D( tex, pos );\r
    return mix(color.rgb, bgColor, 1.0 - color.a);\r
  #else\r
    return texture2D( tex, pos).xyz;\r
  #endif\r
}\r
vec4 FxaaTexTopAlpha(sampler2D tex, vec2 pos) {\r
  return texture2D( tex, pos);\r
}\r
\r
//=====================================================================//\r
void main() {\r
  // renaming\r
  vec2 posM = vUv;\r
  // get luminance for neighbours\r
  float lumaS = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, 1.0 ), srcTexelSize));\r
  float lumaE = FxaaLuma(FxaaTex(srcTex, posM, vec2( 1.0, 0.0 ), srcTexelSize));\r
  float lumaN = FxaaLuma(FxaaTex(srcTex, posM, vec2( 0.0, -1.0 ), srcTexelSize));\r
  float lumaW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, 0.0 ), srcTexelSize));\r
  float lumaM = FxaaLuma(FxaaTexTop(srcTex, posM));\r
  // find max and min luminance\r
  float rangeMax = max(max(lumaN, lumaW), max(lumaE, max(lumaS, lumaM)));\r
  float rangeMin = min(min(lumaN, lumaW), min(lumaE, min(lumaS, lumaM)));\r
  // calc maximum non-edge range\r
  float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\r
  float range = rangeMax - rangeMin;\r
  float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\r
  // exit when luma contrast is small (is not edge)\r
  if(range < rangeMaxClamped){\r
    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r
    return;\r
  }\r
  float subpixRcpRange = 1.0/range;\r
  // note: the sampling coordinates can be calculated in vertex shader but the approach doesn't affect performance\r
  // visibly, thus we decided to leave calculation here for better readability.\r
  // calc other neighbours luminance\r
  float lumaNE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0, -1.0 ), srcTexelSize));\r
  float lumaSW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0,  1.0 ), srcTexelSize));\r
  float lumaSE = FxaaLuma(FxaaTex(srcTex, posM, vec2(  1.0,  1.0 ), srcTexelSize));\r
  float lumaNW = FxaaLuma(FxaaTex(srcTex, posM, vec2( -1.0, -1.0 ), srcTexelSize));\r
/*--------------span calculation and subpix amount calulation-----------------*/\r
  float lumaNS = lumaN + lumaS;\r
  float lumaWE = lumaW + lumaE;\r
  float subpixNSWE = lumaNS + lumaWE;\r
  float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\r
  float edgeVert1 = (-2.0 * lumaM) + lumaWE;\r
/*--------------------------------------------------------------------------*/\r
  float lumaNESE = lumaNE + lumaSE;\r
  float lumaNWNE = lumaNW + lumaNE;\r
  float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\r
  float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\r
/*--------------------------------------------------------------------------*/\r
  float lumaNWSW = lumaNW + lumaSW;\r
  float lumaSWSE = lumaSW + lumaSE;\r
  float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\r
  float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\r
  float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\r
  float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\r
  float edgeHorz = abs(edgeHorz3) + edgeHorz4;\r
  float edgeVert = abs(edgeVert3) + edgeVert4;\r
/*--------------------subpix amount calulation------------------------------*/\r
  float subpixNWSWNESE = lumaNWSW + lumaNESE;\r
  float lengthSign = srcTexelSize.x;\r
  bool horzSpan = edgeHorz >= edgeVert;\r
   // debug  code edge span visualization\r
/*'  if (horzSpan)\r
      gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\r
  else\r
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r
  return;*/\r
  float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\r
/*--------------------------------------------------------------------------*/\r
  if(!horzSpan) lumaN = lumaW;\r
  if(!horzSpan) lumaS = lumaE;\r
  if(horzSpan) lengthSign = srcTexelSize.y;\r
  float subpixB = (subpixA * (1.0/12.0)) - lumaM;\r
/*--------------------------------------------------------------------------*/\r
  float gradientN = lumaN - lumaM;\r
  float gradientS = lumaS - lumaM;\r
  float lumaNN = lumaN + lumaM;\r
  float lumaSS = lumaS + lumaM;\r
  bool pairN = abs(gradientN) >= abs(gradientS);\r
  float gradient = max(abs(gradientN), abs(gradientS));\r
  if(pairN) lengthSign = -lengthSign;\r
  float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\r
/*--------------------------------------------------------------------------*/\r
  vec2 posB;\r
  posB = posM;\r
  vec2 offNP;\r
  offNP.x = (!horzSpan) ? 0.0 : srcTexelSize.x;\r
  offNP.y = ( horzSpan) ? 0.0 : srcTexelSize.y;\r
  if(!horzSpan) posB.x += lengthSign * 0.5;\r
  if( horzSpan) posB.y += lengthSign * 0.5;\r
/*--------------------------------------------------------------------------*/\r
  vec2 posN;\r
  posN = posB - offNP * FXAA_QUALITY_P0;\r
  vec2 posP;\r
  posP = posB + offNP * FXAA_QUALITY_P0;\r
  float subpixD = ((-2.0)*subpixC) + 3.0;\r
  float lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN));\r
  float subpixE = subpixC * subpixC;\r
  float lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP));\r
/*--------------------------------------------------------------------------*/\r
  if(!pairN) lumaNN = lumaSS;\r
  float gradientScaled = gradient * 1.0/4.0;\r
  float lumaMM = lumaM - lumaNN * 0.5;\r
  float subpixF = subpixD * subpixE;\r
  bool lumaMLTZero = lumaMM < 0.0;\r
/*---------------------looped edge-end search-------------------------------*/\r
  lumaEndN -= lumaNN * 0.5;\r
  lumaEndP -= lumaNN * 0.5;\r
  bool doneN = abs(lumaEndN) >= gradientScaled;\r
  bool doneP = abs(lumaEndP) >= gradientScaled;\r
  if(!doneN) posN -= offNP * FXAA_QUALITY_P1;\r
  bool doneNP = (!doneN) || (!doneP);\r
  if(!doneP) posP += offNP * FXAA_QUALITY_P1;\r
/*--------------------------------------------------------------------------*/\r
  if(doneNP) {\r
    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
    doneN = abs(lumaEndN) >= gradientScaled;\r
    doneP = abs(lumaEndP) >= gradientScaled;\r
    if(!doneN) posN -= offNP * FXAA_QUALITY_P2;\r
    doneNP = (!doneN) || (!doneP);\r
    if(!doneP) posP += offNP * FXAA_QUALITY_P2;\r
/*--------------------------------------------------------------------------*/\r
    #if (FXAA_QUALITY_PS > 3)\r
      if(doneNP) {\r
        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
        doneN = abs(lumaEndN) >= gradientScaled;\r
        doneP = abs(lumaEndP) >= gradientScaled;\r
        if(!doneN) posN -= offNP * FXAA_QUALITY_P3;\r
        doneNP = (!doneN) || (!doneP);\r
        if(!doneP) posP += offNP * FXAA_QUALITY_P3;\r
/*--------------------------------------------------------------------------*/\r
        #if (FXAA_QUALITY_PS > 4)\r
          if(doneNP) {\r
            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
            doneN = abs(lumaEndN) >= gradientScaled;\r
            doneP = abs(lumaEndP) >= gradientScaled;\r
            if(!doneN) posN -= offNP * FXAA_QUALITY_P4;\r
            doneNP = (!doneN) || (!doneP);\r
            if(!doneP) posP += offNP * FXAA_QUALITY_P4;\r
/*--------------------------------------------------------------------------*/\r
            #if (FXAA_QUALITY_PS > 5)\r
               if(doneNP) {\r
                 if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                 if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                 if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                 if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                 doneN = abs(lumaEndN) >= gradientScaled;\r
                 doneP = abs(lumaEndP) >= gradientScaled;\r
                 if(!doneN) posN -= offNP * FXAA_QUALITY_P5;\r
                 doneNP = (!doneN) || (!doneP);\r
                 if(!doneP) posP += offNP * FXAA_QUALITY_P5;\r
/*--------------------------------------------------------------------------*/\r
                 #if (FXAA_QUALITY_PS > 6)\r
                   if(doneNP) {\r
                     if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                     if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                     if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                     if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                     doneN = abs(lumaEndN) >= gradientScaled;\r
                     doneP = abs(lumaEndP) >= gradientScaled;\r
                     if(!doneN) posN -= offNP * FXAA_QUALITY_P6;\r
                     doneNP = (!doneN) || (!doneP);\r
                     if(!doneP) posP += offNP * FXAA_QUALITY_P6;\r
/*--------------------------------------------------------------------------*/\r
                     #if (FXAA_QUALITY_PS > 7)\r
                       if(doneNP) {\r
                         if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(srcTex, posN.xy));\r
                         if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(srcTex, posP.xy));\r
                         if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\r
                         if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\r
                         doneN = abs(lumaEndN) >= gradientScaled;\r
                         doneP = abs(lumaEndP) >= gradientScaled;\r
                         if(!doneN) posN -= offNP * FXAA_QUALITY_P7;\r
                         doneNP = (!doneN) || (!doneP);\r
                         if(!doneP) posP += offNP * FXAA_QUALITY_P7;\r
/*--------------------------------------------------------------------------*/\r
                       }\r
                     #endif\r
                   }\r
                 #endif\r
               }\r
             #endif\r
           }\r
         #endif\r
      }\r
    #endif\r
  }\r
/*----------------calculate subpix offset due to edge ends-------------------*/\r
  float dstN = posM.x - posN.x;\r
  float dstP = posP.x - posM.x;\r
  if(!horzSpan) dstN = posM.y - posN.y;\r
  if(!horzSpan) dstP = posP.y - posM.y;\r
/*--------------------------------------------------------------------------*/\r
  bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\r
  float spanLength = (dstP + dstN);\r
  bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\r
  float spanLengthRcp = 1.0 / spanLength;\r
/*--------------------------------------------------------------------------*/\r
  bool directionN = dstN < dstP;\r
  float dst = min(dstN, dstP);\r
  bool goodSpan = directionN ? goodSpanN : goodSpanP;\r
  float subpixG = subpixF * subpixF;\r
  float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\r
  float subpixH = subpixG * fxaaQualitySubpix;\r
/*-----------------calc texture offest using subpix-------------------------*/\r
  float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\r
  float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\r
\r
  float offset = pixelOffsetSubpix * lengthSign;\r
  #ifdef BG_TRANSPARENT\r
    // get original texel\r
    vec4 rgbaA = FxaaTexTopAlpha(srcTex, posM);\r
    // calc step to blended texel\r
    vec2 step = sign((!horzSpan) ? vec2 (offset, 0.0) : vec2 (0.0, offset));\r
    // get neighboring texel\r
    vec4 rgbaB = FxaaTexTopAlpha(srcTex, posM + step * srcTexelSize);\r
    //  calc blend factor from offset\r
    float f = (!horzSpan) ? offset / srcTexelSize.x : offset / srcTexelSize.y;\r
    f = abs(f);\r
    // calc alpha (special formula to emulate blending with bg)\r
    gl_FragColor.a = 1.0 - mix(1.0 - rgbaA.a, 1.0 - rgbaB.a, f);\r
    // calc color (special formula to emulate blending with bg)\r
    gl_FragColor.rgb = mix(rgbaA.rgb * rgbaA.a, rgbaB.rgb * rgbaB.a, f) / gl_FragColor.a;\r
  #else\r
    if(!horzSpan) {\r
       posM.x += offset;\r
    } else {\r
       posM.y += offset;\r
    }\r
    gl_FragColor = FxaaTexTopAlpha(srcTex, posM);\r
  #endif\r
  return;\r
}\r
`;function _createSuper$5(o){var t=_isNativeReflectConstruct$5();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FXAAMaterial=function(o){_inherits(e,o);var t=_createSuper$5(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n),r.setValues({uniforms:{srcTex:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Vector2(1/512,1/512)},bgColor:{type:"c",value:new Color(16777215)}},vertexShader:vertexScreenQuadShader,fragmentShader:fragmentShader$4,transparent:!1,depthTest:!1,depthWrite:!1}),r.setValues(n),r}return _createClass(e,[{key:"copy",value:function(r){_get(_getPrototypeOf(e.prototype),"copy",this).call(this,r),this.depth=r.depth}},{key:"setValues",value:function(r){if(!(typeof r>"u")){_get(_getPrototypeOf(e.prototype),"setValues",this).call(this,r);var a={};this.bgTransparent&&(a.BG_TRANSPARENT=1),this.defines=a}}}]),e}(RawShaderMaterial);FXAAMaterial.prototype.bgTransparent=!1;var fragmentShader$3=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 32\r
uniform vec3 samplesKernel[MAX_SAMPLES_COUNT];\r
uniform sampler2D noiseTexture;\r
uniform vec2      noiseTexelSize;\r
uniform sampler2D diffuseTexture;\r
uniform sampler2D depthTexture;\r
uniform sampler2D normalTexture;\r
uniform vec2      srcTexelSize;\r
uniform vec2      camNearFar;\r
uniform mat4      projMatrix;\r
\r
uniform float aspectRatio;\r
uniform float tanHalfFOV;\r
\r
uniform float kernelRadius;\r
uniform float depthThreshold;\r
uniform float factor;\r
\r
varying vec2 vUv;\r
\r
float CalcViewZ(vec2 screenPos)\r
{\r
  float depth = texture2D(depthTexture, screenPos).x;\r
  // [0, 1]->[-1, 1]\r
  float clipedZ = 2.0 * depth - 1.0;\r
  // see THREE.js camera.makeFrustum for projection details\r
  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r
}\r
\r
vec3 ViewPosFromDepth(vec2 screenPos)\r
{\r
  vec3 viewPos;\r
  viewPos.z = CalcViewZ(screenPos);\r
  //[0, 1]->[-1, 1]\r
  vec2 projPos = 2.0 * screenPos - 1.0;\r
  // reconstruct viewposition in right-handed sc with z to viewer\r
  viewPos.xy = vec2(\r
                    projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r
                    projPos.y * tanHalfFOV * abs(viewPos.z)\r
                   );\r
  return viewPos;\r
}\r
\r
void main() {\r
  vec3 viewPos = ViewPosFromDepth(vUv);\r
  // remap coordinates to prevent noise exture rescale\r
  vec2 vUvNoise = vUv / srcTexelSize * noiseTexelSize;\r
  vec4 normalData = texture2D(normalTexture, vUv);\r
  // return for background fragments (their normals are zero vectors)\r
  if (length(normalData.rgb) < EPSILON) {\r
    // 0.0 in alpha component means that it is background fragment\r
    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r
    return;\r
  }\r
  //[0, 1] -> [-1, 1]\r
  vec3 normal = (normalData.rgb * 2.0 - 1.0);\r
  // normalData.a store 1.0 if normal was build for frontfaced surface\r
  // and 0.0 in other case\r
  if (normalData.a < EPSILON) {\r
    normal *= -1.0;\r
  }\r
  // get random vector for sampling sphere rotation\r
  vec3 randN = texture2D(noiseTexture, vUvNoise).rgb * 2.0 - 1.0;\r
  randN = normalize(randN);\r
  // build TBN (randomly rotated around normal)\r
  vec3 tangent   = normalize(randN - normal * dot(randN, normal));\r
  vec3 bitangent = cross(tangent, normal);\r
  mat3 TBN = mat3(tangent, bitangent, normal);\r
  // calc AO value\r
  float AO = 0.0;\r
  for (int i = 0 ; i < MAX_SAMPLES_COUNT ; i++) {\r
    // rotate sampling kernel around normal\r
    vec3 reflectedSample = TBN * samplesKernel[i];\r
    // get sample\r
    vec3 samplePos = viewPos + reflectedSample * kernelRadius;\r
\r
    // project sample to screen to get sample's screen pos\r
    vec4 SampleScrPos = vec4(samplePos, 1.0);\r
    // eye -> clip\r
    SampleScrPos = projMatrix * SampleScrPos;\r
    // normalize\r
    SampleScrPos.xy /= SampleScrPos.w;\r
    //[-1, 1] -> [0, 1]\r
    SampleScrPos.xy = (SampleScrPos.xy + vec2(1.0)) * 0.5;\r
\r
    // get view z for sample projected to the objct surface\r
    float sampleDepth = CalcViewZ(SampleScrPos.xy);\r
    // calc occlusion made by object surface at the sample\r
    AO += step(samplePos.z, sampleDepth);\r
  }\r
  // calc result AO-map color\r
  AO = 1.0 - max(0.0, AO / float(MAX_SAMPLES_COUNT) * factor);\r
  // write value to AO-map\r
  gl_FragColor = vec4(AO, AO, AO, 1.0);\r
}\r
`;function _createSuper$4(o){var t=_isNativeReflectConstruct$4();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _samplesKernel=[new Vector3(.295184,.077723,.068429),new Vector3(-.271976,-.365221,.838363),new Vector3(.547713,.467576,.488515),new Vector3(.662808,-.031733,.584758),new Vector3(-.025717,.218955,.657094),new Vector3(-.310153,-.365223,.370701),new Vector3(-.101407,-.006313,.747665),new Vector3(-.769138,.360399,.086847),new Vector3(-.271988,-.27514,.905353),new Vector3(.09674,-.566901,.700151),new Vector3(.562872,-.735136,.094647),new Vector3(.379877,.359278,.190061),new Vector3(.519064,-.023055,.405068),new Vector3(-.301036,.114696,.088885),new Vector3(-.282922,.598305,.487214),new Vector3(-.181859,.25167,.679702),new Vector3(-.191463,-.635818,.512919),new Vector3(-.293655,.427423,.078921),new Vector3(-.267983,.680534,.13288),new Vector3(.139611,.319637,.477439),new Vector3(-.352086,.31104,.653913),new Vector3(.321032,.805279,.487345),new Vector3(.073516,.820734,.414183),new Vector3(-.155324,.589983,.41146),new Vector3(.335976,.170782,.527627),new Vector3(.46346,-.355658,.167689),new Vector3(.222654,.59655,.769406),new Vector3(.922138,-.04207,.147555),new Vector3(-.72705,-.329192,.369826),new Vector3(-.090731,.53382,.463767),new Vector3(-.323457,-.876559,.238524),new Vector3(-.663277,-.372384,.342856)],AOMaterial=function(o){_inherits(e,o);var t=_createSuper$4(e);function e(){var n;return _classCallCheck(this,e),n=t.call(this),n.setValues({uniforms:{noiseTexture:{type:"t",value:noise.noiseTexture},noiseTexelSize:{type:"v2",value:new Vector2(1/noise.noiseWidth,1/noise.noiseHeight)},diffuseTexture:{type:"t",value:null},normalTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Vector2(1/512,1/512)},camNearFar:{type:"v2",value:new Vector2(1,10)},projMatrix:{type:"mat4",value:new Matrix4},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},samplesKernel:{type:"v3v",value:_samplesKernel},kernelRadius:{type:"f",value:1},depthThreshold:{type:"f",value:1},factor:{type:"f",value:1}},vertexShader:vertexScreenQuadShader,fragmentShader:fragmentShader$3,transparent:!1,depthTest:!1,depthWrite:!1}),n}return _createClass(e)}(RawShaderMaterial),fragmentShader$2=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 5\r
uniform float samplesOffsets[MAX_SAMPLES_COUNT];\r
uniform sampler2D aoMap;\r
uniform sampler2D depthTexture;\r
uniform vec2      srcTexelSize;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
  float x = vUv.x;\r
  float y = vUv.y;\r
  vec4 res = vec4(0.0);\r
  res.a = texture2D(aoMap, vec2(x, y )).a;\r
  // return for background fragments (0.0 in alpha component means that it is background fragment)\r
  if (res.a < EPSILON) {\r
    gl_FragColor = res;\r
    return;\r
  }\r
\r
  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r
  float weightSum = 0.0;\r
  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r
    if (texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).a < EPSILON) {\r
      continue;\r
    }\r
    vec2 samplePos = vec2(x + samplesOffsets[i] * srcTexelSize.x, y);\r
    float depth = texture2D(depthTexture, samplePos).x;\r
    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r
    res.rgb += texture2D(aoMap, vec2(x + samplesOffsets[i] * srcTexelSize.x, y )).rgb * weight;\r
    weightSum += weight;\r
  }\r
  res.rgb = res.rgb / weightSum;\r
  gl_FragColor = res;\r
}\r
`;function _createSuper$3(o){var t=_isNativeReflectConstruct$3();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _kernelOffsets$1=[-2,-1,0,1,2],AOHorBlurMaterial=function(o){_inherits(e,o);var t=_createSuper$3(e);function e(){var n;return _classCallCheck(this,e),n=t.call(this),n.setValues({uniforms:{depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Vector2(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:_kernelOffsets$1}},vertexShader:vertexScreenQuadShader,fragmentShader:fragmentShader$2,transparent:!1,depthTest:!1,depthWrite:!1}),n}return _createClass(e)}(RawShaderMaterial),fragmentShader$1=`precision highp float;\r
#define EPSILON 0.0000001\r
\r
#define MAX_SAMPLES_COUNT 5\r
uniform float samplesOffsets[MAX_SAMPLES_COUNT];\r
uniform sampler2D diffuseTexture;\r
uniform sampler2D aoMap;\r
uniform sampler2D depthTexture;\r
uniform vec2      srcTexelSize;\r
\r
uniform mat4  projMatrix;\r
uniform float aspectRatio;\r
uniform float tanHalfFOV;\r
\r
#ifdef USE_FOG\r
  uniform vec2 fogNearFar;\r
  uniform vec4 fogColor;\r
#endif\r
varying vec2 vUv;\r
\r
float CalcViewZ(vec2 screenPos)\r
{\r
  float depth = texture2D(depthTexture, screenPos).x;\r
  // [0, 1]->[-1, 1]\r
  float clipedZ = 2.0 * depth - 1.0;\r
  // see THREE.js camera.makeFrustum for projection details\r
  return (-projMatrix[3][2] / (clipedZ + projMatrix[2][2]));\r
}\r
\r
vec3 ViewPosFromDepth(vec2 screenPos)\r
{\r
  vec3 viewPos;\r
  viewPos.z = CalcViewZ(screenPos);\r
  //[0, 1]->[-1, 1]\r
  vec2 projPos = 2.0 * screenPos - 1.0;\r
  // reconstruct viewposition in right-handed sc with z to viewer\r
  viewPos.xy = vec2(\r
  projPos.x * aspectRatio * tanHalfFOV * abs(viewPos.z),\r
  projPos.y * tanHalfFOV * abs(viewPos.z)\r
  );\r
  return viewPos;\r
}\r
\r
void main() {\r
  vec3 viewPos = ViewPosFromDepth(vUv);\r
  float x = vUv.x;\r
  float y = vUv.y;\r
  vec4 color = texture2D(diffuseTexture, vec2(x, y));\r
  vec4 res = vec4(0.0);\r
  res.a = texture2D(aoMap, vec2(x, y )).a;\r
  // return for background fragments (0.0 in alpha component means that it is background fragment)\r
  if (res.a < EPSILON) {\r
    gl_FragColor = color;\r
    return;\r
  }\r
\r
  float pixelDepth = texture2D(depthTexture, vec2(x, y)).x;\r
  float weightSum = 0.0;\r
  for (int i = 0; i < MAX_SAMPLES_COUNT; ++i) {\r
    if (texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).a < EPSILON) {\r
      continue;\r
    }\r
    vec2 samplePos = vec2(x, y + samplesOffsets[i] * srcTexelSize.y);\r
    float depth = texture2D(depthTexture, samplePos).x;\r
    float weight = (1.0 / (0.0001 + abs(depth - pixelDepth)));\r
    res.rgb += texture2D(aoMap, vec2(x, y + samplesOffsets[i] * srcTexelSize.y)).rgb * weight;\r
    weightSum += weight;\r
  }\r
  res.rgb /= weightSum;\r
\r
  #if defined(USE_FOG) && !defined(FOG_TRANSPARENT)\r
    // Add fog to the result value\r
    // Proper way to get an image with fog and ao requires formula:\r
    //          gl_FragColor = fragColor*AO*(1-fogFactor) + fogColor*fogFactor\r
    // But we have already fogged molecule to add AO too. Let's split the straight formula into our real steps!\r
    // We have:  AO, fogFactor, fogColor,\r
    //          color = fragColor*(1-fogFactor) + fogColor*fogFactor (it comes from diffuseTexture,\r
    //                                                                where molecule has been already drawn with fog)\r
    // Transform:\r
    //          fragColor*AO*(1-fogFactor) + fogColor*fogFactor =\r
    //        = [fragColor*(1-fogFactor) = color - fogColor*fogFactor] =\r
    //        = (color - fogColor*fogFactor)*AO + fogColor*fogFactor =\r
    //        = color*AO + fogColor*fogFactor*(1 - AO)\r
    // Result:  gl_FragColor = color*AO + fogColor*fogFactor*(1 - AO)\r
    float fogFactor = smoothstep(fogNearFar.x, fogNearFar.y, - viewPos.z) * fogColor.a;\r
    gl_FragColor.rgb = color.rgb * res.rgb + fogColor.rgb * fogFactor *(vec3(1.0, 1.0, 1.0) - res.rgb);\r
  #else\r
    gl_FragColor.rgb = color.rgb * res.rgb;\r
  #endif\r
  gl_FragColor.a = color.a;\r
}\r
`;function _createSuper$2(o){var t=_isNativeReflectConstruct$2();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _kernelOffsets=[-2,-1,0,1,2],AOVertBlurWithBlendMaterial=function(o){_inherits(e,o);var t=_createSuper$2(e);function e(n){var r;return _classCallCheck(this,e),r=t.call(this,n),r.setValues({uniforms:{diffuseTexture:{type:"t",value:null},depthTexture:{type:"t",value:null},srcTexelSize:{type:"v2",value:new Vector2(1/512,1/512)},aoMap:{type:"t",value:null},samplesOffsets:{type:"fv1",value:_kernelOffsets},projMatrix:{type:"mat4",value:new Matrix4},aspectRatio:{type:"f",value:0},tanHalfFOV:{type:"f",value:0},fogNearFar:{type:"v2",value:new Vector2(100,100)},fogColor:{type:"v4",value:new Vector4(0,.5,0,1)}},vertexShader:vertexScreenQuadShader,fragmentShader:fragmentShader$1,transparent:!1,depthTest:!1,depthWrite:!1}),r.setValues(n),r}return _createClass(e,[{key:"setValues",value:function(r){if(!(typeof r>"u")){_get(_getPrototypeOf(e.prototype),"setValues",this).call(this,r);var a={};this.useFog&&(a.USE_FOG=1),this.fogTransparent&&(a.FOG_TRANSPARENT=1),this.defines=a}}}]),e}(RawShaderMaterial);AOVertBlurWithBlendMaterial.prototype.useFog=!0;AOVertBlurWithBlendMaterial.prototype.fogTransparent=!1;var fragmentShader=`precision highp float;\r
\r
uniform sampler2D srcL;\r
uniform sampler2D srcR;\r
varying vec2 vUv;\r
\r
void main() {\r
  vec4 l = texture2D(srcL, vUv);\r
  vec4 r = texture2D(srcR, vUv);\r
  gl_FragColor = vec4(l.r, r.g, r.b, 1.0);\r
}\r
`;function _createSuper$1(o){var t=_isNativeReflectConstruct$1();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct$1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AnaglyphMaterial=function(o){_inherits(e,o);var t=_createSuper$1(e);function e(){var n;_classCallCheck(this,e),n=t.call(this);var r={uniforms:{srcL:{type:"t",value:null},srcR:{type:"t",value:null}},vertexShader:vertexScreenQuadShader,fragmentShader,transparent:!1,depthTest:!1,depthWrite:!1};return n.setValues(r),n}return _createClass(e)}(RawShaderMaterial),View=function(){function o(){_classCallCheck(this,o),this.position=new Vector3(0,0,0),this.scale=1,this.orientation=new Quaternion(0,0,0,1)}return _createClass(o,[{key:"set",value:function(e,n,r){this.position=e,this.scale=n,this.orientation=r}}]),o}(),_transitionTime=1.5,ViewInterpolator=function(){function o(){_classCallCheck(this,o)}return _createClass(o,[{key:"setup",value:function(e,n){this._startTime=void 0,this._endTime=void 0,this._isPaused=!1,this._srcView=e,this._dstView=n,this._isMoving=!1}},{key:"isMoving",value:function(){return this._isMoving}},{key:"wasStarted",value:function(){return typeof this._startTime<"u"&&typeof this._endTime<"u"}},{key:"start",value:function(){this._startTime=Date.now();var e=settings$1.now.interpolateViews?_transitionTime*1e3:0;this._endTime=this._startTime+e,this._isMoving=!0}},{key:"getCurrentView",value:function(){if(typeof this._srcView>"u"||typeof this._dstView>"u"||!this._isMoving||!this.wasStarted())return{success:!1};var e=this.createView(),n=Date.now();if(n>this._endTime)return e=this._dstView,this.reset(),{success:!0,view:e};var r=(n-this._startTime)/(this._endTime-this._startTime);return e.position.copy(this._srcView.position),e.position.lerp(this._dstView.position,r),e.scale=(1-r)*this._srcView.scale+r*this._dstView.scale,e.orientation.copy(this._srcView.orientation),e.orientation.slerp(this._dstView.orientation,r),{success:!0,view:e}}},{key:"reset",value:function(){this._startTime=this._endTime=0,this._isMoving=!1}},{key:"pause",value:function(){this._isPaused||(this.setup(this.getCurrentView().view,this._dstView),this._isPaused=!0)}},{key:"resume",value:function(){this._isPaused=!1}},{key:"createView",value:function(){return new View}}]),o}(),MAX_COOKIE_LEN=4e3,COUNT_SUFFIX="Cnt";function _chunkString(o,t){for(var e=o.length,n=[],r=0,a=0;a<e;r++,a+=t)n[r]=o.slice(a,a+t);return n}function Cookies(o,t){this.context=o,this._opts=lodashExports.merge({path:"/"},t)}makeContextDependent(Cookies.prototype);Cookies.prototype.removeCookie=function(o){var t=this._toCount(o),e=this._getSimpleCookie(t);if(!e){this._removeSimpleCookie(o);return}this._removeSimpleCookie(t),e=parseInt(e,10);for(var n=0;n<e;++n)this._removeSimpleCookie(o+n)};Cookies.prototype.setCookie=function(o,t){this.removeCookie(o),t=encodeURIComponent(t);var e=_chunkString(t,MAX_COOKIE_LEN-o.length-1),n=e.length;if(n===1){this._setSimpleCookie(o,t);return}var r=this._toCount(o);this._setSimpleCookie(r,n.toString());for(var a=0;a<n;++a)this._setSimpleCookie(o+a,e[a])};Cookies.prototype.getCookie=function(o){var t=this._toCount(o),e=this._getSimpleCookie(t);if(!e)return this._getSimpleCookie(o);e=parseInt(e,10);for(var n=[],r=0;r<e;++r)n[r]=this._getSimpleCookie(o+r);return n.join("")};Cookies.prototype._toCount=function(o){return o+COUNT_SUFFIX};Cookies.prototype._removeSimpleCookie=function(o){document.cookie="".concat(o,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;")};Cookies.prototype._getExpirationDate=function(){var o=new Date,t=10;return o.setFullYear(o.getFullYear()+t),o};Cookies.prototype._setSimpleCookie=function(o,t){document.cookie="".concat(o,"=").concat(t,";expires=").concat(this._getExpirationDate().toUTCString(),";path=").concat(this._opts.path)};Cookies.prototype._getSimpleCookie=function(o){var t=document.cookie.match(new RegExp("(?:^|; )".concat(o,"=([^;]*)")));return t?decodeURIComponent(t[1]):""};Cookies.prototype._exists=function(o){return document.cookie.match(new RegExp("(?:^|; )".concat(o,"=([^;]*)")))};function createWebVRButton(o){function t(s){s.style.display="",s.style.cursor="pointer",s.style.left="calc(50% - 50px)",s.style.width="100px",s.textContent="ENTER VR";var l=null;function c(){l.removeEventListener("end",c),s.textContent="ENTER VR",l=null}function u(f){f.addEventListener("end",c),o._gfx.renderer.xr.setReferenceSpaceType("local"),o._gfx.renderer.xr.setSession(f),s.textContent="EXIT VR",l=f}s.onmouseenter=function(){s.style.opacity="1.0"},s.onmouseleave=function(){s.style.opacity="0.5"},s.onclick=function(){if(l===null){var f={optionalFeatures:["local-floor","bounded-floor"]};navigator.xr.requestSession("immersive-vr",f).then(u),o.moveSceneBehindHeadset()}else l.end()}}function e(s){s.style.display="",s.style.cursor="auto",s.style.left="calc(50% - 75px)",s.style.width="150px",s.textContent="VR NOT FOUND",s.onmouseenter=null,s.onmouseleave=null,s.onclick=null}function n(s){s.style.position="absolute",s.style.bottom="20px",s.style.padding="12px 6px",s.style.border="1px solid #fff",s.style.borderRadius="4px",s.style.background="transparent",s.style.color="#fff",s.style.font="normal 13px sans-serif",s.style.textAlign="center",s.style.opacity="0.5",s.style.outline="none",s.style.zIndex="999"}if("xr"in navigator){var r=document.createElement("button");return r.style.display="none",n(r),navigator.xr.isSessionSupported("immersive-vr").then(function(s){return s?t(r):e(r)}),r}var a=document.createElement("a");return a.href="https://webvr.info",a.innerHTML="WEBXR NOT SUPPORTED",a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",n(a),a}var WebVRPoC=function(){function o(t){_classCallCheck(this,o),this._mainCamera=new PerspectiveCamera,this._button=null,this._onToggle=t,this._molContainer=new gfxutils.RCGroup,this._user=new gfxutils.RCGroup,this._scalingPivot=new Object3D,this._user.add(this._scalingPivot),this._controller1=null,this._controller2=null,this._pressedGripsCounter=0,this._distance=0,this._gfx=null}return _createClass(o,[{key:"startScalingByControllers",value:function(){this._distance=this._controller1.position.distanceTo(this._controller2.position),gfxutils.getMiddlePoint(this._controller1.position,this._controller2.position,this._scalingPivot.position),this._scalingPivot.scale.set(1,1,1),this._scalingPivot.updateMatrix(),this._scalingPivot.updateMatrixWorld(),this._scalingPivot.addSavingWorldTransform(this._molContainer)}},{key:"stopScalingByControllers",value:function(){this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsDown",value:function(e){this._pressedGripsCounter++,this._pressedGripsCounter===2?this.startScalingByControllers():this._pressedGripsCounter===1&&e.target.addSavingWorldTransform(this._molContainer)}},{key:"handleGripsUp",value:function(e){if(this._pressedGripsCounter--,this._pressedGripsCounter===1){this.stopScalingByControllers();var n=e.target===this._controller1?this._controller2:this._controller1;n.addSavingWorldTransform(this._molContainer)}else this._pressedGripsCounter===0&&this._gfx.scene.addSavingWorldTransform(this._molContainer)}},{key:"enable",value:function(e){if(!e){logger.warn("WebVR couldn't be enabled, because gfx is not defined");return}this._gfx=e;var n=e.renderer,r=e.camera;if(!n)throw new Error("No renderer is available to toggle WebVR");if(!r)throw new Error("No camera is available to toggle WebVR");n.xr.enabled=!0,this._button?this._button.style.display="block":(this._button=createWebVRButton(this),document.body.appendChild(this._button)),this._mainFog=settings$1.now.fog,settings$1.set("fog",!1),this._plugVRNodesIntoScene(e,n),this._setControllersListeners(),this._onToggle&&this._onToggle(!0)}},{key:"_plugVRNodesIntoScene",value:function(e,n){this._mainCamera.copy(e.camera),e.scene.add(this._user),e.scene.add(this._molContainer),this._molContainer.add(e.root),this._controller1=n.xr.getController(0),this._controller2=n.xr.getController(1);var r=this._createControllerMesh();this._controller1.add(r),this._controller2.add(r.clone()),this._user.add(this._controller1),this._user.add(this._controller2)}},{key:"_setControllersListeners",value:function(){var e=this;this._controller1.addEventListener("selectstart",function(n){e.handleGripsDown(n)}),this._controller1.addEventListener("selectend",function(n){e.handleGripsUp(n)}),this._controller2.addEventListener("selectstart",function(n){e.handleGripsDown(n)}),this._controller2.addEventListener("selectend",function(n){e.handleGripsUp(n)}),this._controller1.addEventListener("squeezestart",function(n){e.handleGripsDown(n)}),this._controller1.addEventListener("squeezeend",function(n){e.handleGripsUp(n)}),this._controller2.addEventListener("squeezestart",function(n){e.handleGripsDown(n)}),this._controller2.addEventListener("squeezeend",function(n){e.handleGripsUp(n)})}},{key:"disable",value:function(){if(this._gfx){var e=this._gfx,n=e.renderer,r=e.camera;if(!n)throw new Error("No renderer is available to toggle WebVR");n.setAnimationLoop(null);var a=n.xr.getSession();a&&a.end(),n.xr.enabled=!1,this._button&&(this._button.style.display="none"),settings$1.set("fog",this._mainFog),this._unplugVRNodesFromScene(r),this._onToggle&&this._onToggle(!1)}}},{key:"_unplugVRNodesFromScene",value:function(e){this._mainCamera&&e&&e.copy(this._mainCamera);var n=this._molContainer.children[0];n&&this._gfx.scene.add(n),this._molContainer.parent.remove(this._molContainer),this._user&&this._gfx.scene.remove(this._user),this._molContainer=null,this._user=null,this._scalingPivot=null,this._user=null,this._controller1=null,this._controller2=null}},{key:"_createControllerMesh",value:function(){var e=new CylinderGeometry(.04,.04,.3),n=new UberMaterial;n.setValues({lights:!1,overrideColor:!0}),n.setUberOptions({fixedColor:new Color(4474111)}),n.updateUniforms();var r=new Mesh(e,n);return r.rotateX(-Math.PI/2),r}},{key:"updateMoleculeScale",value:function(){if(!(!this._controller1||!this._controller2)){var e=this;if(e._pressedGripsCounter===2){gfxutils.getMiddlePoint(e._controller1.position,e._controller2.position,e._scalingPivot.position);var n=e._controller1.position.distanceTo(e._controller2.position),r=n/e._distance;e._scalingPivot.scale.multiplyScalar(r),e._distance=n}}}},{key:"moveSceneBehindHeadset",value:function(){var e=this._gfx,n=e.camera,r=this._molContainer;r.matrix.identity(),r.position.set(0,0,-4),r.updateMatrix(),r.matrixWorld.multiplyMatrices(n.matrixWorld,r.matrix),e.scene.addSavingWorldTransform(r),this._onToggle&&this._onToggle(!0)}},{key:"getCanvas",value:function(){var e=this._gfx;return e&&e.renderer?e.renderer.domElement:null}}]),o}(),fragmentScreenQuadFromDistTex=`precision highp float;\r
\r
varying vec2 vUv;\r
uniform sampler2D srcTex;\r
uniform vec3 aberration;\r
\r
void main() {\r
  vec2 uv = vUv * 2.0 - 1.0;\r
  \r
  gl_FragColor.r = texture2D(srcTex, 0.5 * (uv * aberration[0] + 1.0)).r;\r
  gl_FragColor.g = texture2D(srcTex, 0.5 * (uv * aberration[1] + 1.0)).g;\r
  gl_FragColor.b = texture2D(srcTex, 0.5 * (uv * aberration[2] + 1.0)).b;\r
  gl_FragColor.a = 1.0;\r
}`;function _createSuper(o){var t=_isNativeReflectConstruct();return function(){var n=_getPrototypeOf(o),r;if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var selectors$1=chem.selectors,Atom=chem.Atom,Residue=chem.Residue,Chain=chem.Chain,Molecule=chem.Molecule,EDIT_MODE={COMPLEX:0,COMPONENT:1,FRAGMENT:2},LOADER_NOT_FOUND="Could not find suitable loader for this source",PARSER_NOT_FOUND="Could not find suitable parser for this source",createElement=utils.createElement;function updateFogRange(o,t,e){o.near=t-e*settings$1.now.fogNearFactor,o.far=t+e*settings$1.now.fogFarFactor}function removeExtension(o){var t=o.lastIndexOf(".");return t>=0&&(o=o.substr(0,t)),o}function hasValidResidues(o){var t=!1;return o.forEachComponent(function(e){e.forEachResidue(function(n){n._isValid&&(t=!0)})}),t}function reportProgress(o,t,e){var n=100;e!==void 0?o.debug("".concat(t,"... ").concat(Math.floor(e*n),"%")):o.debug("".concat(t,"..."))}function chooseFogColor(){return settings$1.now.fogColorEnable?settings$1.now.fogColor:settings$1.now.bg.color}function _setContainerContents(o,t){for(var e=o;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t)}function arezSpritesSupported(o){return o.getExtension("EXT_frag_depth")}function isAOSupported(o){return o.getExtension("WEBGL_depth_texture")&&o.getExtension("WEBGL_draw_buffers")}var rePdbId=/^(?:(pdb|cif|mmtf|ccp4|dsn6):\s*)?(\d[a-z\d]{3})$/i,rePubchem=/^(?:pc|pubchem):\s*([a-z]+)$/i,reUrlScheme=/^([a-z][a-z\d\-+.]*):/i;function resolveSourceShortcut(o,t){if(!lodashExports.isString(o))return o;var e=rePdbId.exec(o);if(e){var n=_slicedToArray(e,3),r=n[1],a=r===void 0?"pdb":r,s=n[2];switch(a=a.toLowerCase(),s=s.toUpperCase(),a){case"pdb":o="https://files.rcsb.org/download/".concat(s,".pdb");break;case"cif":o="https://files.rcsb.org/download/".concat(s,".cif");break;case"mmtf":o="https://mmtf.rcsb.org/v1.0/full/".concat(s);break;case"ccp4":o="https://www.ebi.ac.uk/pdbe/coordinates/files/".concat(s.toLowerCase(),".ccp4");break;case"dsn6":o="https://edmaps.rcsb.org/maps/".concat(s.toLowerCase(),"_2fofc.dsn6");break;default:throw new Error("Unexpected data format shortcut")}return t.fileType=a,t.fileName="".concat(s,".").concat(a),t.sourceType="url",o}var l=rePubchem.exec(o);if(l){var c=l[1].toLowerCase();return o="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/".concat(c,"/JSON?record_type=3d"),t.fileType="pubchem",t.fileName="".concat(c,".json"),t.sourceType="url",o}return(t.sourceType==="url"||t.sourceType===void 0)&&(t.sourceType="url",reUrlScheme.test(o)||(o=utils.resolveURL(o))),o}function updateBinaryMode(o){var t=o.binary;if(o.fileType!==void 0){var e=lodashExports.head(io.parsers.find({format:o.fileType}));if(e)t=e.binary||!1;else throw new Error("Could not find suitable parser for this format")}if(t===void 0&&o.fileExt!==void 0){var n=lodashExports.head(io.parsers.find({ext:o.fileExt}));n&&(t=n.binary||!1)}o.fileExt!==void 0&&o.fileExt.toLowerCase()===".man"&&(o.binary=!0,o.animation=!0),t!==void 0&&o.binary!==void 0&&o.binary!==t&&o.context.logger.warn("Overriding incorrect binary mode"),o.binary=t||!1}function _fetchData(o,t,e){return new Promise(function(n){if(e.shouldCancel())throw new Error("Operation cancelled");e.notify({type:"fetching"}),o=resolveSourceShortcut(o,t);var r=lodashExports.head(io.loaders.find({type:t.sourceType,source:o}));if(!r)throw new Error(LOADER_NOT_FOUND);var a=t.fileName||r.extractName(o);if(a){var s=utils.splitFileName(a),l=_slicedToArray(s,2),c=l[0],u=l[1];lodashExports.defaults(t,{name:c,fileExt:u,fileName:a})}updateBinaryMode(t);var f=lodashExports.get(t,"preset.expression");if(!lodashExports.isUndefined(f)&&(f=JSON.parse(f),f&&f.settings))for(var p=["singleUnit"],g=0,y=p.length;g<y;++g){var E=p[g],h=lodashExports.get(f.settings,E);lodashExports.isUndefined(h)||settings$1.set(E,h)}var v=new r(o,t);v.context=t.context,e.addEventListener("cancel",function(){return v.abort()}),v.addEventListener("progress",function(x){x.lengthComputable&&x.total>0?reportProgress(v.logger,"Fetching",x.loaded/x.total):reportProgress(v.logger,"Fetching")}),console.time("fetch");var C=v.load().then(function(x){return console.timeEnd("fetch"),t.context.logger.info("Fetching finished"),e.notify({type:"fetchingDone",data:x}),x}).catch(function(x){throw console.timeEnd("fetch"),t.context.logger.debug(x.message),x.stack&&t.context.logger.debug(x.stack),t.context.logger.error("Fetching failed"),e.notify({type:"fetchingDone",error:x}),x});n(C)})}function _parseData(o,t,e){if(e.shouldCancel())return Promise.reject(new Error("Operation cancelled"));e.notify({type:"parsing"});var n=lodashExports.head(io.parsers.find({format:t.fileType,ext:t.fileExt,data:o}));if(!n)return Promise.reject(new Error("Could not find suitable parser"));var r=new n(o,t);return r.context=t.context,e.addEventListener("cancel",function(){return r.abort()}),console.time("parse"),r.parse().then(function(a){return console.timeEnd("parse"),e.notify({type:"parsingDone",data:a}),a}).catch(function(a){throw console.timeEnd("parse"),t.error=a,t.context.logger.debug(a.message),a.stack&&t.context.logger.debug(a.stack),t.context.logger.error("Parsing failed"),e.notify({type:"parsingDone",error:a}),a})}function _includesInCurSelection(o,t){return o.mask&1<<t}function _includesInSelector(o,t){return t.selector.includesAtom(o)}var Miew=function(o){_inherits(e,o);var t=_createSuper(e);function e(n){var r;_classCallCheck(this,e),r=t.call(this),r._opts=lodashExports.merge({settingsCookie:"settings",cookiePath:"/"},n),r._gfx=null,r._interpolator=new ViewInterpolator,r._container=n&&n.container||document.getElementById("miew-container")||lodashExports.head(document.getElementsByClassName("miew-container"))||document.body,r._containerRoot=r._container,r._running=!1,r._halting=!1,r._building=!1,r._needRender=!0,r._hotKeysEnabled=!0,r.settings=settings$1;var a=logger;a.console=!1,a.level="info",r.logger=a,r._cookies=new Cookies(_assertThisInitialized(r)),r.restoreSettings(),n&&n.settings&&r.settings.set(n.settings),r._spinner=null,r._loading=[],r._animInterval=null,r._visuals={},r._curVisualName=null,r._objects=[],r._sourceWindow=null,r.reset(),r._repr&&a.debug("Selected ".concat(r._repr.mode.name," mode with ").concat(r._repr.colorer.name," colorer."));var s=_assertThisInitialized(r);return e.registeredPlugins.forEach(function(l){l.call(s)}),r._initOnSettingsChanged(),r.shadowMatrix=new Matrix4,r.direction=new Vector3,r.OBB={center:new Vector3,halfSize:new Vector3},r._bSphereForOneVisual=new Sphere,r._bBoxForOneVisual=new Box3,r._bBox=new Box3,r._invMatrix=new Matrix4,r._points=[new Vector3,new Vector3,new Vector3,new Vector3],r._anaglyphMat=new AnaglyphMaterial,r._size=new Vector2,r._scene=new Scene,r._camera=new OrthographicCamera(-1,1,1,-1,-500,1e3),r._material=new RawShaderMaterial({uniforms:{srcTex:{type:"t",value:null},aberration:{type:"fv3",value:new Vector3(1)}},vertexShader:vertexScreenQuadShader,fragmentShader:fragmentScreenQuadFromDistTex,transparent:!1,depthTest:!1,depthWrite:!1}),r._geo=gfxutils.buildDistorionMesh(10,10,settings$1.now.debug.stereoBarrel),r._outlineMaterial=new OutlineMaterial({depth:!0}),r.pars={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat},r.VERSION="0.10.0+20220125.134627.b36f6a2-mod",r}return _createClass(e,[{key:"getMaxRepresentationCount",value:function(){return ComplexVisual.NUM_REPRESENTATION_BITS}},{key:"_updateShadowCamera",value:function(){this._gfx.scene.updateMatrixWorld();for(var r=0;r<this._gfx.scene.children.length;r++)if(this._gfx.scene.children[r].type==="DirectionalLight"){var a=this._gfx.scene.children[r];this.shadowMatrix.copy(a.shadow.camera.matrixWorldInverse),this.getOBB(this.shadowMatrix,this.OBB),this.direction.subVectors(a.target.position,a.position),a.position.subVectors(this.OBB.center,this.direction),a.target.position.copy(this.OBB.center),a.shadow.bias=.09,a.shadow.camera.bottom=-this.OBB.halfSize.y,a.shadow.camera.top=this.OBB.halfSize.y,a.shadow.camera.right=this.OBB.halfSize.x,a.shadow.camera.left=-this.OBB.halfSize.x,a.shadow.camera.near=this.direction.length()-this.OBB.halfSize.z,a.shadow.camera.far=this.direction.length()+this.OBB.halfSize.z,a.shadow.camera.updateProjectionMatrix()}}},{key:"init",value:function(){var r=this._container,a=utils.createElement("div",{class:"miew-canvas"});_setContainerContents(r,a),this._container=a;var s=document.createDocumentFragment();if(s.appendChild(this._msgMode=createElement("div",{class:"mode-message overlay"},createElement("p",{},"COMPONENT EDIT MODE"))),s.appendChild(this._msgAtomInfo=createElement("div",{class:"atom-info overlay"},createElement("p",{},""))),r.appendChild(s),this._gfx!==null)return!0;var l=this;this._showMessage("Viewer is being initialized...");try{this._initGfx(),this._initListeners(),this._spinner=new Spinner({lines:13,length:28,width:14,radius:42,color:"#fff",zIndex:700}),window.top.addEventListener("keydown",function(p){l._onKeyDown(p)}),window.top.addEventListener("keyup",function(p){l._onKeyUp(p)}),this._objectControls=new ObjectControls(this._gfx.root,this._gfx.pivot,this._gfx.camera,this._gfx.renderer.domElement,function(){return l._getAltObj()}),this._objectControls.addEventListener("change",function(p){switch(settings$1.now.shadow.on&&l._updateShadowCamera(),p.action){case"rotate":l.dispatchEvent({type:"rotate",quaternion:p.quaternion});break;case"zoom":l.dispatchEvent({type:"zoom",factor:p.factor});break;default:l.dispatchEvent({type:p.action})}l.dispatchEvent({type:"transform"}),l._needRender=!0});var c=this._gfx;this._picker=new Picker(c.root,c.camera,c.renderer.domElement),this._picker.addEventListener("newpick",function(p){l._onPick(p)}),this._picker.addEventListener("dblclick",function(p){l.center(p)})}catch(p){if(p.name==="TypeError"&&p.message==="Cannot read property 'getExtension' of null")this._showMessage("Could not create WebGL context.");else if(p.message.search(/webgl/i)>1)this._showMessage(p.message);else throw this._showMessage("Viewer initialization failed."),p;return!1}var u=this._opts&&this._opts.load;if(u){var f=this._opts&&this._opts.type;this.load(u,{fileType:f,keepRepsInfo:!0})}return!0}},{key:"term",value:function(){this._showMessage("Viewer has been terminated."),this._loading.forEach(function(r){r.cancel()}),this._loading.length=0,this.halt(),this._gfx=null}},{key:"_showMessage",value:function(r){var a=document.createElement("div");a.setAttribute("class","miew-message"),a.appendChild(document.createElement("p")).appendChild(document.createTextNode(r)),_setContainerContents(this._container,a)}},{key:"_showCanvas",value:function(){_setContainerContents(this._container,this._gfx.renderer.domElement)}},{key:"_requestAnimationFrame",value:function(r){var a=this._gfx.renderer.xr;if(a&&a.enabled){this._gfx.renderer.setAnimationLoop(r);return}requestAnimationFrame(r)}},{key:"_initGfx",value:function(){var r={width:this._container.clientWidth,height:this._container.clientHeight},a={preserveDrawingBuffer:!0,alpha:!0,premultipliedAlpha:!1};settings$1.now.antialias&&(a.antialias=!0),r.renderer2d=new CSS2DRenderer,r.renderer=new WebGL1Renderer(a),r.renderer.shadowMap.enabled=settings$1.now.shadow.on,r.renderer.shadowMap.autoUpdate=!1,r.renderer.shadowMap.type=PCFShadowMap,capabilities.init(r.renderer),arezSpritesSupported(r.renderer.getContext())||settings$1.set("zSprites",!1),isAOSupported(r.renderer.getContext())||settings$1.set("ao",!1),r.renderer.autoClear=!1,r.renderer.setPixelRatio(window.devicePixelRatio),r.renderer.setSize(r.width,r.height),r.renderer.setClearColor(settings$1.now.bg.color,+!settings$1.now.bg.transparent),r.renderer.clearColor(),r.renderer2d.setSize(r.width,r.height),r.camera=new PerspectiveCamera(settings$1.now.camFov,r.width/r.height,settings$1.now.camNear,settings$1.now.camFar),r.camera.setMinimalFov(settings$1.now.camFov),r.camera.position.z=settings$1.now.camDistance,r.camera.updateProjectionMatrix(),r.camera.layers.set(gfxutils.LAYERS.DEFAULT),r.camera.layers.enable(gfxutils.LAYERS.VOLUME),r.camera.layers.enable(gfxutils.LAYERS.VOLUME_BFPLANE),r.stereoCam=new StereoCamera,r.scene=new Scene;var s=chooseFogColor();r.scene.fog=new Fog(s,settings$1.now.camNear,settings$1.now.camFar),r.root=new gfxutils.RCGroup,r.scene.add(r.root),r.pivot=new gfxutils.RCGroup,r.root.add(r.pivot),r.selectionScene=new Scene,r.selectionRoot=new Group,r.selectionRoot.matrixAutoUpdate=!1,r.selectionScene.add(r.selectionRoot),r.selectionPivot=new Group,r.selectionPivot.matrixAutoUpdate=!1,r.selectionRoot.add(r.selectionPivot);var l=new DirectionalLight(16777215,.45);l.position.set(0,.414,1),l.layers.enable(gfxutils.LAYERS.TRANSPARENT),l.castShadow=!0,l.shadow.bias=.09,l.shadow.radius=settings$1.now.shadow.radius,l.shadow.camera.layers.set(gfxutils.LAYERS.SHADOWMAP);var c=r.renderer.getPixelRatio(),u=Math.max(r.width,r.height)*c;l.shadow.mapSize.width=u,l.shadow.mapSize.height=u,l.target.position.set(0,0,0),r.scene.add(l),r.scene.add(l.target);var f=new AmbientLight(6710886);f.layers.enable(gfxutils.LAYERS.TRANSPARENT),r.scene.add(f),r.axes=new Axes(r.root,r.camera);var p=r.width*c,g=r.height*c;r.offscreenBuf=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat,depthBuffer:!0}),r.renderer.getContext().getExtension("WEBGL_depth_texture")&&(r.offscreenBuf.depthTexture=new DepthTexture,r.offscreenBuf.depthTexture.type=UnsignedShortType),r.offscreenBuf2=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthBuffer:!1}),r.offscreenBuf3=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthBuffer:!1}),r.offscreenBuf4=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthBuffer:!1}),r.volBFTex=r.offscreenBuf3,r.volFFTex=r.offscreenBuf4,r.volWFFTex=r.offscreenBuf,r.renderer.getContext().getExtension("OES_texture_float")?(r.offscreenBuf5=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:FloatType,depthBuffer:!1}),r.offscreenBuf6=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:FloatType,depthBuffer:!1}),r.offscreenBuf7=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:FloatType,depthBuffer:!0}),r.volBFTex=r.offscreenBuf5,r.volFFTex=r.offscreenBuf6,r.volWFFTex=r.offscreenBuf7):this.logger.warn("Device doesn't support OES_texture_float extension"),r.stereoBufL=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthBuffer:!1}),r.stereoBufR=new WebGLRenderTarget(p,g,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthBuffer:!1}),this._gfx=r,this._showCanvas(),this._embedWebXR(settings$1.now.stereo==="WEBVR"),this._container.appendChild(r.renderer2d.getElement());var y=new Stats;y.domElement.style.position="absolute",y.domElement.style.right="0",y.domElement.style.bottom="0",this._container.appendChild(y.domElement),this._fps=y,this._fps.show(settings$1.now.fps)}},{key:"_initListeners",value:function(){var r=this;window.addEventListener("resize",function(){r._onResize()})}},{key:"_makeUniqueVisualName",value:function(r){if(!r)return Math.random().toString();for(var a=r,s=1;this._visuals.hasOwnProperty(a);)a="".concat(r," (").concat(s.toString(),")"),s++;return a}},{key:"_addVisual",value:function(r){if(!r)return null;var a=this._makeUniqueVisualName(r.name);return r.name=a,this._visuals[a]=r,this._gfx.pivot.add(r),r.getSelectionGeo&&this._gfx.selectionPivot.add(r.getSelectionGeo()),a}},{key:"_removeVisual",value:function(r){var a="",s=null;r instanceof Visual?(a=r.name,s=r):typeof r=="string"&&(a=r,s=this._visuals[a]),!(!s||!this._visuals.hasOwnProperty(a)||this._visuals[a]!==s)&&(a===this._curVisualName&&(this._curVisualName=void 0),delete this._visuals[a],s.release(),this._needRender=!0)}},{key:"_forEachVisual",value:function(r){for(var a in this._visuals)this._visuals.hasOwnProperty(a)&&r(this._visuals[a])}},{key:"_releaseAllVisuals",value:function(){if(!(!this._gfx||!this._gfx.pivot)){for(var r in this._visuals)this._visuals.hasOwnProperty(r)&&this._visuals[r].release();this._visuals={}}}},{key:"_forEachComplexVisual",value:function(r){if(!(!this._gfx||!this._gfx.pivot))for(var a in this._visuals)this._visuals.hasOwnProperty(a)&&this._visuals[a]instanceof ComplexVisual&&r(this._visuals[a])}},{key:"_getComplexVisual",value:function(r){r=r||this._curVisualName;var a=null,s=null;return this._forEachComplexVisual(function(l){a=l,l.name===r&&(s=l)}),s||a}},{key:"_getVolumeVisual",value:function(){var r=null;return this._forEachVisual(function(a){a instanceof VolumeVisual&&(r=a)}),r}},{key:"_getVisualForComplex",value:function(r){if(!r)return null;var a=null;return this._forEachComplexVisual(function(s){s.getComplex()===r&&(a=s)}),a}},{key:"getVisuals",value:function(){return Object.keys(this._visuals)}},{key:"getComplexVisualsCount",value:function(){var r=0;return this._forEachComplexVisual(function(){return r++}),r}},{key:"getCurrentVisual",value:function(){return this._curVisualName}},{key:"setCurrentVisual",value:function(r){this._visuals[r]&&(this._curVisualName=r)}},{key:"run",value:function(){var r=this;if(!this._running){if(this._running=!0,this._halting){this._halting=!1;return}this._objectControls.enable(!0),this._interpolator.resume(),this._requestAnimationFrame(function(){return r._onTick()})}}},{key:"halt",value:function(){this._running&&(this._discardComponentEdit(),this._discardFragmentEdit(),this._objectControls.enable(!1),this._interpolator.pause(),this._halting=!0)}},{key:"enableHotKeys",value:function(r){this._hotKeysEnabled=r,this._objectControls.enableHotkeys(r)}},{key:"_onResize",value:function(){this._needRender=!0;var r=this._gfx;r.width=this._container.clientWidth,r.height=this._container.clientHeight,r.camera.aspect=r.width/r.height,r.camera.setMinimalFov(settings$1.now.camFov),r.camera.updateProjectionMatrix(),r.renderer.setSize(r.width,r.height),r.renderer2d.setSize(r.width,r.height),this.dispatchEvent({type:"resize"})}},{key:"_resizeOffscreenBuffers",value:function(r,a,s){var l=this._gfx;s=s||"NONE";var c=s==="NONE"||s==="ANAGLYPH",u=c?1:.5;l.offscreenBuf.setSize(u*r,a),l.offscreenBuf2.setSize(u*r,a),l.offscreenBuf3.setSize(u*r,a),l.offscreenBuf4.setSize(u*r,a),l.offscreenBuf5&&l.offscreenBuf5.setSize(u*r,a),l.offscreenBuf6&&l.offscreenBuf6.setSize(u*r,a),l.offscreenBuf7&&l.offscreenBuf7.setSize(u*r,a),c&&(l.stereoBufL.setSize(r,a),l.stereoBufR.setSize(r,a))}},{key:"_onTick",value:function(){var r=this;if(this._halting){this._running=!1,this._halting=!1;return}this._fps.update(),this._requestAnimationFrame(function(){return r._onTick()}),this._onUpdate(),this._needRender&&(this._onRender(),this._needRender=!settings$1.now.suspendRender||settings$1.now.stereo==="WEBVR")}},{key:"_getBSphereRadius",value:function(){var r=0;return this._forEachVisual(function(a){r=Math.max(r,a.getBoundaries().boundingSphere.radius)}),r*this._objectControls.getScale()}},{key:"getOBB",value:function(r,a){var s=this;this._bBox.makeEmpty(),this._forEachVisual(function(p){s._bSphereForOneVisual.copy(p.getBoundaries().boundingSphere),s._bSphereForOneVisual.applyMatrix4(p.matrixWorld).applyMatrix4(r),s._bSphereForOneVisual.getBoundingBox(s._bBoxForOneVisual),s._bBox.union(s._bBoxForOneVisual)}),this._bBox.getCenter(a.center),this._invMatrix.copy(r).invert(),a.center.applyMatrix4(this._invMatrix);var l=this._bBox.min,c=this._bBox.max;this._points[0].set(l.x,l.y,l.z),this._points[1].set(c.x,l.y,l.z),this._points[2].set(l.x,c.y,l.z),this._points[3].set(l.x,l.y,c.z);for(var u=0,f=this._points.length;u<f;u++)this._points[u].applyMatrix4(this._invMatrix);a.halfSize.set(Math.abs(this._points[0].x-this._points[1].x),Math.abs(this._points[0].y-this._points[2].y),Math.abs(this._points[0].z-this._points[3].z)).multiplyScalar(.5)}},{key:"_updateFog",value:function(){var r=this._gfx;if(settings$1.now.fog){if(typeof r.scene.fog>"u"||r.scene.fog===null){var a=chooseFogColor();r.scene.fog=new Fog(a),this._setUberMaterialValues({fog:settings$1.now.fog})}updateFogRange(r.scene.fog,r.camera.position.z,this._getBSphereRadius())}else r.scene.fog&&(r.scene.fog=void 0,this._setUberMaterialValues({fog:settings$1.now.fog}))}},{key:"_onUpdate",value:function(){this.isScriptingCommandAvailable!==void 0&&this.isScriptingCommandAvailable()&&!this._building&&this.callNextCmd(),this._objectControls.update(),this._forEachComplexVisual(function(r){r.getComplex().update()}),settings$1.now.autobuild&&!this._loading.length&&!this._building&&this._needRebuild()&&this.rebuild(),!this._loading.length&&!this._building&&!this._needRebuild()&&this._updateView(),this._updateFog(),this._gfx.renderer.xr.enabled&&this.webVR.updateMoleculeScale()}},{key:"_onRender",value:function(){var r=this._gfx;r.scene.updateMatrixWorld(),r.camera.updateMatrixWorld(),this._clipPlaneUpdateValue(this._getBSphereRadius()),this._fogFarUpdateValue(),r.renderer.setRenderTarget(null),r.renderer.clear(),this._renderFrame(settings$1.now.stereo)}},{key:"_renderFrame",value:function(r){var a=this._gfx,s=a.renderer;s.getSize(this._size),r!=="NONE"&&(a.camera.focus=a.camera.position.z,a.stereoCam.aspect=1,r==="ANAGLYPH"?a.stereoCam.update(a.camera):a.stereoCam.updateHalfSized(a.camera,settings$1.now.camFov));var l=a.renderer.getPixelRatio();switch(this._resizeOffscreenBuffers(this._size.width*l,this._size.height*l,r),this._renderShadowMap(),r){case"WEBVR":case"NONE":this._renderScene(a.camera,!1);break;case"SIMPLE":case"DISTORTED":s.setScissorTest(!0),s.setScissor(0,0,this._size.width/2,this._size.height),s.setViewport(0,0,this._size.width/2,this._size.height),this._renderScene(this._gfx.stereoCam.cameraL,r==="DISTORTED"),s.setScissor(this._size.width/2,0,this._size.width/2,this._size.height),s.setViewport(this._size.width/2,0,this._size.width/2,this._size.height),this._renderScene(this._gfx.stereoCam.cameraR,r==="DISTORTED"),s.setScissorTest(!1);break;case"ANAGLYPH":this._renderScene(this._gfx.stereoCam.cameraL,!1,a.stereoBufL),this._renderScene(this._gfx.stereoCam.cameraR,!1,a.stereoBufR),s.setRenderTarget(null),this._anaglyphMat.uniforms.srcL.value=a.stereoBufL.texture,this._anaglyphMat.uniforms.srcR.value=a.stereoBufR.texture,a.renderer.renderScreenQuad(this._anaglyphMat);break}a.renderer2d.render(a.scene,a.camera),settings$1.now.axes&&a.axes&&!a.renderer.xr.enabled&&a.axes.render(s)}},{key:"_onBgColorChanged",value:function(){var r=this._gfx,a=chooseFogColor();r&&(r.scene.fog&&r.scene.fog.color.set(a),r.renderer.setClearColor(settings$1.now.bg.color,+!settings$1.now.bg.transparent)),this._needRender=!0}},{key:"_onFogColorChanged",value:function(){var r=this._gfx,a=chooseFogColor();r&&r.scene.fog&&r.scene.fog.color.set(a),this._needRender=!0}},{key:"_setUberMaterialValues",value:function(r){this._gfx.root.traverse(function(a){(a instanceof Mesh||a instanceof LineSegments||a instanceof Line)&&a.material instanceof UberMaterial&&(a.material.setValues(r),a.material.needsUpdate=!0)})}},{key:"_enableMRT",value:function(r,a,s){var l=this._gfx,c=l.renderer.getContext(),u=c.getExtension("WEBGL_draw_buffers"),f=l.renderer.properties;if(!r){u.drawBuffersWEBGL([c.COLOR_ATTACHMENT0,null]);return}l.renderer.setRenderTarget(s);var p=f.get(s.texture).__webglTexture;c.bindTexture(c.TEXTURE_2D,p),l.renderer.setRenderTarget(a);var g=f.get(a).__webglFramebuffer,y=f.get(a.texture).__webglTexture;c.bindFramebuffer(c.FRAMEBUFFER,g),g.width=a.width,g.height=a.height,c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,y,0),c.framebufferTexture2D(c.FRAMEBUFFER,u.COLOR_ATTACHMENT1_WEBGL,c.TEXTURE_2D,p,0),u.drawBuffersWEBGL([c.COLOR_ATTACHMENT0,u.COLOR_ATTACHMENT1_WEBGL])}},{key:"_renderScene",value:function(r,a,s){a=a||!1,s=s||null;var l=this._gfx;if(l.renderer.setClearColor(settings$1.now.bg.color,+!settings$1.now.bg.transparent),l.renderer.setRenderTarget(s),l.renderer.clear(),l.renderer.xr.enabled){l.renderer.render(l.scene,r);return}l.renderer.setClearColor(0,0),l.renderer.setRenderTarget(l.offscreenBuf4),l.renderer.clearColor(),l.renderer.setClearColor(settings$1.now.bg.color,+!settings$1.now.bg.transparent),l.renderer.setRenderTarget(l.offscreenBuf),l.renderer.clear();var c=this._getComplexVisual()!==null,u=this._getVolumeVisual(),f=c&&settings$1.now.ao;f&&this._enableMRT(!0,l.offscreenBuf,l.offscreenBuf4),settings$1.now.transparency==="prepass"?this._renderWithPrepassTransparency(r,l.offscreenBuf):settings$1.now.transparency==="standard"&&(l.renderer.setRenderTarget(l.offscreenBuf),l.renderer.render(l.scene,r)),f&&this._enableMRT(!1,null,null);var p=c&&settings$1.now.outline.on,g=c&&settings$1.now.fxaa,y=u!==null&&u.getMesh().material!=null,E=f||p||y||g||a?l.offscreenBuf2:s,h=l.offscreenBuf;f?(this._performAO(h,l.offscreenBuf4,l.offscreenBuf.depthTexture,E,l.offscreenBuf3,l.offscreenBuf2),!g&&!a&&!y&&!p&&(h=E,E=s,l.renderer.setRenderTarget(E),l.renderer.renderScreenQuadFromTex(h.texture,1))):(l.renderer.setRenderTarget(E),l.renderer.renderScreenQuadFromTex(h.texture,1)),p&&(h=E,E=y||g||a?l.offscreenBuf3:s,h!=null&&this._renderOutline(r,l.offscreenBuf,h,E)),this._renderSelection(r,l.offscreenBuf,E),y&&(l.renderer.setRenderTarget(l.offscreenBuf),l.renderer.renderScreenQuadFromTex(E.texture,1),E=l.offscreenBuf,this._renderVolume(u,r,E,l.volBFTex,l.volFFTex,l.volWFFTex),!g&&!a&&(l.renderer.setRenderTarget(s),l.renderer.renderScreenQuadFromTex(E.texture,1))),h=E,g&&(E=a?l.offscreenBuf4:s,this._performFXAA(h,E),h=E),a&&(E=s,this._performDistortion(h,E,!0))}},{key:"_performDistortion",value:function(r,a,s){this._scene.add(new meshes.Mesh(this._geo,this._material)),this._gfx.renderer.setRenderTarget(a),this._gfx.renderer.clear(),s?(this._material.uniforms.srcTex.value=r.texture,this._material.uniforms.aberration.value.set(.995,1,1.01),this._gfx.renderer.render(this._scene,this._camera)):this._gfx.renderer.renderScreenQuadFromTexWithDistortion(r,settings$1.now.debug.stereoBarrel)}},{key:"_renderOutline",value:function(r,a,s,l){var c=this,u=c._gfx;this._outlineMaterial.uniforms.srcTex.value=s.texture,this._outlineMaterial.uniforms.srcDepthTex.value=a.depthTexture,this._outlineMaterial.uniforms.srcTexSize.value.set(a.width,a.height),this._outlineMaterial.uniforms.color.value=new Color(settings$1.now.outline.color),this._outlineMaterial.uniforms.threshold.value=settings$1.now.outline.threshold,this._outlineMaterial.uniforms.thickness.value=new Vector2(settings$1.now.outline.thickness,settings$1.now.outline.thickness),u.renderer.setRenderTarget(l),u.renderer.renderScreenQuad(this._outlineMaterial)}},{key:"_renderShadowMap",value:function(){if(settings$1.now.shadow.on){var r=this._gfx,a=r.renderer.getRenderTarget(),s=r.renderer.getActiveCubeFace(),l=r.renderer.getActiveMipmapLevel(),c=r.renderer.state;c.setBlending(NoBlending),c.buffers.color.setClear(1,1,1,1),c.buffers.depth.setTest(!0),c.setScissorTest(!1);for(var u=0;u<r.scene.children.length;u++)if(r.scene.children[u].type==="DirectionalLight"){var f=r.scene.children[u];f.shadow.map==null&&(f.shadow.map=new WebGLRenderTarget(f.shadow.mapSize.width,f.shadow.mapSize.height,this.pars),f.shadow.camera.updateProjectionMatrix()),f.shadow.updateMatrices(f),r.renderer.setRenderTarget(f.shadow.map),r.renderer.clear(),r.renderer.render(r.scene,f.shadow.camera)}r.renderer.setRenderTarget(a,s,l)}}},{key:"_hasSelectionToRender",value:function(){for(var r=this._gfx.selectionPivot,a=0;a<r.children.length;a++){var s=r.children[a];if(s.children.length>0)return!0}return!1}},{key:"_renderSelection",value:function(r,a,s){var l=new OutlineMaterial,c=this,u=c._gfx;u.renderer.setClearColor("black",0),u.renderer.setRenderTarget(a),u.renderer.clear(!0,!1,!1),c._hasSelectionToRender()?(u.selectionRoot.matrix=u.root.matrix,u.selectionPivot.matrix=u.pivot.matrix,u.renderer.render(u.selectionScene,r)):u.renderer.renderDummyQuad(),u.renderer.setRenderTarget(s),u.renderer.renderScreenQuadFromTex(a.texture,.6),l.uniforms.srcTex.value=a.texture,l.uniforms.srcTexSize.value.set(a.width,a.height),u.renderer.renderScreenQuad(l)}},{key:"_checkVolumeRenderingSupport",value:function(r){if(!r)return!1;var a=this._gfx,s=a.renderer.getRenderTarget();a.renderer.setRenderTarget(r);var l=a.renderer.getContext(),c=l.checkFramebufferStatus(l.FRAMEBUFFER);return a.renderer.setRenderTarget(s),c!==l.FRAMEBUFFER_COMPLETE?(this.logger.warn("Device doesn't support electron density rendering"),!1):!0}},{key:"_renderVolume",value:function(r,a,s,l,c,u){var f=new VolumeMaterial$1.BackFacePosMaterial,p=new VolumeMaterial$1.FrontFacePosMaterial,g=new Matrix4().makeTranslation(.5,.5,.5),y=new Matrix4,E,h=this._gfx;if(typeof E>"u"&&(E=this._checkVolumeRenderingSupport(l)),!!E){var v=r.getMesh();v.rebuild(h.camera),h.renderer.setClearColor("black",0),h.renderer.setRenderTarget(l),h.renderer.clear(),h.renderer.setRenderTarget(c),h.renderer.clear(),h.renderer.setRenderTarget(u),h.renderer.clear(),h.renderer.setRenderTarget(l),a.layers.set(gfxutils.LAYERS.VOLUME_BFPLANE),h.renderer.render(h.scene,a),a.layers.set(gfxutils.LAYERS.VOLUME),h.scene.overrideMaterial=f,h.renderer.render(h.scene,a),h.renderer.setRenderTarget(c),a.layers.set(gfxutils.LAYERS.VOLUME),h.scene.overrideMaterial=p,h.renderer.render(h.scene,a),h.scene.overrideMaterial=null,a.layers.set(gfxutils.LAYERS.DEFAULT),y.copy(v.matrixWorld).invert(),UberMaterial.prototype.uberOptions.world2colorMatrix.multiplyMatrices(g,y),a.layers.set(gfxutils.LAYERS.COLOR_FROM_POSITION),h.renderer.setRenderTarget(u),h.renderer.render(h.scene,a);var C=v.material;C.uniforms._BFRight.value=l.texture,C.uniforms._FFRight.value=c.texture,C.uniforms._WFFRight.value=u.texture,a.layers.set(gfxutils.LAYERS.VOLUME),h.renderer.setRenderTarget(s),h.renderer.render(h.scene,a),a.layers.set(gfxutils.LAYERS.DEFAULT)}}},{key:"_renderWithPrepassTransparency",value:function(r,a){var s=this._gfx;s.renderer.setRenderTarget(a),r.layers.set(gfxutils.LAYERS.DEFAULT),s.renderer.render(s.scene,r),r.layers.set(gfxutils.LAYERS.PREPASS_TRANSPARENT),s.renderer.getContext().colorMask(!1,!1,!1,!1),s.renderer.render(s.scene,r),s.renderer.getContext().colorMask(!0,!0,!0,!0),r.layers.set(gfxutils.LAYERS.TRANSPARENT),s.renderer.render(s.scene,r),r.layers.set(gfxutils.LAYERS.DEFAULT)}},{key:"_performFXAA",value:function(r,a){var s=new FXAAMaterial;if(!(typeof r>"u"||typeof a>"u")){var l=this._gfx;l.renderer.setClearColor(settings$1.now.bg.color,+!settings$1.now.bg.transparent),l.renderer.setRenderTarget(a),l.renderer.clear(),s.uniforms.srcTex.value=r.texture,s.uniforms.srcTexelSize.value.set(1/r.width,1/r.height),s.uniforms.bgColor.value.set(settings$1.now.bg.color),s.bgTransparent!==settings$1.now.bg.transparent&&(s.setValues({bgTransparent:settings$1.now.bg.transparent}),s.needsUpdate=!0),l.renderer.renderScreenQuad(s)}}},{key:"_performAO",value:function(r,a,s,l,c,u){var f=new AOMaterial,p=new AOHorBlurMaterial,g=new AOVertBlurWithBlendMaterial,y=new Vector3;if(!(!r||!a||!s||!l||!c||!u)){var E=this._gfx,h=Math.tan(MathUtils.DEG2RAD*.5*E.camera.fov);f.uniforms.diffuseTexture.value=r.texture,f.uniforms.depthTexture.value=s,f.uniforms.normalTexture.value=a.texture,f.uniforms.srcTexelSize.value.set(1/r.width,1/r.height),f.uniforms.camNearFar.value.set(E.camera.near,E.camera.far),f.uniforms.projMatrix.value=E.camera.projectionMatrix,f.uniforms.aspectRatio.value=E.camera.aspect,f.uniforms.tanHalfFOV.value=h,E.root.matrix.extractScale(y),f.uniforms.kernelRadius.value=settings$1.now.debug.ssaoKernelRadius*y.x,f.uniforms.depthThreshold.value=2*this._getBSphereRadius(),f.uniforms.factor.value=settings$1.now.debug.ssaoFactor,E.renderer.setRenderTarget(u),E.renderer.renderScreenQuad(f),p.uniforms.aoMap.value=u.texture,p.uniforms.srcTexelSize.value.set(1/u.width,1/u.height),p.uniforms.depthTexture.value=s,E.renderer.setRenderTarget(c),E.renderer.renderScreenQuad(p),g.uniforms.aoMap.value=c.texture,g.uniforms.diffuseTexture.value=r.texture,g.uniforms.srcTexelSize.value.set(1/c.width,1/c.height),g.uniforms.depthTexture.value=s,g.uniforms.projMatrix.value=E.camera.projectionMatrix,g.uniforms.aspectRatio.value=E.camera.aspect,g.uniforms.tanHalfFOV.value=h;var v=E.scene.fog;v&&(g.uniforms.fogNearFar.value.set(v.near,v.far),g.uniforms.fogColor.value.set(v.color.r,v.color.g,v.color.b,settings$1.now.fogAlpha)),(g.useFog!==settings$1.now.fog||g.fogTransparent!==settings$1.now.bg.transparent)&&(g.setValues({useFog:settings$1.now.fog,fogTransparent:settings$1.now.bg.transparent}),g.needsUpdate=!0),E.renderer.setRenderTarget(l),E.renderer.renderScreenQuad(g)}}},{key:"reset",value:function(){this._picker&&this._picker.reset(),this._lastPick=null,this._releaseAllVisuals(),this._setEditMode(EDIT_MODE.COMPLEX),this._resetObjects(),this._gfx&&(gfxutils.clearTree(this._gfx.pivot),this._gfx.renderer2d.reset()),this.setNeedRender()}},{key:"_resetScene",value:function(){this._objectControls.reset(),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.resetReps(),this.resetPivot(),this.rebuildAll()}},{key:"resetView",value:function(){this._picker&&this._picker.reset(),this._setEditMode(EDIT_MODE.COMPLEX),this._resetScene(),this._forEachComplexVisual(function(r){r.updateSelectionMask({}),r.rebuildSelectionGeometry()})}},{key:"_export",value:function(r){var a=lodashExports.head(io.exporters.find({format:r}));if(!a)return this.logger.error("Could not find suitable exporter for this source"),Promise.reject(new Error("Could not find suitable exporter for this source"));if(this.dispatchEvent({type:"exporting"}),this._visuals[this._curVisualName]instanceof ComplexVisual){var s=null;a.SourceClass===ComplexVisual?s=this._visuals[this._curVisualName]:a.SourceClass===Complex$9&&(s=this._visuals[this._curVisualName]._complex);var l=new a(s,{miewVersion:e.VERSION});return l.export().then(function(c){return c})}return this._visuals[this._curVisualName]instanceof VolumeVisual?Promise.reject(new Error("Sorry, exporter for volume data not implemented yet")):Promise.reject(new Error("Unexpected format of data"))}},{key:"load",value:function(r,a){var s=this;a=lodashExports.merge({},a,{context:this}),this.settings.now.use.multiFile||(this._loading.length&&(this._loading.forEach(function(u){u.cancel()}),this._loading.length=0),a.animation||this.reset(!0)),this._interpolator.reset(),this.dispatchEvent({type:"loading",options:a,source:r});var l=new JobHandle;this._loading.push(l),l.addEventListener("notification",function(u){s.dispatchEvent(u.slaveEvent)}),this._spinner.spin(this._container);var c=function(f){var p=s._loading.indexOf(l);return p!==-1&&s._loading.splice(p,1),s._spinner.stop(),s._refreshTitle(),l.notify({type:"loadingDone",anything:f}),f};return _fetchData(r,a,l).then(function(u){return _parseData(u,a,l)}).then(function(u){var f=s._onLoad(u,a);return c(f)}).catch(function(u){throw s.logger.error("Could not load data"),s.logger.debug(u),c(u)})}},{key:"unload",value:function(r){this._removeVisual(r||this.getCurrentVisual()),this.resetPivot(),settings$1.now.shadow.on&&this._updateShadowCamera()}},{key:"_startAnimation",value:function(r){this._stopAnimation();var a=this,s=this._getComplexVisual();if(s===null){this.logger.error("Unable to start animation - no molecule is loaded.");return}try{this._frameInfo=new FrameInfo(s.getComplex(),r,{onLoadStatusChanged:function(){a.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:a._isAnimating,isLoading:a._frameInfo?a._frameInfo.isLoading:!0}})},onError:function(c){a._stopAnimation(),a.logger.error(c)}})}catch{this.logger.error("Animation file does not fit to current complex!");return}this._continueAnimation()}},{key:"_pauseAnimation",value:function(){this._animInterval!==null&&(this._isAnimating=!1,clearInterval(this._animInterval),this._animInterval=null,this._frameInfo&&this.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:this._isAnimating,isLoading:this._frameInfo.isLoading}}))}},{key:"_continueAnimation",value:function(){this._isAnimating=!0;var r=1e3/settings$1.now.maxfps;r=Number.isNaN(r)?0:r;var a=this,s=a._gfx.pivot,l=this._getComplexVisual();l&&(l.resetSelectionMask(),l.rebuildSelectionGeometry(),this._msgAtomInfo.style.opacity=0),this._animInterval=setInterval(function(){if(a.dispatchEvent({type:"mdPlayerStateChanged",state:{isPlaying:a._isAnimating,isLoading:a._frameInfo.isLoading}}),a._frameInfo.frameIsReady){s.updateToFrame(a._frameInfo),a._updateObjsToFrame(a._frameInfo),a._refreshTitle(" Frame ".concat(a._frameInfo._currFrame," of ").concat(a._frameInfo._framesCount," time interval - ").concat(a._frameInfo._timeStep));try{a._frameInfo.nextFrame()}catch{a.logger.error("Error during animation"),a._stopAnimation();return}a._needRender=!0}},r)}},{key:"_stopAnimation",value:function(){this._animInterval!==null&&(clearInterval(this._animInterval),this._frameInfo.disableEvents(),this._frameInfo=null,this._animInterval=null,this.dispatchEvent({type:"mdPlayerStateChanged",state:null}))}},{key:"_onLoad",value:function(r,a){var s=this._gfx,l=null;if(a.animation)return this._refreshTitle(),this._startAnimation(r),null;if(this._stopAnimation(),(!a||!a.keepRepsInfo)&&(this._opts.reps=null,this._opts._objects=null),r.id==="Complex"){var c=r;a.fileName?c.name=c.name||removeExtension(a.fileName).toUpperCase():a.amberFileName?c.name=c.name||removeExtension(a.amberFileName).toUpperCase():c.name="Dynamic ".concat(a.fileType," molecule"),l=this._addVisual(new ComplexVisual(c.name,c)),this._curVisualName=l;var u=this.info();if(this.logger.info("Parsed ".concat(a.fileName," (").concat(u.atoms," atoms, ").concat(u.bonds," bonds, ").concat(u.residues," residues, ").concat(u.chains," chains).")),lodashExports.isNumber(this._opts.unit)&&c.setCurrentUnit(this._opts.unit),!a.preset)if(settings$1.now.autoPreset)switch(a.fileType){case"cml":this.resetReps("small");break;case"pdb":case"mmtf":case"cif":hasValidResidues(c)?this.resetReps("macro"):this.resetReps("small");break;default:this.resetReps("default");break}else this.resetReps("default")}else r.id==="Volume"&&(this.resetEd(),l=this._onLoadEd(r));return s.camera.updateProjectionMatrix(),this._updateFog(),s.root.resetTransform(),this.resetPivot(),this._objectControls.setScale(settings$1.now.radiusToFit/this._getBSphereRadius()),this._resetObjects(),settings$1.now.autoResolution&&this._tweakResolution(),settings$1.now.shadow.on&&this._updateShadowCamera(),this._opts.view&&(this.view(this._opts.view),delete this._opts.view),this._refreshTitle(),l}},{key:"resetEd",value:function(){this._edLoader&&(this._edLoader.abort(),this._edLoader=null),this._removeVisual(this._getVolumeVisual()),this._needRender=!0}},{key:"loadEd",value:function(r){var a=this;this.resetEd();var s=lodashExports.head(io.loaders.find({source:r}));if(!s)return this.logger.error(LOADER_NOT_FOUND),Promise.reject(new Error(LOADER_NOT_FOUND));var l=this._edLoader=new s(r,{binary:!0});return l.context=this,l.load().then(function(c){var u=lodashExports.head(io.parsers.find({format:"ccp4"}));if(!u)throw new Error(PARSER_NOT_FOUND);var f=new u(c);return f.context=a,f.parse().then(function(p){a._onLoadEd(p)})}).catch(function(c){a.logger.error("Could not load ED data"),a.logger.debug(c)})}},{key:"_onLoadEd",value:function(r){r.normalize();var a=new VolumeVisual("volume",r);a.getMesh().layers.set(gfxutils.LAYERS.VOLUME);var s=this._addVisual(a);return this._needRender=!0,s}},{key:"_needRebuild",value:function(){var r=!1;return this._forEachComplexVisual(function(a){r=r||a.needsRebuild()}),r}},{key:"_rebuildObjects",value:function(){var r=this,a=this._gfx,s,l,c=[];for(s=0;s<a.pivot.children.length;++s){var u=a.pivot.children[s];u instanceof Visual||c.push(u)}for(s=0;s<c.length;++s)c[s].parent.remove(c[s]);setTimeout(function(){var f=r._objects;for(s=0,l=f.length;s<l;++s){var p=f[s];p.needsRebuild&&p.build(),p.getGeometry()&&a.pivot.add(p.getGeometry())}},10)}},{key:"changeUnit",value:function(r,a){var s=this._getComplexVisual(a);if(!s)throw new Error("There is no complex to change!");function l(){var c=s?s.getComplex().getCurrentUnit():0,u=c>0?"Bio molecule ".concat(c):"Asymmetric unit";return"Current unit: ".concat(c," (").concat(u,")")}return r===void 0||(lodashExports.isString(r)&&(r=Math.max(parseInt(r,10),0)),s.getComplex().setCurrentUnit(r)&&(this._resetScene(),this._updateInfoPanel())),l()}},{key:"rebuild",value:function(){var r=this;if(this._building){this.logger.warn("Miew.rebuild(): already building!");return}this._building=!0,this.dispatchEvent({type:"rebuilding"}),this._rebuildObjects(),this._gfx.renderer2d.reset();var a=[];this._forEachComplexVisual(function(l){l.needsRebuild()&&a.push(l.rebuild().then(function(){return new Promise(function(c){l.rebuildSelectionGeometry(),c()})}))});var s=this;this._spinner.spin(this._container),Promise.all(a).then(function(){s._spinner.stop(),s._needRender=!0,s._refreshTitle(),r.dispatchEvent({type:"buildingDone"}),s._building=!1})}},{key:"rebuildAll",value:function(){this._forEachComplexVisual(function(r){r.setNeedsRebuild()})}},{key:"_refreshTitle",value:function(r){var a;r=r===void 0?"":r;var s=this._getComplexVisual();if(s){a=s.getComplex().name;var l=s.repGet(s.repCurrent());a+=l?" – ".concat(l.mode.name," Mode"):""}else a=Object.keys(this._visuals).length>0?"Unknown":"No Data";a+=r,this.dispatchEvent({type:"titleChanged",data:a})}},{key:"setNeedRender",value:function(){this._needRender=!0}},{key:"_extractRepresentation",value:function(){var r=this,a=[];this._forEachComplexVisual(function(s){if(s.getSelectionCount()!==0){var l=s.buildSelectorFromMask(1<<s.getSelectionBit()),c=settings$1.now.presets.default,u=s.repAdd({selector:l,mode:c[0].mode.id,colorer:c[0].colorer.id,material:c[0].material.id});if(!u){s.repCount()===ComplexVisual.NUM_REPRESENTATION_BITS&&r.logger.warn("Number of representations is limited to ".concat(ComplexVisual.NUM_REPRESENTATION_BITS));return}r.dispatchEvent({type:"repAdded",index:u.index,name:s.name}),s.repCurrent(u.index),a.push(s.name)}}),a.length>0&&this.logger.report("New representation from selection for complexes: ".concat(a.join(", ")))}},{key:"_setReps",value:function(r){r=r||this._opts&&this._opts.reps||[],this._forEachComplexVisual(function(a){return a.resetReps(r)})}},{key:"applyPreset",value:function(r){for(var a=settings$1.now.presets,s=[r||settings$1.defaults.preset,settings$1.defaults.preset,Object.keys(a)[0]],l=null,c=0;!l&&c<s.length;++c)settings$1.set("preset",s[c]),l=a[settings$1.now.preset],l||this.logger.warn('Unknown preset "'.concat(settings$1.now.preset,'"'));this._setReps(l)}},{key:"resetReps",value:function(r){var a=this._opts&&this._opts.reps;a?this._setReps(a):this.applyPreset(r)}},{key:"repCount",value:function(r){var a=this._getComplexVisual(r);return a?a.repCount():0}},{key:"repCurrent",value:function(r,a){var s=this._getComplexVisual(a),l=s?s.repCurrent(r):-1;return r&&l!==r&&this.logger.warn("Representation ".concat(r," was not found. Current rep remains unchanged.")),l}},{key:"rep",value:function(r,a){var s=this._getComplexVisual("");if(!s)return null;var l=s.rep(r,a);return l.status==="created"?this.dispatchEvent({type:"repAdded",index:l.index,name:s.name}):l.status==="changed"&&this.dispatchEvent({type:"repChanged",index:l.index,name:s.name}),l.desc}},{key:"repGet",value:function(r,a){var s=this._getComplexVisual(a);return s?s.repGet(r):null}},{key:"repAdd",value:function(r,a){var s=this._getComplexVisual(a);if(!s)return-1;var l=s.repAdd(r);return l?(this.dispatchEvent({type:"repAdded",index:l.index,name:a}),l.index):-1}},{key:"repRemove",value:function(r,a){var s=this._getComplexVisual(a);s&&(s.repRemove(r),this.dispatchEvent({type:"repRemoved",index:r,name:a}))}},{key:"repHide",value:function(r,a,s){this._needRender=!0;var l=this._getComplexVisual(s);return l?l.repHide(r,a):null}},{key:"_setEditMode",value:function(r){this._editMode=r;var a=this._msgMode;if(a&&(a.style.opacity=r===EDIT_MODE.COMPLEX?0:1,r!==EDIT_MODE.COMPLEX)){var s=a.getElementsByTagName("p")[0];s.innerHTML=r===EDIT_MODE.COMPONENT?"COMPONENT EDIT MODE":"FRAGMENT EDIT MODE"}this.dispatchEvent({type:"editModeChanged",data:r===EDIT_MODE.COMPLEX})}},{key:"_enterComponentEditMode",value:function(){if(this._editMode===EDIT_MODE.COMPLEX){var r=[];this._forEachComplexVisual(function(a){var s=a.beginComponentEdit();s&&r.push(s)}),r!==[]&&(this._editors=r,this.logger.info("COMPONENT EDIT MODE -- ON"),this._setEditMode(EDIT_MODE.COMPONENT),this._objectControls.keysTranslateObj(!0))}}},{key:"_applyComponentEdit",value:function(){if(this._editMode===EDIT_MODE.COMPONENT){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var r=0;r<this._editors.length;++r)this._editors[r].apply();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (applied)"),this._setEditMode(EDIT_MODE.COMPLEX),this.rebuildAll()}}},{key:"_discardComponentEdit",value:function(){if(this._editMode===EDIT_MODE.COMPONENT){this._objectControls.stop(),this._objectControls.keysTranslateObj(!1);for(var r=0;r<this._editors.length;++r)this._editors[r].discard();this._editors=[],this.logger.info("COMPONENT EDIT MODE -- OFF (discarded)"),this._setEditMode(EDIT_MODE.COMPLEX),this._needRender=!0,this.rebuildAll()}}},{key:"_enterFragmentEditMode",value:function(){if(this._editMode===EDIT_MODE.COMPLEX){var r=[];if(this._forEachComplexVisual(function(s){s instanceof ComplexVisual&&s.getSelectionCount()>0&&r.push(s)}),r.length===1){var a=r[0].beginFragmentEdit();a&&(this._editors=[a],this.logger.info("FRAGMENT EDIT MODE -- ON (single bond)"),this._setEditMode(EDIT_MODE.FRAGMENT),this._objectControls.allowTranslation(!1),this._objectControls.allowAltObjFreeRotation(a.isFreeRotationAllowed()),this._needRender=!0)}}}},{key:"_applyFragmentEdit",value:function(){if(this._editMode===EDIT_MODE.FRAGMENT){this._objectControls.stop();for(var r=0;r<this._editors.length;++r)this._editors[r].apply();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (applied)"),this._setEditMode(EDIT_MODE.COMPLEX),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this.rebuildAll()}}},{key:"_discardFragmentEdit",value:function(){if(this._editMode===EDIT_MODE.FRAGMENT){this._objectControls.stop();for(var r=0;r<this._editors.length;++r)this._editors[r].discard();this._editors=[],this.logger.info("FRAGMENT EDIT MODE -- OFF (discarded)"),this._setEditMode(EDIT_MODE.COMPLEX),this._objectControls.allowTranslation(!0),this._objectControls.allowAltObjFreeRotation(!0),this._needRender=!0}}},{key:"_onPick",value:function(r){if(!settings$1.now.picking||this._animInterval!==null||this._editMode===EDIT_MODE.FRAGMENT||this._objectControls.isEditingAltObj())return;var a=null;r.obj.atom?(a=r.obj.atom.residue.getChain().getComplex(),this._lastPick=r.obj.atom):r.obj.residue?(a=r.obj.residue.getChain().getComplex(),this._lastPick=r.obj.residue):r.obj.chain?(a=r.obj.chain.getComplex(),this._lastPick=r.obj.chain):r.obj.molecule?(a=r.obj.molecule.complex,this._lastPick=r.obj.molecule):this._lastPick=null;function s(c){c.updateSelectionMask(r.obj),c.rebuildSelectionGeometry()}if(a){var l=this._getVisualForComplex(a);l&&(s(l),this._needRender=!0)}else this._forEachComplexVisual(s),this._needRender=!0;this._updateInfoPanel(),this.dispatchEvent(r)}},{key:"_onKeyDown",value:function(r){if(!(!this._running||!this._hotKeysEnabled))switch(r.keyCode){case 67:settings$1.now.editing&&this._enterComponentEditMode();break;case 70:settings$1.now.editing&&this._enterFragmentEditMode();break;case 65:switch(this._editMode){case EDIT_MODE.COMPONENT:this._applyComponentEdit();break;case EDIT_MODE.FRAGMENT:this._applyFragmentEdit();break}break;case 68:switch(this._editMode){case EDIT_MODE.COMPONENT:this._discardComponentEdit();break;case EDIT_MODE.FRAGMENT:this._discardFragmentEdit();break}break;case 83:r.preventDefault(),r.stopPropagation(),settings$1.set("ao",!settings$1.now.ao),this._needRender=!0;break;case 107:r.preventDefault(),r.stopPropagation(),this._forEachComplexVisual(function(a){a.expandSelection(),a.rebuildSelectionGeometry()}),this._updateInfoPanel(),this._needRender=!0;break;case 109:r.preventDefault(),r.stopPropagation(),this._forEachComplexVisual(function(a){a.shrinkSelection(),a.rebuildSelectionGeometry()}),this._updateInfoPanel(),this._needRender=!0;break}}},{key:"_onKeyUp",value:function(r){!this._running||!this._hotKeysEnabled||r.keyCode===88&&this._extractRepresentation()}},{key:"_updateInfoPanel",value:function(){var r=this._msgAtomInfo.getElementsByTagName("p")[0],a,s,l=0;for(this._forEachComplexVisual(function(y){l+=y.getSelectionCount()});r.firstChild;)r.removeChild(r.firstChild);if(l===0){this._msgAtomInfo.style.opacity=0;return}var c="".concat(String(l)," atom").concat(l!==1?"s":""," selected");this._lastPick!==null&&(c+=", the last pick:");var u="",f="",p="";if(this._lastPick instanceof Atom){a=this._lastPick,s=a.residue,f=a.name;var g=a.location!==32?String.fromCharCode(a.location):"";u="".concat(a.element.fullName," #").concat(a.serial).concat(g,":       ").concat(s._chain._name,".").concat(s._type._name).concat(s._sequence).concat(s._icode.trim(),"."),u+=f,p="Coord: (".concat(a.position.x.toFixed(2).toString(),",     ").concat(a.position.y.toFixed(2).toString(),",     ").concat(a.position.z.toFixed(2).toString(),")")}else this._lastPick instanceof Residue?(s=this._lastPick,u="".concat(s._type._fullName,":       ").concat(s._chain._name,".").concat(s._type._name).concat(s._sequence).concat(s._icode.trim())):this._lastPick instanceof Chain?u="chain ".concat(this._lastPick._name):this._lastPick instanceof Molecule&&(u="molecule ".concat(this._lastPick._name));r.appendChild(document.createTextNode(c)),u!==""&&(r.appendChild(document.createElement("br")),r.appendChild(document.createTextNode(u))),p!==""&&(r.appendChild(document.createElement("br")),r.appendChild(document.createTextNode(p))),this._msgAtomInfo.style.opacity=1}},{key:"_getAltObj",value:function(){if(this._editors){for(var r=null,a=0;a<this._editors.length;++a){var s=this._editors[a].getAltObj();if(s.objects.length>0){if(r){r=null;break}r=s}}if(r)return r}return{objects:[],pivot:new Vector3(0,0,0)}}},{key:"resetPivot",value:function(){var r=new Box3,a=new Vector3;r.makeEmpty(),this._forEachVisual(function(s){r.union(s.getBoundaries().boundingBox)}),r.getCenter(a),this._objectControls.setPivot(a.negate()),this.dispatchEvent({type:"transform"})}},{key:"setPivotResidue",value:function(r){var a=new Vector3,s=this._getVisualForComplex(r.getChain().getComplex());if(s){if(r._controlPoint)a.copy(r._controlPoint);else{for(var l=0,c=0,u=0,f=r._atoms.length,p=0;p<f;++p){var g=r._atoms[p].position;l+=g.x/f,c+=g.y/f,u+=g.z/f}a.set(l,c,u)}a.applyMatrix4(s.matrix).negate(),this._objectControls.setPivot(a),this.dispatchEvent({type:"transform"})}}},{key:"setPivotAtom",value:function(r){var a=new Vector3,s=this._getVisualForComplex(r.residue.getChain().getComplex());s&&(a.copy(r.position),a.applyMatrix4(s.matrix).negate(),this._objectControls.setPivot(a),this.dispatchEvent({type:"transform"}))}},{key:"getSelectionCenter",value:function(r,a,s){var l=new Vector3(0,0,0);r.set(0,0,0);var c=0;return this._forEachComplexVisual(function(u){u.getSelectionCenter(l,a,s||u.getSelectionBit())&&(r.add(l),c++)}),c===0?!1:(r.divideScalar(c),r.negate(),!0)}},{key:"setPivotSubset",value:function(r){var a=new Vector3(0,0,0),s=r?_includesInSelector:_includesInCurSelection;this.getSelectionCenter(a,s,r)?(this._objectControls.setPivot(a),this.dispatchEvent({type:"transform"})):this.logger.warn("selection is empty. Center operation not performed")}},{key:"screenshot",value:function(r,a){var s=this._gfx,l=s.renderer.domElement.width,c=s.renderer.domElement.height;function u(w){return Math.tan(MathUtils.degToRad(.5*w))}function f(w){return MathUtils.radToDeg(Math.atan(w))*2}function p(){var w,_=utils.getBrowser();if(_===utils.browserType.SAFARI){var S=document.createElement("canvas"),M=S.getContext("2d");S.width=r===void 0?l:r,S.height=a===void 0?c:a,M.drawImage(s.renderer.domElement,0,0,S.width,S.height),w=S.toDataURL("image/png")}else w=s.renderer.domElement.toDataURL("image/png");return w}a=a||r;var g;if(r===void 0&&a===void 0||r===l&&a===c)g=p();else{var y=s.camera.aspect,E=s.camera.fov,h=u(s.camera.fov),v=Math.min(s.width,s.height),C=h*v/s.height,x=r/a;s.renderer.setPixelRatio(1),s.camera.aspect=x,s.camera.fov=f(C/Math.min(x,1)),s.camera.updateProjectionMatrix(),s.renderer.setDrawingBufferSize(r,a,1),this._renderFrame(settings$1.now.stereo),g=p(),s.renderer.setPixelRatio(window.devicePixelRatio),s.camera.aspect=y,s.camera.fov=E,s.camera.updateProjectionMatrix(),s.renderer.setDrawingBufferSize(s.width,s.height,window.devicePixelRatio),this._needRender=!0}return g}},{key:"screenshotSave",value:function(r,a,s){var l=this.screenshot(a,s);utils.shotDownload(l,r)}},{key:"save",value:function(r){var a=this;this._export(r.fileType).then(function(s){var l=a._visuals[a._curVisualName]._complex.name;utils.download(s,l,r.fileType),a._refreshTitle(),a.dispatchEvent({type:"exportingDone"})}).catch(function(s){a.logger.error("Could not export data"),a.logger.debug(s),a._refreshTitle(),a.dispatchEvent({type:"exportingDone",error:s})})}},{key:"_tweakResolution",value:function(){var r=[["poor",100],["low",500],["medium",1e3],["high",5e3],["ultra",Number.MAX_VALUE]],a=0;if(this._forEachComplexVisual(function(c){a+=c.getComplex().getAtomCount()}),a>0){for(var s=this._gfxScore*1e6/a,l=0;l<r.length;++l)if(s<r[l][1]){this._autoChangeResolution(r[l][0]);break}}}},{key:"_autoChangeResolution",value:function(r){r!==settings$1.now.resolution&&this.logger.report('Your rendering resolution was changed to "'.concat(r,'" for best performance.')),settings$1.now.resolution=r}},{key:"saveSettings",value:function(){this._cookies.setCookie(this._opts.settingsCookie,JSON.stringify(this.settings.getDiffs(!0)))}},{key:"restoreSettings",value:function(){try{var r=this._cookies.getCookie(this._opts.settingsCookie),a=r?JSON.parse(r):{};this.settings.applyDiffs(a,!0)}catch(s){this.logger.error("Cookies parse error: ".concat(s.message))}}},{key:"resetSettings",value:function(){this.settings.reset()}},{key:"setOptions",value:function(r){typeof r=="string"&&(r=e.options.fromAttr(r)),r.reps&&(this._opts.reps=null),lodashExports.merge(this._opts,r),r.settings&&this.set(r.settings),this._opts._objects=r._objects,this._resetObjects(),r.load&&this.load(r.load,{fileType:r.type}),r.preset&&(settings$1.now.preset=r.preset),r.reps&&this.resetReps(r.preset),this._opts.view&&(this.view(this._opts.view),delete this._opts.view);var a=this._getComplexVisual();a&&(a.getComplex().resetCurrentUnit(),lodashExports.isNumber(r.unit)&&a.getComplex().setCurrentUnit(r.unit),this.resetView(),this.rebuildAll())}},{key:"info",value:function(r){var a=this._getComplexVisual(r);if(!a)return{};var s=a.getComplex(),l=s.metadata;return{id:l.id||s.name||"UNKNOWN",title:l.title&&l.title.join(" ")||"UNKNOWN DATA",atoms:s.getAtomCount(),bonds:s.getBondCount(),residues:s.getResidueCount(),chains:s.getChainCount()}}},{key:"addObject",value:function(r,a){var s=null;if(r.type===LinesObj.prototype.type&&(s=LinesObj),s===null)throw new Error("Unknown scene object type - ".concat(r.type));try{var l=new s(r.params,r.opts);this._addSceneObject(l)}catch(c){if(!a)this.logger.debug("Error during scene object creation: ".concat(c.message));else throw c}this._needRender=!0}},{key:"_addSceneObject",value:function(r){var a=this._getComplexVisual();r.build&&a&&(r.build(a.getComplex()),this._gfx.pivot.add(r.getGeometry()));var s=this._objects;s[s.length]=r}},{key:"_updateObjsToFrame",value:function(r){for(var a=this._objects,s=0,l=a.length;s<l;++s)a[s].updateToFrame&&a[s].updateToFrame(r)}},{key:"_resetObjects",value:function(){var r=this._opts._objects;if(this._objects=[],r)for(var a=0,s=r.length;a<s;++a)this.addObject(r[a],!1)}},{key:"removeObject",value:function(r){var a=this._objects[r];if(!a)throw new Error("Scene object with index ".concat(r," does not exist"));a.destroy(),this._objects.splice(r,1),this._needRender=!0}},{key:"getURL",value:function(r){return options$1.toURL(this.getState(lodashExports.defaults(r,{compact:!0,settings:!1,view:!1})))}},{key:"getScript",value:function(r){return options$1.toScript(this.getState(lodashExports.defaults(r,{compact:!0,settings:!0,view:!0})))}},{key:"_compareReps",value:function(r,a){var s={},l=0;r&&(l=r.repCount());var c=settings$1.defaults.presets[settings$1.now.preset],u=a;c===void 0||c.length>l?(u=!1,s.preset="empty"):settings$1.now.preset!==settings$1.defaults.preset&&(s.preset=settings$1.now.preset);for(var f=[],p=!0,g=0,y=l;g<y;++g)f[g]=r.repGet(g).compare(u?c[g]:null),lodashExports.isEmpty(f[g])||(p=!1);return p||(s.reps=f),s}},{key:"getState",value:function(r){var a={};r=lodashExports.defaults(r,{compact:!0,settings:!1,view:!1});var s=this._getComplexVisual();if(s!==null){var l=s.getComplex(),c=l.metadata;if(c.id){var u=c.format?"".concat(c.format,":"):"";a.load=u+c.id}var f=l.getCurrentUnit();f!==1&&(a.unit=f)}var p=this._compareReps(s,r.compact);p.preset&&(a.preset=p.preset),p.reps&&(a.reps=p.reps);for(var g=this._objects,y=[],E=0,h=g.length;E<h;++E)y[E]=g[E].identify();if(g.length>0&&(a._objects=y),r.view&&(a.view=this.view()),r.settings){var v=this.settings.getDiffs(!1);lodashExports.isEmpty(v)||(a.settings=v)}return a}},{key:"get",value:function(r,a){return settings$1.get(r,a)}},{key:"_clipPlaneUpdateValue",value:function(r){var a=Math.max(this._gfx.camera.position.z-r*settings$1.now.draft.clipPlaneFactor,settings$1.now.camNear),s={clipPlaneValue:a};this._forEachComplexVisual(function(f){f.setUberOptions(s)});for(var l=0,c=this._objects.length;l<c;++l){var u=this._objects[l];u._line&&u._line.material.setUberOptions(s)}this._picker!==null&&(this._picker.clipPlaneValue=a)}},{key:"_fogFarUpdateValue",value:function(){this._picker!==null&&(this._gfx.scene.fog?this._picker.fogFarValue=this._gfx.scene.fog.far:this._picker.fogFarValue=void 0)}},{key:"_updateShadowmapMeshes",value:function(r){this._forEachComplexVisual(function(a){for(var s=a._reprList,l=0,c=s.length;l<c;++l){var u=s[l];r(u.geo,u.material)}})}},{key:"_updateMaterials",value:function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this._forEachComplexVisual(function(f){return f.setMaterialValues(r,a,s)});for(var l=0,c=this._objects.length;l<c;++l){var u=this._objects[l];u._line&&(u._line.material.setValues(r),u._line.material.needsUpdate=!0)}}},{key:"_fogAlphaChanged",value:function(){this._forEachComplexVisual(function(r){r.setUberOptions({fogAlpha:settings$1.now.fogAlpha})})}},{key:"_embedWebXR",value:function(){var r=this;if(settings$1.now.stereo!=="WEBVR"){this.webVR&&this.webVR.disable(),this.webVR=null;return}this.webVR||(this.webVR=new WebVRPoC(function(){r._requestAnimationFrame(function(){return r._onTick()}),r._needRender=!0,r._onResize()})),this.webVR.enable(this._gfx)}},{key:"_initOnSettingsChanged",value:function(){var r=this,a=function(l,c){l=lodashExports.isArray(l)?l:[l],l.forEach(function(u){r.settings.addEventListener("change:".concat(u),c)})};a("modes.VD.frame",function(){var s=r._getVolumeVisual();s!==null&&(s.showFrame(settings$1.now.modes.VD.frame),r._needRender=!0)}),a("modes.VD.isoMode",function(){var s=r._getVolumeVisual();s!==null&&(s.getMesh().material.updateDefines(),r._needRender=!0)}),a("bg.color",function(){r._onBgColorChanged()}),a("ao",function(){if(settings$1.now.ao&&!isAOSupported(r._gfx.renderer.getContext()))r.logger.warn("Your device or browser does not support ao"),settings$1.set("ao",!1);else{var s={normalsToGBuffer:settings$1.now.ao};r._setUberMaterialValues(s)}}),a("zSprites",function(){settings$1.now.zSprites&&!arezSpritesSupported(r._gfx.renderer.getContext())&&(r.logger.warn("Your device or browser does not support zSprites"),settings$1.set("zSprites",!1)),r.rebuildAll()}),a("fogColor",function(){r._onFogColorChanged()}),a("fogColorEnable",function(){r._onFogColorChanged()}),a("bg.transparent",function(s){var l=r._gfx;l&&l.renderer.setClearColor(settings$1.now.bg.color,+!settings$1.now.bg.transparent),r._updateMaterials({fogTransparent:s.value}),r.rebuildAll()}),a("draft.clipPlane",function(s){r._updateMaterials({clipPlane:s.value}),r.rebuildAll()}),a("shadow.on",function(s){var l={shadowmap:s.value,shadowmapType:settings$1.now.shadow.type},c=r._gfx;c&&(c.renderer.shadowMap.enabled=!!l.shadowmap),r._updateMaterials(l,!0),l.shadowmap?(r._updateShadowCamera(),r._updateShadowmapMeshes(meshutils.createShadowmapMaterial)):r._updateShadowmapMeshes(meshutils.removeShadowmapMaterial),r._needRender=!0}),a("shadow.type",function(s){settings$1.now.shadow.on&&(r._updateMaterials({shadowmapType:s.value},!0),r._needRender=!0)}),a("shadow.radius",function(s){for(var l=0;l<r._gfx.scene.children.length;l++)if(r._gfx.scene.children[l].shadow!==void 0){var c=r._gfx.scene.children[l];c.shadow.radius=s.value,r._needRender=!0}}),a("fps",function(){r._fps.show(settings$1.now.fps)}),a(["fog","fogNearFactor","fogFarFactor"],function(){r._updateFog(),r._needRender=!0}),a("fogAlpha",function(){var s=settings$1.now.fogAlpha;(s<0||s>1)&&r.logger.warn("fogAlpha must belong range [0,1]"),r._fogAlphaChanged(),r._needRender=!0}),a("autoResolution",function(s){s.value&&!r._gfxScore&&r.logger.warn("Benchmarks are missed, autoresolution will not work! Autoresolution should be set during miew startup.")}),a("stereo",function(){r._embedWebXR(settings$1.now.stereo==="WEBVR"),r._needRender=!0}),a(["transparency","palette"],function(){r.rebuildAll()}),a("resolution",function(){r.rebuildAll();var s=r._getVolumeVisual();s&&(s.getMesh().material.updateDefines(),r._needRender=!0)}),a(["axes","fxaa","ao","outline.on","outline.color","outline.threshold","outline.thickness"],function(){r._needRender=!0})}},{key:"set",value:function(r,a){settings$1.set(r,a)}},{key:"select",value:function(r,a){var s=this._getComplexVisual();if(s){var l=r;lodashExports.isString(r)&&(l=selectors$1.parse(r).selector),s.select(l,a),this._lastPick=null,this._updateInfoPanel(),this._needRender=!0}}},{key:"view",value:function(r){var a="1",s=this,l=this._gfx.pivot,c=[],u="ZXY";function f(){var g=l.position,y=s._objectControls.getScale()/settings$1.now.radiusToFit,E=new Euler;return E.setFromQuaternion(s._objectControls.getOrientation(),u),c=[g.x,g.y,g.z,y,E.x,E.y,E.z],a+utils.arrayToBase64(c,Float32Array)}function p(){r.length===40&&(r="0".concat(r));var g=r[0];if(c=utils.arrayFromBase64(r.substr(1),Float32Array),g!==a)if(g==="0")c[3]/=8;else{s.logger.warn("Encoded view version mismatch, stored as ".concat(g," vs ").concat(a," expected"));return}var y=s._interpolator,E=y.createView();E.position.copy(l.position),E.scale=s._objectControls.getScale(),E.orientation.copy(s._objectControls.getOrientation());var h=y.createView();h.position.set(c[0],c[1],c[2]),s._getComplexVisual()&&h.position.sub(s._getComplexVisual().position),h.scale=c[3],h.orientation.setFromEuler(new Euler(c[4],c[5],c[6],u)),y.setup(E,h)}return typeof r>"u"?f():(p(),r)}},{key:"_updateView",value:function(){var r=this,a=this._gfx.pivot,s=this._interpolator;if(s.wasStarted()||s.start(),!!s.isMoving()){var l=s.getCurrentView();if(l.success){var c=l.view;a.position.copy(c.position),r._objectControls.setScale(c.scale*settings$1.now.radiusToFit),r._objectControls.setOrientation(c.orientation),this.dispatchEvent({type:"transform"}),r._needRender=!0}}}},{key:"translate",value:function(r,a,s){this._objectControls.translatePivot(r,a,s),this.dispatchEvent({type:"transform"}),this._needRender=!0}},{key:"rotate",value:function(r,a,s){this._objectControls.rotate(new Quaternion().setFromEuler(new Euler(r,a,s,"XYZ"))),this.dispatchEvent({type:"transform"}),this._needRender=!0}},{key:"scale",value:function(r){if(r<=0)throw new RangeError("Scale should be greater than zero");this._objectControls.scale(r),this.dispatchEvent({type:"transform"}),this._needRender=!0}},{key:"center",value:function(r){if(r===void 0){this.setPivotSubset(),this._needRender=!0;return}if(r.obj!==void 0&&("atom"in r.obj||"residue"in r.obj)){"atom"in r.obj?this.setPivotAtom(r.obj.atom):this.setPivotResidue(r.obj.residue),this._needRender=!0;return}if(r.obj===void 0&&r!==""){var a=selectors$1.parse(r);if(a.error===void 0){this.setPivotSubset(a),this._needRender=!0;return}}this.resetPivot(),this._needRender=!0}},{key:"within",value:function(r,a){var s=this._getComplexVisual();if(!s)return selectors$1.None();r instanceof String&&(r=selectors$1.parse(r));var l=s.within(r,a);return l&&(s.rebuildSelectionGeometry(),this._needRender=!0),l}},{key:"projected",value:function(r,a){var s=this._getComplexVisual(a);if(!s)return!1;var l=s.getComplex().getAtomByFullname(r);if(l===null)return!1;var c=l.position.clone();return this._gfx.pivot.updateMatrixWorldRecursive(),this._gfx.camera.updateMatrixWorldRecursive(),this._gfx.pivot.localToWorld(c),c.project(this._gfx.camera),{x:(c.x+1)*.5*this._gfx.width,y:(1-c.y)*.5*this._gfx.height}}},{key:"dssp",value:function(r){var a=this._getComplexVisual(r);a&&(a.getComplex().dssp(),a._reprList.forEach(function(s){(s.mode.id==="CA"||s.colorer.id==="SS")&&(s.needsRebuild=!0)}))}},{key:"exportCML",value:function(){var r=this;function a(f){var p=new Vector3,g=new Vector3,y=new Vector3;f.extractBasis(p,g,y),p.normalize(),g.normalize(),y.normalize();var E=new Matrix4;return E.identity(),E.makeBasis(p,g,y),E}function s(f){var p=r._gfx.root,g=a(p.matrixWorld),y=new Vector4(0,0,0,0),E=new Vector4(0,0,0,0),h=null,v=null;f.forEachAtom(function(C){C.xmlNodeRef&&C.xmlNodeRef.xmlNode&&(h=C.xmlNodeRef.xmlNode,v=C.position,y.set(v.x,v.y,v.z,1),y.applyMatrix4(g),h.setAttribute("x3",y.x.toString()),h.setAttribute("y3",y.y.toString()),h.setAttribute("z3",y.z.toString()),h.removeAttribute("x2"),h.removeAttribute("y2"))}),f.forEachSGroup(function(C){if(C.xmlNodeRef&&C.xmlNodeRef.xmlNode){h=C.xmlNodeRef.xmlNode,v=C.getPosition(),y.set(v.x,v.y,v.z,1);var x=C.getCentralPoint();x===null?y.applyMatrix4(g):(E.set(x.x,x.y,x.z,0),y.add(E),y.applyMatrix4(g),E.set(x.x,x.y,x.z,1),E.applyMatrix4(g),y.sub(E)),h.setAttribute("x",y.x.toString()),h.setAttribute("y",y.y.toString()),h.setAttribute("z",y.z.toString())}})}var l=r._getComplexVisual(),c=l?l.getComplex():null;if(c&&c.originalCML){s(c);var u=new XMLSerializer;return u.serializeToString(c.originalCML)}return null}},{key:"motm",value:function(){settings$1.set({fogColorEnable:!0,fogColor:0,outline:{on:!0,threshold:.01},bg:{color:16777215}}),this._forEachComplexVisual(function(r){for(var a=[],s=r.getComplex(),l=palettes$1.get(settings$1.now.palette),c=0;c<s.getChainCount();c++){var u=s._chains[c]._name,f=l.getChainColor(u);a[c]={selector:"chain ".concat(u),mode:"VW",colorer:["CB",{color:f,factor:.9}],material:"FL"}}r.resetReps(a)})}}]),e}(EventDispatcher);lodashExports.assign(Miew,{VERSION:Miew.VERSION,registeredPlugins:[],chem,io,modes:modes$1,colorers:colorers$1,materials:materials$1,palettes:palettes$1,options:options$1,settings:settings$1,utils,gfx:{Representation}});var parser=function(){var o=function(ee,Fe,it,U){for(it=it||{},U=ee.length;U--;it[ee[U]]=Fe);return it},t=[1,60],e=[1,62],n=[1,63],r=[1,65],a=[1,66],s=[1,67],l=[1,68],c=[1,69],u=[1,80],f=[1,72],p=[1,73],g=[1,74],y=[1,75],E=[1,99],h=[1,76],v=[1,100],C=[1,79],x=[1,51],w=[1,81],_=[1,82],S=[1,84],M=[1,83],T=[1,85],R=[1,96],P=[1,97],I=[1,98],B=[1,86],W=[1,87],D=[1,64],O=[1,70],z=[1,71],G=[1,77],k=[1,78],$=[1,53],Z=[1,54],K=[1,55],j=[1,61],Q=[1,88],le=[1,89],he=[1,90],ve=[1,91],re=[1,92],Ie=[1,93],ge=[1,94],Se=[1,95],Le=[1,101],be=[1,102],ye=[1,103],ce=[1,104],ue=[1,105],Ce=[1,56],Ve=[1,57],ie=[1,58],ae=[1,59],Ae=[1,115],De=[1,111],Be=[1,114],ze=[1,112],We=[1,113],$e=[1,118],qe=[1,117],et=[1,134],F=[1,149],H=[1,150],X=[1,157],oe=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],te=[5,6,7,9,13,14,15,17,18,19,20,23,25,26,27,30,33,34,35,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,71,72,74,77,78,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,101],Me=[5,6,7,9,13,15,17,18,19,20,23,25,26,27,30,33,34,37,38,41,43,45,46,49,52,54,55,56,58,59,62,64,65,66,70,72,82,83,84,85,86,87,88,89,90,91,92,93,94,95],Te=[5,70,72],q=[5,74],Ee=[71,101],Pe={trace:function(){},yy:{},symbols_:{error:2,Program:3,Command:4,EOF:5,RESET:6,BUILD:7,ALL:8,HELP:9,Path:10,MOTM:11,OneArgCommand:12,GET:13,STRING:14,SET:15,Value:16,SET_SAVE:17,SET_RESTORE:18,SET_RESET:19,PRESET:20,AddRepresentation:21,EditRepresentation:22,REMOVE:23,RepresentationReference:24,HIDE:25,SHOW:26,LIST:27,EXPAND_KEY:28,SELECTOR_KEY:29,SELECT:30,AS:31,WordAll:32,SELECTOR:33,WITHIN:34,NUMBER:35,OF:36,MATERIAL:37,IDENTIFIER:38,ModeCMD:39,ColorCMD:40,VIEW:41,BASE_64:42,UNIT:43,DSSP:44,SCALE:45,ROTATE:46,AxesList:47,TRANSLATE:48,CENTER:49,GetURLBranch:50,Screenshot:51,LINE:52,ArgList:53,LISTOBJ:54,REMOVEOBJ:55,URL:56,VIEW_KEY:57,SCREENSHOT:58,LOAD:59,Url:60,FILE_KEY:61,ADD:62,Description:63,REP:64,MODE:65,COLOR:66,Descriptor:67,RepresentationOwnProperty:68,RepresentationOwnPropertyOpts:69,DESC_KEY:70,"=":71,DESC_KEY_OPTS:72,AxesArg:73,DESC_KEY_AXES:74,Arg:75,PathWoDescKey:76,HEX:77,BOOL:78,Word:79,CommandSetWoDESC_KEY:80,DescKeys:81,CLEAR:82,FILE_LIST:83,FILE_REGISTER:84,FILE_DELETE:85,PRESET_ADD:86,PRESET_DELETE:87,PRESET_UPDATE:88,PRESET_RENAME:89,PRESET_OPEN:90,CREATE_SCENARIO:91,RESET_SCENARIO:92,DELETE_SCENARIO:93,ADD_SCENARIO_ITEM:94,LIST_SCENARIO:95,PDB_KEY:96,DELAY_KEY:97,PRST_KEY:98,DESCRIPTION_KEY:99,CommandSet:100,".":101,PresetPath:102,"/":103,HexOrNumber:104,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"RESET",7:"BUILD",8:"ALL",9:"HELP",11:"MOTM",13:"GET",14:"STRING",15:"SET",17:"SET_SAVE",18:"SET_RESTORE",19:"SET_RESET",20:"PRESET",23:"REMOVE",25:"HIDE",26:"SHOW",27:"LIST",28:"EXPAND_KEY",29:"SELECTOR_KEY",30:"SELECT",31:"AS",33:"SELECTOR",34:"WITHIN",35:"NUMBER",36:"OF",37:"MATERIAL",38:"IDENTIFIER",41:"VIEW",42:"BASE_64",43:"UNIT",44:"DSSP",45:"SCALE",46:"ROTATE",48:"TRANSLATE",49:"CENTER",52:"LINE",54:"LISTOBJ",55:"REMOVEOBJ",56:"URL",57:"VIEW_KEY",58:"SCREENSHOT",59:"LOAD",61:"FILE_KEY",62:"ADD",64:"REP",65:"MODE",66:"COLOR",70:"DESC_KEY",71:"=",72:"DESC_KEY_OPTS",74:"DESC_KEY_AXES",77:"HEX",78:"BOOL",82:"CLEAR",83:"FILE_LIST",84:"FILE_REGISTER",85:"FILE_DELETE",86:"PRESET_ADD",87:"PRESET_DELETE",88:"PRESET_UPDATE",89:"PRESET_RENAME",90:"PRESET_OPEN",91:"CREATE_SCENARIO",92:"RESET_SCENARIO",93:"DELETE_SCENARIO",94:"ADD_SCENARIO_ITEM",95:"LIST_SCENARIO",96:"PDB_KEY",97:"DELAY_KEY",98:"PRST_KEY",99:"DESCRIPTION_KEY",101:".",103:"/"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,2],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,1],[4,2],[4,2],[4,2],[4,4],[4,2],[4,6],[4,2],[4,1],[4,1],[4,1],[4,2],[4,2],[4,1],[4,2],[4,1],[4,2],[4,2],[4,2],[4,1],[4,2],[4,1],[4,1],[4,3],[4,3],[4,4],[4,4],[4,1],[4,2],[50,1],[50,2],[50,2],[50,3],[50,3],[51,1],[51,2],[51,3],[12,2],[12,2],[12,2],[21,1],[21,2],[21,2],[21,3],[22,2],[22,3],[39,2],[39,3],[40,2],[40,3],[24,1],[24,1],[63,1],[63,2],[63,3],[63,4],[67,1],[67,1],[67,2],[68,3],[69,3],[47,1],[47,2],[73,2],[53,1],[53,2],[75,3],[16,1],[16,1],[16,1],[16,1],[16,1],[79,1],[79,1],[32,1],[32,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[80,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[81,1],[100,1],[100,1],[76,1],[76,3],[76,3],[10,1],[10,1],[10,3],[10,3],[10,3],[60,1],[102,1],[102,3],[104,1],[104,1]],performAction:function(ee,Fe,it,U,ke,de,se){var fe=de.length-1;switch(ke){case 1:return de[fe-1];case 3:this.$=U.miew.reset(!1),U.ClearContext(),U.miew.resetReps("empty");break;case 4:this.$=U.miew.rebuild();break;case 5:this.$=U.miew.rebuildAll(),U.miew.rebuild();break;case 6:this.$=U.echo(U.utils.help().toString());break;case 7:this.$=U.echo(U.utils.help(de[fe]).toString());break;case 8:this.$=U.miew.motm();break;case 10:case 11:this.$=U.utils.propagateProp(de[fe]),U.echo(U.miew.get(de[fe]).toString());break;case 12:case 13:this.$=U.miew.set(de[fe-1],U.utils.propagateProp(de[fe-1],de[fe]));break;case 14:this.$=U.miew.saveSettings();break;case 15:this.$=U.miew.restoreSettings();break;case 16:this.$=U.miew.resetSettings();break;case 17:this.$=U.miew.resetReps();break;case 18:this.$=U.miew.applyPreset(de[fe]);break;case 21:this.$=U.miew.repRemove(de[fe]),U.representations.remove(de[fe]);break;case 22:this.$=U.miew.repHide(de[fe]);break;case 23:this.$=U.miew.repHide(de[fe],!1);break;case 24:this.$=U.echo(U.utils.listRep(U.miew,U.representations,de[fe],"-e"));break;case 25:this.$=U.echo(U.utils.list(U.miew,U.representations));break;case 26:this.$=U.echo(U.utils.list(U.miew,U.representations,de[fe]));break;case 27:this.$=U.echo(U.utils.listSelector(U.miew,U.Context));break;case 28:this.$=U.miew.select(U.utils.checkArg(de[fe-1].toLowerCase(),de[fe],!0));break;case 29:this.$=U.Context[de[fe].toLowerCase()]=U.utils.checkArg(de[fe-3].toLowerCase(),de[fe-2],!0),U.miew.select(U.Context[de[fe].toLowerCase()]);break;case 30:this.$=U.miew.rep(U.miew.repCurrent(),{selector:U.utils.checkArg(de[fe-1].toLowerCase(),de[fe])});break;case 31:this.$=U.Context[de[fe].toLowerCase()]=U.miew.within(U.utils.checkArg("select",de[fe-2],!0),Number(de[fe-4]));break;case 32:this.$=U.miew.rep(U.miew.repCurrent(),{material:U.utils.checkArg(de[fe-1].toLowerCase(),de[fe].toUpperCase())});break;case 35:this.$=U.echo(U.miew.view());break;case 36:case 37:this.$=U.miew.view(de[fe]);break;case 38:this.$=U.echo(U.miew.changeUnit());break;case 39:this.$=U.echo(U.miew.changeUnit(de[fe]));break;case 40:this.$=U.miew.dssp();break;case 41:this.$=U.miew.scale(de[fe]);break;case 42:for(var je=0,ht=de[fe].length;je<ht;je++)U.miew.rotate(de[fe][je].x*Math.PI/180,de[fe][je].y*Math.PI/180,de[fe][je].z*Math.PI/180);break;case 43:for(var je=0,ht=de[fe].length;je<ht;je++)U.miew.translate(de[fe][je].x||0,de[fe][je].y||0,de[fe][je].z||0);break;case 44:this.$=U.miew.center();break;case 45:this.$=U.miew.center(de[fe]);break;case 48:case 49:this.$=U.miew.addObject({type:"line",params:[de[fe-1],de[fe]]},!0);break;case 50:case 51:this.$=U.miew.addObject({type:"line",params:[de[fe-2],de[fe-1]],opts:de[fe].toJSO(U.utils,"objects","line")},!0);break;case 52:this.$=U.echo(U.utils.listObjs(U.miew));break;case 53:this.$=U.miew.removeObject(de[fe]);break;case 54:this.$=U.echo(U.miew.getURL({view:!1,settings:!1}));break;case 55:this.$=U.echo(U.miew.getURL({view:!1,settings:!0}));break;case 56:this.$=U.echo(U.miew.getURL({view:!0,settings:!1}));break;case 57:case 58:this.$=U.echo(U.miew.getURL({view:!0,settings:!0}));break;case 59:this.$=U.miew.screenshotSave();break;case 60:this.$=U.miew.screenshotSave("",Number(de[fe]));break;case 61:this.$=U.miew.screenshotSave("",Number(de[fe-1]),Number(de[fe]));break;case 62:case 63:case 64:this.$=U.utils.load(U.miew,de[fe]),U.representations.clear();break;case 65:this.$=U.echo(U.representations.add(U.miew.repAdd()));break;case 66:this.$=U.echo(U.representations.add(de[fe],U.miew.repAdd()));break;case 67:this.$=U.echo(U.representations.add(U.miew.repAdd(de[fe])));break;case 68:this.$=U.echo(U.representations.add(de[fe-1],U.miew.repAdd(de[fe])));break;case 69:this.$=U.miew.rep(de[fe]),U.miew.repCurrent(de[fe]);break;case 70:this.$=U.miew.rep(de[fe-1],de[fe]),U.miew.repCurrent(de[fe-1]);break;case 71:this.$=U.miew.rep(U.miew.repCurrent(),{mode:U.utils.checkArg(de[fe-1].toLowerCase(),de[fe].toUpperCase())});break;case 72:this.$=U.miew.rep(U.miew.repCurrent(),{mode:new Array(U.utils.checkArg(de[fe-2].toLowerCase(),de[fe-1].toUpperCase()),de[fe].toJSO(U.utils,de[fe-2],de[fe-1].toUpperCase()))});break;case 73:this.$=U.miew.rep(U.miew.repCurrent(),{colorer:U.utils.checkArg(de[fe-1].toLowerCase(),de[fe].toUpperCase())});break;case 74:this.$=U.miew.rep(U.miew.repCurrent(),{colorer:new Array(U.utils.checkArg(de[fe-2].toLowerCase(),de[fe-1].toUpperCase()),de[fe].toJSO(U.utils,de[fe-2],de[fe-1].toUpperCase()))});break;case 75:this.$=Number(U.representations.get(de[fe]));break;case 76:case 92:this.$=Number(de[fe]);break;case 77:this.$=de[fe];break;case 78:this.$=U.assign(de[fe-1],de[fe]);break;case 79:this.$=U.assign(de[fe-2],de[fe-1],de[fe]);break;case 80:this.$=U.assign(de[fe-3],de[fe-2],de[fe-1],de[fe]);break;case 81:case 82:this.$=U.CreateObjectPair(de[fe].key,de[fe].val);break;case 83:this.$=U.CreateObjectPair(de[fe-1].key,new Array(de[fe-1].val,de[fe].toJSO(U.utils,de[fe-1].key,de[fe-1].val)));break;case 84:case 85:this.$=Object.create({key:U.keyRemap(de[fe-2]),val:U.utils.checkArg(de[fe-2],de[fe])});break;case 86:this.$=[de[fe]];break;case 87:this.$=de[fe-1].concat(de[fe]);break;case 88:this.$=U.CreateObjectPair(de[fe-1].toLowerCase(),Number(de[fe]));break;case 89:this.$=new U.ArgList(de[fe]);break;case 90:this.$=de[fe-1].append(de[fe]);break;case 91:this.$=new U.Arg(de[fe-2],de[fe]);break;case 93:this.$=parseInt(de[fe]);break;case 94:this.$=JSON.parse(de[fe]);break;case 95:case 96:this.$=String(de[fe]);break;case 157:case 158:case 161:case 162:case 163:this.$=de[fe-2]+de[fe-1]+de[fe];break;case 166:this.$=de[fe-2]=de[fe-2]+de[fe-1]+de[fe];break}},table:[{3:1,4:2,5:[1,3],6:[1,4],7:[1,5],9:[1,6],11:[1,7],12:8,13:[1,9],15:[1,10],17:[1,11],18:[1,12],19:[1,13],20:[1,14],21:15,22:16,23:[1,17],25:[1,18],26:[1,19],27:[1,20],30:[1,21],33:[1,22],34:[1,23],37:[1,24],39:25,40:26,41:[1,27],43:[1,28],44:[1,29],45:[1,30],46:[1,31],48:[1,32],49:[1,33],50:34,51:35,52:[1,36],54:[1,37],55:[1,38],56:[1,44],58:[1,45],59:[1,39],62:[1,40],64:[1,41],65:[1,42],66:[1,43]},{1:[3]},{5:[1,46]},{1:[2,2]},{5:[2,3]},{5:[2,4],8:[1,47]},{5:[2,6],6:t,7:e,9:n,10:48,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:49,80:52,81:50,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{5:[2,8]},{5:[2,9]},{6:t,7:e,9:n,10:106,13:r,14:[1,107],15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:49,80:52,81:50,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{6:t,7:e,9:n,10:108,13:r,14:[1,109],15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:49,80:52,81:50,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{5:[2,14]},{5:[2,15]},{5:[2,16]},{5:[2,17],14:Ae,16:110,35:De,38:Be,77:ze,78:We},{5:[2,19]},{5:[2,20]},{24:116,35:$e,38:qe},{24:119,35:$e,38:qe},{24:120,35:$e,38:qe},{5:[2,25],24:121,28:[1,122],29:[1,123],35:$e,38:qe},{14:[1,124]},{14:[1,125]},{35:[1,126]},{38:[1,127]},{5:[2,33]},{5:[2,34]},{5:[2,35],14:[1,128],42:[1,129]},{5:[2,38],35:[1,130]},{5:[2,40]},{35:[1,131]},{47:132,73:133,74:et},{47:135,73:133,74:et},{5:[2,44],14:[1,136]},{5:[2,46]},{5:[2,47]},{6:t,7:e,9:n,10:138,13:r,14:[1,137],15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:49,80:52,81:50,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{5:[2,52]},{35:[1,139]},{14:[1,143],38:[1,141],60:140,61:[1,142]},{5:[2,65],38:[1,144],63:145,67:146,68:147,69:148,70:F,72:H},{24:151,35:$e,38:qe},{38:[1,152]},{38:[1,153]},{5:[2,54],29:[1,154],57:[1,155]},{5:[2,59],35:[1,156]},{1:[2,1]},{5:[2,5]},{5:[2,7],101:X},o(oe,[2,159]),o(oe,[2,160]),o(te,[2,97]),o(te,[2,98]),o(oe,[2,147]),o(oe,[2,148]),o(oe,[2,149]),o(oe,[2,150]),o(oe,[2,151]),o(oe,[2,152]),o(oe,[2,153]),o(te,[2,101]),o(te,[2,102]),o(te,[2,103]),o(te,[2,104]),o(te,[2,105]),o(te,[2,106]),o(te,[2,107]),o(te,[2,108]),o(te,[2,109]),o(te,[2,110]),o(te,[2,111]),o(te,[2,112]),o(te,[2,113]),o(te,[2,114]),o(te,[2,115]),o(te,[2,116]),o(te,[2,117]),o(te,[2,118]),o(te,[2,119]),o(te,[2,120]),o(te,[2,121]),o(te,[2,122]),o(te,[2,123]),o(te,[2,124]),o(te,[2,125]),o(te,[2,126]),o(te,[2,127]),o(te,[2,128]),o(te,[2,129]),o(te,[2,130]),o(te,[2,131]),o(te,[2,132]),o(te,[2,133]),o(te,[2,134]),o(te,[2,135]),o(te,[2,136]),o(te,[2,137]),o(te,[2,138]),o(te,[2,139]),o(te,[2,140]),o(te,[2,141]),o(te,[2,142]),o(te,[2,143]),o(te,[2,144]),o(te,[2,145]),o(te,[2,146]),{5:[2,10],101:X},{5:[2,11]},{14:Ae,16:158,35:De,38:Be,77:ze,78:We,101:X},{14:Ae,16:159,35:De,38:Be,77:ze,78:We},{5:[2,18]},o(Me,[2,92]),o(Me,[2,93]),o(Me,[2,94]),o(Me,[2,95]),o(Me,[2,96]),{5:[2,21]},o(Te,[2,75]),o(Te,[2,76]),{5:[2,22]},{5:[2,23]},{5:[2,24]},{5:[2,26]},{5:[2,27]},{5:[2,28],31:[1,160]},{5:[2,30]},{36:[1,161]},{5:[2,32]},{5:[2,36]},{5:[2,37]},{5:[2,39]},{5:[2,41]},{5:[2,42],73:162,74:et},o(q,[2,86]),{35:[1,163]},{5:[2,43],73:162,74:et},{5:[2,45]},{14:[1,164]},{6:t,7:e,9:n,10:165,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:49,80:52,81:50,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae,101:X},{5:[2,53]},{5:[2,62]},{5:[2,63]},{5:[2,64]},{5:[2,164]},{5:[2,66],63:166,67:146,68:147,69:148,70:F,72:H},{5:[2,67]},{5:[2,77],67:167,68:147,69:148,70:F,72:H},o(Te,[2,81]),o(Te,[2,82],{80:52,53:168,75:169,76:170,79:171,6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue}),{71:[1,172]},{71:[1,173]},{5:[2,69],63:174,67:146,68:147,69:148,70:F,72:H},{5:[2,71],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,53:175,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:169,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,73],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,53:176,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:169,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,55],57:[1,177]},{5:[2,56],29:[1,178]},{5:[2,60],35:[1,179]},{6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,35:[1,181],37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:180,80:52,81:182,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{5:[2,12]},{5:[2,13]},{6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,32:183,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:184,80:52,81:185,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{14:[1,186]},o(q,[2,87]),o(q,[2,88]),{5:[2,48],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,53:187,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:169,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,49],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,53:188,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:169,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,101:X},{5:[2,68]},{5:[2,78],67:189,68:147,69:148,70:F,72:H},o(Te,[2,83],{80:52,76:170,79:171,75:190,6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue}),o(Me,[2,89]),{71:[1,191],101:[1,192]},o(Ee,[2,156]),{14:Ae,16:193,35:De,38:Be,77:ze,78:We},{14:Ae,16:194,35:De,38:Be,77:ze,78:We},{5:[2,70]},{5:[2,72],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:190,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,74],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:190,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,57]},{5:[2,58]},{5:[2,61]},o(oe,[2,161]),o(oe,[2,162]),o(oe,[2,163]),{5:[2,29]},{5:[2,99]},{5:[2,100]},{31:[1,195]},{5:[2,50],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:190,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,51],6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,75:190,76:170,79:171,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},{5:[2,79],67:196,68:147,69:148,70:F,72:H},o(Me,[2,90]),{14:Ae,16:197,35:De,38:Be,77:ze,78:We},{6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,33:h,34:v,35:[1,199],37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,79:198,80:52,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue},o(Te,[2,84]),o(Me,[2,85]),{6:t,7:e,9:n,13:r,15:a,17:s,18:l,19:c,20:u,23:f,25:p,26:g,27:y,30:E,32:200,33:h,34:v,37:C,38:x,41:w,43:_,45:S,46:M,49:T,52:R,54:P,55:I,56:B,58:W,59:D,62:O,64:z,65:G,66:k,70:$,72:Z,74:K,79:184,80:52,81:185,82:j,83:Q,84:le,85:he,86:ve,87:re,88:Ie,89:ge,90:Se,91:Le,92:be,93:ye,94:ce,95:ue,96:Ce,97:Ve,98:ie,99:ae},{5:[2,80]},o(Me,[2,91]),o(Ee,[2,157]),o(Ee,[2,158]),{5:[2,31]}],defaultActions:{3:[2,2],4:[2,3],7:[2,8],8:[2,9],11:[2,14],12:[2,15],13:[2,16],15:[2,19],16:[2,20],25:[2,33],26:[2,34],29:[2,40],34:[2,46],35:[2,47],37:[2,52],46:[2,1],47:[2,5],107:[2,11],110:[2,18],116:[2,21],119:[2,22],120:[2,23],121:[2,24],122:[2,26],123:[2,27],125:[2,30],127:[2,32],128:[2,36],129:[2,37],130:[2,39],131:[2,41],136:[2,45],139:[2,53],140:[2,62],141:[2,63],142:[2,64],143:[2,164],145:[2,67],158:[2,12],159:[2,13],166:[2,68],174:[2,70],177:[2,57],178:[2,58],179:[2,61],183:[2,29],184:[2,99],185:[2,100],196:[2,80],200:[2,31]},parseError:function(ee,Fe){if(Fe.recoverable)this.trace(ee);else{var it=new Error(ee);throw it.hash=Fe,it}},parse:function(ee){var Fe=this,it=[0],U=[],ke=[null],de=[],se=this.table,fe="",je=0,ht=0,pt=2,dt=1,At=de.slice.call(arguments,1),_e=Object.create(this.lexer),Xe={yy:{}};for(var Ue in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Ue)&&(Xe.yy[Ue]=this.yy[Ue]);_e.setInput(ee,Xe.yy),Xe.yy.lexer=_e,Xe.yy.parser=this,typeof _e.yylloc>"u"&&(_e.yylloc={});var Ye=_e.yylloc;de.push(Ye);var ot=_e.options&&_e.options.ranges;typeof Xe.yy.parseError=="function"?this.parseError=Xe.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function gt(){var qt;return qt=U.pop()||_e.lex()||dt,typeof qt!="number"&&(qt instanceof Array&&(U=qt,qt=U.pop()),qt=Fe.symbols_[qt]||qt),qt}for(var Et,yt,mt,St,vt={},Rt,xt,dr,$t;;){if(yt=it[it.length-1],this.defaultActions[yt]?mt=this.defaultActions[yt]:((Et===null||typeof Et>"u")&&(Et=gt()),mt=se[yt]&&se[yt][Et]),typeof mt>"u"||!mt.length||!mt[0]){var pr="";$t=[];for(Rt in se[yt])this.terminals_[Rt]&&Rt>pt&&$t.push("'"+this.terminals_[Rt]+"'");_e.showPosition?pr="Parse error on line "+(je+1)+`:
`+_e.showPosition()+`
Expecting `+$t.join(", ")+", got '"+(this.terminals_[Et]||Et)+"'":pr="Parse error on line "+(je+1)+": Unexpected "+(Et==dt?"end of input":"'"+(this.terminals_[Et]||Et)+"'"),this.parseError(pr,{text:_e.match,token:this.terminals_[Et]||Et,line:_e.yylineno,loc:Ye,expected:$t})}if(mt[0]instanceof Array&&mt.length>1)throw new Error("Parse Error: multiple actions possible at state: "+yt+", token: "+Et);switch(mt[0]){case 1:it.push(Et),ke.push(_e.yytext),de.push(_e.yylloc),it.push(mt[1]),Et=null,ht=_e.yyleng,fe=_e.yytext,je=_e.yylineno,Ye=_e.yylloc;break;case 2:if(xt=this.productions_[mt[1]][1],vt.$=ke[ke.length-xt],vt._$={first_line:de[de.length-(xt||1)].first_line,last_line:de[de.length-1].last_line,first_column:de[de.length-(xt||1)].first_column,last_column:de[de.length-1].last_column},ot&&(vt._$.range=[de[de.length-(xt||1)].range[0],de[de.length-1].range[1]]),St=this.performAction.apply(vt,[fe,ht,je,Xe.yy,mt[1],ke,de].concat(At)),typeof St<"u")return St;xt&&(it=it.slice(0,-1*xt*2),ke=ke.slice(0,-1*xt),de=de.slice(0,-1*xt)),it.push(this.productions_[mt[1]][0]),ke.push(vt.$),de.push(vt._$),dr=se[it[it.length-2]][it[it.length-1]],it.push(dr);break;case 3:return!0}}return!0}},tt=function(){var Je={EOF:1,parseError:function(Fe,it){if(this.yy.parser)this.yy.parser.parseError(Fe,it);else throw new Error(Fe)},setInput:function(Fe,it){return this.yy=it||this.yy||{},this._input=Fe,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var Fe=this._input[0];this.yytext+=Fe,this.yyleng++,this.offset++,this.match+=Fe,this.matched+=Fe;var it=Fe.match(/(?:\r\n?|\n).*/g);return it?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),Fe},unput:function(Fe){var it=Fe.length,U=Fe.split(/(?:\r\n?|\n)/g);this._input=Fe+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-it),this.offset-=it;var ke=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),U.length-1&&(this.yylineno-=U.length-1);var de=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:U?(U.length===ke.length?this.yylloc.first_column:0)+ke[ke.length-U.length].length-U[0].length:this.yylloc.first_column-it},this.options.ranges&&(this.yylloc.range=[de[0],de[0]+this.yyleng-it]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(Fe){this.unput(this.match.slice(Fe))},pastInput:function(){var Fe=this.matched.substr(0,this.matched.length-this.match.length);return(Fe.length>20?"...":"")+Fe.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var Fe=this.match;return Fe.length<20&&(Fe+=this._input.substr(0,20-Fe.length)),(Fe.substr(0,20)+(Fe.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var Fe=this.pastInput(),it=new Array(Fe.length+1).join("-");return Fe+this.upcomingInput()+`
`+it+"^"},test_match:function(Fe,it){var U,ke,de;if(this.options.backtrack_lexer&&(de={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(de.yylloc.range=this.yylloc.range.slice(0))),ke=Fe[0].match(/(?:\r\n?|\n).*/g),ke&&(this.yylineno+=ke.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:ke?ke[ke.length-1].length-ke[ke.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+Fe[0].length},this.yytext+=Fe[0],this.match+=Fe[0],this.matches=Fe,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(Fe[0].length),this.matched+=Fe[0],U=this.performAction.call(this,this.yy,this,it,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),U)return U;if(this._backtrack){for(var se in de)this[se]=de[se];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var Fe,it,U,ke;this._more||(this.yytext="",this.match="");for(var de=this._currentRules(),se=0;se<de.length;se++)if(U=this._input.match(this.rules[de[se]]),U&&(!it||U[0].length>it[0].length)){if(it=U,ke=se,this.options.backtrack_lexer){if(Fe=this.test_match(U,de[se]),Fe!==!1)return Fe;if(this._backtrack){it=!1;continue}else return!1}else if(!this.options.flex)break}return it?(Fe=this.test_match(it,de[ke]),Fe!==!1?Fe:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var Fe=this.next();return Fe||this.lex()},begin:function(Fe){this.conditionStack.push(Fe)},popState:function(){var Fe=this.conditionStack.length-1;return Fe>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Fe){return Fe=this.conditionStack.length-1-Math.abs(Fe||0),Fe>=0?this.conditionStack[Fe]:"INITIAL"},pushState:function(Fe){this.begin(Fe)},stateStackSize:function(){return this.conditionStack.length},options:{"case-insensitive":!0},performAction:function(Fe,it,U,ke){switch(U){case 0:break;case 1:return"";case 2:return"";case 3:return 42;case 4:return 35;case 5:return 77;case 6:return 78;case 7:return 78;case 8:return 8;case 9:return 6;case 10:return 82;case 11:return 7;case 12:return 9;case 13:return 59;case 14:return 13;case 15:return 15;case 16:return 17;case 17:return 18;case 18:return 19;case 19:return 20;case 20:return 11;case 21:return 62;case 22:return 64;case 23:return 23;case 24:return 25;case 25:return 26;case 26:return 27;case 27:return 30;case 28:return 34;case 29:return 33;case 30:return 65;case 31:return 66;case 32:return 37;case 33:return 41;case 34:return 43;case 35:return 52;case 36:return 54;case 37:return 55;case 38:return 46;case 39:return 48;case 40:return 45;case 41:return 49;case 42:return 56;case 43:return 58;case 44:return 44;case 45:return 83;case 46:return 84;case 47:return 85;case 48:return 86;case 49:return 87;case 50:return 88;case 51:return 89;case 52:return 90;case 53:return 91;case 54:return 92;case 55:return 93;case 56:return 94;case 57:return 95;case 58:return 70;case 59:return 70;case 60:return 72;case 61:return 72;case 62:return 74;case 63:return 74;case 64:return 74;case 65:return 31;case 66:return 36;case 67:return 96;case 68:return 97;case 69:return 98;case 70:return 99;case 71:return it.yytext=Fe.utils.unquoteString(it.yytext),14;case 72:return 38;case 73:return 5;case 74:return 101;case 75:return 103;case 76:return"\\";case 77:return 28;case 78:return 61;case 79:return 29;case 80:return 57;case 81:return 71}},rules:[/^(?:\s+)/i,/^(?:[#].*)/i,/^(?:\/\/.*)/i,/^(?:([_A-Z0-9\/\+]+==))/i,/^(?:-?[0-9]+(\.[0-9]+)?\b)/i,/^(?:0[xX][0-9A-F]+\b)/i,/^(?:false\b)/i,/^(?:true\b)/i,/^(?:all\b)/i,/^(?:reset\b)/i,/^(?:clear\b)/i,/^(?:build\b)/i,/^(?:help\b)/i,/^(?:load\b)/i,/^(?:get\b)/i,/^(?:set\b)/i,/^(?:set_save\b)/i,/^(?:set_restore\b)/i,/^(?:set_reset\b)/i,/^(?:preset\b)/i,/^(?:motm\b)/i,/^(?:add\b)/i,/^(?:rep\b)/i,/^(?:remove\b)/i,/^(?:hide\b)/i,/^(?:show\b)/i,/^(?:list\b)/i,/^(?:select\b)/i,/^(?:within\b)/i,/^(?:selector\b)/i,/^(?:mode\b)/i,/^(?:color\b)/i,/^(?:material\b)/i,/^(?:view\b)/i,/^(?:unit\b)/i,/^(?:line\b)/i,/^(?:listobj\b)/i,/^(?:removeobj\b)/i,/^(?:rotate\b)/i,/^(?:translate\b)/i,/^(?:scale\b)/i,/^(?:center\b)/i,/^(?:url\b)/i,/^(?:screenshot\b)/i,/^(?:dssp\b)/i,/^(?:file_list\b)/i,/^(?:file_register\b)/i,/^(?:file_delete\b)/i,/^(?:preset_add\b)/i,/^(?:preset_delete\b)/i,/^(?:preset_update\b)/i,/^(?:preset_rename\b)/i,/^(?:preset_open\b)/i,/^(?:create_scenario\b)/i,/^(?:reset_scenario\b)/i,/^(?:delete_scenario\b)/i,/^(?:add_scenario_item\b)/i,/^(?:list_scenario\b)/i,/^(?:s\b)/i,/^(?:mt\b)/i,/^(?:m\b)/i,/^(?:c\b)/i,/^(?:x\b)/i,/^(?:y\b)/i,/^(?:z\b)/i,/^(?:as\b)/i,/^(?:of\b)/i,/^(?:pdb\b)/i,/^(?:delay\b)/i,/^(?:prst\b)/i,/^(?:desc\b)/i,/^(?:((?:"(?:\\.|[^\\"])*"|'(?:\\.|[^\\'])*')))/i,/^(?:([_A-Z0-9]+))/i,/^(?:$)/i,/^(?:\.)/i,/^(?:\/)/i,/^(?:\\)/i,/^(?:-e\b)/i,/^(?:-f\b)/i,/^(?:-s\b)/i,/^(?:-v\b)/i,/^(?:=)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81],inclusive:!0}}};return Je}();Pe.lexer=tt;function Oe(){this.yy={}}return Oe.prototype=Pe,Pe.Parser=Oe,new Oe}(),MiewCLIParser={parser},modeIdDesc={$help:["Rendering mode shortcut","    BS - balls and sticks mode","    LN - lines mode","    LC - licorice mode","    VW - van der waals mode","    TR - trace mode","    TU - tube mode","    CA - cartoon mode","    SA - isosurface mode","    QS - quick surface mode","    SE - solvent excluded mode","    TX - text mode"],BS:{$help:["   Balls and sticks","      aromrad = <number> #aromatic radius","      atom = <number>    #atom radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      space = <number>   #space value
`]},CA:{$help:["   Cartoon","      arrow = <number>   #arrow size","      depth = <number>   #depth of surface","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius","      tension = <number> #",`      width = <number>  #secondary width
`]},LN:{$help:["   Lines","      atom = <number>    #atom radius","      chunkarom = <number>","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      offsarom = <number>
`]},LC:{$help:["   Licorice","      aromrad = <number> #aromatic radius","      bond = <number>    #bond radius","      multibond = <bool> #use multibond","      showarom = <bool>  #show aromatic",`      space = <number>   #space value
`]},VW:{$help:["   Van der Waals",`      nothing
`]},TR:{$help:["   Trace",`      radius = <number>  #tube radius
`]},TU:{$help:["   Tube","      heightSegmentsRatio = <number>","      radius = <number>  #tube radius",`      tension = <number> 
`]},SA:{$help:["   Surface",`      zClip = <bool> #clip z plane
`]},QS:{$help:["   Quick surface","      isoValue = <number>","      scale = <number>","      wireframe = <bool>",`      zClip = <bool> #clip z plane
`]},SE:{$help:["   Solvent excluded surface",`      zClip = <bool> #clip z plane
`]},TX:{$help:["   Text mode",'      template = <format string> string that can include "{{ id }}"',"          it will be replaced by value, id can be one of next:",`          serial, name, type, sequence, residue, chain, hetatm, water
`,'      horizontalAlign = <string> {"left", "right", "center"}','      verticalAlign = <string> {"top", "bottom", "middle"}',"      dx = <number> #offset along x","      dy = <number> #offset along y","      dz = <number> #offset along z","      fg = <string> #text color modificator","           could be keyword, named color or hex","      fg = <string> #back color modificator","           could be keyword, named color or hex","      showBg = <bool> #if set show background","           plate under text"]}},colorDesc={$help:["Coloring mode shortcut","    EL - color by element","    CH - color by chain","    SQ - color by sequence","    RT - color by residue type","    SS - color by secondary structure","    UN - uniform"],UN:{$help:["Parameters of coloring modes customization","   Uniform",`      color = <number|color> #RGB->HEX->dec
`],color:{$help:Object.keys(palettes$1.get(settings$1.now.palette).namedColors).sort().join(`
`)}}},materialDesc={$help:["Material shortcut","    DF - diffuse","    TR - transparent","    SF - soft plastic","    PL - glossy plastic","    ME - metal","    GL - glass"]},addRepDesc={$help:["Short (packed) representation description as a set of variables","    s=<EXPRESSION>","        selector property","    m=<MODE_ID>[!<PARAMETER>:<VALUE>[,...]]","        render mode property","    c=<COLORER_ID>[!<PARAMETER>:<VALUE>[,...]]","        color mode property","    mt=<MATERIAL_ID>","        material property"],s:{$help:"Selection expression string as it is in menu->representations->selection"},m:modeIdDesc,c:colorDesc,mt:materialDesc},setGetParameterDesc={$help:["Parameters of rendering modes customization: modes","Parameters of colorer customization: colorers","Autobuild: autobuild = (<number>|<bool>)"],modes:modeIdDesc,colorers:colorDesc},help={$help:["help (<cmd name>| <path to property>)","You can get detailed information about command options",`   using "help cmd.opt.opt.[...]"
`,"   you can use one line comments","   everything started from (#|//) will be skipped",`   Example: >build //some comment
`,"List of available commands:"],reset:{$help:["Reload current object, delete all representations","    Nothing will work until load new object"]},load:{$help:["load (<PDBID>|<URL>|-f [<*.NC FILE URL STRING>])","    Load new pdb object from selected source"],PDBID:{$help:"pdb id in remote molecule database"},URL:{$help:"url to source file"},f:{$help:["open file system dialog to fetch local file","optionally you can determine trajectory file","via URL for *.top model"]}},clear:{$help:"No args. Clear terminal"},add:{$help:["add [<REP_NAME>] [<DESCRIPTION>]","    Add new item to representation set with","    default or <DESCRIPTION> params"],REP_NAME:{$help:"Identifier string [_,a-z,A-Z,0-9] can not start from digit"},DESCRIPTION:addRepDesc},rep:{$help:["rep [<REP_NAME>|<REP_INDEX>] [<DESCRIPTION>]","    set current representation by name or index","    edit current representation by <DESCRIPTION>"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"},DESCRIPTION:addRepDesc},remove:{$help:["remove (<REP_NAME>|<REP_INDEX>)","Remove representation by name or index"],REP_NAME:{$help:["Identifier string [_,a-z,A-Z,0-9] can not start from digit","Must be declared before"]},REP_INDEX:{$help:"Index of available representation"}},selector:{$help:["selector <EXPRESSION>","   set selector from EXPRESSION to current representation"],EXPRESSION:{$help:"Selection expression string as it is in menu->representations->selection"}},mode:{$help:["mode <MODE_ID> [<PARAMETER>=<VALUE>...]","   set rendering mode and apply parameters to current representation"],MODE_ID:modeIdDesc},color:{$help:["color <COLORER_ID> [<PARAMETER>=<VALUE>...]","   set colorer and apply parameters to current representation"],COLORER_ID:colorDesc},material:{$help:["material <MATERIAL_ID>","   set material to current representation"],MATERIAL_ID:materialDesc},build:{$help:"build help str",add:{$help:"build.add",new:{$help:["add.new","add.new new line 1","add.new new line 2","add.new new line 3"]}},del:{$help:"build.del"}},list:{$help:["list [-e|-s|<REP_NAME>|<REP_INDEX>]","Print representations if no args print list of representations","    -e expand list and show all representations","    -s show all user-registered selectors","    <REP_NAME>|<REP_INDEX> show only current representation"]},hide:{$help:["hide (<REP_NAME>|<REP_INDEX>)","Hide representation referenced in args"]},show:{$help:["show (<REP_NAME>|<REP_INDEX>)","Show representation referenced in args"]},get:{$help:["get <PARAMETER>","Print <PARAMETER> value","    <PARAMETER> - path to option use get.PARAMETER to get more info"],PARAMETER:setGetParameterDesc},set:{$help:["set <PARAMETER> <VALUE>","Set <PARAMETER> with <VALUE>","    <PARAMETER> - path to option use set.PARAMETER to get more info"],PARAMETER:setGetParameterDesc},set_save:{$help:["set_save","Save current settings to cookie"]},set_restore:{$help:["set_restore","Load and apply settings from cookie"]},set_reset:{$help:["set_reset","Reset current settings to the defaults"]},preset:{$help:["preset [<PRESET>]","Reset current representation or set preset to <PRESET>"],PRESET:{$help:["default","wire","small","macro"]}},unit:{$help:["unit [<unit_id>]","Change current biological structure view. Zero <unit_id> value means asymmetric unit,","positive values set an assembly with corresponding number.","Being called with no parameters command prints current unit information."]},view:{$help:["view [<ENCODED_VIEW>]","Get current encoded view or set if ENCODED_VIEW placed as argument"],ENCODED_VIEW:{$help:["encoded view matrix string (binary code)"]}},rotate:{$help:["rotate (x|y|z) [<DEGREES>] [(x|y|z) [<DEGREES>]]...","Rotate scene"]},scale:{$help:["scale <SCALE>","Scale scene"]},select:{$help:["select <SELECTOR_STRING> [as <SELECTOR_NAME>]","Select atoms using selector defined in SELECTOR_STRING","    and if SELECTOR_NAME is defined register it in viewer","    you can use it later as a complex selector"]},within:{$help:["within <DISTANCE> of <SELECTOR_STRING> as <SELECTOR_NAME>","Build within named selector","    DISTANCE        <number>","    SELECTOR_STRING <string(selection language)>","    SELECTOR_NAME   <identifier>"]},url:{$help:["url [-s] [-v]","Report URL encoded scene","    if -s set that include settings in the URL","    if -v set that include view in the URL"]},screenshot:{$help:["screenshot [<WIDTH> [<HEIGHT>]]","Make a screenshot of the scene","    WIDTH  <number> in pixels","    HEIGHT <number> in pixels, equal to WIDTH by default"]},line:{$help:["line <first_atom_path> <second_atom_path> [<PARAMETER>=<VALUE>]","Draw dashed line between two specified atoms"]},removeobj:{$help:["removeobj <id>","Remove scene object by its index. Indices could be obtained by <listobj> command"]},listobj:{$help:["listobj","Display the list of all existing scene objects"]}},selectors=Miew.chem.selectors,modes=Miew.modes,colorers=Miew.colorers,materials=Miew.materials,palettes=Miew.palettes,options=Miew.options,settings=Miew.settings;function None(){}var NULL=function(){var o=new None;return function(){return o}}(),RepresentationMap=function(){function o(){_classCallCheck(this,o),this.representationMap={},this.representationID={}}return _createClass(o,[{key:"get",value:function(e){return this.representationMap[e]||this.representationID[e]||"<no name>"}},{key:"add",value:function(e,n){if(e===-1)return"Can not create representation: there is no data";if(n!==void 0)if(!this.representationMap.hasOwnProperty(e))this.representationMap[e.toString()]=n,this.representationID[n]=e.toString();else return"This name has already existed, registered without name";return"Representation ".concat(e," successfully added")}},{key:"remove",value:function(e){e&&this.representationID.hasOwnProperty(e)&&(delete this.representationMap[this.representationID[e]],delete this.representationID[e]);var n=Object.keys(this.representationID).sort();for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];a>e&&(this.representationID[a-1]=this.representationID[a],this.representationMap[this.representationID[a]]-=1,delete this.representationID[a])}}},{key:"clear",value:function(){this.representationMap={},this.representationID={}}}]),o}(),representationsStorage=new RepresentationMap;function keyRemap(o){var t={s:"selector",m:"mode",c:"colorer",mt:"material",mode:"modes",color:"colorers",colorer:"colorers",select:"selector",material:"materials",selector:"selector"},e=t[o];return e===void 0?o:e}var CLIUtils=function(){function o(){_classCallCheck(this,o)}return _createClass(o,[{key:"list",value:function(e,n,r){var a="";if(e&&n!==void 0&&(r===void 0||r==="-e"))for(var s=e.repCount(),l=0;l<s;l++)a+=this.listRep(e,n,l,r);return a}},{key:"listRep",value:function(e,n,r,a){var s="",l=e.repGet(r);if(!l)return logger.warn("Rep ".concat(r," does not exist!")),s;var c=r,u=n.get(c),f=l.mode,p=l.colorer,g=l.selectorString,y=l.materialPreset;return s+="#".concat(c," : ").concat(f.name).concat(u==="<no name>"?"":", ".concat(u),`
`),a!==void 0&&(s+='    selection : "'.concat(g,`"
`),s+="    mode      : (".concat(f.id,"), ").concat(f.name,`
`),s+="    colorer   : (".concat(p.id,"), ").concat(p.name,`
`),s+="    material  : (".concat(y.id,"), ").concat(y.name,`
`)),s}},{key:"listSelector",value:function(e,n){var r="";for(var a in n)n.hasOwnProperty(a)&&(r+="".concat(a,' : "').concat(n[a],`"
`));return r}},{key:"listObjs",value:function(e){var n=e._objects;if(!n||!Array.isArray(n)||n.length===0)return"There are no objects on the scene";for(var r=[],a=0,s=n.length;a<s;++a)r[a]="".concat(a,": ").concat(n[a].toString());return r.join(`
`)}},{key:"joinHelpStr",value:function(e){return e instanceof Array?e.join(`
`):e}},{key:"help",value:function(e){if(lodashExports.isUndefined(e))return"".concat(this.joinHelpStr(help.$help),`
`).concat(lodashExports.slice(lodashExports.sortBy(lodashExports.keys(help)),1).join(", "),`
`);var n=lodashExports.get(help,e);return lodashExports.isUndefined(n)?this.help():"".concat(this.joinHelpStr(n.$help),`
`)}},{key:"load",value:function(e,n){if(!(e===void 0||n===void 0||n==="-f")){e.awaitWhileCMDisInProcess();var r=function(){return e.finishAwaitingCMDInProcess()};e.load(n).then(r,r)}}},{key:"checkArg",value:function(e,n,r){if(e!==void 0&&n!==void 0){if(keyRemap(e)==="selector"){var a=selectors.parse(n);if(a.error!==void 0){var s={message:a.error};throw s}return r!==void 0&&r?a.selector:n}for(var l={colorers,modes,materials},c=e,u;c!==u;)u=c,c=keyRemap(u);if(l[c].get(n)===void 0){var f={message:"".concat(n," is not existed in ").concat(c)};throw f}return n}return NULL}},{key:"propagateProp",value:function(e,n){if(e!==void 0){var r={},a=options.adapters[_typeof(lodashExports.get(settings.defaults,e))];if(a===void 0){var s={message:"".concat(e," is not existed")};throw s}if((e.endsWith(".color")||e.endsWith(".baseColor")||e.endsWith(".EL.carbon"))&&typeof n!="number"&&(n=palettes.get(settings.now.palette).getNamedColor(n)),e.endsWith(".fg")||e.endsWith(".bg"))if(typeof n!="number"){var l=palettes.get(settings.now.palette).getNamedColor(n,!0);l!==void 0&&(n="0x".concat(l.toString(16)))}else n="0x".concat(n.toString(16));if(e.endsWith(".template")&&(n=n.replace(/\\n/g,`
`)),n!==void 0&&a(n)!==n&&a(n)!==n>0)throw r={message:"".concat(e,' must be a "').concat(_typeof(lodashExports.get(settings.defaults,e)),'"')},r}return n}},{key:"unquoteString",value:function(e){return utils.unquoteString(e)}}]),o}(),utilFunctions=new CLIUtils;function CreateObjectPair(o,t){var e={};return e[o]=t,e}function ArgList(o){if(o instanceof this.constructor)return o;o instanceof Array?this._values=o.slice(0):o?this._values=[o]:this._values=[]}ArgList.prototype.append=function(o){var t=this._values;return t[t.length]=o,this};ArgList.prototype.remove=function(o){var t=this._values,e=t.indexOf(o);return e>=0&&t.splice(e,1),this};ArgList.prototype.toJSO=function(o,t,e){for(var n={},r=this._values,a=0,s=r.length;a<s;++a)lodashExports.set(n,r[a].id,o.propagateProp("".concat(keyRemap(t),".").concat(e,".").concat(r[a].id),r[a].val));return n};function Arg(o,t){this.id=o,this.val=t}var cliutils=Object.create({});cliutils.Arg=Arg;cliutils.ArgList=ArgList;cliutils.miew=null;cliutils.echo=null;cliutils.representations=representationsStorage;cliutils.utils=utilFunctions;cliutils.assign=lodashExports.assign;cliutils.CreateObjectPair=CreateObjectPair;cliutils.keyRemap=keyRemap;cliutils.Context=selectors.Context;cliutils.ClearContext=selectors.ClearContext;cliutils.NULL=NULL;cliutils.notimplemented=function(){return this.NULL};Miew.prototype.script=function(o,t,e){MiewCLIParser.parser.yy.miew=this,MiewCLIParser.parser.yy.echo=t,MiewCLIParser.parser.yy.error=e,this.cmdQueue===void 0&&(this.cmdQueue=[]),this.commandInAction===void 0&&(this.commandInAction=!1),this.cmdQueue=this.cmdQueue.concat(o.split(`
`))};Miew.prototype.awaitWhileCMDisInProcess=function(){this.commandInAction=!0};Miew.prototype.finishAwaitingCMDInProcess=function(){this.commandInAction=!1};Miew.prototype.isScriptingCommandAvailable=function(){return this.commandInAction!==void 0&&!this.commandInAction&&this.cmdQueue!==void 0&&this.cmdQueue.length>0};Miew.prototype.callNextCmd=function(){if(this.isScriptingCommandAvailable()){var o=this.cmdQueue.shift(),t={};t.success=!1;try{MiewCLIParser.parser.parse(o),t.success=!0}catch(e){t.error=e.message,MiewCLIParser.parser.yy.error(t.error),this.finishAwaitingCMDInProcess()}return t}return""};MiewCLIParser.parser.yy=cliutils;MiewCLIParser.parser.yy.parseError=MiewCLIParser.parser.parseError;var _3Dmol={exports:{}};/*!
 * 3dmol v2.0.6
 * JavaScript/TypeScript molecular visualization library
 * Author: David Koes and contributors
 */(function(module,exports){(function(t,e){module.exports=e()})(commonjsGlobal$1,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":(o,t,e)=>{e.r(t),e.d(t,{IOBuffer:()=>l});var n=e("./node_modules/iobuffer/lib-esm/text.browser.js");const r=1024*8,a=(()=>{const c=new Uint8Array(4),u=new Uint32Array(c.buffer);return!((u[0]=1)&c[0])})(),s={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class l{constructor(u=r,f={}){let p=!1;typeof u=="number"?u=new ArrayBuffer(u):(p=!0,this.lastWrittenByte=u.byteLength);const g=f.offset?f.offset>>>0:0,y=u.byteLength-g;let E=g;(ArrayBuffer.isView(u)||u instanceof l)&&(u.byteLength!==u.buffer.byteLength&&(E=u.byteOffset+g),u=u.buffer),p?this.lastWrittenByte=y:this.lastWrittenByte=0,this.buffer=u,this.length=y,this.byteLength=y,this.byteOffset=E,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,E,y),this._mark=0,this._marks=[]}available(u=1){return this.offset+u<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(u=1){return this.offset+=u,this}back(u=1){return this.offset-=u,this}seek(u){return this.offset=u,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const u=this._marks.pop();if(u===void 0)throw new Error("Mark stack empty");return this.seek(u),this}rewind(){return this.offset=0,this}ensureAvailable(u=1){if(!this.available(u)){const p=(this.offset+u)*2,g=new Uint8Array(p);g.set(new Uint8Array(this.buffer)),this.buffer=g.buffer,this.length=this.byteLength=p,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(u=1){return this.readArray(u,"uint8")}readArray(u,f){const p=s[f].BYTES_PER_ELEMENT*u,g=this.byteOffset+this.offset,y=this.buffer.slice(g,g+p);if(this.littleEndian===a&&f!=="uint8"&&f!=="int8"){const h=new Uint8Array(this.buffer.slice(g,g+p));h.reverse();const v=new s[f](h.buffer);return this.offset+=p,v.reverse(),v}const E=new s[f](y);return this.offset+=p,E}readInt16(){const u=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,u}readUint16(){const u=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,u}readInt32(){const u=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,u}readUint32(){const u=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,u}readFloat32(){const u=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,u}readFloat64(){const u=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,u}readBigInt64(){const u=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,u}readBigUint64(){const u=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,u}readChar(){return String.fromCharCode(this.readInt8())}readChars(u=1){let f="";for(let p=0;p<u;p++)f+=this.readChar();return f}readUtf8(u=1){return(0,n.decode)(this.readBytes(u))}decodeText(u=1,f="utf-8"){return(0,n.decode)(this.readBytes(u),f)}writeBoolean(u){return this.writeUint8(u?255:0),this}writeInt8(u){return this.ensureAvailable(1),this._data.setInt8(this.offset++,u),this._updateLastWrittenByte(),this}writeUint8(u){return this.ensureAvailable(1),this._data.setUint8(this.offset++,u),this._updateLastWrittenByte(),this}writeByte(u){return this.writeUint8(u)}writeBytes(u){this.ensureAvailable(u.length);for(let f=0;f<u.length;f++)this._data.setUint8(this.offset++,u[f]);return this._updateLastWrittenByte(),this}writeInt16(u){return this.ensureAvailable(2),this._data.setInt16(this.offset,u,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(u){return this.ensureAvailable(2),this._data.setUint16(this.offset,u,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(u){return this.ensureAvailable(4),this._data.setInt32(this.offset,u,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(u){return this.ensureAvailable(4),this._data.setUint32(this.offset,u,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(u){return this.ensureAvailable(4),this._data.setFloat32(this.offset,u,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(u){return this.ensureAvailable(8),this._data.setFloat64(this.offset,u,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(u){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,u,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(u){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,u,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(u){return this.writeUint8(u.charCodeAt(0))}writeChars(u){for(let f=0;f<u.length;f++)this.writeUint8(u.charCodeAt(f));return this}writeUtf8(u){return this.writeBytes((0,n.encode)(u))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js":function(){(function(o){if(o.TextEncoder&&o.TextDecoder)return!1;function t(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(n,r={stream:!1}){if(r.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let a=0;const s=n.length;let l=0,c=Math.max(32,s+(s>>1)+7),u=new Uint8Array(c>>3<<3);for(;a<s;){let f=n.charCodeAt(a++);if(f>=55296&&f<=56319){if(a<s){const p=n.charCodeAt(a);(p&64512)===56320&&(++a,f=((f&1023)<<10)+(p&1023)+65536)}if(f>=55296&&f<=56319)continue}if(l+4>u.length){c+=8,c*=1+a/n.length*2,c=c>>3<<3;const p=new Uint8Array(c);p.set(u),u=p}if(f&4294967168)if(!(f&4294965248))u[l++]=f>>6&31|192;else if(!(f&4294901760))u[l++]=f>>12&15|224,u[l++]=f>>6&63|128;else if(!(f&4292870144))u[l++]=f>>18&7|240,u[l++]=f>>12&63|128,u[l++]=f>>6&63|128;else continue;else{u[l++]=f;continue}u[l++]=f&63|128}return u.slice(0,l)};function e(n="utf-8",r={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(r.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(e.prototype,"fatal",{value:!1}),Object.defineProperty(e.prototype,"ignoreBOM",{value:!1}),e.prototype.decode=function(n,r={stream:!1}){if(r.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const a=new Uint8Array(n);let s=0;const l=a.length,c=[];for(;s<l;){const u=a[s++];if(u===0)break;if(!(u&128))c.push(u);else if((u&224)===192){const f=a[s++]&63;c.push((u&31)<<6|f)}else if((u&240)===224){const f=a[s++]&63,p=a[s++]&63;c.push((u&31)<<12|f<<6|p)}else if((u&248)===240){const f=a[s++]&63,p=a[s++]&63,g=a[s++]&63;let y=(u&7)<<18|f<<12|p<<6|g;y>65535&&(y-=65536,c.push(y>>>10&1023|55296),y=56320|y&1023),c.push(y)}}return String.fromCharCode.apply(null,c)},o.TextEncoder=t,o.TextDecoder=e})(typeof window<"u"?window:typeof self<"u"?self:this)},"./node_modules/iobuffer/lib-esm/text.browser.js":(o,t,e)=>{e.r(t),e.d(t,{decode:()=>n,encode:()=>a}),e("./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js");function n(s,l="utf8"){return new TextDecoder(l).decode(s)}const r=new TextEncoder;function a(s){return r.encode(s)}},"./node_modules/netcdfjs/lib-esm/data.js":(o,t,e)=>{e.r(t),e.d(t,{nonRecord:()=>r,record:()=>a});var n=e("./node_modules/netcdfjs/lib-esm/types.js");function r(s,l){const c=(0,n.str2num)(l.type),u=l.size/(0,n.num2bytes)(c),f=new Array(u);for(let p=0;p<u;p++)f[p]=(0,n.readType)(s,c,1);return f}function a(s,l,c){const u=(0,n.str2num)(l.type),f=l.size?l.size/(0,n.num2bytes)(u):1,p=c.length,g=new Array(p),y=c.recordStep;if(y)for(let E=0;E<p;E++){const h=s.offset;g[E]=(0,n.readType)(s,u,f),s.seek(h+y)}else throw new Error("recordDimension.recordStep is undefined");return g}},"./node_modules/netcdfjs/lib-esm/header.js":(o,t,e)=>{e.r(t),e.d(t,{header:()=>f});var n=e("./node_modules/netcdfjs/lib-esm/types.js"),r=e("./node_modules/netcdfjs/lib-esm/utils.js");const a=0,s=10,l=11,c=12,u=0;function f(E,h){const v={version:h},C={length:E.readUint32()},x=p(E);Array.isArray(x)||(C.id=x.recordId,C.name=x.recordName,v.dimensions=x.dimensions),v.globalAttributes=g(E);const w=y(E,C==null?void 0:C.id,h);return Array.isArray(w)||(v.variables=w.variables,C.recordStep=w.recordStep),v.recordDimension=C,v}function p(E){const h={};let v,C;const x=E.readUint32();let w;if(x===a)return(0,r.notNetcdf)(E.readUint32()!==a,"wrong empty tag for list of dimensions"),[];{(0,r.notNetcdf)(x!==s,"wrong tag for list of dimensions");const _=E.readUint32();w=new Array(_);for(let S=0;S<_;S++){const M=(0,r.readName)(E),T=E.readUint32();T===u&&(v=S,C=M),w[S]={name:M,size:T}}}return v!==void 0&&(h.recordId=v),C!==void 0&&(h.recordName=C),h.dimensions=w,h}function g(E){const h=E.readUint32();let v;if(h===a)return(0,r.notNetcdf)(E.readUint32()!==a,"wrong empty tag for list of attributes"),[];{(0,r.notNetcdf)(h!==c,"wrong tag for list of attributes");const C=E.readUint32();v=new Array(C);for(let x=0;x<C;x++){const w=(0,r.readName)(E),_=E.readUint32();(0,r.notNetcdf)(_<1||_>6,`non valid type ${_}`);const S=E.readUint32(),M=(0,n.readType)(E,_,S);(0,r.padding)(E),v[x]={name:w,type:(0,n.num2str)(_),value:M}}}return v}function y(E,h,v){const C=E.readUint32();let x=0,w;if(C===a)return(0,r.notNetcdf)(E.readUint32()!==a,"wrong empty tag for list of variables"),[];{(0,r.notNetcdf)(C!==l,"wrong tag for list of variables");const _=E.readUint32();w=new Array(_);for(let S=0;S<_;S++){const M=(0,r.readName)(E),T=E.readUint32(),R=new Array(T);for(let O=0;O<T;O++)R[O]=E.readUint32();const P=g(E),I=E.readUint32();(0,r.notNetcdf)(I<1&&I>6,`non valid type ${I}`);const B=E.readUint32();let W=E.readUint32();v===2&&((0,r.notNetcdf)(W>0,"offsets larger than 4GB not supported"),W=E.readUint32());let D=!1;typeof h<"u"&&R[0]===h&&(x+=B,D=!0),w[S]={name:M,dimensions:R,attributes:P,type:(0,n.num2str)(I),size:B,offset:W,record:D}}}return{variables:w,recordStep:x}}},"./node_modules/netcdfjs/lib-esm/index.js":(o,t,e)=>{e.r(t),e.d(t,{NetCDFReader:()=>n.NetCDFReader});var n=e("./node_modules/netcdfjs/lib-esm/parser.js")},"./node_modules/netcdfjs/lib-esm/parser.js":(o,t,e)=>{e.r(t),e.d(t,{NetCDFReader:()=>c});var n=e("./node_modules/iobuffer/lib-esm/IOBuffer.js"),r=e("./node_modules/netcdfjs/lib-esm/data.js"),a=e("./node_modules/netcdfjs/lib-esm/header.js"),s=e("./node_modules/netcdfjs/lib-esm/toString.js"),l=e("./node_modules/netcdfjs/lib-esm/utils.js");class c{constructor(f){this.toString=s.toString;const p=new n.IOBuffer(f);p.setBigEndian(),(0,l.notNetcdf)(p.readChars(3)!=="CDF","should start with CDF");const g=p.readByte();(0,l.notNetcdf)(g>2,"unknown version"),this.header=(0,a.header)(p,g),this.buffer=p}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(f){const p=this.globalAttributes.find(g=>g.name===f);return p?p.value:null}getDataVariableAsString(f){const p=this.getDataVariable(f);return p?p.join(""):null}get variables(){return this.header.variables}getDataVariable(f){let p;if(typeof f=="string"?p=this.header.variables.find(g=>g.name===f):p=f,p===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(p.offset),p.record?(0,r.record)(this.buffer,p,this.header.recordDimension):(0,r.nonRecord)(this.buffer,p)}dataVariableExists(f){return this.header.variables.find(g=>g.name===f)!==void 0}attributeExists(f){return this.globalAttributes.find(g=>g.name===f)!==void 0}}},"./node_modules/netcdfjs/lib-esm/toString.js":(o,t,e)=>{e.r(t),e.d(t,{toString:()=>n});function n(){const r=[];r.push("DIMENSIONS");for(const s of this.dimensions)r.push(`  ${s.name.padEnd(30)} = size: ${s.size}`);r.push(""),r.push("GLOBAL ATTRIBUTES");for(const s of this.globalAttributes)r.push(`  ${s.name.padEnd(30)} = ${s.value}`);const a=JSON.parse(JSON.stringify(this.variables));r.push(""),r.push("VARIABLES:");for(const s of a){s.value=this.getDataVariable(s);let l=JSON.stringify(s.value);l.length>50&&(l=l.substring(0,50)),isNaN(s.value.length)||(l+=` (length: ${s.value.length})`),r.push(`  ${s.name.padEnd(30)} = ${l}`)}return r.join(`
`)}},"./node_modules/netcdfjs/lib-esm/types.js":(o,t,e)=>{e.r(t),e.d(t,{num2bytes:()=>a,num2str:()=>r,readType:()=>c,str2num:()=>s});const n={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function r(f){switch(Number(f)){case n.BYTE:return"byte";case n.CHAR:return"char";case n.SHORT:return"short";case n.INT:return"int";case n.FLOAT:return"float";case n.DOUBLE:return"double";default:return"undefined"}}function a(f){switch(Number(f)){case n.BYTE:return 1;case n.CHAR:return 1;case n.SHORT:return 2;case n.INT:return 4;case n.FLOAT:return 4;case n.DOUBLE:return 8;default:return-1}}function s(f){switch(String(f)){case"byte":return n.BYTE;case"char":return n.CHAR;case"short":return n.SHORT;case"int":return n.INT;case"float":return n.FLOAT;case"double":return n.DOUBLE;default:return-1}}function l(f,p){if(f!==1){const g=new Array(f);for(let y=0;y<f;y++)g[y]=p();return g}else return p()}function c(f,p,g){switch(p){case n.BYTE:return Array.from(f.readBytes(g));case n.CHAR:return u(f.readChars(g));case n.SHORT:return l(g,f.readInt16.bind(f));case n.INT:return l(g,f.readInt32.bind(f));case n.FLOAT:return l(g,f.readFloat32.bind(f));case n.DOUBLE:return l(g,f.readFloat64.bind(f));default:throw new Error(`non valid type ${p}`)}}function u(f){return f.charCodeAt(f.length-1)===0?f.substring(0,f.length-1):f}},"./node_modules/netcdfjs/lib-esm/utils.js":(o,t,e)=>{e.r(t),e.d(t,{notNetcdf:()=>n,padding:()=>r,readName:()=>a});function n(s,l){if(s)throw new TypeError(`Not a valid NetCDF v3.x file: ${l}`)}function r(s){s.offset%4!==0&&s.skip(4-s.offset%4)}function a(s){const l=s.readUint32(),c=s.readChars(l);return r(s),c}},"./src/WebGL/shaders/lib/basic/basic.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/basic/basic.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`},"./src/WebGL/shaders/lib/instanced/instanced.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/instanced/instanced.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/lambert/lambert.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}`},"./src/WebGL/shaders/lib/lambert/lambert.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/outline/outline.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/outline/outline.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    gl_Position = projectionMatrix * mvPosition;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`},"./src/WebGL/shaders/lib/screen/screen.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);
}
        `},"./src/WebGL/shaders/lib/screen/screen.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;

// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0

vec4 applyFXAA(vec2 fragCoord, sampler2D tex)
{
    vec4 color;
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec3 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP).xyz;
    vec3 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP).xyz;
    vec3 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP).xyz;
    vec3 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP).xyz;
    vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)).xyz +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5).xyz +
        texture2D(tex, fragCoord  + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, 1.0);
    else
        color = vec4(rgbB, 1.0);
    return color;
}
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    gl_FragColor = vec4(vLight*vColor, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );


}

`},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);
    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+adjust;
}

`},"./src/WebGL/shaders/lib/sprite/sprite.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform int fogType;
uniform vec3 fogColor;
uniform float fogDensity;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a < alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogType > 0) {

        float depth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = 0.0;

        if (fogType == 1) {
            fogFactor = smoothstep(fogNear, fogFar, depth);
        }

        else {
            const float LOG2 = 1.442695;
            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);
            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);
        }

        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);

    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    gl_FragColor = vec4(light*color, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(projectionMatrix[3][3] == 0.0) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(projectionMatrix[3][3] == 0.0) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }
    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
    mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    to.xyz += normalize(to.xyz)*outlinePushback;
    pt.xyz += normalize(pt.xyz)*outlinePushback;

    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }
    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`},"./src/WebGL/shaders/lib/volumetric/volumetric.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `},"./src/WebGL/shaders/lib/volumetric/volumetric.vert":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`},"./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag":(o,t,e)=>{e.r(t),e.d(t,{default:()=>n});const n=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`},"./src/GLDraw.ts":(o,t,e)=>{e.r(t),e.d(t,{CAP:()=>r,GLDraw:()=>a});var n=e("./src/WebGL/math/index.ts"),r;(function(s){s[s.NONE=0]="NONE",s[s.FLAT=1]="FLAT",s[s.ROUND=2]="ROUND"})(r||(r={}));var a;(function(s){function l(h,v,C){var x=Math.hypot(h,v),w,_,S,M,T;x<1e-4?(_=0,S=1):(_=-h/x,S=v/x),v=-_*h+S*v,w=Math.hypot(v,C),w<1e-4?(M=0,T=1):(M=C/w,T=v/w);var R=new Float32Array(9);return R[0]=S,R[1]=_,R[2]=0,R[3]=-_*T,R[4]=S*T,R[5]=M,R[6]=_*M,R[7]=-S*M,R[8]=T,R}class c{constructor(){this.cache={};let v=[],C=4,x=Math.pow(2,C),w=2,_=Math.pow(2,w),S=x/_,M;for(v[0]=new n.Vector3(-1,0,0),v[S]=new n.Vector3(0,0,1),v[S*2]=new n.Vector3(1,0,0),v[S*3]=new n.Vector3(0,0,-1),w=3;w<=C;w++){for(_=Math.pow(2,w-1),S=x/_,M=0;M<_-1;M++)v[S/2+M*S]=v[M*S].clone().add(v[(M+1)*S]).normalize();M=_-1,v[S/2+M*S]=v[M*S].clone().add(v[0]).normalize()}this.basisVectors=v}getVerticesForRadius(v,C,x){if(typeof this.cache<"u"&&this.cache[v]!==void 0&&this.cache[v][C+x]!==void 0)return this.cache[v][C+x];for(var w=this.basisVectors.length,_=[],S=[],M,T=0;T<w;T++)_.push(this.basisVectors[T].clone().multiplyScalar(v)),_.push(this.basisVectors[T].clone().multiplyScalar(v)),M=this.basisVectors[T].clone().normalize(),S.push(M),S.push(M);var R=[],P=10,I=w,B=0,W=Math.PI*2,D=0,O=Math.PI,z,G,k=!1,$=!1;for(G=0;G<=P;G++){k=G===0||G===P,$=G===P/2;var Z=[],K=[];for(z=0;z<=I;z++){if($){var j=z<I?2*z:0;K.push(j+1),Z.push(j);continue}var Q=z/I,le=G/P;if(!k||z===0)if(z<I){var he=new n.Vector3;he.x=-v*Math.cos(B+Q*W)*Math.sin(D+le*O),C==1?he.y=0:he.y=v*Math.cos(D+le*O),he.z=v*Math.sin(B+Q*W)*Math.sin(D+le*O),Math.abs(he.x)<1e-5&&(he.x=0),Math.abs(he.y)<1e-5&&(he.y=0),Math.abs(he.z)<1e-5&&(he.z=0),C==r.FLAT?(M=new n.Vector3(0,Math.cos(D+le*O),0),M.normalize()):(M=new n.Vector3(he.x,he.y,he.z),M.normalize()),_.push(he),S.push(M),Z.push(_.length-1)}else Z.push(_.length-I);else k&&Z.push(_.length-1)}$&&R.push(K),R.push(Z)}var ve={vertices:_,normals:S,verticesRows:R,w:I,h:P};return v in this.cache||(this.cache[v]={}),this.cache[v][C+x]=ve,ve}}var u=new c;function f(h,v,C,x,w,_=0,S=0){if(!(!v||!C)){var M=S||_;w=w||{r:0,g:0,b:0};var T=l(C.x-v.x,C.y-v.y,C.z-v.z),R=u.getVerticesForRadius(x,S,"to"),P=R.w,I=R.h,B=M?I*P+2:2*P,W=h.updateGeoGroup(B),D=R.vertices,O=R.normals,z=R.verticesRows,G=z[I/2],k=z[I/2+1],$=W.vertices,Z,K,j,Q,le,he,ve=W.vertexArray,re=W.normalArray,Ie=W.colorArray,ge=W.faceArray;for(j=0;j<P;++j){var Se=2*j;Q=T[0]*D[Se].x+T[3]*D[Se].y+T[6]*D[Se].z,le=T[1]*D[Se].x+T[4]*D[Se].y+T[7]*D[Se].z,he=T[5]*D[Se].y+T[8]*D[Se].z,Z=3*($+Se),K=W.faceidx,ve[Z]=Q+v.x,ve[Z+1]=le+v.y,ve[Z+2]=he+v.z,ve[Z+3]=Q+C.x,ve[Z+4]=le+C.y,ve[Z+5]=he+C.z,re[Z]=Q,re[Z+3]=Q,re[Z+1]=le,re[Z+4]=le,re[Z+2]=he,re[Z+5]=he,Ie[Z]=w.r,Ie[Z+3]=w.r,Ie[Z+1]=w.g,Ie[Z+4]=w.g,Ie[Z+2]=w.b,Ie[Z+5]=w.b,ge[K]=k[j]+$,ge[K+1]=k[j+1]+$,ge[K+2]=G[j]+$,ge[K+3]=G[j]+$,ge[K+4]=k[j+1]+$,ge[K+5]=G[j+1]+$,W.faceidx+=6}if(M){var Le=S?0:I/2,be=_?I+1:I/2+1,ye,ce,ue,Ce,Ve,ie,ae,Ae,De,Be,ze,We,$e,qe,et,F,H,X,oe,te,Me,Te,q,Ee,Pe,tt,Oe,Je,ee,Fe,it,U;for(le=Le;le<be;le++)if(le!==I/2){var ke=le<=I/2?C:v,de=u.getVerticesForRadius(x,S,"to"),se=u.getVerticesForRadius(x,_,"from");for(ke===C?(D=de.vertices,O=de.normals,z=de.verticesRows):ke==v&&(D=se.vertices,O=se.normals,z=se.verticesRows),Q=0;Q<P;Q++)K=W.faceidx,ye=z[le][Q+1],ee=(ye+$)*3,ce=z[le][Q],Fe=(ce+$)*3,ue=z[le+1][Q],it=(ue+$)*3,Ce=z[le+1][Q+1],U=(Ce+$)*3,Ve=T[0]*D[ye].x+T[3]*D[ye].y+T[6]*D[ye].z,ie=T[0]*D[ce].x+T[3]*D[ce].y+T[6]*D[ce].z,ae=T[0]*D[ue].x+T[3]*D[ue].y+T[6]*D[ue].z,Ae=T[0]*D[Ce].x+T[3]*D[Ce].y+T[6]*D[Ce].z,De=T[1]*D[ye].x+T[4]*D[ye].y+T[7]*D[ye].z,Be=T[1]*D[ce].x+T[4]*D[ce].y+T[7]*D[ce].z,ze=T[1]*D[ue].x+T[4]*D[ue].y+T[7]*D[ue].z,We=T[1]*D[Ce].x+T[4]*D[Ce].y+T[7]*D[Ce].z,$e=T[5]*D[ye].y+T[8]*D[ye].z,qe=T[5]*D[ce].y+T[8]*D[ce].z,et=T[5]*D[ue].y+T[8]*D[ue].z,F=T[5]*D[Ce].y+T[8]*D[Ce].z,ve[ee]=Ve+ke.x,ve[Fe]=ie+ke.x,ve[it]=ae+ke.x,ve[U]=Ae+ke.x,ve[ee+1]=De+ke.y,ve[Fe+1]=Be+ke.y,ve[it+1]=ze+ke.y,ve[U+1]=We+ke.y,ve[ee+2]=$e+ke.z,ve[Fe+2]=qe+ke.z,ve[it+2]=et+ke.z,ve[U+2]=F+ke.z,Ie[ee]=w.r,Ie[Fe]=w.r,Ie[it]=w.r,Ie[U]=w.r,Ie[ee+1]=w.g,Ie[Fe+1]=w.g,Ie[it+1]=w.g,Ie[U+1]=w.g,Ie[ee+2]=w.b,Ie[Fe+2]=w.b,Ie[it+2]=w.b,Ie[U+2]=w.b,H=T[0]*O[ye].x+T[3]*O[ye].y+T[6]*O[ye].z,X=T[0]*O[ce].x+T[3]*O[ce].y+T[6]*O[ce].z,oe=T[0]*O[ue].x+T[3]*O[ue].y+T[6]*O[ue].z,te=T[0]*O[Ce].x+T[3]*O[Ce].y+T[6]*O[Ce].z,Me=T[1]*O[ye].x+T[4]*O[ye].y+T[7]*O[ye].z,Te=T[1]*O[ce].x+T[4]*O[ce].y+T[7]*O[ce].z,q=T[1]*O[ue].x+T[4]*O[ue].y+T[7]*O[ue].z,Ee=T[1]*O[Ce].x+T[4]*O[Ce].y+T[7]*O[Ce].z,Pe=T[5]*O[ye].y+T[8]*O[ye].z,tt=T[5]*O[ce].y+T[8]*O[ce].z,Oe=T[5]*O[ue].y+T[8]*O[ue].z,Je=T[5]*O[Ce].y+T[8]*O[Ce].z,le===0?(re[ee]=H,re[it]=oe,re[U]=te,re[ee+1]=Me,re[it+1]=q,re[U+1]=Ee,re[ee+2]=Pe,re[it+2]=Oe,re[U+2]=Je,ge[K]=ye+$,ge[K+1]=ue+$,ge[K+2]=Ce+$,W.faceidx+=3):le===be-1?(re[ee]=H,re[Fe]=X,re[it]=oe,re[ee+1]=Me,re[Fe+1]=Te,re[it+1]=q,re[ee+2]=Pe,re[Fe+2]=tt,re[it+2]=Oe,ge[K]=ye+$,ge[K+1]=ce+$,ge[K+2]=ue+$,W.faceidx+=3):(re[ee]=H,re[Fe]=X,re[U]=te,re[ee+1]=Me,re[Fe+1]=Te,re[U+1]=Ee,re[ee+2]=Pe,re[Fe+2]=tt,re[U+2]=Je,re[Fe]=X,re[it]=oe,re[U]=te,re[Fe+1]=Te,re[it+1]=q,re[U+1]=Ee,re[Fe+2]=tt,re[it+2]=Oe,re[U+2]=Je,ge[K]=ye+$,ge[K+1]=ce+$,ge[K+2]=Ce+$,ge[K+3]=ce+$,ge[K+4]=ue+$,ge[K+5]=Ce+$,W.faceidx+=6)}}W.vertices+=B}}s.drawCylinder=f;function p(h,v,C,x,w){if(!v||!C)return;w=w||{r:0,g:0,b:0};let _=new n.Vector3(C.x-v.x,C.y-v.y,C.z-v.z);var S=l(_.x,_.y,_.z);_=_.normalize();var M=u.basisVectors.length,T=u.basisVectors,R=M+2,P=h.updateGeoGroup(R),I=P.vertices,B,W,D,O,z,G,k=P.vertexArray,$=P.normalArray,Z=P.colorArray,K=P.faceArray;for(B=I*3,k[B]=v.x,k[B+1]=v.y,k[B+2]=v.z,$[B]=-_.x,$[B+1]=-_.y,$[B+2]=-_.z,Z[B]=w.r,Z[B+1]=w.g,Z[B+2]=w.b,k[B+3]=C.x,k[B+4]=C.y,k[B+5]=C.z,$[B+3]=_.x,$[B+4]=_.y,$[B+5]=_.z,Z[B+3]=w.r,Z[B+4]=w.g,Z[B+5]=w.b,B+=6,D=0;D<M;++D){var j=T[D].clone();j.multiplyScalar(x),O=S[0]*j.x+S[3]*j.y+S[6]*j.z,z=S[1]*j.x+S[4]*j.y+S[7]*j.z,G=S[5]*j.y+S[8]*j.z,k[B]=O+v.x,k[B+1]=z+v.y,k[B+2]=G+v.z,$[B]=O,$[B+1]=z,$[B+2]=G,Z[B]=w.r,Z[B+1]=w.g,Z[B+2]=w.b,B+=3}for(P.vertices+=M+2,W=P.faceidx,D=0;D<M;D++){var Q=I+2+D,le=I+2+(D+1)%M;K[W]=Q,K[W+1]=le,K[W+2]=I,W+=3,K[W]=Q,K[W+1]=le,K[W+2]=I+1,W+=3}P.faceidx+=6*M}s.drawCone=p;class g{constructor(){this.cache=new Map}getVerticesForRadius(v,C){C=C||2,this.cache.has(C)||this.cache.set(C,new Map);let x=this.cache.get(C);if(x.has(v))return x.get(v);var w={vertices:[],verticesRows:[],normals:[]},_=16*C,S=10*C;v<1&&(_=10*C,S=8*C);var M=0,T=Math.PI*2,R=0,P=Math.PI,I,B;for(B=0;B<=S;B++){let D=[];for(I=0;I<=_;I++){let O=I/_,z=B/S,G=-v*Math.cos(M+O*T)*Math.sin(R+z*P),k=v*Math.cos(R+z*P),$=v*Math.sin(M+O*T)*Math.sin(R+z*P);var W=new n.Vector3(G,k,$);W.normalize(),w.vertices.push({x:G,y:k,z:$}),w.normals.push(W),D.push(w.vertices.length-1)}w.verticesRows.push(D)}return x.set(v,w),w}}var y=new g;function E(h,v,C,x,w){var _=y.getVerticesForRadius(C,w),S=_.vertices,M=_.normals,T=h.updateGeoGroup(S.length),R=T.vertices,P=T.vertexArray,I=T.colorArray,B=T.faceArray,W=T.lineArray,D=T.normalArray;for(let G=0,k=S.length;G<k;++G){let $=3*(R+G),Z=S[G];P[$]=Z.x+v.x,P[$+1]=Z.y+v.y,P[$+2]=Z.z+v.z,I[$]=x.r,I[$+1]=x.g,I[$+2]=x.b}T.vertices+=S.length;let O=_.verticesRows,z=O.length-1;for(let G=0;G<z;G++){let k=O[G].length-1;for(let $=0;$<k;$++){let Z=T.faceidx,K=T.lineidx,j=O[G][$+1]+R,Q=j*3,le=O[G][$]+R,he=le*3,ve=O[G+1][$]+R,re=ve*3,Ie=O[G+1][$+1]+R,ge=Ie*3,Se=M[j-R],Le=M[le-R],be=M[ve-R],ye=M[Ie-R];Math.abs(S[j-R].y)===C?(D[Q]=Se.x,D[re]=be.x,D[ge]=ye.x,D[Q+1]=Se.y,D[re+1]=be.y,D[ge+1]=ye.y,D[Q+2]=Se.z,D[re+2]=be.z,D[ge+2]=ye.z,B[Z]=j,B[Z+1]=ve,B[Z+2]=Ie,W[K]=j,W[K+1]=ve,W[K+2]=j,W[K+3]=Ie,W[K+4]=ve,W[K+5]=Ie,T.faceidx+=3,T.lineidx+=6):Math.abs(S[ve-R].y)===C?(D[Q]=Se.x,D[he]=Le.x,D[re]=be.x,D[Q+1]=Se.y,D[he+1]=Le.y,D[re+1]=be.y,D[Q+2]=Se.z,D[he+2]=Le.z,D[re+2]=be.z,B[Z]=j,B[Z+1]=le,B[Z+2]=ve,W[K]=j,W[K+1]=le,W[K+2]=j,W[K+3]=ve,W[K+4]=le,W[K+5]=ve,T.faceidx+=3,T.lineidx+=6):(D[Q]=Se.x,D[he]=Le.x,D[ge]=ye.x,D[Q+1]=Se.y,D[he+1]=Le.y,D[ge+1]=ye.y,D[Q+2]=Se.z,D[he+2]=Le.z,D[ge+2]=ye.z,D[he]=Le.x,D[re]=be.x,D[ge]=ye.x,D[he+1]=Le.y,D[re+1]=be.y,D[ge+1]=ye.y,D[he+2]=Le.z,D[re+2]=be.z,D[ge+2]=ye.z,B[Z]=j,B[Z+1]=le,B[Z+2]=Ie,B[Z+3]=le,B[Z+4]=ve,B[Z+5]=Ie,W[K]=j,W[K+1]=le,W[K+2]=j,W[K+3]=Ie,W[K+4]=le,W[K+5]=ve,W[K+6]=ve,W[K+7]=Ie,T.faceidx+=6,T.lineidx+=8)}}}s.drawSphere=E})(a||(a={}))},"./src/GLModel.ts":(o,t,e)=>{e.r(t),e.d(t,{GLModel:()=>v});var n=e("./src/WebGL/index.ts"),r=e("./src/WebGL/shapes/index.ts"),a=e("./src/WebGL/math/index.ts"),s=e("./src/colors.ts"),l=e("./src/GLDraw.ts"),c=e("./src/glcartoon.ts"),u=e("./src/utilities.ts"),f=e("./src/Gradient.ts"),p=e("./src/parsers/index.ts"),g=e("./node_modules/netcdfjs/lib-esm/index.js"),y=e("./node_modules/pako/dist/pako.esm.mjs"),E=e("./src/parsers/utils/assignBonds.ts");function h(C){let x;return typeof C=="string"?x=new TextEncoder().encode(C):x=new Uint8Array(C),(0,y.inflate)(x,{to:"string"})}class v{static sameObj(x,w){return x&&w?JSON.stringify(x)==JSON.stringify(w):x==w}constructor(x,w){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new a.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=s.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=w||{},this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:s.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=x}getRadiusFromStyle(x,w){var _=this.defaultSphereRadius;if(typeof w.radius<"u")_=w.radius;else if(v.vdwRadii[x.elem])_=v.vdwRadii[x.elem];else if(x.elem.length>1){let S=x.elem;S=S[0].toUpperCase()+S[1].toLowerCase(),v.vdwRadii[S]&&(_=v.vdwRadii[S])}return typeof w.scale<"u"&&(_*=w.scale),_}drawAtomCross(x,w){if(x.style.cross){var _=x.style.cross;if(!_.hidden){var S=_.linewidth||v.defaultlineWidth;w[S]||(w[S]=new n.Geometry);var M=w[S].updateGeoGroup(6),T=this.getRadiusFromStyle(x,_),R=[[T,0,0],[-T,0,0],[0,T,0],[0,-T,0],[0,0,T],[0,0,-T]],P=x.clickable||x.hoverable;P&&x.intersectionShape===void 0&&(x.intersectionShape={sphere:[],cylinder:[],line:[]});for(var I=(0,u.getColorFromStyle)(x,_),B=M.vertexArray,W=M.colorArray,D=0;D<6;D++){var O=M.vertices*3;if(M.vertices++,B[O]=x.x+R[D][0],B[O+1]=x.y+R[D][1],B[O+2]=x.z+R[D][2],W[O]=I.r,W[O+1]=I.g,W[O+2]=I.b,P){var z=new a.Vector3(R[D][0],R[D][1],R[D][2]);z.multiplyScalar(.1),z.set(z.x+x.x,z.y+x.y,z.z+x.z),x.intersectionShape.line.push(z)}}}}}getGoodCross(x,w,_,S){for(var M=null,T=-1,R=0,P=x.bonds.length;R<P;R++)if(x.bonds[R]!=w.index){let B=x.bonds[R],W=this.atoms[B],O=new a.Vector3(W.x,W.y,W.z).clone();O.sub(_);let z=O.clone();z.cross(S);var I=z.lengthSq();if(I>T&&(T=I,M=z,T>.1))return M}return M}getSideBondV(x,w,_){var S,M,T,R,P,I=new a.Vector3(x.x,x.y,x.z),B=new a.Vector3(w.x,w.y,w.z),W=B.clone(),D=null;if(W.sub(I),x.bonds.length===1)w.bonds.length===1?(D=W.clone(),Math.abs(D.x)>1e-4?D.y+=1:D.x+=1):(S=(_+1)%w.bonds.length,M=w.bonds[S],T=this.atoms[M],R=new a.Vector3(T.x,T.y,T.z),P=R.clone(),P.sub(I),D=P.clone(),D.cross(W));else if(D=this.getGoodCross(x,w,I,W),D.lengthSq()<.01){var O=this.getGoodCross(w,x,I,W);O!=null&&(D=O)}return D.lengthSq()<.01&&(D=W.clone(),Math.abs(D.x)>1e-4?D.y+=1:D.x+=1),D.cross(W),D.normalize(),D}addLine(x,w,_,S,M,T){x[_]=S.x,x[_+1]=S.y,x[_+2]=S.z,w[_]=T.r,w[_+1]=T.g,w[_+2]=T.b,x[_+3]=M.x,x[_+4]=M.y,x[_+5]=M.z,w[_+3]=T.r,w[_+4]=T.g,w[_+5]=T.b}drawBondLines(x,w,_){if(x.style.line){var S=x.style.line;if(!S.hidden){var M,T,R,P,I=S.linewidth||v.defaultlineWidth;_[I]||(_[I]=new n.Geometry);for(var B=_[I].updateGeoGroup(6*x.bonds.length),W=B.vertexArray,D=B.colorArray,O=0;O<x.bonds.length;O++){var z=x.bonds[O],G=w[z];if(G.style.line&&!(x.index>=G.index)){var k=new a.Vector3(x.x,x.y,x.z),$=new a.Vector3(G.x,G.y,G.z),Z=k.clone().add($).multiplyScalar(.5),K=!1,j=x.clickable||x.hoverable,Q=G.clickable||G.hoverable;(j||Q)&&(j&&(x.intersectionShape===void 0&&(x.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),x.intersectionShape.line.push(k),x.intersectionShape.line.push(Z)),Q&&(G.intersectionShape===void 0&&(G.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),G.intersectionShape.line.push(Z),G.intersectionShape.line.push($)));var le=(0,u.getColorFromStyle)(x,x.style.line),he=(0,u.getColorFromStyle)(G,G.style.line);if(x.bondStyles&&x.bondStyles[O]){var ve=x.bondStyles[O];if(!ve.iswire)continue;ve.singleBond&&(K=!0),typeof ve.color1<"u"&&(le=s.CC.color(ve.color1)),typeof ve.color2<"u"&&(he=s.CC.color(ve.color2))}var re=B.vertices*3,Ie,ge;if(x.bondOrder[O]>1&&x.bondOrder[O]<4&&!K){var Se=this.getSideBondV(x,G,O),Le=$.clone();Le.sub(k),x.bondOrder[O]==2?(Se.multiplyScalar(.1),M=k.clone(),M.add(Se),T=k.clone(),T.sub(Se),R=M.clone(),R.add(Le),P=T.clone(),P.add(Le),le==he?(B.vertices+=4,this.addLine(W,D,re,M,R,le),this.addLine(W,D,re+6,T,P,le)):(B.vertices+=8,Le.multiplyScalar(.5),Ie=M.clone(),Ie.add(Le),ge=T.clone(),ge.add(Le),this.addLine(W,D,re,M,Ie,le),this.addLine(W,D,re+6,Ie,R,he),this.addLine(W,D,re+12,T,ge,le),this.addLine(W,D,re+18,ge,P,he))):x.bondOrder[O]==3&&(Se.multiplyScalar(.1),M=k.clone(),M.add(Se),T=k.clone(),T.sub(Se),R=M.clone(),R.add(Le),P=T.clone(),P.add(Le),le==he?(B.vertices+=6,this.addLine(W,D,re,k,$,le),this.addLine(W,D,re+6,M,R,le),this.addLine(W,D,re+12,T,P,le)):(B.vertices+=12,Le.multiplyScalar(.5),Ie=M.clone(),Ie.add(Le),ge=T.clone(),ge.add(Le),this.addLine(W,D,re,k,Z,le),this.addLine(W,D,re+6,Z,$,he),this.addLine(W,D,re+12,M,Ie,le),this.addLine(W,D,re+18,Ie,R,he),this.addLine(W,D,re+24,T,ge,le),this.addLine(W,D,re+30,ge,P,he)))}else le==he?(B.vertices+=2,this.addLine(W,D,re,k,$,le)):(B.vertices+=4,this.addLine(W,D,re,k,Z,le),this.addLine(W,D,re+6,Z,$,he))}}}}}drawAtomSphere(x,w){if(x.style.sphere){var _=x.style.sphere;if(!_.hidden){var S=(0,u.getColorFromStyle)(x,_),M=this.getRadiusFromStyle(x,_);if((x.clickable===!0||x.hoverable)&&x.intersectionShape!==void 0){var T=new a.Vector3(x.x,x.y,x.z);x.intersectionShape.sphere.push(new r.Sphere(T,M))}l.GLDraw.drawSphere(w,x,M,S)}}}drawAtomClickSphere(x){if(x.style.clicksphere){var w=x.style.clicksphere;if(!w.hidden){var _=this.getRadiusFromStyle(x,w);if((x.clickable===!0||x.hoverable)&&x.intersectionShape!==void 0){var S=new a.Vector3(x.x,x.y,x.z);x.intersectionShape.sphere.push(new r.Sphere(S,_))}}}}drawAtomInstanced(x,w){if(x.style.sphere){var _=x.style.sphere;if(!_.hidden){var S=this.getRadiusFromStyle(x,_),M=(0,u.getColorFromStyle)(x,_),T=w.updateGeoGroup(1),R=T.vertices,P=R*3,I=T.vertexArray,B=T.colorArray,W=T.radiusArray;if(I[P]=x.x,I[P+1]=x.y,I[P+2]=x.z,B[P]=M.r,B[P+1]=M.g,B[P+2]=M.b,W[R]=S,(x.clickable===!0||x.hoverable)&&x.intersectionShape!==void 0){var D=new a.Vector3(x.x,x.y,x.z);x.intersectionShape.sphere.push(new r.Sphere(D,S))}T.vertices+=1}}}drawSphereImposter(x,w,_,S){var M=x.updateGeoGroup(4),T,R=M.vertices,P=R*3,I=M.vertexArray,B=M.colorArray;for(T=0;T<4;T++)I[P+3*T]=w.x,I[P+3*T+1]=w.y,I[P+3*T+2]=w.z;var W=M.normalArray;for(T=0;T<4;T++)B[P+3*T]=S.r,B[P+3*T+1]=S.g,B[P+3*T+2]=S.b;W[P+0]=-_,W[P+1]=_,W[P+2]=0,W[P+3]=-_,W[P+4]=-_,W[P+5]=0,W[P+6]=_,W[P+7]=-_,W[P+8]=0,W[P+9]=_,W[P+10]=_,W[P+11]=0,M.vertices+=4;var D=M.faceArray,O=M.faceidx;D[O+0]=R,D[O+1]=R+1,D[O+2]=R+2,D[O+3]=R+2,D[O+4]=R+3,D[O+5]=R,M.faceidx+=6}drawAtomImposter(x,w){if(x.style.sphere){var _=x.style.sphere;if(!_.hidden){var S=this.getRadiusFromStyle(x,_),M=(0,u.getColorFromStyle)(x,_);if((x.clickable===!0||x.hoverable)&&x.intersectionShape!==void 0){var T=new a.Vector3(x.x,x.y,x.z);x.intersectionShape.sphere.push(new r.Sphere(T,S))}this.drawSphereImposter(w,x,S,M)}}}static drawStickImposter(x,w,_,S,M){for(var T=x.updateGeoGroup(4),R=T.vertices,P=R*3,I=T.vertexArray,B=T.colorArray,W=T.radiusArray,D=T.normalArray,O=M.r,z=M.g,G=M.b,k=function(Q){var le=-Q;return le==0&&(le=-1e-4),le},$=P,Z=0;Z<4;Z++)I[$]=w.x,D[$]=_.x,B[$]=O,$++,I[$]=w.y,D[$]=_.y,B[$]=z,$++,I[$]=w.z,D[$]=_.z,Z<2?B[$]=G:B[$]=k(G),$++;T.vertices+=4,W[R]=-S,W[R+1]=S,W[R+2]=-S,W[R+3]=S;var K=T.faceArray,j=T.faceidx;K[j+0]=R,K[j+1]=R+1,K[j+2]=R+2,K[j+3]=R+2,K[j+4]=R+3,K[j+5]=R,T.faceidx+=6}drawBondSticks(x,w,_){if(x.style.stick){var S=x.style.stick;if(!S.hidden){var M=S.radius||this.defaultStickRadius,T=S.doubleBondScaling||.4,R=S.tripleBondScaling||.25,P=M,I=S.singleBonds||!1,B=0,W=0,D,O,z,G,k,$,Z,K,j,Q,le,he=(0,u.getColorFromStyle)(x,S),ve,re,Ie;!x.capDrawn&&x.bonds.length<4&&(B=2);var ge=l.GLDraw.drawCylinder;for(_.imposter&&(ge=v.drawStickImposter),z=0;z<x.bonds.length;z++){var Se=x.bonds[z],Le=w[Se];if(ve=re=Ie=null,x.index<Le.index){var be=Le.style;if(!be.stick||be.stick.hidden)continue;var ye=(0,u.getColorFromStyle)(Le,be.stick);if(P=M,G=I,x.bondStyles&&x.bondStyles[z]){if(k=x.bondStyles[z],k.iswire)continue;k.radius&&(P=k.radius),k.singleBond&&(G=!0),typeof k.color1<"u"&&(he=s.CC.color(k.color1)),typeof k.color2<"u"&&(ye=s.CC.color(k.color2))}var ce=new a.Vector3(x.x,x.y,x.z),ue=new a.Vector3(Le.x,Le.y,Le.z);if(x.bondOrder[z]<=1||G||x.bondOrder[z]>3){if(x.bondOrder[z]<1&&(P*=x.bondOrder[z]),!Le.capDrawn&&Le.bonds.length<4&&(W=2),he!=ye?(ve=new a.Vector3().addVectors(ce,ue).multiplyScalar(.5),ge(_,ce,ve,P,he,B,0),ge(_,ve,ue,P,ye,0,W)):ge(_,ce,ue,P,he,B,W),D=x.clickable||x.hoverable,O=Le.clickable||Le.hoverable,D||O){if(ve||(ve=new a.Vector3().addVectors(ce,ue).multiplyScalar(.5)),D){var Ce=new r.Cylinder(ce,ve,P),Ve=new r.Sphere(ce,P);x.intersectionShape.cylinder.push(Ce),x.intersectionShape.sphere.push(Ve)}if(O){var ie=new r.Cylinder(ue,ve,P),ae=new r.Sphere(ue,P);Le.intersectionShape.cylinder.push(ie),Le.intersectionShape.sphere.push(ae)}}}else if(x.bondOrder[z]>1){var Ae=0,De=0;P!=M&&(Ae=2,De=2);var Be=ue.clone(),ze=null;Be.sub(ce);var We,$e,qe,et,F;ze=this.getSideBondV(x,Le,z),x.bondOrder[z]==2?(We=P*T,ze.multiplyScalar(We*1.5),$e=ce.clone(),$e.add(ze),qe=ce.clone(),qe.sub(ze),et=$e.clone(),et.add(Be),F=qe.clone(),F.add(Be),he!=ye?(ve=new a.Vector3().addVectors($e,et).multiplyScalar(.5),re=new a.Vector3().addVectors(qe,F).multiplyScalar(.5),ge(_,$e,ve,We,he,Ae,0),ge(_,ve,et,We,ye,0,De),ge(_,qe,re,We,he,Ae,0),ge(_,re,F,We,ye,0,De)):(ge(_,$e,et,We,he,Ae,De),ge(_,qe,F,We,he,Ae,De)),D=x.clickable||x.hoverable,O=Le.clickable||Le.hoverable,(D||O)&&(ve||(ve=new a.Vector3().addVectors($e,et).multiplyScalar(.5)),re||(re=new a.Vector3().addVectors(qe,F).multiplyScalar(.5)),D&&($=new r.Cylinder($e,ve,We),Z=new r.Cylinder(qe,re,We),x.intersectionShape.cylinder.push($),x.intersectionShape.cylinder.push(Z)),O&&(j=new r.Cylinder(et,ve,We),Q=new r.Cylinder(F,re,We),Le.intersectionShape.cylinder.push(j),Le.intersectionShape.cylinder.push(Q)))):x.bondOrder[z]==3&&(We=P*R,ze.cross(Be),ze.normalize(),ze.multiplyScalar(We*3),$e=ce.clone(),$e.add(ze),qe=ce.clone(),qe.sub(ze),et=$e.clone(),et.add(Be),F=qe.clone(),F.add(Be),he!=ye?(ve=new a.Vector3().addVectors($e,et).multiplyScalar(.5),re=new a.Vector3().addVectors(qe,F).multiplyScalar(.5),Ie=new a.Vector3().addVectors(ce,ue).multiplyScalar(.5),ge(_,$e,ve,We,he,Ae,0),ge(_,ve,et,We,ye,0,De),ge(_,ce,Ie,We,he,B,0),ge(_,Ie,ue,We,ye,0,W),ge(_,qe,re,We,he,Ae,0),ge(_,re,F,We,ye,0,De)):(ge(_,$e,et,We,he,Ae,De),ge(_,ce,ue,We,he,B,W),ge(_,qe,F,We,he,Ae,De)),D=x.clickable||x.hoverable,O=Le.clickable||Le.hoverable,(D||O)&&(ve||(ve=new a.Vector3().addVectors($e,et).multiplyScalar(.5)),re||(re=new a.Vector3().addVectors(qe,F).multiplyScalar(.5)),Ie||(Ie=new a.Vector3().addVectors(ce,ue).multiplyScalar(.5)),D&&($=new r.Cylinder($e.clone(),ve.clone(),We),Z=new r.Cylinder(qe.clone(),re.clone(),We),K=new r.Cylinder(ce.clone(),Ie.clone(),We),x.intersectionShape.cylinder.push($),x.intersectionShape.cylinder.push(Z),x.intersectionShape.cylinder.push(K)),O&&(j=new r.Cylinder(et.clone(),ve.clone(),We),Q=new r.Cylinder(F.clone(),re.clone(),We),le=new r.Cylinder(ue.clone(),Ie.clone(),We),Le.intersectionShape.cylinder.push(j),Le.intersectionShape.cylinder.push(Q),Le.intersectionShape.cylinder.push(le))))}}}var H=!1,X=0,oe=!1;for(z=0;z<x.bonds.length;z++)G=I,x.bondStyles&&x.bondStyles[z]&&(k=x.bondStyles[z],k.singleBond&&(G=!0),k.radius&&k.radius!=M&&(oe=!0)),(G||x.bondOrder[z]==1)&&X++;oe?X>0&&(H=!0):X==0&&(x.bonds.length>0||S.showNonBonded)&&(H=!0),H&&(P=M,_.imposter?this.drawSphereImposter(_.sphereGeometry,x,P,he):l.GLDraw.drawSphere(_,x,P,he))}}}createMolObj(x,w){w=w||{};var _=new n.Object3D,S=[],M={},T={},R=this.drawAtomSphere,P=null,I=null;w.supportsImposters?(R=this.drawAtomImposter,P=new n.Geometry(!0),P.imposter=!0,I=new n.Geometry(!0,!0),I.imposter=!0,I.sphereGeometry=new n.Geometry(!0),I.sphereGeometry.imposter=!0,I.drawnCaps={}):w.supportsAIA?(R=this.drawAtomInstanced,P=new n.Geometry(!1,!0,!0),P.instanced=!0,I=new n.Geometry(!0)):(P=new n.Geometry(!0),I=new n.Geometry(!0));var B,W,D,O,z={},G=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(B=0,D=x.length;B<D;B++){var k=x[B];if(k&&k.style){(k.clickable||k.hoverable)&&k.intersectionShape===void 0&&(k.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),O={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(W in O)k.style[W]?k.style[W].opacity?O[W]=parseFloat(k.style[W].opacity):O[W]=1:O[W]=void 0,z[W]?O[W]!=null&&z[W]!=O[W]&&(console.log("Warning: "+W+" opacity is ambiguous"),z[W]=1):z[W]=O[W];R.call(this,k,P),this.drawAtomClickSphere(k),this.drawAtomCross(k,T),this.drawBondLines(k,x,M),this.drawBondSticks(k,x,I),typeof k.style.cartoon<"u"&&!k.style.cartoon.hidden&&(k.style.cartoon.color==="spectrum"&&typeof k.resi=="number"&&!k.hetflag&&(k.resi<G[0]&&(G[0]=k.resi),k.resi>G[1]&&(G[1]=k.resi)),S.push(k))}}if(S.length>0&&(0,c.drawCartoon)(_,S,G,this.defaultCartoonQuality),P&&P.vertices>0){P.initTypedArrays();var $=null,Z=null;P.imposter?$=new n.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):P.instanced?(Z=new n.Geometry(!0),l.GLDraw.drawSphere(Z,{x:0,y:0,z:0},1,new s.Color(.5,.5,.5)),Z.initTypedArrays(),$=new n.InstancedMaterial({sphereMaterial:new n.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:Z})):$=new n.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),z.sphere<1&&z.sphere>=0&&($.transparent=!0,$.opacity=z.sphere),Z=new n.Mesh(P,$),_.add(Z)}if(I.vertices>0){var K=null,j=null,Q=I.sphereGeometry;(!Q||typeof Q.vertices>"u"||Q.vertices==0)&&(Q=null),I.initTypedArrays(),Q&&Q.initTypedArrays();var le={ambient:0,vertexColors:!0,reflectivity:0};I.imposter?(K=new n.StickImposterMaterial(le),j=new n.SphereImposterMaterial(le)):(K=new n.MeshLambertMaterial(le),j=new n.MeshLambertMaterial(le),K.wireframe&&(I.setUpWireframe(),Q&&Q.setUpWireframe())),z.stick<1&&z.stick>=0&&(K.transparent=!0,K.opacity=z.stick,j.transparent=!0,j.opacity=z.stick);var he=new n.Mesh(I,K);if(_.add(he),Q){var ve=new n.Mesh(Q,j);_.add(ve)}}var re;for(B in M)if(M.hasOwnProperty(B)){re=B;var Ie=new n.LineBasicMaterial({linewidth:re,vertexColors:!0});z.line<1&&z.line>=0&&(Ie.transparent=!0,Ie.opacity=z.line),M[B].initTypedArrays();var ge=new n.Line(M[B],Ie,n.LineStyle.LinePieces);_.add(ge)}for(B in T)if(T.hasOwnProperty(B)){re=B;var Se=new n.LineBasicMaterial({linewidth:re,vertexColors:!0});z.cross<1&&z.cross>=0&&(Se.transparent=!0,Se.opacity=z.cross),T[B].initTypedArrays();var Le=new n.Line(T[B],Se,n.LineStyle.LinePieces);_.add(Le)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var be=new n.Object3D,ye;for(ye=0;ye<this.modelData.symmetries.length;ye++){var ce=new n.Object3D;ce=_.clone(),ce.matrix.copy(this.modelData.symmetries[ye]),ce.matrixAutoUpdate=!1,be.add(ce)}return be}return _}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(x){this.atoms=x.atoms,this.frames=x.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const x=this.modelData.cryst;this.modelData.cryst.matrix=(0,a.conversionMatrix3)(x.a,x.b,x.c,x.alpha,x.beta,x.gamma)}return this.modelData.cryst}else return null}setCrystData(x,w,_,S,M,T){x=x||1,w=w||1,_=_||1,S=S||90,M=M||90,T=T||90;const R=(0,a.conversionMatrix3)(x,w,_,S,M,T);this.modelData.cryst={a:x,b:w,c:_,alpha:S,beta:M,gamma:T,matrix:R}}setCrystMatrix(x){x=x||new a.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:x}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(x){typeof x>"u"?this.modelData.symmetries=[this.idMatrix]:this.modelData.symmetries=x}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(x,w,_,S){var M=w-x;return M<-_?w+S:M>_?w-S:w}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var x=this.box[0],w=this.box[1],_=this.box[2],S=x*.9,M=w*.9,T=_*.9,R=0;R<this.atomdfs.length;R++)for(var P=this.atomdfs[R],I=1;I<P.length;I++){var B=this.atoms[P[I][0]],W=this.atoms[P[I][1]];B.x=this.adjustCoord(W.x,B.x,S,x),B.y=this.adjustCoord(W.y,B.y,M,w),B.z=this.adjustCoord(W.z,B.z,T,_)}}setFrame(x,w){var _=this.getNumFrames();let S=this;return new Promise(function(M,T){if(_==0&&M(),(x<0||x>=_)&&(x=_-1),S.frames.url!=null){var R=S.frames.url;(0,u.getbin)(R+"/traj/frame/"+x+"/"+S.frames.path,void 0,"POST",void 0).then(function(P){for(var I=new Float32Array(P,44),B=0,W=0;W<S.atoms.length;W++)S.atoms[W].x=I[B++],S.atoms[W].y=I[B++],S.atoms[W].z=I[B++];S.box&&S.atomdfs&&S.adjustCoordinatesToBox(),M()}).catch(T)}else S.atoms=S.frames[x],M();S.molObj=null,S.modelDatas&&x<S.modelDatas.length&&(S.modelData=S.modelDatas[x],S.unitCellObjects&&w&&(w.removeUnitCell(S),w.addUnitCell(S)))})}addFrame(x){this.frames.push(x)}vibrate(x=10,w=1,_=!1,S,M){var T=0,R=x;_&&(T=-x,R=x),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),T<R&&(this.frames=[]),_&&(this.frames.origIndex=x);for(var P=T;P<R;P++){var I=[],B=this.frames.length;if(P==0&&!M){this.frames.push(this.atoms);continue}for(var W=0;W<this.atoms.length;W++){var D=(0,u.getAtomProperty)(this.atoms[W],"dx"),O=(0,u.getAtomProperty)(this.atoms[W],"dy"),z=(0,u.getAtomProperty)(this.atoms[W],"dz"),G=new a.Vector3(D,O,z),k=new a.Vector3(this.atoms[W].x,this.atoms[W].y,this.atoms[W].z),$=P*w/x;G.multiplyScalar($),k.add(G);var Z={};for(var K in this.atoms[W])Z[K]=this.atoms[W][K];if(Z.x=k.x,Z.y=k.y,Z.z=k.z,I.push(Z),S&&M){var j=(0,u.extend)({},M),Q=new a.Vector3(D,O,z);if(Q.multiplyScalar(w),Q.add(k),j.start=k,j.end=Q,j.frame=B,!j.color){var le=Z.style.sphere;le||(le=Z.style.stick),le||(le=Z.style.line),j.color=(0,u.getColorFromStyle)(Z,le)}S.addArrow(j)}}this.frames.push(I)}}setAtomDefaults(x){for(let w=0;w<x.length;w++){let _=x[w];_&&(_.style=_.style||(0,u.deepCopy)(v.defaultAtomStyle),_.color=_.color||this.ElementColors[_.elem]||this.defaultColor,_.model=this.id,(_.clickable||_.hoverable)&&(_.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(x,w,_={}){var S=v.parseMolData(x,w,_);this.dontDuplicateAtoms=!_.duplicateAssemblyAtoms;var M=S.modelData;if(M&&(Array.isArray(M)?(this.modelData=M[0],_.frames&&(this.modelDatas=M)):this.modelData=M),S.box?this.box=S.box:this.box=null,this.frames.length==0){for(let R=0;R<S.length;R++)S[R].length!=0&&this.frames.push(S[R]);this.frames[0]&&(this.atoms=this.frames[0])}else if(_.frames)for(let R=0;R<S.length;R++)this.frames.push(S[R]);else for(var T=0;T<S.length;T++)this.addAtoms(S[T]);for(let R=0;R<this.frames.length;R++)this.setAtomDefaults(this.frames[R]);_.vibrate&&_.vibrate.frames&&_.vibrate.amplitude&&this.vibrate(_.vibrate.frames,_.vibrate.amplitude),_.style&&this.setStyle({},_.style)}setDontDuplicateAtoms(x){this.dontDuplicateAtoms=x}setModelData(x){this.modelData=x}propertyMatches(x,w){if(x==w)return!0;if(typeof w=="string"&&typeof x=="number"){var _=w.match(/(-?\d+)\s*-\s*(-?\d+)/);if(_){var S=parseInt(_[1]),M=parseInt(_[2]);if(_&&x>=S&&x<=M)return!0}}return!1}static deepCopyAndCache(x,w){if(typeof x!="object"||x==null||x.__cache_created)return x;const _={};for(const S in x){const M=x[S];if(Array.isArray(M)){_[S]=[];for(let T=0;T<M.length;T++)_[S].push(v.deepCopyAndCache(M[T],w))}else typeof M=="object"&&S!="properties"&&S!="model"?_[S]=v.deepCopyAndCache(M,w):_[S]=M;if(S=="and"||S=="or"){const T=[];for(const R of _[S]){const P=new Set;for(const I of w.selectedAtoms(R))P.add(I.index);T.push(P)}if(S=="and"){const R=function(I,B){const W=new Set;for(const D of B)I.has(D)&&W.add(D);return W};let P=new Set(T[0]);for(const I of T.splice(1))P=R(P,I);_[S].__cached_results=P}else if(S=="or"){const R=new Set;for(const P of T)for(const I of P)R.add(I);_[S].__cached_results=R}}}return _.__cache_created=!0,_}atomIsSelected(x,w){if(typeof w>"u")return!0;var _=!!w.invert,S=!0;for(var M in w)if(M=="and"||M=="or"||M=="not"){if(M=="not"){if(this.atomIsSelected(x,w[M])){S=!1;break}}else if(w[M].__cached_results===void 0&&(w=v.deepCopyAndCache(w,this)),S=w[M].__cached_results.has(x.index),!S)break}else if(M==="predicate"){if(!w.predicate(x)){S=!1;break}}else if(M=="properties"&&x[M]){for(var T in w.properties)if(!T.startsWith("__cache")){if(typeof x.properties[T]>"u"){S=!1;break}if(x.properties[T]!=w.properties[T]){S=!1;break}}}else if(w.hasOwnProperty(M)&&!v.ignoredKeys.has(M)&&!M.startsWith("__cache")){if(typeof x[M]>"u"){S=!1;break}var R=!1;if(M==="bonds"){var P=w[M];if(P!=x.bonds.length){S=!1;break}}else if(Array.isArray(w[M])){var I=w[M],B=x[M];for(let W=0;W<I.length;W++)if(this.propertyMatches(B,I[W])){R=!0;break}if(!R){S=!1;break}}else{let W=w[M];if(!this.propertyMatches(x[M],W)){S=!1;break}}}return _?!S:S}static squaredDistance(x,w){var _=w.x-x.x,S=w.y-x.y,M=w.z-x.z;return _*_+S*S+M*M}expandAtomList(x,w){if(w<=0)return x;for(var _=(0,u.getExtent)(x,void 0),S=[[],[],[]],M=0;M<3;M++)S[0][M]=_[0][M]-w,S[1][M]=_[1][M]+w,S[2][M]=_[2][M];var T=[];for(let B=0;B<this.atoms.length;B++){var R=this.atoms[B].x,P=this.atoms[B].y,I=this.atoms[B].z;R>=S[0][0]&&R<=S[1][0]&&P>=S[0][1]&&P<=S[1][1]&&I>=S[0][2]&&I<=S[1][2]&&(R>=_[0][0]&&R<=_[1][0]&&P>=_[0][1]&&P<=_[1][1]&&I>=_[0][2]&&I<=_[1][2]||T.push(this.atoms[B]))}return T}static getFloat(x){return typeof x=="number"?x:parseFloat(x)}selectedAtoms(x,w){var _=[];x=v.deepCopyAndCache(x||{},this),w||(w=this.atoms);for(var S=w.length,M=0;M<S;M++){var T=w[M];T&&this.atomIsSelected(T,x)&&_.push(T)}if(x.hasOwnProperty("expand")){const Z=v.getFloat(x.expand);let K=this.expandAtomList(_,Z),j=_.length;const Q=Z*Z;for(let le=0;le<K.length;le++)for(let he=0;he<j;he++){var R=v.squaredDistance(K[le],_[he]);R<Q&&R>0&&_.push(K[le])}}if(x.hasOwnProperty("within")&&x.within.hasOwnProperty("sel")&&x.within.hasOwnProperty("distance")){var P=this.selectedAtoms(x.within.sel,this.atoms),I={};const Z=v.getFloat(x.within.distance),K=Z*Z;for(let j=0;j<P.length;j++)for(let Q=0;Q<_.length;Q++){let le=v.squaredDistance(P[j],_[Q]);le<K&&le>0&&(I[Q]=1)}var B=[];if(x.within.invert)for(let j=0;j<_.length;j++)I[j]||B.push(_[j]);else for(let j in I)B.push(_[j]);_=B}if(x.hasOwnProperty("byres")){var W={},D=[],O=[];for(let Z=0;Z<_.length;Z++){let K=_[Z];var z=K.chain,G=K.resi;if(W[z]===void 0&&(W[z]={}),K.hasOwnProperty("resi")&&W[z][G]===void 0){for(W[z][G]=!0,O.push(K);O.length>0;)if(K=O.pop(),z=K.chain,G=K.resi,D[K.index]===void 0){D[K.index]=!0;for(var k=0;k<K.bonds.length;k++){var $=this.atoms[K.bonds[k]];D[$.index]===void 0&&$.hasOwnProperty("resi")&&$.chain==z&&$.resi==G&&(O.push($),_.push($))}}}}}return _}addAtoms(x){this.molObj=null;var w=this.atoms.length,_=[],S;for(S=0;S<x.length;S++)typeof x[S].index>"u"&&(x[S].index=S),typeof x[S].serial>"u"&&(x[S].serial=S),_[x[S].index]=w+S;for(S=0;S<x.length;S++){var M=x[S],T=_[M.index],R=(0,u.extend)({},M);R.index=T,R.bonds=[],R.bondOrder=[],R.model=this.id,R.style=R.style||(0,u.deepCopy)(v.defaultAtomStyle),typeof R.color>"u"&&(R.color=this.ElementColors[R.elem]||this.defaultColor);for(var P=M.bonds?M.bonds.length:0,I=0;I<P;I++){var B=_[M.bonds[I]];typeof B<"u"&&(R.bonds.push(B),R.bondOrder.push(M.bondOrder?M.bondOrder[I]:1))}this.atoms.push(R)}}assignBonds(){(0,E.assignBonds)(this.atoms)}removeAtoms(x){this.molObj=null;var w=[],_;for(_=0;_<x.length;_++)w[x[_].index]=!0;var S=[];for(_=0;_<this.atoms.length;_++){var M=this.atoms[_];w[M.index]||S.push(M)}this.atoms=[],this.addAtoms(S)}setStyle(x,w,_){typeof w>"u"&&typeof _>"u"&&(w=x,x={}),x=x,typeof w=="string"&&(w=(0,u.specStringToObject)(w));var S=!1,M=this,T=function(P){var I=M.selectedAtoms(x,P);for(let B=0;B<P.length;B++)P[B]&&(P[B].capDrawn=!1);for(let B=0;B<I.length;B++){S=!0,(I[B].clickable||I[B].hoverable)&&(I[B].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),_||(I[B].style={});for(let W in w)w.hasOwnProperty(W)&&(I[B].style[W]=I[B].style[W]||{},Object.assign(I[B].style[W],w[W]))}};if(x.frame!==void 0&&x.frame<this.frames.length){let P=x.frame;P<0&&(P=this.frames.length+P),T(this.frames[P])}else{T(this.atoms);for(var R=0;R<this.frames.length;R++)this.frames[R]!==this.atoms&&T(this.frames[R])}S&&(this.molObj=null)}setClickable(x,w,_){if(w=!!w,_=(0,u.makeFunction)(_),_===null){console.log("Callback is not a function");return}var S=this.selectedAtoms(x,this.atoms),M=S.length;for(let T=0;T<M;T++)S[T].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},S[T].clickable=w,_&&(S[T].callback=_);M>0&&(this.molObj=null)}setHoverable(x,w,_,S){if(w=!!w,_=(0,u.makeFunction)(_),S=(0,u.makeFunction)(S),_===null){console.log("Hover_callback is not a function");return}if(S===null){console.log("Unhover_callback is not a function");return}var M=this.selectedAtoms(x,this.atoms),T=M.length;for(let R=0;R<T;R++)M[R].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},M[R].hoverable=w,_&&(M[R].hover_callback=_),S&&(M[R].unhover_callback=S);T>0&&(this.molObj=null)}enableContextMenu(x,w){w=!!w;var _,S=this.selectedAtoms(x,this.atoms),M=S.length;for(_=0;_<M;_++)S[_].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},S[_].contextMenuEnabled=w;M>0&&(this.molObj=null)}setColorByElement(x,w){if(!(this.molObj!==null&&v.sameObj(w,this.lastColors))){this.lastColors=w;var _=this.selectedAtoms(x,_);_.length>0&&(this.molObj=null);for(var S=0;S<_.length;S++){var M=_[S];typeof w[M.elem]<"u"&&(M.color=w[M.elem])}}}setColorByProperty(x,w,_,S){var M,T,R=this.selectedAtoms(x,R);for(this.lastColors=null,R.length>0&&(this.molObj=null),typeof _=="string"&&typeof f.Gradient.builtinGradients[_]<"u"&&(_=new f.Gradient.builtinGradients[_]),_=_,S||(S=_.range()),S||(S=(0,u.getPropertyRange)(R,w)),M=0;M<R.length;M++){T=R[M];var P=(0,u.getAtomProperty)(T,w);P!=null&&(T.color=_.valueToHex(parseFloat(T.properties[w]),S))}}setColorByFunction(x,w){var _=this.selectedAtoms(x,_);if(typeof w=="function"){this.lastColors=null,_.length>0&&(this.molObj=null);for(let S=0;S<_.length;S++){let M=_[S];M.color=w(M)}}}toCDObject(x=!1){var w={a:[],b:[]};x&&(w.s=[]);for(let S=0;S<this.atoms.length;S++){let M={},T=this.atoms[S];if(M.x=T.x,M.y=T.y,M.z=T.z,T.elem!="C"&&(M.l=T.elem),x){for(var _=0;_<w.s.length&&JSON.stringify(T.style)!==JSON.stringify(w.s[_]);)_++;_===w.s.length&&w.s.push(T.style),_!==0&&(M.s=_)}w.a.push(M);for(let R=0;R<T.bonds.length;R++){let P=S,I=T.bonds[R];if(P>=I)continue;let B={b:P,e:I},W=T.bondOrder[R];W!=1&&(B.o=W),w.b.push(B)}}return w}globj(x,w){(this.molObj===null||w.regen)&&(this.molObj=this.createMolObj(this.atoms,w),this.renderedMolObj&&(x.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),x.add(this.renderedMolObj))}exportVRML(){var x=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return x.vrml()}removegl(x){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),x.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(x,w,_,S){for(var M=this.selectedAtoms(w,M),T=(0,u.deepCopy)(S),R=0;R<M.length;R++){var P=M[R],I=null;typeof P[x]<"u"?I=String(P[x]):typeof P.properties[x]<"u"&&(I=String(P.properties[x])),I!=null&&(T.position=P,_.addLabel(I,T))}}addResLabels(x,w,_,S=!1){var M=[],T=function(P,I){for(var B=P.selectedAtoms(x,B),W={},D=0;D<B.length;D++){var O=B[D],z=O.chain,G=O.resn,k=O.resi,$=G+""+k;W[z]||(W[z]={}),W[z][$]||(W[z][$]=[]),W[z][$].push(O)}var Z=(0,u.deepCopy)(_);for(let j in W)if(W.hasOwnProperty(j)){var K=W[j];for(let Q in K)if(K.hasOwnProperty(Q)){let le=K[Q],he=new a.Vector3(0,0,0);for(let re=0;re<le.length;re++){let Ie=le[re];he.x+=Ie.x,he.y+=Ie.y,he.z+=Ie.z}he.divideScalar(le.length),Z.position=he,Z.frame=I;let ve=w.addLabel(Q,Z,void 0,!0);M.push(ve)}}};if(S){var R=this.getNumFrames();let P=this.atoms;for(let I=0;I<R;I++)this.frames[I]&&(this.atoms=this.frames[I],T(this,I));this.atoms=P}else T(this);return M}setupDFS(){this.atomdfs=[];var x=this,w=new Int8Array(this.atoms.length);w.fill(0);for(var _=function(R,P,I){I.push([R,P]);var B=x.atoms[R];w[R]=1;for(var W=0;W<B.bonds.length;W++){var D=B.bonds[W];x.atoms[D]&&!w[D]&&_(D,R,I)}},S=0;S<this.atoms.length;S++){var M=this.atoms[S];if(M&&!w[S]){var T=[];_(S,-1,T),this.atomdfs.push(T)}}}setCoordinatesFromURL(x,w){this.frames=[];var _=this;return this.box&&this.setupDFS(),x.startsWith("http")||(x="http://"+x),(0,u.get)(x+"/traj/numframes/"+w,function(S){if(!isNaN(parseInt(S)))return _.frames.push(_.atoms),_.frames.numFrames=S,_.frames.url=x,_.frames.path=w,_.setFrame(0)})}setCoordinates(x,w){if(w=w||"",!x)return[];if(/\.gz$/.test(w)){w=w.replace(/\.gz$/,"");try{x=h(x)}catch(W){console.log(W)}}var _={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(_.hasOwnProperty(w)){this.frames=[];for(var S=this.atoms.length,M=v.parseCrd(x,w),T=0;T<M.length;){for(var R=[],P=0;P<S;P++){var I={};for(var B in this.atoms[P])I[B]=this.atoms[P][B];R[P]=I,R[P].x=M[T++],R[P].y=M[T++],R[P].z=M[T++]}this.frames.push(R)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(x){}static parseCrd(x,w){var _=[],S=0;if(w=="pdb")for(var M=x.indexOf(`
ATOM`);M!=-1;){for(;x.slice(M,M+5)==`
ATOM`||x.slice(M,M+7)==`
HETATM`;)_[S++]=parseFloat(x.slice(M+31,M+39)),_[S++]=parseFloat(x.slice(M+39,M+47)),_[S++]=parseFloat(x.slice(M+47,M+55)),M=x.indexOf(`
`,M+54),x.slice(M,M+4)==`
TER`&&(M=x.indexOf(`
`,M+5));M=x.indexOf(`
ATOM`,M)}else if(w=="netcdf"){var T=new g.NetCDFReader(x);_=[].concat.apply([],T.getDataVariable("coordinates"))}else{if(w=="array"||Array.isArray(x))return x.flat(2);{let R=x.indexOf(`
`);w=="inpcrd"&&(R=x.indexOf(`
`,R+1)),x=x.slice(R+1),_=x.match(/\S+/g).map(parseFloat)}}return _}static parseMolData(x,w="",_){if(!x)return[];if(/\.gz$/.test(w)){w=w.replace(/\.gz$/,"");try{x=h(x)}catch(T){console.log(T)}}typeof p.Parsers[w]>"u"&&(w=w.split(".").pop(),typeof p.Parsers[w]>"u"&&(console.log("Unknown format: "+w),x instanceof Uint8Array?w="mmtf":x.match(/^@<TRIPOS>MOLECULE/gm)?w="mol2":x.match(/^data_/gm)&&x.match(/^loop_/gm)?w="cif":x.match(/^HETATM/gm)||x.match(/^ATOM/gm)?w="pdb":x.match(/ITEM: TIMESTEP/gm)?w="lammpstrj":x.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?w="sdf":x.match(/^%VERSION\s+VERSION_STAMP/gm)?w="prmtop":w="xyz",console.log("Best guess: "+w)));var S=p.Parsers[w],M=S(x,_);return M}}v.defaultAtomStyle={line:{}},v.defaultlineWidth=1,v.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},v.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])},"./src/GLShape.ts":(o,t,e)=>{e.r(t),e.d(t,{GLShape:()=>g,splitMesh:()=>y});var n=e("./src/WebGL/index.ts"),r=e("./src/WebGL/shapes/index.ts"),a=e("./src/WebGL/math/index.ts"),s=e("./src/colors.ts"),l=e("./src/ProteinSurface4.ts"),c=e("./src/VolumeData.ts"),u=e("./src/GLDraw.ts"),f=e("./src/glcartoon.ts"),p=e("./src/utilities.ts");class g{static finalizeGeo(h){var v=h.updateGeoGroup(0);v.vertices>0&&v.truncateArrayBuffers(!0,!0)}static updateColor(h,v){v=v||s.CC.color(v),h.colorsNeedUpdate=!0;var C,x,w;v.constructor!==Array&&(C=v.r,x=v.g,w=v.b);for(let _ in h.geometryGroups){let S=h.geometryGroups[_],M=S.colorArray;for(let T=0,R=S.vertices;T<R;++T){if(v.constructor===Array){let P=v[T];C=P.r,x=P.g,w=P.b}M[T*3]=C,M[T*3+1]=x,M[T*3+2]=w}}}static drawArrow(h,v,C){var x=C.start,w=C.end,_=C.radius,S=C.radiusRatio,M=C.mid,T=C.midpos;if(!(x&&w))return;var R=v.updateGeoGroup(51),P=new a.Vector3(w.x,w.y,w.z).sub(x);if(T){let Oe=P.length();T>0?M=T/Oe:M=(Oe+T)/Oe}P.multiplyScalar(M);var I=new a.Vector3(x.x,x.y,x.z).add(P),B=P.clone().negate();let W=new a.Vector3(x.x,x.y,x.z);h.intersectionShape.cylinder.push(new r.Cylinder(W,I.clone(),_)),h.intersectionShape.sphere.push(new r.Sphere(W,_));var D=[];D[0]=P.clone(),Math.abs(D[0].x)>1e-4?D[0].y+=1:D[0].x+=1,D[0].cross(P),D[0].normalize(),D[4]=D[0].clone(),D[4].crossVectors(D[0],P),D[4].normalize(),D[8]=D[0].clone().negate(),D[12]=D[4].clone().negate(),D[2]=D[0].clone().add(D[4]).normalize(),D[6]=D[4].clone().add(D[8]).normalize(),D[10]=D[8].clone().add(D[12]).normalize(),D[14]=D[12].clone().add(D[0]).normalize(),D[1]=D[0].clone().add(D[2]).normalize(),D[3]=D[2].clone().add(D[4]).normalize(),D[5]=D[4].clone().add(D[6]).normalize(),D[7]=D[6].clone().add(D[8]).normalize(),D[9]=D[8].clone().add(D[10]).normalize(),D[11]=D[10].clone().add(D[12]).normalize(),D[13]=D[12].clone().add(D[14]).normalize(),D[15]=D[14].clone().add(D[0]).normalize();var O=R.vertices,z=R.vertexArray,G=R.faceArray,k=R.normalArray,$=R.lineArray,Z,K,j;for(K=0,j=D.length;K<j;++K){Z=3*(O+3*K);var Q=D[K].clone().multiplyScalar(_).add(x),le=D[K].clone().multiplyScalar(_).add(I),he=D[K].clone().multiplyScalar(_*S).add(I);if(z[Z]=Q.x,z[Z+1]=Q.y,z[Z+2]=Q.z,z[Z+3]=le.x,z[Z+4]=le.y,z[Z+5]=le.z,z[Z+6]=he.x,z[Z+7]=he.y,z[Z+8]=he.z,K>0){var ve=z[Z-3],re=z[Z-2],Ie=z[Z-1],ge=new a.Vector3(ve,re,Ie),Se=new a.Vector3(w.x,w.y,w.z),Le=I.clone(),be=new a.Vector3(he.x,he.y,he.z);h.intersectionShape.triangle.push(new r.Triangle(be,Se,ge)),h.intersectionShape.triangle.push(new r.Triangle(ge.clone(),Le,be.clone()))}}R.vertices+=48,Z=R.vertices*3,z[Z]=x.x,z[Z+1]=x.y,z[Z+2]=x.z,z[Z+3]=I.x,z[Z+4]=I.y,z[Z+5]=I.z,z[Z+6]=w.x,z[Z+7]=w.y,z[Z+8]=w.z,R.vertices+=3;var ye,ce,ue,Ce,Ve,ie,ae,Ae,De,Be,ze,We,$e,qe,et,F,H,X,oe,te=R.vertices-3,Me=R.vertices-2,Te=R.vertices-1,q=te*3,Ee=Me*3,Pe=Te*3;for(K=0,j=D.length-1;K<j;++K){var tt=O+3*K;Z=tt*3,ce=R.faceidx,ue=R.lineidx,Ce=tt,Be=Ce*3,Ve=tt+1,ze=Ve*3,ie=tt+2,We=ie*3,ae=tt+4,$e=ae*3,Ae=tt+5,qe=Ae*3,De=tt+3,et=De*3,F=H=D[K],X=oe=D[K+1],k[Be]=F.x,k[ze]=H.x,k[et]=oe.x,k[Be+1]=F.y,k[ze+1]=H.y,k[et+1]=oe.y,k[Be+2]=F.z,k[ze+2]=H.z,k[et+2]=oe.z,k[ze]=H.x,k[$e]=X.x,k[et]=oe.x,k[ze+1]=H.y,k[$e+1]=X.y,k[et+1]=oe.y,k[ze+2]=H.z,k[$e+2]=X.z,k[et+2]=oe.z,k[We]=H.x,k[qe]=X.x,k[We+1]=H.y,k[qe+1]=X.y,k[We+2]=H.z,k[qe+2]=X.z,G[ce]=Ce,G[ce+1]=Ve,G[ce+2]=De,G[ce+3]=Ve,G[ce+4]=ae,G[ce+5]=De,G[ce+6]=Ce,G[ce+7]=De,G[ce+8]=te,G[ce+9]=ie,G[ce+10]=Me,G[ce+11]=Ae,G[ce+12]=ie,G[ce+13]=Te,G[ce+14]=Ae,$[ue]=Ce,$[ue+1]=Ve,$[ue+2]=Ce,$[ue+3]=De,$[ue+4]=ae,$[ue+5]=De,$[ue+6]=Ce,$[ue+7]=De,$[ue+8]=ie,$[ue+9]=Ve,$[ue+10]=ie,$[ue+11]=Ae,$[ue+12]=ae,$[ue+13]=Ae,$[ue+14]=ie,$[ue+15]=Te,$[ue+16]=ie,$[ue+17]=Ae,$[ue+18]=Te,$[ue+19]=Ae,R.faceidx+=15,R.lineidx+=20}ye=[O+45,O+46,O+1,O,O+47,O+2],ce=R.faceidx,ue=R.lineidx,Ce=ye[0],Be=Ce*3,Ve=ye[1],ze=Ve*3,ie=ye[4],We=ie*3,ae=ye[2],$e=ae*3,Ae=ye[5],qe=Ae*3,De=ye[3],et=De*3,F=H=D[15],X=oe=D[0],k[Be]=F.x,k[ze]=H.x,k[et]=oe.x,k[Be+1]=F.y,k[ze+1]=H.y,k[et+1]=oe.y,k[Be+2]=F.z,k[ze+2]=H.z,k[et+2]=oe.z,k[ze]=H.x,k[$e]=X.x,k[et]=oe.x,k[ze+1]=H.y,k[$e+1]=X.y,k[et+1]=oe.y,k[ze+2]=H.z,k[$e+2]=X.z,k[et+2]=oe.z,k[We]=H.x,k[qe]=X.x,k[We+1]=H.y,k[qe+1]=X.y,k[We+2]=H.z,k[qe+2]=X.z,P.normalize(),B.normalize(),k[q]=B.x,k[Ee]=k[Pe]=P.x,k[q+1]=B.y,k[Ee+1]=k[Pe+1]=P.y,k[q+2]=B.z,k[Ee+2]=k[Pe+2]=P.z,G[ce]=Ce,G[ce+1]=Ve,G[ce+2]=De,G[ce+3]=Ve,G[ce+4]=ae,G[ce+5]=De,G[ce+6]=Ce,G[ce+7]=De,G[ce+8]=te,G[ce+9]=ie,G[ce+10]=Me,G[ce+11]=Ae,G[ce+12]=ie,G[ce+13]=Te,G[ce+14]=Ae,$[ue]=Ce,$[ue+1]=Ve,$[ue+2]=Ce,$[ue+3]=De,$[ue+4]=ae,$[ue+5]=De,$[ue+6]=Ce,$[ue+7]=De,$[ue+8]=ie,$[ue+9]=Ve,$[ue+10]=ie,$[ue+11]=Ae,$[ue+12]=ae,$[ue+13]=Ae,$[ue+14]=ie,$[ue+15]=Te,$[ue+16]=ie,$[ue+17]=Ae,$[ue+18]=Te,$[ue+19]=Ae,R.faceidx+=15,R.lineidx+=20}static updateBoundingFromPoints(h,v,C,x){h.center.set(0,0,0);let w=1/0,_=1/0,S=1/0,M=-1/0,T=-1/0,R=-1/0;h.box&&(w=h.box.min.x,M=h.box.max.x,_=h.box.min.y,T=h.box.max.y,S=h.box.min.z,R=h.box.max.z);for(let W=0,D=x;W<D;W++){var P=C[W*3],I=C[W*3+1],B=C[W*3+2];P<w&&(w=P),I<_&&(_=I),B<S&&(S=B),P>M&&(M=P),I>T&&(T=I),B>R&&(R=B)}h.center.set((M+w)/2,(T+_)/2,(R+S)/2),h.radius=h.center.distanceTo({x:M,y:T,z:R}),h.box={min:{x:w,y:_,z:S},max:{x:M,y:T,z:R}}}static addCustomGeo(h,v,C,x,w){var _=v.addGeoGroup(),S=C.vertexArr,M=C.normalArr,T=C.faceArr;_.vertices=S.length,_.faceidx=T.length;var R,P,I,B,W,D,O,z,G,k=_.vertexArray,$=_.colorArray;for(x.constructor!==Array&&(z=x.r,G=x.g,B=x.b),D=0,O=_.vertices;D<O;++D)R=D*3,P=S[D],k[R]=P.x,k[R+1]=P.y,k[R+2]=P.z,x.constructor===Array&&(W=x[D],z=W.r,G=W.g,B=W.b),$[R]=z,$[R+1]=G,$[R+2]=B;if(w)for(D=0,O=_.faceidx/3;D<O;++D){R=D*3,I=T[R],B=T[R+1],W=T[R+2];var Z=new a.Vector3,K=new a.Vector3,j=new a.Vector3;h.intersectionShape.triangle.push(new r.Triangle(Z.copy(S[I]),K.copy(S[B]),j.copy(S[W])))}if(w){var Q=new a.Vector3(0,0,0),le=0;for(let re=0;re<v.geometryGroups.length;re++)Q.add(v.geometryGroups[re].getCentroid()),le++;Q.divideScalar(le),g.updateBoundingFromPoints(h.boundingSphere,{centroid:Q},k,_.vertices)}if(_.faceArray=new Uint16Array(T),_.truncateArrayBuffers(!0,!0),M.length<_.vertices)_.setNormals();else{var he=_.normalArray=new Float32Array(_.vertices*3),ve;for(D=0,O=_.vertices;D<O;++D)R=D*3,ve=M[D],he[R]=ve.x,he[R+1]=ve.y,he[R+2]=ve.z}_.setLineIndices(),_.lineidx=_.lineArray.length}static updateFromStyle(h,v){typeof v.color<"u"?(h.color=v.color||new s.Color,v.color instanceof s.Color||(h.color=s.CC.color(v.color))):h.color=s.CC.color(0),h.wireframe=!!v.wireframe,h.opacity=v.alpha?(0,a.clamp)(v.alpha,0,1):1,typeof v.opacity<"u"&&(h.opacity=(0,a.clamp)(v.opacity,0,1)),h.side=v.side!==void 0?v.side:n.DoubleSide,h.linewidth=typeof v.linewidth>"u"?1:v.linewidth,h.clickable=!!v.clickable,h.callback=(0,p.makeFunction)(v.callback),h.hoverable=!!v.hoverable,h.hover_callback=(0,p.makeFunction)(v.hover_callback),h.unhover_callback=(0,p.makeFunction)(v.unhover_callback),h.hidden=v.hidden,h.frame=v.frame}constructor(h){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.side=n.DoubleSide,this.stylespec=h||{},this.boundingSphere=new r.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},g.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new n.Geometry(!0),this.linegeo=new n.Geometry(!0)}updateStyle(h){for(var v in h)this.stylespec[v]=h[v];if(g.updateFromStyle(this,this.stylespec),h.voldata&&h.volscheme){(0,p.adjustVolumeStyle)(h);const C=h.volscheme,x=h.voldata,w=s.CC,_=C.range()||[-1,1];this.geo.setColors(function(S,M,T){let R=x.getVal(S,M,T);return w.color(C.valueToHex(R,_))}),delete this.color}}addCustom(h){h.vertexArr=h.vertexArr||[],h.faceArr=h.faceArr||[],h.normalArr=h.normalArr||[],g.drawCustom(this,this.geo,h)}addSphere(h){h.center||(h.center=new a.Vector3(0,0,0)),h.radius=h.radius?(0,a.clamp)(h.radius,0,1/0):1.5,h.color=s.CC.color(h.color),this.intersectionShape.sphere.push(new r.Sphere(h.center,h.radius)),u.GLDraw.drawSphere(this.geo,h.center,h.radius,h.color,h.quality),this.components.push({centroid:new a.Vector3(h.center.x,h.center.y,h.center.z)});var v=this.geo.updateGeoGroup(0);g.updateBoundingFromPoints(this.boundingSphere,this.components,v.vertexArray,v.vertices)}addBox(h){var v=h.dimensions||{w:1,h:1,d:1},C;typeof v.w=="number"?C={x:v.w,y:0,z:0}:C=v.w;var x;typeof v.h=="number"?x={x:0,y:v.h,z:0}:x=v.h;var w;typeof v.d=="number"?w={x:0,y:0,z:v.d}:w=v.d;var _=h.corner;_==null&&(h.center!==void 0?_={x:h.center.x-.5*(C.x+x.x+w.x),y:h.center.y-.5*(C.y+x.y+w.y),z:h.center.z-.5*(C.z+x.z+w.z)}:_={x:0,y:0,z:0});var S=[{x:_.x,y:_.y,z:_.z},{x:_.x+C.x,y:_.y+C.y,z:_.z+C.z},{x:_.x+x.x,y:_.y+x.y,z:_.z+x.z},{x:_.x+C.x+x.x,y:_.y+C.y+x.y,z:_.z+C.z+x.z},{x:_.x+w.x,y:_.y+w.y,z:_.z+w.z},{x:_.x+C.x+w.x,y:_.y+C.y+w.y,z:_.z+C.z+w.z},{x:_.x+x.x+w.x,y:_.y+x.y+w.y,z:_.z+x.z+w.z},{x:_.x+C.x+x.x+w.x,y:_.y+C.y+x.y+w.y,z:_.z+C.z+x.z+w.z}],M=[],T=[];M.splice(M.length,0,S[0],S[1],S[2],S[3]),T.splice(T.length,0,0,2,1,1,2,3);var R=4;M.splice(M.length,0,S[2],S[3],S[6],S[7]),T.splice(T.length,0,R+0,R+2,R+1,R+1,R+2,R+3),R+=4,M.splice(M.length,0,S[4],S[5],S[0],S[1]),T.splice(T.length,0,R+0,R+2,R+1,R+1,R+2,R+3),R+=4,M.splice(M.length,0,S[6],S[7],S[4],S[5]),T.splice(T.length,0,R+0,R+2,R+1,R+1,R+2,R+3),R+=4,M.splice(M.length,0,S[3],S[1],S[7],S[5]),T.splice(T.length,0,R+0,R+2,R+1,R+1,R+2,R+3),R+=4,M.splice(M.length,0,S[2],S[6],S[0],S[4]),T.splice(T.length,0,R+0,R+2,R+1,R+1,R+2,R+3),R+=4;var P=(0,p.extend)({},h);P.vertexArr=M,P.faceArr=T,P.normalArr=[],g.drawCustom(this,this.geo,P);var I=new a.Vector3;this.components.push({centroid:I.addVectors(S[0],S[7]).multiplyScalar(.5)});var B=this.geo.updateGeoGroup(0);g.updateBoundingFromPoints(this.boundingSphere,this.components,B.vertexArray,B.vertices)}addCylinder(h){var v,C;h.start?v=new a.Vector3(h.start.x||0,h.start.y||0,h.start.z||0):v=new a.Vector3(0,0,0),h.end?(C=new a.Vector3(h.end.x,h.end.y||0,h.end.z||0),typeof C.x>"u"&&(C.x=3)):C=new a.Vector3(0,0,0);var x=h.radius||.1,w=s.CC.color(h.color);this.intersectionShape.cylinder.push(new r.Cylinder(v,C,x)),u.GLDraw.drawCylinder(this.geo,v,C,x,w,h.fromCap,h.toCap);var _=new a.Vector3;this.components.push({centroid:_.addVectors(v,C).multiplyScalar(.5)});var S=this.geo.updateGeoGroup(0);g.updateBoundingFromPoints(this.boundingSphere,this.components,S.vertexArray,S.vertices)}addDashedCylinder(h){h.dashLength=h.dashLength||.25,h.gapLength=h.gapLength||.25;var v;h.start?v=new a.Vector3(h.start.x||0,h.start.y||0,h.start.z||0):v=new a.Vector3(0,0,0);var C;h.end?(C=new a.Vector3(h.end.x,h.end.y||0,h.end.z||0),typeof C.x>"u"&&(C.x=3)):C=new a.Vector3(3,0,0);for(var x=h.radius||.1,w=s.CC.color(h.color),_=Math.sqrt(Math.pow(v.x-C.x,2)+Math.pow(v.y-C.y,2)+Math.pow(v.z-C.z,2)),S=_/(h.gapLength+h.dashLength),M=new a.Vector3(h.start.x||0,h.start.y||0,h.start.z||0),T=new a.Vector3(h.end.x,h.end.y||0,h.end.z||0),R=new a.Vector3((C.x-v.x)/(_/h.gapLength),(C.y-v.y)/(_/h.gapLength),(C.z-v.z)/(_/h.gapLength)),P=new a.Vector3((C.x-v.x)/(_/h.dashLength),(C.y-v.y)/(_/h.dashLength),(C.z-v.z)/(_/h.dashLength)),I=0;I<S;I++)T=new a.Vector3(M.x+P.x,M.y+P.y,M.z+P.z),this.intersectionShape.cylinder.push(new r.Cylinder(M,T,x)),u.GLDraw.drawCylinder(this.geo,M,T,x,w,h.fromCap,h.toCap),M=new a.Vector3(T.x+R.x,T.y+R.y,T.z+R.z);var B=new a.Vector3;this.components.push({centroid:B.addVectors(v,C).multiplyScalar(.5)});var W=this.geo.updateGeoGroup(0);g.updateBoundingFromPoints(this.boundingSphere,this.components,W.vertexArray,W.vertices)}addCurve(h){h.points=h.points||[],h.smooth=h.smooth||10,typeof h.fromCap>"u"&&(h.fromCap=2),typeof h.toCap>"u"&&(h.toCap=2);var v=(0,f.subdivide_spline)(h.points,h.smooth);if(v.length<3){console.log("Too few points in addCurve");return}var C=h.radius||.1,x=s.CC.color(h.color),w=0,_=v.length-1,S=v[0].distanceTo(v[1]),M=Math.ceil(2*C/S);if(h.toArrow){_-=M;let I={start:v[_],end:v[v.length-1],radius:C,color:x,mid:1e-4};this.addArrow(I)}if(h.fromArrow){w+=M;let I={start:v[w],end:v[0],radius:C,color:x,mid:1e-4};this.addArrow(I)}for(var T=Math.ceil(v.length/2),R={radius:C,color:x,fromCap:2,toCap:2},P=w;P<_;P++)R.start=v[P],R.end=v[P+1],R.fromCap=2,R.toCap=2,P<T?(R.fromCap=2,R.toCap=0):P>T?(R.fromCap=0,R.toCap=2):(R.fromCap=2,R.toCap=2),this.addCylinder(R)}addLine(h){var v,C;h.start?v=new a.Vector3(h.start.x||0,h.start.y||0,h.start.z||0):v=new a.Vector3(0,0,0),h.end?(C=new a.Vector3(h.end.x,h.end.y||0,h.end.z||0),typeof C.x>"u"&&(C.x=3)):C=new a.Vector3(3,0,0);var x=this.geo.updateGeoGroup(2),w=x.vertices,_=w*3,S=x.vertexArray;S[_]=v.x,S[_+1]=v.y,S[_+2]=v.z,S[_+3]=C.x,S[_+4]=C.y,S[_+5]=C.z,x.vertices+=2;var M=x.lineArray,T=x.lineidx;M[T]=w,M[T+1]=w+1,x.lineidx+=2;var R=new a.Vector3;this.components.push({centroid:R.addVectors(v,C).multiplyScalar(.5)}),x=this.geo.updateGeoGroup(0),g.updateBoundingFromPoints(this.boundingSphere,this.components,x.vertexArray,x.vertices)}addArrow(h){if(h.start?h.start=new a.Vector3(h.start.x||0,h.start.y||0,h.start.z||0):h.start=new a.Vector3(0,0,0),h.dir instanceof a.Vector3&&typeof h.length=="number"){var v=h.dir.clone().multiplyScalar(h.length).add(h.start);h.end=v}else h.end?(h.end=new a.Vector3(h.end.x,h.end.y||0,h.end.z||0),typeof h.end.x>"u"&&(h.end.x=3)):h.end=new a.Vector3(3,0,0);h.radius=h.radius||.1,h.radiusRatio=h.radiusRatio||1.618034,h.mid=0<h.mid&&h.mid<1?h.mid:.618034,g.drawArrow(this,this.geo,h);var C=new a.Vector3;this.components.push({centroid:C.addVectors(h.start,h.end).multiplyScalar(.5)});var x=this.geo.updateGeoGroup(0);g.updateBoundingFromPoints(this.boundingSphere,this.components,x.vertexArray,x.vertices)}static distance_from(h,v){return Math.sqrt(Math.pow(h.x-v.x,2)+Math.pow(h.y-v.y,2)+Math.pow(h.z-v.z,2))}static inSelectedRegion(h,v,C){for(var x=0;x<v.length;x++)if(g.distance_from(v[x],h)<=C)return!0;return!1}addIsosurface(h,v,C){var x=v.isoval!==void 0&&typeof v.isoval=="number"?v.isoval:0,w=!!v.voxel,_=v.smoothness===void 0?1:v.smoothness,S=h.size.x,M=h.size.y,T=h.size.z,R=new Int16Array(S*M*T),P=h.data,I,B;for(I=0,B=R.length;I<B;++I)R[I]=-1;var W=new Uint8Array(S*M*T);for(I=0,B=P.length;I<B;++I){var D=x>=0?P[I]-x:x-P[I];D>0&&(W[I]|=g.ISDONE)}var O=[],z=[];l.MarchingCube.march(W,O,z,{fulltable:!0,voxel:w,unitCube:h.unit,origin:h.origin,matrix:h.matrix,nX:S,nY:M,nZ:T}),!w&&_>0&&l.MarchingCube.laplacianSmooth(_,O,z);var G=[],k=[],$=[];if(v.selectedRegion&&v.coords===void 0&&(v.coords=v.selectedRegion),v.coords!==void 0){var Z=v.coords[0].x,K=v.coords[0].y,j=v.coords[0].z,Q=v.coords[0].x,le=v.coords[0].y,he=v.coords[0].z;for(let ce=0;ce<v.coords.length;ce++)v.coords[ce].x>Z?Z=v.coords[ce].x:v.coords[ce].x<Q&&(Q=v.coords[ce].x),v.coords[ce].y>K?K=v.coords[ce].y:v.coords[ce].y<le&&(le=v.coords[ce].y),v.coords[ce].z>j?j=v.coords[ce].z:v.coords[ce].z<he&&(he=v.coords[ce].z);var ve=2;v.radius!==void 0&&(ve=v.radius),v.selectedOffset!==void 0&&(ve=v.selectedOffset),v.seldist!==void 0&&(ve=v.seldist),Q-=ve,Z+=ve,le-=ve,K+=ve,he-=ve,j+=ve;for(let ce=0;ce<O.length;ce++)O[ce].x>Q&&O[ce].x<Z&&O[ce].y>le&&O[ce].y<K&&O[ce].z>he&&O[ce].z<j&&g.inSelectedRegion(O[ce],v.coords,ve)?(G.push(k.length),k.push(O[ce])):G.push(-1);for(let ce=0;ce+2<z.length;ce+=3)G[z[ce]]!==-1&&G[z[ce+1]]!==-1&&G[z[ce+2]]!==-1&&($.push(z[ce]-(z[ce]-G[z[ce]])),$.push(z[ce+1]-(z[ce+1]-G[z[ce+1]])),$.push(z[ce+2]-(z[ce+2]-G[z[ce+2]])));O=k,z=$}g.drawCustom(this,this.geo,{vertexArr:O,faceArr:z,normalArr:[],clickable:v.clickable,hoverable:v.hoverable}),this.updateStyle(v);var re=new a.Vector3(h.origin.x,h.origin.y,h.origin.z),Ie=new a.Vector3(h.size.x*h.unit.x,h.size.y*h.unit.y,h.size.z*h.unit.z),ge=new a.Vector3(0,0,0),Se=re.clone(),Le=re.clone().add(Ie);for(let ce=0;ce<O.length;ce++)ge.add(O[ce]),Se.max(O[ce]),Le.min(O[ce]);ge.divideScalar(O.length);var be=ge.distanceTo(Le),ye=ge.distanceTo(Se);this.boundingSphere.center=ge,this.boundingSphere.radius=Math.max(be,ye),typeof C=="function"&&C()}addVolumetricData(h,v,C){h=new c.VolumeData(h,v),this.addIsosurface(h,C)}finalize(){return g.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(h){if(this.renderedShapeObj&&(h.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){g.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&g.updateColor(this.geo,this.color),this.shapeObj=new n.Object3D;var v=null;this.side==n.DoubleSide?v=new n.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:n.Coloring.VertexColors}):v=new n.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:n.Coloring.VertexColors});var C=new n.Mesh(this.geo,v);this.shapeObj.add(C);var x=new n.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),w=new n.Line(this.linegeo,x,n.LineStyle.LinePieces);this.shapeObj.add(w),this.renderedShapeObj=this.shapeObj.clone(),h.add(this.renderedShapeObj)}}removegl(h){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),h.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}g.ISDONE=2,g.drawCustom=function(E,h,v){var C=v,x=C.vertexArr,w=C.faceArr;(x.length===0||w.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var _=v.color;typeof _>"u"&&(_=E.color),_=s.CC.color(_);for(var S=y(C),M=0,T=S.length;M<T;M++)g.addCustomGeo(E,h,S[M],S[M].colorArr?S[M].colorArr:_,v.clickable)};function y(E){var h=64e3;if(E.vertexArr.length<h)return[E];var v=[{vertexArr:[],normalArr:[],faceArr:[]}];E.colorArr&&(v.colorArr=[]);var C=[],x=[],w=0,_=E.faceArr;for(let M=0,T=_.length;M<T;M+=3){let R=v[w];for(let P=0;P<3;P++){var S=_[M+P];C[S]!==w&&(C[S]=w,x[S]=R.vertexArr.length,R.vertexArr.push(E.vertexArr[S]),E.normalArr&&E.normalArr[S]&&R.normalArr.push(E.normalArr[S]),E.colorArr&&E.colorArr[S]&&R.colorArr.push(E.colorArr[S])),R.faceArr.push(x[S])}R.vertexArr.length>=h&&(v.push({vertexArr:[],normalArr:[],faceArr:[]}),E.colorArr&&(v.colorArr=[]),w++)}return v}},"./src/GLViewer.ts":(o,t,e)=>{e.r(t),e.d(t,{GLViewer:()=>h,createStereoViewer:()=>x,createViewer:()=>v,createViewerGrid:()=>C});var n=e("./src/WebGL/index.ts"),r=e("./src/WebGL/math/index.ts"),a=e("./src/colors.ts"),s=e("./src/utilities.ts"),l=e("./src/Gradient.ts"),c=e("./src/GLModel.ts"),u=e("./src/Label.ts"),f=e("./src/GLShape.ts"),p=e("./src/VolumeData.ts"),g=e("./src/ProteinSurface4.ts"),y=e("./src/VolumetricRender.ts"),E=e("./node_modules/upng-js/UPNG.js");class h{getRect(){let _=this.container,S=_.getBoundingClientRect();if(S.width==0&&S.height==0&&_.style.display==="none"){let M=_.style.position,T=_.style.visibility;_.style.display="block",_.style.visibility="hidden",_.style.position="absolute",S=_.getBoundingClientRect(),_.style.display="none",_.style.visibility=T,_.style.position=M}return S}getWidth(){return this.getRect().width}getHeight(){return this.getRect().height}setupRenderer(){this.renderer=new n.Renderer({antialias:this.config.antialias,preserveDrawingBuffer:!0,premultipliedAlpha:!1,id:this.config.id,row:this.config.row,col:this.config.col,rows:this.config.rows,cols:this.config.cols,canvas:this.config.canvas,containerWidth:this.WIDTH||1,containerHeight:this.HEIGHT||1}),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new n.Scene,this.scene.fog=new n.Fog(this.bgColor,100,200),this.modelGroup=new n.Object3D,this.rotationGroup=new n.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new r.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var _=new n.Light(16777215);_.position=new r.Vector3(.2,.2,1).normalize(),_.intensity=1,this.scene.add(_)}initContainer(_){this.container=_,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var _=0;for(let M in this.surfaces)if(this.surfaces.hasOwnProperty(M)){var S=parseInt(M);isNaN(S)||S>_&&(_=S)}return _+1}setSlabAndFog(){let _=this.camera.position.z-this.rotationGroup.position.z;_<1&&(_=1),this.camera.near=_+this.slabNear,this.camera.near<1&&(this.camera.near=1),this.camera.far=_+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=_*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.far,this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(_){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!_&&this.linkedViewers.length>0))for(var S=this._viewer.getView(),M=0;M<this.linkedViewers.length;M++){var T=this.linkedViewers[M];T.setView(S,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledAtoms.splice(0,this.contextMenuEnabledAtoms.length);for(let _=0,S=this.models.length;_<S;_++){let M=this.models[_];if(M){let T=M.selectedAtoms({clickable:!0}),R=M.selectedAtoms({hoverable:!0}),P=M.selectedAtoms({contextMenuEnabled:!0});for(let I=0;I<R.length;I++)this.hoverables.push(R[I]);for(let I=0;I<T.length;I++)this.clickables.push(T[I]);for(let I=0;I<P.length;I++)this.contextMenuEnabledAtoms.push(P[I])}}for(let _=0,S=this.shapes.length;_<S;_++){let M=this.shapes[_];M&&M.clickable&&this.clickables.push(M),M&&M.hoverable&&this.hoverables.push(M)}}handleClickSelection(_,S,M){let T=this.targetedObjects(_,S,this.clickables);if(T.length){var R=T[0].clickable;R.callback!==void 0&&(typeof R.callback!="function"&&(R.callback=(0,s.makeFunction)(R.callback)),typeof R.callback=="function"&&R.callback(R,this._viewer,M,this.container,T))}}canvasOffset(){let _=this.glDOM,S=_.getBoundingClientRect(),M=_.ownerDocument,T=M.documentElement,R=M.defaultView;return{top:S.top+R.pageYOffset-T.clientTop,left:S.left+R.pageXOffset-T.clientLeft}}setHover(_,S,M){this.current_hover!=_&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,s.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,S,this.container,M)),this.current_hover=_,_&&_.hover_callback!==void 0&&(typeof _.hover_callback!="function"&&(_.hover_callback=(0,s.makeFunction)(_.hover_callback)),typeof _.hover_callback=="function"&&_.hover_callback(_,this._viewer,S,this.container,M)))}handleHoverSelection(_,S,M){if(this.hoverables.length==0)return;let T=this.targetedObjects(_,S,this.hoverables);if(T.length){var R=T[0].clickable;this.setHover(R,M,T),this.current_hover=R}else this.setHover(null)}handleHoverContinue(_,S){let M=this.targetedObjects(_,S,this.hoverables);(M.length==0||M[0]===void 0)&&this.setHover(null),M[0]!==void 0&&M[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(_,{allowTolerance:S=_.targetTouches,tolerance:M=5}={}){const T=this.getX(_),R=this.getY(_);if(S){const P=Math.abs(T-this.mouseStartX),I=Math.abs(R-this.mouseStartY);return P<=M&&I<=M}else return T===this.mouseStartX&&R===this.mouseStartY}calcTouchDistance(_){var S=_.targetTouches[0].pageX-_.targetTouches[1].pageX,M=_.targetTouches[0].pageY-_.targetTouches[1].pageY;return Math.hypot(S,M)}getX(_){var S=_.pageX;return S==null&&(S=_.pageX),_.targetTouches&&_.targetTouches[0]?S=_.targetTouches[0].pageX:_.changedTouches&&_.changedTouches[0]&&(S=_.changedTouches[0].pageX),S}getY(_){var S=_.pageY;return S==null&&(S=_.pageY),_.targetTouches&&_.targetTouches[0]?S=_.targetTouches[0].pageY:_.changedTouches&&_.changedTouches[0]&&(S=_.changedTouches[0].pageY),S}isInViewer(_,S){if(this.viewers!=null){var M=this.WIDTH/this.cols,T=this.HEIGHT/this.rows,R=this.canvasOffset(),P=_-R.left,I=S-R.top,B=this.rows-Math.floor(I/T)-1,W=Math.floor(P/M);if(B!=this.row||W!=this.col)return!1}return!0}adjustZoomToLimits(_){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let S=this.CAMERA_Z-this.config.lowerZoomLimit;_>S&&(_=S)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let S=this.CAMERA_Z-this.config.upperZoomLimit;_<S&&(_=S)}return _>this.CAMERA_Z-1&&(_=this.CAMERA_Z-1),_}static slerp(_,S,M){if(M==1)return S.clone();if(M==0)return _.clone();let T=_.x*S.x+_.y*S.y+_.z*S.z+_.w*S.w;if(T>.9995){let O=new r.Quaternion(_.x+M*(S.x-_.x),_.y+M*(S.y-_.y),_.z+M*(S.z-_.z),_.w+M*(S.w-_.w));return O.normalize(),O}T<0&&(S=S.clone().multiplyScalar(-1),T=-T),T>1?T=1:T<-1&&(T=-1);var R=Math.acos(T),P=R*M,I=S.clone();I.sub(_.clone().multiplyScalar(T)),I.normalize();var B=Math.cos(P),W=Math.sin(P),D=new r.Quaternion(_.x*B+I.x*W,_.y*B+I.y*W,_.z*B+I.z*W,_.w*B+I.w*W);return D.normalize(),D}constructor(_,S={}){this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledAtoms=[],this.current_hover=null,this.hoverDuration=500,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.slabNear=-50,this.slabFar=50,this.cq=new r.Quaternion(0,0,0,1),this.dq=new r.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=S,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=a.elementColors.defaultColors),this.nomouse=this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=a.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=parseFloat(this.config.camerax)),this._viewer=this,this.container=_,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new n.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new r.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new r.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new n.Raycaster(new r.Vector3(0,0,0),new r.Vector3(0,0,0)),this.projector=new n.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=a.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container));try{typeof this.callback=="function"&&this.callback(this)}catch(M){console.log("error with glviewer callback: "+M)}}targetedObjects(_,S,M){var T={x:_,y:S,z:-1};return Array.isArray(M)||(M=this.selectedAtoms(M)),M.length==0?[]:(this.raycaster.setFromCamera(T,this.camera),this.raycaster.intersectObjects(this.modelGroup,M))}modelToScreen(_){let S=!1;Array.isArray(_)||(_=[_],S=!0);let M=this.renderer.getXRatio(),T=this.renderer.getYRatio(),R=this.col,P=this.row,I=R*(this.WIDTH/M),B=(T-P-1)*(this.HEIGHT/T),W=[],D=this.canvasOffset();return _.forEach(O=>{let z=new r.Vector3(O.x,O.y,O.z);z.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(z,this.camera);let G=this.WIDTH/M*(z.x+1)/2+D.left+I,k=-(this.HEIGHT/T)*(z.y-1)/2+D.top+B;W.push({x:G,y:k})}),S&&(W=W[0]),W}screenOffsetToModel(_,S,M){var T=_/this.WIDTH,R=S/this.HEIGHT,P=M===void 0?this.rotationGroup.position.z:M,I=this.rotationGroup.quaternion,B=new r.Vector3(0,0,P);return this.projector.projectVector(B,this.camera),B.x+=T*2,B.y-=R*2,this.projector.unprojectVector(B,this.camera),B.z=0,B.applyQuaternion(I),B}screenToModelDistance(_,S){let M=this.canvasOffset(),T=new r.Vector3(S.x,S.y,S.z);T.applyMatrix4(this.modelGroup.matrixWorld);let R=T.clone();this.projector.projectVector(T,this.camera);let P=new r.Vector3((_.x-M.left)*2/this.WIDTH-1,(_.y-M.top)*2/-this.HEIGHT+1,T.z);return this.projector.unprojectVector(P,this.camera),P.distanceTo(R)}setViewChangeCallback(_){(typeof _=="function"||_==null)&&(this.viewChangeCallback=_)}setStateChangeCallback(_){(typeof _=="function"||_==null)&&(this.stateChangeCallback=_)}getConfig(){return this.config}setConfig(_){this.config=_}getInternalState(){var _={models:[],surfaces:[],shapes:[],labels:[]};for(let S=0;S<this.models.length;S++)this.models[S]&&(_.models[S]=this.models[S].getInternalState());return _}setInternalState(_){this.clear();var S=_.models;for(let M=0;M<S.length;M++)S[M]&&(this.models[M]=new c.GLModel(M),this.models[M].setInternalState(S[M]));this.render()}setZoomLimits(_,S){typeof _<"u"&&(this.config.lowerZoomLimit=_),S&&(this.config.upperZoomLimit=S),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(_){_.fov!==void 0&&(this.fov=_.fov,this.camera.fov=this.fov),_.z!==void 0&&(this.CAMERA_Z=_.z,this.camera.z=this.CAMERA_Z),_.orthographic!==void 0&&(this.camera.ortho=_.orthographic)}_handleMouseDown(_){if(_.preventDefault(),!this.scene)return;var S=this.getX(_),M=this.getY(_);if(S===void 0)return;this.isDragging=!0,this.mouseButton=_.which,this.mouseStartX=S,this.mouseStartY=M,this.touchHold=!0,this.touchDistanceStart=0,_.targetTouches&&_.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(_)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let T=this;setTimeout(function(){_.targetTouches&&T.touchHold==!0&&(T.glDOM=T.renderer.domElement,T.glDOM.dispatchEvent(new Event("contextmenu")))},1e3)}_handleMouseUp(_){if(this.touchHold=!1,this.isDragging&&this.scene){var S=this.getX(_),M=this.getY(_);if(this.closeEnoughForClick(_)&&this.isInViewer(S,M)){let T=this.mouseXY(S,M);this.handleClickSelection(T.x,T.y,_)}}this.isDragging=!1}_handleMouseScroll(_){if(_.preventDefault(),!!this.scene){var S=this.getX(_),M=this.getY(_);if(S!==void 0&&!(!this.control_all&&!this.isInViewer(S,M))){var T=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,R=1;if(_.ctrlKey&&(R=-1),_.detail)this.rotationGroup.position.z+=R*T*_.detail/10;else if(_.wheelDelta){let P=_.wheelDelta*600/(_.wheelDelta+600);this.rotationGroup.position.z-=R*T*P/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(_){let S=this;return _=_||1,new Promise(function(M){let T=0,R=S.viewChangeCallback,P=[],I=[],B=Date.now();S.viewChangeCallback=function(){I.push(Date.now()-B),B=Date.now(),P.push(new Promise(W=>{S.getCanvas().toBlob(function(D){D.arrayBuffer().then(W)},"image/png")})),T+=1,T==_&&(S.viewChangeCallback=R,Promise.all(P).then(W=>{let D=[];for(let Z=0;Z<W.length;Z++){let K=(0,E.decode)(W[Z]);D.push((0,E.toRGBA8)(K)[0])}let O=S.getCanvas().width,z=S.getCanvas().height,G=(0,E.encode)(D,O,z,0,I),k=new Blob([G],{type:"image/png"}),$=new FileReader;$.onload=function(Z){M(Z.target.result)},$.readAsDataURL(k)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(_){this.hoverDuration=_}mouseXY(_,S){let M=this.canvasOffset(),T=this.renderer.getXRatio(),R=this.renderer.getYRatio(),P=this.col,I=this.row,B=P*(this.WIDTH/T),W=(R-I-1)*(this.HEIGHT/R),D=(_-M.left-B)/(this.WIDTH/T)*2-1,O=-((S-M.top-W)/(this.HEIGHT/R))*2+1;return{x:D,y:O}}_handleMouseMove(_){clearTimeout(this.hoverTimeout),_.preventDefault();let S=this.getX(_),M=this.getY(_);if(S===void 0)return;let T=this.renderer.getXRatio(),R=this.renderer.getYRatio(),P=this.mouseXY(S,M),I=this;this.current_hover!==null&&this.handleHoverContinue(P.x,P.y);var B=0;if(!(!this.control_all&&!this.isInViewer(S,M))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){I.handleHoverSelection(P.x,P.y,_)},this.hoverDuration)),!!this.isDragging)){var W=(S-this.mouseStartX)/this.WIDTH,D=(M-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&_.targetTouches&&_.targetTouches.length==2){var O=this.calcTouchDistance(_);B=2,D=(O-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else _.targetTouches&&_.targetTouches.length==3&&(B=1);W*=T,D*=R;var z=Math.hypot(W,D),G;if(B==3||this.mouseButton==3&&_.ctrlKey)this.slabNear=this.cslabNear+W*100,this.slabFar=this.cslabFar-D*100;else if(B==2||this.mouseButton==3||_.shiftKey)G=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,G<80&&(G=80),this.rotationGroup.position.z=this.cz+D*G,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(B==1||this.mouseButton==2||_.ctrlKey){var k=this.screenOffsetToModel(T*(S-this.mouseStartX),R*(M-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,k)}else if((B===0||this.mouseButton==1)&&z!==0){var $=Math.sin(z*Math.PI)/z;this.dq.x=Math.cos(z*Math.PI),this.dq.y=0,this.dq.z=$*W,this.dq.w=-$*D,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(_){_.preventDefault();var S=this.getX(_),M=this.getY(_);if(!(S!=this.mouseStartX||M!=this.mouseStartY)){var P=this.mouseStartX,I=this.mouseStartY,R=this.canvasOffset();let B=this.mouseXY(P,I),W=B.x,D=B.y,O=this.targetedObjects(W,D,this.contextMenuEnabledAtoms);var T=null;O.length&&(T=O[0].clickable);var R=this.canvasOffset(),P=this.mouseStartX-R.left,I=this.mouseStartY-R.top;this.userContextMenuHandler&&this.userContextMenuHandler(T,P,I,O)}}setContainer(_){let S=(0,s.getElement)(_)||this.container;return this.initContainer(S),this}setBackgroundColor(_,S){(typeof S>"u"||S<0||S>1)&&(S=1);var M=a.CC.color(_);return this.scene.fog.color=M,this.bgColor=M.getHex(),this.renderer.setClearColorHex(M.getHex(),S),this.show(),this}setProjection(_){this.camera.ortho=_==="orthographic",this.setSlabAndFog()}setViewStyle(_){if(_.style==="outline"){var S={};_.color&&(S.color=a.CC.color(_.color)),_.width&&(S.width=_.width),this.renderer.enableOutline(S)}else this.renderer.disableOutline();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(_){return this.WIDTH=_||this.WIDTH,this.updateSize(),this}setHeight(_){return this.HEIGHT=_||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let _=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0&&(this.container.querySelector("canvas").remove(),this.setupRenderer(),this.initContainer(this.container),_=!0),this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),_){let S=this.renderer.supportedExtensions();S.regen=!0,this._viewer.render(null,S)}else this.show();return this}getModel(_){return _===void 0?this.models.length==0?null:this.models[this.models.length-1]:_ instanceof c.GLModel?_:_ in this.models?this.models[_]:this.models.length==0?null:this.models[this.models.length-1]}spin(_,S=1){if(clearInterval(this.spinInterval),typeof _>"u"&&(_="y"),typeof _=="boolean")if(_)_="y";else return;Array.isArray(_)&&(_={x:_[0],y:_[1],z:_[2]});var M=this;this.spinInterval=setInterval(function(){!M.getCanvas().isConnected&&M.renderer.isLost()&&clearInterval(M.spinInterval),M.rotate(1*S,_)},25)}animateMotion(_,S,M,T,R,P){var I=20,B=Math.ceil(_/I);B<1&&(B=1),this.incAnim();var W={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(S){let z=new Array(B);for(let Z=0;Z<B;Z++){let K=(Z+1)/B,j={mpos:W.mpos,rz:W.rz,rot:W.rot};j.mpos=M.clone().sub(W.mpos).multiplyScalar(K).add(W.mpos),j.rz=W.rz+K*(T-W.rz),j.rot=h.slerp(W.rot,R,K),j.cam=P.clone().sub(W.cam).multiplyScalar(K).add(W.cam),z[Z]=j}let G=0,k=this,$=function(){var Z=z[G];G+=1,k.modelGroup.position=Z.mpos,k.rotationGroup.position.z=Z.rz,k.rotationGroup.quaternion=Z.rot,k.camera.lookAt(Z.cam),G<z.length?setTimeout($,I):k.decAnim(),k.show()};setTimeout($,I)}else{var D={};let z=1/B;if(M&&(D.mpos=M.clone().sub(W.mpos).multiplyScalar(z)),typeof T<"u"&&T!=null&&(D.rz=z*(T-W.rz)),R){var O=h.slerp(W.rot,R,z);D.rot=W.rot.clone().inverse().multiply(O)}P&&(D.cam=P.clone().sub(W.cam).multiplyScalar(z));let G=0,k=this,$=function(){G+=1,D.mpos&&k.modelGroup.position.add(D.mpos),D.rz&&(k.rotationGroup.position.z+=D.rz),D.rot&&k.rotationGroup.quaternion.multiply(D.rot),D.cam&&(k.lookingAt.add(D.cam),k.camera.lookAt(k.lookingAt)),G<B?setTimeout($,I):k.decAnim(),k.show()};setTimeout($,I)}}rotate(_,S="y",M=0,T=!1){if(S=="x"?S={x:1,y:0,z:0}:S=="y"?S={x:0,y:1,z:0}:S=="z"&&(S={x:0,y:0,z:1}),S=="vx"?S={vx:1,vy:0,vz:0}:S=="vy"?S={vx:0,vy:1,vz:0}:S=="vz"&&(S={vx:0,vy:0,vz:1}),typeof S.vx<"u"){var R=new r.Vector3(S.vx,S.vy,S.vz);R.applyQuaternion(this.rotationGroup.quaternion),S={x:R.x,y:R.y,z:R.z}}var P=function(D){var O=Math.sin(D/2),z=Math.cos(D/2),G=0,k=0,$=0;return G=S.x*O,k=S.y*O,$=S.z*O,new r.Quaternion(G,k,$,z).normalize()},I=Math.PI*_/180,B=P(I);if(M){var W=new r.Quaternion().copy(this.rotationGroup.quaternion).multiply(B);this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,W,this.lookingAt)}else this.rotationGroup.quaternion.multiply(B),this.show();return this}surfacesFinished(){for(var _ in this.surfaces)if(!this.surfaces[_][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var _=this.modelGroup.position,S=this.rotationGroup.quaternion;return[_.x,_.y,_.z,this.rotationGroup.position.z,S.x,S.y,S.z,S.w]}setView(_,S){return _===void 0||!(_ instanceof Array||_.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=_[0],this.modelGroup.position.y=_[1],this.modelGroup.position.z=_[2],this.rotationGroup.position.z=_[3],this.rotationGroup.quaternion.x=_[4],this.rotationGroup.quaternion.y=_[5],this.rotationGroup.quaternion.z=_[6],this.rotationGroup.quaternion.w=_[7],typeof _[8]<"u"&&(this.rotationGroup.position.x=_[8],this.rotationGroup.position.y=_[9]),this.show(S),this)}render(_,S){this.renderer.setViewport(),this.updateClickables();var M=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var T,R;for(S||(S=this.renderer.supportedExtensions()),T=0;T<this.models.length;T++)this.models[T]&&this.models[T].globj(this.modelGroup,S);for(T=0;T<this.shapes.length;T++)this.shapes[T]&&(typeof this.shapes[T].frame>"u"||this.viewer_frame<0||this.shapes[T].frame<0||this.shapes[T].frame==this.viewer_frame?this.shapes[T].globj(this.modelGroup,S):this.shapes[T].removegl(this.modelGroup));for(T=0;T<this.labels.length;T++)this.labels[T]&&typeof this.labels[T].frame<"u"&&this.labels[T].frame>=0&&(this.modelGroup.remove(this.labels[T].sprite),(this.viewer_frame<0||this.labels[T].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[T].sprite));for(T in this.surfaces)if(this.surfaces.hasOwnProperty(T)){var P=this.surfaces[T];for(R=0;R<P.length;R++)if(P.hasOwnProperty(R)){var I=P[R].geo;if(!P[R].finished||S.regen){I.verticesNeedUpdate=!0,I.elementsNeedUpdate=!0,I.normalsNeedUpdate=!0,I.colorsNeedUpdate=!0,I.buffersNeedUpdate=!0,I.boundingSphere=null,P[R].done&&(P[R].finished=!0),P[R].lastGL&&this.modelGroup.remove(P[R].lastGL);var B=null;if(P[R].mat instanceof n.LineBasicMaterial?B=new n.Line(I,P[R].mat):B=new n.Mesh(I,P[R].mat),P[R].mat.transparent&&P[R].mat.opacity==0?B.visible=!1:B.visible=!0,P[R].symmetries.length>1||P[R].symmetries.length==1&&!P[R].symmetries[R].isIdentity()){var W,D=new n.Object3D;for(W=0;W<P[R].symmetries.length;W++){var O=B.clone();O.matrix=P[R].symmetries[W],O.matrixAutoUpdate=!1,D.add(O)}P[R].lastGL=D,this.modelGroup.add(D)}else P[R].lastGL=B,this.modelGroup.add(B)}}}return this.setView(M),typeof _=="function"&&_(this),this}getModelList(_){let S=[];if(typeof _>"u"||typeof _.model>"u")for(let T=0;T<this.models.length;T++)this.models[T]&&S.push(this.models[T]);else{let T=_.model;Array.isArray(T)||(T=[T]);for(let R=0;R<T.length;R++)if(typeof T[R]=="number"){var M=T[R];M<0&&(M+=this.models.length),S.push(this.models[M])}else S.push(T[R])}return S}getAtomsFromSel(_){var S=[];typeof _>"u"&&(_={});var M=this.getModelList(_);for(let T=0;T<M.length;T++)S=S.concat(M[T].selectedAtoms(_));return S}atomIsSelected(_,S){typeof S>"u"&&(S={});for(var M=this.getModelList(S),T=0;T<M.length;T++)if(M[T].atomIsSelected(_,S))return!0;return!1}selectedAtoms(_){return this.getAtomsFromSel(_)}getUniqueValues(_,S){typeof S>"u"&&(S={});var M=this.getAtomsFromSel(S),T={};for(var R in M)if(M[R].hasOwnProperty(_)){var P=M[R][_];T[P]=!0}return Object.keys(T)}pdbData(_){for(var S=this.getAtomsFromSel(_),M="",T=0,R=S.length;T<R;++T)M+=S[T].pdbline+`
`;return M}zoom(_=2,S=0,M=!1){var T=(this.CAMERA_Z-this.rotationGroup.position.z)/_,R=this.CAMERA_Z-T;return S>0?this.animateMotion(S,M,this.modelGroup.position,this.adjustZoomToLimits(R),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(R),this.show()),this}translate(_,S,M=0,T=!1){var R=_/this.WIDTH,P=S/this.HEIGHT,I=new r.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(I,this.camera),I.x-=R,I.y-=P,this.projector.unprojectVector(I,this.camera),I.z=0;var B=this.lookingAt.clone().add(I);return M>0?this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,B):(this.lookingAt=B,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(_,S,M=0,T=!1){var R=this.screenOffsetToModel(_,S),P=this.modelGroup.position.clone().add(R);return M>0?this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=P,this.show()),this}fitSlab(_){_=_||{};var S=this.getAtomsFromSel(_),M=(0,s.getExtent)(S),T=M[1][0]-M[0][0],R=M[1][1]-M[0][1],P=M[1][2]-M[0][2],I=Math.hypot(T,R,P);return I<5&&(I=5),this.slabNear=-I/1.9,this.slabFar=I/2,this}center(_={},S=0,M=!1){var T,R,P=this.getAtomsFromSel(_),I=(0,s.getExtent)(P);(0,s.isEmptyObject)(_)?(this.shapes.forEach(K=>{if(K&&K.boundingSphere&&K.boundingSphere.center){var j=K.boundingSphere.center,Q=K.boundingSphere.radius;Q>0?(P.push(new r.Vector3(j.x+Q,j.y,j.z)),P.push(new r.Vector3(j.x-Q,j.y,j.z)),P.push(new r.Vector3(j.x,j.y+Q,j.z)),P.push(new r.Vector3(j.x,j.y-Q,j.z)),P.push(new r.Vector3(j.x,j.y,j.z+Q)),P.push(new r.Vector3(j.x,j.y,j.z-Q))):P.push(j)}}),I=(0,s.getExtent)(P),T=P,R=I):(T=this.getAtomsFromSel({}),R=(0,s.getExtent)(T));var B=new r.Vector3(I[2][0],I[2][1],I[2][2]),W=R[1][0]-R[0][0],D=R[1][1]-R[0][1],O=R[1][2]-R[0][2],z=Math.hypot(W,D,O);z<5&&(z=5),this.slabNear=-z/1.9,this.slabFar=z/2,W=I[1][0]-I[0][0],D=I[1][1]-I[0][1],O=I[1][2]-I[0][2],z=Math.hypot(W,D,O),z<5&&(z=5);for(var G=25,k=0;k<P.length;k++)if(P[k]){var $=B.distanceToSquared(P[k]);$>G&&(G=$)}z=Math.sqrt(G)*2;var Z=B.clone().multiplyScalar(-1);return S>0?this.animateMotion(S,M,Z,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=Z,this.show()),this}zoomTo(_={},S=0,M=!1){let T=this.getAtomsFromSel(_),R=(0,s.getExtent)(T),P=R;if((0,s.isEmptyObject)(_)){let j=T&&T.length;if(this.shapes.forEach(Q=>{if(Q&&Q.boundingSphere){if(Q.boundingSphere.box){let ve=Q.boundingSphere.box;T.push(new r.Vector3(ve.min.x,ve.min.y,ve.min.z)),T.push(new r.Vector3(ve.max.x,ve.max.y,ve.max.z))}else if(Q.boundingSphere.center){var le=Q.boundingSphere.center,he=Q.boundingSphere.radius;he>0?(T.push(new r.Vector3(le.x+he,le.y,le.z)),T.push(new r.Vector3(le.x-he,le.y,le.z)),T.push(new r.Vector3(le.x,le.y+he,le.z)),T.push(new r.Vector3(le.x,le.y-he,le.z)),T.push(new r.Vector3(le.x,le.y,le.z+he)),T.push(new r.Vector3(le.x,le.y,le.z-he))):T.push(le)}}}),P=(0,s.getExtent)(T),!j)for(let Q=0;Q<3;Q++)R[2][Q]=(P[0][Q]+P[1][Q])/2}else{let j=this.getAtomsFromSel({});P=(0,s.getExtent)(j)}var I=new r.Vector3(R[2][0],R[2][1],R[2][2]),B=P[1][0]-P[0][0],W=P[1][1]-P[0][1],D=P[1][2]-P[0][2],O=Math.hypot(B,W,D);O<5&&(O=5),this.slabNear=-O/1.9,this.slabFar=O/2,Object.keys(_).length===0&&(this.slabNear=Math.min(-O*2,-50),this.slabFar=Math.max(O*2,50));var z=this.config.minimumZoomToDistance||5;B=R[1][0]-R[0][0],W=R[1][1]-R[0][1],D=R[1][2]-R[0][2],O=Math.hypot(B,W,D),O<z&&(O=z);for(var G=z*z,k=0;k<T.length;k++)if(T[k]){var $=I.distanceToSquared(T[k]);$>G&&(G=$)}O=Math.sqrt(G)*2;var Z=I.clone().multiplyScalar(-1),K=-(O*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return K=this.adjustZoomToLimits(K),S>0?this.animateMotion(S,M,Z,K,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=Z,this.rotationGroup.position.z=K,this.show()),this}setSlab(_,S){this.slabNear=_,this.slabFar=S}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(_,S={},M,T=!1){if(M){var R=(0,s.getExtent)(this.getAtomsFromSel(M));S.position={x:R[2][0],y:R[2][1],z:R[2][2]}}var P=new u.Label(_,S);return P.setContext(),this.modelGroup.add(P.sprite),this.labels.push(P),T||this.show(),P}addResLabels(_,S,M=!1){let T=this.labels.length;return this.applyToModels("addResLabels",_,this,S,M),this.show(),this.labels.slice(T)}addPropertyLabels(_,S,M){return this.applyToModels("addPropertyLabels",_,S,this,M),this.show(),this}removeLabel(_){for(var S=0;S<this.labels.length;S++)if(this.labels[S]==_){this.labels.splice(S,1),_.dispose(),this.modelGroup.remove(_.sprite);break}return this.show(),this}removeAllLabels(){for(var _=0;_<this.labels.length;_++)this.labels[_]&&this.labels[_].sprite&&this.modelGroup.remove(this.labels[_].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}setLabelStyle(_,S){return this.modelGroup.remove(_.sprite),_.dispose(),_.stylespec=S,_.setContext(),this.modelGroup.add(_.sprite),this.show(),_}setLabelText(_,S){return this.modelGroup.remove(_.sprite),_.dispose(),_.text=S,_.setContext(),this.modelGroup.add(_.sprite),this.show(),_}addShape(_){_=_||{};var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,this.shapes.push(S),S}removeShape(_){if(!_)return this;for(_.removegl(this.modelGroup),delete this.shapes[_.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var _=0;_<this.shapes.length;_++){var S=this.shapes[_];S&&S.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(_){if(_.hasOwnProperty("x")&&_.hasOwnProperty("y")&&_.hasOwnProperty("z"))return _;var S=this.getAtomsFromSel(_);if(S.length==0)return{x:0,y:0,z:0};var M=(0,s.getExtent)(S);return{x:M[0][0]+(M[1][0]-M[0][0])/2,y:M[0][1]+(M[1][1]-M[0][1])/2,z:M[0][2]+(M[1][2]-M[0][2])/2}}addSphere(_){_=_||{},_.center=this.getSelectionCenter(_.center);var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,S.addSphere(_),this.shapes.push(S),S.finalize(),S}addBox(_={}){_.corner!=null&&(_.corner=this.getSelectionCenter(_.corner)),_.center!=null&&(_.center=this.getSelectionCenter(_.center));var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,S.addBox(_),this.shapes.push(S),S.finalize(),S}addArrow(_={}){_.start=this.getSelectionCenter(_.start),_.end=this.getSelectionCenter(_.end);var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,S.addArrow(_),this.shapes.push(S),S.finalize(),S}addCylinder(_={}){_.start=this.getSelectionCenter(_.start),_.end=this.getSelectionCenter(_.end);var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,_.dashed?S.addDashedCylinder(_):S.addCylinder(_),this.shapes.push(S),S.finalize(),S}addCurve(_={}){var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,S.addCurve(_),this.shapes.push(S),S.finalize(),S}addLine(_={}){_.start=this.getSelectionCenter(_.start),_.end=this.getSelectionCenter(_.end),_.wireframe=!0;var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,_.dashed?S=this.addLineDashed(_,S):S.addLine(_),this.shapes.push(S),S.finalize(),S}addUnitCell(_,S){_=this.getModel(_),S=S||{alabel:"a",blabel:"b",clabel:"c"},S.box=S.box||{},S.astyle=S.astyle||{color:"red",radius:.1,midpos:-1},S.bstyle=S.bstyle||{color:"green",radius:.1,midpos:-1},S.cstyle=S.cstyle||{color:"blue",radius:.1,midpos:-1},S.alabelstyle=S.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},S.blabelstyle=S.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},S.clabelstyle=S.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},_.unitCellObjects&&this.removeUnitCell(_),_.unitCellObjects={shapes:[],labels:[]};var M=_.getCrystData(),T=null;if(M){if(M.matrix)T=M.matrix;else{var R=M.a,P=M.b,I=M.c,B=M.alpha,W=M.beta,D=M.gamma;B=B*Math.PI/180,W=W*Math.PI/180,D=D*Math.PI/180;var O,z,G;O=Math.cos(W),z=(Math.cos(B)-Math.cos(W)*Math.cos(D))/Math.sin(D),G=Math.sqrt(Math.max(0,1-O*O-z*z)),T=new r.Matrix3(R,P*Math.cos(D),I*O,0,P*Math.sin(D),I*z,0,0,I*G)}var k=[new r.Vector3(0,0,0),new r.Vector3(1,0,0),new r.Vector3(0,1,0),new r.Vector3(0,0,1),new r.Vector3(1,1,0),new r.Vector3(0,1,1),new r.Vector3(1,0,1),new r.Vector3(1,1,1)];if(M.matrix4)for(let Z=0;Z<k.length;Z++)M.size&&k[Z].multiplyVectors(k[Z],M.size),k[Z]=k[Z].applyMatrix4(M.matrix4);else for(let Z=0;Z<k.length;Z++)k[Z]=k[Z].applyMatrix3(T);if(S.box&&!S.box.hidden){S.box.wireframe=!0;var $=new f.GLShape(S.box);$.shapePosition=this.shapes.length,$.addLine({start:k[0],end:k[1]}),$.addLine({start:k[0],end:k[2]}),$.addLine({start:k[1],end:k[4]}),$.addLine({start:k[2],end:k[4]}),$.addLine({start:k[0],end:k[3]}),$.addLine({start:k[3],end:k[5]}),$.addLine({start:k[2],end:k[5]}),$.addLine({start:k[1],end:k[6]}),$.addLine({start:k[4],end:k[7]}),$.addLine({start:k[6],end:k[7]}),$.addLine({start:k[3],end:k[6]}),$.addLine({start:k[5],end:k[7]}),this.shapes.push($),_.unitCellObjects.shapes.push($),$.finalize()}if(!S.astyle.hidden){S.astyle.start=k[0],S.astyle.end=k[1];let Z=this.addArrow(S.astyle);_.unitCellObjects.shapes.push(Z)}if(!S.bstyle.hidden){S.bstyle.start=k[0],S.bstyle.end=k[2];let Z=this.addArrow(S.bstyle);_.unitCellObjects.shapes.push(Z)}if(!S.cstyle.hidden){S.cstyle.start=k[0],S.cstyle.end=k[3];let Z=this.addArrow(S.cstyle);_.unitCellObjects.shapes.push(Z)}if(S.alabel){S.alabelstyle.position=k[1];let Z=this.addLabel(S.alabel,S.alabelstyle);_.unitCellObjects.labels.push(Z)}if(S.blabel){S.blabelstyle.position=k[2];let Z=this.addLabel(S.blabel,S.blabelstyle);_.unitCellObjects.labels.push(Z)}if(S.clabel){S.clabelstyle.position=k[3];let Z=this.addLabel(S.clabel,S.clabelstyle);_.unitCellObjects.labels.push(Z)}}}removeUnitCell(_){if(_=this.getModel(_),_.unitCellObjects){let S=this;_.unitCellObjects.shapes.forEach(function(M){S.removeShape(M)}),_.unitCellObjects.labels.forEach(function(M){S.removeLabel(M)})}delete _.unitCellObjects}replicateUnitCell(_=3,S=_,M=S,T,R){T=this.getModel(T);let P=T.getCrystData();if(P){const I=T.selectedAtoms({}),B=P.matrix;let W=function(D){return D%2==0?-D/2:Math.ceil(D/2)};for(let D=0;D<_;D++)for(let O=0;O<S;O++)for(let z=0;z<M;z++){if(D==0&&O==0&&z==0)continue;let G=new r.Vector3(W(D),W(O),W(z));G.applyMatrix3(B);let k=[];for(let $=0;$<I.length;$++){let Z={};for(let K in I[$])Z[K]=I[$][K];Z.x+=G.x,Z.y+=G.y,Z.z+=G.z,k.push(Z)}T.addAtoms(k)}R&&T.assignBonds()}}addLineDashed(_,S){_.dashLength=_.dashLength||.5,_.gapLength=_.gapLength||.5;var M;_.start?M=new r.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):M=new r.Vector3(0,0,0);var T;_.end?T=new r.Vector3(_.end.x,_.end.y||0,_.end.z||0):T=new r.Vector3(0,0,0);var R=new r.Vector3,P=new r.Vector3,I=new r.Vector3,B,W,D,O=M.clone(),z=0;for(R.subVectors(T,M),B=R.length(),R.normalize(),P=R.clone(),I=R.clone(),P.multiplyScalar(_.dashLength),I.multiplyScalar(_.gapLength),W=P.length(),D=I.length();z<B;){if(z+W>B){_.start=M,_.end=T,S.addLine(_);break}O.addVectors(M,P),_.start=M,_.end=O,S.addLine(_),M=O.clone(),z+=W,O.addVectors(M,I),M=O.clone(),z+=D}return S.finalize(),S}addCustom(_){_=_||{};var S=new f.GLShape(_);return S.shapePosition=this.shapes.length,S.addCustom(_),this.shapes.push(S),S.finalize(),S}addVolumetricData(_,S,M={}){var T=new p.VolumeData(_,S);return M.hasOwnProperty("transferfn")?this.addVolumetricRender(T,M):this.addIsosurface(T,M)}addIsosurface(_,S={},M){var T=new f.GLShape(S);return T.shapePosition=this.shapes.length,T.addIsosurface(_,S,M),this.shapes.push(T),T}addVolumetricRender(_,S){S=S||{};var M=new y.GLVolumetricRender(_,S);return M.shapePosition=this.shapes.length,this.shapes.push(M),M}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(_){_?this.scene.fog=new n.Fog(this.bgColor,100,200):(this.config.disableFog=!0,this.show())}setFrame(_){this.viewer_frame=_;let S=this;return new Promise(function(M){var T=S.models.map(function(R){return R.setFrame(_,S)});Promise.all(T).then(function(){M()})})}getFrame(){return this.viewer_frame}getNumFrames(){var _=0;for(let S=0;S<this.models.length;S++)this.models[S].getNumFrames()>_&&(_=this.models[S].getNumFrames());for(let S=0;S<this.shapes.length;S++)this.shapes[S].frame&&this.shapes[S].frame>=_&&(_=this.shapes[S].frame+1);for(let S=0;S<this.labels.length;S++)this.labels[S].frame&&this.labels[S].frame>=_&&(_=this.labels[S].frame+1);return _}animate(_){this.incAnim();var S=100,M="forward",T=0;_=_||{},_.interval&&(S=_.interval),_.loop&&(M=_.loop),_.reps&&(T=_.reps);var R=this.getNumFrames(),P=this,I=0;_.startFrame&&(I=_.startFrame%R);var B=1;_.step&&(B=_.step,T/=B);var W=0,D=R*T,O=new Date,z,G,k=function($){O=new Date,$=="forward"?P.setFrame(I).then(function(){I=(I+B)%R,z()}):$=="backward"?P.setFrame(R-1-I).then(function(){I=(I+B)%R,z()}):P.setFrame(I).then(function(){I+=B,B*=I%(R-1)==0?-1:1,z()})};return z=function(){if(P.render(),!P.getCanvas().isConnected)P.stopAnimate();else if(++W==D||!P.isAnimated())G.cancel(),P.animationTimers.delete(G),P.decAnim();else{var $=S-(new Date().getTime()-O.getTime());$=$>0?$:0,P.animationTimers.delete(G),G=new s.PausableTimer(k,$,M),P.animationTimers.add(G)}},G=new s.PausableTimer(k,0,M),this.animationTimers.add(G),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(_){_.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(_){_.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(_){_.resume()}),this}isAnimated(){return this.animated>0}addModel(_,S="",M){M&&!M.defaultcolors?(M.defaultcolors=this.defaultcolors,M.cartoonQuality=M.cartoonQuality||this.config.cartoonQuality):typeof M>"u"&&(M={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality});var T=new c.GLModel(this.models.length,M);return T.addMolData(_,S,M),this.models.push(T),T}addModels(_,S,M){M=M||{},M.multimodel=!0,M.frames=!0;for(var T=c.GLModel.parseMolData(_,S,M),R=0;R<T.length;R++){var P=new c.GLModel(this.models.length,this.defaultcolors);P.setAtomDefaults(T[R]),P.addFrame(T[R]),P.setFrame(0),T.modelData&&P.setModelData(T.modelData[R]),P.setDontDuplicateAtoms(!M.duplicateAssemblyAtoms),this.models.push(P)}return this.models}addModelsAsFrames(_,S,M){M=M||{},M.multimodel=!0,M.frames=!0;var T=new c.GLModel(this.models.length,this.defaultcolors);return T.addMolData(_,S,M),this.models.push(T),T}addAsOneMolecule(_,S,M){M=M||{},M.multimodel=!0,M.onemol=!0;var T=new c.GLModel(this.models.length,this.defaultcolors);return T.addMolData(_,S,M),this.models.push(T),T}removeModel(_){if(_=this.getModel(_),!!_){for(_.removegl(this.modelGroup),delete this.models[_.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var _=0;_<this.models.length;_++){var S=this.models[_];S&&S.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(_,S){var M={};return S===void 0?M.m=this.models.map(function(T){return T.toCDObject(_)}):M.m=[this.models[S].toCDObject()],JSON.stringify(M)}exportVRML(){var _=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new n.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var S=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=_,S}createModelFrom(_,S=!1){for(var M=new c.GLModel(this.models.length,this.defaultcolors),T=0;T<this.models.length;T++)if(this.models[T]){var R=this.models[T].selectedAtoms(_);M.addAtoms(R),S&&this.models[T].removeAtoms(R)}return this.models.push(M),M}applyToModels(_,S,M,T,R,P,I){for(var B=this.getModelList(S),W=0;W<B.length;W++)B[W][_](S,M,T,R,P,I)}setStyle(_,S){return typeof S>"u"&&(S=_,_={}),this.applyToModels("setStyle",_,S,!1),this}addStyle(_,S){return typeof S>"u"&&(S=_,_={}),this.applyToModels("setStyle",_,S,!0),this}setClickable(_,S,M){return this.applyToModels("setClickable",_,S,M),this}setHoverable(_,S,M,T){return this.applyToModels("setHoverable",_,S,M,T),this}enableContextMenu(_,S){return this.applyToModels("enableContextMenu",_,S),this}vibrate(_,S,M,T){return this.applyToModels("vibrate",_,S,M,this,T),this}setColorByProperty(_,S,M,T){return this.applyToModels("setColorByProperty",_,S,M,T),this}setColorByElement(_,S){return this.applyToModels("setColorByElement",_,S),this}static getAtomsWithin(_,S){var M=[];for(let R=0;R<_.length;R++){var T=_[R];typeof T>"u"||T.x<S[0][0]||T.x>S[1][0]||T.y<S[0][1]||T.y>S[1][1]||T.z<S[0][2]||T.z>S[1][2]||M.push(T)}return M}static volume(_){var S=_[1][0]-_[0][0],M=_[1][1]-_[0][1],T=_[1][2]-_[0][2];return S*M*T}carveUpExtent(_,S,M){let T=[],R={};for(let O=0,z=S.length;O<z;O++)R[S[O].index]=O;let P=function(O){let z=[];for(let G=0,k=O.length;G<k;G++)O[G].index in R&&z.push(R[O[G].index]);return z},I=function(O){let z=[];return z[0]=[O[0][0],O[0][1],O[0][2]],z[1]=[O[1][0],O[1][1],O[1][2]],z},B=function(O){if(h.volume(O)<h.maxVolume)return[O];var z=O[1][0]-O[0][0],G=O[1][1]-O[0][1],k=O[1][2]-O[0][2],$;z>G&&z>k?$=0:G>z&&G>k?$=1:$=2;var Z=I(O),K=I(O),j=(O[1][$]-O[0][$])/2+O[0][$];Z[1][$]=j,K[0][$]=j;var Q=B(Z),le=B(K);return Q.concat(le)},W=B(_),D=6;for(let O=0,z=W.length;O<z;O++){let G=I(W[O]);G[0][0]-=D,G[0][1]-=D,G[0][2]-=D,G[1][0]+=D,G[1][1]+=D,G[1][2]+=D;let k=h.getAtomsWithin(S,G),$=h.getAtomsWithin(M,W[O]);T.push({extent:W[O],atoms:P(k),toshow:P($)})}return T}static generateSurfaceMesh(_,S,M){var T=new n.Geometry(!0),R=T.updateGeoGroup(0),P=[];for(let be=0,ye=_.length;be<ye;be++){var I=_[be];I&&(typeof I.surfaceColor<"u"?P[be]=I.surfaceColor:I.color&&(P[be]=a.CC.color(I.color)))}var B=R.vertexArray,W=S.vertices;for(let be=0,ye=W.length;be<ye;be++){let ce=R.vertices*3;B[ce]=W[be].x,B[ce+1]=W[be].y,B[ce+2]=W[be].z,R.vertices++}var D=R.colorArray;if(M.voldata&&M.volscheme){var O=M.volscheme,z=M.voldata,G=O.range()||[-1,1];for(let be=0,ye=W.length;be<ye;be++){let ce=z.getVal(W[be].x,W[be].y,W[be].z),ue=a.CC.color(O.valueToHex(ce,G)),Ce=be*3;D[Ce]=ue.r,D[Ce+1]=ue.g,D[Ce+2]=ue.b}}else if(P.length>0)for(let be=0,ye=W.length;be<ye;be++){let ce=W[be].atomid,ue=be*3;D[ue]=P[ce].r,D[ue+1]=P[ce].g,D[ue+2]=P[ce].b}var k=S.faces;R.faceidx=k.length,T.initTypedArrays();var $=R.vertexArray,Z=R.normalArray,K,j,Q,le;for(let be=0,ye=k.length;be<ye;be+=3){var he=k[be],ve=k[be+1],re=k[be+2],Ie=he*3,ge=ve*3,Se=re*3;K=new r.Vector3($[Ie],$[Ie+1],$[Ie+2]),j=new r.Vector3($[ge],$[ge+1],$[ge+2]),Q=new r.Vector3($[Se],$[Se+1],$[Se+2]),Q.subVectors(Q,j),K.subVectors(K,j),Q.cross(K),le=Q,le.normalize(),Z[Ie]+=le.x,Z[ge]+=le.x,Z[Se]+=le.x,Z[Ie+1]+=le.y,Z[ge+1]+=le.y,Z[Se+1]+=le.y,Z[Ie+2]+=le.z,Z[ge+2]+=le.z,Z[Se+2]+=le.z}R.faceArray=new Uint16Array(k);var Le=new n.Mesh(T,M);return Le}static generateMeshSyncHelper(_,S,M,T,R,P){var I=new g.ProteinSurface;return I.initparm(S,_!==1,P),I.fillvoxels(R,M),I.buildboundary(),(_==g.SurfaceType.SES||_==g.SurfaceType.MS)&&(I.fastdistancemap(),I.boundingatom(!1),I.fillvoxelswaals(R,M)),I.marchingcube(_),I.getFacesAndVertices(T)}static getMatWithStyle(_){var S=new n.MeshLambertMaterial;S.vertexColors=n.Coloring.VertexColors;for(var M in _)M==="color"||M==="map"||_.hasOwnProperty(M)&&(S[M]=_[M]);return _.opacity!==void 0&&(_.opacity===1?S.transparent=!1:S.transparent=!0),S}addMesh(_){var S={geo:_.geometry,mat:_.material,done:!0,finished:!1},M=this.nextSurfID();return this.surfaces[M]=S,M}static shallowCopy(_){var S=[];let M=_.length;for(let T=0;T<M;T++)S[T]=(0,s.extend)({},_[T]);return S}addSurface(_,S={},M={},T,R,P){let I=this.nextSurfID(),B=null,W=this,D=g.SurfaceType.VDW;typeof _=="string"?h.surfaceTypeMap[_.toUpperCase()]!==void 0?D=h.surfaceTypeMap[_]:console.log("Surface type : "+_+" is not recognized"):typeof _=="number"&&(D=_);var O=null,z=null,G=h.shallowCopy(this.getAtomsFromSel(M));T?O=h.shallowCopy(this.getAtomsFromSel(T)):O=G,(0,s.adjustVolumeStyle)(S);var k=!1,$;for($=0;$<this.models.length;$++)if(this.models[$]){var Z=this.models[$].getSymmetries();if(Z.length>1||Z.length==1&&!Z[0].isIdentity()){k=!0;break}}var K=function(Ie,ge,Se){R?z=h.shallowCopy(W.getAtomsFromSel(R)):z=Se;var Le,be=(0,s.getExtent)(Se,!0);if(S.map&&S.map.prop){var ye=S.map.prop;let We=(0,l.getGradient)(S.map.scheme||S.map.gradient||new l.Gradient.RWB),$e=We.range();$e||($e=(0,s.getPropertyRange)(Se,ye)),S.colorscheme={prop:ye,gradient:We}}for(let We=0,$e=ge.length;We<$e;We++)Le=ge[We],Le.surfaceColor=(0,s.getColorFromStyle)(Le,S);var ce=h.volume(be),ue=W.carveUpExtent(be,ge,Se);if(z&&z.length&&z.length>0){var Ce=(0,s.getExtent)(z,!0),Ve=function(We,$e){var qe=function(H,X){var oe=H.extent,te=oe[1][0]-oe[0][0],Me=oe[1][1]-oe[0][1],Te=oe[1][2]-oe[0][2],q=te-X[2][0];q*=q;var Ee=Me-X[2][1];Ee*=Ee;var Pe=Te-X[2][2];return Pe*=Pe,q+Ee+Pe},et=qe(We,Ce),F=qe($e,Ce);return et-F};ue.sort(Ve)}var ie=[];for(let We=0,$e=ge.length;We<$e;We++)Le=ge[We],ie[We]={x:Le.x,y:Le.y,z:Le.z,serial:We,elem:Le.elem};var ae=!!g.syncSurface;if(ae){var Ae=function($e){return new Promise(function(qe){for(var et=h.generateMeshSyncHelper(D,ue[$e].extent,ue[$e].atoms,ue[$e].toshow,ie,ce),F=(0,f.splitMesh)({vertexArr:et.vertices,faceArr:et.faces}),H=0,X=F.length;H<X;H++){et={vertices:F[H].vertexArr,faces:F[H].faceArr};var oe=h.generateSurfaceMesh(ge,et,B);(0,s.mergeGeos)(Ie.geo,oe)}W.render(),qe()})},De=[];for(let We=0;We<ue.length;We++)De.push(Ae(We));return Promise.all(De).then(function(){return Ie.done=!0,Promise.resolve(I)})}else{var Be=[];D<0&&(D=0);for(let We=0,$e=h.numWorkers;We<$e;We++){var ze=new Worker($3Dmol.SurfaceWorker);Be.push(ze),ze.postMessage({type:-1,atoms:ie,volume:ce})}return new Promise(function(We,$e){var qe=0,et=function(){!Be||!Be.length||Be.forEach(function(oe){oe&&oe.terminate&&oe.terminate()})},F=function(oe){for(var te=(0,f.splitMesh)({vertexArr:oe.data.vertices,faceArr:oe.data.faces}),Me=0,Te=te.length;Me<Te;Me++){var q={vertices:te[Me].vertexArr,faces:te[Me].faceArr},Ee=h.generateSurfaceMesh(ge,q,B);(0,s.mergeGeos)(Ie.geo,Ee)}W.render(),qe++,qe==ue.length&&(Ie.done=!0,et(),We(I))},H=function(oe){et(),console.log(oe.message+" ("+oe.filename+":"+oe.lineno+")"),$e(oe)};for(let oe=0;oe<ue.length;oe++){var X=Be[oe%Be.length];X.onmessage=F,X.onerror=H,X.postMessage({type:D,expandedExtent:ue[oe].extent,extendedAtoms:ue[oe].atoms,atomsToShow:ue[oe].toshow})}})}};S=S||{},B=h.getMatWithStyle(S);var j=[];j.style=S,j.atomsel=M,j.allsel=T,j.focus=R;var Q=null;if(k){var le={},he={};for($=0;$<this.models.length;$++)le[$]=[],he[$]=[];for($=0;$<O.length;$++)le[O[$].model].push(O[$]);for($=0;$<G.length;$++)he[G[$].model].push(G[$]);var ve=[];for($=0;$<this.models.length;$++)he[$].length>0&&(j.push({geo:new n.Geometry(!0),mat:B,done:!1,finished:!1,symmetries:this.models[$].getSymmetries()}),ve.push(K(j[j.length-1],le[$],he[$])));Q=Promise.all(ve)}else j.push({geo:new n.Geometry(!0),mat:B,done:!1,finished:!1,symmetries:[new r.Matrix4]}),Q=K(j[j.length-1],O,G);return this.surfaces[I]=j,Q.surfid=I,P&&typeof P=="function"?(Q.then(function(re){P(re)}),I):Q}setSurfaceMaterialStyle(_,S){if((0,s.adjustVolumeStyle)(S),this.surfaces[_]){var M=this.surfaces[_];M.style=S;for(var T=0;T<M.length;T++){var R=M[T].mat=h.getMatWithStyle(S);if(M[T].mat.side=n.FrontSide,S.color){M[T].mat.color=S.color,M[T].geo.colorsNeedUpdate=!0;const P=a.CC.color(S.color);M[T].geo.setColors(function(){return P})}else if(R.voldata&&R.volscheme){const P=R.volscheme,I=R.voldata,B=a.CC,W=P.range()||[-1,1];M[T].geo.setColors(function(D,O,z){let G=I.getVal(D,O,z);return B.color(P.valueToHex(G,W))})}M[T].finished=!1}}return this}getSurface(_){return this.surfaces[_]}removeSurface(_){for(var S=this.surfaces[_],M=0;M<S.length;M++)S[M]&&S[M].lastGL&&(S[M].geo!==void 0&&S[M].geo.dispose(),S[M].mat!==void 0&&S[M].mat.dispose(),this.modelGroup.remove(S[M].lastGL));return delete this.surfaces[_],this.show(),this}removeAllSurfaces(){for(var _ in this.surfaces)if(this.surfaces.hasOwnProperty(_)){for(var S=this.surfaces[_],M=0;M<S.length;M++)S[M]&&S[M].lastGL&&(S[M].geo!==void 0&&S[M].geo.dispose(),S[M].mat!==void 0&&S[M].mat.dispose(),this.modelGroup.remove(S[M].lastGL));delete this.surfaces[_]}return this.show(),this}jmolMoveTo(){var _=this.modelGroup.position,S="center { "+-_.x+" "+-_.y+" "+-_.z+" }; ",M=this.rotationGroup.quaternion;return S+="moveto .5 quaternion { "+M.x+" "+M.y+" "+M.z+" "+M.w+" };",S}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(_,S){S=S||{};var M=this.getAtomsFromSel(S);if(typeof _=="function")for(let P=0,I=M.length;P<I;P++){let B=M[P];_(B)}else for(let P=0,I=M.length;P<I;P++){var T=M[P];for(let B=0,W=_.length;B<W;B++){let D=_[B];if(D.props)for(var R in D.props)D.props.hasOwnProperty(R)&&this.atomIsSelected(T,D)&&(T.properties||(T.properties={}),T.properties[R]=D.props[R])}}return this}linkViewer(_){return this.linkedViewers.push(_),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(_){this.rotationGroup.position.z=this.CAMERA_Z-_}setAutoEyeSeparation(_,S){var M=this.getPerceivedDistance();return S||(S=5),_||this.camera.position.x>0?this.camera.position.x=M*Math.tan(Math.PI/180*S):this.camera.position.x=-M*Math.tan(Math.PI/180*S),this.camera.lookAt(new r.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(_){this.config.cartoonQuality=_}}h.numWorkers=4,h.maxVolume=64e3,h.surfaceTypeMap={VDW:g.SurfaceType.VDW,MS:g.SurfaceType.MS,SAS:g.SurfaceType.SAS,SES:g.SurfaceType.SES};function v(w,_){if(w=(0,s.getElement)(w),!!w){_=_||{};try{var S=new h(w,_);return S}catch(M){throw"error creating viewer: "+M}}}function C(w,_={},S={}){if(w=(0,s.getElement)(w),!!w){var M=[],T=document.createElement("canvas");S.rows=_.rows,S.cols=_.cols,S.control_all=_.control_all!=null?_.control_all:!1,w.appendChild(T);try{for(var R=0;R<_.rows;R++){for(var P=[],I=0;I<_.cols;I++){S.row=R,S.col=I,S.canvas=T,S.viewers=M,S.control_all=_.control_all;var B=v(w,(0,s.extend)({},S));P.push(B)}M.unshift(P)}}catch(W){throw"error creating viewer grid: "+W}return M}}function x(w){var _=this;if(w=(0,s.getElement)(w),!!w){var S=C(w,{rows:1,cols:2,control_all:!0});this.glviewer1=S[0][0],this.glviewer2=S[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var M=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(R){return typeof _.glviewer1[R]=="function"}),T=0;T<M.length;T++)this[M[T]]=function(R){return function(){var P=this.glviewer1[R].apply(this.glviewer1,arguments),I=this.glviewer2[R].apply(this.glviewer2,arguments);return[P,I]}}(M[T]);this.setCoordinates=function(R,P,I){for(var B=0;B<R.length;B++)R[B].setCoordinates(P,I)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(R){this.glviewer1.render(),this.glviewer2.render(),R&&R(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}},"./src/Gradient.ts":(o,t,e)=>{e.r(t),e.d(t,{CustomLinear:()=>f,Gradient:()=>g,GradientType:()=>r,ROYGB:()=>c,RWB:()=>l,Sinebow:()=>u,builtinGradients:()=>p,getGradient:()=>s,normalizeValue:()=>a});var n=e("./src/colors.ts");class r{}function a(y,E,h){return E>=y?(h<y&&(h=y),h>E&&(h=E),{lo:y,hi:E,val:h}):(h>y&&(h=y),h<E&&(h=E),h=y-h+E,{lo:E,hi:y,val:h})}function s(y){if(y instanceof r)return y;if(y.gradient!==void 0&&p[y.gradient]){let E=y.min===void 0?-1:y.min,h=y.max===void 0?1:y.max;return y.mid===void 0?y.colors===void 0?new p[y.gradient](E,h):new p[y.gradient](E,h,y.colors):new p[y.gradient](E,h,y.mid)}return y}class l extends r{constructor(E,h,v){super(),this.gradient="RWB",this.mult=1,this.mid=v,this.min=E,this.max=h,typeof h>"u"&&Array.isArray(E)&&E.length>=2?(this.max=E[1],this.min=E[0]):E&&h&&!Array.isArray(E)&&(this.min=E,this.max=h)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(E,h){var v,C;if(E=this.mult*E,h?(v=h[0],C=h[1]):(v=this.min,C=this.max),E===void 0)return 16777215;var x=a(v,C,E);v=x.lo,C=x.hi,E=x.val;var w=(C+v)/2;h&&typeof h[2]<"u"?w=h[2]:typeof this.mid<"u"?w=this.mid:w=(v+C)/2;var _,S;return E<w?(_=Math.floor(255*Math.sqrt((E-v)/(w-v))),S=16711680+256*_+_,S):E>w?(_=Math.floor(255*Math.sqrt(1-(E-w)/(C-w))),S=65536*_+256*_+255,S):16777215}}class c extends r{constructor(E,h){super(),this.gradient="ROYGB",this.mult=1,this.min=E,this.max=h,typeof h>"u"&&Array.isArray(E)&&E.length>=2?(this.max=E[1],this.min=E[0]):E&&h&&!Array.isArray(E)&&(this.min=E,this.max=h)}valueToHex(E,h){var v,C;if(E=this.mult*E,h?(v=h[0],C=h[1]):(v=this.min,C=this.max),typeof E>"u")return 16777215;var x=a(v,C,E);v=x.lo,C=x.hi,E=x.val;var w=(v+C)/2,_=(v+w)/2,S=(w+C)/2,M,T;return E<_?(M=Math.floor(255*Math.sqrt((E-v)/(_-v))),T=16711680+256*M+0,T):E<w?(M=Math.floor(255*Math.sqrt(1-(E-_)/(w-_))),T=65536*M+65280+0,T):E<S?(M=Math.floor(255*Math.sqrt((E-w)/(S-w))),T=65280+1*M,T):(M=Math.floor(255*Math.sqrt(1-(E-S)/(C-S))),T=0+256*M+255,T)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class u extends r{constructor(E,h){super(),this.gradient="Sinebow",this.mult=1,this.min=E,this.max=h,typeof h>"u"&&Array.isArray(E)&&E.length>=2&&(this.max=E[1],this.min=E[0]),h<E&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(E,h){var v,C;if(E=this.mult*E,h?(v=h[0],C=h[1]):(v=this.min,C=this.max),typeof E>"u")return 16777215;var x=g.normalizeValue(v,C,E);v=x.lo,C=x.hi,E=x.val;var w=(E-v)/(C-v),_=5*w/6+.5,S=Math.sin(Math.PI*_);S*=S*255;var M=Math.sin(Math.PI*(_+1/3));M*=M*255;var T=Math.sin(Math.PI*(_+2/3));return T*=T*255,65536*Math.floor(S)+256*Math.floor(T)+1*Math.floor(M)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class f extends r{constructor(E,h,v){super(),this.gradient="linear",this.colors=new Array;var C;if(Array.isArray(E)&&E.length>=2?(this.max=E[1],this.min=E[0],C=h):(this.min=E,this.max=h,C=v),C)for(let x of C)this.colors.push(n.CC.color(x));else this.colors.push(n.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(E,h){var v,C;if(h?(v=h[0],C=h[1]):(v=this.min,C=this.max),E===void 0)return 16777215;var x=a(v,C,E);v=x.lo,C=x.hi,E=x.val;let w=this.colors.length,_=(C-v)/w,S=Math.min(Math.floor((E-v)/_),w-1),M=Math.min(S+1,w-1),T=(E-v-S*_)/_,R=this.colors[S],P=this.colors[M];return new n.Color(R.r+T*(P.r-R.r),R.g+T*(P.g-R.g),R.b+T*(P.b-R.b)).getHex()}}const p={rwb:l,RWB:l,roygb:c,ROYGB:c,sinebow:u,linear:f};class g extends r{valueToHex(E,h){return 0}range(){return null}}g.RWB=l,g.ROYGB=c,g.Sinebow=u,g.CustomLinear=f,g.builtinGradients=p,g.normalizeValue=a,g.getGradient=s},"./src/Label.ts":(o,t,e)=>{e.r(t),e.d(t,{Label:()=>u,LabelCount:()=>s});var n=e("./src/WebGL/index.ts"),r=e("./src/Gradient.ts"),a=e("./src/colors.ts");let s=0;function l(f,p,g,y,E,h,v){f.beginPath(),f.moveTo(p+h,g),f.lineTo(p+y-h,g),f.quadraticCurveTo(p+y,g,p+y,g+h),f.lineTo(p+y,g+E-h),f.quadraticCurveTo(p+y,g+E,p+y-h,g+E),f.lineTo(p+h,g+E),f.quadraticCurveTo(p,g+E,p,g+E-h),f.lineTo(p,g+h),f.quadraticCurveTo(p,g,p+h,g),f.closePath(),f.fill(),v&&f.stroke()}function c(f,p,g){var y=g;return typeof f<"u"&&(f instanceof a.Color?y=f.scaled():(y=a.CC.color(f),typeof y.scaled<"u"&&(y=y.scaled()))),typeof p<"u"&&(y.a=parseFloat(p)),y}class u{constructor(p,g){this.id=s++,this.stylespec=g||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new n.Sprite,this.text=p,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}setContext(){var p=this.stylespec,g=typeof p.useScreen>"u"?!1:p.useScreen,y=p.showBackground;(y==="0"||y==="false")&&(y=!1),typeof y>"u"&&(y=!0);var E=p.font?p.font:"sans-serif",h=parseInt(p.fontSize)?parseInt(p.fontSize):18,v=c(p.fontColor,p.fontOpacity,{r:255,g:255,b:255,a:1}),C=p.padding?p.padding:4,x=p.borderThickness?p.borderThickness:0,w=c(p.backgroundColor,p.backgroundOpacity,{r:0,g:0,b:0,a:1}),_=c(p.borderColor,p.borderOpacity,w),S=p.position?p.position:{x:-10,y:1,z:1},M=p.inFront!==void 0?p.inFront:!0;(M==="false"||M==="0")&&(M=!1);var T=p.alignment||n.SpriteAlignment.topLeft;typeof T=="string"&&T in n.SpriteAlignment&&(T=n.SpriteAlignment[T]);var R="";p.bold&&(R="bold "),this.context.font=R+h+"px  "+E;var P=this.context.measureText(this.text),I=P.width;y||(x=0);var B=I+2.5*x+2*C,W=h*1.25+2*x+2*C;if(p.backgroundImage){var D=p.backgroundImage,O=p.backgroundWidth?p.backgroundWidth:D.width,z=p.backgroundHeight?p.backgroundHeight:D.height;O>B&&(B=O),z>W&&(W=z)}if(this.canvas.width=B,this.canvas.height=W,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),R="",p.bold&&(R="bold "),this.context.font=R+h+"px  "+E,this.context.fillStyle="rgba("+w.r+","+w.g+","+w.b+","+w.a+")",this.context.strokeStyle="rgba("+_.r+","+_.g+","+_.b+","+_.a+")",p.backgroundGradient){let k=this.context.createLinearGradient(0,W/2,B,W/2),$=r.Gradient.getGradient(p.backgroundGradient),Z=$.range(),K=-1,j=1;Z&&(K=Z[0],j=Z[1]);let Q=j-K;for(let le=0;le<1.01;le+=.1){let he=c($.valueToHex(K+Q*le)),ve="rgba("+he.r+","+he.g+","+he.b+","+he.a+")";k.addColorStop(le,ve)}this.context.fillStyle=k}this.context.lineWidth=x,y&&l(this.context,x,x,B-2*x,W-2*x,6,x>0),p.backgroundImage&&this.context.drawImage(D,0,0,B,W),this.context.fillStyle="rgba("+v.r+","+v.g+","+v.b+","+v.a+")",this.context.fillText(this.text,x+C,h+x+C,I);var G=new n.Texture(this.canvas);G.needsUpdate=!0,this.sprite.material=new n.SpriteMaterial({map:G,useScreenCoordinates:g,alignment:T,depthTest:!M,screenOffset:p.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(S.x,S.y,S.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts":(o,t,e)=>{e.r(t),e.d(t,{MarchingCube:()=>c,MarchingCubeInitializer:()=>l,PointGrid:()=>u,ProteinSurface:()=>f,SurfaceType:()=>r,setSyncSurface:()=>s,syncSurface:()=>a});var n=e("./src/WebGL/math/index.ts"),r;(function(p){p[p.VDW=1]="VDW",p[p.MS=2]="MS",p[p.SAS=3]="SAS",p[p.SES=4]="SES"})(r||(r={}));var a=!1;function s(p){a=p}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(a=!0);class l{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(g,y,E,h){let v=!!h.fulltable,C=h.hasOwnProperty("origin")&&h.origin.hasOwnProperty("x")?h.origin:{x:0,y:0,z:0},x=!!h.voxel,w=h.matrix,_=h.nX||0,S=h.nY||0,M=h.nZ||0,T=h.scale||1,R=null;h.unitCube?R=h.unitCube:R={x:T,y:T,z:T};let P=new Int32Array(_*S*M),I,B;for(I=0,B=P.length;I<B;++I)P[I]=-1;let W=function(G,k,$,Z,K,j){let Q={x:0,y:0,z:0},le=!!(Z&1<<K),he=!!(Z&1<<j),ve=K;if(!le&&he&&(ve=j),ve&1&&$++,ve&2&&k++,ve&4&&G++,w){let Ie=new n.Vector3(G,k,$);Ie=Ie.applyMatrix4(w),Q={x:Ie.x,y:Ie.y,z:Ie.z}}else Q.x=C.x+R.x*G,Q.y=C.y+R.y*k,Q.z=C.z+R.z*$;let re=(S*G+k)*M+$;return x?(y.push(Q),y.length-1):(P[re]<0&&(P[re]=y.length,y.push(Q)),P[re])},D=new Int32Array(12),O=v?this.edgeTable2:this.edgeTable,z=v?this.triTable2:this.triTable;for(I=0;I<_-1;++I)for(let G=0;G<S-1;++G)for(let k=0;k<M-1;++k){let $=0;for(let j=0;j<8;++j){let Q=(S*(I+((j&4)>>2))+G+((j&2)>>1))*M+k+(j&1),le=!!(g[Q]&this.ISDONE);$|=le<<j}if($===0||$===255)continue;let Z=O[$];if(Z===0)continue;let K=z[$];Z&1&&(D[0]=W(I,G,k,$,0,1)),Z&2&&(D[1]=W(I,G,k,$,1,3)),Z&4&&(D[2]=W(I,G,k,$,3,2)),Z&8&&(D[3]=W(I,G,k,$,2,0)),Z&16&&(D[4]=W(I,G,k,$,4,5)),Z&32&&(D[5]=W(I,G,k,$,5,7)),Z&64&&(D[6]=W(I,G,k,$,7,6)),Z&128&&(D[7]=W(I,G,k,$,6,4)),Z&256&&(D[8]=W(I,G,k,$,0,4)),Z&512&&(D[9]=W(I,G,k,$,1,5)),Z&1024&&(D[10]=W(I,G,k,$,3,7)),Z&2048&&(D[11]=W(I,G,k,$,2,6));for(let j=0;j<K.length;j+=3){let Q=D[K[j]],le=D[K[j+1]],he=D[K[j+2]];x&&j>=3&&(y.push(y[Q]),Q=y.length-1,y.push(y[le]),le=y.length-1,y.push(y[he]),he=y.length-1),E.push(Q),E.push(le),E.push(he)}}}laplacianSmooth(g,y,E){let h=new Array(y.length),v,C,x,w,_;for(v=0,C=y.length;v<C;v++)h[v]={x:0,y:0,z:0};let S=new Array(20),M;for(v=0;v<20;v++)S[v]=new Array(y.length);for(v=0,C=y.length;v<C;v++)S[0][v]=0;for(v=0,C=E.length/3;v<C;v++){let P=v*3,I=v*3+1,B=v*3+2;for(M=!0,x=0,w=S[0][E[P]];x<w;x++)if(E[I]==S[x+1][E[P]]){M=!1;break}for(M&&(S[0][E[P]]++,S[S[0][E[P]]][E[P]]=E[I]),M=!0,x=0,w=S[0][E[P]];x<w;x++)if(E[B]==S[x+1][E[P]]){M=!1;break}for(M&&(S[0][E[P]]++,S[S[0][E[P]]][E[P]]=E[B]),M=!0,x=0,w=S[0][E[I]];x<w;x++)if(E[P]==S[x+1][E[I]]){M=!1;break}for(M&&(S[0][E[I]]++,S[S[0][E[I]]][E[I]]=E[P]),M=!0,x=0,w=S[0][E[I]];x<w;x++)if(E[B]==S[x+1][E[I]]){M=!1;break}for(M&&(S[0][E[I]]++,S[S[0][E[I]]][E[I]]=E[B]),M=!0,x=0;x<S[0][E[B]];x++)if(E[P]==S[x+1][E[B]]){M=!1;break}for(M&&(S[0][E[B]]++,S[S[0][E[B]]][E[B]]=E[P]),M=!0,x=0,w=S[0][E[B]];x<w;x++)if(E[I]==S[x+1][E[B]]){M=!1;break}M&&(S[0][E[B]]++,S[S[0][E[B]]][E[B]]=E[I])}let T=1,R=.5;for(_=0;_<g;_++){for(v=0,C=y.length;v<C;v++)if(S[0][v]<3)h[v].x=y[v].x,h[v].y=y[v].y,h[v].z=y[v].z;else if(S[0][v]==3||S[0][v]==4){for(h[v].x=0,h[v].y=0,h[v].z=0,x=0,w=S[0][v];x<w;x++)h[v].x+=y[S[x+1][v]].x,h[v].y+=y[S[x+1][v]].y,h[v].z+=y[S[x+1][v]].z;h[v].x+=R*y[v].x,h[v].y+=R*y[v].y,h[v].z+=R*y[v].z,h[v].x/=R+S[0][v],h[v].y/=R+S[0][v],h[v].z/=R+S[0][v]}else{for(h[v].x=0,h[v].y=0,h[v].z=0,x=0,w=S[0][v];x<w;x++)h[v].x+=y[S[x+1][v]].x,h[v].y+=y[S[x+1][v]].y,h[v].z+=y[S[x+1][v]].z;h[v].x+=T*y[v].x,h[v].y+=T*y[v].y,h[v].z+=T*y[v].z,h[v].x/=T+S[0][v],h[v].y/=T+S[0][v],h[v].z/=T+S[0][v]}for(v=0,C=y.length;v<C;v++)y[v].x=h[v].x,y[v].y=h[v].y,y[v].z=h[v].z}}}let c=new l;class u{constructor(g,y,E){this.data=new Int32Array(g*y*E*3),this.width=y,this.height=E}set(g,y,E,h){let v=((g*this.width+y)*this.height+E)*3;this.data[v]=h.ix,this.data[v+1]=h.iy,this.data[v+2]=h.iz}get(g,y,E){let h=((g*this.width+y)*this.height+E)*3;return{ix:this.data[h],iy:this.data[h+1],iz:this.data[h+2]}}}class f{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],f.MarchingCube||(f.MarchingCube=new l)}getVDWIndex(g){return!g.elem||typeof this.vdwRadii[g.elem]>"u"?"X":g.elem}getFacesAndVertices(g){let y={};for(let v=0,C=g.length;v<C;v++)y[g[v]]=!0;let E=this.verts;for(let v=0,C=E.length;v<C;v++)E[v].x=E[v].x/this.scaleFactor-this.ptranx,E[v].y=E[v].y/this.scaleFactor-this.ptrany,E[v].z=E[v].z/this.scaleFactor-this.ptranz;let h=[];for(let v=0,C=this.faces.length;v<C;v+=3){let x=this.faces[v],w=this.faces[v+1],_=this.faces[v+2],S=E[x].atomid,M=E[w].atomid,T=E[_].atomid,R=S;M<R&&(R=M),T<R&&(R=T),y[R]&&x!==w&&w!==_&&x!==_&&(h.push(x),h.push(w),h.push(_))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:E,faces:h}}initparm(g,y,E){E>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let h=1/this.scaleFactor*5.5;this.pminx=g[0][0],this.pmaxx=g[1][0],this.pminy=g[0][1],this.pmaxy=g[1][1],this.pminz=g[0][2],this.pmaxz=g[1][2],y?(this.pminx-=this.probeRadius+h,this.pminy-=this.probeRadius+h,this.pminz-=this.probeRadius+h,this.pmaxx+=this.probeRadius+h,this.pmaxy+=this.probeRadius+h,this.pmaxz+=this.probeRadius+h):(this.pminx-=h,this.pminy-=h,this.pminz-=h,this.pmaxx+=h,this.pmaxy+=h,this.pmaxz+=h),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(y),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(g){let y={};for(const E in this.vdwRadii){let h=this.vdwRadii[E];g?y[E]=(h+this.probeRadius)*this.scaleFactor+.5:y[E]=h*this.scaleFactor+.5;let v=y[E]*y[E];this.widxz[E]=Math.floor(y[E])+1,this.depty[E]=new Int32Array(this.widxz[E]*this.widxz[E]);let C=0;for(let x=0;x<this.widxz[E];x++)for(let w=0;w<this.widxz[E];w++){let _=x*x+w*w;if(_>v)this.depty[E][C]=-1;else{let S=Math.sqrt(v-_);this.depty[E][C]=Math.floor(S)}C++}}}fillvoxels(g,y){for(let E=0,h=this.vpBits.length;E<h;E++)this.vpBits[E]=0,this.vpDistance[E]=-1,this.vpAtomID[E]=-1;for(let E in y){let h=g[y[E]];h!==void 0&&this.fillAtom(h,g)}for(let E=0,h=this.vpBits.length;E<h;E++)this.vpBits[E]&this.INOUT&&(this.vpBits[E]|=this.ISDONE)}fillAtom(g,y){let E=Math.floor(.5+this.scaleFactor*(g.x+this.ptranx)),h=Math.floor(.5+this.scaleFactor*(g.y+this.ptrany)),v=Math.floor(.5+this.scaleFactor*(g.z+this.ptranz)),C=this.getVDWIndex(g),x=0,w=this.pWidth*this.pHeight;for(let _=0,S=this.widxz[C];_<S;_++)for(let M=0;M<S;M++){if(this.depty[C][x]!=-1){for(let T=-1;T<2;T++)for(let R=-1;R<2;R++)for(let P=-1;P<2;P++)if(T!==0&&R!==0&&P!==0){let I=T*_,B=P*M;for(let W=0;W<=this.depty[C][x];W++){let D=W*R,O=E+I,z=h+D,G=v+B;if(O<0||z<0||G<0||O>=this.pLength||z>=this.pWidth||G>=this.pHeight)continue;let k=O*w+z*this.pHeight+G;if(!(this.vpBits[k]&this.INOUT))this.vpBits[k]|=this.INOUT,this.vpAtomID[k]=g.serial;else{let $=y[this.vpAtomID[k]];if($.serial!=g.serial){let Z=E+I-Math.floor(.5+this.scaleFactor*($.x+this.ptranx)),K=h+D-Math.floor(.5+this.scaleFactor*($.y+this.ptrany)),j=v+B-Math.floor(.5+this.scaleFactor*($.z+this.ptranz));I*I+D*D+B*B<Z*Z+K*K+j*j&&(this.vpAtomID[k]=g.serial)}}}}}x++}}fillvoxelswaals(g,y){for(let E=0,h=this.vpBits.length;E<h;E++)this.vpBits[E]&=~this.ISDONE;for(let E in y){let h=g[y[E]];h!==void 0&&this.fillAtomWaals(h,g)}}fillAtomWaals(g,y){let E=0,h=Math.floor(.5+this.scaleFactor*(g.x+this.ptranx)),v=Math.floor(.5+this.scaleFactor*(g.y+this.ptrany)),C=Math.floor(.5+this.scaleFactor*(g.z+this.ptranz)),x=this.getVDWIndex(g),w=this.pWidth*this.pHeight;for(let _=0,S=this.widxz[x];_<S;_++)for(let M=0;M<S;M++){if(this.depty[x][E]!=-1){for(let T=-1;T<2;T++)for(let R=-1;R<2;R++)for(let P=-1;P<2;P++)if(T!==0&&R!==0&&P!==0){let I=T*_,B=P*M;for(let W=0;W<=this.depty[x][E];W++){let D=W*R,O=h+I,z=v+D,G=C+B;if(O<0||z<0||G<0||O>=this.pLength||z>=this.pWidth||G>=this.pHeight)continue;let k=O*w+z*this.pHeight+G;if(!(this.vpBits[k]&this.ISDONE))this.vpBits[k]|=this.ISDONE,this.vpAtomID[k]=g.serial;else{let $=y[this.vpAtomID[k]];if($.serial!=g.serial){let Z=h+I-Math.floor(.5+this.scaleFactor*($.x+this.ptranx)),K=v+D-Math.floor(.5+this.scaleFactor*($.y+this.ptrany)),j=C+B-Math.floor(.5+this.scaleFactor*($.z+this.ptranz));I*I+D*D+B*B<Z*Z+K*K+j*j&&(this.vpAtomID[k]=g.serial)}}}}}E++}}buildboundary(){let g=this.pWidth*this.pHeight;for(let y=0;y<this.pLength;y++)for(let E=0;E<this.pHeight;E++)for(let h=0;h<this.pWidth;h++){let v=y*g+h*this.pHeight+E;if(this.vpBits[v]&this.INOUT){let C=0;for(;C<26;){let x=y+this.nb[C][0],w=E+this.nb[C][2],_=h+this.nb[C][1];if(x>-1&&x<this.pLength&&_>-1&&_<this.pWidth&&w>-1&&w<this.pHeight&&!(this.vpBits[x*g+_*this.pHeight+w]&this.INOUT)){this.vpBits[v]|=this.ISBOUND;break}else C++}}}}fastdistancemap(){let g=new u(this.pLength,this.pWidth,this.pHeight),y=this.pWidth*this.pHeight,E=this.cutRadius*this.cutRadius,h=[],v=[],C;for(let _=0;_<this.pLength;_++)for(let S=0;S<this.pWidth;S++)for(let M=0;M<this.pHeight;M++)if(C=_*y+S*this.pHeight+M,this.vpBits[C]&=~this.ISDONE,this.vpBits[C]&this.INOUT&&this.vpBits[C]&this.ISBOUND){let T={ix:_,iy:S,iz:M};g.set(_,S,M,T),h.push(T),this.vpDistance[C]=0,this.vpBits[C]|=this.ISDONE,this.vpBits[C]&=~this.ISBOUND}do{v=this.fastoneshell(h,g),h=[];for(let _=0,S=v.length;_<S;_++)C=y*v[_].ix+this.pHeight*v[_].iy+v[_].iz,this.vpBits[C]&=~this.ISBOUND,this.vpDistance[C]<=1.0404*E&&h.push({ix:v[_].ix,iy:v[_].iy,iz:v[_].iz})}while(h.length!==0);h=[],v=[],g=null;let x=this.scaleFactor-.5;x<0&&(x=0);let w=E-.5/(.1+x);for(let _=0;_<this.pLength;_++)for(let S=0;S<this.pWidth;S++)for(let M=0;M<this.pHeight;M++)C=_*y+S*this.pHeight+M,this.vpBits[C]&=~this.ISBOUND,this.vpBits[C]&this.INOUT&&(!(this.vpBits[C]&this.ISDONE)||this.vpBits[C]&this.ISDONE&&this.vpDistance[C]>=w)&&(this.vpBits[C]|=this.ISBOUND)}fastoneshell(g,y){let E,h,v,C,x,w,_,S,M,T=[];if(g.length===0)return T;let R={ix:-1,iy:-1,iz:-1},P=this.pWidth*this.pHeight;for(let I=0,B=g.length;I<B;I++){E=g[I].ix,h=g[I].iy,v=g[I].iz,S=y.get(E,h,v);for(let W=0;W<6;W++)R.ix=E+this.nb[W][0],R.iy=h+this.nb[W][1],R.iz=v+this.nb[W][2],R.ix<this.pLength&&R.ix>-1&&R.iy<this.pWidth&&R.iy>-1&&R.iz<this.pHeight&&R.iz>-1&&(M=R.ix*P+this.pHeight*R.iy+R.iz,this.vpBits[M]&this.INOUT&&!(this.vpBits[M]&this.ISDONE)?(y.set(R.ix,R.iy,v+this.nb[W][2],S),C=R.ix-S.ix,x=R.iy-S.iy,w=R.iz-S.iz,_=C*C+x*x+w*w,this.vpDistance[M]=_,this.vpBits[M]|=this.ISDONE,this.vpBits[M]|=this.ISBOUND,T.push({ix:R.ix,iy:R.iy,iz:R.iz})):this.vpBits[M]&this.INOUT&&this.vpBits[M]&this.ISDONE&&(C=R.ix-S.ix,x=R.iy-S.iy,w=R.iz-S.iz,_=C*C+x*x+w*w,_<this.vpDistance[M]&&(y.set(R.ix,R.iy,R.iz,S),this.vpDistance[M]=_,this.vpBits[M]&this.ISBOUND||(this.vpBits[M]|=this.ISBOUND,T.push({ix:R.ix,iy:R.iy,iz:R.iz})))))}for(let I=0,B=g.length;I<B;I++){E=g[I].ix,h=g[I].iy,v=g[I].iz,S=y.get(E,h,v);for(let W=6;W<18;W++)R.ix=E+this.nb[W][0],R.iy=h+this.nb[W][1],R.iz=v+this.nb[W][2],R.ix<this.pLength&&R.ix>-1&&R.iy<this.pWidth&&R.iy>-1&&R.iz<this.pHeight&&R.iz>-1&&(M=R.ix*P+this.pHeight*R.iy+R.iz,this.vpBits[M]&this.INOUT&&!(this.vpBits[M]&this.ISDONE)?(y.set(R.ix,R.iy,v+this.nb[W][2],S),C=R.ix-S.ix,x=R.iy-S.iy,w=R.iz-S.iz,_=C*C+x*x+w*w,this.vpDistance[M]=_,this.vpBits[M]|=this.ISDONE,this.vpBits[M]|=this.ISBOUND,T.push({ix:R.ix,iy:R.iy,iz:R.iz})):this.vpBits[M]&this.INOUT&&this.vpBits[M]&this.ISDONE&&(C=R.ix-S.ix,x=R.iy-S.iy,w=R.iz-S.iz,_=C*C+x*x+w*w,_<this.vpDistance[M]&&(y.set(R.ix,R.iy,R.iz,S),this.vpDistance[M]=_,this.vpBits[M]&this.ISBOUND||(this.vpBits[M]|=this.ISBOUND,T.push({ix:R.ix,iy:R.iy,iz:R.iz})))))}for(let I=0,B=g.length;I<B;I++){E=g[I].ix,h=g[I].iy,v=g[I].iz,S=y.get(E,h,v);for(let W=18;W<26;W++)R.ix=E+this.nb[W][0],R.iy=h+this.nb[W][1],R.iz=v+this.nb[W][2],R.ix<this.pLength&&R.ix>-1&&R.iy<this.pWidth&&R.iy>-1&&R.iz<this.pHeight&&R.iz>-1&&(M=R.ix*P+this.pHeight*R.iy+R.iz,this.vpBits[M]&this.INOUT&&!(this.vpBits[M]&this.ISDONE)?(y.set(R.ix,R.iy,v+this.nb[W][2],S),C=R.ix-S.ix,x=R.iy-S.iy,w=R.iz-S.iz,_=C*C+x*x+w*w,this.vpDistance[M]=_,this.vpBits[M]|=this.ISDONE,this.vpBits[M]|=this.ISBOUND,T.push({ix:R.ix,iy:R.iy,iz:R.iz})):this.vpBits[M]&this.INOUT&&this.vpBits[M]&this.ISDONE&&(C=R.ix-S.ix,x=R.iy-S.iy,w=R.iz-S.iz,_=C*C+x*x+w*w,_<this.vpDistance[M]&&(y.set(R.ix,R.iy,R.iz,S),this.vpDistance[M]=_,this.vpBits[M]&this.ISBOUND||(this.vpBits[M]|=this.ISBOUND,T.push({ix:R.ix,iy:R.iy,iz:R.iz})))))}return T}marchingcubeinit(g){for(let y=0,E=this.vpBits.length;y<E;y++)g==1?this.vpBits[y]&=~this.ISBOUND:g==4?(this.vpBits[y]&=~this.ISDONE,this.vpBits[y]&this.ISBOUND&&(this.vpBits[y]|=this.ISDONE),this.vpBits[y]&=~this.ISBOUND):g==2?this.vpBits[y]&this.ISBOUND&&this.vpBits[y]&this.ISDONE?this.vpBits[y]&=~this.ISBOUND:this.vpBits[y]&this.ISBOUND&&!(this.vpBits[y]&this.ISDONE)&&(this.vpBits[y]|=this.ISDONE):g==3&&(this.vpBits[y]&=~this.ISBOUND)}marchingcube(g){this.marchingcubeinit(g),this.verts=[],this.faces=[],f.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let y=this.pWidth*this.pHeight;for(let E=0,h=this.verts.length;E<h;E++)this.verts[E].atomid=this.vpAtomID[this.verts[E].x*y+this.pHeight*this.verts[E].y+this.verts[E].z];f.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}f.MarchingCube=new l},"./src/VolumeData.ts":(o,t,e)=>{e.r(t),e.d(t,{VolumeData:()=>c});var n=e("./src/utilities.ts"),r=e("./src/WebGL/math/index.ts"),a=e("./src/parsers/VASP.ts"),s=e("./src/parsers/CUBE.ts"),l=e("./node_modules/pako/dist/pako.esm.mjs");class c{constructor(f,p,g){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(C){var x=C/(this.size.y*this.size.z),w=C%(this.size.y*this.size.z),_=C%this.size.z;return x*=this.unit.x,w*=this.unit.y,_*=this.unit.z,x+=this.origin.x,w+=this.origin.y,_+=this.origin.z,{x,y:w,z:_}},this.vasp=function(C){var x=C.replace(/^\s+/,"").split(/[\n\r]/),w=(0,a.VASP)(C)[0],_=w.length;if(_==0){console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var S=1.889725992,M=.036749309,T=parseFloat(x[1]),R;R=x[2].replace(/^\s+/,"").split(/\s+/);var P=new r.Vector3(parseFloat(R[0]),parseFloat(R[1]),parseFloat(R[2])).multiplyScalar(T*S);R=x[3].replace(/^\s+/,"").split(/\s+/);var I=new r.Vector3(parseFloat(R[0]),parseFloat(R[1]),parseFloat(R[2])).multiplyScalar(T*S);R=x[4].replace(/^\s+/,"").split(/\s+/);var B=new r.Vector3(parseFloat(R[0]),parseFloat(R[1]),parseFloat(R[2])).multiplyScalar(T*S),W=P.x*(I.y*B.z-B.y*I.z)-I.x*(P.y*B.z-B.y*P.z)+B.x*(P.y*I.z-I.y*P.z);W=Math.abs(W)/Math.pow(S,3);var D=1/W;x.splice(0,8+_+1);var O=x[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),z=Math.abs(parseFloat(O[0])),G=Math.abs(parseFloat(O[1])),k=Math.abs(parseFloat(O[2])),$=this.origin=new r.Vector3(0,0,0);this.size={x:z,y:G,z:k},this.unit=new r.Vector3(P.x,I.y,B.z),P=P.multiplyScalar(1/(S*z)),I=I.multiplyScalar(1/(S*G)),B=B.multiplyScalar(1/(S*k)),(P.y!=0||P.z!=0||I.x!=0||I.z!=0||B.x!=0||B.y!=0)&&(this.matrix=new r.Matrix4(P.x,I.x,B.x,0,P.y,I.y,B.y,0,P.z,I.z,B.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new r.Matrix4().makeTranslation($.x,$.y,$.z)),this.origin=new r.Vector3(0,0,0),this.unit=new r.Vector3(1,1,1)),x.splice(0,1);var Z=x.join(" ");Z=Z.replace(/^\s+/,"");var K=Z.split(/[\s\r]+/);K.splice(z*G*k+1);for(var j=Float32Array.from(K,parseFloat),Q=0;Q<j.length;Q++)j[Q]=j[Q]*D*M;this.data=j},this.dx=function(C){var x=C.split(/[\n\r]+/),w,_=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,S=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,M=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,T=/data follows/,R=0;for(R=0;R<x.length;R++){var P=x[R];if(w=_.exec(P)){var I=parseInt(w[1]),B=parseInt(w[2]),W=parseInt(w[3]);this.size={x:I,y:B,z:W}}else if(w=M.exec(P)){var D=parseFloat(w[1]);if((parseFloat(w[2])!=0||parseFloat(w[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),R+=1,P=x[R],w=M.exec(P),w==null){console.log("Parse error in dx delta matrix");return}var O=parseFloat(w[2]);if((parseFloat(w[1])!=0||parseFloat(w[3])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),R+=1,P=x[R],w=M.exec(P),w==null){console.log("Parse error in dx delta matrix");return}var z=parseFloat(w[3]);(parseFloat(w[1])!=0||parseFloat(w[2])!=0)&&console.log("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new r.Vector3(D,O,z)}else if(w=S.exec(P)){var G=parseFloat(w[1]),k=parseFloat(w[2]),$=parseFloat(w[3]);this.origin=new r.Vector3(G,k,$)}else if(w=T.exec(P))break}if(R+=1,!this.size||!this.origin||!this.unit||!this.size){console.log("Error parsing dx format");return}var Z=x.splice(R).join(" "),K=Z.split(/[\s\r]+/);this.data=Float32Array.from(K,parseFloat)},p=p.toLowerCase(),/\.gz$/.test(p)){p=p.replace(/\.gz$/,"");try{this[p]&&this.isbinary.has(p)?(typeof f=="string"&&(f=(0,n.base64ToArray)(f)),f=(0,l.inflate)(f)):f=new TextDecoder("utf-8").decode((0,l.inflate)(f))}catch(C){console.log(C)}}if(this[p]&&(this.isbinary.has(p)&&typeof f=="string"&&(f=(0,n.base64ToArray)(f)),this[p](f)),g){if(g.negate)for(let C=0,x=this.data.length;C<x;C++)this.data[C]=-this.data[C];if(g.normalize){var y=0;for(let C=0,x=this.data.length;C<x;C++)y+=this.data[C];var E=y/this.data.length;y=0;for(let C=0,x=this.data.length;C<x;C++){var h=this.data[C]-E;y+=h*h}var v=y/this.data.length;for(let C=0,x=this.data.length;C<x;C++)this.data[C]=(this.data[C]-E)/v}}}getIndex(f,p,g){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new r.Matrix4().getInverse(this.matrix));var y=new r.Vector3(f,p,g);y=y.applyMatrix4(this.inversematrix),f=y.x,p=y.y,g=y.z}else f-=this.origin.x,p-=this.origin.y,g-=this.origin.z,f/=this.unit.x,p/=this.unit.y,g/=this.unit.z;return f=Math.round(f),p=Math.round(p),g=Math.round(g),f<0||f>=this.size.x||p<0||p>=this.size.y||g<0||g>=this.size.z?-1:f*this.size.y*this.size.z+p*this.size.z+g}getVal(f,p,g){let y=this.getIndex(f,p,g);return y<0?0:this.data[y]}cube(f){var p=f.split(/\r?\n/);if(!(p.length<6)){var g=(0,s.CUBE)(f,{}).modelData[0].cryst,y=p[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),E=parseFloat(y[0]),h=Math.abs(E);this.origin=g.origin,this.size=g.size,this.unit=g.unit,this.matrix=g.matrix4;var v=6;E<0&&v++;var C=p.splice(h+v).join(" ");C=C.replace(/^\s+/,"");var x=C.split(/[\s\r]+/);this.data=Float32Array.from(x,parseFloat)}}ccp4(f){var p={};f=new Int8Array(f);var g=new Int32Array(f.buffer,0,56),y=new Float32Array(f.buffer,0,56),E=new DataView(f.buffer);if(p.MAP=String.fromCharCode(E.getUint8(208),E.getUint8(209),E.getUint8(210),E.getUint8(211)),p.MACHST=[E.getUint8(212),E.getUint8(213)],p.MACHST[0]===17&&p.MACHST[1]===17)for(var h=f.byteLength,v=0;v<h;v+=4)E.setFloat32(v,E.getFloat32(v),!0);p.NX=g[0],p.NY=g[1],p.NZ=g[2],p.MODE=g[3],p.NXSTART=g[4],p.NYSTART=g[5],p.NZSTART=g[6],p.MX=g[7],p.MY=g[8],p.MZ=g[9],p.xlen=y[10],p.ylen=y[11],p.zlen=y[12],p.alpha=y[13],p.beta=y[14],p.gamma=y[15],p.MAPC=g[16],p.MAPR=g[17],p.MAPS=g[18],p.DMIN=y[19],p.DMAX=y[20],p.DMEAN=y[21],p.ISPG=g[22],p.NSYMBT=g[23],p.LSKFLG=g[24],p.originX=y[49],p.originY=y[50],p.originZ=y[51],p.ARMS=y[54];var C=p,x=[C.xlen,0,0],w=[C.ylen*Math.cos(Math.PI/180*C.gamma),C.ylen*Math.sin(Math.PI/180*C.gamma),0],_=[C.zlen*Math.cos(Math.PI/180*C.beta),C.zlen*(Math.cos(Math.PI/180*C.alpha)-Math.cos(Math.PI/180*C.gamma)*Math.cos(Math.PI/180*C.beta))/Math.sin(Math.PI/180*C.gamma),0];_[2]=Math.sqrt(C.zlen*C.zlen*Math.sin(Math.PI/180*C.beta)*Math.sin(Math.PI/180*C.beta)-_[1]*_[1]);var S=[0,x,w,_],M=[0,C.MX,C.MY,C.MZ],T=[0,C.MAPC,C.MAPR,C.MAPS];this.matrix=new r.Matrix4,this.matrix.set(S[T[1]][0]/M[T[1]],S[T[2]][0]/M[T[2]],S[T[3]][0]/M[T[3]],0,S[T[1]][1]/M[T[1]],S[T[2]][1]/M[T[2]],S[T[3]][1]/M[T[3]],0,S[T[1]][2]/M[T[1]],S[T[2]][2]/M[T[2]],S[T[3]][2]/M[T[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new r.Matrix4().makeTranslation(C.NXSTART+C.originX,C.NYSTART+C.originY,C.NZSTART+C.originZ)),this.origin=new r.Vector3(0,0,0),this.unit=new r.Vector3(1,1,1),this.size={x:p.NX,y:p.NY,z:p.NZ},this.dimensionorder=[p.MAPC,p.MAPR,p.MAPS];var R=new Float32Array(f.buffer,1024+p.NSYMBT),P=p.NX,I=p.NY,B=p.NZ;this.data=new Float32Array(P*I*B);for(let W=0;W<P;W++)for(let D=0;D<I;D++)for(let O=0;O<B;O++)this.data[(W*I+D)*B+O]=R[(O*I+D)*P+W]}}},"./src/VolumetricRender.ts":(o,t,e)=>{e.r(t),e.d(t,{GLVolumetricRender:()=>c});var n=e("./src/WebGL/shapes/index.ts"),r=e("./src/WebGL/math/index.ts"),a=e("./src/WebGL/index.ts"),s=e("./src/colors.ts"),l=e("./src/GLShape.ts");class c{static interpolateArray(f,p){function g(_,S,M){return _+(S-_)*M}var y=[],E=(f.length-1)/(p-1);y[0]=f[0];for(var h=1;h<p-1;h++){var v=h*E,C=Math.floor(v),x=Math.ceil(v),w=v-C;y[h]=g(f[C],f[x],w)}return y[p-1]=f[f.length-1],y}constructor(f,p){this.hidden=!1,this.boundingSphere=new n.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,p=p||{};var g=Object.assign([],p.transferfn);this.subsamples=p.subsamples||5;let y=256;g.forEach(function(P){P.value=parseFloat(P.value)}),g.sort(function(P,I){return P.value-I.value}),this.min=g[0].value,g.length==0&&g.push(g[0]),this.max=g[g.length-1].value;var E,h,v,C,x,w,_,S,M,T;for(let P=0;P<g.length-1;P++)if(v=s.CC.color(g[P].color),C=s.CC.color(g[P+1].color),M=g[P].opacity,T=g[P+1].opacity,E=Math.floor((g[P].value-this.min)*y/(this.max-this.min)),h=Math.floor((g[P+1].value-this.min)*y/(this.max-this.min)),E!=h){x=c.interpolateArray([v.r*255,C.r*255],h-E),w=c.interpolateArray([v.g*255,C.g*255],h-E),_=c.interpolateArray([v.b*255,C.b*255],h-E),S=c.interpolateArray([M*255,T*255],h-E);for(let I=0;I<x.length;I++)this.transferfunctionbuffer.push(x[I]),this.transferfunctionbuffer.push(w[I]),this.transferfunctionbuffer.push(_[I]),this.transferfunctionbuffer.push(S[I])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),f.matrix){let P=new r.Vector3(0,0,0),I=new r.Vector3(f.size.x,f.size.y,f.size.z),B=new r.Vector3(1,1,1);P.applyMatrix4(f.matrix),I.applyMatrix4(f.matrix),B.applyMatrix4(f.matrix).sub(P),this.extent=[[P.x,P.y,P.z],[I.x,I.y,I.z]];for(let z=1;z<7;z++)I.x=z&1?f.size.x:0,I.y=z&2?f.size.y:0,I.z=z&4?f.size.z:0,I.applyMatrix4(f.matrix),this.extent[0][0]=Math.min(this.extent[0][0],I.x),this.extent[0][1]=Math.min(this.extent[0][1],I.y),this.extent[0][2]=Math.min(this.extent[0][2],I.z),this.extent[1][0]=Math.max(this.extent[1][0],I.x),this.extent[1][1]=Math.max(this.extent[1][1],I.y),this.extent[1][2]=Math.max(this.extent[1][2],I.z);let W=I.x-P.x,D=I.y-P.y,O=I.z-P.z;this.maxdepth=Math.sqrt(W*W+D*D+O*O),this.minunit=Math.min(Math.min(B.x,B.y),B.z),this.texmatrix=new r.Matrix4().identity().scale({x:f.size.x,y:f.size.y,z:f.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(f.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new r.Matrix4().identity();let P=f.unit.x*f.size.x,I=f.unit.y*f.size.y,B=f.unit.z*f.size.z;this.texmatrix.makeTranslation(-f.origin.x/P,-f.origin.y/I,-f.origin.z/B),this.texmatrix.scale({x:1/P,y:1/I,z:1/B}),this.minunit=Math.min(Math.min(f.unit.x,f.unit.y),f.unit.z),this.extent=[[f.origin.x,f.origin.y,f.origin.z],[f.origin.x+P,f.origin.y+I,f.origin.z+B]],this.maxdepth=Math.sqrt(P*P+I*I+B*B)}var R=new l.GLShape({});if(R.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=R.finalize(),this.boundingSphere.center=new r.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,p.coords!==void 0&&p.seldist!==void 0){let P=new Uint8Array(f.data.length),I=p.seldist,B=I*I;for(let W=0,D=p.coords.length;W<D;W++){let O=p.coords[W],z=O.x-I,G=O.y-I,k=O.z-I,$=O.x+I,Z=O.y+I,K=O.z+I;if(f.getIndex(z,G,k)>=0||f.getIndex($,Z,K)>=0)for(let j=z;j<$;j+=this.minunit)for(let Q=G;Q<Z;Q+=this.minunit)for(let le=k;le<K;le+=this.minunit){let he=f.getIndex(j,Q,le);he>=0&&!P[he]&&(j-O.x)*(j-O.x)+(Q-O.y)*(Q-O.y)+(le-O.z)*(le-O.z)<B&&(P[he]=1)}}for(let W=0,D=f.data.length;W<D;W++)P[W]==0&&(f.data[W]=1/0)}this.data=f}globj(f){if(this.renderedShapeObj&&(f.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new a.Object3D;var p=null,g=new a.Texture(this.data,!0),y=new a.Texture(this.transferfunctionbuffer,!1);g.needsUpdate=!0,y.needsUpdate=!0,y.flipY=!1,p=new a.VolumetricMaterial({transferfn:y,transfermin:this.min,transfermax:this.max,map:g,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var E=new a.Mesh(this.geo,p);this.shapeObj.add(E),this.renderedShapeObj=this.shapeObj.clone(),f.add(this.renderedShapeObj)}}removegl(f){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),f.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts":(o,t,e)=>{e.r(t),e.d(t,{Camera:()=>a});var n=e("./src/WebGL/core/index.ts"),r=e("./src/WebGL/math/index.ts");class a extends n.Object3D{constructor(l=50,c=1,u=.1,f=2e3,p=!1){super(),this.projectionMatrix=new r.Matrix4,this.projectionMatrixInverse=new r.Matrix4,this.matrixWorldInverse=new r.Matrix4,this.fov=l,this.aspect=c,this.near=u,this.far=f;var g=this.position.z;this.right=g*Math.tan(Math.PI/180*l),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!p,this.updateProjectionMatrix()}lookAt(l){this.matrix.lookAt(this.position,l,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof r.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts":(o,t,e)=>{e.r(t),e.d(t,{Fog:()=>r});var n=e("./src/colors.ts");class r{constructor(s,l=1,c=1e3){this.name="",this.color=new n.Color(s),this.near=l,this.far=c}clone(){return new r(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts":(o,t,e)=>{e.r(t),e.d(t,{Renderer:()=>y});var n=e("./src/WebGL/Camera.ts"),r=e("./src/WebGL/constants/Sides.ts"),a=e("./src/WebGL/constants/TextureConstants.ts"),s=e("./src/WebGL/core/index.ts"),l=e("./src/colors.ts"),c=e("./src/WebGL/materials/index.ts"),u=e("./src/WebGL/math/index.ts"),f=e("./src/WebGL/objects/index.ts"),p=e("./src/WebGL/shaders/index.ts"),g=e("./src/WebGL/SpritePlugin.ts");class y{constructor(h){this.context=null,this.devicePixelRatio=1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._projScreenMatrix=new u.Matrix4,this._vector3=new u.Vector3,this._worldInverse=new u.Matrix4,this._projInverse=new u.Matrix4,this._textureMatrix=new u.Matrix4,this._direction=new u.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new g.SpritePlugin,this._screenshader=null,this._vertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,h=h||{},this.row=h.row,this.col=h.col,this.rows=h.rows,this.cols=h.cols,this._canvas=h.canvas!==void 0?h.canvas:document.createElement("canvas"),this._precision=h.precision!==void 0?h.precision:"highp",this._alpha=h.alpha!==void 0?h.alpha:!0,this._premultipliedAlpha=h.premultipliedAlpha!==void 0?h.premultipliedAlpha:!0,this._antialias=h.antialias!==void 0?h.antialias:!1,this._stencil=h.stencil!==void 0?h.stencil:!0,this._preserveDrawingBuffer=h.preserveDrawingBuffer!==void 0?h.preserveDrawingBuffer:!1,this._clearColor=h.clearColor!==void 0?new l.Color(h.clearColor):new l.Color(0),this._clearAlpha=h.clearAlpha!==void 0?h.clearAlpha:0,this._outlineMaterial=new c.MeshOutlineMaterial(h.outline),this._outlineSphereImposterMaterial=new c.SphereImposterOutlineMaterial(h.outline),this._outlineStickImposterMaterial=new c.StickImposterOutlineMaterial(h.outline),this._outlineEnabled=!!h.outline,this.domElement=this._canvas,this._canvas.id=h.id,this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this)}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}isLost(){return this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(h,v){this._clearColor.setHex(h),this._clearAlpha=v,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(h){this._outlineMaterial=new c.MeshOutlineMaterial(h),this._outlineSphereImposterMaterial=new c.SphereImposterOutlineMaterial(h),this._outlineStickImposterMaterial=new c.StickImposterOutlineMaterial(h),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}setViewport(){if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var h=this._canvas.width/this.cols,v=this._canvas.height/this.rows;this._viewportWidth=h,this._viewportHeight=v,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(h*this.col,v*this.row,h,v),this._gl.viewport(h*this.col,v*this.row,h,v)}}setSize(h,v){if(this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._antialias&&this.devicePixelRatio<2&&(this.devicePixelRatio*=2),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var C=h/this.cols,x=v/this.rows;this._canvas.width=h*this.devicePixelRatio,this._canvas.height=v*this.devicePixelRatio,this._viewportWidth=C*this.devicePixelRatio,this._viewportHeight=x*this.devicePixelRatio,this._canvas.style.width=h+"px",this._canvas.style.height=v+"px",this.setViewport()}else this._viewportWidth=this._canvas.width=h*this.devicePixelRatio,this._viewportHeight=this._canvas.height=v*this.devicePixelRatio,this._canvas.style.width=h+"px",this._canvas.style.height=v+"px",this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);this.initFrameBuffer()}clear(h,v,C){var x=0;(h===void 0||h)&&(x|=this._gl.COLOR_BUFFER_BIT),(v===void 0||v)&&(x|=this._gl.DEPTH_BUFFER_BIT),(C===void 0||C)&&(x|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(x)}clearTarget(h,v,C){this.clear(h,v,C)}setMaterialFaces(h,v){var C=h.side===r.DoubleSide,x=h.side===r.BackSide;h.imposter||(x=v?!x:x),this._oldDoubleSided!==C&&(C?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=C),this._oldFlipSided!==x&&(x?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=x),this._gl.cullFace(this._gl.BACK)}setDepthTest(h){this._oldDepthTest!==h&&(h?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=h)}setDepthWrite(h){this._oldDepthWrite!==h&&(this._gl.depthMask(h),this._oldDepthWrite=h)}setBlending(h){h?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(h,v,C,x){h.addEventListener("dispose",this.onMaterialDispose.bind(this));var w,_;if(_=h.shaderID,_){var S=p.ShaderLib[_];h.vertexShader=S.vertexShader,h.fragmentShader=S.fragmentShader,h.uniforms=p.ShaderUtils.clone(S.uniforms)}w={wireframe:h.wireframe,fragdepth:h.imposter,volumetric:h.volumetric},h.program=this.buildProgram(h.fragmentShader,h.vertexShader,h.uniforms,w)}renderBuffer(h,v,C,x,w,_){if(x.visible){var S,M;if(S=this.setProgram(h,v,C,x,_,this),!!S){M=S.attributes;var T=!1,R=x.wireframe?1:0,P=w.id*16777215+S.id*2+R;P!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=P,T=!0),T&&(this.disableAttributes(),M.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglVertexBuffer),this.enableAttribute(M.position),this._gl.vertexAttribPointer(M.position,3,this._gl.FLOAT,!1,0,0)),M.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglColorBuffer),this.enableAttribute(M.color),this._gl.vertexAttribPointer(M.color,3,this._gl.FLOAT,!1,0,0)),M.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglNormalBuffer),this.enableAttribute(M.normal),this._gl.vertexAttribPointer(M.normal,3,this._gl.FLOAT,!1,0,0)),M.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglOffsetBuffer),this.enableAttribute(M.offset),this._gl.vertexAttribPointer(M.offset,3,this._gl.FLOAT,!1,0,0)),M.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglRadiusBuffer),this.enableAttribute(M.radius),this._gl.vertexAttribPointer(M.radius,1,this._gl.FLOAT,!1,0,0)));var I,B;if(_ instanceof f.Mesh){if(x.shaderID==="instanced"){var W=x.sphere.geometryGroups[0];T&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,W.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,W.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,W.faceArray,this._gl.STATIC_DRAW)),I=W.faceidx,this._extInstanced.vertexAttribDivisorANGLE(M.offset,1),this._extInstanced.vertexAttribDivisorANGLE(M.radius,1),this._extInstanced.vertexAttribDivisorANGLE(M.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,I,this._gl.UNSIGNED_SHORT,0,w.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(M.offset,0),this._extInstanced.vertexAttribDivisorANGLE(M.radius,0),this._extInstanced.vertexAttribDivisorANGLE(M.color,0)}else x.wireframe?(B=w.lineidx,this.setLineWidth(x.wireframeLinewidth),T&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,B,this._gl.UNSIGNED_SHORT,0)):(I=w.faceidx,T&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,I,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=I,this.info.render.faces+=I/3}else _ instanceof f.Line&&(B=w.vertices,this.setLineWidth(x.linewidth),this._gl.drawArrays(this._gl.LINES,0,B),this.info.render.calls++)}}}render(h,v,C){if(!(v instanceof n.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var x,w,_,S,M,T=h.__lights,R=h.fog;this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&h.updateMatrixWorld(),v.parent===void 0&&v.updateMatrixWorld(),v.matrixWorldInverse.getInverse(v.matrixWorld),this._projScreenMatrix.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(h),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),(this.autoClear||C)&&(this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)),M=h.__webglObjects;var P=!1;for(x=0,w=M.length;x<w;x++)_=M[x],S=_.object,_.render=!1,S.visible&&(this.setupMatrices(S,v),this.unrollBufferMaterial(_),_.render=!0,_.volumetric&&(P=!0));var I=null;this.setBlending(!1),this.renderObjects(h.__webglObjects,!0,"opaque",v,T,R,!1,I),this.renderSprites(h,v,!1),this.renderObjects(h.__webglObjects,!0,"blank",v,T,R,!0,I),this.renderObjects(h.__webglObjects,!1,"transparent",v,T,R,!0,I),P&&this._fb&&(this.reinitFrameBuffer(),this.renderObjects(h.__webglObjects,!1,"volumetric",v,T,R,!0,I)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(h,v,!0)}reinitFrameBuffer(){this.isWebGL1()||(this._fb=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0))}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let h=this._viewportWidth,v=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,h,v),this._gl.viewport(0,0,h,v),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,h,v,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,h,v,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let h=this._viewportWidth,v=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,h,v),this._gl.viewport(0,0,h,v),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var C=p.ShaderLib.screen;this._screenshader=this.buildProgram(C.fragmentShader,C.vertexShader,C.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var x=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(x),this._gl.STATIC_DRAW)}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(h){if(h.__webglObjects||(h.__webglObjects=[],h.__webglObjectsImmediate=[],h.__webglSprites=[],h.__webglFlares=[]),h.__objectsAdded.length){for(;h.__objectsAdded.length;)this.addObject(h.__objectsAdded[0],h),h.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;h.__objectsRemoved.length;)this.removeObject(h.__objectsRemoved[0],h),h.__objectsRemoved.splice(0,1);for(var v=0,C=h.__webglObjects.length;v<C;v++)this.updateObject(h.__webglObjects[v].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(h,v){(h==null||v==null)&&(h=this._canvas.width,v=this._canvas.height);var C=h/v;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var x=h/this.cols,w=v/this.rows;C=x/w}return C}setTexture(h,v,C){if(h.needsUpdate){h.__webglInit||(h.__webglInit=!0,h.addEventListener("dispose",this.onTextureDispose.bind(this)),h.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+v);var x=C?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(x,h.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,h.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,h.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,h.unpackAlignment);var w=this.paramToGL(h.format),_=this.paramToGL(h.type);if(C)this.setTextureParameters(this._gl.TEXTURE_3D,h),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,h.image.size.z,h.image.size.y,h.image.size.x,0,this._gl.RED,this._gl.FLOAT,h.image.data);else{var S=h.image,M=S.width,T=S.height;typeof M>"u"&&(M=S.length,w==this._gl.RGBA&&(M/=4),T=1),this.setTextureParameters(this._gl.TEXTURE_2D,h),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,w,w,_,h.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,w,M,T,0,w,_,h.image)}h.needsUpdate=!1,h.onUpdate&&h.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+v),C?this._gl.bindTexture(this._gl.TEXTURE_3D,h.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,h.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(h){this._enabledAttributes[h]||(this._gl.enableVertexAttribArray(h),this._enabledAttributes[h]=!0)}disableAttributes(){for(let h in this._enabledAttributes)this._enabledAttributes[h]&&(this._gl.disableVertexAttribArray(h),this._enabledAttributes[h]=!1)}setPolygonOffset(h,v,C){this._oldPolygonOffset!==h&&(h?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(h){h!==this._oldLineWidth&&(this._gl.lineWidth(h),this._oldLineWidth=h)}deallocateGeometry(h){if(h.__webglInit=void 0,h.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(h.__webglVertexBuffer),h.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(h.__webglColorBuffer),h.geometryGroups!==void 0)for(var v=0,C=h.groups;v<C;v++){var x=h.geometryGroups[v];x.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(x.__webglVertexBuffer),x.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(x.__webglColorBuffer),x.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(x.__webglNormalBuffer),x.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(x.__webglFaceBuffer),x.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(x.__webglLineBuffer)}}deallocateMaterial(h){var v=h.program;if(v!==void 0){h.program=void 0;var C,x,w,_=!1;for(C=0,x=this._programs.length;C<x;C++)if(w=this._programs[C],w.program===v){w.usedTimes--,w.usedTimes===0&&(_=!0);break}if(_===!0){var S=[];for(C=0,x=this._programs.length;C<x;C++)w=this._programs[C],w.program!==v&&S.push(w);this._programs=S,this._gl.deleteProgram(v),this.info.memory.programs--}}}deallocateTexture(h){if(h.image&&h.image.__webglTextureCube)this._gl.deleteTexture(h.image.__webglTextureCube);else{if(!h.__webglInit)return;h.__webglInit=!1,this._gl.deleteTexture(h.__webglTexture)}}onGeometryDispose(h){var v=h.target;v.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(v),this.info.memory.geometries--}onTextureDispose(h){var v=h.target;v.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(v),this.info.memory.textures--}onMaterialDispose(h){var v=h.target;v.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(v)}getShader(h,v){var C;return!this.isWebGL1()&&!v.startsWith("#version")&&(v=v.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),h=="fragment"?v=v.replace(/varying/g,"in"):v=v.replace(/varying/g,"out"),v=v.replace(/attribute/g,"in"),v=v.replace(/texture2D/g,"texture"),v=v.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),v=v.replace(/gl_FragColor/g,"glFragColor"),v=`#version 300 es
`+v),h==="fragment"?C=this._gl.createShader(this._gl.FRAGMENT_SHADER):h==="vertex"&&(C=this._gl.createShader(this._gl.VERTEX_SHADER)),C==null?null:(this._gl.shaderSource(C,v),this._gl.compileShader(C),this._gl.getShaderParameter(C,this._gl.COMPILE_STATUS)?C:(console.error(this._gl.getShaderInfoLog(C)),console.error("could not initialize shader"),null))}buildProgram(h,v,C,x){var w,_,S,M,T=[];T.push(h),T.push(v);for(w in x)T.push(w),T.push(x[w]);for(M=T.join(),w=0,_=this._programs.length;w<_;w++){var R=this._programs[w];if(R.code===M)return R.usedTimes++,R.program}if(this.isWebGL1()&&x.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(S=this._gl.createProgram(),S==null)return null;var P=this._precision,I="precision "+P+" float;",B=[x.volumetric?"#version 300 es":"",I].join(`
`),W=[x.volumetric?"#version 300 es":"",x.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",x.wireframe?"#define WIREFRAME 1":"",I].join(`
`),D=this.getShader("fragment",W+h),O=this.getShader("vertex",B+v);O!=null&&this._gl.attachShader(S,O),D!=null&&this._gl.attachShader(S,D),this._gl.linkProgram(S),this._gl.getProgramParameter(S,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),S.uniforms={},S.attributes={};var z,G,k;z=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"];for(G in C)z.push(G);for(k=0;k<z.length;k++){var $=z[k];S.uniforms[$]=this._gl.getUniformLocation(S,$)}for(z=["position","normal","color","lineDistance","offset","radius"],k=0;k<z.length;k++){var Z=z[k];S.attributes[Z]=this._gl.getAttribLocation(S,Z)}return S.id=this._programs_counter++,this._programs.push({program:S,code:M,usedTimes:1}),this.info.memory.programs=this._programs.length,S}setProgram(h,v,C,x,w,_){if(x.needsUpdate&&(x.program&&this.deallocateMaterial(x),this.initMaterial(x,v,C,w),x.needsUpdate=!1),x.program==null)return null;var S=!1,M=x.program,T=M.uniforms,R=x.uniforms;if(M!=this._currentProgram&&(this._gl.useProgram(M),this._currentProgram=M,S=!0),x.id!=this._currentMaterialId&&(this._currentMaterialId=x.id,S=!0),h!=this._currentCamera&&(this._currentCamera=h,S=!0),this._gl.uniformMatrix4fv(T.projectionMatrix,!1,h.projectionMatrix.elements),this._gl.uniformMatrix4fv(T.modelViewMatrix,!1,w._modelViewMatrix.elements),this._gl.uniformMatrix3fv(T.normalMatrix,!1,w._normalMatrix.elements),S){if(R.fogColor.value=C.color,R.fogNear.value=C.near,R.fogFar.value=C.far,x.shaderID.startsWith("lambert")||x.shaderID==="instanced"||x.shaderID.endsWith("imposter"))this._gl.uniformMatrix4fv(T.viewMatrix,!1,h.matrixWorldInverse.elements),this._lightsNeedUpdate&&(this.setupLights(M,v),this._lightsNeedUpdate=!1),R.directionalLightColor.value=this._lights.directional.colors,R.directionalLightDirection.value=this._lights.directional.positions;else if(x.shaderID.endsWith("outline"))R.outlineColor.value=x.outlineColor,R.outlineWidth.value=x.outlineWidth,R.outlinePushback.value=x.outlinePushback;else if(x.shaderID==="volumetric"){w._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(w._modelViewMatrix),this._projInverse.getInverse(h.projectionMatrix),this._textureMatrix.multiplyMatrices(w.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(T.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(T.projinv,!1,this._projInverse.elements);let P=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);R.step.value=w.material.unit*P,R.maxdepth.value=w.material.maxdepth*P,R.transfermax.value=w.material.transfermax,R.transfermin.value=w.material.transfermin,R.subsamples.value=w.material.subsamples,_.setTexture(w.material.transferfn,4,!1),_.setTexture(w.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}R.opacity.value=x.opacity,this.loadMaterialUniforms(T,R)}return M}loadMaterialUniforms(h,v){var C,x,w,_;for(C in v)h[C]&&(x=v[C].type,w=v[C].value,_=h[C],x==="f"?this._gl.uniform1f(_,w):x==="i"?this._gl.uniform1i(_,w):x==="fv"?this._gl.uniform3fv(_,w):x==="c"?this._gl.uniform3f(_,w.r,w.g,w.b):x==="f4"&&this._gl.uniform4f(_,w[0],w[1],w[2],w[3]))}addObject(h,v){var C,x,w,_;if(!h.__webglInit&&(h.__webglInit=!0,h._modelViewMatrix=new u.Matrix4,h._normalMatrix=new u.Matrix3,h.geometry!==void 0&&h.geometry.__webglInit===void 0&&(h.geometry.__webglInit=!0,h.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),h instanceof f.Mesh||h instanceof f.Line))for(w=h.geometry,C=0,x=w.geometryGroups.length;C<x;C++)_=w.geometryGroups[C],_.id=this._geometryGroupCounter++,_.__webglVertexBuffer||(h instanceof f.Mesh?(this.createMeshBuffers(_),w.elementsNeedUpdate=!0,w.normalsNeedUpdate=!0):h instanceof f.Line&&this.createLineBuffers(_),w.verticesNeedUpdate=!0,w.colorsNeedUpdate=!0);if(!h.__webglActive){if(h instanceof f.Mesh||h instanceof f.Line)for(w=h.geometry,C=0,x=w.geometryGroups.length;C<x;C++)_=w.geometryGroups[C],this.addBuffer(v.__webglObjects,_,h);else h instanceof f.Sprite&&v.__webglSprites.push(h);h.__webglActive=!0}}updateObject(h){var v=h.geometry,C;if(h instanceof f.Mesh||h instanceof f.Line){for(var x=0,w=v.geometryGroups.length;x<w;x++)C=v.geometryGroups[x],(v.verticesNeedUpdate||v.elementsNeedUpdate||v.colorsNeedUpdate||v.normalsNeedUpdate)&&this.setBuffers(C,this._gl.STATIC_DRAW);v.verticesNeedUpdate=!1,v.elementsNeedUpdate=!1,v.normalsNeedUpdate=!1,v.colorsNeedUpdate=!1,v.buffersNeedUpdate=!1}}removeObject(h,v){h instanceof f.Mesh||h instanceof f.Line?this.removeInstances(v.__webglObjects,h):h instanceof f.Sprite&&this.removeInstancesDirect(v.__webglSprites,h),h.__webglActive=!1}removeInstances(h,v){for(var C=h.length-1;C>=0;--C)h[C].object===v&&h.splice(C,1)}removeInstancesDirect(h,v){for(var C=h.length-1;C>=0;--C)h[C]===v&&h.splice(C,1)}unrollBufferMaterial(h){var v=h.object,C=v.material;if(C.volumetric)h.opaque=null,h.transparent=null,h.volumetric=C;else if(C.transparent){if(h.opaque=null,h.volumetric=null,h.transparent=C,!C.wireframe){var x=C.clone();x.opacity=0,h.blank=x}}else h.opaque=C,h.transparent=null,h.volumetric=null}setBuffers(h,v){var C=h.vertexArray,x=h.colorArray;if(h.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,h.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,C,v)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,h.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,C,v)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,h.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,x,v),h.normalArray&&h.__webglNormalBuffer!==void 0){var w=h.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,h.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,w,v)}if(h.radiusArray&&h.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,h.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h.radiusArray,v)),h.faceArray&&h.__webglFaceBuffer!==void 0){var _=h.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,h.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,_,v)}if(h.lineArray&&h.__webglLineBuffer!==void 0){var S=h.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,h.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,S,v)}}createMeshBuffers(h){h.radiusArray&&(h.__webglRadiusBuffer=this._gl.createBuffer()),h.useOffset&&(h.__webglOffsetBuffer=this._gl.createBuffer()),h.__webglVertexBuffer=this._gl.createBuffer(),h.__webglNormalBuffer=this._gl.createBuffer(),h.__webglColorBuffer=this._gl.createBuffer(),h.__webglFaceBuffer=this._gl.createBuffer(),h.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(h){h.__webglVertexBuffer=this._gl.createBuffer(),h.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(h,v,C){h.push({buffer:v,object:C,opaque:null,transparent:null})}setupMatrices(h,v){h._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,h.matrixWorld),h._normalMatrix.getInverse(h._modelViewMatrix),h._normalMatrix.transpose()}filterFallback(h){return this._gl.LINEAR}setTextureParameters(h,v){h==this._gl.TEXTURE_2D?(this._gl.texParameteri(h,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(h,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(h,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(v.magFilter)),this._gl.texParameteri(h,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(v.minFilter))):(this._gl.texParameteri(h,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(h,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(h,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(h,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(h,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(h,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(h,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(h){return h===a.UnsignedByteType?this._gl.UNSIGNED_BYTE:h===a.RGBAFormat?this._gl.RGBA:h===a.NearestFilter?this._gl.NEAREST:0}setupLights(h,v){var C,x,w,_=0,S=0,M=0,T,R,P=this._lights,I=P.directional.colors,B=P.directional.positions,W=0,D=0;for(C=0,x=v.length;C<x;C++)if(w=v[C],T=w.color,R=w.intensity,w instanceof s.Light){if(this._direction.getPositionFromMatrix(w.matrixWorld),this._vector3.getPositionFromMatrix(w.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;B[D]=this._direction.x,B[D+1]=this._direction.y,B[D+2]=this._direction.z,I[D]=T.r*R,I[D+1]=T.g*R,I[D+2]=T.b*R,D+=3,W++}P.ambient[0]=_,P.ambient[1]=S,P.ambient[2]=M,P.directional.length=W}initGL(){try{if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var h=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(h[6])}catch(v){console.error(v)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearColor(0,0,0,1),this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(h,v,C,x,w,_,S,I){var T,R,P,I,B,W,D;v?(B=h.length-1,W=-1,D=-1):(B=0,W=h.length,D=1);for(var O=B;O!==W;O+=D)if(T=h[O],T.render){if(R=T.object,P=T.buffer,I=T[C],!I)continue;S&&this.setBlending(!0),this.setDepthTest(I.depthTest),this.setDepthWrite(I.depthWrite),this.setPolygonOffset(I.polygonOffset,I.polygonOffsetFactor,I.polygonOffsetUnits);var z=R._modelViewMatrix.isReflected();this.setMaterialFaces(I,z),this.renderBuffer(x,w,_,I,P,R),(this._outlineEnabled||I.outline)&&(I.shaderID=="sphereimposter"?this.renderBuffer(x,w,_,this._outlineSphereImposterMaterial,P,R):I.shaderID=="stickimposter"?this.renderBuffer(x,w,_,this._outlineStickImposterMaterial,P,R):!I.wireframe&&I.shaderID!=="basic"&&I.opacity!==0&&this.renderBuffer(x,w,_,this._outlineMaterial,P,R))}}renderSprites(h,v,C){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(h,v,this._currentWidth,this._currentHeight,C),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts":(o,t,e)=>{e.r(t),e.d(t,{SpritePlugin:()=>r});var n=e("./src/WebGL/shaders/index.ts");class r{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(l){this.gl=l.context,this.renderer=l,this.precision=l.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var c=0;this.sprite.vertices[c++]=-1,this.sprite.vertices[c++]=-1,this.sprite.vertices[c++]=0,this.sprite.vertices[c++]=0,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=-1,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=0,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=-1,this.sprite.vertices[c++]=1,this.sprite.vertices[c++]=0,this.sprite.vertices[c++]=1,c=0,this.sprite.faces[c++]=0,this.sprite.faces[c++]=1,this.sprite.faces[c++]=2,this.sprite.faces[c++]=0,this.sprite.faces[c++]=2,this.sprite.faces[c++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(n.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const u={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),u.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),u.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),u.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),u.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),u.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),u.color=this.gl.getUniformLocation(this.sprite.program,"color"),u.map=this.gl.getUniformLocation(this.sprite.program,"map"),u.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),u.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),u.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),u.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),u.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),u.fogType=this.gl.getUniformLocation(this.sprite.program,"fogType"),u.fogDensity=this.gl.getUniformLocation(this.sprite.program,"fogDensity"),u.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),u.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),u.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),u.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=u}render(l,c,u,f,p){var g,y,E,h,v,C,x,w,_,S;if(!this.gl)throw new Error("WebGLRenderer not initialized");let M=[];(g=l==null?void 0:l.__webglSprites)===null||g===void 0||g.forEach(le=>{(p&&le.material.depthTest==!1||!p&&le.material.depthTest)&&M.push(le)});let T=M.length;if(!T)return;const R=this.sprite.attributes,P=this.sprite.uniforms;if(!P)throw new Error("Uniforms not defined");var I=u*.5,B=f*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(R.position),this.gl.enableVertexAttribArray(R.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(R.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(R.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(P.projectionMatrix,!1,c.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(P.map,0);var W=0,D=0,O=l.fog;O?(this.gl.uniform3f(P.fogColor,O.color.r,O.color.g,O.color.b),this.gl.uniform1f(P.fogNear,O.near),this.gl.uniform1f(P.fogFar,O.far),this.gl.uniform1i(P.fogType,1),W=1,D=1):(this.gl.uniform1i(P.fogType,0),W=0,D=0);var z;let G,k,$,Z,K=[];for(z=0;z<T;z++)G=M[z],k=G.material,k&&(k.depthTest==!1&&!p||!G.visible||k.opacity===0||(k.useScreenCoordinates?G.z=-G.position.z:(G._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,G.matrixWorld),G.z=-G._modelViewMatrix.elements[14])));for(M.sort(a),z=0;z<T;z++)if(G=M[z],k=G.material,!!k&&!(!G.visible||k.opacity===0)&&k.map&&k.map.image&&k.map.image.width){this.gl.uniform1f((P==null?void 0:P.alphaTest)||null,k.alphaTest);var j=k.map.image.width,Q=k.map.image.height;K[0]=j*this.renderer.devicePixelRatio/u,K[1]=Q*this.renderer.devicePixelRatio/f,k.useScreenCoordinates===!0?(this.gl.uniform1i(P.useScreenCoordinates,1),this.gl.uniform3f(P.screenPosition,(G.position.x*this.renderer.devicePixelRatio-I)/I,(B-G.position.y*this.renderer.devicePixelRatio)/B,Math.max(0,Math.min(1,G.position.z)))):(this.gl.uniform1i(P.useScreenCoordinates,0),this.gl.uniformMatrix4fv(P.modelViewMatrix,!1,G._modelViewMatrix.elements)),l.fog&&k.fog?Z=D:Z=0,W!==Z&&(this.gl.uniform1i(P.fogType,Z),W=Z),$=1/(k.scaleByViewport?f:1),K[0]*=$*G.scale.x,K[1]*=$*G.scale.y;let le=(y=k==null?void 0:k.alignment)===null||y===void 0?void 0:y.x,he=(E=k==null?void 0:k.alignment)===null||E===void 0?void 0:E.y;k.screenOffset&&(le=(le||0)+2*k.screenOffset.x/j,he=(he||0)+2*k.screenOffset.y/Q),this.gl.uniform2f(P.uvScale,((h=k==null?void 0:k.uvScale)===null||h===void 0?void 0:h.x)||1,((v=k==null?void 0:k.uvScale)===null||v===void 0?void 0:v.y)||1),this.gl.uniform2f(P.uvOffset,((C=k==null?void 0:k.uvOffset)===null||C===void 0?void 0:C.x)||0,((x=k==null?void 0:k.uvOffset)===null||x===void 0?void 0:x.y)||0),this.gl.uniform2f(P.alignment,le||0,he||0),this.gl.uniform1f(P.opacity,k.opacity),this.gl.uniform3f(P.color,((w=k==null?void 0:k.color)===null||w===void 0?void 0:w.r)||0,((_=k==null?void 0:k.color)===null||_===void 0?void 0:_.g)||0,((S=k==null?void 0:k.color)===null||S===void 0?void 0:S.b)||0),this.gl.uniform1f(P.rotation,G.rotation),this.gl.uniform2fv(P.scale,K),this.renderer.setDepthTest(k.depthTest),this.renderer.setDepthWrite(k.depthWrite),this.renderer.setTexture(k.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(l,c){if(!this.gl)throw new Error("WebGL Rendering context not found");var u=this.gl.createProgram();if(!u)throw new Error("Error creating webgl program");var f=this.gl.createShader(this.gl.FRAGMENT_SHADER),p=this.gl.createShader(this.gl.VERTEX_SHADER);if(!f)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!p)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var g="precision "+c+` float;
`;if(this.gl.shaderSource(f,g+l.fragmentShader),this.gl.shaderSource(p,g+l.vertexShader),this.gl.compileShader(f),this.gl.compileShader(p),!this.gl.getShaderParameter(f,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(p,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(f)} 
      ${this.gl.getShaderInfoLog(p)}`);return this.gl.attachShader(u,f),this.gl.attachShader(u,p),this.gl.linkProgram(u),this.gl.getProgramParameter(u,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),u}}function a(s,l){return s.z!==l.z?l.z-s.z:l.id-s.id}},"./src/WebGL/constants/Coloring.ts":(o,t,e)=>{e.r(t),e.d(t,{Coloring:()=>n});var n;(function(r){r[r.NoColors=0]="NoColors",r[r.FaceColors=1]="FaceColors",r[r.VertexColors=2]="VertexColors"})(n||(n={}))},"./src/WebGL/constants/Shading.ts":(o,t,e)=>{e.r(t),e.d(t,{Shading:()=>n});var n;(function(r){r[r.NoShading=0]="NoShading",r[r.FlatShading=1]="FlatShading",r[r.SmoothShading=2]="SmoothShading"})(n||(n={}))},"./src/WebGL/constants/Sides.ts":(o,t,e)=>{e.r(t),e.d(t,{BackSide:()=>r,DoubleSide:()=>a,FrontSide:()=>n});const n=0,r=1,a=2},"./src/WebGL/constants/SpriteAlignment.ts":(o,t,e)=>{e.r(t),e.d(t,{SpriteAlignment:()=>r});var n=e("./src/WebGL/math/index.ts");const r={topLeft:new n.Vector2(1,-1),topCenter:new n.Vector2(0,-1),topRight:new n.Vector2(-1,-1),centerLeft:new n.Vector2(1,0),center:new n.Vector2(0,0),centerRight:new n.Vector2(-1,0),bottomLeft:new n.Vector2(1,1),bottomCenter:new n.Vector2(0,1),bottomRight:new n.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts":(o,t,e)=>{e.r(t),e.d(t,{ClampToEdgeWrapping:()=>n,FloatType:()=>c,LinearFilter:()=>r,LinearMipMapLinearFilter:()=>s,NearestFilter:()=>a,R32Format:()=>p,RFormat:()=>f,RGBAFormat:()=>u,UnsignedByteType:()=>l});const n=1001,r=1006,a=1007,s=1008,l=1009,c=1010,u=1021,f=1022,p=1023},"./src/WebGL/constants/TextureOperations.ts":(o,t,e)=>{e.r(t),e.d(t,{TextureOperations:()=>n});var n;(function(r){r[r.MultiplyOperation=0]="MultiplyOperation",r[r.MixOperation=1]="MixOperation",r[r.AddOperation=2]="AddOperation"})(n||(n={}))},"./src/WebGL/constants/index.ts":(o,t,e)=>{e.r(t),e.d(t,{BackSide:()=>r.BackSide,ClampToEdgeWrapping:()=>l.ClampToEdgeWrapping,Coloring:()=>n.Coloring,DoubleSide:()=>r.DoubleSide,FloatType:()=>l.FloatType,FrontSide:()=>r.FrontSide,LinearFilter:()=>l.LinearFilter,LinearMipMapLinearFilter:()=>l.LinearMipMapLinearFilter,NearestFilter:()=>l.NearestFilter,R32Format:()=>l.R32Format,RFormat:()=>l.RFormat,RGBAFormat:()=>l.RGBAFormat,Shading:()=>a.Shading,SpriteAlignment:()=>s.SpriteAlignment,TextureOperations:()=>c.TextureOperations,UnsignedByteType:()=>l.UnsignedByteType});var n=e("./src/WebGL/constants/Coloring.ts"),r=e("./src/WebGL/constants/Sides.ts"),a=e("./src/WebGL/constants/Shading.ts"),s=e("./src/WebGL/constants/SpriteAlignment.ts"),l=e("./src/WebGL/constants/TextureConstants.ts"),c=e("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts":(o,t,e)=>{e.r(t),e.d(t,{EventDispatcher:()=>n});class n{constructor(){this.listeners={}}dispatchEvent(a){var s=this.listeners[a.type];if(s!==void 0){a.target=this;for(var l=0,c=s.length;l<c;l++)s[l].call(this,a)}}removeEventListener(a,s){if(!s)this.listeners[a]=[];else{var l=this.listeners[a].indexOf(s);l!==-1&&this.listeners[a].splice(l,1)}}addEventListener(a,s){this.listeners[a]===void 0&&(this.listeners[a]=[]),this.listeners[a].indexOf(s)===-1&&this.listeners[a].push(s)}}},"./src/WebGL/core/Geometry.ts":(o,t,e)=>{e.r(t),e.d(t,{Geometry:()=>u,GeometryGroup:()=>c,GeometryIDCount:()=>f});var n=e("./src/WebGL/materials/LineBasicMaterial.ts"),r=e("./src/WebGL/core/EventDispatcher.ts"),a=e("./src/WebGL/math/index.ts"),s=e("./src/colors.ts");const l=65535;class c{constructor(g=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=g}setColors(g){var y=this.vertexArray,E=this.colorArray;if(!y)throw new Error("vertex array not initialized");if(!E)throw new Error("color array not initialized");if(y.length!=E.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var h=0;h<y.length;h+=3){var v=g(y[h],y[h+1],y[h+2]);v instanceof s.Color||(v=s.CC.color(v)),E[h]=v.r,E[h+1]=v.g,E[h+2]=v.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var g=new a.Vector3,y,E,h,v,C=0;C<this.vertices;++C)y=C*3,E=this.vertexArray[y],h=this.vertexArray[y+1],v=this.vertexArray[y+2],g.x+=E,g.y+=h,g.z+=v;return g.divideScalar(this.vertices),g}setNormals(){var g=this.faceArray,y=this.vertexArray,E=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!g)throw new Error("face array not initialized");if(!y)throw new Error("vertex array not initialized");if(!E)throw new Error("normal array not initialized");for(var h,v,C,x,w,_,S,M=0;M<g.length/3;++M)h=g[M*3]*3,v=g[M*3+1]*3,C=g[M*3+2]*3,x=new a.Vector3(y[h],y[h+1],y[h+2]),w=new a.Vector3(y[v],y[v+1],y[v+2]),_=new a.Vector3(y[C],y[C+1],y[C+2]),x.subVectors(x,w),_.subVectors(_,w),_.cross(x),S=_,S.normalize(),E[h]+=S.x,E[v]+=S.x,E[C]+=S.x,E[h+1]+=S.y,E[v+1]+=S.y,E[C+1]+=S.y,E[h+2]+=S.z,E[v+2]+=S.z,E[C+2]+=S.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var g=this.faceArray,y=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!g)throw new Error("face array not initialized");for(var E=0;E<this.faceidx/3;++E){var h=E*3,v=h*2,C=g[h],x=g[h+1],w=g[h+2];y[v]=C,y[v+1]=x,y[v+2]=C,y[v+3]=w,y[v+4]=x,y[v+5]=w}}}vrml(g,y){var E,h,v,C,x,w,_,S,M,T,R,P,I,B,W,D="";D+=g+`Shape {
`+g+` appearance Appearance {
`+g+`  material Material {
`+g+"   diffuseColor "+((E=y==null?void 0:y.color)===null||E===void 0?void 0:E.r)+" "+((h=y==null?void 0:y.color)===null||h===void 0?void 0:h.g)+" "+((v=y==null?void 0:y.color)===null||v===void 0?void 0:v.b)+`
`,y!=null&&y.transparent&&(D+=g+"   transparency "+(1-y.opacity)+`
`),D+=g+`  }
`,D+=g+` }
`;var O=g;if(g+=" ",y instanceof n.LineBasicMaterial){D+=g+`geometry IndexedLineSet {
`+g+` colorPerVertex TRUE
`+g+` coord Coordinate {
`+g+`  point [
`;let G,k,$;for(let Z=0;Z<this.vertices;++Z){let K=Z*3;G=(C=this.vertexArray)===null||C===void 0?void 0:C[K],k=(x=this.vertexArray)===null||x===void 0?void 0:x[K+1],$=(w=this.vertexArray)===null||w===void 0?void 0:w[K+2],D+=g+"   "+G+" "+k+" "+$+`,
`}if(D+=g+`  ]
`,D+=g+` }
`,this.colorArray){D+=g+` color Color {
`+g+`  color [
`;for(let Z=0;Z<this.vertices;++Z){let K=Z*3;G=this.colorArray[K],k=this.colorArray[K+1],$=this.colorArray[K+2],D+=g+"   "+G+" "+k+" "+$+`,
`}D+=g+`  ]
`,D+=g+` }
`}D+=g+` coordIndex [
`;for(let Z=0;Z<this.vertices;Z+=2)D+=g+"  "+Z+", "+(Z+1)+`, -1,
`;D+=g+` ]
`,D+=g+`}
`}else{D+=g+`geometry IndexedFaceSet {
`+g+` colorPerVertex TRUE
`+g+` normalPerVertex TRUE
`+g+` solid FALSE
`,D+=g+` coord Coordinate {
`+g+`  point [
`;let G,k,$;for(let Z=0;Z<this.vertices;++Z){let K=Z*3;G=(_=this.vertexArray)===null||_===void 0?void 0:_[K],k=(S=this.vertexArray)===null||S===void 0?void 0:S[K+1],$=(M=this.vertexArray)===null||M===void 0?void 0:M[K+2],D+=g+"   "+G+" "+k+" "+$+`,
`}D+=g+`  ]
`,D+=g+` }
`,D+=g+` normal Normal {
`+g+`  vector [
`;for(let Z=0;Z<this.vertices;++Z){let K=Z*3;G=(T=this.normalArray)===null||T===void 0?void 0:T[K],k=(R=this.normalArray)===null||R===void 0?void 0:R[K+1],$=(P=this.normalArray)===null||P===void 0?void 0:P[K+2],D+=g+"   "+G+" "+k+" "+$+`,
`}if(D+=g+`  ]
`,D+=g+` }
`,this.colorArray){D+=g+` color Color {
`+g+`  color [
`;for(let Z=0;Z<this.vertices;++Z){let K=Z*3;G=this.colorArray[K],k=this.colorArray[K+1],$=this.colorArray[K+2],D+=g+"   "+G+" "+k+" "+$+`,
`}D+=g+`  ]
`,D+=g+` }
`}D+=g+` coordIndex [
`;for(var z=0;z<this.faceidx;z+=3)G=(I=this.faceArray)===null||I===void 0?void 0:I[z],k=(B=this.faceArray)===null||B===void 0?void 0:B[z+1],$=(W=this.faceArray)===null||W===void 0?void 0:W[z+2],D+=g+"  "+G+", "+k+", "+$+`, -1,
`;D+=g+` ]
`,D+=g+`}
`}return D+=O+"}",D}truncateArrayBuffers(g=!0,y=!1){var E=this.vertexArray,h=this.colorArray,v=this.normalArray,C=this.faceArray,x=this.lineArray,w=this.radiusArray;this.vertexArray=(E==null?void 0:E.subarray(0,this.vertices*3))||null,this.colorArray=(h==null?void 0:h.subarray(0,this.vertices*3))||null,g?(this.normalArray=(v==null?void 0:v.subarray(0,this.vertices*3))||null,this.faceArray=(C==null?void 0:C.subarray(0,this.faceidx))||null,this.lineidx>0?this.lineArray=(x==null?void 0:x.subarray(0,this.lineidx))||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),w&&(this.radiusArray=w.subarray(0,this.vertices)),y&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class u extends r.EventDispatcher{constructor(g=!1,y=!1,E=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=f++,this.mesh=g,this.radii=y,this.offset=E}updateGeoGroup(g=0){var y,E=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!E||E.vertices+g>(((y=E==null?void 0:E.vertexArray)===null||y===void 0?void 0:y.length)||0)/3)&&(E=this.addGeoGroup()),E}vrml(g,y){for(var E="",h=this.geometryGroups.length,v=0;v<h;v++){var C=this.geometryGroups[v];E+=C.vrml(g,y)+`,
`}return E}addGeoGroup(){var g=new c(this.geometryGroups.length);return this.geometryGroups.push(g),this.groups=this.geometryGroups.length,g.vertexArray=new Float32Array(l*3),g.colorArray=new Float32Array(l*3),this.mesh&&(g.normalArray=new Float32Array(l*3),g.faceArray=new Uint16Array(l*6),g.lineArray=new Uint16Array(l*6)),this.radii&&(g.radiusArray=new Float32Array(l)),g.useOffset=this.offset,g}setUpNormals(...g){for(var y=0;y<this.groups;y++){var E=this.geometryGroups[y];E.setNormals(...g)}}setColors(...g){for(var y=this.geometryGroups.length,E=0;E<y;E++){var h=this.geometryGroups[E];h.setColors(...g)}}setUpWireframe(...g){for(var y=0;y<this.groups;y++){var E=this.geometryGroups[y];E.setLineIndices(...g)}}initTypedArrays(){for(var g=0;g<this.groups;g++){var y=this.geometryGroups[g];y.__inittedArrays!==!0&&y.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var g=0,y=0;y<this.groups;y++)g+=this.geometryGroups[y].vertices;return g}}let f=0},"./src/WebGL/core/Object3D.ts":(o,t,e)=>{e.r(t),e.d(t,{Light:()=>c,Object3D:()=>s,Object3DIDCount:()=>a,Scene:()=>l});var n=e("./src/WebGL/math/index.ts"),r=e("./src/colors.ts");let a=0;class s{constructor(){this.id=a++,this.name="",this.children=[],this.position=new n.Vector3,this.rotation=new n.Vector3,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.quaternion=new n.Quaternion,this.eulerOrder="XYZ",this.up=new n.Vector3(0,1,0),this.scale=new n.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(f){this.matrix.lookAt(f,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof n.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(f){if(f===this){console.error("Can't add $3Dmol.Object3D to itself");return}f.parent=this,this.children.push(f);for(var p=this;p.parent!==void 0;)p=p.parent;p!==void 0&&p instanceof l&&p.__addObject(f)}remove(f){var p=this.children.indexOf(f);if(p!==-1){f.parent=void 0,this.children.splice(p,1);for(var g=this;g.parent!==void 0;)g=g.parent;g!==void 0&&g instanceof l&&g.__removeObject(f)}}vrml(f){f||(f=" ");var p=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),g=0,y=0,E=0;if(p!=0){let C=Math.sin(p/2);g=this.quaternion.x/C,y=this.quaternion.y/C,E=this.quaternion.z/C}var h=f+`Transform {
`+f+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+f+" rotation "+g+" "+y+" "+E+" "+p+`
`+f+` children [
`;this.geometry&&(h+=this.geometry.vrml(f,this.material));for(var v=0;v<this.children.length;v++)h+=this.children[v].vrml(f+" ")+`,
`;return h+=` ]
`,h+="}",h}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof n.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(f){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||f===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var p=0;p<this.children.length;p++)this.children[p].updateMatrixWorld(!0)}clone(f){f===void 0&&(f=new s),f.name=this.name,f.up.copy(this.up),f.position.copy(this.position),f.rotation instanceof n.Vector3&&this.rotation instanceof n.Vector3?f.rotation.copy(this.rotation):f.rotation=this.rotation,f.eulerOrder=this.eulerOrder,f.scale.copy(this.scale),f.rotationAutoUpdate=this.rotationAutoUpdate,f.matrix.copy(this.matrix),f.matrixWorld.copy(this.matrixWorld),f.quaternion.copy(this.quaternion),f.matrixAutoUpdate=this.matrixAutoUpdate,f.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,f.useQuaternion=this.useQuaternion,f.visible=this.visible;for(var p=0;p<this.children.length;p++){var g=this.children[p];f.add(g.clone())}return f}setVisible(f){this.visible=f;for(var p=0;p<this.children.length;p++){var g=this.children[p];g.setVisible(f)}}}class l extends s{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(f){if(f instanceof c)this.__lights.indexOf(f)===-1&&this.__lights.push(f),f.target&&f.target.parent===void 0&&this.add(f.target);else if(this.__objects.indexOf(f)===-1){this.__objects.push(f),this.__objectsAdded.push(f);var p=this.__objectsRemoved.indexOf(f);p!==-1&&this.__objectsRemoved.splice(p,1)}for(var g=0;g<f.children.length;g++)this.__addObject(f.children[g])}__removeObject(f){var p;if(f instanceof c)p=this.__lights.indexOf(f),p!==-1&&this.__lights.splice(p,1);else if(p=this.__objects.indexOf(f),p!==-1){this.__objects.splice(p,1),this.__objectsRemoved.push(f);var g=this.__objectsAdded.indexOf(f);g!==-1&&this.__objectsAdded.splice(p,1)}for(var y=0;y<f.children.length;y++)this.__removeObject(f.children[y])}}class c extends s{constructor(f,p=1){super(),this.position=new n.Vector3(0,1,0),this.target=new s,this.castShadow=!1,this.onlyShadow=!1,this.color=new r.Color(f),this.intensity=p}}},"./src/WebGL/core/Projector.ts":(o,t,e)=>{e.r(t),e.d(t,{Projector:()=>a});var n=e("./src/WebGL/math/index.ts");const r=new n.Matrix4;class a{static unprojectVector(l,c){return c.projectionMatrixInverse.getInverse(c.projectionMatrix),r.multiplyMatrices(c.matrixWorld,c.projectionMatrixInverse),l.applyProjection(r)}static projectVector(l,c){return c.matrixWorldInverse.getInverse(c.matrixWorld),r.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),l.applyProjection(r)}projectVector(l,c){return a.projectVector(l,c)}unprojectVector(l,c){return a.unprojectVector(l,c)}}},"./src/WebGL/core/Raycaster.ts":(o,t,e)=>{e.r(t),e.d(t,{Raycaster:()=>l,intersectObject:()=>C});var n=e("./src/WebGL/math/index.ts"),r=e("./src/WebGL/shapes/index.ts");const a=(x,w)=>x.distance-w.distance,s=new n.Matrix4;class l{constructor(w,_,S,M){this.precision=1e-4,this.linePrecision=.2,this.ray=new n.Ray(w,_),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=M||0,this.far=S||1/0}set(w,_){this.ray.set(w,_)}setFromCamera(w,_){_.ortho?(this.ray.origin.set(w.x,w.y,(_.near+_.far)/(_.near-_.far)).unproject(_),this.ray.direction.set(0,0,-1).transformDirection(_.matrixWorld)):(this.ray.origin.setFromMatrixPosition(_.matrixWorld),this.ray.direction.set(w.x,w.y,w.z),_.projectionMatrixInverse.getInverse(_.projectionMatrix),s.multiplyMatrices(_.matrixWorld,_.projectionMatrixInverse),this.ray.direction.applyProjection(s),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(w,_){for(var S=[],M=0,T=_.length;M<T;M++)C(w,_[M],this,S);return S.sort(a),S}}const c=x=>Math.min(Math.max(x,-1),1);var u=new r.Sphere,f=new r.Cylinder,p=new r.Triangle,g=new n.Vector3,y=new n.Vector3,E=new n.Vector3,h=new n.Vector3,v=new n.Vector3;function C(x,w,_,S){if(v.getPositionFromMatrix(x.matrixWorld),w.intersectionShape===void 0)return S;var M=w.intersectionShape,T=_.linePrecision;T*=x.matrixWorld.getMaxScaleOnAxis();var R=T*T;if(w.boundingSphere!==void 0&&w.boundingSphere instanceof r.Sphere&&(u.copy(w.boundingSphere),u.applyMatrix4(x.matrixWorld),!_.ray.isIntersectionSphere(u)))return S;var P,I,B,W,D,O,z,G,k,$,Z,K,j,Q;for(P=0,I=M.triangle.length;P<I;P++)if(M.triangle[P]instanceof r.Triangle){if(p.copy(M.triangle[P]),p.applyMatrix4(x.matrixWorld),B=p.getNormal(),W=_.ray.direction.dot(B),W>=0||(g.subVectors(p.a,_.ray.origin),z=B.dot(g)/W,z<0))continue;y.copy(_.ray.direction).multiplyScalar(z).add(_.ray.origin),y.sub(p.a),E.copy(p.b).sub(p.a),h.copy(p.c).sub(p.a);var le=E.dot(h),he=E.lengthSq(),ve=h.lengthSq();if(K=(he*y.dot(h)-le*y.dot(E))/(he*ve-le*le),K<0||K>1||(Z=(y.dot(E)-K*le)/he,Z<0||Z>1||Z+K>1))continue;S.push({clickable:w,distance:z})}for(P=0,I=M.cylinder.length;P<I;P++)if(M.cylinder[P]instanceof r.Cylinder){if(f.copy(M.cylinder[P]),f.applyMatrix4(x.matrixWorld),g.subVectors(f.c1,_.ray.origin),D=g.dot(f.direction),O=g.dot(_.ray.direction),W=c(_.ray.direction.dot(f.direction)),k=1-W*W,k===0)continue;j=(W*O-D)/k,Q=(O-W*D)/k,y.copy(f.direction).multiplyScalar(j).add(f.c1),E.copy(_.ray.direction).multiplyScalar(Q).add(_.ray.origin),G=h.subVectors(y,E).lengthSq();var re=f.radius*f.radius;if(G<=re){if($=(W*D-O)*(W*D-O)-k*(g.lengthSq()-D*D-re),$<=0?K=z=Math.sqrt(G):K=z=(O-W*D-Math.sqrt($))/k,Z=W*K-D,Z<0||Z*Z>f.lengthSq()||K<0)continue;S.push({clickable:w,distance:z})}}for(P=0,I=M.line.length;P<I;P+=2){y.copy(M.line[P]),y.applyMatrix4(x.matrixWorld),E.copy(M.line[P+1]),E.applyMatrix4(x.matrixWorld),h.subVectors(E,y);var Ie=h.lengthSq();h.normalize(),g.subVectors(y,_.ray.origin);var ge=g.dot(h);O=g.dot(_.ray.direction),W=c(_.ray.direction.dot(h)),k=1-W*W,k!==0&&(j=(W*O-ge)/k,Q=(O-W*ge)/k,y.add(h.multiplyScalar(j)),E.copy(_.ray.direction).multiplyScalar(Q).add(_.ray.origin),G=h.subVectors(E,y).lengthSq(),G<R&&j*j<Ie&&S.push({clickable:w,distance:Q}))}for(P=0,I=M.sphere.length;P<I;P++)if(M.sphere[P]instanceof r.Sphere&&(u.copy(M.sphere[P]),u.applyMatrix4(x.matrixWorld),_.ray.isIntersectionSphere(u))){y.subVectors(u.center,_.ray.origin);var Se=y.dot(_.ray.direction);if($=Se*Se-(y.lengthSq()-u.radius*u.radius),Se<0)return S;$<=0?z=Se:z=Se-Math.sqrt($),S.push({clickable:w,distance:z})}return S}},"./src/WebGL/core/Texture.ts":(o,t,e)=>{e.r(t),e.d(t,{Texture:()=>l,TextureIdCount:()=>c});var n=e("./src/WebGL/constants/TextureConstants.ts"),r=e("./src/WebGL/math/index.ts"),a=e("./src/WebGL/core/EventDispatcher.ts"),s=e("./src/WebGL/core/UVMapping.ts");class l extends a.EventDispatcher{constructor(f,p){super(),this.id=c++,this.name="",this.image=f,this.mapping=new s.UVMapping,this.wrapS=n.ClampToEdgeWrapping,this.wrapT=n.ClampToEdgeWrapping,this.anisotropy=1,p?(this.format=n.RFormat,this.type=n.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=n.NearestFilter,this.minFilter=n.NearestFilter):(this.format=n.RGBAFormat,this.type=n.UnsignedByteType,this.offset=new r.Vector2(0,0),this.repeat=new r.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=n.LinearFilter,this.minFilter=n.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(f=new l){return f.image=this.image,f.mapping=this.mapping,f.wrapS=this.wrapS,f.wrapT=this.wrapT,f.magFilter=this.magFilter,f.minFilter=this.minFilter,f.anisotropy=this.anisotropy,f.format=this.format,f.type=this.type,f.offset.copy(this.offset),f.repeat.copy(this.repeat),f.premultiplyAlpha=this.premultiplyAlpha,f.flipY=this.flipY,f.unpackAlignment=this.unpackAlignment,f}dispose(){this.dispatchEvent({type:"dispose"})}}let c=0},"./src/WebGL/core/UVMapping.ts":(o,t,e)=>{e.r(t),e.d(t,{UVMapping:()=>n});class n{}},"./src/WebGL/core/index.ts":(o,t,e)=>{e.r(t),e.d(t,{EventDispatcher:()=>n.EventDispatcher,Geometry:()=>r.Geometry,GeometryGroup:()=>r.GeometryGroup,GeometryIDCount:()=>r.GeometryIDCount,Light:()=>a.Light,Object3D:()=>a.Object3D,Object3DIDCount:()=>a.Object3DIDCount,Projector:()=>s.Projector,Raycaster:()=>l.Raycaster,Scene:()=>a.Scene,Texture:()=>c.Texture,TextureIdCount:()=>c.TextureIdCount,UVMapping:()=>u.UVMapping,intersectObject:()=>l.intersectObject});var n=e("./src/WebGL/core/EventDispatcher.ts"),r=e("./src/WebGL/core/Geometry.ts"),a=e("./src/WebGL/core/Object3D.ts"),s=e("./src/WebGL/core/Projector.ts"),l=e("./src/WebGL/core/Raycaster.ts"),c=e("./src/WebGL/core/Texture.ts"),u=e("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts":(o,t,e)=>{e.r(t),e.d(t,{BackSide:()=>n.BackSide,Camera:()=>f.Camera,ClampToEdgeWrapping:()=>n.ClampToEdgeWrapping,Coloring:()=>n.Coloring,Cylinder:()=>u.Cylinder,DoubleSide:()=>n.DoubleSide,EventDispatcher:()=>r.EventDispatcher,FloatType:()=>n.FloatType,Fog:()=>p.Fog,FrontSide:()=>n.FrontSide,Geometry:()=>r.Geometry,GeometryGroup:()=>r.GeometryGroup,GeometryIDCount:()=>r.GeometryIDCount,ImposterMaterial:()=>a.ImposterMaterial,InstancedMaterial:()=>a.InstancedMaterial,Light:()=>r.Light,Line:()=>l.Line,LineBasicMaterial:()=>a.LineBasicMaterial,LineStyle:()=>l.LineStyle,LinearFilter:()=>n.LinearFilter,LinearMipMapLinearFilter:()=>n.LinearMipMapLinearFilter,Material:()=>a.Material,MaterialIdCount:()=>a.MaterialIdCount,Matrix3:()=>s.Matrix3,Matrix4:()=>s.Matrix4,Mesh:()=>l.Mesh,MeshDoubleLambertMaterial:()=>a.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>a.MeshLambertMaterial,MeshOutlineMaterial:()=>a.MeshOutlineMaterial,NearestFilter:()=>n.NearestFilter,Object3D:()=>r.Object3D,Object3DIDCount:()=>r.Object3DIDCount,Projector:()=>r.Projector,Quaternion:()=>s.Quaternion,R32Format:()=>n.R32Format,RFormat:()=>n.RFormat,RGBAFormat:()=>n.RGBAFormat,Ray:()=>s.Ray,Raycaster:()=>r.Raycaster,Renderer:()=>g.Renderer,Scene:()=>r.Scene,ShaderLib:()=>c.ShaderLib,ShaderUtils:()=>c.ShaderUtils,Shading:()=>n.Shading,Sphere:()=>u.Sphere,SphereImposterMaterial:()=>a.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>a.SphereImposterOutlineMaterial,Sprite:()=>l.Sprite,SpriteAlignment:()=>n.SpriteAlignment,SpriteMaterial:()=>a.SpriteMaterial,SpritePlugin:()=>y.SpritePlugin,StickImposterMaterial:()=>a.StickImposterMaterial,StickImposterOutlineMaterial:()=>a.StickImposterOutlineMaterial,Texture:()=>r.Texture,TextureIdCount:()=>r.TextureIdCount,TextureOperations:()=>n.TextureOperations,Triangle:()=>u.Triangle,UVMapping:()=>r.UVMapping,UnsignedByteType:()=>n.UnsignedByteType,Vector2:()=>s.Vector2,Vector3:()=>s.Vector3,VolumetricMaterial:()=>a.VolumetricMaterial,basic:()=>c.basic,clamp:()=>s.clamp,clone:()=>c.clone,conversionMatrix3:()=>s.conversionMatrix3,degToRad:()=>s.degToRad,instanced:()=>c.instanced,intersectObject:()=>r.intersectObject,lambert:()=>c.lambert,lambertdouble:()=>c.lambertdouble,outline:()=>c.outline,screen:()=>c.screen,screenaa:()=>c.screenaa,sphereimposter:()=>c.sphereimposter,sphereimposteroutline:()=>c.sphereimposteroutline,sprite:()=>c.sprite,stickimposter:()=>c.stickimposter,stickimposteroutline:()=>c.stickimposteroutline,volumetric:()=>c.volumetric});var n=e("./src/WebGL/constants/index.ts"),r=e("./src/WebGL/core/index.ts"),a=e("./src/WebGL/materials/index.ts"),s=e("./src/WebGL/math/index.ts"),l=e("./src/WebGL/objects/index.ts"),c=e("./src/WebGL/shaders/index.ts"),u=e("./src/WebGL/shapes/index.ts"),f=e("./src/WebGL/Camera.ts"),p=e("./src/WebGL/Fog.ts"),g=e("./src/WebGL/Renderer.ts"),y=e("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{ImposterMaterial:()=>c});var n=e("./src/WebGL/constants/Coloring.ts"),r=e("./src/WebGL/constants/Shading.ts"),a=e("./src/colors.ts"),s=e("./src/WebGL/math/index.ts"),l=e("./src/WebGL/materials/Material.ts");class c extends l.Material{constructor(f){super(),this.color=new a.Color(16777215),this.ambient=new a.Color(1048575),this.emissive=new a.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new s.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=r.Shading.SmoothShading,this.shaderID=null,this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.setValues(f)}clone(f=new c){return super.clone.call(this,f),f.color.copy(this.color),f.ambient.copy(this.ambient),f.emissive.copy(this.emissive),f.wrapAround=this.wrapAround,f.wrapRGB.copy(this.wrapRGB),f.map=this.map,f.lightMap=this.lightMap,f.specularMap=this.specularMap,f.envMap=this.envMap,f.combine=this.combine,f.reflectivity=this.reflectivity,f.refractionRatio=this.refractionRatio,f.fog=this.fog,f.shading=this.shading,f.shaderID=this.shaderID,f.vertexColors=this.vertexColors,f.skinning=this.skinning,f.morphTargets=this.morphTargets,f.morphNormals=this.morphNormals,f}}},"./src/WebGL/materials/InstancedMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{InstancedMaterial:()=>c});var n=e("./src/WebGL/constants/Coloring.ts"),r=e("./src/WebGL/constants/Shading.ts"),a=e("./src/colors.ts"),s=e("./src/WebGL/math/index.ts"),l=e("./src/WebGL/materials/Material.ts");class c extends l.Material{constructor(f){super(),this.color=new a.Color(16777215),this.ambient=new a.Color(1048575),this.emissive=new a.Color(0),this.wrapAround=!1,this.wrapRGB=new s.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=r.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(f)}clone(f=new c){return super.clone.call(this,f),f.color.copy(this.color),f.ambient.copy(this.ambient),f.emissive.copy(this.emissive),f.wrapAround=this.wrapAround,f.wrapRGB.copy(this.wrapRGB),f.map=this.map,f.lightMap=this.lightMap,f.specularMap=this.specularMap,f.envMap=this.envMap,f.combine=this.combine,f.reflectivity=this.reflectivity,f.refractionRatio=this.refractionRatio,f.fog=this.fog,f.shading=this.shading,f.shaderID=this.shaderID,f.vertexColors=this.vertexColors,f.skinning=this.skinning,f.morphTargets=this.morphTargets,f.morphNormals=this.morphNormals,f.sphere=this.sphere,f}}},"./src/WebGL/materials/LineBasicMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{LineBasicMaterial:()=>a});var n=e("./src/colors.ts"),r=e("./src/WebGL/materials/Material.ts");class a extends r.Material{constructor(l){super(),this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(l)}clone(l=new a){return super.clone.call(this,l),l.color.copy(this.color),l}}},"./src/WebGL/materials/Material.ts":(o,t,e)=>{e.r(t),e.d(t,{Material:()=>l,MaterialIdCount:()=>c});var n=e("./src/WebGL/constants/Sides.ts"),r=e("./src/WebGL/core/index.ts"),a=e("./src/WebGL/math/index.ts"),s=e("./src/colors.ts");class l extends r.EventDispatcher{constructor(){super(...arguments),this.id=c++,this.name="",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1}setValues(f={}){if(f!==void 0)for(var p in f){var g=f[p];if(g===void 0){console.warn("$3Dmol.Material: '"+p+"' parameter is undefined.");continue}if(p in this){var y=this[p];y instanceof s.Color&&g instanceof s.Color?y.copy(g):y instanceof s.Color?y.set(g):y instanceof a.Vector3&&g instanceof a.Vector3?y.copy(g):this[p]=g}}}clone(f=new l){return f.name=this.name,f.side=this.side,f.opacity=this.opacity,f.transparent=this.transparent,f.depthTest=this.depthTest,f.depthWrite=this.depthWrite,f.stencilTest=this.stencilTest,f.polygonOffset=this.polygonOffset,f.polygonOffsetFactor=this.polygonOffsetFactor,f.polygonOffsetUnits=this.polygonOffsetUnits,f.alphaTest=this.alphaTest,f.overdraw=this.overdraw,f.visible=this.visible,f}dispose(){this.dispatchEvent({type:"dispose"})}}let c=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{MeshDoubleLambertMaterial:()=>a});var n=e("./src/WebGL/constants/Sides.ts"),r=e("./src/WebGL/materials/MeshLambertMaterial.ts");class a extends r.MeshLambertMaterial{constructor(l){super(l),this.shaderID="lambertdouble",this.side=n.DoubleSide,this.outline=!1}clone(l=new a){return super.clone.call(this,l),l}}},"./src/WebGL/materials/MeshLambertMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{MeshLambertMaterial:()=>c});var n=e("./src/WebGL/constants/Coloring.ts"),r=e("./src/WebGL/constants/Shading.ts"),a=e("./src/WebGL/materials/Material.ts"),s=e("./src/colors.ts"),l=e("./src/WebGL/math/index.ts");class c extends a.Material{constructor(f){super(),this.color=new s.Color(16777215),this.ambient=new s.Color(1048575),this.emissive=new s.Color(0),this.wrapAround=!1,this.wrapRGB=new l.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=r.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.setValues(f)}clone(f=new c){return super.clone.call(this,f),f.color.copy(this.color),f.ambient.copy(this.ambient),f.emissive.copy(this.emissive),f.wrapAround=this.wrapAround,f.wrapRGB.copy(this.wrapRGB),f.map=this.map,f.lightMap=this.lightMap,f.specularMap=this.specularMap,f.envMap=this.envMap,f.combine=this.combine,f.reflectivity=this.reflectivity,f.refractionRatio=this.refractionRatio,f.fog=this.fog,f.shading=this.shading,f.shaderID=this.shaderID,f.vertexColors=this.vertexColors,f.skinning=this.skinning,f.morphTargets=this.morphTargets,f.morphNormals=this.morphNormals,f}}},"./src/WebGL/materials/MeshOutlineMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{MeshOutlineMaterial:()=>a});var n=e("./src/colors.ts"),r=e("./src/WebGL/materials/Material.ts");class a extends r.Material{constructor(l){super(),l=l||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=l.color||new n.Color(0,0,0),this.outlineWidth=l.width||.1,this.outlinePushback=l.pushback||1}clone(l=new a){return super.clone.call(this,l),l.fog=this.fog,l.shaderID=this.shaderID,l.wireframe=this.wireframe,l}}},"./src/WebGL/materials/SphereImposterMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{SphereImposterMaterial:()=>r});var n=e("./src/WebGL/materials/ImposterMaterial.ts");class r extends n.ImposterMaterial{constructor(s){super(s),this.shaderID="sphereimposter",this.setValues(s)}clone(s=new r){return super.clone.call(this,s),s}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{SphereImposterOutlineMaterial:()=>a});var n=e("./src/colors.ts"),r=e("./src/WebGL/materials/ImposterMaterial.ts");class a extends r.ImposterMaterial{constructor(l){super(l),l=l||{},this.shaderID="sphereimposteroutline",this.outlineColor=l.color||new n.Color(0,0,0),this.outlineWidth=l.width||.1,this.outlinePushback=l.pushback||1,this.setValues(l)}clone(l=new a){return super.clone.call(this,l),l.outlineColor=this.outlineColor,l.outlineWidth=this.outlineWidth,l.outlinePushback=this.outlinePushback,l}}},"./src/WebGL/materials/SpriteMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{SpriteMaterial:()=>c});var n=e("./src/WebGL/constants/SpriteAlignment.ts"),r=e("./src/WebGL/core/Texture.ts"),a=e("./src/colors.ts"),s=e("./src/WebGL/math/index.ts"),l=e("./src/WebGL/materials/Material.ts");class c extends l.Material{constructor(f){super(),this.color=new a.Color(16777215),this.map=new r.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new s.Vector2(0,0),this.uvScale=new s.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=n.SpriteAlignment.center.clone(),this.setValues(f),f=f||{},f.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),f.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),f.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(f=new c){return super.clone.call(this,f),f.color.copy(this.color),f.map=this.map,f.useScreenCoordinates=this.useScreenCoordinates,f.screenOffset=this.screenOffset,f.sizeAttenuation=this.sizeAttenuation,f.scaleByViewport=this.scaleByViewPort,f.alignment.copy(this.alignment),f.uvOffset.copy(this.uvOffset),f}}},"./src/WebGL/materials/StickImposterMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{StickImposterMaterial:()=>r});var n=e("./src/WebGL/materials/ImposterMaterial.ts");class r extends n.ImposterMaterial{constructor(s){super(s),this.shaderID="stickimposter",this.setValues(s)}clone(s=new r){return super.clone.call(this,s),s}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{StickImposterOutlineMaterial:()=>a});var n=e("./src/colors.ts"),r=e("./src/WebGL/materials/ImposterMaterial.ts");class a extends r.ImposterMaterial{constructor(l={}){super(l),this.shaderID="stickimposteroutline",this.outlineColor=new n.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,l.color&&(this.outlineColor=l.color),l.width&&(this.outlineWidth=l.width),l.pushback&&(this.outlinePushback=l.pushback),this.setValues(l)}clone(l=new a){return super.clone.call(this,l),l.outlineColor=this.outlineColor,l.outlineWidth=this.outlineWidth,l.outlinePushback=this.outlinePushback,l}}},"./src/WebGL/materials/VolumetricMaterial.ts":(o,t,e)=>{e.r(t),e.d(t,{VolumetricMaterial:()=>s});var n=e("./src/WebGL/constants/Sides.ts"),r=e("./src/colors.ts"),a=e("./src/WebGL/materials/Material.ts");class s extends a.Material{constructor(c){super(),this.transparent=!1,this.volumetric=!0,this.color=new r.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=n.FrontSide,this.setValues(c)}clone(c=new s){return super.clone.call(this,c),c.transparent=this.transparent,c.volumetric=this.volumetric,c.color=this.color,c.transferfn=this.transferfn,c.map=this.map,c.extent=this.extent,c.maxdepth=this.maxdepth,c.unit=this.unit,c.texmatrix=this.texmatrix,c.transfermin=this.transfermin,c.transfermax=this.transfermax,c.subsamples=this.subsamples,c.shaderID=this.shaderID,c.side=this.side,c}}},"./src/WebGL/materials/index.ts":(o,t,e)=>{e.r(t),e.d(t,{ImposterMaterial:()=>n.ImposterMaterial,InstancedMaterial:()=>r.InstancedMaterial,LineBasicMaterial:()=>a.LineBasicMaterial,Material:()=>s.Material,MaterialIdCount:()=>s.MaterialIdCount,MeshDoubleLambertMaterial:()=>l.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>c.MeshLambertMaterial,MeshOutlineMaterial:()=>u.MeshOutlineMaterial,SphereImposterMaterial:()=>f.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>p.SphereImposterOutlineMaterial,SpriteMaterial:()=>g.SpriteMaterial,StickImposterMaterial:()=>y.StickImposterMaterial,StickImposterOutlineMaterial:()=>E.StickImposterOutlineMaterial,VolumetricMaterial:()=>h.VolumetricMaterial});var n=e("./src/WebGL/materials/ImposterMaterial.ts"),r=e("./src/WebGL/materials/InstancedMaterial.ts"),a=e("./src/WebGL/materials/LineBasicMaterial.ts"),s=e("./src/WebGL/materials/Material.ts"),l=e("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),c=e("./src/WebGL/materials/MeshLambertMaterial.ts"),u=e("./src/WebGL/materials/MeshOutlineMaterial.ts"),f=e("./src/WebGL/materials/SphereImposterMaterial.ts"),p=e("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),g=e("./src/WebGL/materials/SpriteMaterial.ts"),y=e("./src/WebGL/materials/StickImposterMaterial.ts"),E=e("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),h=e("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts":(o,t,e)=>{e.r(t),e.d(t,{Quaternion:()=>n});class n{constructor(a,s,l,c){this.x=a||0,this.y=s||0,this.z=l||0,this.w=c!==void 0?c:1}set(a,s,l,c){return this.x=a,this.y=s,this.z=l,this.w=c,this}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let a=this.length();return a===0?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a),this}multiply(a){return this.multiplyQuaternions(this,a)}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}multiplyQuaternions(a,s){const l=a.x,c=a.y,u=a.z,f=a.w,p=s.x,g=s.y,y=s.z,E=s.w;return this.x=l*E+f*p+c*y-u*g,this.y=c*E+f*g+u*p-l*y,this.z=u*E+f*y+l*g-c*p,this.w=f*E-l*p-c*g-u*y,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}clone(){return new n(this.x,this.y,this.z,this.w)}setFromEuler(a){const s=Math.cos(a.x/2),l=Math.cos(a.y/2),c=Math.cos(a.z/2),u=Math.sin(a.x/2),f=Math.sin(a.y/2),p=Math.sin(a.z/2);return this.x=u*l*c+s*f*p,this.y=s*f*c-u*l*p,this.z=s*l*p+u*f*c,this.w=s*l*c-u*f*p,this}}},"./src/WebGL/math/Vector2.ts":(o,t,e)=>{e.r(t),e.d(t,{Vector2:()=>n});class n{constructor(a,s){this.x=a||0,this.y=s||0}set(a,s){return this.x=a,this.y=s,this}subVectors(a,s){return this.x=a.x-s.x,this.y=a.y-s.y,this}copy(a){return this.x=a.x,this.y=a.y,this}clone(){return new n(this.x,this.y)}}},"./src/WebGL/math/index.ts":(o,t,e)=>{e.r(t),e.d(t,{Matrix3:()=>c.Matrix3,Matrix4:()=>c.Matrix4,Quaternion:()=>n.Quaternion,Ray:()=>c.Ray,Vector2:()=>r.Vector2,Vector3:()=>c.Vector3,clamp:()=>a.clamp,conversionMatrix3:()=>s.conversionMatrix3,degToRad:()=>l.degToRad});var n=e("./src/WebGL/math/Quaternion.ts"),r=e("./src/WebGL/math/Vector2.ts"),a=e("./src/WebGL/math/utils/clamp.ts"),s=e("./src/WebGL/math/utils/conversionMatrix3.ts"),l=e("./src/WebGL/math/utils/degToRad.ts"),c=e("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts":(o,t,e)=>{e.r(t),e.d(t,{Matrix3:()=>g,Matrix4:()=>f,Ray:()=>y,Vector3:()=>p});var n=e("./src/WebGL/math/utils/degToRad.ts"),r=e("./src/WebGL/math/utils/clamp.ts"),a,s,l,c,u;class f{constructor(h=1,v=0,C=0,x=0,w=0,_=1,S=0,M=0,T=0,R=0,P=1,I=0,B=0,W=0,D=0,O=1){typeof h<"u"&&typeof h!="number"?this.elements=new Float32Array(h):(this.elements=new Float32Array(16),this.elements[0]=h,this.elements[4]=v,this.elements[8]=C,this.elements[12]=x,this.elements[1]=w,this.elements[5]=_,this.elements[9]=S,this.elements[13]=M,this.elements[2]=T,this.elements[6]=R,this.elements[10]=P,this.elements[14]=I,this.elements[3]=B,this.elements[7]=W,this.elements[11]=D,this.elements[15]=O)}makeScale(h,v,C){throw new Error("Method not implemented.")}set(h,v,C,x,w,_,S,M,T,R,P,I,B,W,D,O){const z=this.elements;return z[0]=h,z[4]=v,z[8]=C,z[12]=x,z[1]=w,z[5]=_,z[9]=S,z[13]=M,z[2]=T,z[6]=R,z[10]=P,z[14]=I,z[3]=B,z[7]=W,z[11]=D,z[15]=O,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(h){const v=h.elements;return this.set(v[0],v[4],v[8],v[12],v[1],v[5],v[9],v[13],v[2],v[6],v[10],v[14],v[3],v[7],v[11],v[15]),this}matrix3FromTopLeft(){const h=this.elements;return new g(h[0],h[4],h[8],h[1],h[5],h[9],h[2],h[6],h[10])}setRotationFromEuler(h,v){const C=this.elements,{x,y:w,z:_}=h,S=Math.cos(x),M=Math.sin(x),T=Math.cos(w),R=Math.sin(w),P=Math.cos(_),I=Math.sin(_);if(v===void 0||v==="XYZ"){const B=S*P,W=S*I,D=M*P,O=M*I;C[0]=T*P,C[4]=-T*I,C[8]=R,C[1]=W+D*R,C[5]=B-O*R,C[9]=-M*T,C[2]=O-B*R,C[6]=D+W*R,C[10]=S*T}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${v}`);return this}setRotationFromQuaternion(h){const v=this.elements,{x:C,y:x,z:w,w:_}=h,S=C+C,M=x+x,T=w+w,R=C*S,P=C*M,I=C*T,B=x*M,W=x*T,D=w*T,O=_*S,z=_*M,G=_*T;return v[0]=1-(B+D),v[4]=P-G,v[8]=I+z,v[1]=P+G,v[5]=1-(R+D),v[9]=W-O,v[2]=I-z,v[6]=W+O,v[10]=1-(R+B),this}multiplyMatrices(h,v){const C=h.elements,x=v.elements,w=this.elements,_=C[0],S=C[4],M=C[8],T=C[12],R=C[1],P=C[5],I=C[9],B=C[13],W=C[2],D=C[6],O=C[10],z=C[14],G=C[3],k=C[7],$=C[11],Z=C[15],K=x[0],j=x[4],Q=x[8],le=x[12],he=x[1],ve=x[5],re=x[9],Ie=x[13],ge=x[2],Se=x[6],Le=x[10],be=x[14],ye=x[3],ce=x[7],ue=x[11],Ce=x[15];return w[0]=_*K+S*he+M*ge+T*ye,w[4]=_*j+S*ve+M*Se+T*ce,w[8]=_*Q+S*re+M*Le+T*ue,w[12]=_*le+S*Ie+M*be+T*Ce,w[1]=R*K+P*he+I*ge+B*ye,w[5]=R*j+P*ve+I*Se+B*ce,w[9]=R*Q+P*re+I*Le+B*ue,w[13]=R*le+P*Ie+I*be+B*Ce,w[2]=W*K+D*he+O*ge+z*ye,w[6]=W*j+D*ve+O*Se+z*ce,w[10]=W*Q+D*re+O*Le+z*ue,w[14]=W*le+D*Ie+O*be+z*Ce,w[3]=G*K+k*he+$*ge+Z*ye,w[7]=G*j+k*ve+$*Se+Z*ce,w[11]=G*Q+k*re+$*Le+Z*ue,w[15]=G*le+k*Ie+$*be+Z*Ce,this}multiplyScalar(h){const v=this.elements;return v[0]*=h,v[4]*=h,v[8]*=h,v[12]*=h,v[1]*=h,v[5]*=h,v[9]*=h,v[13]*=h,v[2]*=h,v[6]*=h,v[10]*=h,v[14]*=h,v[3]*=h,v[7]*=h,v[11]*=h,v[15]*=h,this}makeTranslation(h,v,C){return this.set(1,0,0,h,0,1,0,v,0,0,1,C,0,0,0,1),this}snap(h){const v=Math.pow(10,4),C=this.elements;for(let x=0;x<16;x++){const w=Math.round(C[x]);w===Math.round(C[x]*v)/v&&(C[x]=w)}return this}transpose(){const h=this.elements;let v;return v=h[1],h[1]=h[4],h[4]=v,v=h[2],h[2]=h[8],h[8]=v,v=h[6],h[6]=h[9],h[9]=v,v=h[3],h[3]=h[12],h[12]=v,v=h[7],h[7]=h[13],h[13]=v,v=h[11],h[11]=h[14],h[14]=v,this}setPosition(h){const v=this.elements;return v[12]=h.x,v[13]=h.y,v[14]=h.z,this}translate(h){const v=this.elements;return v[12]+=h.x,v[13]+=h.y,v[14]+=h.z,this}getInverse(h,v){const C=this.elements,x=h.elements,w=x[0],_=x[4],S=x[8],M=x[12],T=x[1],R=x[5],P=x[9],I=x[13],B=x[2],W=x[6],D=x[10],O=x[14],z=x[3],G=x[7],k=x[11],$=x[15];C[0]=P*O*G-I*D*G+I*W*k-R*O*k-P*W*$+R*D*$,C[4]=M*D*G-S*O*G-M*W*k+_*O*k+S*W*$-_*D*$,C[8]=S*I*G-M*P*G+M*R*k-_*I*k-S*R*$+_*P*$,C[12]=M*P*W-S*I*W-M*R*D+_*I*D+S*R*O-_*P*O,C[1]=I*D*z-P*O*z-I*B*k+T*O*k+P*B*$-T*D*$,C[5]=S*O*z-M*D*z+M*B*k-w*O*k-S*B*$+w*D*$,C[9]=M*P*z-S*I*z-M*T*k+w*I*k+S*T*$-w*P*$,C[13]=S*I*B-M*P*B+M*T*D-w*I*D-S*T*O+w*P*O,C[2]=R*O*z-I*W*z+I*B*G-T*O*G-R*B*$+T*W*$,C[6]=M*W*z-_*O*z-M*B*G+w*O*G+_*B*$-w*W*$,C[10]=_*I*z-M*R*z+M*T*G-w*I*G-_*T*$+w*R*$,C[14]=M*R*B-_*I*B-M*T*W+w*I*W+_*T*O-w*R*O,C[3]=P*W*z-R*D*z-P*B*G+T*D*G+R*B*k-T*W*k,C[7]=_*D*z-S*W*z+S*B*G-w*D*G-_*B*k+w*W*k,C[11]=S*R*z-_*P*z-S*T*G+w*P*G+_*T*k-w*R*k,C[15]=_*P*B-S*R*B+S*T*W-w*P*W-_*T*D+w*R*D;const Z=w*C[0]+T*C[4]+B*C[8]+z*C[12];if(Z===0){const K="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(v)throw new Error(K);return console.warn(K),this.identity(),this}return this.multiplyScalar(1/Z),this}isReflected(){const h=this.elements,v=h[0],C=h[4],x=h[8],w=h[1],_=h[5],S=h[9],M=h[2],T=h[6],R=h[10];return v*_*R+w*T*x+M*C*S-M*_*x-w*C*R-v*T*S<0}scale(h){const v=this.elements,{x:C}=h,{y:x}=h,{z:w}=h;return v[0]*=C,v[4]*=x,v[8]*=w,v[1]*=C,v[5]*=x,v[9]*=w,v[2]*=C,v[6]*=x,v[10]*=w,v[3]*=C,v[7]*=x,v[11]*=w,this}getMaxScaleOnAxis(){const h=this.elements,v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],C=h[4]*h[4]+h[5]*h[5]+h[6]*h[6],x=h[8]*h[8]+h[9]*h[9]+h[10]*h[10];return Math.sqrt(Math.max(v,Math.max(C,x)))}makeFrustum(h,v,C,x,w,_){const S=this.elements,M=2*w/(v-h),T=2*w/(x-C),R=(v+h)/(v-h),P=(x+C)/(x-C),I=-(_+w)/(_-w),B=-2*_*w/(_-w);return S[0]=M,S[4]=0,S[8]=R,S[12]=0,S[1]=0,S[5]=T,S[9]=P,S[13]=0,S[2]=0,S[6]=0,S[10]=I,S[14]=B,S[3]=0,S[7]=0,S[11]=-1,S[15]=0,this}makePerspective(h,v,C,x){const w=C*Math.tan((0,n.degToRad)(h*.5)),_=-w,S=_*v,M=w*v;return this.makeFrustum(S,M,_,w,C,x)}makeOrthographic(h,v,C,x,w,_){const S=this.elements,M=1/(v-h),T=1/(C-x),R=1/(_-w),P=(v+h)*M,I=(C+x)*T,B=(_+w)*R;return S[0]=2*M,S[4]=0,S[8]=0,S[12]=-P,S[1]=0,S[5]=2*T,S[9]=0,S[13]=-I,S[2]=0,S[6]=0,S[10]=-2*R,S[14]=-B,S[3]=0,S[7]=0,S[11]=0,S[15]=1,this}isEqual(h){const v=h.elements,C=this.elements;return C[0]===v[0]&&C[4]===v[4]&&C[8]===v[8]&&C[12]===v[12]&&C[1]===v[1]&&C[5]===v[5]&&C[9]===v[9]&&C[13]===v[13]&&C[2]===v[2]&&C[6]===v[6]&&C[10]===v[10]&&C[14]===v[14]&&C[3]===v[3]&&C[7]===v[7]&&C[11]===v[11]&&C[15]===v[15]}clone(){const h=this.elements;return new f(h[0],h[4],h[8],h[12],h[1],h[5],h[9],h[13],h[2],h[6],h[10],h[14],h[3],h[7],h[11],h[15])}isIdentity(){const h=this.elements;return h[0]===1&&h[4]===0&&h[8]===0&&h[12]===0&&h[1]===0&&h[5]===1&&h[9]===0&&h[13]===0&&h[2]===0&&h[6]===0&&h[10]===1&&h[14]===0&&h[3]===0&&h[7]===0&&h[11]===0&&h[15]===1}isNearlyIdentity(h){return this.clone().snap(h).isIdentity()}getScale(h){const v=this.elements;return h=h||new p,l.set(v[0],v[1],v[2]),c.set(v[4],v[5],v[6]),u.set(v[8],v[9],v[10]),h.x=l.length(),h.y=c.length(),h.z=u.length(),h}lookAt(h,v,C){const x=this.elements;return u.subVectors(h,v).normalize(),u.length()===0&&(u.z=1),l.crossVectors(C,u).normalize(),l.length()===0&&(u.x+=1e-4,l.crossVectors(C,u).normalize()),c.crossVectors(u,l),x[0]=l.x,x[4]=c.x,x[8]=u.x,x[1]=l.y,x[5]=c.y,x[9]=u.y,x[2]=l.z,x[6]=c.z,x[10]=u.z,this}compose(h,v,C){const x=this.elements;return a.identity(),a.setRotationFromQuaternion(v),s.makeScale(C.x,C.y,C.z),this.multiplyMatrices(a,s),x[12]=h.x,x[13]=h.y,x[14]=h.z,this}}a=new f,s=new f;class p{constructor(h,v,C){this.x=h||0,this.y=v||0,this.z=C||0,this.atomid=void 0}set(h,v,C){return this.x=h,this.y=v,this.z=C,this}copy(h){return this.x=h.x,this.y=h.y,this.z=h.z,this}add(h){return this.x+=h.x,this.y+=h.y,this.z+=h.z,this}addVectors(h,v){return this.x=h.x+v.x,this.y=h.y+v.y,this.z=h.z+v.z,this}multiplyVectors(h,v){return this.x=h.x*v.x,this.y=h.y*v.y,this.z=h.z*v.z,this}sub(h){return this.x-=h.x,this.y-=h.y,this.z-=h.z,this}subVectors(h,v){return this.x=h.x-v.x,this.y=h.y-v.y,this.z=h.z-v.z,this}multiplyScalar(h){return this.x*=h,this.y*=h,this.z*=h,this}divideScalar(h){return h!==0?(this.x/=h,this.y/=h,this.z/=h):(this.x=0,this.y=0,this.z=0),this}max(h){return this.x=Math.max(this.x,h.x),this.y=Math.max(this.y,h.y),this.z=Math.max(this.z,h.z),this}min(h){return this.x=Math.min(this.x,h.x),this.y=Math.min(this.y,h.y),this.z=Math.min(this.z,h.z),this}distanceTo(h){return Math.sqrt(this.distanceToSquared(h))}distanceToSquared(h){const v=this.x-h.x,C=this.y-h.y,x=this.z-h.z;return v*v+C*C+x*x}applyMatrix3(h){const{x:v}=this,{y:C}=this,{z:x}=this,w=h.elements;return this.x=w[0]*v+w[3]*C+w[6]*x,this.y=w[1]*v+w[4]*C+w[7]*x,this.z=w[2]*v+w[5]*C+w[8]*x,this}applyMatrix4(h){const{x:v}=this,{y:C}=this,{z:x}=this,w=h.elements;return this.x=w[0]*v+w[4]*C+w[8]*x+w[12],this.y=w[1]*v+w[5]*C+w[9]*x+w[13],this.z=w[2]*v+w[6]*C+w[10]*x+w[14],this}applyProjection(h){const{x:v}=this,{y:C}=this,{z:x}=this,w=h.elements,_=w[3]*v+w[7]*C+w[11]*x+w[15];return this.x=(w[0]*v+w[4]*C+w[8]*x+w[12])/_,this.y=(w[1]*v+w[5]*C+w[9]*x+w[13])/_,this.z=(w[2]*v+w[6]*C+w[10]*x+w[14])/_,this}applyQuaternion(h){const{x:v}=this,{y:C}=this,{z:x}=this,w=h.x,_=h.y,S=h.z,M=h.w,T={};T.x=2*(C*S-x*_),T.y=2*(x*w-v*S),T.z=2*(v*_-C*w);const R={};return R.x=T.y*S-T.z*_,R.y=T.z*w-T.x*S,R.z=T.x*_-T.y*w,this.x=v+M*T.x+R.x,this.y=C+M*T.y+R.y,this.z=x+M*T.z+R.z,this}negate(){return this.multiplyScalar(-1)}dot(h){return this.x*h.x+this.y*h.y+this.z*h.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(h){const{x:v}=this,{y:C}=this,{z:x}=this;return this.x=C*h.z-x*h.y,this.y=x*h.x-v*h.z,this.z=v*h.y-C*h.x,this}crossVectors(h,v){return this.x=h.y*v.z-h.z*v.y,this.y=h.z*v.x-h.x*v.z,this.z=h.x*v.y-h.y*v.x,this}equals(h){return this.x==h.x&&this.y==h.y&&this.z==h.z}getPositionFromMatrix(h){return this.x=h.elements[12],this.y=h.elements[13],this.z=h.elements[14],this}setEulerFromRotationMatrix(h,v){const C=h.elements,x=C[0],w=C[4],_=C[8],S=C[5],M=C[9],T=C[6],R=C[10];return v===void 0||v==="XYZ"?(this.y=Math.asin((0,r.clamp)(_,-1,1)),Math.abs(_)<.99999?(this.x=Math.atan2(-M,R),this.z=Math.atan2(-w,x)):(this.x=Math.atan2(T,S),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${v}`),this}rotateAboutVector(h,v){h.normalize();const C=Math.cos(v),x=Math.sin(v),w=this.clone().multiplyScalar(C),_=h.clone().cross(this).multiplyScalar(x),S=h.clone().multiplyScalar(h.clone().dot(this)).multiplyScalar(1-C),M=w.add(_).add(S);return this.x=M.x,this.y=M.y,this.z=M.z,this}setFromMatrixPosition(h){const v=h.elements;return this.x=v[12],this.y=v[13],this.z=v[14],this}transformDirection(h){const{x:v}=this,{y:C}=this,{z:x}=this,w=h.elements;return this.x=w[0]*v+w[4]*C+w[8]*x,this.y=w[1]*v+w[5]*C+w[9]*x,this.z=w[2]*v+w[6]*C+w[10]*x,this.normalize()}clone(){return new p(this.x,this.y,this.z)}unproject(h){const v=a;return v.multiplyMatrices(h.matrixWorld,v.getInverse(h.projectionMatrix)),this.applyMatrix4(v)}}l=new p,c=new p,u=new p;class g{constructor(h=1,v=0,C=0,x=0,w=1,_=0,S=0,M=0,T=1){this.elements=new Float32Array(9),this.set(h,v,C,x,w,_,S,M,T)}set(h,v,C,x,w,_,S,M,T){const R=this.elements;return R[0]=h,R[3]=v,R[6]=C,R[1]=x,R[4]=w,R[7]=_,R[2]=S,R[5]=M,R[8]=T,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(h){const v=h.elements;this.set(v[0],v[3],v[6],v[1],v[4],v[7],v[2],v[5],v[8])}multiplyScalar(h){const v=this.elements;return v[0]*=h,v[3]*=h,v[6]*=h,v[1]*=h,v[4]*=h,v[7]*=h,v[2]*=h,v[5]*=h,v[8]*=h,this}getInverse3(h){const v=h.elements,C=this.elements;C[0]=v[4]*v[8]-v[5]*v[7],C[3]=v[6]*v[5]-v[3]*v[8],C[6]=v[3]*v[7]-v[6]*v[4],C[1]=v[7]*v[2]-v[1]*v[8],C[4]=v[0]*v[8]-v[6]*v[2],C[7]=v[1]*v[6]-v[0]*v[7],C[2]=v[1]*v[5]-v[2]*v[4],C[5]=v[2]*v[3]-v[0]*v[5],C[8]=v[0]*v[4]-v[1]*v[3];const x=v[0]*C[0]+v[3]*C[1]+v[6]*C[2];return this.multiplyScalar(1/x),this}getInverse(h,v){const C=h.elements,x=this.elements;x[0]=C[10]*C[5]-C[6]*C[9],x[1]=-C[10]*C[1]+C[2]*C[9],x[2]=C[6]*C[1]-C[2]*C[5],x[3]=-C[10]*C[4]+C[6]*C[8],x[4]=C[10]*C[0]-C[2]*C[8],x[5]=-C[6]*C[0]+C[2]*C[4],x[6]=C[9]*C[4]-C[5]*C[8],x[7]=-C[9]*C[0]+C[1]*C[8],x[8]=C[5]*C[0]-C[1]*C[4];const w=C[0]*x[0]+C[1]*x[3]+C[2]*x[6];if(w===0){const _="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(v)throw new Error(_);return console.warn(_),this.identity(),this}return this.multiplyScalar(1/w),this}getDeterminant(){const h=this.elements;return h[0]*h[4]*h[8]+h[1]*h[5]*h[6]+h[2]*h[3]*h[7]-h[2]*h[4]*h[6]-h[1]*h[3]*h[8]-h[0]*h[5]*h[7]}transpose(){let h;const v=this.elements;return h=v[1],v[1]=v[3],v[3]=h,h=v[2],v[2]=v[6],v[6]=h,h=v[5],v[5]=v[7],v[7]=h,this}clone(){const h=this.elements;return new g(h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8])}getMatrix4(){const h=this.elements;return new f(h[0],h[3],h[6],0,h[1],h[4],h[7],0,h[2],h[5],h[8],0)}}class y{constructor(h,v){this.origin=h!==void 0?h:new p,this.direction=v!==void 0?v:new p}set(h,v){return this.origin.copy(h),this.direction.copy(v),this}copy(h){return this.origin.copy(h.origin),this.direction.copy(h.direction),this}at(h,v){return(v||new p).copy(this.direction).multiplyScalar(h).add(this.origin)}recast(h){const v=l;return this.origin.copy(this.at(h,v)),this}closestPointToPoint(h,v){const C=v||new p;C.subVectors(h,this.origin);const x=C.dot(this.direction);return C.copy(this.direction).multiplyScalar(x).add(this.origin)}distanceToPoint(h){const v=l,C=v.subVectors(h,this.origin).dot(this.direction);return v.copy(this.direction).multiplyScalar(C).add(this.origin),v.distanceTo(h)}isIntersectionCylinder(){}isIntersectionSphere(h){return this.distanceToPoint(h.center)<=h.radius}isIntersectionPlane(h){return h.normal.dot(this.direction)!==0||h.distanceToPoint(this.origin)===0}distanceToPlane(h){const v=h.normal.dot(this.direction);return v===0?h.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(h.normal)+h.constant)/v}intersectPlane(h,v){const C=this.distanceToPlane(h);if(C!==void 0)return this.at(C,v)}applyMatrix4(h){return this.direction.add(this.origin).applyMatrix4(h),this.origin.applyMatrix4(h),this.direction.sub(this.origin),this}clone(){return new y().copy(this)}}},"./src/WebGL/math/utils/clamp.ts":(o,t,e)=>{e.r(t),e.d(t,{clamp:()=>n});function n(r,a,s){return Math.min(Math.max(r,a),s)}},"./src/WebGL/math/utils/conversionMatrix3.ts":(o,t,e)=>{e.r(t),e.d(t,{conversionMatrix3:()=>r});var n=e("./src/WebGL/math/math.ts");function r(a,s,l,c,u,f){c=c*Math.PI/180,u=u*Math.PI/180,f=f*Math.PI/180;const p=C=>C*C,g=Math.cos(c),y=Math.cos(u),E=Math.cos(f),h=Math.sin(f);return new n.Matrix3(a,s*E,l*y,0,s*h,l*(g-y*E)/h,0,0,l*Math.sqrt(1-p(g)-p(y)-p(E)+2*g*y*E)/h)}},"./src/WebGL/math/utils/degToRad.ts":(o,t,e)=>{e.r(t),e.d(t,{degToRad:()=>r});const n=Math.PI/180;function r(a){return a*n}},"./src/WebGL/objects/Line.ts":(o,t,e)=>{e.r(t),e.d(t,{Line:()=>s,LineStyle:()=>a});var n=e("./src/WebGL/materials/index.ts"),r=e("./src/WebGL/core/index.ts"),a;(function(l){l[l.LineStrip=0]="LineStrip",l[l.LinePieces=1]="LinePieces"})(a||(a={}));class s extends r.Object3D{constructor(c,u=new n.LineBasicMaterial({color:Math.random()*16777215}),f=a.LineStrip){super(),this.geometry=c,this.material=u,this.type=f}clone(c=new s(this.geometry,this.material,this.type)){return super.clone.call(this,c),c}}},"./src/WebGL/objects/Mesh.ts":(o,t,e)=>{e.r(t),e.d(t,{Mesh:()=>r});var n=e("./src/WebGL/core/index.ts");class r extends n.Object3D{constructor(s,l){super(),this.geometry=s,this.material=l}clone(s){return s===void 0&&(s=new r(this.geometry,this.material)),super.clone.call(this,s),s}}},"./src/WebGL/objects/Sprite.ts":(o,t,e)=>{e.r(t),e.d(t,{Sprite:()=>a});var n=e("./src/WebGL/materials/index.ts"),r=e("./src/WebGL/core/index.ts");class a extends r.Object3D{constructor(l=new n.SpriteMaterial){super(),this.material=l,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(l=new a(this.material)){return r.Object3D.prototype.clone.call(this,l),l}}},"./src/WebGL/objects/index.ts":(o,t,e)=>{e.r(t),e.d(t,{Line:()=>n.Line,LineStyle:()=>n.LineStyle,Mesh:()=>r.Mesh,Sprite:()=>a.Sprite});var n=e("./src/WebGL/objects/Line.ts"),r=e("./src/WebGL/objects/Mesh.ts"),a=e("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts":(o,t,e)=>{e.r(t)},"./src/WebGL/shaders/index.ts":(o,t,e)=>{e.r(t),e.d(t,{ShaderLib:()=>n.ShaderLib,ShaderUtils:()=>r.ShaderUtils,basic:()=>n.basic,clone:()=>r.clone,instanced:()=>n.instanced,lambert:()=>n.lambert,lambertdouble:()=>n.lambertdouble,outline:()=>n.outline,screen:()=>n.screen,screenaa:()=>n.screenaa,sphereimposter:()=>n.sphereimposter,sphereimposteroutline:()=>n.sphereimposteroutline,sprite:()=>n.sprite,stickimposter:()=>n.stickimposter,stickimposteroutline:()=>n.stickimposteroutline,volumetric:()=>n.volumetric});var n=e("./src/WebGL/shaders/lib/index.ts"),r=e("./src/WebGL/shaders/utils/index.ts");e("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/index.ts":(o,t,e)=>{e.r(t),e.d(t,{basic:()=>s});var n=e("./src/WebGL/shaders/lib/basic/uniforms.ts"),r=e("./src/WebGL/shaders/lib/basic/basic.frag"),a=e("./src/WebGL/shaders/lib/basic/basic.vert");const s={vertexShader:a.default.replace("#define GLSLIFY 1",""),fragmentShader:r.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/index.ts":(o,t,e)=>{e.r(t),e.d(t,{ShaderLib:()=>v,basic:()=>n.basic,instanced:()=>r.instanced,lambert:()=>a.lambert,lambertdouble:()=>s.lambertdouble,outline:()=>l.outline,screen:()=>c.screen,screenaa:()=>u.screenaa,sphereimposter:()=>f.sphereimposter,sphereimposteroutline:()=>p.sphereimposteroutline,sprite:()=>g.sprite,stickimposter:()=>y.stickimposter,stickimposteroutline:()=>E.stickimposteroutline,volumetric:()=>h.volumetric});var n=e("./src/WebGL/shaders/lib/basic/index.ts"),r=e("./src/WebGL/shaders/lib/instanced/index.ts"),a=e("./src/WebGL/shaders/lib/lambert/index.ts"),s=e("./src/WebGL/shaders/lib/lambertdouble/index.ts"),l=e("./src/WebGL/shaders/lib/outline/index.ts"),c=e("./src/WebGL/shaders/lib/screen/index.ts"),u=e("./src/WebGL/shaders/lib/screenaa/index.ts"),f=e("./src/WebGL/shaders/lib/sphereimposter/index.ts"),p=e("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),g=e("./src/WebGL/shaders/lib/sprite/index.ts"),y=e("./src/WebGL/shaders/lib/stickimposter/index.ts"),E=e("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),h=e("./src/WebGL/shaders/lib/volumetric/index.ts");const v={basic:n.basic,instanced:r.instanced,lambert:a.lambert,lambertdouble:s.lambertdouble,outline:l.outline,screen:c.screen,screenaa:u.screenaa,sphereimposter:f.sphereimposter,sphereimposteroutline:p.sphereimposteroutline,sprite:g.sprite,stickimposter:y.stickimposter,stickimposteroutline:E.stickimposteroutline,volumetric:h.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts":(o,t,e)=>{e.r(t),e.d(t,{instanced:()=>s});var n=e("./src/WebGL/shaders/lib/instanced/uniforms.ts"),r=e("./src/WebGL/shaders/lib/instanced/instanced.frag"),a=e("./src/WebGL/shaders/lib/instanced/instanced.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/instanced/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts":(o,t,e)=>{e.r(t),e.d(t,{lambert:()=>s});var n=e("./src/WebGL/shaders/lib/lambert/uniforms.ts"),r=e("./src/WebGL/shaders/lib/lambert/lambert.frag"),a=e("./src/WebGL/shaders/lib/lambert/lambert.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/lambert/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts":(o,t,e)=>{e.r(t),e.d(t,{lambertdouble:()=>s});var n=e("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),r=e("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),a=e("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts":(o,t,e)=>{e.r(t),e.d(t,{outline:()=>s});var n=e("./src/WebGL/shaders/lib/outline/uniforms.ts"),r=e("./src/WebGL/shaders/lib/outline/outline.frag"),a=e("./src/WebGL/shaders/lib/outline/outline.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/outline/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new n.Color(0,0,0)},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/screen/index.ts":(o,t,e)=>{e.r(t),e.d(t,{screen:()=>s});var n=e("./src/WebGL/shaders/lib/screen/uniforms.ts"),r=e("./src/WebGL/shaders/lib/screen/screen.frag"),a=e("./src/WebGL/shaders/lib/screen/screen.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/screen/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>n});const n={}},"./src/WebGL/shaders/lib/screenaa/index.ts":(o,t,e)=>{e.r(t),e.d(t,{screenaa:()=>s});var n=e("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),r=e("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),a=e("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/screenaa/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>n});const n={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts":(o,t,e)=>{e.r(t),e.d(t,{sphereimposter:()=>s});var n=e("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),r=e("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),a=e("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const s={vertexShader:a.default.replace("#define GLSLIFY 1",""),fragmentShader:r.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":(o,t,e)=>{e.r(t),e.d(t,{sphereimposteroutline:()=>s});var n=e("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),r=e("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),a=e("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new n.Color(0,0,0)},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/sprite/index.ts":(o,t,e)=>{e.r(t),e.d(t,{sprite:()=>s});var n=e("./src/WebGL/shaders/lib/sprite/uniforms.ts"),r=e("./src/WebGL/shaders/lib/sprite/sprite.frag"),a=e("./src/WebGL/shaders/lib/sprite/sprite.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/sprite/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>n});const n={}},"./src/WebGL/shaders/lib/stickimposter/index.ts":(o,t,e)=>{e.r(t),e.d(t,{stickimposter:()=>c});var n=e("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),r=e("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag"),a=e("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),s=e("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const c={fragmentShader:[r.default,a.default].join(`
`).replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":(o,t,e)=>{e.r(t),e.d(t,{stickimposteroutline:()=>l});var n=e("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),r=e("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag"),a=e("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const l={fragmentShader:(r.default+"gl_FragColor = vec4(color,1.0);}").replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new n.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},"./src/WebGL/shaders/lib/volumetric/index.ts":(o,t,e)=>{e.r(t),e.d(t,{volumetric:()=>s});var n=e("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),r=e("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),a=e("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const s={fragmentShader:r.default.replace("#define GLSLIFY 1",""),vertexShader:a.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts":(o,t,e)=>{e.r(t),e.d(t,{uniforms:()=>r});var n=e("./src/colors.ts");const r={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/utils/clone.ts":(o,t,e)=>{e.r(t),e.d(t,{clone:()=>r});var n=e("./src/colors.ts");function r(a){let s={};for(const c in a){s[c]={},s[c].type=a[c].type;var l=a[c].value;l instanceof n.Color?s[c].value=l.clone():typeof l=="number"?s[c].value=l:l instanceof Array?s[c].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return s}},"./src/WebGL/shaders/utils/index.ts":(o,t,e)=>{e.r(t),e.d(t,{ShaderUtils:()=>a,clone:()=>n.clone});var n=e("./src/WebGL/shaders/utils/clone.ts"),r=e("./src/WebGL/shaders/utils/stickimposterFragmentShader.partial.frag");const a={clone:n.clone,stickimposterFragmentShader:r.default}},"./src/WebGL/shapes/Cylinder.ts":(o,t,e)=>{e.r(t),e.d(t,{Cylinder:()=>a});var n=e("./src/WebGL/math/index.ts");let r=new n.Vector3;class a{constructor(l=new n.Vector3,c=new n.Vector3,u=0){this.c1=l,this.c2=c,this.radius=u,this.direction=new n.Vector3().subVectors(this.c2,this.c1).normalize()}copy(l){return this.c1.copy(l.c1),this.c2.copy(l.c2),this.direction.copy(l.direction),this.radius=l.radius,this}lengthSq(){return r.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(l){return this.direction.add(this.c1).applyMatrix4(l),this.c1.applyMatrix4(l),this.c2.applyMatrix4(l),this.direction.sub(this.c1).normalize(),this.radius=this.radius*l.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts":(o,t,e)=>{e.r(t),e.d(t,{Sphere:()=>r});var n=e("./src/WebGL/math/index.ts");class r{constructor(s={x:0,y:0,z:0},l=0){this.center=new n.Vector3(s.x,s.y,s.z),this.radius=l}set(s,l){return this.center.copy(s),this.radius=l,this}copy(s){return this.center.copy(s.center),this.radius=s.radius,this}applyMatrix4(s){return this.center.applyMatrix4(s),this.radius=this.radius*s.getMaxScaleOnAxis(),this}translate(s){return this.center.add(s),this}equals(s){return s.center.equals(this.center)&&s.radius===this.radius}clone(){return new r().copy(this)}}},"./src/WebGL/shapes/Triangle.ts":(o,t,e)=>{e.r(t),e.d(t,{Triangle:()=>a});var n=e("./src/WebGL/math/index.ts");const r=new n.Vector3;class a{constructor(l=new n.Vector3,c=new n.Vector3,u=new n.Vector3){this.a=l,this.b=c,this.c=u}copy(l){return this.a.copy(l.a),this.b.copy(l.b),this.c.copy(l.c),this}applyMatrix4(l){return this.a.applyMatrix4(l),this.b.applyMatrix4(l),this.c.applyMatrix4(l),this}getNormal(){var l=this.a.clone();return l.sub(this.b),r.subVectors(this.c,this.b),l.cross(r),l.normalize(),l}}},"./src/WebGL/shapes/index.ts":(o,t,e)=>{e.r(t),e.d(t,{Cylinder:()=>r.Cylinder,Sphere:()=>n.Sphere,Triangle:()=>a.Triangle});var n=e("./src/WebGL/shapes/Sphere.ts"),r=e("./src/WebGL/shapes/Cylinder.ts"),a=e("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{autoinit:()=>autoinit,autoload:()=>autoload,processing_autoinit:()=>processing_autoinit,viewers:()=>viewers});var _GLViewer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/GLViewer.ts"),_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/ProteinSurface4.ts"),_utilities__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/utilities.ts"),_colors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/colors.ts"),autoinit=!1,processing_autoinit=!1,viewers={};function autoload(viewer,callback){var i,dataname,type;if(document.querySelector(".viewer_3Dmoljs")!=null&&(autoinit=!0),autoinit){processing_autoinit=!0,viewer=viewer??null;var nviewers=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(viewerdiv=>{var datauri=[],datatypes=[],uri="";viewerdiv.style.position=="static"&&(viewerdiv.style.position="relative");var UI=null;if(type=null,viewerdiv.dataset.pdb)datauri.push("https://files.rcsb.org/view/"+viewerdiv.dataset.pdb+".pdb"),datatypes.push("pdb");else if(viewerdiv.dataset.cid)datatypes.push("sdf"),datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+viewerdiv.dataset.cid+"/SDF?record_type=3d");else if(viewerdiv.dataset.href||viewerdiv.dataset.url){viewerdiv.dataset.href?uri=viewerdiv.dataset.href:uri=viewerdiv.dataset.url,datauri.push(uri),type=uri.substring(uri.lastIndexOf(".")+1),datatypes.push(type);var molName=uri.substring(uri.lastIndexOf("/")+1,uri.lastIndexOf("."));molName=="/"&&(molName=uri.substring(uri.lastIndexOf("/")+1)),viewerdiv.dataset[datatypes[datatypes.length-1]]=molName}var divdata=viewerdiv.dataset;for(i in divdata)i.substring(0,3)==="pdb"&&i!=="pdb"?(datauri.push("https://files.rcsb.org/view/"+divdata[i]+".pdb"),datatypes.push("pdb")):i.substring(0,4)==="href"&&i!=="href"?(uri=divdata[i],datauri.push(uri),datatypes.push(uri.substring(uri.lastIndexOf(".")+1))):i.substring(0,3)==="cid"&&i!=="cid"&&(datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+divdata[i]+"/SDF?record_type=3d"),datatypes.push("sdf"));var options={};viewerdiv.dataset.options&&(options=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.options));var bgcolor=_colors__WEBPACK_IMPORTED_MODULE_3__.CC.color(viewerdiv.dataset.backgroundcolor),bgalpha=viewerdiv.dataset.backgroundalpha;bgalpha=bgalpha==null?1:parseFloat(bgalpha);var style={line:{}};viewerdiv.dataset.style&&(style=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.style));var select={};viewerdiv.dataset.select&&(select=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.select));var selectstylelist=[],surfaces=[],labels=[],zoomto={},spin=null,d=viewerdiv.dataset,stylere=/style(.+)/,surfre=/surface(.*)/,reslabre=/labelres(.*)/,keys=[];for(dataname in d)Object.prototype.hasOwnProperty.call(d,dataname)&&keys.push(dataname);for(keys.sort(),i=0;i<keys.length;i++){dataname=keys[i];var m=stylere.exec(dataname),selname,newsel,styleobj;m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),selectstylelist.push([newsel,styleobj])),m=surfre.exec(dataname),m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),surfaces.push([newsel,styleobj])),m=reslabre.exec(dataname),m&&(selname="select"+m[1],newsel=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[selname]),styleobj=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]),labels.push([newsel,styleobj])),dataname=="zoomto"&&(zoomto=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname])),dataname=="spin"&&(spin=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(d[dataname]))}var applyStyles=function(o){for(o.setStyle(select,style),UI&&UI.createSelectionAndStyle(select,style),i=0;i<selectstylelist.length;i++){let t=selectstylelist[i][0]||{},e=selectstylelist[i][1]||{line:{}};o.setStyle(t,e),UI&&UI.createSelectionAndStyle(select,style)}for(i=0;i<surfaces.length;i++){let t=surfaces[i][0]||{},e=surfaces[i][1]||{};UI?o.addSurface(_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__.SurfaceType.VDW,e,t,t).then(r=>{UI.loadSurface("VDW",t,e,r)}):o.addSurface(_ProteinSurface4__WEBPACK_IMPORTED_MODULE_1__.SurfaceType.VDW,e,t,t)}for(i=0;i<labels.length;i++){let t=labels[i][0]||{},e=labels[i][1]||{};o.addResLabels(t,e)}o.render(),o.zoomTo(zoomto),spin&&o.spin(spin.axis,spin.speed)},glviewer=viewer;try{var config=(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.specStringToObject)(viewerdiv.dataset.config)||{};config.backgroundColor===void 0&&(config.backgroundColor=bgcolor),config.backgroundAlpha===void 0&&(config.backgroundAlpha=bgalpha),glviewer==null?glviewer=viewers[viewerdiv.id||nviewers++]=(0,_GLViewer__WEBPACK_IMPORTED_MODULE_0__.createViewer)(viewerdiv,config):(glviewer.setBackgroundColor(bgcolor,bgalpha),glviewer.setConfig(config),UI&&UI.initiateUI()),viewerdiv.dataset.ui&&$3Dmol.StateManager&&(UI=new $3Dmol.StateManager(glviewer))}catch(o){console.log(o),viewerdiv.textContent="WebGL appears to be disabled."}if(datauri.length!=0){let i=0;var process=function(moldata){uri=datauri[i];var type=viewerdiv.dataset.type||viewerdiv.dataset.datatype||datatypes[i];if(glviewer.addModel(moldata,type,options),UI){var modelName=viewerdiv.dataset[datatypes[i]];UI.setModelTitle(modelName)}if(i+=1,i<datauri.length)(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.get)(datauri[i]).then(process);else{if(applyStyles(glviewer),viewerdiv.dataset.callback){var runres=eval(viewerdiv.dataset.callback);typeof runres=="function"&&runres(glviewer)}processing_autoinit=!1,callback&&callback(glviewer)}};(0,_utilities__WEBPACK_IMPORTED_MODULE_2__.get)(datauri[0]).then(process)}else{if(viewerdiv.dataset.element){var moldataid="#"+viewerdiv.dataset.element,molelem=document.querySelector(moldataid),moldata=molelem?molelem.textContent:"";type=viewerdiv.dataset.type||viewerdiv.dataset.datatype,glviewer.addModel(moldata,type,options)}if(applyStyles(glviewer),viewerdiv.dataset.callback){var runres=eval(viewerdiv.dataset.callback);typeof runres=="function"&&runres(glviewer)}processing_autoinit=!1,callback&&callback(glviewer)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&autoload()}},"./src/colors.ts":(o,t,e)=>{e.r(t),e.d(t,{CC:()=>r,Color:()=>n,builtinColorSchemes:()=>p,chains:()=>f,elementColors:()=>c,htmlColors:()=>a,residues:()=>u,ssColors:()=>s});class n{constructor(y,E,h){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof y=="number"?(this.r=y||0,this.g=E||0,this.b=h||0,this):this.set(y||0)}set(y){return y instanceof n?y.clone():(typeof y=="number"?this.setHex(y):typeof y=="object"&&(this.r=(y==null?void 0:y.r)||0,this.g=(y==null?void 0:y.g)||0,this.b=(y==null?void 0:y.b)||0),this)}setHex(y){return y=Math.floor(y),this.r=(y>>16&255)/255,this.g=(y>>8&255)/255,this.b=(y&255)/255,this}getHex(){var y=Math.round(this.r*255),E=Math.round(this.g*255),h=Math.round(this.b*255);return y<<16|E<<8|h}clone(){return new n(this.r,this.g,this.b)}copy(y){return this.r=y.r,this.g=y.g,this.b=y.b,this}scaled(){var y={};return y.r=Math.round(this.r*255),y.g=Math.round(this.g*255),y.b=Math.round(this.b*255),y.a=1,y}}class r{static color(y){if(!y)return r.cache[0];if(y instanceof n)return y;if(typeof y=="number"&&typeof r.cache[y]<"u")return r.cache[y];if(y&&Array.isArray(y))return y.map(r.color);let E=r.getHex(y),h=new n(E);return r.cache[E]=h,h}static getHex(y){var E;if(Array.isArray(y))return y.map(r.getHex);if(typeof y=="string"){let h=y;if(!isNaN(parseInt(h)))return parseInt(h);if(h=h.trim(),h.length==4&&h[0]=="#"&&(h="#"+h[1]+h[1]+h[2]+h[2]+h[3]+h[3]),h.length==7&&h[0]=="#")return parseInt(h.substring(1),16);let v=r.rgbRegEx.exec(h);if(v){v[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let C=0;for(let x=2;x<5;x++){C*=256;let w=v[x].endsWith("%")?255*parseFloat(v[x])/100:parseFloat(v[x]);C+=Math.round(w)}return C}return((E=window==null?void 0:window.$3Dmol)===null||E===void 0?void 0:E.htmlColors[y.toLowerCase()])||0}return y}}r.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,r.cache={0:new n(0)};const a={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},s={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},l={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},c={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:l,defaultColors:Object.assign({},l),greenCarbon:Object.assign(Object.assign({},l),{C:65280}),cyanCarbon:Object.assign(Object.assign({},l),{C:65535}),magentaCarbon:Object.assign(Object.assign({},l),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},l),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},l),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},l),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},l),{C:8388736}),blueCarbon:Object.assign(Object.assign({},l),{C:255})},u={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},f={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},p={ssPyMol:{prop:"ss",map:s.pyMol},ssJmol:{prop:"ss",map:s.Jmol},Jmol:{prop:"elem",map:c.Jmol},amino:{prop:"resn",map:u.amino},shapely:{prop:"resn",map:u.shapely},nucleic:{prop:"resn",map:u.nucleic},chain:{prop:"chain",map:f.atom},rasmol:{prop:"elem",map:c.rasmol},default:{prop:"elem",map:c.defaultColors},greenCarbon:{prop:"elem",map:c.greenCarbon},chainHetatm:{prop:"chain",map:f.hetatm},cyanCarbon:{prop:"elem",map:c.cyanCarbon},magentaCarbon:{prop:"elem",map:c.magentaCarbon},purpleCarbon:{prop:"elem",map:c.purpleCarbon},whiteCarbon:{prop:"elem",map:c.whiteCarbon},orangeCarbon:{prop:"elem",map:c.orangeCarbon},yellowCarbon:{prop:"elem",map:c.yellowCarbon},blueCarbon:{prop:"elem",map:c.blueCarbon}}},"./src/glcartoon.ts":(o,t,e)=>{e.r(t),e.d(t,{drawCartoon:()=>W,subdivide_spline:()=>f});var n=e("./src/WebGL/math/index.ts"),r=e("./src/WebGL/shapes/index.ts"),a=e("./src/WebGL/index.ts"),s=e("./src/Gradient.ts"),l=e("./src/colors.ts"),c=e("./src/GLDraw.ts"),u=e("./src/utilities.ts");function f(D,O){var z=[],G=D;G=[],G.push(D[0]);var k,$,Z,K,j,Q,le,he,ve;for(k=1,$=D.length-1;k<$;k++)if(j=D[k],Q=D[k+1],j.smoothen){var re=new n.Vector3((j.x+Q.x)/2,(j.y+Q.y)/2,(j.z+Q.z)/2);re.atom=j.atom,G.push(re)}else G.push(j);for(G.push(D[D.length-1]),k=-1,Z=G.length;k<=Z-3;k++)if(K=G[k===-1?0:k],j=G[k+1],Q=G[k+2],le=G[k===Z-3?Z-1:k+3],he=new n.Vector3().subVectors(Q,K).multiplyScalar(.5),ve=new n.Vector3().subVectors(le,j).multiplyScalar(.5),!Q.skip)for(var Ie=0;Ie<O;Ie++){var ge=1/O*Ie,Se=j.x+ge*he.x+ge*ge*(-3*j.x+3*Q.x-2*he.x-ve.x)+ge*ge*ge*(2*j.x-2*Q.x+he.x+ve.x),Le=j.y+ge*he.y+ge*ge*(-3*j.y+3*Q.y-2*he.y-ve.y)+ge*ge*ge*(2*j.y-2*Q.y+he.y+ve.y),be=j.z+ge*he.z+ge*ge*(-3*j.z+3*Q.z-2*he.z-ve.z)+ge*ge*ge*(2*j.z-2*Q.z+he.z+ve.z),ye=new n.Vector3(Se,Le,be);Ie<O/2?ye.atom=j.atom:ye.atom=Q.atom,z.push(ye)}return z.push(G[G.length-1]),z}const p=.5,g=1.3,y=.8,E=.4,h=.4;function v(D,O,z,G){for(var k,$,Z,K,j=0,Q=O.length;j<Q;j++){K=Math.round(j*(G.length-1)/Q),Z=l.CC.color(G[K]);var le=D.updateGeoGroup(2),he=le.vertexArray,ve=le.colorArray,re=le.faceArray;k=le.vertices,$=k*3,he[$]=O[j].x,he[$+1]=O[j].y,he[$+2]=O[j].z,he[$+3]=z[j].x,he[$+4]=z[j].y,he[$+5]=z[j].z;for(var Ie=0;Ie<6;++Ie)ve[$+3*Ie]=Z.r,ve[$+1+3*Ie]=Z.g,ve[$+2+3*Ie]=Z.b;if(j>0){var ge=[k,k+1,k-1,k-2],Se=le.faceidx;re[Se]=ge[0],re[Se+1]=ge[1],re[Se+2]=ge[3],re[Se+3]=ge[1],re[Se+4]=ge[2],re[Se+5]=ge[3],le.faceidx+=6}le.vertices+=2}}function C(D,O,z,G,k,$,Z){var K,j,Q,le;if(Q=O.length,Q<2||O[0].length<2)return;for(K=0;K<Q;K++)O[K]=f(O[K],G);if(le=O[0].length,!k)return v(D,O[0],O[Q-1],z);var he,ve,re,Ie,ge,Se,Le=[],be=[],ye=[];for(j=0;j<Q;j++)Le.push(.25+1.5*Math.sqrt((Q-1)*j-Math.pow(j,2))/(Q-1)),be.push(.5),ye.push(2*(Math.pow(j/Q,2)-j/Q)+.6);var ce=[];for(j=0;j<Q*2-1;j++)ce[j]=[j,j+1,j+1-2*Q,j-2*Q];ce[Q*2-1]=[j,j+1-2*Q,j+1-4*Q,j-2*Q];var ue,Ce,Ve,ie,ae,Ae,De,Be,ze,We;let $e=D.updateGeoGroup();for(K=0;K<le;K++){let H=D.groups,X=!1;$e=D.updateGeoGroup(2*Q),H!=D.groups&&K>0&&(K=K-1,X=!0),Ae=Math.round(K*(z.length-1)/le),ae=l.CC.color(z[Ae]),ge=re,Se=Ie,re=[],Ie=[],he=[],O[0][K].atom!==void 0&&(ie=O[0][K].atom,Z==="oval"?ve=Le:Z==="rectangle"?ve=be:Z==="parabola"&&(ve=ye)),ve||(ve=be);var qe,et;for(j=0;j<Q;j++)K<le-1?qe=O[j][K+1].clone().sub(O[j][K]):qe=O[j][K-1].clone().sub(O[j][K]).negate(),j<Q-1?et=O[j+1][K].clone().sub(O[j][K]):et=O[j-1][K].clone().sub(O[j][K]).negate(),he[j]=et.cross(qe).normalize().multiplyScalar(k*ve[j]);for(j=0;j<Q;j++)re[j]=O[j][K].clone().add(he[j].clone().negate());for(j=0;j<Q;j++)Ie[j]=O[j][K].clone().add(he[j]);for(De=$e.vertexArray,Be=$e.colorArray,ze=$e.faceArray,ue=$e.vertices,Ce=ue*3,j=0;j<Q;j++)De[Ce+3*j+0]=re[j].x,De[Ce+3*j+1]=re[j].y,De[Ce+3*j+2]=re[j].z;for(j=0;j<Q;j++)De[Ce+3*j+0+3*Q]=Ie[Q-1-j].x,De[Ce+3*j+1+3*Q]=Ie[Q-1-j].y,De[Ce+3*j+2+3*Q]=Ie[Q-1-j].z;for(j=0;j<2*Q;++j)Be[Ce+3*j+0]=ae.r,Be[Ce+3*j+1]=ae.g,Be[Ce+3*j+2]=ae.b;if(K>0&&!X){for(j=0;j<Q*2;j++)We=[ue+ce[j][0],ue+ce[j][1],ue+ce[j][2],ue+ce[j][3]],Ve=$e.faceidx,ze[Ve]=We[0],ze[Ve+1]=We[1],ze[Ve+2]=We[3],ze[Ve+3]=We[1],ze[Ve+4]=We[2],ze[Ve+5]=We[3],$e.faceidx+=6;if(ie.clickable||ie.hoverable){var F=[];F.push(new r.Triangle(ge[0],re[0],re[Q-1])),F.push(new r.Triangle(ge[0],re[Q-1],ge[Q-1])),F.push(new r.Triangle(ge[Q-1],re[Q-1],Ie[Q-1])),F.push(new r.Triangle(ge[Q-1],Ie[Q-1],Se[Q-1])),F.push(new r.Triangle(Ie[0],Se[0],Se[Q-1])),F.push(new r.Triangle(Ie[Q-1],Ie[0],Se[Q-1])),F.push(new r.Triangle(re[0],ge[0],Se[0])),F.push(new r.Triangle(Ie[0],re[0],Se[0]));for(j in F)ie.intersectionShape.triangle.push(F[j])}}$e.vertices+=2*Q}for(De=$e.vertexArray,Be=$e.colorArray,ze=$e.faceArray,ue=$e.vertices,Ce=ue*3,Ve=$e.faceidx,K=0;K<Q-1;K++)We=[K,K+1,2*Q-2-K,2*Q-1-K],Ve=$e.faceidx,ze[Ve]=We[0],ze[Ve+1]=We[1],ze[Ve+2]=We[3],ze[Ve+3]=We[1],ze[Ve+4]=We[2],ze[Ve+5]=We[3],$e.faceidx+=6;for(K=0;K<Q-1;K++)We=[ue-1-K,ue-2-K,ue-2*Q+K+1,ue-2*Q+K],Ve=$e.faceidx,ze[Ve]=We[0],ze[Ve+1]=We[1],ze[Ve+2]=We[3],ze[Ve+3]=We[1],ze[Ve+4]=We[2],ze[Ve+5]=We[3],$e.faceidx+=6}function x(D,O,z,G,k,$){if(!(O.length<2)){var Z,K;if(Z=O[0],K=O[O.length-1],Z=f(Z,G),K=f(K,G),!k)return v(D,Z,K,z);var j=[],Q,le,he,ve,re,Ie=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],ge,Se,Le,be,ye,ce,ue,Ce,Ve,ie,ae,Ae,De,Be,ze,We,$e;for(Ce=0,Ve=Z.length;Ce<Ve;Ce++){if(ye=Math.round(Ce*(z.length-1)/Ve),be=l.CC.color(z[ye]),j.push(le=Z[Ce]),j.push(le),j.push(he=K[Ce]),j.push(he),Ce<Ve-1){var qe=Z[Ce+1].clone().sub(Z[Ce]),et=K[Ce].clone().sub(Z[Ce]);Q=et.cross(qe).normalize().multiplyScalar(k)}for(j.push(ve=Z[Ce].clone().add(Q)),j.push(ve),j.push(re=K[Ce].clone().add(Q)),j.push(re),le.atom!==void 0&&(ce=le.atom),Be=D.updateGeoGroup(8),ze=Be.vertexArray,We=Be.colorArray,$e=Be.faceArray,ge=Be.vertices,Se=ge*3,ze[Se]=le.x,ze[Se+1]=le.y,ze[Se+2]=le.z,ze[Se+3]=le.x,ze[Se+4]=le.y,ze[Se+5]=le.z,ze[Se+6]=he.x,ze[Se+7]=he.y,ze[Se+8]=he.z,ze[Se+9]=he.x,ze[Se+10]=he.y,ze[Se+11]=he.z,ze[Se+12]=ve.x,ze[Se+13]=ve.y,ze[Se+14]=ve.z,ze[Se+15]=ve.x,ze[Se+16]=ve.y,ze[Se+17]=ve.z,ze[Se+18]=re.x,ze[Se+19]=re.y,ze[Se+20]=re.z,ze[Se+21]=re.x,ze[Se+22]=re.y,ze[Se+23]=re.z,ie=0;ie<8;++ie)We[Se+3*ie]=be.r,We[Se+1+3*ie]=be.g,We[Se+2+3*ie]=be.b;if(Ce>0){var F=ue!==void 0&&ce!==void 0&&ue.serial!==ce.serial;for(ie=0;ie<4;ie++){var H=[ge+Ie[ie][0],ge+Ie[ie][1],ge+Ie[ie][2],ge+Ie[ie][3]];if(Le=Be.faceidx,$e[Le]=H[0],$e[Le+1]=H[1],$e[Le+2]=H[3],$e[Le+3]=H[1],$e[Le+4]=H[2],$e[Le+5]=H[3],Be.faceidx+=6,ce.clickable||ue.clickable||ce.hoverable||ue.hoverable){var X=j[H[3]].clone(),oe=j[H[0]].clone(),te=j[H[2]].clone(),Me=j[H[1]].clone();if(X.atom=j[H[3]].atom||null,te.atom=j[H[2]].atom||null,oe.atom=j[H[0]].atom||null,Me.atom=j[H[1]].atom||null,F){var Te=X.clone().add(oe).multiplyScalar(.5),q=te.clone().add(Me).multiplyScalar(.5),Ee=X.clone().add(Me).multiplyScalar(.5);ie%2===0?((ue.clickable||ue.hoverable)&&(ae=new r.Triangle(Te,Ee,X),Ae=new r.Triangle(q,te,Ee),De=new r.Triangle(Ee,te,X),ue.intersectionShape.triangle.push(ae),ue.intersectionShape.triangle.push(Ae),ue.intersectionShape.triangle.push(De)),(ce.clickable||ce.hoverable)&&(ae=new r.Triangle(oe,Me,Ee),Ae=new r.Triangle(Me,q,Ee),De=new r.Triangle(oe,Ee,Te),ce.intersectionShape.triangle.push(ae),ce.intersectionShape.triangle.push(Ae),ce.intersectionShape.triangle.push(De))):((ce.clickable||ce.hoverable)&&(ae=new r.Triangle(Te,Ee,X),Ae=new r.Triangle(q,te,Ee),De=new r.Triangle(Ee,te,X),ce.intersectionShape.triangle.push(ae),ce.intersectionShape.triangle.push(Ae),ce.intersectionShape.triangle.push(De)),(ue.clickable||ue.hoverable)&&(ae=new r.Triangle(oe,Me,Ee),Ae=new r.Triangle(Me,q,Ee),De=new r.Triangle(oe,Ee,Te),ue.intersectionShape.triangle.push(ae),ue.intersectionShape.triangle.push(Ae),ue.intersectionShape.triangle.push(De)))}else(ce.clickable||ce.hoverable)&&(ae=new r.Triangle(oe,Me,X),Ae=new r.Triangle(Me,te,X),ce.intersectionShape.triangle.push(ae),ce.intersectionShape.triangle.push(Ae))}}}Be.vertices+=8,ue=ce}var Pe=j.length-8;for(Be=D.updateGeoGroup(8),ze=Be.vertexArray,We=Be.colorArray,$e=Be.faceArray,ge=Be.vertices,Se=ge*3,Le=Be.faceidx,Ce=0;Ce<4;Ce++){j.push(j[Ce*2]),j.push(j[Pe+Ce*2]);var tt=j[Ce*2],Oe=j[Pe+Ce*2];ze[Se+6*Ce]=tt.x,ze[Se+1+6*Ce]=tt.y,ze[Se+2+6*Ce]=tt.z,ze[Se+3+6*Ce]=Oe.x,ze[Se+4+6*Ce]=Oe.y,ze[Se+5+6*Ce]=Oe.z,We[Se+6*Ce]=be.r,We[Se+1+6*Ce]=be.g,We[Se+2+6*Ce]=be.b,We[Se+3+6*Ce]=be.r,We[Se+4+6*Ce]=be.g,We[Se+5+6*Ce]=be.b}Pe+=8,ae=[ge,ge+2,ge+6,ge+4],Ae=[ge+1,ge+5,ge+7,ge+3],$e[Le]=ae[0],$e[Le+1]=ae[1],$e[Le+2]=ae[3],$e[Le+3]=ae[1],$e[Le+4]=ae[2],$e[Le+5]=ae[3],$e[Le+6]=Ae[0],$e[Le+7]=Ae[1],$e[Le+8]=Ae[3],$e[Le+9]=Ae[1],$e[Le+10]=Ae[2],$e[Le+11]=Ae[3],Be.faceidx+=12,Be.vertices+=8}}function w(D,O,z,G,k,$,Z){(!Z||Z==="default")&&(Z="rectangle"),Z==="edged"?x(D,O,z,G,k):(Z==="rectangle"||Z==="oval"||Z==="parabola")&&C(D,O,z,G,k,$,Z)}function _(D){return D&&D.elem==="C"&&D.atom==="CA"}function S(D,O){if(D&&O&&D.chain===O.chain){if(!D.hetflag&&!O.hetflag&&D.reschain===O.reschain&&(D.resi===O.resi||D.resi===O.resi-1))return!0;if(D.resi<O.resi){var z=D.x-O.x,G=D.y-O.y,k=D.z-O.z,$=z*z+G*G+k*k;if(D.atom=="CA"&&O.atom=="CA"&&$<16)return!0;if((D.atom=="P"||O.atom=="P")&&$<64)return!0}}return!1}function M(D,O,z,G,k){if(!(O==null||O.vertices==0)){k&&(O.initTypedArrays(),O.setUpNormals());var $=new a.MeshDoubleLambertMaterial;$.vertexColors=a.Coloring.FaceColors,typeof z=="number"&&z>=0&&z<1&&($.transparent=!0,$.opacity=z),$.outline=G;var Z=new a.Mesh(O,$);D.add(Z)}}function T(D,O,z,G,k,$,Z,K,j){var Q,le,he,ve,re,Ie;if(!(!G||!k||!Z)){var ge=k.sub(G);ge.normalize();var Se=K[j];for(le=j+1;le<K.length&&(Se=K[le],Se.atom!=Z.atom);le++);if(Se=Se?new n.Vector3(Se.x,Se.y,Se.z):new n.Vector3(0,0,0),Se.sub(G),Z.ss==="arrow start"){var Le=Se.clone().multiplyScalar(.3).cross(k);G.add(Le);var be=Se.clone().cross(ge).normalize();ge.rotateAboutVector(be,.43)}for(Z.style.cartoon.ribbon?Q=Z.style.cartoon.thickness||E:Z.style.cartoon.width?Q=Z.style.cartoon.width:Z.ss==="c"?Z.atom==="P"?Q=y:Q=p:Z.ss==="arrow start"?(Q=g,re=!0):Z.ss==="arrow end"||Z.ss==="h"&&Z.style.cartoon.tubes||Z.ss==="tube start"?Q=p:Q=g,$!=null&&ge.dot($)<0&&ge.negate(),ge.multiplyScalar(Q),le=0;le<O;le++)he=-1+le*2/(O-1),ve=new n.Vector3(G.x+he*ge.x,G.y+he*ge.y,G.z+he*ge.z),ve.atom=Z,z&&Z.ss==="s"&&(ve.smoothen=!0),D[le].push(ve);if(re)for(ge.multiplyScalar(2),le=0;le<O;le++)he=-1+le*2/(O-1),ve=new n.Vector3(G.x+he*ge.x,G.y+he*ge.y,G.z+he*ge.z),ve.atom=Z,ve.smoothen=!1,ve.skip=!0,D[le].push(ve);return Ie=Z.style.cartoon.style||"default",D.style?D.style!=Ie&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),D.style="default"):D.style=Ie,(Z.ss==="arrow start"||Z.ss==="arrow end")&&(Z.ss="s"),re}}const R={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},P={DA:!0,DG:!0,A:!0,G:!0},I={DT:!0,DC:!0,U:!0,C:!0,T:!0},B={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function W(D,O,z,G=10){let k=G,$=G;var Z,K,j,Q,le,he,ve,re,Ie,ge,Se,Le,be,ye,ce,ue,Ce,Ve,ie=new a.Geometry(!0),ae=new a.Geometry(!0),Ae=[],De=[],Be=1,ze=!1,We={};for(var $e in s.Gradient.builtinGradients)s.Gradient.builtinGradients.hasOwnProperty($e)&&(We[$e]=new s.Gradient.builtinGradients[$e](z[1],z[0]));var qe=function(ee,Fe){return z&&Fe.color==="spectrum"?Fe.colorscheme in We?We[Fe.colorscheme].valueToHex(ee.resi):We.sinebow.valueToHex(ee.resi):(0,u.getColorFromStyle)(ee,Fe).getHex()};for(re=0;re<k;re++)De[re]=[];var et=!1,F=!1,H=[];for(re in O){if(Q=O[re],Q.elem==="C"&&Q.atom==="CA"){var X=S(j,Q);X&&Q.ss==="s"?et=!0:et&&(j&&K&&j.style.cartoon.arrows&&K.style.cartoon.arrows&&(j.ss="arrow end",K.ss="arrow start"),et=!1),X&&(j.ss==="h"||j.ss=="tube start")&&j.style.cartoon.tubes?!F&&j.ss!="tube start"&&Q.style.cartoon.tubes&&(Q.ss="tube start",F=!0):F&&(j.ss==="tube start"?j.ss="tube end":K&&K.style.cartoon.tubes&&(K.ss="tube end"),F=!1),K=j,j=Q}Q&&Q.atom in R&&H.push(Q)}F&&j.style.cartoon.tubes&&(j.ss="tube end",F=!1);var oe=function(ee){De[0].length>0&&w(ae,De,Ae,$,ve,Be,De.style);var Fe=[],it=null;if(ee){for(re=0;re<k;re++)Fe[re]=De[re][De[re].length-1];it=Ae[Ae.length-1]}for(De=[],re=0;re<k;re++)De[re]=[];if(Ae=[],ee){for(re=0;re<k;re++)De[re].push(Fe[re]);Ae.push(it)}M(D,ae,Be,ze,!0),M(D,ie,Be,ze,!1),ae=new a.Geometry(!0),ie=new a.Geometry(!0)};j=void 0;for(var te=0;te<H.length;te++){Q=H[te];var Me=Q.resn.trim(),Te=Me in B;if(Be=1,Z=Q.style.cartoon,j&&j.style.cartoon&&(Be=j.style.cartoon.opacity),j&&j.style.cartoon&&j.style.cartoon.outline&&(ze=j.style.cartoon.outline),j&&j.style.cartoon&&(!Q.style.cartoon||j.style.cartoon.opacity!=Q.style.cartoon.opacity)&&oe(j.chain==Q.chain),Z.style==="trace"){if(!Q.hetflag){if(Q.elem==="C"&&Q.atom==="CA"||Te&&Q.atom==="P"||Q.atom==="BB"){if(he=qe(Q,Z),(0,u.isNumeric)(Z.thickness)?ve=Z.thickness:ve=E,S(j,Q))if(he==le){var q=l.CC.color(he);c.GLDraw.drawCylinder(ie,j,Q,ve,q,2,2)}else{var Ee=new n.Vector3().addVectors(j,Q).multiplyScalar(.5),Pe=l.CC.color(le),tt=l.CC.color(he);c.GLDraw.drawCylinder(ie,j,Ee,ve,Pe,2,0),c.GLDraw.drawCylinder(ie,Ee,Q,ve,tt,0,2)}if((Q.clickable===!0||Q.hoverable)&&Q.intersectionShape!==void 0){var Oe=new n.Vector3(Q.x,Q.y,Q.z);Q.intersectionShape.sphere.push(new r.Sphere(Oe,ve))}j=Q,le=he}}}else{if(_(Q)||Te&&(Q.atom==="P"||Q.atom.indexOf("O5")==0)){if(Ve)if(Q.ss==="tube end")Ve=!1,Ce=new n.Vector3(Q.x,Q.y,Q.z),c.GLDraw.drawCylinder(ie,ue,Ce,2,l.CC.color(le),1,1),Q.ss="h";else if(j.chain!=Q.chain||j.ss==="tube end")Ve=!1,j.ss="h",Ce=new n.Vector3(j.x,j.y,j.z),c.GLDraw.drawCylinder(ie,ue,Ce,2,l.CC.color(le),1,1);else continue;if(j&&(!S(j,Q)||j.ss==="tube start")){for(j.ss==="tube start"&&(Ve=!0,ue=new n.Vector3(j.x,j.y,j.z),j.ss="h"),ce&&(Le?ye=new n.Vector3().addVectors(j,Le).multiplyScalar(.5):ye=new n.Vector3(j.x,j.y,j.z),c.GLDraw.drawCylinder(ie,ye,ce,h,l.CC.color(ce.color),0,2),T(De,k,!0,Le,be,Se,j,H,te),Ae.push(he),ye=null,ce=null),De[0].length>0&&w(ae,De,Ae,$,ve,Be,De.style),De=[],re=0;re<k;re++)De[re]=[];Ae=[]}if(j===void 0||j.rescode!=Q.rescode||j.resi!=Q.resi){if(ce){ye=new n.Vector3().addVectors(j,Q).multiplyScalar(.5);var Je=ye.clone().sub(ce).multiplyScalar(.02);ye.add(Je),c.GLDraw.drawCylinder(ie,ye,ce,h,l.CC.color(ce.color),0,2),ye=null,ce=null}he=qe(Q,Z),Ae.push(he),(0,u.isNumeric)(Z.thickness)?ve=Z.thickness:ve=E,j=Q,Ie=new n.Vector3(j.x,j.y,j.z),Ie.resi=j.resi,le=he}(Q.clickable===!0||Q.hoverable===!0)&&(Q.intersectionShape===void 0||Q.intersectionShape.triangle===void 0)&&(Q.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else _(j)&&Q.atom==="O"||Te&&j.atom==="P"&&(Q.atom==="OP2"||Q.atom==="O2P")||Te&&j.atom.indexOf("O5")==0&&Q.atom.indexOf("C5")==0?(ge=new n.Vector3(Q.x,Q.y,Q.z),ge.resi=Q.resi,(Q.atom==="OP2"||Q.atom==="O2P")&&(be=new n.Vector3(Q.x,Q.y,Q.z))):Te&&Q.atom.indexOf("O3")==0?Le=new n.Vector3(Q.x,Q.y,Q.z):(Q.atom==="N1"&&Me in P||Q.atom==="N3"&&Me in I)&&(ce=new n.Vector3(Q.x,Q.y,Q.z),ce.color=(0,u.getColorFromStyle)(Q,Z).getHex());ge&&Ie&&ge.resi===Ie.resi&&(T(De,k,!0,Ie,ge,Se,j,H,te),Se=ge,Ie=null,ge=null,Ae.push(he))}}ce&&(Le?ye=new n.Vector3().addVectors(j,Le).multiplyScalar(.5):ye=new n.Vector3(j.x,j.y,j.z),c.GLDraw.drawCylinder(ie,ye,ce,h,l.CC.color(ce.color),0,2),T(De,k,!0,Le,be,Se,j,H,te),Ae.push(he)),oe(!1)}},"./src/index.ts":(o,t,e)=>{e.r(t),e.d(t,{CAP:()=>h.CAP,CC:()=>r.CC,Color:()=>r.Color,CustomLinear:()=>n.CustomLinear,Cylinder:()=>u.Cylinder,GLDraw:()=>h.GLDraw,GLModel:()=>C.GLModel,GLShape:()=>E.GLShape,GLViewer:()=>x.GLViewer,GLVolumetricRender:()=>y.GLVolumetricRender,Gradient:()=>n.Gradient,GradientType:()=>n.GradientType,Label:()=>a.Label,LabelCount:()=>a.LabelCount,MarchingCube:()=>p.MarchingCube,MarchingCubeInitializer:()=>p.MarchingCubeInitializer,Matrix3:()=>c.Matrix3,Matrix4:()=>c.Matrix4,Parsers:()=>l.Parsers,PausableTimer:()=>f.PausableTimer,PointGrid:()=>p.PointGrid,ProteinSurface:()=>p.ProteinSurface,Quaternion:()=>c.Quaternion,ROYGB:()=>n.ROYGB,RWB:()=>n.RWB,Ray:()=>c.Ray,Sinebow:()=>n.Sinebow,Sphere:()=>u.Sphere,SurfaceType:()=>p.SurfaceType,Triangle:()=>u.Triangle,Vector2:()=>c.Vector2,Vector3:()=>c.Vector3,VolumeData:()=>g.VolumeData,adjustVolumeStyle:()=>f.adjustVolumeStyle,applyPartialCharges:()=>s.applyPartialCharges,autoinit:()=>w.autoinit,autoload:()=>w.autoload,base64ToArray:()=>f.base64ToArray,bondLength:()=>l.bondLength,builtinColorSchemes:()=>r.builtinColorSchemes,builtinGradients:()=>n.builtinGradients,chains:()=>r.chains,clamp:()=>c.clamp,conversionMatrix3:()=>c.conversionMatrix3,createStereoViewer:()=>x.createStereoViewer,createViewer:()=>x.createViewer,createViewerGrid:()=>x.createViewerGrid,deepCopy:()=>f.deepCopy,degToRad:()=>c.degToRad,download:()=>f.download,drawCartoon:()=>v.drawCartoon,elementColors:()=>r.elementColors,extend:()=>f.extend,get:()=>f.get,getAtomProperty:()=>f.getAtomProperty,getColorFromStyle:()=>f.getColorFromStyle,getElement:()=>f.getElement,getExtent:()=>f.getExtent,getGradient:()=>n.getGradient,getPropertyRange:()=>f.getPropertyRange,getbin:()=>f.getbin,htmlColors:()=>r.htmlColors,isEmptyObject:()=>f.isEmptyObject,isNumeric:()=>f.isNumeric,makeFunction:()=>f.makeFunction,mergeGeos:()=>f.mergeGeos,normalizeValue:()=>n.normalizeValue,partialCharges:()=>s.partialCharges,processing_autoinit:()=>w.processing_autoinit,residues:()=>r.residues,setBondLength:()=>l.setBondLength,setSyncSurface:()=>p.setSyncSurface,specStringToObject:()=>f.specStringToObject,splitMesh:()=>E.splitMesh,ssColors:()=>r.ssColors,subdivide_spline:()=>v.subdivide_spline,syncSurface:()=>p.syncSurface,viewers:()=>w.viewers});var n=e("./src/Gradient.ts"),r=e("./src/colors.ts"),a=e("./src/Label.ts"),s=e("./src/partialCharges.ts"),l=e("./src/parsers/index.ts"),c=e("./src/WebGL/math/index.ts"),u=e("./src/WebGL/shapes/index.ts"),f=e("./src/utilities.ts"),p=e("./src/ProteinSurface4.ts"),g=e("./src/VolumeData.ts"),y=e("./src/VolumetricRender.ts"),E=e("./src/GLShape.ts"),h=e("./src/GLDraw.ts"),v=e("./src/glcartoon.ts"),C=e("./src/GLModel.ts"),x=e("./src/GLViewer.ts"),w=e("./src/autoload.ts");e("./src/specs.ts"),window&&(window.$3Dmol=t)},"./src/parsers/CDJSON.ts":(o,t,e)=>{e.r(t),e.d(t,{CDJSON:()=>n});function n(r,a){var s=[[]];typeof r=="string"&&(r=JSON.parse(r));for(var l=r.m,c=l[0].a,u=l[0].b,f=l[0].s,p=a!==void 0&&a.parseStyle!==void 0?a.parseStyle:f!==void 0,g=s[s.length-1].length,y=0;y<c.length;y++){var E=c[y],h={};h.id=E.i,h.x=E.x,h.y=E.y,h.z=E.z||0,h.bonds=[],h.bondOrder=[];var v=E.l||"C";h.elem=v[0].toUpperCase()+v.substring(1).toLowerCase(),h.serial=s[s.length-1].length,p&&(h.style=f[E.s||0]),s[s.length-1].push(h)}for(let C=0;C<u.length;C++){let x=u[C],w=x.b+g,_=x.e+g,S=x.o||1,M=s[s.length-1][w],T=s[s.length-1][_];M.bonds.push(_),M.bondOrder.push(S),T.bonds.push(w),T.bondOrder.push(S)}return s}},"./src/parsers/CIF.ts":(o,t,e)=>{e.r(t),e.d(t,{CIF:()=>l});var n=e("./src/parsers/utils/assignBonds.ts"),r=e("./src/parsers/utils/computeSecondaryStructure.ts"),a=e("./src/parsers/utils/processSymmetries.ts"),s=e("./src/WebGL/index.ts");function l(c,u={}){var f=[],p=!u.doAssembly,g=f.modelData=[],y=u.assignBonds===void 0?!0:u.assignBonds,E=function(H,X,oe,te){return new s.Vector3(X,oe,te).applyMatrix3(H)};function h(H,X){for(var oe=[],te=0,Me=0;Me<H.length;){for(;H.substring(Me,Me+X.length)!==X&&Me<H.length;){if(H[Me]==="'")for(Me++;Me<H.length&&H[Me]!=="'";)Me++;else if(H[Me]==='"')for(Me++;Me<H.length&&H[Me]!=='"';)Me++;Me++}oe.push(H.substring(te,Me)),te=Me=Me+X.length}return oe}var v=c.split(/\r?\n|\r/),C=[],x=!1;for(let H=0;H<v.length;H++){var w=v[H].split("#")[0];if(x?w[0]===";"&&(x=!1):w[0]===";"&&(x=!0),x||w!==""){if(!x&&(w=w.trim(),w[0]==="_")){var _=w.split(/\s/)[0].indexOf(".");if(_>-1){let X=w.split("");X[_]="_",w=X.join(""),w=w.substring(0,_)+"_"+w.substring(_+1)}}C.push(w)}}for(var S=0;S<C.length;){for(;!C[S].startsWith("data_")||C[S]==="data_global";)S++;S++;for(var M={};S<C.length&&!C[S].startsWith("data_");)if(C[S][0]===void 0)S++;else if(C[S][0]==="_"){var T=C[S].split(/\s/)[0].toLowerCase(),R=M[T]=M[T]||[],P=C[S].substring(C[S].indexOf(T)+T.length);if(P==="")if(S++,C[S][0]===";"){var I=C[S].substring(1);for(S++;C[S]!==";";)I=I+`
`+C[S],S++;R.push(I)}else R.push(C[S]);else R.push(P.trim());S++}else if(C[S].substring(0,5)==="loop_"){S++;for(var B=[];C[S]===""||C[S][0]==="_";){if(C[S]!==""){let H=C[S].split(/\s/)[0].toLowerCase(),X=M[H]=M[H]||[];B.push(X)}S++}for(var W=0;S<C.length&&C[S][0]!=="_"&&!C[S].startsWith("loop_")&&!C[S].startsWith("data_");){let H=h(C[S]," ");for(var D=0;D<H.length;D++)H[D]!==""&&(B[W].push(H[D]),W=(W+1)%B.length);S++}}else S++;g.push({symmetries:[]}),f.push([]);var O=M._atom_site_id!==void 0?M._atom_site_id.length:M._atom_site_label.length,z;if(M._cell_length_a!==void 0){var G=parseFloat(M._cell_length_a),k=parseFloat(M._cell_length_b),$=parseFloat(M._cell_length_c),Z=parseFloat(M._cell_angle_alpha)||90,K=parseFloat(M._cell_angle_beta)||90,j=parseFloat(M._cell_angle_gamma)||90;z=(0,s.conversionMatrix3)(G,k,$,Z,K,j),g[g.length-1].cryst={a:G,b:k,c:$,alpha:Z,beta:K,gamma:j}}for(var Q=0;Q<O;Q++)if(!(M._atom_site_group_pdb!==void 0&&M._atom_site_group_pdb[Q]==="TER")){var le={};if(M._atom_site_cartn_x!==void 0)le.x=parseFloat(M._atom_site_cartn_x[Q]),le.y=parseFloat(M._atom_site_cartn_y[Q]),le.z=parseFloat(M._atom_site_cartn_z[Q]);else{var he=E(z,parseFloat(M._atom_site_fract_x[Q]),parseFloat(M._atom_site_fract_y[Q]),parseFloat(M._atom_site_fract_z[Q]));le.x=he.x,le.y=he.y,le.z=he.z}le.chain=M._atom_site_auth_asym_id?M._atom_site_auth_asym_id[Q]:void 0,le.resi=M._atom_site_auth_seq_id?parseInt(M._atom_site_auth_seq_id[Q]):void 0,le.resn=M._atom_site_auth_comp_id?M._atom_site_auth_comp_id[Q].trim():void 0,le.atom=M._atom_site_auth_atom_id?M._atom_site_auth_atom_id[Q].replace(/"/gm,""):void 0,le.hetflag=!M._atom_site_group_pdb||M._atom_site_group_pdb[Q]==="HETA"||M._atom_site_group_pdb[Q]==="HETATM";var ve="X";M._atom_site_type_symbol?ve=M._atom_site_type_symbol[Q].replace(/\(?\+?\d+.*/,""):M._atom_site_label&&(ve=M._atom_site_label[Q].split("_")[0].replace(/\(?\d+.*/,"")),le.elem=ve[0].toUpperCase()+ve.substring(1,2).toLowerCase(),le.bonds=[],le.ss="c",le.serial=Q,le.bondOrder=[],le.properties={},f[f.length-1].push(le)}if(M._pdbx_struct_oper_list_id!==void 0&&!p)for(let H=0;H<M._pdbx_struct_oper_list_id.length;H++){var re=parseFloat(M["_pdbx_struct_oper_list_matrix[1][1]"][H]),Ie=parseFloat(M["_pdbx_struct_oper_list_matrix[1][2]"][H]),ge=parseFloat(M["_pdbx_struct_oper_list_matrix[1][3]"][H]),Se=parseFloat(M["_pdbx_struct_oper_list_vector[1]"][H]),Le=parseFloat(M["_pdbx_struct_oper_list_matrix[2][1]"][H]),be=parseFloat(M["_pdbx_struct_oper_list_matrix[2][2]"][H]),ye=parseFloat(M["_pdbx_struct_oper_list_matrix[2][3]"][H]),ce=parseFloat(M["_pdbx_struct_oper_list_vector[2]"][H]),ue=parseFloat(M["_pdbx_struct_oper_list_matrix[3][1]"][H]),Ce=parseFloat(M["_pdbx_struct_oper_list_matrix[3][2]"][H]),Ve=parseFloat(M["_pdbx_struct_oper_list_matrix[3][3]"][H]),ie=parseFloat(M["_pdbx_struct_oper_list_vector[3]"][H]),ae=new s.Matrix4(re,Ie,ge,Se,Le,be,ye,ce,ue,Ce,Ve,ie);g[g.length-1].symmetries.push(ae)}var Ae=function(H){var X=H.match("-");H=H.replace(/[-xyz]/g,"");var oe=H.split("/"),te,Me;return oe[1]===void 0?Me=1:Me=parseInt(oe[1]),oe[0]===""?te=1:te=parseInt(oe[0]),te/Me*(X?-1:1)};if(M._symmetry_equiv_pos_as_xyz!==void 0&&!p)for(var De=0;De<M._symmetry_equiv_pos_as_xyz.length;De++){var Be=M._symmetry_equiv_pos_as_xyz[De].replace(/["' ]/g,""),ze=Be.split(",").map(function(X){return X.replace(/-/g,"+-")});let H=new s.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let X=0;X<3;X++){var We=ze[X].split("+");for(let oe=0;oe<We.length;oe++){var $e=We[oe];if($e!==""){var qe=Ae($e);$e.match("x")?H.elements[X+0]=qe:$e.match("y")?H.elements[X+4]=qe:$e.match("z")?H.elements[X+8]=qe:H.elements[X+12]=qe}}}var et=z.getMatrix4(),F=new s.Matrix4().getInverse(et,!0);H=new s.Matrix4().multiplyMatrices(H,F),H=new s.Matrix4().multiplyMatrices(et,H),g[g.length-1].symmetries.push(H)}}for(let H=0;H<f.length;H++)y&&(0,n.assignBonds)(f[H]),(0,r.computeSecondaryStructure)(f[H],u.hbondCutoff),(0,a.processSymmetries)(g[H].symmetries,f[H],u,g[H].cryst),u.duplicateAssemblyAtoms&&!u.dontConnectDuplicatedAtoms&&y&&(0,n.assignBonds)(f[H]);return f}},"./src/parsers/CUBE.ts":(o,t,e)=>{e.r(t),e.d(t,{CUBE:()=>s});var n=e("./src/WebGL/index.ts"),r=e("./src/parsers/utils/assignBonds.ts"),a=e("./src/parsers/utils/anumToSymbol.ts");function s(l,c){c=c||{};var u=[[]],f=l.split(/\r?\n/),p=c.assignBonds===void 0?!0:c.assignBonds;if(f.length<6)return u;var g=f[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),y=Math.abs(parseFloat(g[0]));let E={};var h=E.origin=new n.Vector3(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));g=f[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),g=f[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var v=g[0]>0?.529177:1;h.multiplyScalar(v);var C=Math.abs(g[0]),x=new n.Vector3(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])).multiplyScalar(v);g=f[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var w=Math.abs(g[0]),_=new n.Vector3(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])).multiplyScalar(v);g=f[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var S=Math.abs(g[0]),M=new n.Vector3(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])).multiplyScalar(v);if(E.size={x:C,y:w,z:S},E.unit=new n.Vector3(x.x,_.y,M.z),x.y!=0||x.z!=0||_.x!=0||_.z!=0||M.x!=0||M.y!=0){E.matrix4=new n.Matrix4(x.x,_.x,M.x,0,x.y,_.y,M.y,0,x.z,_.z,M.z,0,0,0,0,1);let D=new n.Matrix4().makeTranslation(h.x,h.y,h.z);E.matrix4=E.matrix4.multiplyMatrices(D,E.matrix4),E.matrix=E.matrix4.matrix3FromTopLeft(),E.origin=new n.Vector3(0,0,0),E.unit=new n.Vector3(1,1,1)}u.modelData=[{cryst:E}],f=f.splice(6,y);for(var T=u[u.length-1].length,R=T+f.length,P=T;P<R;++P){var I={};I.serial=P;var B=f[P-T],W=B.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");I.elem=a.anumToSymbol[W[0]],I.x=parseFloat(W[2])*v,I.y=parseFloat(W[3])*v,I.z=parseFloat(W[4])*v,I.hetflag=!0,I.bonds=[],I.bondOrder=[],I.properties={},u[u.length-1].push(I)}if(p)for(let D=0;D<u.length;D++)(0,r.assignBonds)(u[D]);return u}},"./src/parsers/GRO.ts":(o,t,e)=>{e.r(t),e.d(t,{GRO:()=>a});var n=e("./src/parsers/utils/assignPDBBonds.ts"),r=e("./src/parsers/utils/atomNameToElem.ts");function a(s){for(var l=[],c=s.split(/\r?\n|\r/);c.length>0&&!(c.length<3);){var u=parseInt(c[1]);if(isNaN(u)||u<=0||c.length<u+3)break;var f=[];l.push(f);for(var p=2,g=f.length,y=g+u,E=g;E<y;E++){var h=c[p++],v={};v.serial=E,v.atom=h.slice(10,15).trim(),v.elem=(0,r.atomNameToElem)(v.atom,!0),v.x=10*parseFloat(h.slice(20,28)),v.y=10*parseFloat(h.slice(28,36)),v.z=10*parseFloat(h.slice(36,44)),v.resi=parseInt(h.slice(0,5)),v.resn=h.slice(5,10).trim(),v.bonds=[],v.bondOrder=[],v.properties={},h.length>44&&(v.dx=10*parseFloat(h.slice(44,52)),v.dy=10*parseFloat(h.slice(52,60)),v.dz=10*parseFloat(h.slice(60,68))),f[E]=v}if(c.length<=p+3){var C=c[p++],x=C.trim().split(/\s+/);if(x.length==3){for(var w=0;w<3;w++)x[w]=parseFloat(x[w])*10;l.box=x}}c.splice(0,++p)}for(let _=0;_<l.length;_++)(0,n.assignPDBBonds)(l[_]);return l}},"./src/parsers/LAMMPSTRJ.ts":(o,t,e)=>{e.r(t),e.d(t,{LAMMPSTRJ:()=>r});var n=e("./src/parsers/utils/assignBonds.ts");function r(a,s){for(var l=[],c={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"},u=a.split(/\r?\n|\r/),f=0,p=0,g=0;g<u.length-9;){for(var y=g;y<u.length;y++)if(u[y].match(/ITEM: NUMBER OF ATOMS/)&&(p=parseInt(u[y+1])),u[y].match(/ITEM: ATOMS/)){f=y+1;break}var E=u[f-1].replace("ITEM: ATOMS ","").split(" ");l.push([]);for(let S=f;S<f+p;S++){for(var h={},v={},C=u[S].split(" "),x=0;x<C.length;x++){var w=c[E[x]];w!=null&&(w=="serial"?h[w]=parseInt(C[x]):w=="x"||w=="y"||w==="z"?h[w]=parseFloat(C[x]):w=="charge"||w=="radius"?v[w]=parseFloat(C[x]):h[w]=C[x]),h.properties=v,h.bonds=[],h.bondOrder=[]}l[l.length-1][S-f]=h}g=f+p-1}if(s.assignBonds)for(var _=0;_<l.length;_++)(0,n.assignBonds)(l[_]);return l}},"./src/parsers/MMTF.ts":(o,t,e)=>{e.r(t),e.d(t,{MMTFparser:()=>p});var n=e("./src/utilities.ts"),r=e("./src/WebGL/index.ts"),a=e("./src/parsers/utils/computeSecondaryStructure.ts"),s=e("./src/parsers/utils/processSymmetries.ts"),l=e("./src/vendor/mmtf.js"),c=function(g){return String.fromCharCode.apply(null,g).replace(/\0/g,"")},u=function(g){return g==0||g==2||g==4?"h":g==3?"s":"c"};let f=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function p(g,y){var E=!y.keepH,h=y.altLoc?y.altLoc:"A",v=!!y.noSecondaryStructure,C=!y.noComputeSecondaryStructure,x=!y.doAssembly,w=y.assemblyIndex?y.assemblyIndex:0;typeof g=="string"?g=(0,n.base64ToArray)(g):g=new Uint8Array(g);var _=l.decode(g),S=[[]],M=S.modelData=[],T=0,R=0,P=0,I=_.secStructList,B=_.bFactorList,W=_.altLocList,D=_.occupancyList,O=_.bondAtomList,z=_.bondOrderList,G=_.numModels;if(G==0)return S;y.multimodel||(G=1);var k,$,Z,K,j,Q,le=[];if(!x&&_.bioAssemblyList&&_.bioAssemblyList.length>0){var he=_.bioAssemblyList[w].transformList;for(k=0,Q=he.length;k<Q;k++){var ve=new r.Matrix4(he[k].matrix);ve.transpose(),le.push(ve)}}var re=null;if(_.unitCell){var Ie=_.unitCell;re={a:Ie[0],b:Ie[1],c:Ie[2],alpha:Ie[3],beta:Ie[4],gamma:Ie[5]}}let ge=[];_.entityList.forEach(de=>{de.chainIndexList.forEach(se=>{ge[se]=de.type=="polymer"})});var Se=0;for(j=0;j<G;j++){var Le=_.chainsPerModel[j],be=S[S.length-1],ye=[];for(M.push({symmetries:le,cryst:re}),k=0;k<Le;++k){var ce=_.groupsPerChain[T],ue=c(_.chainIdList.subarray(T*4,T*4+4));_.chainNameList&&(ue=c(_.chainNameList.subarray(T*4,T*4+4)));var Ce=R,Ve="";for($=0;$<ce;++$){var ie=_.groupList[_.groupTypeList[R]],ae=ie.atomNameList.length,Ae=0,De=!1,Be=!1;if(I){Ae=I[R];var ze=u(Ae);(R==0||ze!=Ve)&&(De=!0),Ve=ze;var We=R+1;(We>=I.length||u(I[We]!=ze))&&(Be=!0)}var $e=_.groupIdList[R],qe=ie.groupName;let de=ie.chemCompType;var et=P;let se=f.has(de)||!ge[T];for(Z=0;Z<ae;++Z){var F=ie.elementList[Z];if(E&&F=="H"){P+=1;continue}var H="";B&&(H=B[P]);var X="";W&&W[P]&&(X=String.fromCharCode(W[P]));var oe="";if(D&&(oe=D[P]),X!=""&&X!=h&&h!="*"){P+=1;continue}var te=_.atomIdList[P],Me=ie.atomNameList[Z],Te=0;ie.atomChargeList&&(Te=ie.atomChargeList[Z]);var q=_.xCoordList[P],Ee=_.yCoordList[P],Pe=_.zCoordList[P];ye[P]=be.length,be.push({resn:qe,x:q,y:Ee,z:Pe,elem:F,hetflag:se,chain:ue,resi:$e,icode:X,rescode:$e+(X!=" "?"^"+X:""),serial:te,altLoc:X,index:P,atom:Me,bonds:[],ss:u(Ae),ssbegin:De,ssend:Be,bondOrder:[],properties:{charge:Te,occupancy:oe},b:H}),P+=1}var tt=ie.bondAtomList;for(Z=0,K=ie.bondOrderList.length;Z<K;++Z){var Oe=et+tt[Z*2],Je=et+tt[Z*2+1],ee=ie.bondOrderList[Z],Fe=ye[Oe],it=ye[Je],U=be[Fe],ke=be[it];U&&ke&&(U.bonds.push(it),U.bondOrder.push(ee),ke.bonds.push(Fe),ke.bondOrder.push(ee))}R+=1}for(R=Ce,$=0;$<ce;++$)R+=1;T+=1}if(O)for(let de=Se,se=O.length;de<se;de+=2){let fe=O[de],je=O[de+1],ht=z?z[de/2]:1;if(fe>=P){Se=de;break}let pt=ye[fe],dt=ye[je],At=be[pt],_e=be[dt];At&&_e&&(At.bonds.push(dt),At.bondOrder.push(ht),_e.bonds.push(pt),_e.bondOrder.push(ht))}y.multimodel&&(y.onemol||S.push([]))}if(!x)for(let de=0;de<S.length;de++)(0,s.processSymmetries)(M[de].symmetries,S[de],y,M[de].cryst);return C&&!v&&(0,a.computeSecondaryStructure)(S,y.hbondCutoff),S}},"./src/parsers/MOL2.ts":(o,t,e)=>{e.r(t),e.d(t,{MOL2:()=>r});let n={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function r(a,s){var l=[[]],c=!1;typeof s.keepH<"u"&&(c=!s.keepH);var u=a.search(/@<TRIPOS>MOLECULE/),f=a.search(/@<TRIPOS>ATOM/);if(u==-1||f==-1)return l;for(var p=a.substring(u).split(/\r?\n|\r/);p.length>0;){var g=[],y=p[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),E=parseInt(y[0]),h=0;y.length>1&&(h=parseInt(y[1]));var v=4,C;for(C=3;C<p.length;C++)if(p[C]=="@<TRIPOS>ATOM"){v=C+1;break}var x=l[l.length-1].length,w=x+E,_;for(C=x;C<w;C++){_=p[v++],y=_.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var S={},M=y[5];if(n[M]!==void 0?M=n[M]:(M=M.split(".")[0],M=M[0].toUpperCase()+M.substring(1).toLowerCase()),S.atom=y[1],S.elem=M,!(S.elem=="H"&&c)){var T=l[l.length-1].length,R=parseInt(y[0]);S.serial=R,S.x=parseFloat(y[2]),S.y=parseFloat(y[3]),S.z=parseFloat(y[4]),S.atom=y[5];var P=parseFloat(y[8]);S.index=T,S.bonds=[],S.bondOrder=[],S.properties={charge:P,partialCharge:P},g[R]=T,l[l.length-1].push(S)}}for(var I=!1;v<p.length;)if(p[v++]=="@<TRIPOS>BOND"){I=!0;break}if(I&&h)for(C=0;C<h;C++){_=p[v++],y=_.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var B=parseInt(y[1]),W=l[l.length-1][g[B]],D=parseInt(y[2]),O=l[l.length-1][g[D]],z=parseInt(y[3]);isNaN(z)&&(z=1),W!==void 0&&O!==void 0&&(W.bonds.push(g[D]),W.bondOrder.push(z),O.bonds.push(g[B]),O.bondOrder.push(z))}if(s.multimodel){s.onemol||l.push([]),p.splice(0,v),a=p.join(`
`);continue}else break}return l}},"./src/parsers/PDB.ts":(o,t,e)=>{e.r(t),e.d(t,{PDB:()=>r});var n=e("./src/parsers/utils/getSinglePDB.ts");function r(a,s){s=s||{};var l=[],c={};l.modelData=[];for(var u=a.split(/\r?\n|\r/);u.length>0;){var f=(0,n.getSinglePDB)(u,s,c),p=f[0],g=f[1];if(u=f[2],p.length!=0){if(s.multimodel&&s.onemol&&l.length>0)for(var y=l[0].length,E=0;E<p.length;E++){var h=p[E];h.index=E;for(var v=0;v<h.bonds.length;v++)h.bonds[v]+=y;l[0].push(h)}else l.modelData.push(g),l.push(p);if(!s.multimodel)break}}return l}},"./src/parsers/PQR.ts":(o,t,e)=>{e.r(t),e.d(t,{PQR:()=>a});var n=e("./src/parsers/utils/assignPDBBonds.ts"),r=e("./src/parsers/utils/computeSecondaryStructure.ts");function a(s,l){var c=[[]],u=!l.noSecondaryStructure;c.modelData=[{symmetries:[]}];var f=[],p=s.split(/\r?\n|\r/),g;for(let I=0;I<p.length;I++){g=p[I].replace(/^\s*/,"");var y=g.substring(0,6);if(y.indexOf("END")==0)if(l.multimodel){l.onemol||c.push([]);continue}else break;else if(y=="ATOM  "||y=="HETATM"){var E;let B=parseInt(g.substring(6,11)),W=g.substring(12,16).replace(/ /g,""),D=g.substring(17,20).trim(),O=g.substring(21,22),z=parseInt(g.substring(22,26));var h=g.substring(30).trim().split(/\s+/),v=parseFloat(h[0]),C=parseFloat(h[1]),x=parseFloat(h[2]),w=parseFloat(h[3]),_=parseFloat(h[4]),S=W[0];W.length>1&&W[1].toUpperCase()!=W[1]&&(S=W.substring(0,2)),g[0]=="H"?E=!0:E=!1,f[B]=c[c.length-1].length,c[c.length-1].push({resn:D,x:v,y:C,z:x,elem:S,hetflag:E,chain:O,resi:z,serial:B,atom:W,bonds:[],ss:"c",bondOrder:[],properties:{charge:w,partialCharge:w,radius:_},pdbline:g})}else if(y=="CONECT"){var M=parseInt(g.substring(6,11)),T=c[c.length-1][f[M]];for(let B=0;B<4;B++){var R=parseInt(g.substring([11,16,21,26][B],[11,16,21,26][B]+5)),P=c[c.length-1][f[R]];T!==void 0&&P!==void 0&&(T.bonds.push(f[R]),T.bondOrder.push(1))}}}for(let I=0;I<c.length;I++)(0,n.assignPDBBonds)(c[I]),u&&(0,r.computeSecondaryStructure)(c[I],l.hbondCutoff);return c}},"./src/parsers/PRMTOP.ts":(o,t,e)=>{e.r(t),e.d(t,{PRMTOP:()=>n});function n(r){var a=[],s,l=0,c=r.split(/\r?\n|\r/);if(c.length>0&&c[0].includes("VERSION")){var u=c.filter(function(v){return v.includes("POINTERS")||v.includes("ATOM_NAME")||v.includes("CHARGE")||v.includes("RADII")||v.includes("BONDS_INC_HYDROGEN")||v.includes("BONDS_WITHOUT_HYDROGEN")}),f=E("POINTERS");if(f==-1)return[];var p=h(f),g=parseInt(c[f+1].slice(0,p[1]));if(isNaN(g)||g<=0)return[];if(f=E("ATOM_NAME"),f==-1)return[];p=h(f);var y=p[0];for(let v=0;v<g/p[0];v++){v==parseInt(g/p[0])&&(y=g%p[0]);for(let C=0;C<y;C++){let x={},w={charge:"",radii:""};x.serial=l,x.x=0,x.y=0,x.z=0,x.atom=c[f+1].slice(p[1]*C,p[1]*(C+1)),x.elem=c[f+1].slice(p[1]*C,p[1]*C+1),x.properties=w,x.bonds=[],x.bondOrder=[],a.push(x),l++}f++}if(f=E("CHARGE"),f!=-1){p=h(f),l=0,y=p[0];for(let v=0;v<g/p[0];v++){v==parseInt(g/p[0])&&(y=g%p[0]);for(let C=0;C<y;C++)a[l].properties.charge=parseFloat(c[f+1].slice(p[1]*C,p[1]*(C+1))),l++;f++}}if(f=E("RADII"),f!=-1){p=h(f),l=0,y=p[0];for(let v=0;v<g/p[0];v++){v==parseInt(g/p[0])&&(y=g%p[0]);for(let C=0;C<y;C++)a[l].properties.radii=parseFloat(c[f+1].slice(p[1]*C,p[1]*(C+1))),l++;f++}}if(f=E("BONDS_WITHOUT_HYDROGEN"),f!=-1)for(p=h(f),l=0,y=p[0],f=f+1;!c[f].match(/^%FLAG/);){c[f+1].match(/^%FLAG/)&&(y=g%p[0]);for(let v=0;v<y;v++)l%3==0?s=parseInt(c[f].slice(p[1]*v,p[1]*(v+1))/3):l%3==1&&a[s].bonds.push(parseInt(c[f].slice(p[1]*v,p[1]*(v+1))/3)),l++;f++}if(f=E("BONDS_INC_HYDROGEN"),f!=-1)for(p=h(f),l=0,y=p[0],f=f+1;!c[f].match(/^%FLAG/);){c[f+1].match(/^%FLAG/)&&(y=g%p[0]);for(let v=0;v<y;v++)l%3==0?s=parseInt(c[f].slice(p[1]*v,p[1]*(v+1))/3):l%3==1&&a[s].bonds.push(parseInt(c[f].slice(p[1]*v,p[1]*(v+1))/3)),l++;f++}}else return[];function E(v){var C=c.indexOf(u.filter(function(x){return x.includes(v)})[0]);if(Number.isInteger(C)&&C>0){for(;!c[C].includes("FORMAT");)C++;return C}else return-1}function h(v){var C=c[v].match(/\((\d*)\S*/),x=c[v].match(/[a-zA-Z](\d*)\)\s*/);return x==null&&(x=c[v].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[C[1],x[1]]}return[a]}},"./src/parsers/SDF.ts":(o,t,e)=>{e.r(t),e.d(t,{SDF:()=>a});var n=function(s,l){var c=[[]],u=!1;for(typeof l.keepH<"u"&&(u=!l.keepH);s.length>0&&!(s.length<4);){var f=parseInt(s[3].substring(0,3));if(isNaN(f)||f<=0)break;var p=parseInt(s[3].substring(3,6)),g=4;if(s.length<4+f+p)break;var y=[],E=c[c.length-1].length,h=E+f,v,C;for(v=E;v<h;v++,g++){C=s[g];var x={},w=C.substring(31,34).replace(/ /g,"");x.atom=x.elem=w[0].toUpperCase()+w.substring(1).toLowerCase(),(x.elem!=="H"||!u)&&(x.serial=v,y[v]=c[c.length-1].length,x.x=parseFloat(C.substring(0,10)),x.y=parseFloat(C.substring(10,20)),x.z=parseFloat(C.substring(20,30)),x.hetflag=!0,x.bonds=[],x.bondOrder=[],x.properties={},x.index=c[c.length-1].length,c[c.length-1].push(x))}for(v=0;v<p;v++,g++){C=s[g];var _=y[parseInt(C.substring(0,3))-1+E],S=y[parseInt(C.substring(3,6))-1+E],M=parseFloat(C.substring(6));typeof _<"u"&&typeof S<"u"&&(c[c.length-1][_].bonds.push(S),c[c.length-1][_].bondOrder.push(M),c[c.length-1][S].bonds.push(_),c[c.length-1][S].bondOrder.push(M))}if(l.multimodel){for(l.onemol||c.push([]);s[g]!=="$$$$"&&g<s.length;)g++;s.splice(0,++g)}else break}return c},r=function(s,l){var c=[[]],u=!1;for(typeof l.keepH<"u"&&(u=!l.keepH);s.length>0&&!(s.length<8||!s[4].startsWith("M  V30 BEGIN CTAB")||!s[5].startsWith("M  V30 COUNTS")||s[5].length<14);){var f=s[5].substring(13).match(/\S+/g);if(f.length<2)break;var p=parseInt(f[0]);if(isNaN(p)||p<=0)break;var g=parseInt(f[1]),y=7;if(s.length<8+p+g)break;var E=[],h=c[c.length-1].length,v=h+p,C,x;for(C=h;C<v;C++,y++){x=s[y];var w=x.substring(6).match(/\S+/g);if(w.length>4){var _={},S=w[1].replace(/ /g,"");_.atom=_.elem=S[0].toUpperCase()+S.substring(1).toLowerCase(),(_.elem!=="H"||!u)&&(_.serial=C,E[C]=c[c.length-1].length,_.x=parseFloat(w[2]),_.y=parseFloat(w[3]),_.z=parseFloat(w[4]),_.hetflag=!0,_.bonds=[],_.bondOrder=[],_.properties={},_.index=c[c.length-1].length,c[c.length-1].push(_))}}if(s[y]==="M  V30 END ATOM")y++;else break;if(g!==0&&s[y]==="M  V30 BEGIN BOND")y++;else break;for(C=0;C<g;C++,y++){x=s[y];var M=x.substring(6).match(/\S+/g);if(M.length>3){var T=E[parseInt(M[2])-1+h],R=E[parseInt(M[3])-1+h],P=parseFloat(M[1]);typeof T<"u"&&typeof R<"u"&&(c[c.length-1][T].bonds.push(R),c[c.length-1][T].bondOrder.push(P),c[c.length-1][R].bonds.push(T),c[c.length-1][R].bondOrder.push(P))}}if(l.multimodel){for(l.onemol||c.push([]);s[y]!=="$$$$"&&y<s.length;)y++;s.splice(0,++y)}else break}return c};function a(s,l){var c="V2000",u=s.split(/\r?\n|\r/);return u.length>3&&u[3].length>38&&(c=u[3].substring(34,39)),c==="V2000"?n(u,l):c==="V3000"?r(u,l):[[""]]}},"./src/parsers/VASP.ts":(o,t,e)=>{e.r(t),e.d(t,{VASP:()=>r});var n=e("./src/WebGL/index.ts");function r(a){var s=[[]],l={},c=a.replace(/^\s+/,"").split(/\r?\n/);if(c.length<3)return s;if(c[1].match(/\d+/))l.length=parseFloat(c[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),s;if(l.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),s;l.xVec=new Float32Array(c[2].replace(/^\s+/,"").split(/\s+/)),l.yVec=new Float32Array(c[3].replace(/^\s+/,"").split(/\s+/)),l.zVec=new Float32Array(c[4].replace(/^\s+/,"").split(/\s+/));var u=new n.Matrix3(l.xVec[0],l.xVec[1],l.xVec[2],l.yVec[0],l.yVec[1],l.yVec[2],l.zVec[0],l.zVec[1],l.zVec[2]);u.multiplyScalar(l.length),s.modelData=[{symmetries:[],cryst:{matrix:u}}];var f=c[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),p=new Int16Array(c[6].replace(/^\s+/,"").split(/\s+/)),g=c[7].replace(/\s+/,"");if(g.match(/C/))g="cartesian";else if(g.match(/D/))g="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),s;if(f.length!=p.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(f),console.log(p),s;c.splice(0,8);for(var y=0,E=0,h=f.length;E<h;E++){for(var v=f[E],C=0,x=p[E];C<x;C++){var w=new Float32Array(c[y+C].replace(/^\s+/,"").split(/\s+/)),_={};_.elem=v,g=="cartesian"?(_.x=l.length*w[0],_.y=l.length*w[1],_.z=l.length*w[2]):(_.x=l.length*(w[0]*l.xVec[0]+w[1]*l.yVec[0]+w[2]*l.zVec[0]),_.y=l.length*(w[0]*l.xVec[1]+w[1]*l.yVec[1]+w[2]*l.zVec[1]),_.z=l.length*(w[0]*l.xVec[2]+w[1]*l.yVec[2]+w[2]*l.zVec[2])),_.bonds=[],s[0].push(_)}y+=p[E]}return s}},"./src/parsers/XYZ.ts":(o,t,e)=>{e.r(t),e.d(t,{XYZ:()=>a});var n=e("./src/WebGL/index.ts"),r=e("./src/parsers/utils/assignBonds.ts");function a(s,l){l=l||{};for(var c=[[]],u=l.assignBonds===void 0?!0:l.assignBonds,f=s.split(/\r?\n|\r/);f.length>0&&!(f.length<3);){var p=parseInt(f[0]);if(isNaN(p)||p<=0||f.length<p+2)break;var g=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,y=g.exec(f[1]);if(y!=null&&y.length>1){var E=new Float32Array(y[1].split(/\s+/)),h=new n.Matrix3(E[0],E[3],E[6],E[1],E[4],E[7],E[2],E[5],E[8]);c.modelData=[{cryst:{matrix:h}}]}for(var v=2,C=c[c.length-1].length,x=C+p,w=C;w<x;w++){var _=f[v++],S=_.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),M={};M.serial=w;var T=S[0];M.atom=M.elem=T[0].toUpperCase()+T.substring(1,2).toLowerCase(),M.x=parseFloat(S[1]),M.y=parseFloat(S[2]),M.z=parseFloat(S[3]),M.hetflag=!0,M.bonds=[],M.bondOrder=[],M.properties={},c[c.length-1][w]=M,S.length>=7&&(M.dx=parseFloat(S[4]),M.dy=parseFloat(S[5]),M.dz=parseFloat(S[6]))}if(l.multimodel)c.push([]),f.splice(0,v);else break}if(u)for(let P=0;P<c.length;P++)(0,r.assignBonds)(c[P]);if(l.onemol){var R=c;c=[],c.push(R[0]);for(let P=1;P<R.length;P++){let I=c[0].length;for(let B=0;B<R[P].length;B++){let W=R[P][B];for(let D=0;D<W.bonds.length;D++)W.bonds[D]=W.bonds[D]+I;W.index=c[0].length,W.serial=c[0].length,c[0].push(W)}}}return c}},"./src/parsers/index.ts":(o,t,e)=>{e.r(t),e.d(t,{Parsers:()=>C,bondLength:()=>v.bondLength,setBondLength:()=>v.setBondLength});var n=e("./src/parsers/VASP.ts"),r=e("./src/parsers/CUBE.ts"),a=e("./src/parsers/XYZ.ts"),s=e("./src/parsers/SDF.ts"),l=e("./src/parsers/CDJSON.ts"),c=e("./src/parsers/CIF.ts"),u=e("./src/parsers/MOL2.ts"),f=e("./src/parsers/PDB.ts"),p=e("./src/parsers/PQR.ts"),g=e("./src/parsers/MMTF.ts"),y=e("./src/parsers/PRMTOP.ts"),E=e("./src/parsers/GRO.ts"),h=e("./src/parsers/LAMMPSTRJ.ts"),v=e("./src/parsers/utils/bondLength.ts");const C={vasp:n.VASP,VASP:n.VASP,cube:r.CUBE,CUBE:r.CUBE,xyz:a.XYZ,XYZ:a.XYZ,sdf:s.SDF,SDF:s.SDF,json:l.CDJSON,cdjson:l.CDJSON,CDJSON:l.CDJSON,mcif:c.CIF,cif:c.CIF,CIF:c.CIF,mol2:u.MOL2,MOL2:u.MOL2,pdb:f.PDB,PDB:f.PDB,pdbqt:f.PDB,PDBQT:f.PDB,pqr:p.PQR,PQR:p.PQR,mmtf:g.MMTFparser,MMTF:g.MMTFparser,prmtop:y.PRMTOP,PRMTOP:y.PRMTOP,gro:E.GRO,GRO:E.GRO,lammpstrj:h.LAMMPSTRJ,LAMMPSTRJ:h.LAMMPSTRJ}},"./src/parsers/utils/anumToSymbol.ts":(o,t,e)=>{e.r(t),e.d(t,{anumToSymbol:()=>n});const n={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts":(o,t,e)=>{e.r(t),e.d(t,{areConnected:()=>r});var n=e("./src/parsers/utils/bondLength.ts");function r(a,s){var l=(0,n.bondLength)(a.elem)+(0,n.bondLength)(s.elem);l+=.25,l*=l;var c=a.x-s.x;if(c*=c,c>l)return!1;var u=a.y-s.y;if(u*=u,u>l)return!1;var f=a.z-s.z;if(f*=f,f>l)return!1;var p=c+u+f;return isNaN(p)||p<.5||p>l?!1:!(a.altLoc!=s.altLoc&&a.altLoc!=" "&&s.altLoc!=" ")}},"./src/parsers/utils/assignBackboneHBonds.ts":(o,t,e)=>{e.r(t),e.d(t,{assignBackboneHBonds:()=>n});function n(r,a){let s=a||3.2,l=s*s,c=[];for(let v=0,C=r.length;v<C;v++){r[v].index=v;var u=r[v];!u.hetflag&&(u.atom==="N"||u.atom==="O")&&(c.push(u),u.hbondOther=null,u.hbondDistanceSq=Number.POSITIVE_INFINITY)}c.sort(function(v,C){return v.z-C.z});for(let v=0,C=c.length;v<C;v++){var f=c[v];for(let x=v+1;x<C;x++){var p=c[x],g=p.z-f.z;if(g>s)break;if(p.atom!=f.atom){var y=Math.abs(p.y-f.y);if(!(y>s)){var E=Math.abs(p.x-f.x);if(!(E>s)){var h=E*E+y*y+g*g;h>l||p.chain==f.chain&&Math.abs(p.resi-f.resi)<4||(h<f.hbondDistanceSq&&(f.hbondOther=p,f.hbondDistanceSq=h),h<p.hbondDistanceSq&&(p.hbondOther=f,p.hbondDistanceSq=h))}}}}}}},"./src/parsers/utils/assignBonds.ts":(o,t,e)=>{e.r(t),e.d(t,{assignBonds:()=>r});var n=e("./src/parsers/utils/areConnected.ts");function r(a){for(var s=0,l=a.length;s<l;s++)a[s].index||(a[s].index=s);for(var c={},u=4.95,f=0;f<a.length;f++){var p=a[f],g=Math.floor(p.x/u),y=Math.floor(p.y/u),E=Math.floor(p.z/u);c[g]||(c[g]={}),c[g][y]||(c[g][y]={}),c[g][y][E]||(c[g][y][E]=[]),c[g][y][E].push(p)}var h=function(C,x){for(var w=0;w<C.length;w++)for(var _=C[w],S=0;S<x.length;S++){var M=x[S];if((0,n.areConnected)(_,M)){var T=_.bonds.indexOf(M.index),R=M.bonds.indexOf(_.index);T==-1&&R==-1?(_.bonds.push(M.index),_.bondOrder.push(1),M.bonds.push(_.index),M.bondOrder.push(1)):T==-1?(_.bonds.push(M.index),_.bondOrder.push(M.bondOrder[R])):R==-1&&(M.bonds.push(_.index),M.bondOrder.push(_.bondOrder[T]))}}},v=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(let C in c){let x=parseInt(C);for(let w in c[x]){let _=parseInt(w);for(let S in c[x][_]){let M=parseInt(S),T=c[x][_][M];for(let R=0;R<T.length;R++){let P=T[R];for(let I=R+1;I<T.length;I++){let B=T[I];(0,n.areConnected)(P,B)&&P.bonds.indexOf(B.index)==-1&&(P.bonds.push(B.index),P.bondOrder.push(1),B.bonds.push(P.index),B.bondOrder.push(1))}}for(let R=0;R<v.length;R++){let P=v[R];if(!c[x+P.x]||!c[x+P.x][_+P.y]||!c[x+P.x][_+P.y][M+P.z])continue;let I=c[x+P.x][_+P.y][M+P.z];h(T,I)}}}}}},"./src/parsers/utils/assignPDBBonds.ts":(o,t,e)=>{e.r(t),e.d(t,{assignPDBBonds:()=>s});var n=e("./src/parsers/utils/areConnected.ts"),r=e("./src/parsers/utils/assignBonds.ts"),a=e("./src/parsers/utils/standardResidues.ts");function s(l){var c=[],u=[],f,p;for(f=0,p=l.length;f<p;f++){var g=l[f];g.index=f,g.hetflag||!a.standardResidues.has(g.resn)?u.push(g):c.push(g)}(0,r.assignBonds)(u),c.sort(function(w,_){return w.chain!=_.chain?w.chain<_.chain?-1:1:w.resi-_.resi});var y=-1,E=-1,h;for(f=0,p=c.length;f<p;f++){var v=c[f];v.resi!==y&&(y=v.resi,h||E++,h=!1),v.reschain=E;for(var C=f+1;C<c.length;C++){var x=c[C];if(x.chain!=v.chain||x.resi-v.resi>1)break;(0,n.areConnected)(v,x)&&(v.bonds.indexOf(x.index)===-1&&(v.bonds.push(x.index),v.bondOrder.push(1),x.bonds.push(v.index),x.bondOrder.push(1)),v.resi!==x.resi&&(h=!0))}}}},"./src/parsers/utils/atomNameToElem.ts":(o,t,e)=>{e.r(t),e.d(t,{atomNameToElem:()=>r});var n=e("./src/parsers/utils/bondLength.ts");function r(a,s){var l=a.replace(/ /g,"");return l.length>0&&l[0]=="H"&&l!="Hg"&&l!="He"&&l!="Hf"&&l!="Hs"&&l!="Ho"&&(l="H"),l.length>1&&(l=l[0].toUpperCase()+l.substring(1).toLowerCase(),typeof n.bondTable[l]>"u"?l=l[0]:s&&(l=="Ca"||l=="Cd")&&(l="C")),l}},"./src/parsers/utils/bondLength.ts":(o,t,e)=>{e.r(t),e.d(t,{bondLength:()=>r,bondTable:()=>n,setBondLength:()=>a});let n={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function r(s){return n[s]||1.6}function a(s,l){l<0&&(l=0),n[s]=l}},"./src/parsers/utils/computeSecondaryStructure.ts":(o,t,e)=>{e.r(t),e.d(t,{computeSecondaryStructure:()=>r});var n=e("./src/parsers/utils/assignBackboneHBonds.ts");function r(a,s){(0,n.assignBackboneHBonds)(a,s);var l={},c,u,f,p,g,y;for(c=0,u=a.length;c<u;c++)if(g=a[c],typeof l[g.chain]>"u"&&(l[g.chain]=[]),isFinite(g.hbondDistanceSq)){var E=g.hbondOther;typeof l[E.chain]>"u"&&(l[E.chain]=[]),Math.abs(E.resi-g.resi)===4&&(l[g.chain][g.resi]="h")}for(f in l)for(p=1;p<l[f].length-1;p++){var h=l[f][p-1],v=l[f][p+1];y=l[f][p],h=="h"&&h==v&&y!=h&&(l[f][p]=h)}for(c=0,u=a.length;c<u;c++)g=a[c],isFinite(g.hbondDistanceSq)&&l[g.chain][g.resi]!="h"&&g.ss!="h"&&(l[g.chain][g.resi]="maybesheet");for(let C=0,x=a.length;C<x;C++)if(g=a[C],isFinite(g.hbondDistanceSq)&&l[g.chain][g.resi]=="maybesheet"){let w=g.hbondOther,_=l[w.chain][w.resi];(_=="maybesheet"||_=="s")&&(l[g.chain][g.resi]="s",l[w.chain][w.resi]="s")}for(let C in l){for(let x=1;x<l[C].length-1;x++){let w=l[C][x-1],_=l[C][x+1];y=l[C][x],w=="s"&&w==_&&y!=w&&(l[C][x]=w)}for(let x=0;x<l[C].length;x++){let w=l[C][x];(w=="h"||w=="s")&&l[C][x-1]!=w&&l[C][x+1]!=w&&delete l[C][x]}}for(c=0,u=a.length;c<u;c++)g=a[c],y=l[g.chain][g.resi],delete g.hbondOther,delete g.hbondDistanceSq,!(typeof y>"u"||y=="maybesheet")&&(g.ss=y,l[g.chain][g.resi-1]!=y&&(g.ssbegin=!0),l[g.chain][g.resi+1]!=y&&(g.ssend=!0))}},"./src/parsers/utils/getSinglePDB.ts":(o,t,e)=>{e.r(t),e.d(t,{getSinglePDB:()=>p});var n=e("./src/WebGL/index.ts"),r=e("./src/parsers/utils/atomNameToElem.ts"),a=e("./src/parsers/utils/bondLength.ts"),s=e("./src/parsers/utils/computeSecondaryStructure.ts"),l=e("./src/parsers/utils/isEmpty.ts"),c=e("./src/parsers/utils/processSymmetries.ts"),u=e("./src/parsers/utils/assignPDBBonds.ts"),f=e("./src/parsers/utils/validateBonds.ts");function p(g,y,E){var h=[],v=y.assignBonds===void 0?!0:y.assignBonds,C=!y.keepH,x=!!y.noSecondaryStructure,w=!y.noComputeSecondaryStructure,_=!y.doAssembly,S=y.altLoc?y.altLoc:"A",M={symmetries:[]},T,R=[],P=[],I,B={};for(let qe=0;qe<g.length;qe++){I=g[qe].replace(/^\s*/,"");var W=I.substring(0,6),D,O,z;if(W.indexOf("END")==0){if(R=g.slice(qe+1),W=="END")for(var G in E)E.hasOwnProperty(G)&&delete E[G];break}else if(W=="ATOM  "||W=="HETATM"){var k,$,Z,K,j,Q,le,he,ve,re,Ie,ge;if(Ie=I.substring(16,17),Ie!=" "&&Ie!=S&&S!="*"||(re=parseInt(I.substring(6,11)),T=I.substring(12,16).replace(/ /g,""),k=I.substring(17,20).replace(/ /g,""),$=I.substring(21,22),Z=parseInt(I.substring(22,26)),K=I.substring(26,27),j=parseFloat(I.substring(30,38)),Q=parseFloat(I.substring(38,46)),le=parseFloat(I.substring(46,54)),ge=parseFloat(I.substring(60,68)),ve=I.substring(76,78).replace(/ /g,""),ve===""||typeof a.bondTable[ve]>"u"?ve=(0,r.atomNameToElem)(I.substring(12,14),I[0]=="A"):ve=ve[0].toUpperCase()+ve.substring(1).toLowerCase(),ve=="H"&&C))continue;W[0]=="H"?he=!0:he=!1,P[re]=h.length,h.push({resn:k,x:j,y:Q,z:le,elem:ve,hetflag:he,altLoc:Ie,chain:$,resi:Z,icode:K,rescode:Z+(K!=" "?"^"+K:""),serial:re,atom:T,bonds:[],ss:"c",bondOrder:[],properties:{},b:ge,pdbline:I})}else if(W=="SHEET "){D=I.substring(21,22),O=parseInt(I.substring(22,26)),z=parseInt(I.substring(33,37)),D in E||(E[D]={}),E[D][O]="s1";for(var Se=O+1;Se<z;Se++)E[D][Se]="s";E[D][z]="s2"}else if(W=="CONECT"){var Le=parseInt(I.substring(6,11)),be=P[Le],ye=h[be],ce=[11,16,21,26];for(let et=0;et<4;et++){var ue=parseInt(I.substring(ce[et],ce[et]+5)),Ce=P[ue];let F=be+":"+Ce;var Ve=h[Ce];if(ye!==void 0&&Ve!==void 0)if(!B[F])B[F]=1,(ye.bonds.length==0||ye.bonds[ye.bonds.length-1]!=Ce)&&(ye.bonds.push(Ce),ye.bondOrder.push(1));else{B[F]+=1;for(let H=0;H<ye.bonds.length;H++)if(ye.bonds[H]==Ce){var ie=B[F];ie>=4?ye.bondOrder[H]=1:ye.bondOrder[H]=ie}}}}else if(W=="HELIX "){D=I.substring(19,20),O=parseInt(I.substring(21,25)),z=parseInt(I.substring(33,37)),D in E||(E[D]={}),E[D][O]="h1";for(let et=O+1;et<z;et++)E[D][et]="h";E[D][z]="h2"}else if(!_&&W=="REMARK"&&I.substring(13,18)=="BIOMT"){var ae,Ae=new n.Matrix4;for(ae=1;ae<=3;ae++)if(I=g[qe].replace(/^\s*/,""),parseInt(I.substring(18,19))==ae)Ae.elements[ae-1]=parseFloat(I.substring(23,33)),Ae.elements[ae-1+4]=parseFloat(I.substring(33,43)),Ae.elements[ae-1+8]=parseFloat(I.substring(43,53)),Ae.elements[ae-1+12]=parseFloat(I.substring(53)),qe++;else for(;I.substring(13,18)=="BIOMT";)qe++,I=g[qe].replace(/^\s*/,"");Ae.elements[3]=0,Ae.elements[7]=0,Ae.elements[11]=0,Ae.elements[15]=1,M.symmetries.push(Ae),qe--}else if(W=="CRYST1"){let et,F,H,X,oe,te;et=parseFloat(I.substring(7,15)),F=parseFloat(I.substring(16,24)),H=parseFloat(I.substring(25,33)),X=parseFloat(I.substring(34,40)),oe=parseFloat(I.substring(41,47)),te=parseFloat(I.substring(48,54)),M.cryst={a:et,b:F,c:H,alpha:X,beta:oe,gamma:te}}else if(W=="ANISOU"){let et=parseInt(I.substring(6,11));var De=P[et],Be=h[De];if(Be){var ze=I.substring(30).trim().split(/\s+/),We={u11:parseInt(ze[0]),u22:parseInt(ze[1]),u33:parseInt(ze[2]),u12:parseInt(ze[3]),u13:parseInt(ze[4]),u23:parseInt(ze[5])};Be.uMat=We}}}if((0,f.validateBonds)(h,P),v&&(0,u.assignPDBBonds)(h),_||(0,c.processSymmetries)(M.symmetries,h,y,M.cryst),w&&!x&&(0,s.computeSecondaryStructure)(h,y.hbondCutoff),!(0,l.isEmpty)(E)){for(let qe=0;qe<h.length;qe++)if(T=h[qe],T!==void 0&&T.chain in E&&T.resi in E[T.chain]){var $e=E[T.chain][T.resi];T.ss=$e[0],$e.length>1&&($e[1]=="1"?T.ssbegin=!0:$e[1]=="2"&&(T.ssend=!0))}}return[h,M,R]}},"./src/parsers/utils/isEmpty.ts":(o,t,e)=>{e.r(t),e.d(t,{isEmpty:()=>n});function n(r){var a;for(a in r)return!1;return!0}},"./src/parsers/utils/processSymmetries.ts":(o,t,e)=>{e.r(t),e.d(t,{processSymmetries:()=>r});var n=e("./src/WebGL/index.ts");function r(a,s,l,c){var u=!l.duplicateAssemblyAtoms,f=s.length,p=f,g,y,E;let h=-1;if(l.normalizeAssembly&&c){let S=(0,n.conversionMatrix3)(c.a,c.b,c.c,c.alpha,c.beta,c.gamma),M=new n.Matrix3;for(M.getInverse3(S),g=0;g<a.length;g++){let T=new n.Vector3(0,0,0);for(E=0;E<f;E++){let B=new n.Vector3(s[E].x,s[E].y,s[E].z);B.applyMatrix4(a[g]),B.applyMatrix3(M),T.add(B)}T.divideScalar(f);const R=[T.x,T.y,T.z];let P=[0,0,0];for(let B=0;B<3;B++){for(;R[B]<-.001;)R[B]+=1,P[B]+=1;for(;R[B]>1.001;)R[B]-=1,P[B]-=1}const I=new n.Vector3(P[0],P[1],P[2]);I.applyMatrix3(S),a[g].isNearlyIdentity()&&I.lengthSq()>.001&&(h=g),a[g].translate(I)}}if(u){if(a.length>1)for(g=0;g<s.length;g++){var w=[];for(y=0;y<a.length;y++)if(!a[y].isNearlyIdentity()){var _=new n.Vector3;_.set(s[g].x,s[g].y,s[g].z),_.applyMatrix4(a[y]),w.push(_)}s[g].symmetries=w}}else{for(E=0;E<f;E++)s[E].sym=-1;for(g=0;g<a.length;g++)if(!a[g].isNearlyIdentity()&&h!=g){let S=new n.Vector3;for(E=0;E<f;E++){var v=[];for(y=0;y<s[E].bonds.length;y++)v.push(s[E].bonds[y]+p);S.set(s[E].x,s[E].y,s[E].z),S.applyMatrix4(a[g]);var C={};for(var x in s[E])C[x]=s[E][x];C.x=S.x,C.y=S.y,C.z=S.z,C.bonds=v,C.sym=g,C.index=s.length,s.push(C)}p=s.length}else for(E=0;E<f;E++)s[E].sym=g;if(h>=0){let S=new n.Vector3;for(E=0;E<f;E++)S.set(s[E].x,s[E].y,s[E].z),S.applyMatrix4(a[h]),s[E].x=S.x,s[E].y=S.y,s[E].z=S.z}a.length=0}}},"./src/parsers/utils/standardResidues.ts":(o,t,e)=>{e.r(t),e.d(t,{standardResidues:()=>n});const n=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts":(o,t,e)=>{e.r(t),e.d(t,{validateBonds:()=>n});function n(r,a){for(var s=0,l=r.length;s<l;s++)for(var c=r[s],u=0;u<c.bonds.length;u++){var f=c.bonds[u],p=r[f],g=a[c.serial];if(p&&g){var y=p.bonds.indexOf(g);y<0&&(p.bonds.push(g),p.bondOrder.push(c.bondOrder[u]))}}}},"./src/partialCharges.ts":(o,t,e)=>{e.r(t),e.d(t,{applyPartialCharges:()=>r,partialCharges:()=>n});const n={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function r(a,s){if((!s||typeof a.partialCharge>"u")&&a.resn&&a.atom){var l=a.resn+":"+a.atom;a.properties.partialCharge=n[l]}}},"./src/specs.ts":(o,t,e)=>{e.r(t)},"./src/utilities.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts");function extend(o,t){for(var e in t)t.hasOwnProperty(e)&&t[e]!==void 0&&(o[e]=t[e]);return o}function deepCopy(o){let t,e,n;if(o==null)return{};if(typeof o!="object"||o===null)return o;t=Array.isArray(o)?[]:{};for(n in o)e=o[n],t[n]=deepCopy(e);return t}function isNumeric(o){var t=typeof o;return(t==="number"||t==="string")&&!isNaN(o-parseFloat(o))}function isEmptyObject(o){var t;for(t in o)return!1;return!0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?null:callback}function adjustVolumeStyle(o){o&&(o.volformat&&!(o.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(o.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(o.voldata,o.volformat)),o.volscheme&&(o.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(o.volscheme)))}function getExtent(o,t){var e,n,r,a,s,l,c,u,f,p,g=!t;if(e=n=r=9999,a=s=l=-9999,c=u=f=p=0,o.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var y=0;y<o.length;y++){var E=o[y];if(!(typeof E>"u"||!isFinite(E.x)||!isFinite(E.y)||!isFinite(E.z))&&(p++,c+=E.x,u+=E.y,f+=E.z,e=e<E.x?e:E.x,n=n<E.y?n:E.y,r=r<E.z?r:E.z,a=a>E.x?a:E.x,s=s>E.y?s:E.y,l=l>E.z?l:E.z,E.symmetries&&g))for(var h=0;h<E.symmetries.length;h++)p++,c+=E.symmetries[h].x,u+=E.symmetries[h].y,f+=E.symmetries[h].z,e=e<E.symmetries[h].x?e:E.symmetries[h].x,n=n<E.symmetries[h].y?n:E.symmetries[h].y,r=r<E.symmetries[h].z?r:E.symmetries[h].z,a=a>E.symmetries[h].x?a:E.symmetries[h].x,s=s>E.symmetries[h].y?s:E.symmetries[h].y,l=l>E.symmetries[h].z?l:E.symmetries[h].z}return[[e,n,r],[a,s,l],[c/p,u/p,f/p]]}function getPropertyRange(o,t){for(var e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=0,a=o.length;r<a;r++){var s=o[r],l=getAtomProperty(s,t);l!=null&&(l<e&&(e=l),l>n&&(n=l))}return!isFinite(e)&&!isFinite(n)?e=n=0:isFinite(e)?isFinite(n)||(n=e):e=n,[e,n]}class PausableTimer{constructor(t,e,n){this.total_time_run=0,this.fn=t,this.arg=n,this.countdown=e,this.start_time=new Date().getTime(),this.ident=setTimeout(t,e,n)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(o){for(var t=window.atob(o),e=t.length,n=new Uint8Array(e),r=0;r<e;r++)n[r]=t.charCodeAt(r);return n}function getAtomProperty(o,t){var e=null;return o.properties&&typeof o.properties[t]<"u"?e=o.properties[t]:typeof o[t]<"u"&&(e=o[t]),e}function mergeGeos(o,t){var e=t.geometry;e!==void 0&&o.geometryGroups.push(e.geometryGroups[0])}function specStringToObject(o){if(typeof o=="object")return o;if(typeof o>"u"||o==null)return o;try{return JSON.parse(o)}catch{}o=o.replace(/%7E/g,"~");var t=function(g){return isNumeric(g)?Math.floor(parseFloat(g))==parseInt(g)||g.indexOf(".")>=0?parseFloat(g):parseInt(g):g==="true"?!0:g==="false"?!1:g},e={};if(o==="all")return e;for(var n=o.split(";"),r=0;r<n.length;r++){var a=n[r].split(":"),s=a[0],l={},c=a[1];if(c)if(c=c.replace(/~/g,"="),c.indexOf("=")!==-1)for(var u=c.split(","),f=0;f<u.length;f++){var p=u[f].split("=",2);l[p[0]]=t(p[1])}else c.indexOf(",")!==-1?l=c.split(","):l=t(c);e[s]=l}return e}function checkStatus(o){if(!o.ok)throw new Error(`HTTP ${o.status} - ${o.statusText}`);return o}function get(o,t){var e=fetch(o).then(checkStatus).then(n=>n.text());return t?e.then(t):e}function getbin(o,t,e,n){var r;return e=="POST"?r=fetch(o,{method:"POST",body:n}).then(a=>checkStatus(a)).then(a=>a.arrayBuffer()):r=fetch(o).then(a=>checkStatus(a)).then(a=>a.arrayBuffer()),t?r.then(t):r}function download(o,t,e,n){var r="",a="",s="",l="",c=null,u=t.addModel();if(o.indexOf(":")<0&&(o.length==4?o="pdb:"+o:isNaN(o)?o="url:"+o:o="cid:"+o),o.substring(0,5)==="mmtf:")a=e&&e.pdbUri?e.pdbUri:"https://mmtf.rcsb.org/v1.0/full/",o=o.substring(5).toUpperCase(),l=a+o,e&&typeof e.noComputeSecondaryStructure>"u"&&(e.noComputeSecondaryStructure=!0),c=new Promise(function(p){getbin(l).then(function(g){u.addMolData(g,"mmtf",e),t.zoomTo(),t.render(),p(u)},function(){console.log("fetch of "+l+" failed.")})});else{if(o.substring(0,4)==="pdb:"){if(r="mmtf",e&&e.format&&(r=e.format),e&&typeof e.noComputeSecondaryStructure>"u"&&(e.noComputeSecondaryStructure=!0),o=o.substring(4).toUpperCase(),!o.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}r=="mmtf"?(s=e&&e.mmtfUri?e.mmtfUri:"https://mmtf.rcsb.org/v1.0/full/",l=s+o.toUpperCase()):(a=e&&e.pdbUri?e.pdbUri:"https://files.rcsb.org/view/",l=a+o+"."+r)}else if(o.substring(0,4)=="cid:"){if(r="sdf",o=o.substring(4),!o.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}l="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+o+"/SDF?record_type=3d"}else o.substring(0,4)=="url:"&&(l=o.substring(4),r=l);var f=function(p){u.addMolData(p,r,e),t.zoomTo(),t.render()};c=new Promise(function(p){r=="mmtf"?getbin(l).then(function(g){f(g),p(u)}).catch(function(){a=e&&e.pdbUri?e.pdbUri:"https://files.rcsb.org/view/",l=a+o+".pdb",r="pdb",console.log("falling back to pdb format"),get(l).then(function(g){f(g),p(u)}).catch(function(g){f(""),p(u),console.log("fetch of "+l+" failed: "+g.statusText)})}):get(l).then(function(g){f(g),p(u)}).catch(function(g){f(""),p(u),console.log("fetch of "+l+" failed: "+g.statusText)})})}return n?(c.then(function(p){n(p)}),u):c}function getColorFromStyle(o,t){let e=t.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[e]<"u")e=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[e];else if(typeof e=="string"&&e.endsWith("Carbon")){let s=e.substring(0,e.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[s]<"u"){let l=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);l.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[s],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[e]={prop:"elem",map:l},e=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[e]}}let n=o.color;if(typeof t.color<"u"&&t.color!="spectrum"&&(n=t.color),typeof e<"u"){let s,l;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[e]<"u")e=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[e],typeof e[o[e.prop]]<"u"&&(n=e.map[o[e.prop]]);else if(typeof e[o[e.prop]]<"u")n=e.map[o[e.prop]];else if(typeof e.prop<"u"&&typeof e.gradient<"u"){s=e.prop;var r=e.gradient;typeof _Gradient__WEBPACK_IMPORTED_MODULE_0__.builtinGradients[r]<"u"&&(r=new _Gradient__WEBPACK_IMPORTED_MODULE_0__.builtinGradients[r](e.min,e.max,e.mid?e.mid:e.colors));let c=r.range()||[-1,1];l=getAtomProperty(o,s),l!=null&&(n=r.valueToHex(l,c))}else typeof e.prop<"u"&&typeof e.map<"u"?(s=e.prop,l=getAtomProperty(o,s),typeof e.map[l]<"u"&&(n=e.map[l])):typeof t.colorscheme[o.elem]<"u"?n=t.colorscheme[o.elem]:console.log("Could not interpret colorscheme "+e)}else typeof t.colorfunc<"u"&&(n=t.colorfunc(o));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(n)}function getElement(o){let t=o;return typeof o=="string"?t=document.querySelector("#"+o):typeof o=="object"&&o.get&&(t=o.get(0)),t}},"./node_modules/upng-js/UPNG.js":(o,t,e)=>{(function(){var n={},r;o.exports=n,r=e("./node_modules/upng-js/node_modules/pako/index.js"),function(a,s){a.toRGBA8=function(l){var c=l.width,u=l.height;if(l.tabs.acTL==null)return[a.toRGBA8.decodeImage(l.data,c,u,l).buffer];var f=[];l.frames[0].data==null&&(l.frames[0].data=l.data);for(var p,g=new Uint8Array(c*u*4),y=0;y<l.frames.length;y++){var E=l.frames[y],h=E.rect.x,v=E.rect.y,C=E.rect.width,x=E.rect.height,w=a.toRGBA8.decodeImage(E.data,C,x,l);if(y==0?p=w:E.blend==0?a._copyTile(w,C,x,p,c,u,h,v,0):E.blend==1&&a._copyTile(w,C,x,p,c,u,h,v,1),f.push(p.buffer),p=p.slice(0),E.dispose!=0){if(E.dispose==1)a._copyTile(g,C,x,p,c,u,h,v,0);else if(E.dispose==2){for(var _=y-1;l.frames[_].dispose==2;)_--;p=new Uint8Array(f[_]).slice(0)}}}return f},a.toRGBA8.decodeImage=function(l,c,u,f){var p=c*u,g=a.decode._getBPP(f),y=Math.ceil(c*g/8),E=new Uint8Array(p*4),h=new Uint32Array(E.buffer),v=f.ctype,C=f.depth,x=a._bin.readUshort;if(v==6){var w=p<<2;if(C==8)for(var _=0;_<w;_++)E[_]=l[_];if(C==16)for(var _=0;_<w;_++)E[_]=l[_<<1]}else if(v==2){var S=f.tabs.tRNS,M=-1,T=-1,R=-1;if(S&&(M=S[0],T=S[1],R=S[2]),C==8)for(var _=0;_<p;_++){var P=_<<2,I=_*3;E[P]=l[I],E[P+1]=l[I+1],E[P+2]=l[I+2],E[P+3]=255,M!=-1&&l[I]==M&&l[I+1]==T&&l[I+2]==R&&(E[P+3]=0)}if(C==16)for(var _=0;_<p;_++){var P=_<<2,I=_*6;E[P]=l[I],E[P+1]=l[I+2],E[P+2]=l[I+4],E[P+3]=255,M!=-1&&x(l,I)==M&&x(l,I+2)==T&&x(l,I+4)==R&&(E[P+3]=0)}}else if(v==3){var B=f.tabs.PLTE,W=f.tabs.tRNS,D=W?W.length:0;if(C==1)for(var O=0;O<u;O++)for(var z=O*y,G=O*c,_=0;_<c;_++){var P=G+_<<2,k=l[z+(_>>3)]>>7-((_&7)<<0)&1,$=3*k;E[P]=B[$],E[P+1]=B[$+1],E[P+2]=B[$+2],E[P+3]=k<D?W[k]:255}if(C==2)for(var O=0;O<u;O++)for(var z=O*y,G=O*c,_=0;_<c;_++){var P=G+_<<2,k=l[z+(_>>2)]>>6-((_&3)<<1)&3,$=3*k;E[P]=B[$],E[P+1]=B[$+1],E[P+2]=B[$+2],E[P+3]=k<D?W[k]:255}if(C==4)for(var O=0;O<u;O++)for(var z=O*y,G=O*c,_=0;_<c;_++){var P=G+_<<2,k=l[z+(_>>1)]>>4-((_&1)<<2)&15,$=3*k;E[P]=B[$],E[P+1]=B[$+1],E[P+2]=B[$+2],E[P+3]=k<D?W[k]:255}if(C==8)for(var _=0;_<p;_++){var P=_<<2,k=l[_],$=3*k;E[P]=B[$],E[P+1]=B[$+1],E[P+2]=B[$+2],E[P+3]=k<D?W[k]:255}}else if(v==4){if(C==8)for(var _=0;_<p;_++){var P=_<<2,Z=_<<1,K=l[Z];E[P]=K,E[P+1]=K,E[P+2]=K,E[P+3]=l[Z+1]}if(C==16)for(var _=0;_<p;_++){var P=_<<2,Z=_<<2,K=l[Z];E[P]=K,E[P+1]=K,E[P+2]=K,E[P+3]=l[Z+2]}}else if(v==0){var M=f.tabs.tRNS?f.tabs.tRNS:-1;if(C==1)for(var _=0;_<p;_++){var K=255*(l[_>>3]>>7-(_&7)&1),j=K==M*255?0:255;h[_]=j<<24|K<<16|K<<8|K}if(C==2)for(var _=0;_<p;_++){var K=85*(l[_>>2]>>6-((_&3)<<1)&3),j=K==M*85?0:255;h[_]=j<<24|K<<16|K<<8|K}if(C==4)for(var _=0;_<p;_++){var K=17*(l[_>>1]>>4-((_&1)<<2)&15),j=K==M*17?0:255;h[_]=j<<24|K<<16|K<<8|K}if(C==8)for(var _=0;_<p;_++){var K=l[_],j=K==M?0:255;h[_]=j<<24|K<<16|K<<8|K}if(C==16)for(var _=0;_<p;_++){var K=l[_<<1],j=x(l,_<<1)==M?0:255;h[_]=j<<24|K<<16|K<<8|K}}return E},a.decode=function(l){for(var c=new Uint8Array(l),u=8,f=a._bin,p=f.readUshort,g=f.readUint,y={tabs:{},frames:[]},E=new Uint8Array(c.length),h=0,v,C=0,x=[137,80,78,71,13,10,26,10],w=0;w<8;w++)if(c[w]!=x[w])throw"The input is not a PNG file!";for(;u<c.length;){var _=f.readUint(c,u);u+=4;var S=f.readASCII(c,u,4);if(u+=4,S=="IHDR")a.decode._IHDR(c,u,y);else if(S=="IDAT"){for(var w=0;w<_;w++)E[h+w]=c[u+w];h+=_}else if(S=="acTL")y.tabs[S]={num_frames:g(c,u),num_plays:g(c,u+4)},v=new Uint8Array(c.length);else if(S=="fcTL"){if(C!=0){var M=y.frames[y.frames.length-1];M.data=a.decode._decompress(y,v.slice(0,C),M.rect.width,M.rect.height),C=0}var T={x:g(c,u+12),y:g(c,u+16),width:g(c,u+4),height:g(c,u+8)},R=p(c,u+22);R=p(c,u+20)/(R==0?100:R);var P={rect:T,delay:Math.round(R*1e3),dispose:c[u+24],blend:c[u+25]};y.frames.push(P)}else if(S=="fdAT"){for(var w=0;w<_-4;w++)v[C+w]=c[u+w+4];C+=_-4}else if(S=="pHYs")y.tabs[S]=[f.readUint(c,u),f.readUint(c,u+4),c[u+8]];else if(S=="cHRM"){y.tabs[S]=[];for(var w=0;w<8;w++)y.tabs[S].push(f.readUint(c,u+w*4))}else if(S=="tEXt"){y.tabs[S]==null&&(y.tabs[S]={});var I=f.nextZero(c,u),B=f.readASCII(c,u,I-u),W=f.readASCII(c,I+1,u+_-I-1);y.tabs[S][B]=W}else if(S=="iTXt"){y.tabs[S]==null&&(y.tabs[S]={});var I=0,D=u;I=f.nextZero(c,D);var B=f.readASCII(c,D,I-D);D=I+1,c[D],c[D+1],D+=2,I=f.nextZero(c,D),f.readASCII(c,D,I-D),D=I+1,I=f.nextZero(c,D),f.readUTF8(c,D,I-D),D=I+1;var W=f.readUTF8(c,D,_-(D-u));y.tabs[S][B]=W}else if(S=="PLTE")y.tabs[S]=f.readBytes(c,u,_);else if(S=="hIST"){var O=y.tabs.PLTE.length/3;y.tabs[S]=[];for(var w=0;w<O;w++)y.tabs[S].push(p(c,u+w*2))}else if(S=="tRNS")y.ctype==3?y.tabs[S]=f.readBytes(c,u,_):y.ctype==0?y.tabs[S]=p(c,u):y.ctype==2&&(y.tabs[S]=[p(c,u),p(c,u+2),p(c,u+4)]);else if(S=="gAMA")y.tabs[S]=f.readUint(c,u)/1e5;else if(S=="sRGB")y.tabs[S]=c[u];else if(S=="bKGD")y.ctype==0||y.ctype==4?y.tabs[S]=[p(c,u)]:y.ctype==2||y.ctype==6?y.tabs[S]=[p(c,u),p(c,u+2),p(c,u+4)]:y.ctype==3&&(y.tabs[S]=c[u]);else if(S=="IEND"){if(C!=0){var M=y.frames[y.frames.length-1];M.data=a.decode._decompress(y,v.slice(0,C),M.rect.width,M.rect.height),C=0}y.data=a.decode._decompress(y,E,y.width,y.height);break}u+=_,f.readUint(c,u),u+=4}return delete y.compress,delete y.interlace,delete y.filter,y},a.decode._decompress=function(l,c,u,f){return l.compress==0&&(c=a.decode._inflate(c)),l.interlace==0?c=a.decode._filterZero(c,l,0,u,f):l.interlace==1&&(c=a.decode._readInterlace(c,l)),c},a.decode._inflate=function(l){return s.inflate(l)},a.decode._readInterlace=function(l,c){for(var u=c.width,f=c.height,p=a.decode._getBPP(c),g=p>>3,y=Math.ceil(u*p/8),E=new Uint8Array(f*y),h=0,v=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],x=[8,8,8,4,4,2,2],w=[8,8,4,4,2,2,1],_=0;_<7;){for(var S=x[_],M=w[_],T=0,R=0,P=v[_];P<f;)P+=S,R++;for(var I=C[_];I<u;)I+=M,T++;var B=Math.ceil(T*p/8);a.decode._filterZero(l,c,h,T,R);for(var W=0,D=v[_];D<f;){for(var O=C[_],z=h+W*B<<3;O<u;){if(p==1){var G=l[z>>3];G=G>>7-(z&7)&1,E[D*y+(O>>3)]|=G<<7-((O&3)<<0)}if(p==2){var G=l[z>>3];G=G>>6-(z&7)&3,E[D*y+(O>>2)]|=G<<6-((O&3)<<1)}if(p==4){var G=l[z>>3];G=G>>4-(z&7)&15,E[D*y+(O>>1)]|=G<<4-((O&1)<<2)}if(p>=8)for(var k=D*y+O*g,$=0;$<g;$++)E[k+$]=l[(z>>3)+$];z+=p,O+=M}W++,D+=S}T*R!=0&&(h+=R*(1+B)),_=_+1}return E},a.decode._getBPP=function(l){var c=[1,null,3,1,2,null,4][l.ctype];return c*l.depth},a.decode._filterZero=function(l,c,u,f,p){var g=a.decode._getBPP(c),y=Math.ceil(f*g/8),E=a.decode._paeth;g=Math.ceil(g/8);for(var h=0;h<p;h++){var v=u+h*y,C=v+h+1,x=l[C-1];if(x==0)for(var w=0;w<y;w++)l[v+w]=l[C+w];else if(x==1){for(var w=0;w<g;w++)l[v+w]=l[C+w];for(var w=g;w<y;w++)l[v+w]=l[C+w]+l[v+w-g]&255}else if(h==0){for(var w=0;w<g;w++)l[v+w]=l[C+w];if(x==2)for(var w=g;w<y;w++)l[v+w]=l[C+w]&255;if(x==3)for(var w=g;w<y;w++)l[v+w]=l[C+w]+(l[v+w-g]>>1)&255;if(x==4)for(var w=g;w<y;w++)l[v+w]=l[C+w]+E(l[v+w-g],0,0)&255}else{if(x==2)for(var w=0;w<y;w++)l[v+w]=l[C+w]+l[v+w-y]&255;if(x==3){for(var w=0;w<g;w++)l[v+w]=l[C+w]+(l[v+w-y]>>1)&255;for(var w=g;w<y;w++)l[v+w]=l[C+w]+(l[v+w-y]+l[v+w-g]>>1)&255}if(x==4){for(var w=0;w<g;w++)l[v+w]=l[C+w]+E(0,l[v+w-y],0)&255;for(var w=g;w<y;w++)l[v+w]=l[C+w]+E(l[v+w-g],l[v+w-y],l[v+w-g-y])&255}}}return l},a.decode._paeth=function(l,c,u){var f=l+c-u,p=Math.abs(f-l),g=Math.abs(f-c),y=Math.abs(f-u);return p<=g&&p<=y?l:g<=y?c:u},a.decode._IHDR=function(l,c,u){var f=a._bin;u.width=f.readUint(l,c),c+=4,u.height=f.readUint(l,c),c+=4,u.depth=l[c],c++,u.ctype=l[c],c++,u.compress=l[c],c++,u.filter=l[c],c++,u.interlace=l[c],c++},a._bin={nextZero:function(l,c){for(;l[c]!=0;)c++;return c},readUshort:function(l,c){return l[c]<<8|l[c+1]},writeUshort:function(l,c,u){l[c]=u>>8&255,l[c+1]=u&255},readUint:function(l,c){return l[c]*16777216+(l[c+1]<<16|l[c+2]<<8|l[c+3])},writeUint:function(l,c,u){l[c]=u>>24&255,l[c+1]=u>>16&255,l[c+2]=u>>8&255,l[c+3]=u&255},readASCII:function(l,c,u){for(var f="",p=0;p<u;p++)f+=String.fromCharCode(l[c+p]);return f},writeASCII:function(l,c,u){for(var f=0;f<u.length;f++)l[c+f]=u.charCodeAt(f)},readBytes:function(l,c,u){for(var f=[],p=0;p<u;p++)f.push(l[c+p]);return f},pad:function(l){return l.length<2?"0"+l:l},readUTF8:function(l,c,u){for(var f="",p,g=0;g<u;g++)f+="%"+a._bin.pad(l[c+g].toString(16));try{p=decodeURIComponent(f)}catch{return a._bin.readASCII(l,c,u)}return p}},a._copyTile=function(l,c,u,f,p,g,y,E,h){for(var v=Math.min(c,p),C=Math.min(u,g),x=0,w=0,_=0;_<C;_++)for(var S=0;S<v;S++)if(y>=0&&E>=0?(x=_*c+S<<2,w=(E+_)*p+y+S<<2):(x=(-E+_)*c-y+S<<2,w=_*p+S<<2),h==0)f[w]=l[x],f[w+1]=l[x+1],f[w+2]=l[x+2],f[w+3]=l[x+3];else if(h==1){var M=l[x+3]*.00392156862745098,T=l[x]*M,R=l[x+1]*M,P=l[x+2]*M,I=f[w+3]*(1/255),B=f[w]*I,W=f[w+1]*I,D=f[w+2]*I,O=1-M,z=M+I*O,G=z==0?0:1/z;f[w+3]=255*z,f[w+0]=(T+B*O)*G,f[w+1]=(R+W*O)*G,f[w+2]=(P+D*O)*G}else if(h==2){var M=l[x+3],T=l[x],R=l[x+1],P=l[x+2],I=f[w+3],B=f[w],W=f[w+1],D=f[w+2];M==I&&T==B&&R==W&&P==D?(f[w]=0,f[w+1]=0,f[w+2]=0,f[w+3]=0):(f[w]=T,f[w+1]=R,f[w+2]=P,f[w+3]=M)}else if(h==3){var M=l[x+3],T=l[x],R=l[x+1],P=l[x+2],I=f[w+3],B=f[w],W=f[w+1],D=f[w+2];if(M==I&&T==B&&R==W&&P==D)continue;if(M<220&&I>20)return!1}return!0},a.encode=function(l,c,u,f,p,g){f==null&&(f=0),g==null&&(g=!1);for(var y=new Uint8Array(l[0].byteLength*l.length+100),E=[137,80,78,71,13,10,26,10],h=0;h<8;h++)y[h]=E[h];var v=8,C=a._bin,x=a.crc.crc,w=C.writeUint,_=C.writeUshort,S=C.writeASCII,M=a.encode.compressPNG(l,c,u,f,g);w(y,v,13),v+=4,S(y,v,"IHDR"),v+=4,w(y,v,c),v+=4,w(y,v,u),v+=4,y[v]=M.depth,v++,y[v]=M.ctype,v++,y[v]=0,v++,y[v]=0,v++,y[v]=0,v++,w(y,v,x(y,v-17,17)),v+=4,w(y,v,1),v+=4,S(y,v,"sRGB"),v+=4,y[v]=1,v++,w(y,v,x(y,v-5,5)),v+=4;var T=l.length>1;if(T&&(w(y,v,8),v+=4,S(y,v,"acTL"),v+=4,w(y,v,l.length),v+=4,w(y,v,0),v+=4,w(y,v,x(y,v-12,12)),v+=4),M.ctype==3){var R=M.plte.length;w(y,v,R*3),v+=4,S(y,v,"PLTE"),v+=4;for(var h=0;h<R;h++){var P=h*3,I=M.plte[h],B=I&255,W=I>>8&255,D=I>>16&255;y[v+P+0]=B,y[v+P+1]=W,y[v+P+2]=D}if(v+=R*3,w(y,v,x(y,v-R*3-4,R*3+4)),v+=4,M.gotAlpha){w(y,v,R),v+=4,S(y,v,"tRNS"),v+=4;for(var h=0;h<R;h++)y[v+h]=M.plte[h]>>24&255;v+=R,w(y,v,x(y,v-R-4,R+4)),v+=4}}for(var O=0,z=0;z<M.frames.length;z++){var G=M.frames[z];T&&(w(y,v,26),v+=4,S(y,v,"fcTL"),v+=4,w(y,v,O++),v+=4,w(y,v,G.rect.width),v+=4,w(y,v,G.rect.height),v+=4,w(y,v,G.rect.x),v+=4,w(y,v,G.rect.y),v+=4,_(y,v,p[z]),v+=2,_(y,v,1e3),v+=2,y[v]=G.dispose,v++,y[v]=G.blend,v++,w(y,v,x(y,v-30,30)),v+=4);var k=G.cimg,R=k.length;w(y,v,R+(z==0?0:4)),v+=4;var $=v;S(y,v,z==0?"IDAT":"fdAT"),v+=4,z!=0&&(w(y,v,O++),v+=4);for(var h=0;h<R;h++)y[v+h]=k[h];v+=R,w(y,v,x(y,$,v-$)),v+=4}return w(y,v,0),v+=4,S(y,v,"IEND"),v+=4,w(y,v,x(y,v-4,4)),v+=4,y.buffer.slice(0,v)},a.encode.compressPNG=function(l,c,u,f,p){for(var g=a.encode.compress(l,c,u,f,!1,p),y=0;y<l.length;y++){var E=g.frames[y];E.rect.width;var h=E.rect.height,v=E.bpl,C=E.bpp,x=new Uint8Array(h*v+h);E.cimg=a.encode._filterZero(E.img,h,C,v,x)}return g},a.encode.compress=function(l,c,u,f,p,g){g==null&&(g=!1);for(var y=6,E=8,h=4,v=255,C=0;C<l.length;C++)for(var x=new Uint8Array(l[C]),w=x.length,_=0;_<w;_+=4)v&=x[_+3];var S=v!=255,M={},T=[];if(l.length!=0&&(M[0]=0,T.push(0),f!=0&&f--),f!=0){var R=a.quantize(l,f,p);l=R.bufs;for(var _=0;_<R.plte.length;_++){var P=R.plte[_].est.rgba;M[P]==null&&(M[P]=T.length,T.push(P))}}else for(var C=0;C<l.length;C++)for(var I=new Uint32Array(l[C]),w=I.length,_=0;_<w;_++){var P=I[_];if((_<c||P!=I[_-1]&&P!=I[_-c])&&M[P]==null&&(M[P]=T.length,T.push(P),T.length>=300))break}var B=S?p:!1,W=T.length;W<=256&&g==!1&&(W<=2?E=1:W<=4?E=2:W<=16?E=4:E=8,p&&(E=8),S=!0);for(var D=[],C=0;C<l.length;C++){var O=new Uint8Array(l[C]),z=new Uint32Array(O.buffer),G=0,k=0,$=c,Z=u,K=0;if(C!=0&&!B){for(var j=p||C==1||D[D.length-2].dispose==2?1:2,Q=0,le=1e9,he=0;he<j;he++){for(var ce=new Uint8Array(l[C-1-he]),ve=new Uint32Array(l[C-1-he]),re=c,Ie=u,ge=-1,Se=-1,Le=0;Le<u;Le++)for(var be=0;be<c;be++){var _=Le*c+be;z[_]!=ve[_]&&(be<re&&(re=be),be>ge&&(ge=be),Le<Ie&&(Ie=Le),Le>Se&&(Se=Le))}var ye=ge==-1?1:(ge-re+1)*(Se-Ie+1);ye<le&&(le=ye,Q=he,ge==-1?(G=k=0,$=Z=1):(G=re,k=Ie,$=ge-re+1,Z=Se-Ie+1))}var ce=new Uint8Array(l[C-1-Q]);Q==1&&(D[D.length-1].dispose=2);var ue=new Uint8Array($*Z*4);new Uint32Array(ue.buffer),a._copyTile(ce,c,u,ue,$,Z,-G,-k,0),a._copyTile(O,c,u,ue,$,Z,-G,-k,3)?(a._copyTile(O,c,u,ue,$,Z,-G,-k,2),K=1):(a._copyTile(O,c,u,ue,$,Z,-G,-k,0),K=0),O=ue,z=new Uint32Array(O.buffer)}var Ce=4*$;if(W<=256&&g==!1){Ce=Math.ceil(E*$/8);for(var ue=new Uint8Array(Ce*Z),Le=0;Le<Z;Le++){var _=Le*Ce,Ve=Le*$;if(E==8)for(var be=0;be<$;be++)ue[_+be]=M[z[Ve+be]];else if(E==4)for(var be=0;be<$;be++)ue[_+(be>>1)]|=M[z[Ve+be]]<<4-(be&1)*4;else if(E==2)for(var be=0;be<$;be++)ue[_+(be>>2)]|=M[z[Ve+be]]<<6-(be&3)*2;else if(E==1)for(var be=0;be<$;be++)ue[_+(be>>3)]|=M[z[Ve+be]]<<7-(be&7)*1}O=ue,y=3,h=1}else if(S==!1&&l.length==1){for(var ue=new Uint8Array($*Z*3),ie=$*Z,_=0;_<ie;_++){var ae=_*3,Ae=_*4;ue[ae]=O[Ae],ue[ae+1]=O[Ae+1],ue[ae+2]=O[Ae+2]}O=ue,y=2,h=3,Ce=3*$}D.push({rect:{x:G,y:k,width:$,height:Z},img:O,bpl:Ce,bpp:h,blend:K,dispose:B?1:0})}return{ctype:y,depth:E,plte:T,gotAlpha:S,frames:D}},a.encode._filterZero=function(l,c,u,f,p){for(var g=[],y=0;y<5;y++)if(!(c*f>5e5&&(y==2||y==3||y==4))){for(var E=0;E<c;E++)a.encode._filterLine(p,l,E,f,u,y);if(g.push(s.deflate(p)),u==1)break}for(var h,v=1e9,C=0;C<g.length;C++)g[C].length<v&&(h=C,v=g[C].length);return g[h]},a.encode._filterLine=function(l,c,u,f,p,g){var y=u*f,E=y+u,h=a.decode._paeth;if(l[E]=g,E++,g==0)for(var v=0;v<f;v++)l[E+v]=c[y+v];else if(g==1){for(var v=0;v<p;v++)l[E+v]=c[y+v];for(var v=p;v<f;v++)l[E+v]=c[y+v]-c[y+v-p]+256&255}else if(u==0){for(var v=0;v<p;v++)l[E+v]=c[y+v];if(g==2)for(var v=p;v<f;v++)l[E+v]=c[y+v];if(g==3)for(var v=p;v<f;v++)l[E+v]=c[y+v]-(c[y+v-p]>>1)+256&255;if(g==4)for(var v=p;v<f;v++)l[E+v]=c[y+v]-h(c[y+v-p],0,0)+256&255}else{if(g==2)for(var v=0;v<f;v++)l[E+v]=c[y+v]+256-c[y+v-f]&255;if(g==3){for(var v=0;v<p;v++)l[E+v]=c[y+v]+256-(c[y+v-f]>>1)&255;for(var v=p;v<f;v++)l[E+v]=c[y+v]+256-(c[y+v-f]+c[y+v-p]>>1)&255}if(g==4){for(var v=0;v<p;v++)l[E+v]=c[y+v]+256-h(0,c[y+v-f],0)&255;for(var v=p;v<f;v++)l[E+v]=c[y+v]+256-h(c[y+v-p],c[y+v-f],c[y+v-p-f])&255}}},a.crc={table:function(){for(var l=new Uint32Array(256),c=0;c<256;c++){for(var u=c,f=0;f<8;f++)u&1?u=3988292384^u>>>1:u=u>>>1;l[c]=u}return l}(),update:function(l,c,u,f){for(var p=0;p<f;p++)l=a.crc.table[(l^c[u+p])&255]^l>>>8;return l},crc:function(l,c,u){return a.crc.update(4294967295,l,c,u)^4294967295}},a.quantize=function(l,c,u){for(var f=[],p=0,g=0;g<l.length;g++)f.push(a.encode.alphaMul(new Uint8Array(l[g]),u)),p+=l[g].byteLength;for(var y=new Uint8Array(p),E=new Uint32Array(y.buffer),h=0,g=0;g<f.length;g++){for(var v=f[g],C=v.length,x=0;x<C;x++)y[h+x]=v[x];h+=C}var w={i0:0,i1:y.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=a.quantize.stats(y,w.i0,w.i1),w.est=a.quantize.estats(w.bst);for(var _=[w];_.length<c;){for(var S=0,M=0,g=0;g<_.length;g++)_[g].est.L>S&&(S=_[g].est.L,M=g);if(S<.001)break;var T=_[M],R=a.quantize.splitPixels(y,E,T.i0,T.i1,T.est.e,T.est.eMq255),P={i0:T.i0,i1:R,bst:null,est:null,tdst:0,left:null,right:null};P.bst=a.quantize.stats(y,P.i0,P.i1),P.est=a.quantize.estats(P.bst);var I={i0:R,i1:T.i1,bst:null,est:null,tdst:0,left:null,right:null};I.bst={R:[],m:[],N:T.bst.N-P.bst.N};for(var g=0;g<16;g++)I.bst.R[g]=T.bst.R[g]-P.bst.R[g];for(var g=0;g<4;g++)I.bst.m[g]=T.bst.m[g]-P.bst.m[g];I.est=a.quantize.estats(I.bst),T.left=P,T.right=I,_[M]=P,_.push(I)}_.sort(function(j,Q){return Q.bst.N-j.bst.N});for(var B=0;B<f.length;B++){for(var W=a.quantize.planeDst,D=new Uint8Array(f[B].buffer),O=new Uint32Array(f[B].buffer),z=D.length,g=0;g<z;g+=4){for(var G=D[g]*.00392156862745098,k=D[g+1]*(1/255),$=D[g+2]*(1/255),Z=D[g+3]*(1/255),K=w;K.left;)K=W(K.est,G,k,$,Z)<=0?K.left:K.right;O[g>>2]=K.est.rgba}f[B]=O.buffer}return{bufs:f,plte:_}},a.quantize.getNearest=function(l,c,u,f,p){if(l.left==null)return l.tdst=a.quantize.dist(l.est.q,c,u,f,p),l;var g=a.quantize.planeDst(l.est,c,u,f,p),y=l.left,E=l.right;g>0&&(y=l.right,E=l.left);var h=a.quantize.getNearest(y,c,u,f,p);if(h.tdst<=g*g)return h;var v=a.quantize.getNearest(E,c,u,f,p);return v.tdst<h.tdst?v:h},a.quantize.planeDst=function(l,c,u,f,p){var g=l.e;return g[0]*c+g[1]*u+g[2]*f+g[3]*p-l.eMq},a.quantize.dist=function(l,c,u,f,p){var g=c-l[0],y=u-l[1],E=f-l[2],h=p-l[3];return g*g+y*y+E*E+h*h},a.quantize.splitPixels=function(l,c,u,f,p,g){var y=a.quantize.vecDot;for(f-=4;u<f;){for(;y(l,u,p)<=g;)u+=4;for(;y(l,f,p)>g;)f-=4;if(u>=f)break;var E=c[u>>2];c[u>>2]=c[f>>2],c[f>>2]=E,u+=4,f-=4}for(;y(l,u,p)>g;)u-=4;return u+4},a.quantize.vecDot=function(l,c,u){return l[c]*u[0]+l[c+1]*u[1]+l[c+2]*u[2]+l[c+3]*u[3]},a.quantize.stats=function(l,c,u){for(var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=[0,0,0,0],g=u-c>>2,y=c;y<u;y+=4){var E=l[y]*.00392156862745098,h=l[y+1]*(1/255),v=l[y+2]*(1/255),C=l[y+3]*(1/255);p[0]+=E,p[1]+=h,p[2]+=v,p[3]+=C,f[0]+=E*E,f[1]+=E*h,f[2]+=E*v,f[3]+=E*C,f[5]+=h*h,f[6]+=h*v,f[7]+=h*C,f[10]+=v*v,f[11]+=v*C,f[15]+=C*C}return f[4]=f[1],f[8]=f[2],f[12]=f[3],f[9]=f[6],f[13]=f[7],f[14]=f[11],{R:f,m:p,N:g}},a.quantize.estats=function(l){var c=l.R,u=l.m,f=l.N,p=u[0],g=u[1],y=u[2],E=u[3],h=f==0?0:1/f,v=[c[0]-p*p*h,c[1]-p*g*h,c[2]-p*y*h,c[3]-p*E*h,c[4]-g*p*h,c[5]-g*g*h,c[6]-g*y*h,c[7]-g*E*h,c[8]-y*p*h,c[9]-y*g*h,c[10]-y*y*h,c[11]-y*E*h,c[12]-E*p*h,c[13]-E*g*h,c[14]-E*y*h,c[15]-E*E*h],C=v,x=a.M4,w=[.5,.5,.5,.5],_=0,S=0;if(f!=0)for(var M=0;M<10&&(w=x.multVec(C,w),S=Math.sqrt(x.dot(w,w)),w=x.sml(1/S,w),!(Math.abs(S-_)<1e-9));M++)_=S;var T=[p*h,g*h,y*h,E*h],R=x.dot(x.sml(255,T),w),P=T[3]<.001?0:1/T[3];return{Cov:v,q:T,e:w,L:_,eMq255:R,eMq:x.dot(w,T),rgba:(Math.round(255*T[3])<<24|Math.round(255*T[2]*P)<<16|Math.round(255*T[1]*P)<<8|Math.round(255*T[0]*P)<<0)>>>0}},a.M4={multVec:function(l,c){return[l[0]*c[0]+l[1]*c[1]+l[2]*c[2]+l[3]*c[3],l[4]*c[0]+l[5]*c[1]+l[6]*c[2]+l[7]*c[3],l[8]*c[0]+l[9]*c[1]+l[10]*c[2]+l[11]*c[3],l[12]*c[0]+l[13]*c[1]+l[14]*c[2]+l[15]*c[3]]},dot:function(l,c){return l[0]*c[0]+l[1]*c[1]+l[2]*c[2]+l[3]*c[3]},sml:function(l,c){return[l*c[0],l*c[1],l*c[2],l*c[3]]}},a.encode.alphaMul=function(l,c){for(var u=new Uint8Array(l.length),f=l.length>>2,p=0;p<f;p++){var g=p<<2,y=l[g+3];c&&(y=y<128?0:255);var E=y*(1/255);u[g+0]=l[g+0]*E,u[g+1]=l[g+1]*E,u[g+2]=l[g+2]*E,u[g+3]=y}return u}}(n,r)})()},"./node_modules/upng-js/node_modules/pako/index.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,r=e("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),a=e("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),s=e("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),l={};n(l,r,a,s),o.exports=l},"./node_modules/upng-js/node_modules/pako/lib/deflate.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),r=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),a=e("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),s=e("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),l=e("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),c=Object.prototype.toString,u=0,f=4,p=0,g=1,y=2,E=-1,h=0,v=8;function C(S){if(!(this instanceof C))return new C(S);this.options=r.assign({level:E,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},S||{});var M=this.options;M.raw&&M.windowBits>0?M.windowBits=-M.windowBits:M.gzip&&M.windowBits>0&&M.windowBits<16&&(M.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=n.deflateInit2(this.strm,M.level,M.method,M.windowBits,M.memLevel,M.strategy);if(T!==p)throw new Error(s[T]);if(M.header&&n.deflateSetHeader(this.strm,M.header),M.dictionary){var R;if(typeof M.dictionary=="string"?R=a.string2buf(M.dictionary):c.call(M.dictionary)==="[object ArrayBuffer]"?R=new Uint8Array(M.dictionary):R=M.dictionary,T=n.deflateSetDictionary(this.strm,R),T!==p)throw new Error(s[T]);this._dict_set=!0}}C.prototype.push=function(S,M){var T=this.strm,R=this.options.chunkSize,P,I;if(this.ended)return!1;I=M===~~M?M:M===!0?f:u,typeof S=="string"?T.input=a.string2buf(S):c.call(S)==="[object ArrayBuffer]"?T.input=new Uint8Array(S):T.input=S,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new r.Buf8(R),T.next_out=0,T.avail_out=R),P=n.deflate(T,I),P!==g&&P!==p)return this.onEnd(P),this.ended=!0,!1;(T.avail_out===0||T.avail_in===0&&(I===f||I===y))&&(this.options.to==="string"?this.onData(a.buf2binstring(r.shrinkBuf(T.output,T.next_out))):this.onData(r.shrinkBuf(T.output,T.next_out)))}while((T.avail_in>0||T.avail_out===0)&&P!==g);return I===f?(P=n.deflateEnd(this.strm),this.onEnd(P),this.ended=!0,P===p):(I===y&&(this.onEnd(p),T.avail_out=0),!0)},C.prototype.onData=function(S){this.chunks.push(S)},C.prototype.onEnd=function(S){S===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=S,this.msg=this.strm.msg};function x(S,M){var T=new C(M);if(T.push(S,!0),T.err)throw T.msg||s[T.err];return T.result}function w(S,M){return M=M||{},M.raw=!0,x(S,M)}function _(S,M){return M=M||{},M.gzip=!0,x(S,M)}t.Deflate=C,t.deflate=x,t.deflateRaw=w,t.gzip=_},"./node_modules/upng-js/node_modules/pako/lib/inflate.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),r=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),a=e("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),s=e("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),l=e("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),c=e("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),u=e("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),f=Object.prototype.toString;function p(E){if(!(this instanceof p))return new p(E);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},E||{});var h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,h.windowBits===0&&(h.windowBits=-15)),h.windowBits>=0&&h.windowBits<16&&!(E&&E.windowBits)&&(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&(h.windowBits&15||(h.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=n.inflateInit2(this.strm,h.windowBits);if(v!==s.Z_OK)throw new Error(l[v]);if(this.header=new u,n.inflateGetHeader(this.strm,this.header),h.dictionary&&(typeof h.dictionary=="string"?h.dictionary=a.string2buf(h.dictionary):f.call(h.dictionary)==="[object ArrayBuffer]"&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(v=n.inflateSetDictionary(this.strm,h.dictionary),v!==s.Z_OK)))throw new Error(l[v])}p.prototype.push=function(E,h){var v=this.strm,C=this.options.chunkSize,x=this.options.dictionary,w,_,S,M,T,R=!1;if(this.ended)return!1;_=h===~~h?h:h===!0?s.Z_FINISH:s.Z_NO_FLUSH,typeof E=="string"?v.input=a.binstring2buf(E):f.call(E)==="[object ArrayBuffer]"?v.input=new Uint8Array(E):v.input=E,v.next_in=0,v.avail_in=v.input.length;do{if(v.avail_out===0&&(v.output=new r.Buf8(C),v.next_out=0,v.avail_out=C),w=n.inflate(v,s.Z_NO_FLUSH),w===s.Z_NEED_DICT&&x&&(w=n.inflateSetDictionary(this.strm,x)),w===s.Z_BUF_ERROR&&R===!0&&(w=s.Z_OK,R=!1),w!==s.Z_STREAM_END&&w!==s.Z_OK)return this.onEnd(w),this.ended=!0,!1;v.next_out&&(v.avail_out===0||w===s.Z_STREAM_END||v.avail_in===0&&(_===s.Z_FINISH||_===s.Z_SYNC_FLUSH))&&(this.options.to==="string"?(S=a.utf8border(v.output,v.next_out),M=v.next_out-S,T=a.buf2string(v.output,S),v.next_out=M,v.avail_out=C-M,M&&r.arraySet(v.output,v.output,S,M,0),this.onData(T)):this.onData(r.shrinkBuf(v.output,v.next_out))),v.avail_in===0&&v.avail_out===0&&(R=!0)}while((v.avail_in>0||v.avail_out===0)&&w!==s.Z_STREAM_END);return w===s.Z_STREAM_END&&(_=s.Z_FINISH),_===s.Z_FINISH?(w=n.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===s.Z_OK):(_===s.Z_SYNC_FLUSH&&(this.onEnd(s.Z_OK),v.avail_out=0),!0)},p.prototype.onData=function(E){this.chunks.push(E)},p.prototype.onEnd=function(E){E===s.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg};function g(E,h){var v=new p(h);if(v.push(E,!0),v.err)throw v.msg||l[v.err];return v.result}function y(E,h){return h=h||{},h.raw=!0,g(E,h)}t.Inflate=p,t.inflate=g,t.inflateRaw=y,t.ungzip=g},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":(o,t)=>{var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function n(s,l){return Object.prototype.hasOwnProperty.call(s,l)}t.assign=function(s){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var u in c)n(c,u)&&(s[u]=c[u])}}return s},t.shrinkBuf=function(s,l){return s.length===l?s:s.subarray?s.subarray(0,l):(s.length=l,s)};var r={arraySet:function(s,l,c,u,f){if(l.subarray&&s.subarray){s.set(l.subarray(c,c+u),f);return}for(var p=0;p<u;p++)s[f+p]=l[c+p]},flattenChunks:function(s){var l,c,u,f,p,g;for(u=0,l=0,c=s.length;l<c;l++)u+=s[l].length;for(g=new Uint8Array(u),f=0,l=0,c=s.length;l<c;l++)p=s[l],g.set(p,f),f+=p.length;return g}},a={arraySet:function(s,l,c,u,f){for(var p=0;p<u;p++)s[f+p]=l[c+p]},flattenChunks:function(s){return[].concat.apply([],s)}};t.setTyped=function(s){s?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(e)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var s=new n.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,t.string2buf=function(u){var f,p,g,y,E,h=u.length,v=0;for(y=0;y<h;y++)p=u.charCodeAt(y),(p&64512)===55296&&y+1<h&&(g=u.charCodeAt(y+1),(g&64512)===56320&&(p=65536+(p-55296<<10)+(g-56320),y++)),v+=p<128?1:p<2048?2:p<65536?3:4;for(f=new n.Buf8(v),E=0,y=0;E<v;y++)p=u.charCodeAt(y),(p&64512)===55296&&y+1<h&&(g=u.charCodeAt(y+1),(g&64512)===56320&&(p=65536+(p-55296<<10)+(g-56320),y++)),p<128?f[E++]=p:p<2048?(f[E++]=192|p>>>6,f[E++]=128|p&63):p<65536?(f[E++]=224|p>>>12,f[E++]=128|p>>>6&63,f[E++]=128|p&63):(f[E++]=240|p>>>18,f[E++]=128|p>>>12&63,f[E++]=128|p>>>6&63,f[E++]=128|p&63);return f};function c(u,f){if(f<65534&&(u.subarray&&a||!u.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(u,f));for(var p="",g=0;g<f;g++)p+=String.fromCharCode(u[g]);return p}t.buf2binstring=function(u){return c(u,u.length)},t.binstring2buf=function(u){for(var f=new n.Buf8(u.length),p=0,g=f.length;p<g;p++)f[p]=u.charCodeAt(p);return f},t.buf2string=function(u,f){var p,g,y,E,h=f||u.length,v=new Array(h*2);for(g=0,p=0;p<h;){if(y=u[p++],y<128){v[g++]=y;continue}if(E=s[y],E>4){v[g++]=65533,p+=E-1;continue}for(y&=E===2?31:E===3?15:7;E>1&&p<h;)y=y<<6|u[p++]&63,E--;if(E>1){v[g++]=65533;continue}y<65536?v[g++]=y:(y-=65536,v[g++]=55296|y>>10&1023,v[g++]=56320|y&1023)}return c(v,g)},t.utf8border=function(u,f){var p;for(f=f||u.length,f>u.length&&(f=u.length),p=f-1;p>=0&&(u[p]&192)===128;)p--;return p<0||p===0?f:p+s[u[p]]>f?p:f}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":o=>{function t(e,n,r,a){for(var s=e&65535|0,l=e>>>16&65535|0,c=0;r!==0;){c=r>2e3?2e3:r,r-=c;do s=s+n[a++]|0,l=l+s|0;while(--c);s%=65521,l%=65521}return s|l<<16|0}o.exports=t},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":o=>{o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":o=>{function t(){for(var r,a=[],s=0;s<256;s++){r=s;for(var l=0;l<8;l++)r=r&1?3988292384^r>>>1:r>>>1;a[s]=r}return a}var e=t();function n(r,a,s,l){var c=e,u=l+s;r^=-1;for(var f=l;f<u;f++)r=r>>>8^c[(r^a[f])&255];return r^-1}o.exports=n},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),r=e("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),a=e("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),s=e("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),l=e("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),c=0,u=1,f=3,p=4,g=5,y=0,E=1,h=-2,v=-3,C=-5,x=-1,w=1,_=2,S=3,M=4,T=0,R=2,P=8,I=9,B=15,W=8,D=29,O=256,z=O+1+D,G=30,k=19,$=2*z+1,Z=15,K=3,j=258,Q=j+K+1,le=32,he=42,ve=69,re=73,Ie=91,ge=103,Se=113,Le=666,be=1,ye=2,ce=3,ue=4,Ce=3;function Ve(U,ke){return U.msg=l[ke],ke}function ie(U){return(U<<1)-(U>4?9:0)}function ae(U){for(var ke=U.length;--ke>=0;)U[ke]=0}function Ae(U){var ke=U.state,de=ke.pending;de>U.avail_out&&(de=U.avail_out),de!==0&&(n.arraySet(U.output,ke.pending_buf,ke.pending_out,de,U.next_out),U.next_out+=de,ke.pending_out+=de,U.total_out+=de,U.avail_out-=de,ke.pending-=de,ke.pending===0&&(ke.pending_out=0))}function De(U,ke){r._tr_flush_block(U,U.block_start>=0?U.block_start:-1,U.strstart-U.block_start,ke),U.block_start=U.strstart,Ae(U.strm)}function Be(U,ke){U.pending_buf[U.pending++]=ke}function ze(U,ke){U.pending_buf[U.pending++]=ke>>>8&255,U.pending_buf[U.pending++]=ke&255}function We(U,ke,de,se){var fe=U.avail_in;return fe>se&&(fe=se),fe===0?0:(U.avail_in-=fe,n.arraySet(ke,U.input,U.next_in,fe,de),U.state.wrap===1?U.adler=a(U.adler,ke,fe,de):U.state.wrap===2&&(U.adler=s(U.adler,ke,fe,de)),U.next_in+=fe,U.total_in+=fe,fe)}function $e(U,ke){var de=U.max_chain_length,se=U.strstart,fe,je,ht=U.prev_length,pt=U.nice_match,dt=U.strstart>U.w_size-Q?U.strstart-(U.w_size-Q):0,At=U.window,_e=U.w_mask,Xe=U.prev,Ue=U.strstart+j,Ye=At[se+ht-1],ot=At[se+ht];U.prev_length>=U.good_match&&(de>>=2),pt>U.lookahead&&(pt=U.lookahead);do if(fe=ke,!(At[fe+ht]!==ot||At[fe+ht-1]!==Ye||At[fe]!==At[se]||At[++fe]!==At[se+1])){se+=2,fe++;do;while(At[++se]===At[++fe]&&At[++se]===At[++fe]&&At[++se]===At[++fe]&&At[++se]===At[++fe]&&At[++se]===At[++fe]&&At[++se]===At[++fe]&&At[++se]===At[++fe]&&At[++se]===At[++fe]&&se<Ue);if(je=j-(Ue-se),se=Ue-j,je>ht){if(U.match_start=ke,ht=je,je>=pt)break;Ye=At[se+ht-1],ot=At[se+ht]}}while((ke=Xe[ke&_e])>dt&&--de!==0);return ht<=U.lookahead?ht:U.lookahead}function qe(U){var ke=U.w_size,de,se,fe,je,ht;do{if(je=U.window_size-U.lookahead-U.strstart,U.strstart>=ke+(ke-Q)){n.arraySet(U.window,U.window,ke,ke,0),U.match_start-=ke,U.strstart-=ke,U.block_start-=ke,se=U.hash_size,de=se;do fe=U.head[--de],U.head[de]=fe>=ke?fe-ke:0;while(--se);se=ke,de=se;do fe=U.prev[--de],U.prev[de]=fe>=ke?fe-ke:0;while(--se);je+=ke}if(U.strm.avail_in===0)break;if(se=We(U.strm,U.window,U.strstart+U.lookahead,je),U.lookahead+=se,U.lookahead+U.insert>=K)for(ht=U.strstart-U.insert,U.ins_h=U.window[ht],U.ins_h=(U.ins_h<<U.hash_shift^U.window[ht+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[ht+K-1])&U.hash_mask,U.prev[ht&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=ht,ht++,U.insert--,!(U.lookahead+U.insert<K)););}while(U.lookahead<Q&&U.strm.avail_in!==0)}function et(U,ke){var de=65535;for(de>U.pending_buf_size-5&&(de=U.pending_buf_size-5);;){if(U.lookahead<=1){if(qe(U),U.lookahead===0&&ke===c)return be;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var se=U.block_start+de;if((U.strstart===0||U.strstart>=se)&&(U.lookahead=U.strstart-se,U.strstart=se,De(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-Q&&(De(U,!1),U.strm.avail_out===0))return be}return U.insert=0,ke===p?(De(U,!0),U.strm.avail_out===0?ce:ue):(U.strstart>U.block_start&&(De(U,!1),U.strm.avail_out===0),be)}function F(U,ke){for(var de,se;;){if(U.lookahead<Q){if(qe(U),U.lookahead<Q&&ke===c)return be;if(U.lookahead===0)break}if(de=0,U.lookahead>=K&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+K-1])&U.hash_mask,de=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),de!==0&&U.strstart-de<=U.w_size-Q&&(U.match_length=$e(U,de)),U.match_length>=K)if(se=r._tr_tally(U,U.strstart-U.match_start,U.match_length-K),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=K){U.match_length--;do U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+K-1])&U.hash_mask,de=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart;while(--U.match_length!==0);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else se=r._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(se&&(De(U,!1),U.strm.avail_out===0))return be}return U.insert=U.strstart<K-1?U.strstart:K-1,ke===p?(De(U,!0),U.strm.avail_out===0?ce:ue):U.last_lit&&(De(U,!1),U.strm.avail_out===0)?be:ye}function H(U,ke){for(var de,se,fe;;){if(U.lookahead<Q){if(qe(U),U.lookahead<Q&&ke===c)return be;if(U.lookahead===0)break}if(de=0,U.lookahead>=K&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+K-1])&U.hash_mask,de=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=K-1,de!==0&&U.prev_length<U.max_lazy_match&&U.strstart-de<=U.w_size-Q&&(U.match_length=$e(U,de),U.match_length<=5&&(U.strategy===w||U.match_length===K&&U.strstart-U.match_start>4096)&&(U.match_length=K-1)),U.prev_length>=K&&U.match_length<=U.prev_length){fe=U.strstart+U.lookahead-K,se=r._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-K),U.lookahead-=U.prev_length-1,U.prev_length-=2;do++U.strstart<=fe&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+K-1])&U.hash_mask,de=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart);while(--U.prev_length!==0);if(U.match_available=0,U.match_length=K-1,U.strstart++,se&&(De(U,!1),U.strm.avail_out===0))return be}else if(U.match_available){if(se=r._tr_tally(U,0,U.window[U.strstart-1]),se&&De(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return be}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(se=r._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<K-1?U.strstart:K-1,ke===p?(De(U,!0),U.strm.avail_out===0?ce:ue):U.last_lit&&(De(U,!1),U.strm.avail_out===0)?be:ye}function X(U,ke){for(var de,se,fe,je,ht=U.window;;){if(U.lookahead<=j){if(qe(U),U.lookahead<=j&&ke===c)return be;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=K&&U.strstart>0&&(fe=U.strstart-1,se=ht[fe],se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe])){je=U.strstart+j;do;while(se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe]&&se===ht[++fe]&&fe<je);U.match_length=j-(je-fe),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=K?(de=r._tr_tally(U,1,U.match_length-K),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(de=r._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),de&&(De(U,!1),U.strm.avail_out===0))return be}return U.insert=0,ke===p?(De(U,!0),U.strm.avail_out===0?ce:ue):U.last_lit&&(De(U,!1),U.strm.avail_out===0)?be:ye}function oe(U,ke){for(var de;;){if(U.lookahead===0&&(qe(U),U.lookahead===0)){if(ke===c)return be;break}if(U.match_length=0,de=r._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,de&&(De(U,!1),U.strm.avail_out===0))return be}return U.insert=0,ke===p?(De(U,!0),U.strm.avail_out===0?ce:ue):U.last_lit&&(De(U,!1),U.strm.avail_out===0)?be:ye}function te(U,ke,de,se,fe){this.good_length=U,this.max_lazy=ke,this.nice_length=de,this.max_chain=se,this.func=fe}var Me;Me=[new te(0,0,0,0,et),new te(4,4,8,4,F),new te(4,5,16,8,F),new te(4,6,32,32,F),new te(4,4,16,16,H),new te(8,16,32,32,H),new te(8,16,128,128,H),new te(8,32,128,256,H),new te(32,128,258,1024,H),new te(32,258,258,4096,H)];function Te(U){U.window_size=2*U.w_size,ae(U.head),U.max_lazy_match=Me[U.level].max_lazy,U.good_match=Me[U.level].good_length,U.nice_match=Me[U.level].nice_length,U.max_chain_length=Me[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=K-1,U.match_available=0,U.ins_h=0}function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16($*2),this.dyn_dtree=new n.Buf16((2*G+1)*2),this.bl_tree=new n.Buf16((2*k+1)*2),ae(this.dyn_ltree),ae(this.dyn_dtree),ae(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(Z+1),this.heap=new n.Buf16(2*z+1),ae(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*z+1),ae(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ee(U){var ke;return!U||!U.state?Ve(U,h):(U.total_in=U.total_out=0,U.data_type=R,ke=U.state,ke.pending=0,ke.pending_out=0,ke.wrap<0&&(ke.wrap=-ke.wrap),ke.status=ke.wrap?he:Se,U.adler=ke.wrap===2?0:1,ke.last_flush=c,r._tr_init(ke),y)}function Pe(U){var ke=Ee(U);return ke===y&&Te(U.state),ke}function tt(U,ke){return!U||!U.state||U.state.wrap!==2?h:(U.state.gzhead=ke,y)}function Oe(U,ke,de,se,fe,je){if(!U)return h;var ht=1;if(ke===x&&(ke=6),se<0?(ht=0,se=-se):se>15&&(ht=2,se-=16),fe<1||fe>I||de!==P||se<8||se>15||ke<0||ke>9||je<0||je>M)return Ve(U,h);se===8&&(se=9);var pt=new q;return U.state=pt,pt.strm=U,pt.wrap=ht,pt.gzhead=null,pt.w_bits=se,pt.w_size=1<<pt.w_bits,pt.w_mask=pt.w_size-1,pt.hash_bits=fe+7,pt.hash_size=1<<pt.hash_bits,pt.hash_mask=pt.hash_size-1,pt.hash_shift=~~((pt.hash_bits+K-1)/K),pt.window=new n.Buf8(pt.w_size*2),pt.head=new n.Buf16(pt.hash_size),pt.prev=new n.Buf16(pt.w_size),pt.lit_bufsize=1<<fe+6,pt.pending_buf_size=pt.lit_bufsize*4,pt.pending_buf=new n.Buf8(pt.pending_buf_size),pt.d_buf=1*pt.lit_bufsize,pt.l_buf=3*pt.lit_bufsize,pt.level=ke,pt.strategy=je,pt.method=de,Pe(U)}function Je(U,ke){return Oe(U,ke,P,B,W,T)}function ee(U,ke){var de,se,fe,je;if(!U||!U.state||ke>g||ke<0)return U?Ve(U,h):h;if(se=U.state,!U.output||!U.input&&U.avail_in!==0||se.status===Le&&ke!==p)return Ve(U,U.avail_out===0?C:h);if(se.strm=U,de=se.last_flush,se.last_flush=ke,se.status===he)if(se.wrap===2)U.adler=0,Be(se,31),Be(se,139),Be(se,8),se.gzhead?(Be(se,(se.gzhead.text?1:0)+(se.gzhead.hcrc?2:0)+(se.gzhead.extra?4:0)+(se.gzhead.name?8:0)+(se.gzhead.comment?16:0)),Be(se,se.gzhead.time&255),Be(se,se.gzhead.time>>8&255),Be(se,se.gzhead.time>>16&255),Be(se,se.gzhead.time>>24&255),Be(se,se.level===9?2:se.strategy>=_||se.level<2?4:0),Be(se,se.gzhead.os&255),se.gzhead.extra&&se.gzhead.extra.length&&(Be(se,se.gzhead.extra.length&255),Be(se,se.gzhead.extra.length>>8&255)),se.gzhead.hcrc&&(U.adler=s(U.adler,se.pending_buf,se.pending,0)),se.gzindex=0,se.status=ve):(Be(se,0),Be(se,0),Be(se,0),Be(se,0),Be(se,0),Be(se,se.level===9?2:se.strategy>=_||se.level<2?4:0),Be(se,Ce),se.status=Se);else{var ht=P+(se.w_bits-8<<4)<<8,pt=-1;se.strategy>=_||se.level<2?pt=0:se.level<6?pt=1:se.level===6?pt=2:pt=3,ht|=pt<<6,se.strstart!==0&&(ht|=le),ht+=31-ht%31,se.status=Se,ze(se,ht),se.strstart!==0&&(ze(se,U.adler>>>16),ze(se,U.adler&65535)),U.adler=1}if(se.status===ve)if(se.gzhead.extra){for(fe=se.pending;se.gzindex<(se.gzhead.extra.length&65535)&&!(se.pending===se.pending_buf_size&&(se.gzhead.hcrc&&se.pending>fe&&(U.adler=s(U.adler,se.pending_buf,se.pending-fe,fe)),Ae(U),fe=se.pending,se.pending===se.pending_buf_size));)Be(se,se.gzhead.extra[se.gzindex]&255),se.gzindex++;se.gzhead.hcrc&&se.pending>fe&&(U.adler=s(U.adler,se.pending_buf,se.pending-fe,fe)),se.gzindex===se.gzhead.extra.length&&(se.gzindex=0,se.status=re)}else se.status=re;if(se.status===re)if(se.gzhead.name){fe=se.pending;do{if(se.pending===se.pending_buf_size&&(se.gzhead.hcrc&&se.pending>fe&&(U.adler=s(U.adler,se.pending_buf,se.pending-fe,fe)),Ae(U),fe=se.pending,se.pending===se.pending_buf_size)){je=1;break}se.gzindex<se.gzhead.name.length?je=se.gzhead.name.charCodeAt(se.gzindex++)&255:je=0,Be(se,je)}while(je!==0);se.gzhead.hcrc&&se.pending>fe&&(U.adler=s(U.adler,se.pending_buf,se.pending-fe,fe)),je===0&&(se.gzindex=0,se.status=Ie)}else se.status=Ie;if(se.status===Ie)if(se.gzhead.comment){fe=se.pending;do{if(se.pending===se.pending_buf_size&&(se.gzhead.hcrc&&se.pending>fe&&(U.adler=s(U.adler,se.pending_buf,se.pending-fe,fe)),Ae(U),fe=se.pending,se.pending===se.pending_buf_size)){je=1;break}se.gzindex<se.gzhead.comment.length?je=se.gzhead.comment.charCodeAt(se.gzindex++)&255:je=0,Be(se,je)}while(je!==0);se.gzhead.hcrc&&se.pending>fe&&(U.adler=s(U.adler,se.pending_buf,se.pending-fe,fe)),je===0&&(se.status=ge)}else se.status=ge;if(se.status===ge&&(se.gzhead.hcrc?(se.pending+2>se.pending_buf_size&&Ae(U),se.pending+2<=se.pending_buf_size&&(Be(se,U.adler&255),Be(se,U.adler>>8&255),U.adler=0,se.status=Se)):se.status=Se),se.pending!==0){if(Ae(U),U.avail_out===0)return se.last_flush=-1,y}else if(U.avail_in===0&&ie(ke)<=ie(de)&&ke!==p)return Ve(U,C);if(se.status===Le&&U.avail_in!==0)return Ve(U,C);if(U.avail_in!==0||se.lookahead!==0||ke!==c&&se.status!==Le){var dt=se.strategy===_?oe(se,ke):se.strategy===S?X(se,ke):Me[se.level].func(se,ke);if((dt===ce||dt===ue)&&(se.status=Le),dt===be||dt===ce)return U.avail_out===0&&(se.last_flush=-1),y;if(dt===ye&&(ke===u?r._tr_align(se):ke!==g&&(r._tr_stored_block(se,0,0,!1),ke===f&&(ae(se.head),se.lookahead===0&&(se.strstart=0,se.block_start=0,se.insert=0))),Ae(U),U.avail_out===0))return se.last_flush=-1,y}return ke!==p?y:se.wrap<=0?E:(se.wrap===2?(Be(se,U.adler&255),Be(se,U.adler>>8&255),Be(se,U.adler>>16&255),Be(se,U.adler>>24&255),Be(se,U.total_in&255),Be(se,U.total_in>>8&255),Be(se,U.total_in>>16&255),Be(se,U.total_in>>24&255)):(ze(se,U.adler>>>16),ze(se,U.adler&65535)),Ae(U),se.wrap>0&&(se.wrap=-se.wrap),se.pending!==0?y:E)}function Fe(U){var ke;return!U||!U.state?h:(ke=U.state.status,ke!==he&&ke!==ve&&ke!==re&&ke!==Ie&&ke!==ge&&ke!==Se&&ke!==Le?Ve(U,h):(U.state=null,ke===Se?Ve(U,v):y))}function it(U,ke){var de=ke.length,se,fe,je,ht,pt,dt,At,_e;if(!U||!U.state||(se=U.state,ht=se.wrap,ht===2||ht===1&&se.status!==he||se.lookahead))return h;for(ht===1&&(U.adler=a(U.adler,ke,de,0)),se.wrap=0,de>=se.w_size&&(ht===0&&(ae(se.head),se.strstart=0,se.block_start=0,se.insert=0),_e=new n.Buf8(se.w_size),n.arraySet(_e,ke,de-se.w_size,se.w_size,0),ke=_e,de=se.w_size),pt=U.avail_in,dt=U.next_in,At=U.input,U.avail_in=de,U.next_in=0,U.input=ke,qe(se);se.lookahead>=K;){fe=se.strstart,je=se.lookahead-(K-1);do se.ins_h=(se.ins_h<<se.hash_shift^se.window[fe+K-1])&se.hash_mask,se.prev[fe&se.w_mask]=se.head[se.ins_h],se.head[se.ins_h]=fe,fe++;while(--je);se.strstart=fe,se.lookahead=K-1,qe(se)}return se.strstart+=se.lookahead,se.block_start=se.strstart,se.insert=se.lookahead,se.lookahead=0,se.match_length=se.prev_length=K-1,se.match_available=0,U.next_in=dt,U.input=At,U.avail_in=pt,se.wrap=ht,y}t.deflateInit=Je,t.deflateInit2=Oe,t.deflateReset=Pe,t.deflateResetKeep=Ee,t.deflateSetHeader=tt,t.deflate=ee,t.deflateEnd=Fe,t.deflateSetDictionary=it,t.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":o=>{function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}o.exports=t},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":o=>{var t=30,e=12;o.exports=function(r,a){var s,l,c,u,f,p,g,y,E,h,v,C,x,w,_,S,M,T,R,P,I,B,W,D,O;s=r.state,l=r.next_in,D=r.input,c=l+(r.avail_in-5),u=r.next_out,O=r.output,f=u-(a-r.avail_out),p=u+(r.avail_out-257),g=s.dmax,y=s.wsize,E=s.whave,h=s.wnext,v=s.window,C=s.hold,x=s.bits,w=s.lencode,_=s.distcode,S=(1<<s.lenbits)-1,M=(1<<s.distbits)-1;e:do{x<15&&(C+=D[l++]<<x,x+=8,C+=D[l++]<<x,x+=8),T=w[C&S];t:for(;;){if(R=T>>>24,C>>>=R,x-=R,R=T>>>16&255,R===0)O[u++]=T&65535;else if(R&16){P=T&65535,R&=15,R&&(x<R&&(C+=D[l++]<<x,x+=8),P+=C&(1<<R)-1,C>>>=R,x-=R),x<15&&(C+=D[l++]<<x,x+=8,C+=D[l++]<<x,x+=8),T=_[C&M];r:for(;;){if(R=T>>>24,C>>>=R,x-=R,R=T>>>16&255,R&16){if(I=T&65535,R&=15,x<R&&(C+=D[l++]<<x,x+=8,x<R&&(C+=D[l++]<<x,x+=8)),I+=C&(1<<R)-1,I>g){r.msg="invalid distance too far back",s.mode=t;break e}if(C>>>=R,x-=R,R=u-f,I>R){if(R=I-R,R>E&&s.sane){r.msg="invalid distance too far back",s.mode=t;break e}if(B=0,W=v,h===0){if(B+=y-R,R<P){P-=R;do O[u++]=v[B++];while(--R);B=u-I,W=O}}else if(h<R){if(B+=y+h-R,R-=h,R<P){P-=R;do O[u++]=v[B++];while(--R);if(B=0,h<P){R=h,P-=R;do O[u++]=v[B++];while(--R);B=u-I,W=O}}}else if(B+=h-R,R<P){P-=R;do O[u++]=v[B++];while(--R);B=u-I,W=O}for(;P>2;)O[u++]=W[B++],O[u++]=W[B++],O[u++]=W[B++],P-=3;P&&(O[u++]=W[B++],P>1&&(O[u++]=W[B++]))}else{B=u-I;do O[u++]=O[B++],O[u++]=O[B++],O[u++]=O[B++],P-=3;while(P>2);P&&(O[u++]=O[B++],P>1&&(O[u++]=O[B++]))}}else if(R&64){r.msg="invalid distance code",s.mode=t;break e}else{T=_[(T&65535)+(C&(1<<R)-1)];continue r}break}}else if(R&64)if(R&32){s.mode=e;break e}else{r.msg="invalid literal/length code",s.mode=t;break e}else{T=w[(T&65535)+(C&(1<<R)-1)];continue t}break}}while(l<c&&u<p);P=x>>3,l-=P,x-=P<<3,C&=(1<<x)-1,r.next_in=l,r.next_out=u,r.avail_in=l<c?5+(c-l):5-(l-c),r.avail_out=u<p?257+(p-u):257-(u-p),s.hold=C,s.bits=x}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),r=e("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),a=e("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),s=e("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),l=e("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),c=0,u=1,f=2,p=4,g=5,y=6,E=0,h=1,v=2,C=-2,x=-3,w=-4,_=-5,S=8,M=1,T=2,R=3,P=4,I=5,B=6,W=7,D=8,O=9,z=10,G=11,k=12,$=13,Z=14,K=15,j=16,Q=17,le=18,he=19,ve=20,re=21,Ie=22,ge=23,Se=24,Le=25,be=26,ye=27,ce=28,ue=29,Ce=30,Ve=31,ie=32,ae=852,Ae=592,De=15,Be=De;function ze(Oe){return(Oe>>>24&255)+(Oe>>>8&65280)+((Oe&65280)<<8)+((Oe&255)<<24)}function We(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function $e(Oe){var Je;return!Oe||!Oe.state?C:(Je=Oe.state,Oe.total_in=Oe.total_out=Je.total=0,Oe.msg="",Je.wrap&&(Oe.adler=Je.wrap&1),Je.mode=M,Je.last=0,Je.havedict=0,Je.dmax=32768,Je.head=null,Je.hold=0,Je.bits=0,Je.lencode=Je.lendyn=new n.Buf32(ae),Je.distcode=Je.distdyn=new n.Buf32(Ae),Je.sane=1,Je.back=-1,E)}function qe(Oe){var Je;return!Oe||!Oe.state?C:(Je=Oe.state,Je.wsize=0,Je.whave=0,Je.wnext=0,$e(Oe))}function et(Oe,Je){var ee,Fe;return!Oe||!Oe.state||(Fe=Oe.state,Je<0?(ee=0,Je=-Je):(ee=(Je>>4)+1,Je<48&&(Je&=15)),Je&&(Je<8||Je>15))?C:(Fe.window!==null&&Fe.wbits!==Je&&(Fe.window=null),Fe.wrap=ee,Fe.wbits=Je,qe(Oe))}function F(Oe,Je){var ee,Fe;return Oe?(Fe=new We,Oe.state=Fe,Fe.window=null,ee=et(Oe,Je),ee!==E&&(Oe.state=null),ee):C}function H(Oe){return F(Oe,Be)}var X=!0,oe,te;function Me(Oe){if(X){var Je;for(oe=new n.Buf32(512),te=new n.Buf32(32),Je=0;Je<144;)Oe.lens[Je++]=8;for(;Je<256;)Oe.lens[Je++]=9;for(;Je<280;)Oe.lens[Je++]=7;for(;Je<288;)Oe.lens[Je++]=8;for(l(u,Oe.lens,0,288,oe,0,Oe.work,{bits:9}),Je=0;Je<32;)Oe.lens[Je++]=5;l(f,Oe.lens,0,32,te,0,Oe.work,{bits:5}),X=!1}Oe.lencode=oe,Oe.lenbits=9,Oe.distcode=te,Oe.distbits=5}function Te(Oe,Je,ee,Fe){var it,U=Oe.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new n.Buf8(U.wsize)),Fe>=U.wsize?(n.arraySet(U.window,Je,ee-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(it=U.wsize-U.wnext,it>Fe&&(it=Fe),n.arraySet(U.window,Je,ee-Fe,it,U.wnext),Fe-=it,Fe?(n.arraySet(U.window,Je,ee-Fe,Fe,0),U.wnext=Fe,U.whave=U.wsize):(U.wnext+=it,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=it))),0}function q(Oe,Je){var ee,Fe,it,U,ke,de,se,fe,je,ht,pt,dt,At,_e,Xe=0,Ue,Ye,ot,gt,Et,yt,mt,St,vt=new n.Buf8(4),Rt,xt,dr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Oe||!Oe.state||!Oe.output||!Oe.input&&Oe.avail_in!==0)return C;ee=Oe.state,ee.mode===k&&(ee.mode=$),ke=Oe.next_out,it=Oe.output,se=Oe.avail_out,U=Oe.next_in,Fe=Oe.input,de=Oe.avail_in,fe=ee.hold,je=ee.bits,ht=de,pt=se,St=E;e:for(;;)switch(ee.mode){case M:if(ee.wrap===0){ee.mode=$;break}for(;je<16;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(ee.wrap&2&&fe===35615){ee.check=0,vt[0]=fe&255,vt[1]=fe>>>8&255,ee.check=a(ee.check,vt,2,0),fe=0,je=0,ee.mode=T;break}if(ee.flags=0,ee.head&&(ee.head.done=!1),!(ee.wrap&1)||(((fe&255)<<8)+(fe>>8))%31){Oe.msg="incorrect header check",ee.mode=Ce;break}if((fe&15)!==S){Oe.msg="unknown compression method",ee.mode=Ce;break}if(fe>>>=4,je-=4,mt=(fe&15)+8,ee.wbits===0)ee.wbits=mt;else if(mt>ee.wbits){Oe.msg="invalid window size",ee.mode=Ce;break}ee.dmax=1<<mt,Oe.adler=ee.check=1,ee.mode=fe&512?z:k,fe=0,je=0;break;case T:for(;je<16;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(ee.flags=fe,(ee.flags&255)!==S){Oe.msg="unknown compression method",ee.mode=Ce;break}if(ee.flags&57344){Oe.msg="unknown header flags set",ee.mode=Ce;break}ee.head&&(ee.head.text=fe>>8&1),ee.flags&512&&(vt[0]=fe&255,vt[1]=fe>>>8&255,ee.check=a(ee.check,vt,2,0)),fe=0,je=0,ee.mode=R;case R:for(;je<32;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}ee.head&&(ee.head.time=fe),ee.flags&512&&(vt[0]=fe&255,vt[1]=fe>>>8&255,vt[2]=fe>>>16&255,vt[3]=fe>>>24&255,ee.check=a(ee.check,vt,4,0)),fe=0,je=0,ee.mode=P;case P:for(;je<16;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}ee.head&&(ee.head.xflags=fe&255,ee.head.os=fe>>8),ee.flags&512&&(vt[0]=fe&255,vt[1]=fe>>>8&255,ee.check=a(ee.check,vt,2,0)),fe=0,je=0,ee.mode=I;case I:if(ee.flags&1024){for(;je<16;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}ee.length=fe,ee.head&&(ee.head.extra_len=fe),ee.flags&512&&(vt[0]=fe&255,vt[1]=fe>>>8&255,ee.check=a(ee.check,vt,2,0)),fe=0,je=0}else ee.head&&(ee.head.extra=null);ee.mode=B;case B:if(ee.flags&1024&&(dt=ee.length,dt>de&&(dt=de),dt&&(ee.head&&(mt=ee.head.extra_len-ee.length,ee.head.extra||(ee.head.extra=new Array(ee.head.extra_len)),n.arraySet(ee.head.extra,Fe,U,dt,mt)),ee.flags&512&&(ee.check=a(ee.check,Fe,dt,U)),de-=dt,U+=dt,ee.length-=dt),ee.length))break e;ee.length=0,ee.mode=W;case W:if(ee.flags&2048){if(de===0)break e;dt=0;do mt=Fe[U+dt++],ee.head&&mt&&ee.length<65536&&(ee.head.name+=String.fromCharCode(mt));while(mt&&dt<de);if(ee.flags&512&&(ee.check=a(ee.check,Fe,dt,U)),de-=dt,U+=dt,mt)break e}else ee.head&&(ee.head.name=null);ee.length=0,ee.mode=D;case D:if(ee.flags&4096){if(de===0)break e;dt=0;do mt=Fe[U+dt++],ee.head&&mt&&ee.length<65536&&(ee.head.comment+=String.fromCharCode(mt));while(mt&&dt<de);if(ee.flags&512&&(ee.check=a(ee.check,Fe,dt,U)),de-=dt,U+=dt,mt)break e}else ee.head&&(ee.head.comment=null);ee.mode=O;case O:if(ee.flags&512){for(;je<16;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(fe!==(ee.check&65535)){Oe.msg="header crc mismatch",ee.mode=Ce;break}fe=0,je=0}ee.head&&(ee.head.hcrc=ee.flags>>9&1,ee.head.done=!0),Oe.adler=ee.check=0,ee.mode=k;break;case z:for(;je<32;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}Oe.adler=ee.check=ze(fe),fe=0,je=0,ee.mode=G;case G:if(ee.havedict===0)return Oe.next_out=ke,Oe.avail_out=se,Oe.next_in=U,Oe.avail_in=de,ee.hold=fe,ee.bits=je,v;Oe.adler=ee.check=1,ee.mode=k;case k:if(Je===g||Je===y)break e;case $:if(ee.last){fe>>>=je&7,je-=je&7,ee.mode=ye;break}for(;je<3;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}switch(ee.last=fe&1,fe>>>=1,je-=1,fe&3){case 0:ee.mode=Z;break;case 1:if(Me(ee),ee.mode=ve,Je===y){fe>>>=2,je-=2;break e}break;case 2:ee.mode=Q;break;case 3:Oe.msg="invalid block type",ee.mode=Ce}fe>>>=2,je-=2;break;case Z:for(fe>>>=je&7,je-=je&7;je<32;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if((fe&65535)!==(fe>>>16^65535)){Oe.msg="invalid stored block lengths",ee.mode=Ce;break}if(ee.length=fe&65535,fe=0,je=0,ee.mode=K,Je===y)break e;case K:ee.mode=j;case j:if(dt=ee.length,dt){if(dt>de&&(dt=de),dt>se&&(dt=se),dt===0)break e;n.arraySet(it,Fe,U,dt,ke),de-=dt,U+=dt,se-=dt,ke+=dt,ee.length-=dt;break}ee.mode=k;break;case Q:for(;je<14;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(ee.nlen=(fe&31)+257,fe>>>=5,je-=5,ee.ndist=(fe&31)+1,fe>>>=5,je-=5,ee.ncode=(fe&15)+4,fe>>>=4,je-=4,ee.nlen>286||ee.ndist>30){Oe.msg="too many length or distance symbols",ee.mode=Ce;break}ee.have=0,ee.mode=le;case le:for(;ee.have<ee.ncode;){for(;je<3;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}ee.lens[dr[ee.have++]]=fe&7,fe>>>=3,je-=3}for(;ee.have<19;)ee.lens[dr[ee.have++]]=0;if(ee.lencode=ee.lendyn,ee.lenbits=7,Rt={bits:ee.lenbits},St=l(c,ee.lens,0,19,ee.lencode,0,ee.work,Rt),ee.lenbits=Rt.bits,St){Oe.msg="invalid code lengths set",ee.mode=Ce;break}ee.have=0,ee.mode=he;case he:for(;ee.have<ee.nlen+ee.ndist;){for(;Xe=ee.lencode[fe&(1<<ee.lenbits)-1],Ue=Xe>>>24,Ye=Xe>>>16&255,ot=Xe&65535,!(Ue<=je);){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(ot<16)fe>>>=Ue,je-=Ue,ee.lens[ee.have++]=ot;else{if(ot===16){for(xt=Ue+2;je<xt;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(fe>>>=Ue,je-=Ue,ee.have===0){Oe.msg="invalid bit length repeat",ee.mode=Ce;break}mt=ee.lens[ee.have-1],dt=3+(fe&3),fe>>>=2,je-=2}else if(ot===17){for(xt=Ue+3;je<xt;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}fe>>>=Ue,je-=Ue,mt=0,dt=3+(fe&7),fe>>>=3,je-=3}else{for(xt=Ue+7;je<xt;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}fe>>>=Ue,je-=Ue,mt=0,dt=11+(fe&127),fe>>>=7,je-=7}if(ee.have+dt>ee.nlen+ee.ndist){Oe.msg="invalid bit length repeat",ee.mode=Ce;break}for(;dt--;)ee.lens[ee.have++]=mt}}if(ee.mode===Ce)break;if(ee.lens[256]===0){Oe.msg="invalid code -- missing end-of-block",ee.mode=Ce;break}if(ee.lenbits=9,Rt={bits:ee.lenbits},St=l(u,ee.lens,0,ee.nlen,ee.lencode,0,ee.work,Rt),ee.lenbits=Rt.bits,St){Oe.msg="invalid literal/lengths set",ee.mode=Ce;break}if(ee.distbits=6,ee.distcode=ee.distdyn,Rt={bits:ee.distbits},St=l(f,ee.lens,ee.nlen,ee.ndist,ee.distcode,0,ee.work,Rt),ee.distbits=Rt.bits,St){Oe.msg="invalid distances set",ee.mode=Ce;break}if(ee.mode=ve,Je===y)break e;case ve:ee.mode=re;case re:if(de>=6&&se>=258){Oe.next_out=ke,Oe.avail_out=se,Oe.next_in=U,Oe.avail_in=de,ee.hold=fe,ee.bits=je,s(Oe,pt),ke=Oe.next_out,it=Oe.output,se=Oe.avail_out,U=Oe.next_in,Fe=Oe.input,de=Oe.avail_in,fe=ee.hold,je=ee.bits,ee.mode===k&&(ee.back=-1);break}for(ee.back=0;Xe=ee.lencode[fe&(1<<ee.lenbits)-1],Ue=Xe>>>24,Ye=Xe>>>16&255,ot=Xe&65535,!(Ue<=je);){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(Ye&&!(Ye&240)){for(gt=Ue,Et=Ye,yt=ot;Xe=ee.lencode[yt+((fe&(1<<gt+Et)-1)>>gt)],Ue=Xe>>>24,Ye=Xe>>>16&255,ot=Xe&65535,!(gt+Ue<=je);){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}fe>>>=gt,je-=gt,ee.back+=gt}if(fe>>>=Ue,je-=Ue,ee.back+=Ue,ee.length=ot,Ye===0){ee.mode=be;break}if(Ye&32){ee.back=-1,ee.mode=k;break}if(Ye&64){Oe.msg="invalid literal/length code",ee.mode=Ce;break}ee.extra=Ye&15,ee.mode=Ie;case Ie:if(ee.extra){for(xt=ee.extra;je<xt;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}ee.length+=fe&(1<<ee.extra)-1,fe>>>=ee.extra,je-=ee.extra,ee.back+=ee.extra}ee.was=ee.length,ee.mode=ge;case ge:for(;Xe=ee.distcode[fe&(1<<ee.distbits)-1],Ue=Xe>>>24,Ye=Xe>>>16&255,ot=Xe&65535,!(Ue<=je);){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(!(Ye&240)){for(gt=Ue,Et=Ye,yt=ot;Xe=ee.distcode[yt+((fe&(1<<gt+Et)-1)>>gt)],Ue=Xe>>>24,Ye=Xe>>>16&255,ot=Xe&65535,!(gt+Ue<=je);){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}fe>>>=gt,je-=gt,ee.back+=gt}if(fe>>>=Ue,je-=Ue,ee.back+=Ue,Ye&64){Oe.msg="invalid distance code",ee.mode=Ce;break}ee.offset=ot,ee.extra=Ye&15,ee.mode=Se;case Se:if(ee.extra){for(xt=ee.extra;je<xt;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}ee.offset+=fe&(1<<ee.extra)-1,fe>>>=ee.extra,je-=ee.extra,ee.back+=ee.extra}if(ee.offset>ee.dmax){Oe.msg="invalid distance too far back",ee.mode=Ce;break}ee.mode=Le;case Le:if(se===0)break e;if(dt=pt-se,ee.offset>dt){if(dt=ee.offset-dt,dt>ee.whave&&ee.sane){Oe.msg="invalid distance too far back",ee.mode=Ce;break}dt>ee.wnext?(dt-=ee.wnext,At=ee.wsize-dt):At=ee.wnext-dt,dt>ee.length&&(dt=ee.length),_e=ee.window}else _e=it,At=ke-ee.offset,dt=ee.length;dt>se&&(dt=se),se-=dt,ee.length-=dt;do it[ke++]=_e[At++];while(--dt);ee.length===0&&(ee.mode=re);break;case be:if(se===0)break e;it[ke++]=ee.length,se--,ee.mode=re;break;case ye:if(ee.wrap){for(;je<32;){if(de===0)break e;de--,fe|=Fe[U++]<<je,je+=8}if(pt-=se,Oe.total_out+=pt,ee.total+=pt,pt&&(Oe.adler=ee.check=ee.flags?a(ee.check,it,pt,ke-pt):r(ee.check,it,pt,ke-pt)),pt=se,(ee.flags?fe:ze(fe))!==ee.check){Oe.msg="incorrect data check",ee.mode=Ce;break}fe=0,je=0}ee.mode=ce;case ce:if(ee.wrap&&ee.flags){for(;je<32;){if(de===0)break e;de--,fe+=Fe[U++]<<je,je+=8}if(fe!==(ee.total&4294967295)){Oe.msg="incorrect length check",ee.mode=Ce;break}fe=0,je=0}ee.mode=ue;case ue:St=h;break e;case Ce:St=x;break e;case Ve:return w;case ie:default:return C}return Oe.next_out=ke,Oe.avail_out=se,Oe.next_in=U,Oe.avail_in=de,ee.hold=fe,ee.bits=je,(ee.wsize||pt!==Oe.avail_out&&ee.mode<Ce&&(ee.mode<ye||Je!==p))&&Te(Oe,Oe.output,Oe.next_out,pt-Oe.avail_out),ht-=Oe.avail_in,pt-=Oe.avail_out,Oe.total_in+=ht,Oe.total_out+=pt,ee.total+=pt,ee.wrap&&pt&&(Oe.adler=ee.check=ee.flags?a(ee.check,it,pt,Oe.next_out-pt):r(ee.check,it,pt,Oe.next_out-pt)),Oe.data_type=ee.bits+(ee.last?64:0)+(ee.mode===k?128:0)+(ee.mode===ve||ee.mode===K?256:0),(ht===0&&pt===0||Je===p)&&St===E&&(St=_),St}function Ee(Oe){if(!Oe||!Oe.state)return C;var Je=Oe.state;return Je.window&&(Je.window=null),Oe.state=null,E}function Pe(Oe,Je){var ee;return!Oe||!Oe.state||(ee=Oe.state,!(ee.wrap&2))?C:(ee.head=Je,Je.done=!1,E)}function tt(Oe,Je){var ee=Je.length,Fe,it,U;return!Oe||!Oe.state||(Fe=Oe.state,Fe.wrap!==0&&Fe.mode!==G)?C:Fe.mode===G&&(it=1,it=r(it,Je,ee,0),it!==Fe.check)?x:(U=Te(Oe,Je,ee,ee),U?(Fe.mode=Ve,w):(Fe.havedict=1,E))}t.inflateReset=qe,t.inflateReset2=et,t.inflateResetKeep=$e,t.inflateInit=H,t.inflateInit2=F,t.inflate=q,t.inflateEnd=Ee,t.inflateGetHeader=Pe,t.inflateSetDictionary=tt,t.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),r=15,a=852,s=592,l=0,c=1,u=2,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(h,v,C,x,w,_,S,M){var T=M.bits,R=0,P=0,I=0,B=0,W=0,D=0,O=0,z=0,G=0,k=0,$,Z,K,j,Q,le=null,he=0,ve,re=new n.Buf16(r+1),Ie=new n.Buf16(r+1),ge=null,Se=0,Le,be,ye;for(R=0;R<=r;R++)re[R]=0;for(P=0;P<x;P++)re[v[C+P]]++;for(W=T,B=r;B>=1&&re[B]===0;B--);if(W>B&&(W=B),B===0)return w[_++]=20971520,w[_++]=20971520,M.bits=1,0;for(I=1;I<B&&re[I]===0;I++);for(W<I&&(W=I),z=1,R=1;R<=r;R++)if(z<<=1,z-=re[R],z<0)return-1;if(z>0&&(h===l||B!==1))return-1;for(Ie[1]=0,R=1;R<r;R++)Ie[R+1]=Ie[R]+re[R];for(P=0;P<x;P++)v[C+P]!==0&&(S[Ie[v[C+P]]++]=P);if(h===l?(le=ge=S,ve=19):h===c?(le=f,he-=257,ge=p,Se-=257,ve=256):(le=g,ge=y,ve=-1),k=0,P=0,R=I,Q=_,D=W,O=0,K=-1,G=1<<W,j=G-1,h===c&&G>a||h===u&&G>s)return 1;for(;;){Le=R-O,S[P]<ve?(be=0,ye=S[P]):S[P]>ve?(be=ge[Se+S[P]],ye=le[he+S[P]]):(be=96,ye=0),$=1<<R-O,Z=1<<D,I=Z;do Z-=$,w[Q+(k>>O)+Z]=Le<<24|be<<16|ye|0;while(Z!==0);for($=1<<R-1;k&$;)$>>=1;if($!==0?(k&=$-1,k+=$):k=0,P++,--re[R]===0){if(R===B)break;R=v[C+S[P]]}if(R>W&&(k&j)!==K){for(O===0&&(O=W),Q+=I,D=R-O,z=1<<D;D+O<B&&(z-=re[D+O],!(z<=0));)D++,z<<=1;if(G+=1<<D,h===c&&G>a||h===u&&G>s)return 1;K=k&j,w[K]=W<<24|D<<16|Q-_|0}}return k!==0&&(w[Q+k]=R-O<<24|4194304|0),M.bits=W,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":o=>{o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":(o,t,e)=>{var n=e("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),r=4,a=0,s=1,l=2;function c(q){for(var Ee=q.length;--Ee>=0;)q[Ee]=0}var u=0,f=1,p=2,g=3,y=258,E=29,h=256,v=h+1+E,C=30,x=19,w=2*v+1,_=15,S=16,M=7,T=256,R=16,P=17,I=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=512,G=new Array((v+2)*2);c(G);var k=new Array(C*2);c(k);var $=new Array(z);c($);var Z=new Array(y-g+1);c(Z);var K=new Array(E);c(K);var j=new Array(C);c(j);function Q(q,Ee,Pe,tt,Oe){this.static_tree=q,this.extra_bits=Ee,this.extra_base=Pe,this.elems=tt,this.max_length=Oe,this.has_stree=q&&q.length}var le,he,ve;function re(q,Ee){this.dyn_tree=q,this.max_code=0,this.stat_desc=Ee}function Ie(q){return q<256?$[q]:$[256+(q>>>7)]}function ge(q,Ee){q.pending_buf[q.pending++]=Ee&255,q.pending_buf[q.pending++]=Ee>>>8&255}function Se(q,Ee,Pe){q.bi_valid>S-Pe?(q.bi_buf|=Ee<<q.bi_valid&65535,ge(q,q.bi_buf),q.bi_buf=Ee>>S-q.bi_valid,q.bi_valid+=Pe-S):(q.bi_buf|=Ee<<q.bi_valid&65535,q.bi_valid+=Pe)}function Le(q,Ee,Pe){Se(q,Pe[Ee*2],Pe[Ee*2+1])}function be(q,Ee){var Pe=0;do Pe|=q&1,q>>>=1,Pe<<=1;while(--Ee>0);return Pe>>>1}function ye(q){q.bi_valid===16?(ge(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):q.bi_valid>=8&&(q.pending_buf[q.pending++]=q.bi_buf&255,q.bi_buf>>=8,q.bi_valid-=8)}function ce(q,Ee){var Pe=Ee.dyn_tree,tt=Ee.max_code,Oe=Ee.stat_desc.static_tree,Je=Ee.stat_desc.has_stree,ee=Ee.stat_desc.extra_bits,Fe=Ee.stat_desc.extra_base,it=Ee.stat_desc.max_length,U,ke,de,se,fe,je,ht=0;for(se=0;se<=_;se++)q.bl_count[se]=0;for(Pe[q.heap[q.heap_max]*2+1]=0,U=q.heap_max+1;U<w;U++)ke=q.heap[U],se=Pe[Pe[ke*2+1]*2+1]+1,se>it&&(se=it,ht++),Pe[ke*2+1]=se,!(ke>tt)&&(q.bl_count[se]++,fe=0,ke>=Fe&&(fe=ee[ke-Fe]),je=Pe[ke*2],q.opt_len+=je*(se+fe),Je&&(q.static_len+=je*(Oe[ke*2+1]+fe)));if(ht!==0){do{for(se=it-1;q.bl_count[se]===0;)se--;q.bl_count[se]--,q.bl_count[se+1]+=2,q.bl_count[it]--,ht-=2}while(ht>0);for(se=it;se!==0;se--)for(ke=q.bl_count[se];ke!==0;)de=q.heap[--U],!(de>tt)&&(Pe[de*2+1]!==se&&(q.opt_len+=(se-Pe[de*2+1])*Pe[de*2],Pe[de*2+1]=se),ke--)}}function ue(q,Ee,Pe){var tt=new Array(_+1),Oe=0,Je,ee;for(Je=1;Je<=_;Je++)tt[Je]=Oe=Oe+Pe[Je-1]<<1;for(ee=0;ee<=Ee;ee++){var Fe=q[ee*2+1];Fe!==0&&(q[ee*2]=be(tt[Fe]++,Fe))}}function Ce(){var q,Ee,Pe,tt,Oe,Je=new Array(_+1);for(Pe=0,tt=0;tt<E-1;tt++)for(K[tt]=Pe,q=0;q<1<<B[tt];q++)Z[Pe++]=tt;for(Z[Pe-1]=tt,Oe=0,tt=0;tt<16;tt++)for(j[tt]=Oe,q=0;q<1<<W[tt];q++)$[Oe++]=tt;for(Oe>>=7;tt<C;tt++)for(j[tt]=Oe<<7,q=0;q<1<<W[tt]-7;q++)$[256+Oe++]=tt;for(Ee=0;Ee<=_;Ee++)Je[Ee]=0;for(q=0;q<=143;)G[q*2+1]=8,q++,Je[8]++;for(;q<=255;)G[q*2+1]=9,q++,Je[9]++;for(;q<=279;)G[q*2+1]=7,q++,Je[7]++;for(;q<=287;)G[q*2+1]=8,q++,Je[8]++;for(ue(G,v+1,Je),q=0;q<C;q++)k[q*2+1]=5,k[q*2]=be(q,5);le=new Q(G,B,h+1,v,_),he=new Q(k,W,0,C,_),ve=new Q(new Array(0),D,0,x,M)}function Ve(q){var Ee;for(Ee=0;Ee<v;Ee++)q.dyn_ltree[Ee*2]=0;for(Ee=0;Ee<C;Ee++)q.dyn_dtree[Ee*2]=0;for(Ee=0;Ee<x;Ee++)q.bl_tree[Ee*2]=0;q.dyn_ltree[T*2]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0}function ie(q){q.bi_valid>8?ge(q,q.bi_buf):q.bi_valid>0&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0}function ae(q,Ee,Pe,tt){ie(q),tt&&(ge(q,Pe),ge(q,~Pe)),n.arraySet(q.pending_buf,q.window,Ee,Pe,q.pending),q.pending+=Pe}function Ae(q,Ee,Pe,tt){var Oe=Ee*2,Je=Pe*2;return q[Oe]<q[Je]||q[Oe]===q[Je]&&tt[Ee]<=tt[Pe]}function De(q,Ee,Pe){for(var tt=q.heap[Pe],Oe=Pe<<1;Oe<=q.heap_len&&(Oe<q.heap_len&&Ae(Ee,q.heap[Oe+1],q.heap[Oe],q.depth)&&Oe++,!Ae(Ee,tt,q.heap[Oe],q.depth));)q.heap[Pe]=q.heap[Oe],Pe=Oe,Oe<<=1;q.heap[Pe]=tt}function Be(q,Ee,Pe){var tt,Oe,Je=0,ee,Fe;if(q.last_lit!==0)do tt=q.pending_buf[q.d_buf+Je*2]<<8|q.pending_buf[q.d_buf+Je*2+1],Oe=q.pending_buf[q.l_buf+Je],Je++,tt===0?Le(q,Oe,Ee):(ee=Z[Oe],Le(q,ee+h+1,Ee),Fe=B[ee],Fe!==0&&(Oe-=K[ee],Se(q,Oe,Fe)),tt--,ee=Ie(tt),Le(q,ee,Pe),Fe=W[ee],Fe!==0&&(tt-=j[ee],Se(q,tt,Fe)));while(Je<q.last_lit);Le(q,T,Ee)}function ze(q,Ee){var Pe=Ee.dyn_tree,tt=Ee.stat_desc.static_tree,Oe=Ee.stat_desc.has_stree,Je=Ee.stat_desc.elems,ee,Fe,it=-1,U;for(q.heap_len=0,q.heap_max=w,ee=0;ee<Je;ee++)Pe[ee*2]!==0?(q.heap[++q.heap_len]=it=ee,q.depth[ee]=0):Pe[ee*2+1]=0;for(;q.heap_len<2;)U=q.heap[++q.heap_len]=it<2?++it:0,Pe[U*2]=1,q.depth[U]=0,q.opt_len--,Oe&&(q.static_len-=tt[U*2+1]);for(Ee.max_code=it,ee=q.heap_len>>1;ee>=1;ee--)De(q,Pe,ee);U=Je;do ee=q.heap[1],q.heap[1]=q.heap[q.heap_len--],De(q,Pe,1),Fe=q.heap[1],q.heap[--q.heap_max]=ee,q.heap[--q.heap_max]=Fe,Pe[U*2]=Pe[ee*2]+Pe[Fe*2],q.depth[U]=(q.depth[ee]>=q.depth[Fe]?q.depth[ee]:q.depth[Fe])+1,Pe[ee*2+1]=Pe[Fe*2+1]=U,q.heap[1]=U++,De(q,Pe,1);while(q.heap_len>=2);q.heap[--q.heap_max]=q.heap[1],ce(q,Ee),ue(Pe,it,q.bl_count)}function We(q,Ee,Pe){var tt,Oe=-1,Je,ee=Ee[0*2+1],Fe=0,it=7,U=4;for(ee===0&&(it=138,U=3),Ee[(Pe+1)*2+1]=65535,tt=0;tt<=Pe;tt++)Je=ee,ee=Ee[(tt+1)*2+1],!(++Fe<it&&Je===ee)&&(Fe<U?q.bl_tree[Je*2]+=Fe:Je!==0?(Je!==Oe&&q.bl_tree[Je*2]++,q.bl_tree[R*2]++):Fe<=10?q.bl_tree[P*2]++:q.bl_tree[I*2]++,Fe=0,Oe=Je,ee===0?(it=138,U=3):Je===ee?(it=6,U=3):(it=7,U=4))}function $e(q,Ee,Pe){var tt,Oe=-1,Je,ee=Ee[0*2+1],Fe=0,it=7,U=4;for(ee===0&&(it=138,U=3),tt=0;tt<=Pe;tt++)if(Je=ee,ee=Ee[(tt+1)*2+1],!(++Fe<it&&Je===ee)){if(Fe<U)do Le(q,Je,q.bl_tree);while(--Fe!==0);else Je!==0?(Je!==Oe&&(Le(q,Je,q.bl_tree),Fe--),Le(q,R,q.bl_tree),Se(q,Fe-3,2)):Fe<=10?(Le(q,P,q.bl_tree),Se(q,Fe-3,3)):(Le(q,I,q.bl_tree),Se(q,Fe-11,7));Fe=0,Oe=Je,ee===0?(it=138,U=3):Je===ee?(it=6,U=3):(it=7,U=4)}}function qe(q){var Ee;for(We(q,q.dyn_ltree,q.l_desc.max_code),We(q,q.dyn_dtree,q.d_desc.max_code),ze(q,q.bl_desc),Ee=x-1;Ee>=3&&q.bl_tree[O[Ee]*2+1]===0;Ee--);return q.opt_len+=3*(Ee+1)+5+5+4,Ee}function et(q,Ee,Pe,tt){var Oe;for(Se(q,Ee-257,5),Se(q,Pe-1,5),Se(q,tt-4,4),Oe=0;Oe<tt;Oe++)Se(q,q.bl_tree[O[Oe]*2+1],3);$e(q,q.dyn_ltree,Ee-1),$e(q,q.dyn_dtree,Pe-1)}function F(q){var Ee=4093624447,Pe;for(Pe=0;Pe<=31;Pe++,Ee>>>=1)if(Ee&1&&q.dyn_ltree[Pe*2]!==0)return a;if(q.dyn_ltree[18]!==0||q.dyn_ltree[20]!==0||q.dyn_ltree[26]!==0)return s;for(Pe=32;Pe<h;Pe++)if(q.dyn_ltree[Pe*2]!==0)return s;return a}var H=!1;function X(q){H||(Ce(),H=!0),q.l_desc=new re(q.dyn_ltree,le),q.d_desc=new re(q.dyn_dtree,he),q.bl_desc=new re(q.bl_tree,ve),q.bi_buf=0,q.bi_valid=0,Ve(q)}function oe(q,Ee,Pe,tt){Se(q,(u<<1)+(tt?1:0),3),ae(q,Ee,Pe,!0)}function te(q){Se(q,f<<1,3),Le(q,T,G),ye(q)}function Me(q,Ee,Pe,tt){var Oe,Je,ee=0;q.level>0?(q.strm.data_type===l&&(q.strm.data_type=F(q)),ze(q,q.l_desc),ze(q,q.d_desc),ee=qe(q),Oe=q.opt_len+3+7>>>3,Je=q.static_len+3+7>>>3,Je<=Oe&&(Oe=Je)):Oe=Je=Pe+5,Pe+4<=Oe&&Ee!==-1?oe(q,Ee,Pe,tt):q.strategy===r||Je===Oe?(Se(q,(f<<1)+(tt?1:0),3),Be(q,G,k)):(Se(q,(p<<1)+(tt?1:0),3),et(q,q.l_desc.max_code+1,q.d_desc.max_code+1,ee+1),Be(q,q.dyn_ltree,q.dyn_dtree)),Ve(q),tt&&ie(q)}function Te(q,Ee,Pe){return q.pending_buf[q.d_buf+q.last_lit*2]=Ee>>>8&255,q.pending_buf[q.d_buf+q.last_lit*2+1]=Ee&255,q.pending_buf[q.l_buf+q.last_lit]=Pe&255,q.last_lit++,Ee===0?q.dyn_ltree[Pe*2]++:(q.matches++,Ee--,q.dyn_ltree[(Z[Pe]+h+1)*2]++,q.dyn_dtree[Ie(Ee)*2]++),q.last_lit===q.lit_bufsize-1}t._tr_init=X,t._tr_stored_block=oe,t._tr_flush_block=Me,t._tr_tally=Te,t._tr_align=te},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":o=>{function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}o.exports=t},"./src/SurfaceWorker.js":()=>{$3Dmol.workerString=(function(){self.onmessage=function(o){var t=o.data,e=t.type;if(e<0)self.atomData=t.atoms,self.volume=t.volume,self.ps=new ProteinSurface;else{var n=self.ps;n.initparm(t.expandedExtent,e!=1,self.volume),n.fillvoxels(self.atomData,t.extendedAtoms),n.buildboundary(),(e===4||e===2)&&(n.fastdistancemap(),n.boundingatom(!1),n.fillvoxelswaals(self.atomData,t.extendedAtoms)),n.marchingcube(e);var r=n.getFacesAndVertices(t.atomsToShow);self.postMessage(r)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/exporter.js":o=>{typeof o.exports=="object"&&(o.exports=window.$3Dmol)},"./src/vendor/mmtf.js":function(o,t){(function(e,n){n(t)})(this,function(e){function n(F,H,X){for(var oe=(F.byteLength,0),te=X.length;te>oe;oe++){var Me=X.charCodeAt(oe);if(128>Me)F.setUint8(H++,Me>>>0&127|0);else if(2048>Me)F.setUint8(H++,Me>>>6&31|192),F.setUint8(H++,Me>>>0&63|128);else if(65536>Me)F.setUint8(H++,Me>>>12&15|224),F.setUint8(H++,Me>>>6&63|128),F.setUint8(H++,Me>>>0&63|128);else{if(!(1114112>Me))throw new Error("bad codepoint "+Me);F.setUint8(H++,Me>>>18&7|240),F.setUint8(H++,Me>>>12&63|128),F.setUint8(H++,Me>>>6&63|128),F.setUint8(H++,Me>>>0&63|128)}}}function r(F){for(var H=0,X=0,oe=F.length;oe>X;X++){var te=F.charCodeAt(X);if(128>te)H+=1;else if(2048>te)H+=2;else if(65536>te)H+=3;else{if(!(1114112>te))throw new Error("bad codepoint "+te);H+=4}}return H}function a(F,H,X){var oe=typeof F;if(oe==="string"){var te=r(F);if(32>te)return H.setUint8(X,160|te),n(H,X+1,F),1+te;if(256>te)return H.setUint8(X,217),H.setUint8(X+1,te),n(H,X+2,F),2+te;if(65536>te)return H.setUint8(X,218),H.setUint16(X+1,te),n(H,X+3,F),3+te;if(4294967296>te)return H.setUint8(X,219),H.setUint32(X+1,te),n(H,X+5,F),5+te}if(F instanceof Uint8Array){var te=F.byteLength,Me=new Uint8Array(H.buffer);if(256>te)return H.setUint8(X,196),H.setUint8(X+1,te),Me.set(F,X+2),2+te;if(65536>te)return H.setUint8(X,197),H.setUint16(X+1,te),Me.set(F,X+3),3+te;if(4294967296>te)return H.setUint8(X,198),H.setUint32(X+1,te),Me.set(F,X+5),5+te}if(oe==="number"){if(!isFinite(F))throw new Error("Number not finite: "+F);if(Math.floor(F)!==F)return H.setUint8(X,203),H.setFloat64(X+1,F),9;if(F>=0){if(128>F)return H.setUint8(X,F),1;if(256>F)return H.setUint8(X,204),H.setUint8(X+1,F),2;if(65536>F)return H.setUint8(X,205),H.setUint16(X+1,F),3;if(4294967296>F)return H.setUint8(X,206),H.setUint32(X+1,F),5;throw new Error("Number too big 0x"+F.toString(16))}if(F>=-32)return H.setInt8(X,F),1;if(F>=-128)return H.setUint8(X,208),H.setInt8(X+1,F),2;if(F>=-32768)return H.setUint8(X,209),H.setInt16(X+1,F),3;if(F>=-2147483648)return H.setUint8(X,210),H.setInt32(X+1,F),5;throw new Error("Number too small -0x"+(-F).toString(16).substr(1))}if(F===null)return H.setUint8(X,192),1;if(oe==="boolean")return H.setUint8(X,F?195:194),1;if(oe==="object"){var te,Ee=0,Te=Array.isArray(F);if(Te)te=F.length;else{var q=Object.keys(F);te=q.length}var Ee;if(16>te?(H.setUint8(X,te|(Te?144:128)),Ee=1):65536>te?(H.setUint8(X,Te?220:222),H.setUint16(X+1,te),Ee=3):4294967296>te&&(H.setUint8(X,Te?221:223),H.setUint32(X+1,te),Ee=5),Te)for(var Pe=0;te>Pe;Pe++)Ee+=a(F[Pe],H,X+Ee);else for(var Pe=0;te>Pe;Pe++){var tt=q[Pe];Ee+=a(tt,H,X+Ee),Ee+=a(F[tt],H,X+Ee)}return Ee}throw new Error("Unknown type "+oe)}function s(F){var H=typeof F;if(H==="string"){var X=r(F);if(32>X)return 1+X;if(256>X)return 2+X;if(65536>X)return 3+X;if(4294967296>X)return 5+X}if(F instanceof Uint8Array){var X=F.byteLength;if(256>X)return 2+X;if(65536>X)return 3+X;if(4294967296>X)return 5+X}if(H==="number"){if(Math.floor(F)!==F)return 9;if(F>=0){if(128>F)return 1;if(256>F)return 2;if(65536>F)return 3;if(4294967296>F)return 5;throw new Error("Number too big 0x"+F.toString(16))}if(F>=-32)return 1;if(F>=-128)return 2;if(F>=-32768)return 3;if(F>=-2147483648)return 5;throw new Error("Number too small -0x"+F.toString(16).substr(1))}if(H==="boolean"||F===null)return 1;if(H==="object"){var X,oe=0;if(Array.isArray(F)){X=F.length;for(var te=0;X>te;te++)oe+=s(F[te])}else{var Me=Object.keys(F);X=Me.length;for(var te=0;X>te;te++){var Te=Me[te];oe+=s(Te)+s(F[Te])}}if(16>X)return 1+oe;if(65536>X)return 3+oe;if(4294967296>X)return 5+oe;throw new Error("Array or object too long 0x"+X.toString(16))}throw new Error("Unknown type "+H)}function l(F){var H=new ArrayBuffer(s(F)),X=new DataView(H);return a(F,X,0),new Uint8Array(H)}function c(F,H,X){return H?new F(H.buffer,H.byteOffset,H.byteLength/(X||1)):void 0}function u(F){return c(DataView,F)}function f(F){return c(Uint8Array,F)}function p(F){return c(Int8Array,F)}function g(F){return c(Int32Array,F,4)}function y(F){return c(Float32Array,F,4)}function E(F,H){var X=F.length/2;H||(H=new Int16Array(X));for(var oe=0,te=0;X>oe;++oe,te+=2)H[oe]=F[te]<<8^F[te+1]<<0;return H}function h(F,H){var X=F.length;H||(H=new Uint8Array(2*X));for(var oe=u(H),te=0;X>te;++te)oe.setInt16(2*te,F[te]);return f(H)}function v(F,H){var X=F.length/4;H||(H=new Int32Array(X));for(var oe=0,te=0;X>oe;++oe,te+=4)H[oe]=F[te]<<24^F[te+1]<<16^F[te+2]<<8^F[te+3]<<0;return H}function C(F,H){var X=F.length;H||(H=new Uint8Array(4*X));for(var oe=u(H),te=0;X>te;++te)oe.setInt32(4*te,F[te]);return f(H)}function x(F,H){var X=F.length;H||(H=new Float32Array(X/4));for(var oe=u(H),te=u(F),Me=0,Te=0,q=X/4;q>Me;++Me,Te+=4)oe.setFloat32(Te,te.getFloat32(Te),!0);return H}function w(F,H,X){var oe=F.length,te=1/H;X||(X=new Float32Array(oe));for(var Me=0;oe>Me;++Me)X[Me]=F[Me]*te;return X}function _(F,H,X){var oe=F.length;X||(X=new Int32Array(oe));for(var te=0;oe>te;++te)X[te]=Math.round(F[te]*H);return X}function S(F,H){var X,oe;if(!H){var te=0;for(X=0,oe=F.length;oe>X;X+=2)te+=F[X+1];H=new F.constructor(te)}var Me=0;for(X=0,oe=F.length;oe>X;X+=2)for(var Te=F[X],q=F[X+1],Ee=0;q>Ee;++Ee)H[Me]=Te,++Me;return H}function M(F){if(F.length===0)return new Int32Array;var H,X,oe=2;for(H=1,X=F.length;X>H;++H)F[H-1]!==F[H]&&(oe+=2);var te=new Int32Array(oe),Me=0,Te=1;for(H=1,X=F.length;X>H;++H)F[H-1]!==F[H]?(te[Me]=F[H-1],te[Me+1]=Te,Te=1,Me+=2):++Te;return te[Me]=F[F.length-1],te[Me+1]=Te,te}function T(F,H){var X=F.length;H||(H=new F.constructor(X)),X&&(H[0]=F[0]);for(var oe=1;X>oe;++oe)H[oe]=F[oe]+H[oe-1];return H}function R(F,H){var X=F.length;H||(H=new F.constructor(X)),H[0]=F[0];for(var oe=1;X>oe;++oe)H[oe]=F[oe]-F[oe-1];return H}function P(F,H){var X,oe,te=F instanceof Int8Array?127:32767,Me=-te-1,Te=F.length;if(!H){var q=0;for(X=0;Te>X;++X)F[X]<te&&F[X]>Me&&++q;H=new Int32Array(q)}for(X=0,oe=0;Te>X;){for(var Ee=0;F[X]===te||F[X]===Me;)Ee+=F[X],++X;Ee+=F[X],++X,H[oe]=Ee,++oe}return H}function I(F,H){var X,oe=H?127:32767,te=-oe-1,Me=F.length,Te=0;for(X=0;Me>X;++X){var q=F[X];q===0?++Te:q>0?(Te+=Math.ceil(q/oe),q%oe===0&&(Te+=1)):(Te+=Math.ceil(q/te),q%te===0&&(Te+=1))}var Ee=H?new Int8Array(Te):new Int16Array(Te),Pe=0;for(X=0;Me>X;++X){var q=F[X];if(q>=0)for(;q>=oe;)Ee[Pe]=oe,++Pe,q-=oe;else for(;te>=q;)Ee[Pe]=te,++Pe,q-=te;Ee[Pe]=q,++Pe}return Ee}function B(F,H){return T(S(F),H)}function W(F){return M(R(F))}function D(F,H,X){return w(S(F,g(X)),H,X)}function O(F,H){return M(_(F,H))}function z(F,H,X){return w(T(F,g(X)),H,X)}function G(F,H,X){return R(_(F,H),X)}function k(F,H,X){return w(P(F,g(X)),H,X)}function $(F,H,X){var oe=P(F,g(X));return z(oe,H,y(oe))}function Z(F,H,X){return I(G(F,H),X)}function K(Me){var H=u(Me),X=H.getInt32(0),oe=H.getInt32(4),te=Me.subarray(8,12),Me=Me.subarray(12);return[X,Me,oe,te]}function j(F,H,X,oe){var te=new ArrayBuffer(12+oe.byteLength),Me=new Uint8Array(te),Te=new DataView(te);return Te.setInt32(0,F),Te.setInt32(4,H),X&&Me.set(X,8),Me.set(oe,12),Me}function Q(F){var H=F.length,X=f(F);return j(2,H,void 0,X)}function le(F){var H=F.length,X=C(F);return j(4,H,void 0,X)}function he(F,H){var X=F.length/H,oe=C([H]),te=f(F);return j(5,X,oe,te)}function ve(F){var H=F.length,X=C(M(F));return j(6,H,void 0,X)}function re(F){var H=F.length,X=C(W(F));return j(8,H,void 0,X)}function Ie(F,H){var X=F.length,oe=C([H]),te=C(O(F,H));return j(9,X,oe,te)}function ge(F,H){var X=F.length,oe=C([H]),te=h(Z(F,H));return j(10,X,oe,te)}function Se(F){var H={};return De.forEach(function(X){F[X]!==void 0&&(H[X]=F[X])}),F.bondAtomList&&(H.bondAtomList=le(F.bondAtomList)),F.bondOrderList&&(H.bondOrderList=Q(F.bondOrderList)),H.xCoordList=ge(F.xCoordList,1e3),H.yCoordList=ge(F.yCoordList,1e3),H.zCoordList=ge(F.zCoordList,1e3),F.bFactorList&&(H.bFactorList=ge(F.bFactorList,100)),F.atomIdList&&(H.atomIdList=re(F.atomIdList)),F.altLocList&&(H.altLocList=ve(F.altLocList)),F.occupancyList&&(H.occupancyList=Ie(F.occupancyList,100)),H.groupIdList=re(F.groupIdList),H.groupTypeList=le(F.groupTypeList),F.secStructList&&(H.secStructList=Q(F.secStructList)),F.insCodeList&&(H.insCodeList=ve(F.insCodeList)),F.sequenceIndexList&&(H.sequenceIndexList=re(F.sequenceIndexList)),H.chainIdList=he(F.chainIdList,4),F.chainNameList&&(H.chainNameList=he(F.chainNameList,4)),H}function Le(F){function H(Ee){for(var Pe={},tt=0;Ee>tt;tt++){var Oe=Me();Pe[Oe]=Me()}return Pe}function X(Ee){var Pe=F.subarray(Te,Te+Ee);return Te+=Ee,Pe}function oe(Ee){var Pe=F.subarray(Te,Te+Ee);Te+=Ee;var tt=65535;if(Ee>tt){for(var Oe=[],Je=0;Je<Pe.length;Je+=tt)Oe.push(String.fromCharCode.apply(null,Pe.subarray(Je,Je+tt)));return Oe.join("")}return String.fromCharCode.apply(null,Pe)}function te(Ee){for(var Pe=new Array(Ee),tt=0;Ee>tt;tt++)Pe[tt]=Me();return Pe}function Me(){var Ee,Pe,tt=F[Te];if(!(128&tt))return Te++,tt;if((240&tt)===128)return Pe=15&tt,Te++,H(Pe);if((240&tt)===144)return Pe=15&tt,Te++,te(Pe);if((224&tt)===160)return Pe=31&tt,Te++,oe(Pe);if((224&tt)===224)return Ee=q.getInt8(Te),Te++,Ee;switch(tt){case 192:return Te++,null;case 194:return Te++,!1;case 195:return Te++,!0;case 196:return Pe=q.getUint8(Te+1),Te+=2,X(Pe);case 197:return Pe=q.getUint16(Te+1),Te+=3,X(Pe);case 198:return Pe=q.getUint32(Te+1),Te+=5,X(Pe);case 202:return Ee=q.getFloat32(Te+1),Te+=5,Ee;case 203:return Ee=q.getFloat64(Te+1),Te+=9,Ee;case 204:return Ee=F[Te+1],Te+=2,Ee;case 205:return Ee=q.getUint16(Te+1),Te+=3,Ee;case 206:return Ee=q.getUint32(Te+1),Te+=5,Ee;case 208:return Ee=q.getInt8(Te+1),Te+=2,Ee;case 209:return Ee=q.getInt16(Te+1),Te+=3,Ee;case 210:return Ee=q.getInt32(Te+1),Te+=5,Ee;case 217:return Pe=q.getUint8(Te+1),Te+=2,oe(Pe);case 218:return Pe=q.getUint16(Te+1),Te+=3,oe(Pe);case 219:return Pe=q.getUint32(Te+1),Te+=5,oe(Pe);case 220:return Pe=q.getUint16(Te+1),Te+=3,te(Pe);case 221:return Pe=q.getUint32(Te+1),Te+=5,te(Pe);case 222:return Pe=q.getUint16(Te+1),Te+=3,H(Pe);case 223:return Pe=q.getUint32(Te+1),Te+=5,H(Pe)}throw new Error("Unknown type 0x"+tt.toString(16))}var Te=0,q=new DataView(F.buffer);return Me()}function be(F,H,X,oe){switch(F){case 1:return x(H);case 2:return p(H);case 3:return E(H);case 4:return v(H);case 5:return f(H);case 6:return S(v(H),new Uint8Array(X));case 7:return S(v(H));case 8:return B(v(H));case 9:return D(v(H),v(oe)[0]);case 10:return $(E(H),v(oe)[0]);case 11:return w(E(H),v(oe)[0]);case 12:return k(E(H),v(oe)[0]);case 13:return k(p(H),v(oe)[0]);case 14:return P(E(H));case 15:return P(p(H))}}function ye(F,H){H=H||{};var X=H.ignoreFields,oe={};return ze.forEach(function(te){var Me=X?X.indexOf(te)!==-1:!1,Te=F[te];Me||Te===void 0||(Te instanceof Uint8Array?oe[te]=be.apply(null,K(Te)):oe[te]=Te)}),oe}function ce(F){return String.fromCharCode.apply(null,F).replace(/\0/g,"")}function ue(F,H,X){X=X||{};var oe,te,Me,Te,q,Ee,Pe=X.firstModelOnly,tt=H.onModel,Oe=H.onChain,Je=H.onGroup,ee=H.onAtom,Fe=H.onBond,it=0,U=0,ke=0,de=0,se=0,fe=-1,je=F.chainNameList,ht=F.secStructList,pt=F.insCodeList,dt=F.sequenceIndexList,At=F.atomIdList,_e=F.bFactorList,Xe=F.altLocList,Ue=F.occupancyList,Ye=F.bondAtomList,ot=F.bondOrderList;for(oe=0,te=F.chainsPerModel.length;te>oe&&!(Pe&&it>0);++oe){var gt=F.chainsPerModel[it];for(tt&&tt({chainCount:gt,modelIndex:it}),Me=0;gt>Me;++Me){var Et=F.groupsPerChain[U];if(Oe){var yt=ce(F.chainIdList.subarray(4*U,4*U+4)),mt=null;je&&(mt=ce(je.subarray(4*U,4*U+4))),Oe({groupCount:Et,chainIndex:U,modelIndex:it,chainId:yt,chainName:mt})}for(Te=0;Et>Te;++Te){var St=F.groupList[F.groupTypeList[ke]],vt=St.atomNameList.length;if(Je){var Rt=null;ht&&(Rt=ht[ke]);var xt=null;F.insCodeList&&(xt=String.fromCharCode(pt[ke]));var dr=null;dt&&(dr=dt[ke]),Je({atomCount:vt,groupIndex:ke,chainIndex:U,modelIndex:it,groupId:F.groupIdList[ke],groupType:F.groupTypeList[ke],groupName:St.groupName,singleLetterCode:St.singleLetterCode,chemCompType:St.chemCompType,secStruct:Rt,insCode:xt,sequenceIndex:dr})}for(q=0;vt>q;++q){if(ee){var $t=null;At&&($t=At[de]);var pr=null;_e&&(pr=_e[de]);var qt=null;Xe&&(qt=String.fromCharCode(Xe[de]));var Lr=null;Ue&&(Lr=Ue[de]),ee({atomIndex:de,groupIndex:ke,chainIndex:U,modelIndex:it,atomId:$t,element:St.elementList[q],atomName:St.atomNameList[q],formalCharge:St.formalChargeList[q],xCoord:F.xCoordList[de],yCoord:F.yCoordList[de],zCoord:F.zCoordList[de],bFactor:pr,altLoc:qt,occupancy:Lr})}de+=1}if(Fe){var yr=St.bondAtomList;for(q=0,Ee=St.bondOrderList.length;Ee>q;++q)Fe({atomIndex1:de-vt+yr[2*q],atomIndex2:de-vt+yr[2*q+1],bondOrder:St.bondOrderList[q]})}ke+=1}U+=1}if(se=fe+1,fe=de-1,Fe&&Ye)for(q=0,Ee=Ye.length;Ee>q;q+=2){var or=Ye[q],xr=Ye[q+1];(or>=se&&fe>=or||xr>=se&&fe>=xr)&&Fe({atomIndex1:or,atomIndex2:xr,bondOrder:ot?ot[q/2]:null})}it+=1}}function Ce(F){return l(Se(F))}function Ve(F,H){F instanceof ArrayBuffer&&(F=new Uint8Array(F));var X;return X=F instanceof Uint8Array?Le(F):F,ye(X,H)}function ie(F,H,X,oe){function te(){try{var Te=Ve(Me.response);X(Te)}catch(q){oe(q)}}var Me=new XMLHttpRequest;Me.addEventListener("load",te,!0),Me.addEventListener("error",oe,!0),Me.responseType="arraybuffer",Me.open("GET",H+F.toUpperCase()),Me.send()}function ae(F,H,X){ie(F,qe,H,X)}function Ae(F,H,X){ie(F,et,H,X)}var De=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Be=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],ze=De.concat(Be),We="v1.0.1",$e="//mmtf.rcsb.org/v1.0/",qe=$e+"full/",et=$e+"reduced/";e.encode=Ce,e.decode=Ve,e.traverse=ue,e.fetch=ae,e.fetchReduced=Ae,e.version=We,e.fetchUrl=qe,e.fetchReducedUrl=et,e.encodeMsgpack=l,e.encodeMmtf=Se,e.decodeMsgpack=Le,e.decodeMmtf=ye})},"./node_modules/pako/dist/pako.esm.mjs":(o,t,e)=>{e.r(t),e.d(t,{Deflate:()=>vs,Inflate:()=>ys,constants:()=>Ss,default:()=>No,deflate:()=>_s,deflateRaw:()=>gs,gzip:()=>wn,inflate:()=>xs,inflateRaw:()=>Xr,ungzip:()=>bs});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const n=4,r=0,a=1,s=2;function l(L){let J=L.length;for(;--J>=0;)L[J]=0}const c=0,u=1,f=2,p=3,g=258,y=29,E=256,h=E+1+y,v=30,C=19,x=2*h+1,w=15,_=16,S=7,M=256,T=16,R=17,P=18,I=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),W=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O=512,z=new Array((h+2)*2);l(z);const G=new Array(v*2);l(G);const k=new Array(O);l(k);const $=new Array(g-p+1);l($);const Z=new Array(y);l(Z);const K=new Array(v);l(K);function j(L,J,V,me,Re){this.static_tree=L,this.extra_bits=J,this.extra_base=V,this.elems=me,this.max_length=Re,this.has_stree=L&&L.length}let Q,le,he;function ve(L,J){this.dyn_tree=L,this.max_code=0,this.stat_desc=J}const re=L=>L<256?k[L]:k[256+(L>>>7)],Ie=(L,J)=>{L.pending_buf[L.pending++]=J&255,L.pending_buf[L.pending++]=J>>>8&255},ge=(L,J,V)=>{L.bi_valid>_-V?(L.bi_buf|=J<<L.bi_valid&65535,Ie(L,L.bi_buf),L.bi_buf=J>>_-L.bi_valid,L.bi_valid+=V-_):(L.bi_buf|=J<<L.bi_valid&65535,L.bi_valid+=V)},Se=(L,J,V)=>{ge(L,V[J*2],V[J*2+1])},Le=(L,J)=>{let V=0;do V|=L&1,L>>>=1,V<<=1;while(--J>0);return V>>>1},be=L=>{L.bi_valid===16?(Ie(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):L.bi_valid>=8&&(L.pending_buf[L.pending++]=L.bi_buf&255,L.bi_buf>>=8,L.bi_valid-=8)},ye=(L,J)=>{const V=J.dyn_tree,me=J.max_code,Re=J.stat_desc.static_tree,we=J.stat_desc.has_stree,rt=J.stat_desc.extra_bits,Ze=J.stat_desc.extra_base,Mt=J.stat_desc.max_length;let He,nt,tr,bt,ft,Pt,Yt=0;for(bt=0;bt<=w;bt++)L.bl_count[bt]=0;for(V[L.heap[L.heap_max]*2+1]=0,He=L.heap_max+1;He<x;He++)nt=L.heap[He],bt=V[V[nt*2+1]*2+1]+1,bt>Mt&&(bt=Mt,Yt++),V[nt*2+1]=bt,!(nt>me)&&(L.bl_count[bt]++,ft=0,nt>=Ze&&(ft=rt[nt-Ze]),Pt=V[nt*2],L.opt_len+=Pt*(bt+ft),we&&(L.static_len+=Pt*(Re[nt*2+1]+ft)));if(Yt!==0){do{for(bt=Mt-1;L.bl_count[bt]===0;)bt--;L.bl_count[bt]--,L.bl_count[bt+1]+=2,L.bl_count[Mt]--,Yt-=2}while(Yt>0);for(bt=Mt;bt!==0;bt--)for(nt=L.bl_count[bt];nt!==0;)tr=L.heap[--He],!(tr>me)&&(V[tr*2+1]!==bt&&(L.opt_len+=(bt-V[tr*2+1])*V[tr*2],V[tr*2+1]=bt),nt--)}},ce=(L,J,V)=>{const me=new Array(w+1);let Re=0,we,rt;for(we=1;we<=w;we++)Re=Re+V[we-1]<<1,me[we]=Re;for(rt=0;rt<=J;rt++){let Ze=L[rt*2+1];Ze!==0&&(L[rt*2]=Le(me[Ze]++,Ze))}},ue=()=>{let L,J,V,me,Re;const we=new Array(w+1);for(V=0,me=0;me<y-1;me++)for(Z[me]=V,L=0;L<1<<I[me];L++)$[V++]=me;for($[V-1]=me,Re=0,me=0;me<16;me++)for(K[me]=Re,L=0;L<1<<B[me];L++)k[Re++]=me;for(Re>>=7;me<v;me++)for(K[me]=Re<<7,L=0;L<1<<B[me]-7;L++)k[256+Re++]=me;for(J=0;J<=w;J++)we[J]=0;for(L=0;L<=143;)z[L*2+1]=8,L++,we[8]++;for(;L<=255;)z[L*2+1]=9,L++,we[9]++;for(;L<=279;)z[L*2+1]=7,L++,we[7]++;for(;L<=287;)z[L*2+1]=8,L++,we[8]++;for(ce(z,h+1,we),L=0;L<v;L++)G[L*2+1]=5,G[L*2]=Le(L,5);Q=new j(z,I,E+1,h,w),le=new j(G,B,0,v,w),he=new j(new Array(0),W,0,C,S)},Ce=L=>{let J;for(J=0;J<h;J++)L.dyn_ltree[J*2]=0;for(J=0;J<v;J++)L.dyn_dtree[J*2]=0;for(J=0;J<C;J++)L.bl_tree[J*2]=0;L.dyn_ltree[M*2]=1,L.opt_len=L.static_len=0,L.sym_next=L.matches=0},Ve=L=>{L.bi_valid>8?Ie(L,L.bi_buf):L.bi_valid>0&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0},ie=(L,J,V,me)=>{const Re=J*2,we=V*2;return L[Re]<L[we]||L[Re]===L[we]&&me[J]<=me[V]},ae=(L,J,V)=>{const me=L.heap[V];let Re=V<<1;for(;Re<=L.heap_len&&(Re<L.heap_len&&ie(J,L.heap[Re+1],L.heap[Re],L.depth)&&Re++,!ie(J,me,L.heap[Re],L.depth));)L.heap[V]=L.heap[Re],V=Re,Re<<=1;L.heap[V]=me},Ae=(L,J,V)=>{let me,Re,we=0,rt,Ze;if(L.sym_next!==0)do me=L.pending_buf[L.sym_buf+we++]&255,me+=(L.pending_buf[L.sym_buf+we++]&255)<<8,Re=L.pending_buf[L.sym_buf+we++],me===0?Se(L,Re,J):(rt=$[Re],Se(L,rt+E+1,J),Ze=I[rt],Ze!==0&&(Re-=Z[rt],ge(L,Re,Ze)),me--,rt=re(me),Se(L,rt,V),Ze=B[rt],Ze!==0&&(me-=K[rt],ge(L,me,Ze)));while(we<L.sym_next);Se(L,M,J)},De=(L,J)=>{const V=J.dyn_tree,me=J.stat_desc.static_tree,Re=J.stat_desc.has_stree,we=J.stat_desc.elems;let rt,Ze,Mt=-1,He;for(L.heap_len=0,L.heap_max=x,rt=0;rt<we;rt++)V[rt*2]!==0?(L.heap[++L.heap_len]=Mt=rt,L.depth[rt]=0):V[rt*2+1]=0;for(;L.heap_len<2;)He=L.heap[++L.heap_len]=Mt<2?++Mt:0,V[He*2]=1,L.depth[He]=0,L.opt_len--,Re&&(L.static_len-=me[He*2+1]);for(J.max_code=Mt,rt=L.heap_len>>1;rt>=1;rt--)ae(L,V,rt);He=we;do rt=L.heap[1],L.heap[1]=L.heap[L.heap_len--],ae(L,V,1),Ze=L.heap[1],L.heap[--L.heap_max]=rt,L.heap[--L.heap_max]=Ze,V[He*2]=V[rt*2]+V[Ze*2],L.depth[He]=(L.depth[rt]>=L.depth[Ze]?L.depth[rt]:L.depth[Ze])+1,V[rt*2+1]=V[Ze*2+1]=He,L.heap[1]=He++,ae(L,V,1);while(L.heap_len>=2);L.heap[--L.heap_max]=L.heap[1],ye(L,J),ce(V,Mt,L.bl_count)},Be=(L,J,V)=>{let me,Re=-1,we,rt=J[0*2+1],Ze=0,Mt=7,He=4;for(rt===0&&(Mt=138,He=3),J[(V+1)*2+1]=65535,me=0;me<=V;me++)we=rt,rt=J[(me+1)*2+1],!(++Ze<Mt&&we===rt)&&(Ze<He?L.bl_tree[we*2]+=Ze:we!==0?(we!==Re&&L.bl_tree[we*2]++,L.bl_tree[T*2]++):Ze<=10?L.bl_tree[R*2]++:L.bl_tree[P*2]++,Ze=0,Re=we,rt===0?(Mt=138,He=3):we===rt?(Mt=6,He=3):(Mt=7,He=4))},ze=(L,J,V)=>{let me,Re=-1,we,rt=J[0*2+1],Ze=0,Mt=7,He=4;for(rt===0&&(Mt=138,He=3),me=0;me<=V;me++)if(we=rt,rt=J[(me+1)*2+1],!(++Ze<Mt&&we===rt)){if(Ze<He)do Se(L,we,L.bl_tree);while(--Ze!==0);else we!==0?(we!==Re&&(Se(L,we,L.bl_tree),Ze--),Se(L,T,L.bl_tree),ge(L,Ze-3,2)):Ze<=10?(Se(L,R,L.bl_tree),ge(L,Ze-3,3)):(Se(L,P,L.bl_tree),ge(L,Ze-11,7));Ze=0,Re=we,rt===0?(Mt=138,He=3):we===rt?(Mt=6,He=3):(Mt=7,He=4)}},We=L=>{let J;for(Be(L,L.dyn_ltree,L.l_desc.max_code),Be(L,L.dyn_dtree,L.d_desc.max_code),De(L,L.bl_desc),J=C-1;J>=3&&L.bl_tree[D[J]*2+1]===0;J--);return L.opt_len+=3*(J+1)+5+5+4,J},$e=(L,J,V,me)=>{let Re;for(ge(L,J-257,5),ge(L,V-1,5),ge(L,me-4,4),Re=0;Re<me;Re++)ge(L,L.bl_tree[D[Re]*2+1],3);ze(L,L.dyn_ltree,J-1),ze(L,L.dyn_dtree,V-1)},qe=L=>{let J=4093624447,V;for(V=0;V<=31;V++,J>>>=1)if(J&1&&L.dyn_ltree[V*2]!==0)return r;if(L.dyn_ltree[9*2]!==0||L.dyn_ltree[10*2]!==0||L.dyn_ltree[13*2]!==0)return a;for(V=32;V<E;V++)if(L.dyn_ltree[V*2]!==0)return a;return r};let et=!1;const F=L=>{et||(ue(),et=!0),L.l_desc=new ve(L.dyn_ltree,Q),L.d_desc=new ve(L.dyn_dtree,le),L.bl_desc=new ve(L.bl_tree,he),L.bi_buf=0,L.bi_valid=0,Ce(L)},H=(L,J,V,me)=>{ge(L,(c<<1)+(me?1:0),3),Ve(L),Ie(L,V),Ie(L,~V),V&&L.pending_buf.set(L.window.subarray(J,J+V),L.pending),L.pending+=V},X=L=>{ge(L,u<<1,3),Se(L,M,z),be(L)},oe=(L,J,V,me)=>{let Re,we,rt=0;L.level>0?(L.strm.data_type===s&&(L.strm.data_type=qe(L)),De(L,L.l_desc),De(L,L.d_desc),rt=We(L),Re=L.opt_len+3+7>>>3,we=L.static_len+3+7>>>3,we<=Re&&(Re=we)):Re=we=V+5,V+4<=Re&&J!==-1?H(L,J,V,me):L.strategy===n||we===Re?(ge(L,(u<<1)+(me?1:0),3),Ae(L,z,G)):(ge(L,(f<<1)+(me?1:0),3),$e(L,L.l_desc.max_code+1,L.d_desc.max_code+1,rt+1),Ae(L,L.dyn_ltree,L.dyn_dtree)),Ce(L),me&&Ve(L)},te=(L,J,V)=>(L.pending_buf[L.sym_buf+L.sym_next++]=J,L.pending_buf[L.sym_buf+L.sym_next++]=J>>8,L.pending_buf[L.sym_buf+L.sym_next++]=V,J===0?L.dyn_ltree[V*2]++:(L.matches++,J--,L.dyn_ltree[($[V]+E+1)*2]++,L.dyn_dtree[re(J)*2]++),L.sym_next===L.sym_end);var Me=F,Te=H,q=oe,Ee=te,Pe=X,tt={_tr_init:Me,_tr_stored_block:Te,_tr_flush_block:q,_tr_tally:Ee,_tr_align:Pe},Je=(L,J,V,me)=>{let Re=L&65535|0,we=L>>>16&65535|0,rt=0;for(;V!==0;){rt=V>2e3?2e3:V,V-=rt;do Re=Re+J[me++]|0,we=we+Re|0;while(--rt);Re%=65521,we%=65521}return Re|we<<16|0};const ee=()=>{let L,J=[];for(var V=0;V<256;V++){L=V;for(var me=0;me<8;me++)L=L&1?3988292384^L>>>1:L>>>1;J[V]=L}return J},Fe=new Uint32Array(ee());var U=(L,J,V,me)=>{const Re=Fe,we=me+V;L^=-1;for(let rt=me;rt<we;rt++)L=L>>>8^Re[(L^J[rt])&255];return L^-1},ke={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},de={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:se,_tr_stored_block:fe,_tr_flush_block:je,_tr_tally:ht,_tr_align:pt}=tt,{Z_NO_FLUSH:dt,Z_PARTIAL_FLUSH:At,Z_FULL_FLUSH:_e,Z_FINISH:Xe,Z_BLOCK:Ue,Z_OK:Ye,Z_STREAM_END:ot,Z_STREAM_ERROR:gt,Z_DATA_ERROR:Et,Z_BUF_ERROR:yt,Z_DEFAULT_COMPRESSION:mt,Z_FILTERED:St,Z_HUFFMAN_ONLY:vt,Z_RLE:Rt,Z_FIXED:xt,Z_DEFAULT_STRATEGY:dr,Z_UNKNOWN:$t,Z_DEFLATED:pr}=de,qt=9,Lr=15,yr=8,mr=256+1+29,za=30,Va=19,Ua=2*mr+1,Gs=15,Xt=3,yn=258,nn=yn+Xt+1,Ga=32,Rn=42,Bi=57,ci=69,na=73,ki=91,$n=103,xn=113,ui=666,Tr=1,Ln=2,un=3,Xn=4,Wa=3,fn=(L,J)=>(L.msg=ke[J],J),Fi=L=>L*2-(L>4?9:0),Nr=L=>{let J=L.length;for(;--J>=0;)L[J]=0},Ha=L=>{let J,V,me,Re=L.w_size;J=L.hash_size,me=J;do V=L.head[--me],L.head[me]=V>=Re?V-Re:0;while(--J);J=Re,me=J;do V=L.prev[--me],L.prev[me]=V>=Re?V-Re:0;while(--J)};let bn=(L,J,V)=>(J<<L.hash_shift^V)&L.hash_mask;const Pr=L=>{const J=L.state;let V=J.pending;V>L.avail_out&&(V=L.avail_out),V!==0&&(L.output.set(J.pending_buf.subarray(J.pending_out,J.pending_out+V),L.next_out),L.next_out+=V,J.pending_out+=V,L.total_out+=V,L.avail_out-=V,J.pending-=V,J.pending===0&&(J.pending_out=0))},Ir=(L,J)=>{je(L,L.block_start>=0?L.block_start:-1,L.strstart-L.block_start,J),L.block_start=L.strstart,Pr(L.strm)},Jt=(L,J)=>{L.pending_buf[L.pending++]=J},jn=(L,J)=>{L.pending_buf[L.pending++]=J>>>8&255,L.pending_buf[L.pending++]=J&255},ia=(L,J,V,me)=>{let Re=L.avail_in;return Re>me&&(Re=me),Re===0?0:(L.avail_in-=Re,J.set(L.input.subarray(L.next_in,L.next_in+Re),V),L.state.wrap===1?L.adler=Je(L.adler,J,Re,V):L.state.wrap===2&&(L.adler=U(L.adler,J,Re,V)),L.next_in+=Re,L.total_in+=Re,Re)},$a=(L,J)=>{let V=L.max_chain_length,me=L.strstart,Re,we,rt=L.prev_length,Ze=L.nice_match;const Mt=L.strstart>L.w_size-nn?L.strstart-(L.w_size-nn):0,He=L.window,nt=L.w_mask,tr=L.prev,bt=L.strstart+yn;let ft=He[me+rt-1],Pt=He[me+rt];L.prev_length>=L.good_match&&(V>>=2),Ze>L.lookahead&&(Ze=L.lookahead);do if(Re=J,!(He[Re+rt]!==Pt||He[Re+rt-1]!==ft||He[Re]!==He[me]||He[++Re]!==He[me+1])){me+=2,Re++;do;while(He[++me]===He[++Re]&&He[++me]===He[++Re]&&He[++me]===He[++Re]&&He[++me]===He[++Re]&&He[++me]===He[++Re]&&He[++me]===He[++Re]&&He[++me]===He[++Re]&&He[++me]===He[++Re]&&me<bt);if(we=yn-(bt-me),me=bt-yn,we>rt){if(L.match_start=J,rt=we,we>=Ze)break;ft=He[me+rt-1],Pt=He[me+rt]}}while((J=tr[J&nt])>Mt&&--V!==0);return rt<=L.lookahead?rt:L.lookahead},Zn=L=>{const J=L.w_size;let V,me,Re;do{if(me=L.window_size-L.lookahead-L.strstart,L.strstart>=J+(J-nn)&&(L.window.set(L.window.subarray(J,J+J-me),0),L.match_start-=J,L.strstart-=J,L.block_start-=J,L.insert>L.strstart&&(L.insert=L.strstart),Ha(L),me+=J),L.strm.avail_in===0)break;if(V=ia(L.strm,L.window,L.strstart+L.lookahead,me),L.lookahead+=V,L.lookahead+L.insert>=Xt)for(Re=L.strstart-L.insert,L.ins_h=L.window[Re],L.ins_h=bn(L,L.ins_h,L.window[Re+1]);L.insert&&(L.ins_h=bn(L,L.ins_h,L.window[Re+Xt-1]),L.prev[Re&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=Re,Re++,L.insert--,!(L.lookahead+L.insert<Xt)););}while(L.lookahead<nn&&L.strm.avail_in!==0)},aa=(L,J)=>{let V=L.pending_buf_size-5>L.w_size?L.w_size:L.pending_buf_size-5,me,Re,we,rt=0,Ze=L.strm.avail_in;do{if(me=65535,we=L.bi_valid+42>>3,L.strm.avail_out<we||(we=L.strm.avail_out-we,Re=L.strstart-L.block_start,me>Re+L.strm.avail_in&&(me=Re+L.strm.avail_in),me>we&&(me=we),me<V&&(me===0&&J!==Xe||J===dt||me!==Re+L.strm.avail_in)))break;rt=J===Xe&&me===Re+L.strm.avail_in?1:0,fe(L,0,0,rt),L.pending_buf[L.pending-4]=me,L.pending_buf[L.pending-3]=me>>8,L.pending_buf[L.pending-2]=~me,L.pending_buf[L.pending-1]=~me>>8,Pr(L.strm),Re&&(Re>me&&(Re=me),L.strm.output.set(L.window.subarray(L.block_start,L.block_start+Re),L.strm.next_out),L.strm.next_out+=Re,L.strm.avail_out-=Re,L.strm.total_out+=Re,L.block_start+=Re,me-=Re),me&&(ia(L.strm,L.strm.output,L.strm.next_out,me),L.strm.next_out+=me,L.strm.avail_out-=me,L.strm.total_out+=me)}while(rt===0);return Ze-=L.strm.avail_in,Ze&&(Ze>=L.w_size?(L.matches=2,L.window.set(L.strm.input.subarray(L.strm.next_in-L.w_size,L.strm.next_in),0),L.strstart=L.w_size,L.insert=L.strstart):(L.window_size-L.strstart<=Ze&&(L.strstart-=L.w_size,L.window.set(L.window.subarray(L.w_size,L.w_size+L.strstart),0),L.matches<2&&L.matches++,L.insert>L.strstart&&(L.insert=L.strstart)),L.window.set(L.strm.input.subarray(L.strm.next_in-Ze,L.strm.next_in),L.strstart),L.strstart+=Ze,L.insert+=Ze>L.w_size-L.insert?L.w_size-L.insert:Ze),L.block_start=L.strstart),L.high_water<L.strstart&&(L.high_water=L.strstart),rt?Xn:J!==dt&&J!==Xe&&L.strm.avail_in===0&&L.strstart===L.block_start?Ln:(we=L.window_size-L.strstart,L.strm.avail_in>we&&L.block_start>=L.w_size&&(L.block_start-=L.w_size,L.strstart-=L.w_size,L.window.set(L.window.subarray(L.w_size,L.w_size+L.strstart),0),L.matches<2&&L.matches++,we+=L.w_size,L.insert>L.strstart&&(L.insert=L.strstart)),we>L.strm.avail_in&&(we=L.strm.avail_in),we&&(ia(L.strm,L.window,L.strstart,we),L.strstart+=we,L.insert+=we>L.w_size-L.insert?L.w_size-L.insert:we),L.high_water<L.strstart&&(L.high_water=L.strstart),we=L.bi_valid+42>>3,we=L.pending_buf_size-we>65535?65535:L.pending_buf_size-we,V=we>L.w_size?L.w_size:we,Re=L.strstart-L.block_start,(Re>=V||(Re||J===Xe)&&J!==dt&&L.strm.avail_in===0&&Re<=we)&&(me=Re>we?we:Re,rt=J===Xe&&L.strm.avail_in===0&&me===Re?1:0,fe(L,L.block_start,me,rt),L.block_start+=me,Pr(L.strm)),rt?un:Tr)},sa=(L,J)=>{let V,me;for(;;){if(L.lookahead<nn){if(Zn(L),L.lookahead<nn&&J===dt)return Tr;if(L.lookahead===0)break}if(V=0,L.lookahead>=Xt&&(L.ins_h=bn(L,L.ins_h,L.window[L.strstart+Xt-1]),V=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),V!==0&&L.strstart-V<=L.w_size-nn&&(L.match_length=$a(L,V)),L.match_length>=Xt)if(me=ht(L,L.strstart-L.match_start,L.match_length-Xt),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=Xt){L.match_length--;do L.strstart++,L.ins_h=bn(L,L.ins_h,L.window[L.strstart+Xt-1]),V=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart;while(--L.match_length!==0);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=bn(L,L.ins_h,L.window[L.strstart+1]);else me=ht(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(me&&(Ir(L,!1),L.strm.avail_out===0))return Tr}return L.insert=L.strstart<Xt-1?L.strstart:Xt-1,J===Xe?(Ir(L,!0),L.strm.avail_out===0?un:Xn):L.sym_next&&(Ir(L,!1),L.strm.avail_out===0)?Tr:Ln},Yn=(L,J)=>{let V,me,Re;for(;;){if(L.lookahead<nn){if(Zn(L),L.lookahead<nn&&J===dt)return Tr;if(L.lookahead===0)break}if(V=0,L.lookahead>=Xt&&(L.ins_h=bn(L,L.ins_h,L.window[L.strstart+Xt-1]),V=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=Xt-1,V!==0&&L.prev_length<L.max_lazy_match&&L.strstart-V<=L.w_size-nn&&(L.match_length=$a(L,V),L.match_length<=5&&(L.strategy===St||L.match_length===Xt&&L.strstart-L.match_start>4096)&&(L.match_length=Xt-1)),L.prev_length>=Xt&&L.match_length<=L.prev_length){Re=L.strstart+L.lookahead-Xt,me=ht(L,L.strstart-1-L.prev_match,L.prev_length-Xt),L.lookahead-=L.prev_length-1,L.prev_length-=2;do++L.strstart<=Re&&(L.ins_h=bn(L,L.ins_h,L.window[L.strstart+Xt-1]),V=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart);while(--L.prev_length!==0);if(L.match_available=0,L.match_length=Xt-1,L.strstart++,me&&(Ir(L,!1),L.strm.avail_out===0))return Tr}else if(L.match_available){if(me=ht(L,0,L.window[L.strstart-1]),me&&Ir(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return Tr}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(me=ht(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<Xt-1?L.strstart:Xt-1,J===Xe?(Ir(L,!0),L.strm.avail_out===0?un:Xn):L.sym_next&&(Ir(L,!1),L.strm.avail_out===0)?Tr:Ln},Hs=(L,J)=>{let V,me,Re,we;const rt=L.window;for(;;){if(L.lookahead<=yn){if(Zn(L),L.lookahead<=yn&&J===dt)return Tr;if(L.lookahead===0)break}if(L.match_length=0,L.lookahead>=Xt&&L.strstart>0&&(Re=L.strstart-1,me=rt[Re],me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re])){we=L.strstart+yn;do;while(me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re]&&me===rt[++Re]&&Re<we);L.match_length=yn-(we-Re),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=Xt?(V=ht(L,1,L.match_length-Xt),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(V=ht(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),V&&(Ir(L,!1),L.strm.avail_out===0))return Tr}return L.insert=0,J===Xe?(Ir(L,!0),L.strm.avail_out===0?un:Xn):L.sym_next&&(Ir(L,!1),L.strm.avail_out===0)?Tr:Ln},$s=(L,J)=>{let V;for(;;){if(L.lookahead===0&&(Zn(L),L.lookahead===0)){if(J===dt)return Tr;break}if(L.match_length=0,V=ht(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,V&&(Ir(L,!1),L.strm.avail_out===0))return Tr}return L.insert=0,J===Xe?(Ir(L,!0),L.strm.avail_out===0?un:Xn):L.sym_next&&(Ir(L,!1),L.strm.avail_out===0)?Tr:Ln};function Ur(L,J,V,me,Re){this.good_length=L,this.max_lazy=J,this.nice_length=V,this.max_chain=me,this.func=Re}const fi=[new Ur(0,0,0,0,aa),new Ur(4,4,8,4,sa),new Ur(4,5,16,8,sa),new Ur(4,6,32,32,sa),new Ur(4,4,16,16,Yn),new Ur(8,16,32,32,Yn),new Ur(8,16,128,128,Yn),new Ur(8,32,128,256,Yn),new Ur(32,128,258,1024,Yn),new Ur(32,258,258,4096,Yn)],Xs=L=>{L.window_size=2*L.w_size,Nr(L.head),L.max_lazy_match=fi[L.level].max_lazy,L.good_match=fi[L.level].good_length,L.nice_match=fi[L.level].nice_length,L.max_chain_length=fi[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=Xt-1,L.match_available=0,L.ins_h=0};function js(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Ua*2),this.dyn_dtree=new Uint16Array((2*za+1)*2),this.bl_tree=new Uint16Array((2*Va+1)*2),Nr(this.dyn_ltree),Nr(this.dyn_dtree),Nr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Gs+1),this.heap=new Uint16Array(2*mr+1),Nr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*mr+1),Nr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const hi=L=>{if(!L)return 1;const J=L.state;return!J||J.strm!==L||J.status!==Rn&&J.status!==Bi&&J.status!==ci&&J.status!==na&&J.status!==ki&&J.status!==$n&&J.status!==xn&&J.status!==ui?1:0},Xa=L=>{if(hi(L))return fn(L,gt);L.total_in=L.total_out=0,L.data_type=$t;const J=L.state;return J.pending=0,J.pending_out=0,J.wrap<0&&(J.wrap=-J.wrap),J.status=J.wrap===2?Bi:J.wrap?Rn:xn,L.adler=J.wrap===2?0:1,J.last_flush=-2,se(J),Ye},ur=L=>{const J=Xa(L);return J===Ye&&Xs(L.state),J},fr=(L,J)=>hi(L)||L.state.wrap!==2?gt:(L.state.gzhead=J,Ye),ja=(L,J,V,me,Re,we)=>{if(!L)return gt;let rt=1;if(J===mt&&(J=6),me<0?(rt=0,me=-me):me>15&&(rt=2,me-=16),Re<1||Re>qt||V!==pr||me<8||me>15||J<0||J>9||we<0||we>xt||me===8&&rt!==1)return fn(L,gt);me===8&&(me=9);const Ze=new js;return L.state=Ze,Ze.strm=L,Ze.status=Rn,Ze.wrap=rt,Ze.gzhead=null,Ze.w_bits=me,Ze.w_size=1<<Ze.w_bits,Ze.w_mask=Ze.w_size-1,Ze.hash_bits=Re+7,Ze.hash_size=1<<Ze.hash_bits,Ze.hash_mask=Ze.hash_size-1,Ze.hash_shift=~~((Ze.hash_bits+Xt-1)/Xt),Ze.window=new Uint8Array(Ze.w_size*2),Ze.head=new Uint16Array(Ze.hash_size),Ze.prev=new Uint16Array(Ze.w_size),Ze.lit_bufsize=1<<Re+6,Ze.pending_buf_size=Ze.lit_bufsize*4,Ze.pending_buf=new Uint8Array(Ze.pending_buf_size),Ze.sym_buf=Ze.lit_bufsize,Ze.sym_end=(Ze.lit_bufsize-1)*3,Ze.level=J,Ze.strategy=we,Ze.method=V,ur(L)},Zs=(L,J)=>ja(L,J,pr,Lr,yr,dr),Ys=(L,J)=>{if(hi(L)||J>Ue||J<0)return L?fn(L,gt):gt;const V=L.state;if(!L.output||L.avail_in!==0&&!L.input||V.status===ui&&J!==Xe)return fn(L,L.avail_out===0?yt:gt);const me=V.last_flush;if(V.last_flush=J,V.pending!==0){if(Pr(L),L.avail_out===0)return V.last_flush=-1,Ye}else if(L.avail_in===0&&Fi(J)<=Fi(me)&&J!==Xe)return fn(L,yt);if(V.status===ui&&L.avail_in!==0)return fn(L,yt);if(V.status===Rn&&V.wrap===0&&(V.status=xn),V.status===Rn){let Re=pr+(V.w_bits-8<<4)<<8,we=-1;if(V.strategy>=vt||V.level<2?we=0:V.level<6?we=1:V.level===6?we=2:we=3,Re|=we<<6,V.strstart!==0&&(Re|=Ga),Re+=31-Re%31,jn(V,Re),V.strstart!==0&&(jn(V,L.adler>>>16),jn(V,L.adler&65535)),L.adler=1,V.status=xn,Pr(L),V.pending!==0)return V.last_flush=-1,Ye}if(V.status===Bi){if(L.adler=0,Jt(V,31),Jt(V,139),Jt(V,8),V.gzhead)Jt(V,(V.gzhead.text?1:0)+(V.gzhead.hcrc?2:0)+(V.gzhead.extra?4:0)+(V.gzhead.name?8:0)+(V.gzhead.comment?16:0)),Jt(V,V.gzhead.time&255),Jt(V,V.gzhead.time>>8&255),Jt(V,V.gzhead.time>>16&255),Jt(V,V.gzhead.time>>24&255),Jt(V,V.level===9?2:V.strategy>=vt||V.level<2?4:0),Jt(V,V.gzhead.os&255),V.gzhead.extra&&V.gzhead.extra.length&&(Jt(V,V.gzhead.extra.length&255),Jt(V,V.gzhead.extra.length>>8&255)),V.gzhead.hcrc&&(L.adler=U(L.adler,V.pending_buf,V.pending,0)),V.gzindex=0,V.status=ci;else if(Jt(V,0),Jt(V,0),Jt(V,0),Jt(V,0),Jt(V,0),Jt(V,V.level===9?2:V.strategy>=vt||V.level<2?4:0),Jt(V,Wa),V.status=xn,Pr(L),V.pending!==0)return V.last_flush=-1,Ye}if(V.status===ci){if(V.gzhead.extra){let Re=V.pending,we=(V.gzhead.extra.length&65535)-V.gzindex;for(;V.pending+we>V.pending_buf_size;){let Ze=V.pending_buf_size-V.pending;if(V.pending_buf.set(V.gzhead.extra.subarray(V.gzindex,V.gzindex+Ze),V.pending),V.pending=V.pending_buf_size,V.gzhead.hcrc&&V.pending>Re&&(L.adler=U(L.adler,V.pending_buf,V.pending-Re,Re)),V.gzindex+=Ze,Pr(L),V.pending!==0)return V.last_flush=-1,Ye;Re=0,we-=Ze}let rt=new Uint8Array(V.gzhead.extra);V.pending_buf.set(rt.subarray(V.gzindex,V.gzindex+we),V.pending),V.pending+=we,V.gzhead.hcrc&&V.pending>Re&&(L.adler=U(L.adler,V.pending_buf,V.pending-Re,Re)),V.gzindex=0}V.status=na}if(V.status===na){if(V.gzhead.name){let Re=V.pending,we;do{if(V.pending===V.pending_buf_size){if(V.gzhead.hcrc&&V.pending>Re&&(L.adler=U(L.adler,V.pending_buf,V.pending-Re,Re)),Pr(L),V.pending!==0)return V.last_flush=-1,Ye;Re=0}V.gzindex<V.gzhead.name.length?we=V.gzhead.name.charCodeAt(V.gzindex++)&255:we=0,Jt(V,we)}while(we!==0);V.gzhead.hcrc&&V.pending>Re&&(L.adler=U(L.adler,V.pending_buf,V.pending-Re,Re)),V.gzindex=0}V.status=ki}if(V.status===ki){if(V.gzhead.comment){let Re=V.pending,we;do{if(V.pending===V.pending_buf_size){if(V.gzhead.hcrc&&V.pending>Re&&(L.adler=U(L.adler,V.pending_buf,V.pending-Re,Re)),Pr(L),V.pending!==0)return V.last_flush=-1,Ye;Re=0}V.gzindex<V.gzhead.comment.length?we=V.gzhead.comment.charCodeAt(V.gzindex++)&255:we=0,Jt(V,we)}while(we!==0);V.gzhead.hcrc&&V.pending>Re&&(L.adler=U(L.adler,V.pending_buf,V.pending-Re,Re))}V.status=$n}if(V.status===$n){if(V.gzhead.hcrc){if(V.pending+2>V.pending_buf_size&&(Pr(L),V.pending!==0))return V.last_flush=-1,Ye;Jt(V,L.adler&255),Jt(V,L.adler>>8&255),L.adler=0}if(V.status=xn,Pr(L),V.pending!==0)return V.last_flush=-1,Ye}if(L.avail_in!==0||V.lookahead!==0||J!==dt&&V.status!==ui){let Re=V.level===0?aa(V,J):V.strategy===vt?$s(V,J):V.strategy===Rt?Hs(V,J):fi[V.level].func(V,J);if((Re===un||Re===Xn)&&(V.status=ui),Re===Tr||Re===un)return L.avail_out===0&&(V.last_flush=-1),Ye;if(Re===Ln&&(J===At?pt(V):J!==Ue&&(fe(V,0,0,!1),J===_e&&(Nr(V.head),V.lookahead===0&&(V.strstart=0,V.block_start=0,V.insert=0))),Pr(L),L.avail_out===0))return V.last_flush=-1,Ye}return J!==Xe?Ye:V.wrap<=0?ot:(V.wrap===2?(Jt(V,L.adler&255),Jt(V,L.adler>>8&255),Jt(V,L.adler>>16&255),Jt(V,L.adler>>24&255),Jt(V,L.total_in&255),Jt(V,L.total_in>>8&255),Jt(V,L.total_in>>16&255),Jt(V,L.total_in>>24&255)):(jn(V,L.adler>>>16),jn(V,L.adler&65535)),Pr(L),V.wrap>0&&(V.wrap=-V.wrap),V.pending!==0?Ye:ot)},Ks=L=>{if(hi(L))return gt;const J=L.state.status;return L.state=null,J===xn?fn(L,Et):Ye},Qs=(L,J)=>{let V=J.length;if(hi(L))return gt;const me=L.state,Re=me.wrap;if(Re===2||Re===1&&me.status!==Rn||me.lookahead)return gt;if(Re===1&&(L.adler=Je(L.adler,J,V,0)),me.wrap=0,V>=me.w_size){Re===0&&(Nr(me.head),me.strstart=0,me.block_start=0,me.insert=0);let Mt=new Uint8Array(me.w_size);Mt.set(J.subarray(V-me.w_size,V),0),J=Mt,V=me.w_size}const we=L.avail_in,rt=L.next_in,Ze=L.input;for(L.avail_in=V,L.next_in=0,L.input=J,Zn(me);me.lookahead>=Xt;){let Mt=me.strstart,He=me.lookahead-(Xt-1);do me.ins_h=bn(me,me.ins_h,me.window[Mt+Xt-1]),me.prev[Mt&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=Mt,Mt++;while(--He);me.strstart=Mt,me.lookahead=Xt-1,Zn(me)}return me.strstart+=me.lookahead,me.block_start=me.strstart,me.insert=me.lookahead,me.lookahead=0,me.match_length=me.prev_length=Xt-1,me.match_available=0,L.next_in=rt,L.input=Ze,L.avail_in=we,me.wrap=Re,Ye};var qs=Zs,Za=ja,Js=ur,wr=Xa,oa=fr,Pn=Ys,Ya=Ks,la=Qs,Gr="pako deflate (from Nodeca project)",Kn={deflateInit:qs,deflateInit2:Za,deflateReset:Js,deflateResetKeep:wr,deflateSetHeader:oa,deflate:Pn,deflateEnd:Ya,deflateSetDictionary:la,deflateInfo:Gr};const Ka=(L,J)=>Object.prototype.hasOwnProperty.call(L,J);var Qa=function(L){const J=Array.prototype.slice.call(arguments,1);for(;J.length;){const V=J.shift();if(V){if(typeof V!="object")throw new TypeError(V+"must be non-object");for(const me in V)Ka(V,me)&&(L[me]=V[me])}}return L},qa=L=>{let J=0;for(let me=0,Re=L.length;me<Re;me++)J+=L[me].length;const V=new Uint8Array(J);for(let me=0,Re=0,we=L.length;me<we;me++){let rt=L[me];V.set(rt,Re),Re+=rt.length}return V},di={assign:Qa,flattenChunks:qa};let ca=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ca=!1}const Mr=new Uint8Array(256);for(let L=0;L<256;L++)Mr[L]=L>=252?6:L>=248?5:L>=240?4:L>=224?3:L>=192?2:1;Mr[254]=Mr[254]=1;var eo=L=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(L);let J,V,me,Re,we,rt=L.length,Ze=0;for(Re=0;Re<rt;Re++)V=L.charCodeAt(Re),(V&64512)===55296&&Re+1<rt&&(me=L.charCodeAt(Re+1),(me&64512)===56320&&(V=65536+(V-55296<<10)+(me-56320),Re++)),Ze+=V<128?1:V<2048?2:V<65536?3:4;for(J=new Uint8Array(Ze),we=0,Re=0;we<Ze;Re++)V=L.charCodeAt(Re),(V&64512)===55296&&Re+1<rt&&(me=L.charCodeAt(Re+1),(me&64512)===56320&&(V=65536+(V-55296<<10)+(me-56320),Re++)),V<128?J[we++]=V:V<2048?(J[we++]=192|V>>>6,J[we++]=128|V&63):V<65536?(J[we++]=224|V>>>12,J[we++]=128|V>>>6&63,J[we++]=128|V&63):(J[we++]=240|V>>>18,J[we++]=128|V>>>12&63,J[we++]=128|V>>>6&63,J[we++]=128|V&63);return J};const Wr=(L,J)=>{if(J<65534&&L.subarray&&ca)return String.fromCharCode.apply(null,L.length===J?L:L.subarray(0,J));let V="";for(let me=0;me<J;me++)V+=String.fromCharCode(L[me]);return V};var to=(L,J)=>{const V=J||L.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(L.subarray(0,J));let me,Re;const we=new Array(V*2);for(Re=0,me=0;me<V;){let rt=L[me++];if(rt<128){we[Re++]=rt;continue}let Ze=Mr[rt];if(Ze>4){we[Re++]=65533,me+=Ze-1;continue}for(rt&=Ze===2?31:Ze===3?15:7;Ze>1&&me<V;)rt=rt<<6|L[me++]&63,Ze--;if(Ze>1){we[Re++]=65533;continue}rt<65536?we[Re++]=rt:(rt-=65536,we[Re++]=55296|rt>>10&1023,we[Re++]=56320|rt&1023)}return Wr(we,Re)},Ja=(L,J)=>{J=J||L.length,J>L.length&&(J=L.length);let V=J-1;for(;V>=0&&(L[V]&192)===128;)V--;return V<0||V===0?J:V+Mr[L[V]]>J?V:J},Hr={string2buf:eo,buf2string:to,utf8border:Ja};function zi(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Vi=zi;const hr=Object.prototype.toString,{Z_NO_FLUSH:Sn,Z_SYNC_FLUSH:ua,Z_FULL_FLUSH:ro,Z_FINISH:fa,Z_OK:Ui,Z_STREAM_END:no,Z_DEFAULT_COMPRESSION:ao,Z_DEFAULT_STRATEGY:es,Z_DEFLATED:Gi}=de;function an(L){this.options=di.assign({level:ao,method:Gi,chunkSize:16384,windowBits:15,memLevel:8,strategy:es},L||{});let J=this.options;J.raw&&J.windowBits>0?J.windowBits=-J.windowBits:J.gzip&&J.windowBits>0&&J.windowBits<16&&(J.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vi,this.strm.avail_out=0;let V=Kn.deflateInit2(this.strm,J.level,J.method,J.windowBits,J.memLevel,J.strategy);if(V!==Ui)throw new Error(ke[V]);if(J.header&&Kn.deflateSetHeader(this.strm,J.header),J.dictionary){let me;if(typeof J.dictionary=="string"?me=Hr.string2buf(J.dictionary):hr.call(J.dictionary)==="[object ArrayBuffer]"?me=new Uint8Array(J.dictionary):me=J.dictionary,V=Kn.deflateSetDictionary(this.strm,me),V!==Ui)throw new Error(ke[V]);this._dict_set=!0}}an.prototype.push=function(L,J){const V=this.strm,me=this.options.chunkSize;let Re,we;if(this.ended)return!1;for(J===~~J?we=J:we=J===!0?fa:Sn,typeof L=="string"?V.input=Hr.string2buf(L):hr.call(L)==="[object ArrayBuffer]"?V.input=new Uint8Array(L):V.input=L,V.next_in=0,V.avail_in=V.input.length;;){if(V.avail_out===0&&(V.output=new Uint8Array(me),V.next_out=0,V.avail_out=me),(we===ua||we===ro)&&V.avail_out<=6){this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;continue}if(Re=Kn.deflate(V,we),Re===no)return V.next_out>0&&this.onData(V.output.subarray(0,V.next_out)),Re=Kn.deflateEnd(this.strm),this.onEnd(Re),this.ended=!0,Re===Ui;if(V.avail_out===0){this.onData(V.output);continue}if(we>0&&V.next_out>0){this.onData(V.output.subarray(0,V.next_out)),V.avail_out=0;continue}if(V.avail_in===0)break}return!0},an.prototype.onData=function(L){this.chunks.push(L)},an.prototype.onEnd=function(L){L===Ui&&(this.result=di.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.msg=this.strm.msg};function ha(L,J){const V=new an(J);if(V.push(L,!0),V.err)throw V.msg||ke[V.err];return V.result}function ts(L,J){return J=J||{},J.raw=!0,ha(L,J)}function rs(L,J){return J=J||{},J.gzip=!0,ha(L,J)}var da=an,pa=ha,ns=ts,so=rs,ma=de,va={Deflate:da,deflate:pa,deflateRaw:ns,gzip:so,constants:ma};const Wi=16209,is=16191;var Br=function(J,V){let me,Re,we,rt,Ze,Mt,He,nt,tr,bt,ft,Pt,Yt,Kt,kt,nr,zt,_t,rr,Er,It,cr,jt,Tt;const Wt=J.state;me=J.next_in,jt=J.input,Re=me+(J.avail_in-5),we=J.next_out,Tt=J.output,rt=we-(V-J.avail_out),Ze=we+(J.avail_out-257),Mt=Wt.dmax,He=Wt.wsize,nt=Wt.whave,tr=Wt.wnext,bt=Wt.window,ft=Wt.hold,Pt=Wt.bits,Yt=Wt.lencode,Kt=Wt.distcode,kt=(1<<Wt.lenbits)-1,nr=(1<<Wt.distbits)-1;e:do{Pt<15&&(ft+=jt[me++]<<Pt,Pt+=8,ft+=jt[me++]<<Pt,Pt+=8),zt=Yt[ft&kt];t:for(;;){if(_t=zt>>>24,ft>>>=_t,Pt-=_t,_t=zt>>>16&255,_t===0)Tt[we++]=zt&65535;else if(_t&16){rr=zt&65535,_t&=15,_t&&(Pt<_t&&(ft+=jt[me++]<<Pt,Pt+=8),rr+=ft&(1<<_t)-1,ft>>>=_t,Pt-=_t),Pt<15&&(ft+=jt[me++]<<Pt,Pt+=8,ft+=jt[me++]<<Pt,Pt+=8),zt=Kt[ft&nr];r:for(;;){if(_t=zt>>>24,ft>>>=_t,Pt-=_t,_t=zt>>>16&255,_t&16){if(Er=zt&65535,_t&=15,Pt<_t&&(ft+=jt[me++]<<Pt,Pt+=8,Pt<_t&&(ft+=jt[me++]<<Pt,Pt+=8)),Er+=ft&(1<<_t)-1,Er>Mt){J.msg="invalid distance too far back",Wt.mode=Wi;break e}if(ft>>>=_t,Pt-=_t,_t=we-rt,Er>_t){if(_t=Er-_t,_t>nt&&Wt.sane){J.msg="invalid distance too far back",Wt.mode=Wi;break e}if(It=0,cr=bt,tr===0){if(It+=He-_t,_t<rr){rr-=_t;do Tt[we++]=bt[It++];while(--_t);It=we-Er,cr=Tt}}else if(tr<_t){if(It+=He+tr-_t,_t-=tr,_t<rr){rr-=_t;do Tt[we++]=bt[It++];while(--_t);if(It=0,tr<rr){_t=tr,rr-=_t;do Tt[we++]=bt[It++];while(--_t);It=we-Er,cr=Tt}}}else if(It+=tr-_t,_t<rr){rr-=_t;do Tt[we++]=bt[It++];while(--_t);It=we-Er,cr=Tt}for(;rr>2;)Tt[we++]=cr[It++],Tt[we++]=cr[It++],Tt[we++]=cr[It++],rr-=3;rr&&(Tt[we++]=cr[It++],rr>1&&(Tt[we++]=cr[It++]))}else{It=we-Er;do Tt[we++]=Tt[It++],Tt[we++]=Tt[It++],Tt[we++]=Tt[It++],rr-=3;while(rr>2);rr&&(Tt[we++]=Tt[It++],rr>1&&(Tt[we++]=Tt[It++]))}}else if(_t&64){J.msg="invalid distance code",Wt.mode=Wi;break e}else{zt=Kt[(zt&65535)+(ft&(1<<_t)-1)];continue r}break}}else if(_t&64)if(_t&32){Wt.mode=is;break e}else{J.msg="invalid literal/length code",Wt.mode=Wi;break e}else{zt=Yt[(zt&65535)+(ft&(1<<_t)-1)];continue t}break}}while(me<Re&&we<Ze);rr=Pt>>3,me-=rr,Pt-=rr<<3,ft&=(1<<Pt)-1,J.next_in=me,J.next_out=we,J.avail_in=me<Re?5+(Re-me):5-(me-Re),J.avail_out=we<Ze?257+(Ze-we):257-(we-Ze),Wt.hold=ft,Wt.bits=Pt};const Cn=15,Qn=852,_a=592,ga=0,ya=1,as=2,oo=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),co=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pi=(L,J,V,me,Re,we,rt,Ze)=>{const Mt=Ze.bits;let He=0,nt=0,tr=0,bt=0,ft=0,Pt=0,Yt=0,Kt=0,kt=0,nr=0,zt,_t,rr,Er,It,cr=null,jt;const Tt=new Uint16Array(Cn+1),Wt=new Uint16Array(Cn+1);let Mn=null,qr,ii,Fn;for(He=0;He<=Cn;He++)Tt[He]=0;for(nt=0;nt<me;nt++)Tt[J[V+nt]]++;for(ft=Mt,bt=Cn;bt>=1&&Tt[bt]===0;bt--);if(ft>bt&&(ft=bt),bt===0)return Re[we++]=1<<24|64<<16|0,Re[we++]=1<<24|64<<16|0,Ze.bits=1,0;for(tr=1;tr<bt&&Tt[tr]===0;tr++);for(ft<tr&&(ft=tr),Kt=1,He=1;He<=Cn;He++)if(Kt<<=1,Kt-=Tt[He],Kt<0)return-1;if(Kt>0&&(L===ga||bt!==1))return-1;for(Wt[1]=0,He=1;He<Cn;He++)Wt[He+1]=Wt[He]+Tt[He];for(nt=0;nt<me;nt++)J[V+nt]!==0&&(rt[Wt[J[V+nt]]++]=nt);if(L===ga?(cr=Mn=rt,jt=20):L===ya?(cr=oo,Mn=lo,jt=257):(cr=co,Mn=qn,jt=0),nr=0,nt=0,He=tr,It=we,Pt=ft,Yt=0,rr=-1,kt=1<<ft,Er=kt-1,L===ya&&kt>Qn||L===as&&kt>_a)return 1;for(;;){qr=He-Yt,rt[nt]+1<jt?(ii=0,Fn=rt[nt]):rt[nt]>=jt?(ii=Mn[rt[nt]-jt],Fn=cr[rt[nt]-jt]):(ii=96,Fn=0),zt=1<<He-Yt,_t=1<<Pt,tr=_t;do _t-=zt,Re[It+(nr>>Yt)+_t]=qr<<24|ii<<16|Fn|0;while(_t!==0);for(zt=1<<He-1;nr&zt;)zt>>=1;if(zt!==0?(nr&=zt-1,nr+=zt):nr=0,nt++,--Tt[He]===0){if(He===bt)break;He=J[V+rt[nt]]}if(He>ft&&(nr&Er)!==rr){for(Yt===0&&(Yt=ft),It+=tr,Pt=He-Yt,Kt=1<<Pt;Pt+Yt<bt&&(Kt-=Tt[Pt+Yt],!(Kt<=0));)Pt++,Kt<<=1;if(kt+=1<<Pt,L===ya&&kt>Qn||L===as&&kt>_a)return 1;rr=nr&Er,Re[rr]=ft<<24|Pt<<16|It-we|0}}return nr!==0&&(Re[It+nr]=He-Yt<<24|64<<16|0),Ze.bits=ft,0};const xa=0,ba=1,hn=2,{Z_FINISH:mi,Z_BLOCK:uo,Z_TREES:Hi,Z_OK:In,Z_STREAM_END:Jn,Z_NEED_DICT:Qr,Z_STREAM_ERROR:kr,Z_DATA_ERROR:ss,Z_MEM_ERROR:os,Z_BUF_ERROR:fo,Z_DEFLATED:ls}=de,$i=16180,On=16181,Ke=16182,st=16183,at=16184,wt=16185,Bt=16186,er=16187,_r=16188,ar=16189,ei=16190,dn=16191,Or=16192,vi=16193,Sa=16194,Dn=16195,_i=16196,gi=16197,ir=16198,Xi=16199,yi=16200,xi=16201,cs=16202,us=16203,fs=16204,bi=16205,sn=16206,Si=16207,Ca=16208,lr=16209,Ea=16210,wa=16211,ji=852,hs=592,Nn=15,Ci=L=>(L>>>24&255)+(L>>>8&65280)+((L&65280)<<8)+((L&255)<<24);function ho(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Bn=L=>{if(!L)return 1;const J=L.state;return!J||J.strm!==L||J.mode<$i||J.mode>wa?1:0},ds=L=>{if(Bn(L))return kr;const J=L.state;return L.total_in=L.total_out=J.total=0,L.msg="",J.wrap&&(L.adler=J.wrap&1),J.mode=$i,J.last=0,J.havedict=0,J.flags=-1,J.dmax=32768,J.head=null,J.hold=0,J.bits=0,J.lencode=J.lendyn=new Int32Array(ji),J.distcode=J.distdyn=new Int32Array(hs),J.sane=1,J.back=-1,In},Ei=L=>{if(Bn(L))return kr;const J=L.state;return J.wsize=0,J.whave=0,J.wnext=0,ds(L)},wi=(L,J)=>{let V;if(Bn(L))return kr;const me=L.state;return J<0?(V=0,J=-J):(V=(J>>4)+5,J<48&&(J&=15)),J&&(J<8||J>15)?kr:(me.window!==null&&me.wbits!==J&&(me.window=null),me.wrap=V,me.wbits=J,Ei(L))},Yi=(L,J)=>{if(!L)return kr;const V=new ho;L.state=V,V.strm=L,V.window=null,V.mode=$i;const me=wi(L,J);return me!==In&&(L.state=null),me},po=L=>Yi(L,Nn);let Ma=!0,Aa,Ta;const br=L=>{if(Ma){Aa=new Int32Array(512),Ta=new Int32Array(32);let J=0;for(;J<144;)L.lens[J++]=8;for(;J<256;)L.lens[J++]=9;for(;J<280;)L.lens[J++]=7;for(;J<288;)L.lens[J++]=8;for(pi(ba,L.lens,0,288,Aa,0,L.work,{bits:9}),J=0;J<32;)L.lens[J++]=5;pi(hn,L.lens,0,32,Ta,0,L.work,{bits:5}),Ma=!1}L.lencode=Aa,L.lenbits=9,L.distcode=Ta,L.distbits=5},Ar=(L,J,V,me)=>{let Re;const we=L.state;return we.window===null&&(we.wsize=1<<we.wbits,we.wnext=0,we.whave=0,we.window=new Uint8Array(we.wsize)),me>=we.wsize?(we.window.set(J.subarray(V-we.wsize,V),0),we.wnext=0,we.whave=we.wsize):(Re=we.wsize-we.wnext,Re>me&&(Re=me),we.window.set(J.subarray(V-me,V-me+Re),we.wnext),me-=Re,me?(we.window.set(J.subarray(V-me,V),0),we.wnext=me,we.whave=we.wsize):(we.wnext+=Re,we.wnext===we.wsize&&(we.wnext=0),we.whave<we.wsize&&(we.whave+=Re))),0},mo=(L,J)=>{let V,me,Re,we,rt,Ze,Mt,He,nt,tr,bt,ft,Pt,Yt,Kt=0,kt,nr,zt,_t,rr,Er,It,cr;const jt=new Uint8Array(4);let Tt,Wt;const Mn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Bn(L)||!L.output||!L.input&&L.avail_in!==0)return kr;V=L.state,V.mode===dn&&(V.mode=Or),rt=L.next_out,Re=L.output,Mt=L.avail_out,we=L.next_in,me=L.input,Ze=L.avail_in,He=V.hold,nt=V.bits,tr=Ze,bt=Mt,cr=In;e:for(;;)switch(V.mode){case $i:if(V.wrap===0){V.mode=Or;break}for(;nt<16;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(V.wrap&2&&He===35615){V.wbits===0&&(V.wbits=15),V.check=0,jt[0]=He&255,jt[1]=He>>>8&255,V.check=U(V.check,jt,2,0),He=0,nt=0,V.mode=On;break}if(V.head&&(V.head.done=!1),!(V.wrap&1)||(((He&255)<<8)+(He>>8))%31){L.msg="incorrect header check",V.mode=lr;break}if((He&15)!==ls){L.msg="unknown compression method",V.mode=lr;break}if(He>>>=4,nt-=4,It=(He&15)+8,V.wbits===0&&(V.wbits=It),It>15||It>V.wbits){L.msg="invalid window size",V.mode=lr;break}V.dmax=1<<V.wbits,V.flags=0,L.adler=V.check=1,V.mode=He&512?ar:dn,He=0,nt=0;break;case On:for(;nt<16;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(V.flags=He,(V.flags&255)!==ls){L.msg="unknown compression method",V.mode=lr;break}if(V.flags&57344){L.msg="unknown header flags set",V.mode=lr;break}V.head&&(V.head.text=He>>8&1),V.flags&512&&V.wrap&4&&(jt[0]=He&255,jt[1]=He>>>8&255,V.check=U(V.check,jt,2,0)),He=0,nt=0,V.mode=Ke;case Ke:for(;nt<32;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}V.head&&(V.head.time=He),V.flags&512&&V.wrap&4&&(jt[0]=He&255,jt[1]=He>>>8&255,jt[2]=He>>>16&255,jt[3]=He>>>24&255,V.check=U(V.check,jt,4,0)),He=0,nt=0,V.mode=st;case st:for(;nt<16;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}V.head&&(V.head.xflags=He&255,V.head.os=He>>8),V.flags&512&&V.wrap&4&&(jt[0]=He&255,jt[1]=He>>>8&255,V.check=U(V.check,jt,2,0)),He=0,nt=0,V.mode=at;case at:if(V.flags&1024){for(;nt<16;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}V.length=He,V.head&&(V.head.extra_len=He),V.flags&512&&V.wrap&4&&(jt[0]=He&255,jt[1]=He>>>8&255,V.check=U(V.check,jt,2,0)),He=0,nt=0}else V.head&&(V.head.extra=null);V.mode=wt;case wt:if(V.flags&1024&&(ft=V.length,ft>Ze&&(ft=Ze),ft&&(V.head&&(It=V.head.extra_len-V.length,V.head.extra||(V.head.extra=new Uint8Array(V.head.extra_len)),V.head.extra.set(me.subarray(we,we+ft),It)),V.flags&512&&V.wrap&4&&(V.check=U(V.check,me,ft,we)),Ze-=ft,we+=ft,V.length-=ft),V.length))break e;V.length=0,V.mode=Bt;case Bt:if(V.flags&2048){if(Ze===0)break e;ft=0;do It=me[we+ft++],V.head&&It&&V.length<65536&&(V.head.name+=String.fromCharCode(It));while(It&&ft<Ze);if(V.flags&512&&V.wrap&4&&(V.check=U(V.check,me,ft,we)),Ze-=ft,we+=ft,It)break e}else V.head&&(V.head.name=null);V.length=0,V.mode=er;case er:if(V.flags&4096){if(Ze===0)break e;ft=0;do It=me[we+ft++],V.head&&It&&V.length<65536&&(V.head.comment+=String.fromCharCode(It));while(It&&ft<Ze);if(V.flags&512&&V.wrap&4&&(V.check=U(V.check,me,ft,we)),Ze-=ft,we+=ft,It)break e}else V.head&&(V.head.comment=null);V.mode=_r;case _r:if(V.flags&512){for(;nt<16;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(V.wrap&4&&He!==(V.check&65535)){L.msg="header crc mismatch",V.mode=lr;break}He=0,nt=0}V.head&&(V.head.hcrc=V.flags>>9&1,V.head.done=!0),L.adler=V.check=0,V.mode=dn;break;case ar:for(;nt<32;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}L.adler=V.check=Ci(He),He=0,nt=0,V.mode=ei;case ei:if(V.havedict===0)return L.next_out=rt,L.avail_out=Mt,L.next_in=we,L.avail_in=Ze,V.hold=He,V.bits=nt,Qr;L.adler=V.check=1,V.mode=dn;case dn:if(J===uo||J===Hi)break e;case Or:if(V.last){He>>>=nt&7,nt-=nt&7,V.mode=sn;break}for(;nt<3;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}switch(V.last=He&1,He>>>=1,nt-=1,He&3){case 0:V.mode=vi;break;case 1:if(br(V),V.mode=Xi,J===Hi){He>>>=2,nt-=2;break e}break;case 2:V.mode=_i;break;case 3:L.msg="invalid block type",V.mode=lr}He>>>=2,nt-=2;break;case vi:for(He>>>=nt&7,nt-=nt&7;nt<32;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if((He&65535)!==(He>>>16^65535)){L.msg="invalid stored block lengths",V.mode=lr;break}if(V.length=He&65535,He=0,nt=0,V.mode=Sa,J===Hi)break e;case Sa:V.mode=Dn;case Dn:if(ft=V.length,ft){if(ft>Ze&&(ft=Ze),ft>Mt&&(ft=Mt),ft===0)break e;Re.set(me.subarray(we,we+ft),rt),Ze-=ft,we+=ft,Mt-=ft,rt+=ft,V.length-=ft;break}V.mode=dn;break;case _i:for(;nt<14;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(V.nlen=(He&31)+257,He>>>=5,nt-=5,V.ndist=(He&31)+1,He>>>=5,nt-=5,V.ncode=(He&15)+4,He>>>=4,nt-=4,V.nlen>286||V.ndist>30){L.msg="too many length or distance symbols",V.mode=lr;break}V.have=0,V.mode=gi;case gi:for(;V.have<V.ncode;){for(;nt<3;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}V.lens[Mn[V.have++]]=He&7,He>>>=3,nt-=3}for(;V.have<19;)V.lens[Mn[V.have++]]=0;if(V.lencode=V.lendyn,V.lenbits=7,Tt={bits:V.lenbits},cr=pi(xa,V.lens,0,19,V.lencode,0,V.work,Tt),V.lenbits=Tt.bits,cr){L.msg="invalid code lengths set",V.mode=lr;break}V.have=0,V.mode=ir;case ir:for(;V.have<V.nlen+V.ndist;){for(;Kt=V.lencode[He&(1<<V.lenbits)-1],kt=Kt>>>24,nr=Kt>>>16&255,zt=Kt&65535,!(kt<=nt);){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(zt<16)He>>>=kt,nt-=kt,V.lens[V.have++]=zt;else{if(zt===16){for(Wt=kt+2;nt<Wt;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(He>>>=kt,nt-=kt,V.have===0){L.msg="invalid bit length repeat",V.mode=lr;break}It=V.lens[V.have-1],ft=3+(He&3),He>>>=2,nt-=2}else if(zt===17){for(Wt=kt+3;nt<Wt;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}He>>>=kt,nt-=kt,It=0,ft=3+(He&7),He>>>=3,nt-=3}else{for(Wt=kt+7;nt<Wt;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}He>>>=kt,nt-=kt,It=0,ft=11+(He&127),He>>>=7,nt-=7}if(V.have+ft>V.nlen+V.ndist){L.msg="invalid bit length repeat",V.mode=lr;break}for(;ft--;)V.lens[V.have++]=It}}if(V.mode===lr)break;if(V.lens[256]===0){L.msg="invalid code -- missing end-of-block",V.mode=lr;break}if(V.lenbits=9,Tt={bits:V.lenbits},cr=pi(ba,V.lens,0,V.nlen,V.lencode,0,V.work,Tt),V.lenbits=Tt.bits,cr){L.msg="invalid literal/lengths set",V.mode=lr;break}if(V.distbits=6,V.distcode=V.distdyn,Tt={bits:V.distbits},cr=pi(hn,V.lens,V.nlen,V.ndist,V.distcode,0,V.work,Tt),V.distbits=Tt.bits,cr){L.msg="invalid distances set",V.mode=lr;break}if(V.mode=Xi,J===Hi)break e;case Xi:V.mode=yi;case yi:if(Ze>=6&&Mt>=258){L.next_out=rt,L.avail_out=Mt,L.next_in=we,L.avail_in=Ze,V.hold=He,V.bits=nt,Br(L,bt),rt=L.next_out,Re=L.output,Mt=L.avail_out,we=L.next_in,me=L.input,Ze=L.avail_in,He=V.hold,nt=V.bits,V.mode===dn&&(V.back=-1);break}for(V.back=0;Kt=V.lencode[He&(1<<V.lenbits)-1],kt=Kt>>>24,nr=Kt>>>16&255,zt=Kt&65535,!(kt<=nt);){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(nr&&!(nr&240)){for(_t=kt,rr=nr,Er=zt;Kt=V.lencode[Er+((He&(1<<_t+rr)-1)>>_t)],kt=Kt>>>24,nr=Kt>>>16&255,zt=Kt&65535,!(_t+kt<=nt);){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}He>>>=_t,nt-=_t,V.back+=_t}if(He>>>=kt,nt-=kt,V.back+=kt,V.length=zt,nr===0){V.mode=bi;break}if(nr&32){V.back=-1,V.mode=dn;break}if(nr&64){L.msg="invalid literal/length code",V.mode=lr;break}V.extra=nr&15,V.mode=xi;case xi:if(V.extra){for(Wt=V.extra;nt<Wt;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}V.length+=He&(1<<V.extra)-1,He>>>=V.extra,nt-=V.extra,V.back+=V.extra}V.was=V.length,V.mode=cs;case cs:for(;Kt=V.distcode[He&(1<<V.distbits)-1],kt=Kt>>>24,nr=Kt>>>16&255,zt=Kt&65535,!(kt<=nt);){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(!(nr&240)){for(_t=kt,rr=nr,Er=zt;Kt=V.distcode[Er+((He&(1<<_t+rr)-1)>>_t)],kt=Kt>>>24,nr=Kt>>>16&255,zt=Kt&65535,!(_t+kt<=nt);){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}He>>>=_t,nt-=_t,V.back+=_t}if(He>>>=kt,nt-=kt,V.back+=kt,nr&64){L.msg="invalid distance code",V.mode=lr;break}V.offset=zt,V.extra=nr&15,V.mode=us;case us:if(V.extra){for(Wt=V.extra;nt<Wt;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}V.offset+=He&(1<<V.extra)-1,He>>>=V.extra,nt-=V.extra,V.back+=V.extra}if(V.offset>V.dmax){L.msg="invalid distance too far back",V.mode=lr;break}V.mode=fs;case fs:if(Mt===0)break e;if(ft=bt-Mt,V.offset>ft){if(ft=V.offset-ft,ft>V.whave&&V.sane){L.msg="invalid distance too far back",V.mode=lr;break}ft>V.wnext?(ft-=V.wnext,Pt=V.wsize-ft):Pt=V.wnext-ft,ft>V.length&&(ft=V.length),Yt=V.window}else Yt=Re,Pt=rt-V.offset,ft=V.length;ft>Mt&&(ft=Mt),Mt-=ft,V.length-=ft;do Re[rt++]=Yt[Pt++];while(--ft);V.length===0&&(V.mode=yi);break;case bi:if(Mt===0)break e;Re[rt++]=V.length,Mt--,V.mode=yi;break;case sn:if(V.wrap){for(;nt<32;){if(Ze===0)break e;Ze--,He|=me[we++]<<nt,nt+=8}if(bt-=Mt,L.total_out+=bt,V.total+=bt,V.wrap&4&&bt&&(L.adler=V.check=V.flags?U(V.check,Re,bt,rt-bt):Je(V.check,Re,bt,rt-bt)),bt=Mt,V.wrap&4&&(V.flags?He:Ci(He))!==V.check){L.msg="incorrect data check",V.mode=lr;break}He=0,nt=0}V.mode=Si;case Si:if(V.wrap&&V.flags){for(;nt<32;){if(Ze===0)break e;Ze--,He+=me[we++]<<nt,nt+=8}if(V.wrap&4&&He!==(V.total&4294967295)){L.msg="incorrect length check",V.mode=lr;break}He=0,nt=0}V.mode=Ca;case Ca:cr=Jn;break e;case lr:cr=ss;break e;case Ea:return os;case wa:default:return kr}return L.next_out=rt,L.avail_out=Mt,L.next_in=we,L.avail_in=Ze,V.hold=He,V.bits=nt,(V.wsize||bt!==L.avail_out&&V.mode<lr&&(V.mode<sn||J!==mi))&&Ar(L,L.output,L.next_out,bt-L.avail_out),tr-=L.avail_in,bt-=L.avail_out,L.total_in+=tr,L.total_out+=bt,V.total+=bt,V.wrap&4&&bt&&(L.adler=V.check=V.flags?U(V.check,Re,bt,L.next_out-bt):Je(V.check,Re,bt,L.next_out-bt)),L.data_type=V.bits+(V.last?64:0)+(V.mode===dn?128:0)+(V.mode===Xi||V.mode===Sa?256:0),(tr===0&&bt===0||J===mi)&&cr===In&&(cr=fo),cr},vo=L=>{if(Bn(L))return kr;let J=L.state;return J.window&&(J.window=null),L.state=null,In},ps=(L,J)=>{if(Bn(L))return kr;const V=L.state;return V.wrap&2?(V.head=J,J.done=!1,In):kr},_o=(L,J)=>{const V=J.length;let me,Re,we;return Bn(L)||(me=L.state,me.wrap!==0&&me.mode!==ei)?kr:me.mode===ei&&(Re=1,Re=Je(Re,J,V,0),Re!==me.check)?ss:(we=Ar(L,J,V,V),we?(me.mode=Ea,os):(me.havedict=1,In))};var Ra=Ei,Mi=wi,La=ds,ti=po,Ai=Yi,Ti=mo,Ki=vo,ri=ps,go=_o,yo="pako inflate (from Nodeca project)",pn={inflateReset:Ra,inflateReset2:Mi,inflateResetKeep:La,inflateInit:ti,inflateInit2:Ai,inflate:Ti,inflateEnd:Ki,inflateGetHeader:ri,inflateSetDictionary:go,inflateInfo:yo};function xo(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var bo=xo;const Ri=Object.prototype.toString,{Z_NO_FLUSH:Li,Z_FINISH:ms,Z_OK:pe,Z_STREAM_END:En,Z_NEED_DICT:ni,Z_STREAM_ERROR:$r,Z_DATA_ERROR:Gt,Z_MEM_ERROR:So}=de;function Pi(L){this.options=di.assign({chunkSize:65536,windowBits:15,to:""},L||{});const J=this.options;J.raw&&J.windowBits>=0&&J.windowBits<16&&(J.windowBits=-J.windowBits,J.windowBits===0&&(J.windowBits=-15)),J.windowBits>=0&&J.windowBits<16&&!(L&&L.windowBits)&&(J.windowBits+=32),J.windowBits>15&&J.windowBits<48&&(J.windowBits&15||(J.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vi,this.strm.avail_out=0;let V=pn.inflateInit2(this.strm,J.windowBits);if(V!==pe)throw new Error(ke[V]);if(this.header=new bo,pn.inflateGetHeader(this.strm,this.header),J.dictionary&&(typeof J.dictionary=="string"?J.dictionary=Hr.string2buf(J.dictionary):Ri.call(J.dictionary)==="[object ArrayBuffer]"&&(J.dictionary=new Uint8Array(J.dictionary)),J.raw&&(V=pn.inflateSetDictionary(this.strm,J.dictionary),V!==pe)))throw new Error(ke[V])}Pi.prototype.push=function(L,J){const V=this.strm,me=this.options.chunkSize,Re=this.options.dictionary;let we,rt,Ze;if(this.ended)return!1;for(J===~~J?rt=J:rt=J===!0?ms:Li,Ri.call(L)==="[object ArrayBuffer]"?V.input=new Uint8Array(L):V.input=L,V.next_in=0,V.avail_in=V.input.length;;){for(V.avail_out===0&&(V.output=new Uint8Array(me),V.next_out=0,V.avail_out=me),we=pn.inflate(V,rt),we===ni&&Re&&(we=pn.inflateSetDictionary(V,Re),we===pe?we=pn.inflate(V,rt):we===Gt&&(we=ni));V.avail_in>0&&we===En&&V.state.wrap>0&&L[V.next_in]!==0;)pn.inflateReset(V),we=pn.inflate(V,rt);switch(we){case $r:case Gt:case ni:case So:return this.onEnd(we),this.ended=!0,!1}if(Ze=V.avail_out,V.next_out&&(V.avail_out===0||we===En))if(this.options.to==="string"){let Mt=Hr.utf8border(V.output,V.next_out),He=V.next_out-Mt,nt=Hr.buf2string(V.output,Mt);V.next_out=He,V.avail_out=me-He,He&&V.output.set(V.output.subarray(Mt,Mt+He),0),this.onData(nt)}else this.onData(V.output.length===V.next_out?V.output:V.output.subarray(0,V.next_out));if(!(we===pe&&Ze===0)){if(we===En)return we=pn.inflateEnd(this.strm),this.onEnd(we),this.ended=!0,!0;if(V.avail_in===0)break}}return!0},Pi.prototype.onData=function(L){this.chunks.push(L)},Pi.prototype.onEnd=function(L){L===pe&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=di.flattenChunks(this.chunks)),this.chunks=[],this.err=L,this.msg=this.strm.msg};function Pa(L,J){const V=new Pi(J);if(V.push(L),V.err)throw V.msg||ke[V.err];return V.result}function kn(L,J){return J=J||{},J.raw=!0,Pa(L,J)}var Co=Pi,Eo=Pa,wo=kn,Mo=Pa,Ao=de,mn={Inflate:Co,inflate:Eo,inflateRaw:wo,ungzip:Mo,constants:Ao};const{Deflate:To,deflate:Ro,deflateRaw:Lo,gzip:Po}=va,{Inflate:Io,inflate:vn,inflateRaw:Oo,ungzip:Do}=mn;var vs=To,_s=Ro,gs=Lo,wn=Po,ys=Io,xs=vn,Xr=Oo,bs=Do,Ss=de,No={Deflate:vs,deflate:_s,deflateRaw:gs,gzip:wn,Inflate:ys,inflate:xs,inflateRaw:Xr,ungzip:bs,constants:Ss}}},__webpack_module_cache__={};function __webpack_require__(o){var t=__webpack_module_cache__[o];if(t!==void 0)return t.exports;var e=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o].call(e.exports,e,e.exports,__webpack_require__),e.exports}__webpack_require__.n=o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(o,t)=>{for(var e in t)__webpack_require__.o(t,e)&&!__webpack_require__.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})},__webpack_require__.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t),__webpack_require__.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())})(_3Dmol);const useMolViewerStore=defineStore("molViewerStore",{state:()=>({_mol:null,_sdf:null,_svg:null}),getters:{mol(){return this._mol},sdf(){return this._sdf},svg(){return this._svg},propertiesString(){if(!this._mol)return{};const o={};for(const t in this._mol.properties){let e=this._mol.properties[t];(e||e===0)&&(e=e.toString()),e&&(o[t]=`${t}: ${e}`)}return o}},actions:{setMolData(o){this._mol=o},setMolVizData(o,t){this._svg=o,this._sdf=t},clearMol(){this._mol=null,this._sdf=null,this._svg=null}}}),_withScopeId=o=>(pushScopeId("data-v-4699262e"),o=o(),popScopeId(),o),_hoisted_1={key:0},_hoisted_2=_withScopeId(()=>createBaseVNode("h3",null,"Display any molecule",-1)),_hoisted_3=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_4={key:0,class:"error-msg"},_hoisted_5={class:"fields"},_hoisted_6=["innerHTML"],_hoisted_7={id:"content-wrap"},_hoisted_8={class:"col-left"},_hoisted_9={id:"title-wrap"},_hoisted_10={id:"identification"},_hoisted_11=_withScopeId(()=>createBaseVNode("b",null,"InChI: ",-1)),_hoisted_12={id:"data-inchi"},_hoisted_13=_withScopeId(()=>createBaseVNode("b",null,"InChIKey: ",-1)),_hoisted_14={id:"data-inchikey"},_hoisted_15=_withScopeId(()=>createBaseVNode("b",null,"Canonical SMILES: ",-1)),_hoisted_16={id:"data-canonical-smiles"},_hoisted_17=_withScopeId(()=>createBaseVNode("b",null,"Isomeric SMILES: ",-1)),_hoisted_18={id:"data-isomeric-smiles"},_hoisted_19=_withScopeId(()=>createBaseVNode("b",null,"Formula: ",-1)),_hoisted_20={id:"data-isomeric-smiles"},_hoisted_21=_withScopeId(()=>createBaseVNode("b",null,"PubChem CID: ",-1)),_hoisted_22=["href"],_hoisted_23={key:2,class:"error"},_hoisted_24=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_25=_withScopeId(()=>createBaseVNode("hr",null,null,-1)),_hoisted_26=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_27={id:"synonyms"},_hoisted_28=_withScopeId(()=>createBaseVNode("h3",null,"Synonyms",-1)),_hoisted_29={class:"flip-v"},_hoisted_30=_withScopeId(()=>createBaseVNode("span",null,null,-1)),_hoisted_31=[_hoisted_30],_hoisted_32={class:"cloak"},_hoisted_33=["title"],_hoisted_34=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_35=_withScopeId(()=>createBaseVNode("hr",null,null,-1)),_hoisted_36=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_37={id:"parameters"},_hoisted_38=_withScopeId(()=>createBaseVNode("h3",null,"Parameters",-1)),_hoisted_39=["title"],_hoisted_40={class:"key"},_hoisted_41=_withScopeId(()=>createBaseVNode("div",{class:"filler"},null,-1)),_hoisted_42={class:"val"},_hoisted_43=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_44=_withScopeId(()=>createBaseVNode("hr",null,null,-1)),_hoisted_45=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_46=_withScopeId(()=>createBaseVNode("div",{id:"analysis"},[createBaseVNode("h3",null,"Analysis"),createTextVNode(" Comin soon... ")],-1)),_hoisted_47=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_48=_withScopeId(()=>createBaseVNode("hr",null,null,-1)),_hoisted_49=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_50={style:{"tab-size":"30px"}},_hoisted_51=_withScopeId(()=>createBaseVNode("div",{class:"col-right"},[createBaseVNode("h4",null,"Notes"),createBaseVNode("textarea",{id:"ip-notes"})],-1)),paramColMinWidth=250,synonymColMinWidth=150,_sfc_main=defineComponent({__name:"MolViewer",props:{identifier:{}},setup(o){const t=useMainStore(),e=useMolViewerStore(),n=useFileStore(),a=useApiStore().loadApi("molecules"),s=o,l=ref(null),c=ref(!1),u=ref(!1),f=useRouter(),p=useRoute(),g=ref(""),y=computed(()=>e.mol),E=computed(()=>{var O,z;return(z=(O=y.value)==null?void 0:O.identifiers)!=null&&z.name?y.value.identifiers.name:c.value?"Loading":"Unnamed Molecule"}),h=computed(()=>p.name=="filebrowser"||p.name=="headless-filebrowser"),v=computed(()=>{var G;const O=(G=y.value)!=null&&G.synonyms?y.value.synonyms.length:0;return`${Math.ceil(O/C.value)*22}px`}),C=computed(()=>t.contentWidth?Math.floor(t.contentWidth/synonymColMinWidth)||1:4),x=computed(()=>`calc((100% - ${(C.value-1)*20}px) / ${C.value})`),w=computed(()=>t.contentWidth?Math.floor(t.contentWidth/paramColMinWidth)||1:3),_=computed(()=>`calc((100% - ${(w.value-1)*40}px) / ${w.value})`),S=computed(()=>{var G;const O=(G=y.value)!=null&&G.properties?Object.keys(y.value.properties).length:0;return`${Math.ceil(O/w.value)*22}px`});onMounted(async()=>{e.mol&&e.sdf&&B()}),onBeforeMount(async()=>{if(!(e.mol&&e.sdf))if(h.value){if(n.data)try{const O=JSON.parse(n.data);e.setMolData(O),I(),c.value=!1}catch(O){console.error(O)}}else s.identifier&&P()}),watch(()=>s.identifier,O=>{M(),O&&P(O)});function M(){l.value&&(l.value.innerHTML=""),e.clearMol()}function T(O){const z={inchi:"InChI=1S/C9H8O4/c1-6(10)13-8-5-3-2-4-7(8)9(11)12/h2-5H,1H3,(H,11,12)",smiles:"CC(=O)OC1=CC=CC=C1C(=O)O",name:"aspirin",inchikey:"BSYNRYMUTXBXSQ-UHFFFAOYSA-N",pid:"2244"};g.value=z[O]}async function R(){g.value&&await P(g.value.toString())&&f.push({name:"molviewer",params:{identifier:g.value.toString()}})}async function P(O=null){let z=!1;if(c.value=!0,u.value=!1,O=O||s.identifier||null,!!O){try{const G=await(a==null?void 0:a.getMolData(O));G.status==200?(e.setMolData(G.data),I(),z=!0):(u.value=G.statusText,console.error(u.value,G),g.value=s.identifier||""),c.value=!1}catch(G){u.value="Something went wrong fetching the molecule data.",console.error(u.value,G),g.value=s.identifier||""}return z}}async function I(){var z,G;const O=(G=(z=e.mol)==null?void 0:z.identifiers)==null?void 0:G.inchi;if(O)try{const k=await(a==null?void 0:a.getMolVizData(O));k.status==200?(e.setMolVizData(k.data.svg,k.data.sdf),B()):console.error(k.statusText)}catch(k){console.error("Something went wrong fetching the molecule`s visualization data.",k)}}async function B(){!l.value||!e.sdf||W(l.value,e.sdf)}function W(O,z){const G=new Miew({container:O,reps:[{mode:"BS",colorer:"EL",material:"DF"}],settings:{axes:!1,fps:!1,autoRotation:-.03,bg:{color:16777215,transparent:!0}}});G.init()&&(G.run(),G.load(z,{sourceType:"immediate",fileType:"sdf"}))}function D(O){O.currentTarget.classList.toggle("expand")}return(O,z)=>{var $,Z,K,j,Q,le,he,ve,re,Ie,ge,Se,Le,be;const G=resolveComponent("cv-text-input"),k=resolveComponent("cv-button");return!h.value&&(!s.identifier||u.value)?(openBlock(),createElementBlock("div",_hoisted_1,[_hoisted_2,createBaseVNode("p",null,[createTextVNode(" Accepted identifiers are: "),createBaseVNode("b",null,[createBaseVNode("a",{href:"#",onClick:z[0]||(z[0]=withModifiers(ye=>T("inchi"),["prevent"]))},"InChI")]),createTextVNode(" or "),createBaseVNode("b",null,[createBaseVNode("a",{href:"#",onClick:z[1]||(z[1]=withModifiers(ye=>T("smiles"),["prevent"]))},"SMILES")]),createTextVNode("."),_hoisted_3,createTextVNode(" When a molecule is listed on PubChem, you can also use its "),createBaseVNode("b",null,[createBaseVNode("a",{href:"#",onClick:z[2]||(z[2]=withModifiers(ye=>T("name"),["prevent"]))},"name")]),createTextVNode(", "),createBaseVNode("b",null,[createBaseVNode("a",{href:"#",onClick:z[3]||(z[3]=withModifiers(ye=>T("inchikey"),["prevent"]))},"InChIKey")]),createTextVNode(" or "),createBaseVNode("b",null,[createBaseVNode("a",{href:"#",onClick:z[4]||(z[4]=withModifiers(ye=>T("pid"),["prevent"]))},"PID")]),createTextVNode(". ")]),createBaseVNode("form",{id:"input-form",onSubmit:withModifiers(R,["prevent"])},[u.value?(openBlock(),createElementBlock("div",_hoisted_4,toDisplayString(u.value),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5,[createVNode(G,{modelValue:g.value,"onUpdate:modelValue":z[5]||(z[5]=ye=>g.value=ye),type:"text",placeholder:"aspirin","hide-label":!0},null,8,["modelValue"]),createVNode(k,{size:"default",disabled:!!c.value},{default:withCtx(()=>[createTextVNode(toDisplayString(c.value?"Loading...":"Display"),1)]),_:1},8,["disabled"])])],32)])):(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",{id:"mol-render",class:normalizeClass({headless:unref(t).headless})},[createBaseVNode("div",{class:"container-2d",innerHTML:unref(e).svg},null,8,_hoisted_6),createBaseVNode("div",{class:"container-3d",ref_key:"$container3d",ref:l},null,512)],2),createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,[h.value?(openBlock(),createBlock(BreadCrumbs,{key:0,path:unref(n).path},null,8,["path"])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",{class:normalizeClass(["icn-mol",{loading:c.value}])},null,2),createBaseVNode("h2",{id:"data-name","data-val":"{{ molName }}",class:normalizeClass({loading:c.value})},toDisplayString(E.value),3),createBaseVNode("div",{id:"btn-bookmark",class:normalizeClass(["icn-star",{hide:c.value}])},null,2)]),y.value?(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_10,[createBaseVNode("div",null,[_hoisted_11,createBaseVNode("span",_hoisted_12,toDisplayString((Z=($=y.value)==null?void 0:$.identifiers)==null?void 0:Z.inchi),1)]),createBaseVNode("div",null,[_hoisted_13,createBaseVNode("span",_hoisted_14,toDisplayString((j=(K=y.value)==null?void 0:K.identifiers)==null?void 0:j.inchikey),1)]),createBaseVNode("div",null,[_hoisted_15,createBaseVNode("span",_hoisted_16,toDisplayString((le=(Q=y.value)==null?void 0:Q.identifiers)==null?void 0:le.canonical_smiles),1)]),createBaseVNode("div",null,[_hoisted_17,createBaseVNode("span",_hoisted_18,toDisplayString((ve=(he=y.value)==null?void 0:he.identifiers)==null?void 0:ve.isomeric_smiles),1)]),createBaseVNode("div",null,[_hoisted_19,createBaseVNode("span",_hoisted_20,toDisplayString((Ie=(re=y.value)==null?void 0:re.identifiers)==null?void 0:Ie.formula),1)]),createBaseVNode("div",null,[_hoisted_21,(Se=(ge=y.value)==null?void 0:ge.identifiers)!=null&&Se.cid?(openBlock(),createElementBlock("a",{key:0,id:"data-cid",href:`https://pubchem.ncbi.nlm.nih.gov/compound/${y.value.identifiers.cid}`,target:"_blank"},toDisplayString(y.value.identifiers.cid),9,_hoisted_22)):createCommentVNode("",!0),c.value?(openBlock(),createElementBlock("span",{key:1,id:"fetching-pubchem",class:normalizeClass({error:!!u.value})},"Fetching",2)):u.value?(openBlock(),createElementBlock("span",_hoisted_23,[createTextVNode("Failed to connect - "),createBaseVNode("a",{href:"#",onClick:z[6]||(z[6]=ye=>P())},"retry")])):createCommentVNode("",!0)])]),_hoisted_24,_hoisted_25,_hoisted_26,createBaseVNode("div",_hoisted_27,[_hoisted_28,createBaseVNode("div",_hoisted_29,[createBaseVNode("a",{href:"#",class:"toggle-expand hide",onClick:withModifiers(D,["prevent"])},_hoisted_31),createBaseVNode("div",_hoisted_32,[createBaseVNode("div",{class:"synonyms-wrap",style:normalizeStyle({height:v.value})},[(openBlock(!0),createElementBlock(Fragment,null,renderList((Le=y.value)==null?void 0:Le.synonyms,(ye,ce)=>(openBlock(),createElementBlock("div",{key:ce,title:ye,style:normalizeStyle({width:x.value})},toDisplayString(ye),13,_hoisted_33))),128))],4)])])]),_hoisted_34,_hoisted_35,_hoisted_36,createBaseVNode("div",_hoisted_37,[_hoisted_38,createBaseVNode("div",{class:"param-wrap",style:normalizeStyle({height:S.value})},[(openBlock(!0),createElementBlock(Fragment,null,renderList((be=y.value)==null?void 0:be.properties,(ye,ce)=>(openBlock(),createElementBlock("div",{key:ce,title:unref(e).propertiesString[ce],class:normalizeClass({empty:!ye&&ye!==0}),style:normalizeStyle({width:_.value})},[createBaseVNode("div",_hoisted_40,toDisplayString(ce)+":",1),_hoisted_41,createBaseVNode("div",_hoisted_42,toDisplayString(ye||ye===0?ye:"-"),1)],14,_hoisted_39))),128))],4)]),_hoisted_43,_hoisted_44,_hoisted_45,_hoisted_46,_hoisted_47,_hoisted_48,_hoisted_49,createBaseVNode("a",{id:"show-json",class:"toggle-expand te-show",href:"#",onClick:withModifiers(D,["prevent"])}," JSON "),createBaseVNode("pre",_hoisted_50,toDisplayString(y.value),1)],64)):createCommentVNode("",!0)]),_hoisted_51])],64))}}}),MolViewer=_export_sfc(_sfc_main,[["__scopeId","data-v-4699262e"]]);export{MolViewer as default};
